webpackHotUpdate(5,{

/***/ 1149:
/***/ (function(module, exports) {

 /*
 * # Semantic UI - 2.4.0
 * https://github.com/Semantic-Org/Semantic-UI
 * http://www.semantic-ui.com/
 *
 * Copyright 2014 Contributors
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */
/*!
 * # Semantic UI 2.4.0 - Site
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

$.site = $.fn.site = function(parameters) {
  var
    time           = new Date().getTime(),
    performance    = [],

    query          = arguments[0],
    methodInvoked  = (typeof query == 'string'),
    queryArguments = [].slice.call(arguments, 1),

    settings        = ( $.isPlainObject(parameters) )
      ? $.extend(true, {}, $.site.settings, parameters)
      : $.extend({}, $.site.settings),

    namespace       = settings.namespace,
    error           = settings.error,

    eventNamespace  = '.' + namespace,
    moduleNamespace = 'module-' + namespace,

    $document       = $(document),
    $module         = $document,
    element         = this,
    instance        = $module.data(moduleNamespace),

    module,
    returnedValue
  ;
  module = {

    initialize: function() {
      module.instantiate();
    },

    instantiate: function() {
      module.verbose('Storing instance of site', module);
      instance = module;
      $module
        .data(moduleNamespace, module)
      ;
    },

    normalize: function() {
      module.fix.console();
      module.fix.requestAnimationFrame();
    },

    fix: {
      console: function() {
        module.debug('Normalizing window.console');
        if (console === undefined || console.log === undefined) {
          module.verbose('Console not available, normalizing events');
          module.disable.console();
        }
        if (typeof console.group == 'undefined' || typeof console.groupEnd == 'undefined' || typeof console.groupCollapsed == 'undefined') {
          module.verbose('Console group not available, normalizing events');
          window.console.group = function() {};
          window.console.groupEnd = function() {};
          window.console.groupCollapsed = function() {};
        }
        if (typeof console.markTimeline == 'undefined') {
          module.verbose('Mark timeline not available, normalizing events');
          window.console.markTimeline = function() {};
        }
      },
      consoleClear: function() {
        module.debug('Disabling programmatic console clearing');
        window.console.clear = function() {};
      },
      requestAnimationFrame: function() {
        module.debug('Normalizing requestAnimationFrame');
        if(window.requestAnimationFrame === undefined) {
          module.debug('RequestAnimationFrame not available, normalizing event');
          window.requestAnimationFrame = window.requestAnimationFrame
            || window.mozRequestAnimationFrame
            || window.webkitRequestAnimationFrame
            || window.msRequestAnimationFrame
            || function(callback) { setTimeout(callback, 0); }
          ;
        }
      }
    },

    moduleExists: function(name) {
      return ($.fn[name] !== undefined && $.fn[name].settings !== undefined);
    },

    enabled: {
      modules: function(modules) {
        var
          enabledModules = []
        ;
        modules = modules || settings.modules;
        $.each(modules, function(index, name) {
          if(module.moduleExists(name)) {
            enabledModules.push(name);
          }
        });
        return enabledModules;
      }
    },

    disabled: {
      modules: function(modules) {
        var
          disabledModules = []
        ;
        modules = modules || settings.modules;
        $.each(modules, function(index, name) {
          if(!module.moduleExists(name)) {
            disabledModules.push(name);
          }
        });
        return disabledModules;
      }
    },

    change: {
      setting: function(setting, value, modules, modifyExisting) {
        modules = (typeof modules === 'string')
          ? (modules === 'all')
            ? settings.modules
            : [modules]
          : modules || settings.modules
        ;
        modifyExisting = (modifyExisting !== undefined)
          ? modifyExisting
          : true
        ;
        $.each(modules, function(index, name) {
          var
            namespace = (module.moduleExists(name))
              ? $.fn[name].settings.namespace || false
              : true,
            $existingModules
          ;
          if(module.moduleExists(name)) {
            module.verbose('Changing default setting', setting, value, name);
            $.fn[name].settings[setting] = value;
            if(modifyExisting && namespace) {
              $existingModules = $(':data(module-' + namespace + ')');
              if($existingModules.length > 0) {
                module.verbose('Modifying existing settings', $existingModules);
                $existingModules[name]('setting', setting, value);
              }
            }
          }
        });
      },
      settings: function(newSettings, modules, modifyExisting) {
        modules = (typeof modules === 'string')
          ? [modules]
          : modules || settings.modules
        ;
        modifyExisting = (modifyExisting !== undefined)
          ? modifyExisting
          : true
        ;
        $.each(modules, function(index, name) {
          var
            $existingModules
          ;
          if(module.moduleExists(name)) {
            module.verbose('Changing default setting', newSettings, name);
            $.extend(true, $.fn[name].settings, newSettings);
            if(modifyExisting && namespace) {
              $existingModules = $(':data(module-' + namespace + ')');
              if($existingModules.length > 0) {
                module.verbose('Modifying existing settings', $existingModules);
                $existingModules[name]('setting', newSettings);
              }
            }
          }
        });
      }
    },

    enable: {
      console: function() {
        module.console(true);
      },
      debug: function(modules, modifyExisting) {
        modules = modules || settings.modules;
        module.debug('Enabling debug for modules', modules);
        module.change.setting('debug', true, modules, modifyExisting);
      },
      verbose: function(modules, modifyExisting) {
        modules = modules || settings.modules;
        module.debug('Enabling verbose debug for modules', modules);
        module.change.setting('verbose', true, modules, modifyExisting);
      }
    },
    disable: {
      console: function() {
        module.console(false);
      },
      debug: function(modules, modifyExisting) {
        modules = modules || settings.modules;
        module.debug('Disabling debug for modules', modules);
        module.change.setting('debug', false, modules, modifyExisting);
      },
      verbose: function(modules, modifyExisting) {
        modules = modules || settings.modules;
        module.debug('Disabling verbose debug for modules', modules);
        module.change.setting('verbose', false, modules, modifyExisting);
      }
    },

    console: function(enable) {
      if(enable) {
        if(instance.cache.console === undefined) {
          module.error(error.console);
          return;
        }
        module.debug('Restoring console function');
        window.console = instance.cache.console;
      }
      else {
        module.debug('Disabling console function');
        instance.cache.console = window.console;
        window.console = {
          clear          : function(){},
          error          : function(){},
          group          : function(){},
          groupCollapsed : function(){},
          groupEnd       : function(){},
          info           : function(){},
          log            : function(){},
          markTimeline   : function(){},
          warn           : function(){}
        };
      }
    },

    destroy: function() {
      module.verbose('Destroying previous site for', $module);
      $module
        .removeData(moduleNamespace)
      ;
    },

    cache: {},

    setting: function(name, value) {
      if( $.isPlainObject(name) ) {
        $.extend(true, settings, name);
      }
      else if(value !== undefined) {
        settings[name] = value;
      }
      else {
        return settings[name];
      }
    },
    internal: function(name, value) {
      if( $.isPlainObject(name) ) {
        $.extend(true, module, name);
      }
      else if(value !== undefined) {
        module[name] = value;
      }
      else {
        return module[name];
      }
    },
    debug: function() {
      if(settings.debug) {
        if(settings.performance) {
          module.performance.log(arguments);
        }
        else {
          module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
          module.debug.apply(console, arguments);
        }
      }
    },
    verbose: function() {
      if(settings.verbose && settings.debug) {
        if(settings.performance) {
          module.performance.log(arguments);
        }
        else {
          module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
          module.verbose.apply(console, arguments);
        }
      }
    },
    error: function() {
      module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
      module.error.apply(console, arguments);
    },
    performance: {
      log: function(message) {
        var
          currentTime,
          executionTime,
          previousTime
        ;
        if(settings.performance) {
          currentTime   = new Date().getTime();
          previousTime  = time || currentTime;
          executionTime = currentTime - previousTime;
          time          = currentTime;
          performance.push({
            'Element'        : element,
            'Name'           : message[0],
            'Arguments'      : [].slice.call(message, 1) || '',
            'Execution Time' : executionTime
          });
        }
        clearTimeout(module.performance.timer);
        module.performance.timer = setTimeout(module.performance.display, 500);
      },
      display: function() {
        var
          title = settings.name + ':',
          totalTime = 0
        ;
        time = false;
        clearTimeout(module.performance.timer);
        $.each(performance, function(index, data) {
          totalTime += data['Execution Time'];
        });
        title += ' ' + totalTime + 'ms';
        if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
          console.groupCollapsed(title);
          if(console.table) {
            console.table(performance);
          }
          else {
            $.each(performance, function(index, data) {
              console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
            });
          }
          console.groupEnd();
        }
        performance = [];
      }
    },
    invoke: function(query, passedArguments, context) {
      var
        object = instance,
        maxDepth,
        found,
        response
      ;
      passedArguments = passedArguments || queryArguments;
      context         = element         || context;
      if(typeof query == 'string' && object !== undefined) {
        query    = query.split(/[\. ]/);
        maxDepth = query.length - 1;
        $.each(query, function(depth, value) {
          var camelCaseValue = (depth != maxDepth)
            ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
            : query
          ;
          if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
            object = object[camelCaseValue];
          }
          else if( object[camelCaseValue] !== undefined ) {
            found = object[camelCaseValue];
            return false;
          }
          else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
            object = object[value];
          }
          else if( object[value] !== undefined ) {
            found = object[value];
            return false;
          }
          else {
            module.error(error.method, query);
            return false;
          }
        });
      }
      if ( $.isFunction( found ) ) {
        response = found.apply(context, passedArguments);
      }
      else if(found !== undefined) {
        response = found;
      }
      if($.isArray(returnedValue)) {
        returnedValue.push(response);
      }
      else if(returnedValue !== undefined) {
        returnedValue = [returnedValue, response];
      }
      else if(response !== undefined) {
        returnedValue = response;
      }
      return found;
    }
  };

  if(methodInvoked) {
    if(instance === undefined) {
      module.initialize();
    }
    module.invoke(query);
  }
  else {
    if(instance !== undefined) {
      module.destroy();
    }
    module.initialize();
  }
  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.site.settings = {

  name        : 'Site',
  namespace   : 'site',

  error : {
    console : 'Console cannot be restored, most likely it was overwritten outside of module',
    method : 'The method you called is not defined.'
  },

  debug       : false,
  verbose     : false,
  performance : true,

  modules: [
    'accordion',
    'api',
    'checkbox',
    'dimmer',
    'dropdown',
    'embed',
    'form',
    'modal',
    'nag',
    'popup',
    'rating',
    'shape',
    'sidebar',
    'state',
    'sticky',
    'tab',
    'transition',
    'visit',
    'visibility'
  ],

  siteNamespace   : 'site',
  namespaceStub   : {
    cache     : {},
    config    : {},
    sections  : {},
    section   : {},
    utilities : {}
  }

};

// allows for selection of elements with data attributes
$.extend($.expr[ ":" ], {
  data: ($.expr.createPseudo)
    ? $.expr.createPseudo(function(dataName) {
        return function(elem) {
          return !!$.data(elem, dataName);
        };
      })
    : function(elem, i, match) {
      // support: jQuery < 1.8
      return !!$.data(elem, match[ 3 ]);
    }
});


})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Form Validation
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.form = function(parameters) {
  var
    $allModules      = $(this),
    moduleSelector   = $allModules.selector || '',

    time             = new Date().getTime(),
    performance      = [],

    query            = arguments[0],
    legacyParameters = arguments[1],
    methodInvoked    = (typeof query == 'string'),
    queryArguments   = [].slice.call(arguments, 1),
    returnedValue
  ;
  $allModules
    .each(function() {
      var
        $module     = $(this),
        element     = this,

        formErrors  = [],
        keyHeldDown = false,

        // set at run-time
        $field,
        $group,
        $message,
        $prompt,
        $submit,
        $clear,
        $reset,

        settings,
        validation,

        metadata,
        selector,
        className,
        regExp,
        error,

        namespace,
        moduleNamespace,
        eventNamespace,

        instance,
        module
      ;

      module      = {

        initialize: function() {

          // settings grabbed at run time
          module.get.settings();
          if(methodInvoked) {
            if(instance === undefined) {
              module.instantiate();
            }
            module.invoke(query);
          }
          else {
            if(instance !== undefined) {
              instance.invoke('destroy');
            }
            module.verbose('Initializing form validation', $module, settings);
            module.bindEvents();
            module.set.defaults();
            module.instantiate();
          }
        },

        instantiate: function() {
          module.verbose('Storing instance of module', module);
          instance = module;
          $module
            .data(moduleNamespace, module)
          ;
        },

        destroy: function() {
          module.verbose('Destroying previous module', instance);
          module.removeEvents();
          $module
            .removeData(moduleNamespace)
          ;
        },

        refresh: function() {
          module.verbose('Refreshing selector cache');
          $field      = $module.find(selector.field);
          $group      = $module.find(selector.group);
          $message    = $module.find(selector.message);
          $prompt     = $module.find(selector.prompt);

          $submit     = $module.find(selector.submit);
          $clear      = $module.find(selector.clear);
          $reset      = $module.find(selector.reset);
        },

        submit: function() {
          module.verbose('Submitting form', $module);
          $module
            .submit()
          ;
        },

        attachEvents: function(selector, action) {
          action = action || 'submit';
          $(selector)
            .on('click' + eventNamespace, function(event) {
              module[action]();
              event.preventDefault();
            })
          ;
        },

        bindEvents: function() {
          module.verbose('Attaching form events');
          $module
            .on('submit' + eventNamespace, module.validate.form)
            .on('blur'   + eventNamespace, selector.field, module.event.field.blur)
            .on('click'  + eventNamespace, selector.submit, module.submit)
            .on('click'  + eventNamespace, selector.reset, module.reset)
            .on('click'  + eventNamespace, selector.clear, module.clear)
          ;
          if(settings.keyboardShortcuts) {
            $module
              .on('keydown' + eventNamespace, selector.field, module.event.field.keydown)
            ;
          }
          $field
            .each(function() {
              var
                $input     = $(this),
                type       = $input.prop('type'),
                inputEvent = module.get.changeEvent(type, $input)
              ;
              $(this)
                .on(inputEvent + eventNamespace, module.event.field.change)
              ;
            })
          ;
        },

        clear: function() {
          $field
            .each(function () {
              var
                $field       = $(this),
                $element     = $field.parent(),
                $fieldGroup  = $field.closest($group),
                $prompt      = $fieldGroup.find(selector.prompt),
                defaultValue = $field.data(metadata.defaultValue) || '',
                isCheckbox   = $element.is(selector.uiCheckbox),
                isDropdown   = $element.is(selector.uiDropdown),
                isErrored    = $fieldGroup.hasClass(className.error)
              ;
              if(isErrored) {
                module.verbose('Resetting error on field', $fieldGroup);
                $fieldGroup.removeClass(className.error);
                $prompt.remove();
              }
              if(isDropdown) {
                module.verbose('Resetting dropdown value', $element, defaultValue);
                $element.dropdown('clear');
              }
              else if(isCheckbox) {
                $field.prop('checked', false);
              }
              else {
                module.verbose('Resetting field value', $field, defaultValue);
                $field.val('');
              }
            })
          ;
        },

        reset: function() {
          $field
            .each(function () {
              var
                $field       = $(this),
                $element     = $field.parent(),
                $fieldGroup  = $field.closest($group),
                $prompt      = $fieldGroup.find(selector.prompt),
                defaultValue = $field.data(metadata.defaultValue),
                isCheckbox   = $element.is(selector.uiCheckbox),
                isDropdown   = $element.is(selector.uiDropdown),
                isErrored    = $fieldGroup.hasClass(className.error)
              ;
              if(defaultValue === undefined) {
                return;
              }
              if(isErrored) {
                module.verbose('Resetting error on field', $fieldGroup);
                $fieldGroup.removeClass(className.error);
                $prompt.remove();
              }
              if(isDropdown) {
                module.verbose('Resetting dropdown value', $element, defaultValue);
                $element.dropdown('restore defaults');
              }
              else if(isCheckbox) {
                module.verbose('Resetting checkbox value', $element, defaultValue);
                $field.prop('checked', defaultValue);
              }
              else {
                module.verbose('Resetting field value', $field, defaultValue);
                $field.val(defaultValue);
              }
            })
          ;
        },

        determine: {
          isValid: function() {
            var
              allValid = true
            ;
            $.each(validation, function(fieldName, field) {
              if( !( module.validate.field(field, fieldName, true) ) ) {
                allValid = false;
              }
            });
            return allValid;
          }
        },

        is: {
          bracketedRule: function(rule) {
            return (rule.type && rule.type.match(settings.regExp.bracket));
          },
          shorthandFields: function(fields) {
            var
              fieldKeys = Object.keys(fields),
              firstRule = fields[fieldKeys[0]]
            ;
            return module.is.shorthandRules(firstRule);
          },
          // duck type rule test
          shorthandRules: function(rules) {
            return (typeof rules == 'string' || $.isArray(rules));
          },
          empty: function($field) {
            if(!$field || $field.length === 0) {
              return true;
            }
            else if($field.is('input[type="checkbox"]')) {
              return !$field.is(':checked');
            }
            else {
              return module.is.blank($field);
            }
          },
          blank: function($field) {
            return $.trim($field.val()) === '';
          },
          valid: function(field) {
            var
              allValid = true
            ;
            if(field) {
              module.verbose('Checking if field is valid', field);
              return module.validate.field(validation[field], field, false);
            }
            else {
              module.verbose('Checking if form is valid');
              $.each(validation, function(fieldName, field) {
                if( !module.is.valid(fieldName) ) {
                  allValid = false;
                }
              });
              return allValid;
            }
          }
        },

        removeEvents: function() {
          $module
            .off(eventNamespace)
          ;
          $field
            .off(eventNamespace)
          ;
          $submit
            .off(eventNamespace)
          ;
          $field
            .off(eventNamespace)
          ;
        },

        event: {
          field: {
            keydown: function(event) {
              var
                $field       = $(this),
                key          = event.which,
                isInput      = $field.is(selector.input),
                isCheckbox   = $field.is(selector.checkbox),
                isInDropdown = ($field.closest(selector.uiDropdown).length > 0),
                keyCode      = {
                  enter  : 13,
                  escape : 27
                }
              ;
              if( key == keyCode.escape) {
                module.verbose('Escape key pressed blurring field');
                $field
                  .blur()
                ;
              }
              if(!event.ctrlKey && key == keyCode.enter && isInput && !isInDropdown && !isCheckbox) {
                if(!keyHeldDown) {
                  $field
                    .one('keyup' + eventNamespace, module.event.field.keyup)
                  ;
                  module.submit();
                  module.debug('Enter pressed on input submitting form');
                }
                keyHeldDown = true;
              }
            },
            keyup: function() {
              keyHeldDown = false;
            },
            blur: function(event) {
              var
                $field          = $(this),
                $fieldGroup     = $field.closest($group),
                validationRules = module.get.validation($field)
              ;
              if( $fieldGroup.hasClass(className.error) ) {
                module.debug('Revalidating field', $field, validationRules);
                if(validationRules) {
                  module.validate.field( validationRules );
                }
              }
              else if(settings.on == 'blur') {
                if(validationRules) {
                  module.validate.field( validationRules );
                }
              }
            },
            change: function(event) {
              var
                $field      = $(this),
                $fieldGroup = $field.closest($group),
                validationRules = module.get.validation($field)
              ;
              if(validationRules && (settings.on == 'change' || ( $fieldGroup.hasClass(className.error) && settings.revalidate) )) {
                clearTimeout(module.timer);
                module.timer = setTimeout(function() {
                  module.debug('Revalidating field', $field,  module.get.validation($field));
                  module.validate.field( validationRules );
                }, settings.delay);
              }
            }
          }

        },

        get: {
          ancillaryValue: function(rule) {
            if(!rule.type || (!rule.value && !module.is.bracketedRule(rule))) {
              return false;
            }
            return (rule.value !== undefined)
              ? rule.value
              : rule.type.match(settings.regExp.bracket)[1] + ''
            ;
          },
          ruleName: function(rule) {
            if( module.is.bracketedRule(rule) ) {
              return rule.type.replace(rule.type.match(settings.regExp.bracket)[0], '');
            }
            return rule.type;
          },
          changeEvent: function(type, $input) {
            if(type == 'checkbox' || type == 'radio' || type == 'hidden' || $input.is('select')) {
              return 'change';
            }
            else {
              return module.get.inputEvent();
            }
          },
          inputEvent: function() {
            return (document.createElement('input').oninput !== undefined)
              ? 'input'
              : (document.createElement('input').onpropertychange !== undefined)
                ? 'propertychange'
                : 'keyup'
            ;
          },
          fieldsFromShorthand: function(fields) {
            var
              fullFields = {}
            ;
            $.each(fields, function(name, rules) {
              if(typeof rules == 'string') {
                rules = [rules];
              }
              fullFields[name] = {
                rules: []
              };
              $.each(rules, function(index, rule) {
                fullFields[name].rules.push({ type: rule });
              });
            });
            return fullFields;
          },
          prompt: function(rule, field) {
            var
              ruleName      = module.get.ruleName(rule),
              ancillary     = module.get.ancillaryValue(rule),
              $field        = module.get.field(field.identifier),
              value         = $field.val(),
              prompt        = $.isFunction(rule.prompt)
                ? rule.prompt(value)
                : rule.prompt || settings.prompt[ruleName] || settings.text.unspecifiedRule,
              requiresValue = (prompt.search('{value}') !== -1),
              requiresName  = (prompt.search('{name}') !== -1),
              $label,
              name
            ;
            if(requiresValue) {
              prompt = prompt.replace('{value}', $field.val());
            }
            if(requiresName) {
              $label = $field.closest(selector.group).find('label').eq(0);
              name = ($label.length == 1)
                ? $label.text()
                : $field.prop('placeholder') || settings.text.unspecifiedField
              ;
              prompt = prompt.replace('{name}', name);
            }
            prompt = prompt.replace('{identifier}', field.identifier);
            prompt = prompt.replace('{ruleValue}', ancillary);
            if(!rule.prompt) {
              module.verbose('Using default validation prompt for type', prompt, ruleName);
            }
            return prompt;
          },
          settings: function() {
            if($.isPlainObject(parameters)) {
              var
                keys     = Object.keys(parameters),
                isLegacySettings = (keys.length > 0)
                  ? (parameters[keys[0]].identifier !== undefined && parameters[keys[0]].rules !== undefined)
                  : false,
                ruleKeys
              ;
              if(isLegacySettings) {
                // 1.x (ducktyped)
                settings   = $.extend(true, {}, $.fn.form.settings, legacyParameters);
                validation = $.extend({}, $.fn.form.settings.defaults, parameters);
                module.error(settings.error.oldSyntax, element);
                module.verbose('Extending settings from legacy parameters', validation, settings);
              }
              else {
                // 2.x
                if(parameters.fields && module.is.shorthandFields(parameters.fields)) {
                  parameters.fields = module.get.fieldsFromShorthand(parameters.fields);
                }
                settings   = $.extend(true, {}, $.fn.form.settings, parameters);
                validation = $.extend({}, $.fn.form.settings.defaults, settings.fields);
                module.verbose('Extending settings', validation, settings);
              }
            }
            else {
              settings   = $.fn.form.settings;
              validation = $.fn.form.settings.defaults;
              module.verbose('Using default form validation', validation, settings);
            }

            // shorthand
            namespace       = settings.namespace;
            metadata        = settings.metadata;
            selector        = settings.selector;
            className       = settings.className;
            regExp          = settings.regExp;
            error           = settings.error;
            moduleNamespace = 'module-' + namespace;
            eventNamespace  = '.' + namespace;

            // grab instance
            instance = $module.data(moduleNamespace);

            // refresh selector cache
            module.refresh();
          },
          field: function(identifier) {
            module.verbose('Finding field with identifier', identifier);
            identifier = module.escape.string(identifier);
            if($field.filter('#' + identifier).length > 0 ) {
              return $field.filter('#' + identifier);
            }
            else if( $field.filter('[name="' + identifier +'"]').length > 0 ) {
              return $field.filter('[name="' + identifier +'"]');
            }
            else if( $field.filter('[name="' + identifier +'[]"]').length > 0 ) {
              return $field.filter('[name="' + identifier +'[]"]');
            }
            else if( $field.filter('[data-' + metadata.validate + '="'+ identifier +'"]').length > 0 ) {
              return $field.filter('[data-' + metadata.validate + '="'+ identifier +'"]');
            }
            return $('<input/>');
          },
          fields: function(fields) {
            var
              $fields = $()
            ;
            $.each(fields, function(index, name) {
              $fields = $fields.add( module.get.field(name) );
            });
            return $fields;
          },
          validation: function($field) {
            var
              fieldValidation,
              identifier
            ;
            if(!validation) {
              return false;
            }
            $.each(validation, function(fieldName, field) {
              identifier = field.identifier || fieldName;
              if( module.get.field(identifier)[0] == $field[0] ) {
                field.identifier = identifier;
                fieldValidation = field;
              }
            });
            return fieldValidation || false;
          },
          value: function (field) {
            var
              fields = [],
              results
            ;
            fields.push(field);
            results = module.get.values.call(element, fields);
            return results[field];
          },
          values: function (fields) {
            var
              $fields = $.isArray(fields)
                ? module.get.fields(fields)
                : $field,
              values = {}
            ;
            $fields.each(function(index, field) {
              var
                $field     = $(field),
                type       = $field.prop('type'),
                name       = $field.prop('name'),
                value      = $field.val(),
                isCheckbox = $field.is(selector.checkbox),
                isRadio    = $field.is(selector.radio),
                isMultiple = (name.indexOf('[]') !== -1),
                isChecked  = (isCheckbox)
                  ? $field.is(':checked')
                  : false
              ;
              if(name) {
                if(isMultiple) {
                  name = name.replace('[]', '');
                  if(!values[name]) {
                    values[name] = [];
                  }
                  if(isCheckbox) {
                    if(isChecked) {
                      values[name].push(value || true);
                    }
                    else {
                      values[name].push(false);
                    }
                  }
                  else {
                    values[name].push(value);
                  }
                }
                else {
                  if(isRadio) {
                    if(values[name] === undefined || values[name] == false) {
                      values[name] = (isChecked)
                        ? value || true
                        : false
                      ;
                    }
                  }
                  else if(isCheckbox) {
                    if(isChecked) {
                      values[name] = value || true;
                    }
                    else {
                      values[name] = false;
                    }
                  }
                  else {
                    values[name] = value;
                  }
                }
              }
            });
            return values;
          }
        },

        has: {

          field: function(identifier) {
            module.verbose('Checking for existence of a field with identifier', identifier);
            identifier = module.escape.string(identifier);
            if(typeof identifier !== 'string') {
              module.error(error.identifier, identifier);
            }
            if($field.filter('#' + identifier).length > 0 ) {
              return true;
            }
            else if( $field.filter('[name="' + identifier +'"]').length > 0 ) {
              return true;
            }
            else if( $field.filter('[data-' + metadata.validate + '="'+ identifier +'"]').length > 0 ) {
              return true;
            }
            return false;
          }

        },

        escape: {
          string: function(text) {
            text =  String(text);
            return text.replace(regExp.escape, '\\$&');
          }
        },

        add: {
          // alias
          rule: function(name, rules) {
            module.add.field(name, rules);
          },
          field: function(name, rules) {
            var
              newValidation = {}
            ;
            if(module.is.shorthandRules(rules)) {
              rules = $.isArray(rules)
                ? rules
                : [rules]
              ;
              newValidation[name] = {
                rules: []
              };
              $.each(rules, function(index, rule) {
                newValidation[name].rules.push({ type: rule });
              });
            }
            else {
              newValidation[name] = rules;
            }
            validation = $.extend({}, validation, newValidation);
            module.debug('Adding rules', newValidation, validation);
          },
          fields: function(fields) {
            var
              newValidation
            ;
            if(fields && module.is.shorthandFields(fields)) {
              newValidation = module.get.fieldsFromShorthand(fields);
            }
            else {
              newValidation = fields;
            }
            validation = $.extend({}, validation, newValidation);
          },
          prompt: function(identifier, errors) {
            var
              $field       = module.get.field(identifier),
              $fieldGroup  = $field.closest($group),
              $prompt      = $fieldGroup.children(selector.prompt),
              promptExists = ($prompt.length !== 0)
            ;
            errors = (typeof errors == 'string')
              ? [errors]
              : errors
            ;
            module.verbose('Adding field error state', identifier);
            $fieldGroup
              .addClass(className.error)
            ;
            if(settings.inline) {
              if(!promptExists) {
                $prompt = settings.templates.prompt(errors);
                $prompt
                  .appendTo($fieldGroup)
                ;
              }
              $prompt
                .html(errors[0])
              ;
              if(!promptExists) {
                if(settings.transition && $.fn.transition !== undefined && $module.transition('is supported')) {
                  module.verbose('Displaying error with css transition', settings.transition);
                  $prompt.transition(settings.transition + ' in', settings.duration);
                }
                else {
                  module.verbose('Displaying error with fallback javascript animation');
                  $prompt
                    .fadeIn(settings.duration)
                  ;
                }
              }
              else {
                module.verbose('Inline errors are disabled, no inline error added', identifier);
              }
            }
          },
          errors: function(errors) {
            module.debug('Adding form error messages', errors);
            module.set.error();
            $message
              .html( settings.templates.error(errors) )
            ;
          }
        },

        remove: {
          rule: function(field, rule) {
            var
              rules = $.isArray(rule)
                ? rule
                : [rule]
            ;
            if(rule == undefined) {
              module.debug('Removed all rules');
              validation[field].rules = [];
              return;
            }
            if(validation[field] == undefined || !$.isArray(validation[field].rules)) {
              return;
            }
            $.each(validation[field].rules, function(index, rule) {
              if(rules.indexOf(rule.type) !== -1) {
                module.debug('Removed rule', rule.type);
                validation[field].rules.splice(index, 1);
              }
            });
          },
          field: function(field) {
            var
              fields = $.isArray(field)
                ? field
                : [field]
            ;
            $.each(fields, function(index, field) {
              module.remove.rule(field);
            });
          },
          // alias
          rules: function(field, rules) {
            if($.isArray(field)) {
              $.each(fields, function(index, field) {
                module.remove.rule(field, rules);
              });
            }
            else {
              module.remove.rule(field, rules);
            }
          },
          fields: function(fields) {
            module.remove.field(fields);
          },
          prompt: function(identifier) {
            var
              $field      = module.get.field(identifier),
              $fieldGroup = $field.closest($group),
              $prompt     = $fieldGroup.children(selector.prompt)
            ;
            $fieldGroup
              .removeClass(className.error)
            ;
            if(settings.inline && $prompt.is(':visible')) {
              module.verbose('Removing prompt for field', identifier);
              if(settings.transition && $.fn.transition !== undefined && $module.transition('is supported')) {
                $prompt.transition(settings.transition + ' out', settings.duration, function() {
                  $prompt.remove();
                });
              }
              else {
                $prompt
                  .fadeOut(settings.duration, function(){
                    $prompt.remove();
                  })
                ;
              }
            }
          }
        },

        set: {
          success: function() {
            $module
              .removeClass(className.error)
              .addClass(className.success)
            ;
          },
          defaults: function () {
            $field
              .each(function () {
                var
                  $field     = $(this),
                  isCheckbox = ($field.filter(selector.checkbox).length > 0),
                  value      = (isCheckbox)
                    ? $field.is(':checked')
                    : $field.val()
                ;
                $field.data(metadata.defaultValue, value);
              })
            ;
          },
          error: function() {
            $module
              .removeClass(className.success)
              .addClass(className.error)
            ;
          },
          value: function (field, value) {
            var
              fields = {}
            ;
            fields[field] = value;
            return module.set.values.call(element, fields);
          },
          values: function (fields) {
            if($.isEmptyObject(fields)) {
              return;
            }
            $.each(fields, function(key, value) {
              var
                $field      = module.get.field(key),
                $element    = $field.parent(),
                isMultiple  = $.isArray(value),
                isCheckbox  = $element.is(selector.uiCheckbox),
                isDropdown  = $element.is(selector.uiDropdown),
                isRadio     = ($field.is(selector.radio) && isCheckbox),
                fieldExists = ($field.length > 0),
                $multipleField
              ;
              if(fieldExists) {
                if(isMultiple && isCheckbox) {
                  module.verbose('Selecting multiple', value, $field);
                  $element.checkbox('uncheck');
                  $.each(value, function(index, value) {
                    $multipleField = $field.filter('[value="' + value + '"]');
                    $element       = $multipleField.parent();
                    if($multipleField.length > 0) {
                      $element.checkbox('check');
                    }
                  });
                }
                else if(isRadio) {
                  module.verbose('Selecting radio value', value, $field);
                  $field.filter('[value="' + value + '"]')
                    .parent(selector.uiCheckbox)
                      .checkbox('check')
                  ;
                }
                else if(isCheckbox) {
                  module.verbose('Setting checkbox value', value, $element);
                  if(value === true) {
                    $element.checkbox('check');
                  }
                  else {
                    $element.checkbox('uncheck');
                  }
                }
                else if(isDropdown) {
                  module.verbose('Setting dropdown value', value, $element);
                  $element.dropdown('set selected', value);
                }
                else {
                  module.verbose('Setting field value', value, $field);
                  $field.val(value);
                }
              }
            });
          }
        },

        validate: {

          form: function(event, ignoreCallbacks) {
            var
              values = module.get.values(),
              apiRequest
            ;

            // input keydown event will fire submit repeatedly by browser default
            if(keyHeldDown) {
              return false;
            }

            // reset errors
            formErrors = [];
            if( module.determine.isValid() ) {
              module.debug('Form has no validation errors, submitting');
              module.set.success();
              if(ignoreCallbacks !== true) {
                return settings.onSuccess.call(element, event, values);
              }
            }
            else {
              module.debug('Form has errors');
              module.set.error();
              if(!settings.inline) {
                module.add.errors(formErrors);
              }
              // prevent ajax submit
              if($module.data('moduleApi') !== undefined) {
                event.stopImmediatePropagation();
              }
              if(ignoreCallbacks !== true) {
                return settings.onFailure.call(element, formErrors, values);
              }
            }
          },

          // takes a validation object and returns whether field passes validation
          field: function(field, fieldName, showErrors) {
            showErrors = (showErrors !== undefined)
              ? showErrors
              : true
            ;
            if(typeof field == 'string') {
              module.verbose('Validating field', field);
              fieldName = field;
              field     = validation[field];
            }
            var
              identifier    = field.identifier || fieldName,
              $field        = module.get.field(identifier),
              $dependsField = (field.depends)
                ? module.get.field(field.depends)
                : false,
              fieldValid  = true,
              fieldErrors = []
            ;
            if(!field.identifier) {
              module.debug('Using field name as identifier', identifier);
              field.identifier = identifier;
            }
            if($field.prop('disabled')) {
              module.debug('Field is disabled. Skipping', identifier);
              fieldValid = true;
            }
            else if(field.optional && module.is.blank($field)){
              module.debug('Field is optional and blank. Skipping', identifier);
              fieldValid = true;
            }
            else if(field.depends && module.is.empty($dependsField)) {
              module.debug('Field depends on another value that is not present or empty. Skipping', $dependsField);
              fieldValid = true;
            }
            else if(field.rules !== undefined) {
              $.each(field.rules, function(index, rule) {
                if( module.has.field(identifier) && !( module.validate.rule(field, rule) ) ) {
                  module.debug('Field is invalid', identifier, rule.type);
                  fieldErrors.push(module.get.prompt(rule, field));
                  fieldValid = false;
                }
              });
            }
            if(fieldValid) {
              if(showErrors) {
                module.remove.prompt(identifier, fieldErrors);
                settings.onValid.call($field);
              }
            }
            else {
              if(showErrors) {
                formErrors = formErrors.concat(fieldErrors);
                module.add.prompt(identifier, fieldErrors);
                settings.onInvalid.call($field, fieldErrors);
              }
              return false;
            }
            return true;
          },

          // takes validation rule and returns whether field passes rule
          rule: function(field, rule) {
            var
              $field       = module.get.field(field.identifier),
              type         = rule.type,
              value        = $field.val(),
              isValid      = true,
              ancillary    = module.get.ancillaryValue(rule),
              ruleName     = module.get.ruleName(rule),
              ruleFunction = settings.rules[ruleName]
            ;
            if( !$.isFunction(ruleFunction) ) {
              module.error(error.noRule, ruleName);
              return;
            }
            // cast to string avoiding encoding special values
            value = (value === undefined || value === '' || value === null)
              ? ''
              : $.trim(value + '')
            ;
            return ruleFunction.call($field, value, ancillary);
          }
        },

        setting: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            settings[name] = value;
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if($allModules.length > 1) {
              title += ' ' + '(' + $allModules.length + ')';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                return false;
              }
            });
          }
          if( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };
      module.initialize();
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.form.settings = {

  name              : 'Form',
  namespace         : 'form',

  debug             : false,
  verbose           : false,
  performance       : true,

  fields            : false,

  keyboardShortcuts : true,
  on                : 'submit',
  inline            : false,

  delay             : 200,
  revalidate        : true,

  transition        : 'scale',
  duration          : 200,

  onValid           : function() {},
  onInvalid         : function() {},
  onSuccess         : function() { return true; },
  onFailure         : function() { return false; },

  metadata : {
    defaultValue : 'default',
    validate     : 'validate'
  },

  regExp: {
    htmlID  : /^[a-zA-Z][\w:.-]*$/g,
    bracket : /\[(.*)\]/i,
    decimal : /^\d+\.?\d*$/,
    email   : /^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,
    escape  : /[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,
    flags   : /^\/(.*)\/(.*)?/,
    integer : /^\-?\d+$/,
    number  : /^\-?\d*(\.\d+)?$/,
    url     : /(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/i
  },

  text: {
    unspecifiedRule  : 'Please enter a valid value',
    unspecifiedField : 'This field'
  },

  prompt: {
    empty                : '{name} must have a value',
    checked              : '{name} must be checked',
    email                : '{name} must be a valid e-mail',
    url                  : '{name} must be a valid url',
    regExp               : '{name} is not formatted correctly',
    integer              : '{name} must be an integer',
    decimal              : '{name} must be a decimal number',
    number               : '{name} must be set to a number',
    is                   : '{name} must be "{ruleValue}"',
    isExactly            : '{name} must be exactly "{ruleValue}"',
    not                  : '{name} cannot be set to "{ruleValue}"',
    notExactly           : '{name} cannot be set to exactly "{ruleValue}"',
    contain              : '{name} must contain "{ruleValue}"',
    containExactly       : '{name} must contain exactly "{ruleValue}"',
    doesntContain        : '{name} cannot contain  "{ruleValue}"',
    doesntContainExactly : '{name} cannot contain exactly "{ruleValue}"',
    minLength            : '{name} must be at least {ruleValue} characters',
    length               : '{name} must be at least {ruleValue} characters',
    exactLength          : '{name} must be exactly {ruleValue} characters',
    maxLength            : '{name} cannot be longer than {ruleValue} characters',
    match                : '{name} must match {ruleValue} field',
    different            : '{name} must have a different value than {ruleValue} field',
    creditCard           : '{name} must be a valid credit card number',
    minCount             : '{name} must have at least {ruleValue} choices',
    exactCount           : '{name} must have exactly {ruleValue} choices',
    maxCount             : '{name} must have {ruleValue} or less choices'
  },

  selector : {
    checkbox   : 'input[type="checkbox"], input[type="radio"]',
    clear      : '.clear',
    field      : 'input, textarea, select',
    group      : '.field',
    input      : 'input',
    message    : '.error.message',
    prompt     : '.prompt.label',
    radio      : 'input[type="radio"]',
    reset      : '.reset:not([type="reset"])',
    submit     : '.submit:not([type="submit"])',
    uiCheckbox : '.ui.checkbox',
    uiDropdown : '.ui.dropdown'
  },

  className : {
    error   : 'error',
    label   : 'ui prompt label',
    pressed : 'down',
    success : 'success'
  },

  error: {
    identifier : 'You must specify a string identifier for each field',
    method     : 'The method you called is not defined.',
    noRule     : 'There is no rule matching the one you specified',
    oldSyntax  : 'Starting in 2.0 forms now only take a single settings object. Validation settings converted to new syntax automatically.'
  },

  templates: {

    // template that produces error message
    error: function(errors) {
      var
        html = '<ul class="list">'
      ;
      $.each(errors, function(index, value) {
        html += '<li>' + value + '</li>';
      });
      html += '</ul>';
      return $(html);
    },

    // template that produces label
    prompt: function(errors) {
      return $('<div/>')
        .addClass('ui basic red pointing prompt label')
        .html(errors[0])
      ;
    }
  },

  rules: {

    // is not empty or blank string
    empty: function(value) {
      return !(value === undefined || '' === value || $.isArray(value) && value.length === 0);
    },

    // checkbox checked
    checked: function() {
      return ($(this).filter(':checked').length > 0);
    },

    // is most likely an email
    email: function(value){
      return $.fn.form.settings.regExp.email.test(value);
    },

    // value is most likely url
    url: function(value) {
      return $.fn.form.settings.regExp.url.test(value);
    },

    // matches specified regExp
    regExp: function(value, regExp) {
      if(regExp instanceof RegExp) {
        return value.match(regExp);
      }
      var
        regExpParts = regExp.match($.fn.form.settings.regExp.flags),
        flags
      ;
      // regular expression specified as /baz/gi (flags)
      if(regExpParts) {
        regExp = (regExpParts.length >= 2)
          ? regExpParts[1]
          : regExp
        ;
        flags = (regExpParts.length >= 3)
          ? regExpParts[2]
          : ''
        ;
      }
      return value.match( new RegExp(regExp, flags) );
    },

    // is valid integer or matches range
    integer: function(value, range) {
      var
        intRegExp = $.fn.form.settings.regExp.integer,
        min,
        max,
        parts
      ;
      if( !range || ['', '..'].indexOf(range) !== -1) {
        // do nothing
      }
      else if(range.indexOf('..') == -1) {
        if(intRegExp.test(range)) {
          min = max = range - 0;
        }
      }
      else {
        parts = range.split('..', 2);
        if(intRegExp.test(parts[0])) {
          min = parts[0] - 0;
        }
        if(intRegExp.test(parts[1])) {
          max = parts[1] - 0;
        }
      }
      return (
        intRegExp.test(value) &&
        (min === undefined || value >= min) &&
        (max === undefined || value <= max)
      );
    },

    // is valid number (with decimal)
    decimal: function(value) {
      return $.fn.form.settings.regExp.decimal.test(value);
    },

    // is valid number
    number: function(value) {
      return $.fn.form.settings.regExp.number.test(value);
    },

    // is value (case insensitive)
    is: function(value, text) {
      text = (typeof text == 'string')
        ? text.toLowerCase()
        : text
      ;
      value = (typeof value == 'string')
        ? value.toLowerCase()
        : value
      ;
      return (value == text);
    },

    // is value
    isExactly: function(value, text) {
      return (value == text);
    },

    // value is not another value (case insensitive)
    not: function(value, notValue) {
      value = (typeof value == 'string')
        ? value.toLowerCase()
        : value
      ;
      notValue = (typeof notValue == 'string')
        ? notValue.toLowerCase()
        : notValue
      ;
      return (value != notValue);
    },

    // value is not another value (case sensitive)
    notExactly: function(value, notValue) {
      return (value != notValue);
    },

    // value contains text (insensitive)
    contains: function(value, text) {
      // escape regex characters
      text = text.replace($.fn.form.settings.regExp.escape, "\\$&");
      return (value.search( new RegExp(text, 'i') ) !== -1);
    },

    // value contains text (case sensitive)
    containsExactly: function(value, text) {
      // escape regex characters
      text = text.replace($.fn.form.settings.regExp.escape, "\\$&");
      return (value.search( new RegExp(text) ) !== -1);
    },

    // value contains text (insensitive)
    doesntContain: function(value, text) {
      // escape regex characters
      text = text.replace($.fn.form.settings.regExp.escape, "\\$&");
      return (value.search( new RegExp(text, 'i') ) === -1);
    },

    // value contains text (case sensitive)
    doesntContainExactly: function(value, text) {
      // escape regex characters
      text = text.replace($.fn.form.settings.regExp.escape, "\\$&");
      return (value.search( new RegExp(text) ) === -1);
    },

    // is at least string length
    minLength: function(value, requiredLength) {
      return (value !== undefined)
        ? (value.length >= requiredLength)
        : false
      ;
    },

    // see rls notes for 2.0.6 (this is a duplicate of minLength)
    length: function(value, requiredLength) {
      return (value !== undefined)
        ? (value.length >= requiredLength)
        : false
      ;
    },

    // is exactly length
    exactLength: function(value, requiredLength) {
      return (value !== undefined)
        ? (value.length == requiredLength)
        : false
      ;
    },

    // is less than length
    maxLength: function(value, maxLength) {
      return (value !== undefined)
        ? (value.length <= maxLength)
        : false
      ;
    },

    // matches another field
    match: function(value, identifier) {
      var
        $form = $(this),
        matchingValue
      ;
      if( $('[data-validate="'+ identifier +'"]').length > 0 ) {
        matchingValue = $('[data-validate="'+ identifier +'"]').val();
      }
      else if($('#' + identifier).length > 0) {
        matchingValue = $('#' + identifier).val();
      }
      else if($('[name="' + identifier +'"]').length > 0) {
        matchingValue = $('[name="' + identifier + '"]').val();
      }
      else if( $('[name="' + identifier +'[]"]').length > 0 ) {
        matchingValue = $('[name="' + identifier +'[]"]');
      }
      return (matchingValue !== undefined)
        ? ( value.toString() == matchingValue.toString() )
        : false
      ;
    },

    // different than another field
    different: function(value, identifier) {
      // use either id or name of field
      var
        $form = $(this),
        matchingValue
      ;
      if( $('[data-validate="'+ identifier +'"]').length > 0 ) {
        matchingValue = $('[data-validate="'+ identifier +'"]').val();
      }
      else if($('#' + identifier).length > 0) {
        matchingValue = $('#' + identifier).val();
      }
      else if($('[name="' + identifier +'"]').length > 0) {
        matchingValue = $('[name="' + identifier + '"]').val();
      }
      else if( $('[name="' + identifier +'[]"]').length > 0 ) {
        matchingValue = $('[name="' + identifier +'[]"]');
      }
      return (matchingValue !== undefined)
        ? ( value.toString() !== matchingValue.toString() )
        : false
      ;
    },

    creditCard: function(cardNumber, cardTypes) {
      var
        cards = {
          visa: {
            pattern : /^4/,
            length  : [16]
          },
          amex: {
            pattern : /^3[47]/,
            length  : [15]
          },
          mastercard: {
            pattern : /^5[1-5]/,
            length  : [16]
          },
          discover: {
            pattern : /^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,
            length  : [16]
          },
          unionPay: {
            pattern : /^(62|88)/,
            length  : [16, 17, 18, 19]
          },
          jcb: {
            pattern : /^35(2[89]|[3-8][0-9])/,
            length  : [16]
          },
          maestro: {
            pattern : /^(5018|5020|5038|6304|6759|676[1-3])/,
            length  : [12, 13, 14, 15, 16, 17, 18, 19]
          },
          dinersClub: {
            pattern : /^(30[0-5]|^36)/,
            length  : [14]
          },
          laser: {
            pattern : /^(6304|670[69]|6771)/,
            length  : [16, 17, 18, 19]
          },
          visaElectron: {
            pattern : /^(4026|417500|4508|4844|491(3|7))/,
            length  : [16]
          }
        },
        valid         = {},
        validCard     = false,
        requiredTypes = (typeof cardTypes == 'string')
          ? cardTypes.split(',')
          : false,
        unionPay,
        validation
      ;

      if(typeof cardNumber !== 'string' || cardNumber.length === 0) {
        return;
      }

      // allow dashes in card
      cardNumber = cardNumber.replace(/[\-]/g, '');

      // verify card types
      if(requiredTypes) {
        $.each(requiredTypes, function(index, type){
          // verify each card type
          validation = cards[type];
          if(validation) {
            valid = {
              length  : ($.inArray(cardNumber.length, validation.length) !== -1),
              pattern : (cardNumber.search(validation.pattern) !== -1)
            };
            if(valid.length && valid.pattern) {
              validCard = true;
            }
          }
        });

        if(!validCard) {
          return false;
        }
      }

      // skip luhn for UnionPay
      unionPay = {
        number  : ($.inArray(cardNumber.length, cards.unionPay.length) !== -1),
        pattern : (cardNumber.search(cards.unionPay.pattern) !== -1)
      };
      if(unionPay.number && unionPay.pattern) {
        return true;
      }

      // verify luhn, adapted from  <https://gist.github.com/2134376>
      var
        length        = cardNumber.length,
        multiple      = 0,
        producedValue = [
          [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
          [0, 2, 4, 6, 8, 1, 3, 5, 7, 9]
        ],
        sum           = 0
      ;
      while (length--) {
        sum += producedValue[multiple][parseInt(cardNumber.charAt(length), 10)];
        multiple ^= 1;
      }
      return (sum % 10 === 0 && sum > 0);
    },

    minCount: function(value, minCount) {
      if(minCount == 0) {
        return true;
      }
      if(minCount == 1) {
        return (value !== '');
      }
      return (value.split(',').length >= minCount);
    },

    exactCount: function(value, exactCount) {
      if(exactCount == 0) {
        return (value === '');
      }
      if(exactCount == 1) {
        return (value !== '' && value.search(',') === -1);
      }
      return (value.split(',').length == exactCount);
    },

    maxCount: function(value, maxCount) {
      if(maxCount == 0) {
        return false;
      }
      if(maxCount == 1) {
        return (value.search(',') === -1);
      }
      return (value.split(',').length <= maxCount);
    }
  }

};

})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Accordion
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.accordion = function(parameters) {
  var
    $allModules     = $(this),

    time            = new Date().getTime(),
    performance     = [],

    query           = arguments[0],
    methodInvoked   = (typeof query == 'string'),
    queryArguments  = [].slice.call(arguments, 1),

    requestAnimationFrame = window.requestAnimationFrame
      || window.mozRequestAnimationFrame
      || window.webkitRequestAnimationFrame
      || window.msRequestAnimationFrame
      || function(callback) { setTimeout(callback, 0); },

    returnedValue
  ;
  $allModules
    .each(function() {
      var
        settings        = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.accordion.settings, parameters)
          : $.extend({}, $.fn.accordion.settings),

        className       = settings.className,
        namespace       = settings.namespace,
        selector        = settings.selector,
        error           = settings.error,

        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,
        moduleSelector  = $allModules.selector || '',

        $module  = $(this),
        $title   = $module.find(selector.title),
        $content = $module.find(selector.content),

        element  = this,
        instance = $module.data(moduleNamespace),
        observer,
        module
      ;

      module = {

        initialize: function() {
          module.debug('Initializing', $module);
          module.bind.events();
          if(settings.observeChanges) {
            module.observeChanges();
          }
          module.instantiate();
        },

        instantiate: function() {
          instance = module;
          $module
            .data(moduleNamespace, module)
          ;
        },

        destroy: function() {
          module.debug('Destroying previous instance', $module);
          $module
            .off(eventNamespace)
            .removeData(moduleNamespace)
          ;
        },

        refresh: function() {
          $title   = $module.find(selector.title);
          $content = $module.find(selector.content);
        },

        observeChanges: function() {
          if('MutationObserver' in window) {
            observer = new MutationObserver(function(mutations) {
              module.debug('DOM tree modified, updating selector cache');
              module.refresh();
            });
            observer.observe(element, {
              childList : true,
              subtree   : true
            });
            module.debug('Setting up mutation observer', observer);
          }
        },

        bind: {
          events: function() {
            module.debug('Binding delegated events');
            $module
              .on(settings.on + eventNamespace, selector.trigger, module.event.click)
            ;
          }
        },

        event: {
          click: function() {
            module.toggle.call(this);
          }
        },

        toggle: function(query) {
          var
            $activeTitle = (query !== undefined)
              ? (typeof query === 'number')
                ? $title.eq(query)
                : $(query).closest(selector.title)
              : $(this).closest(selector.title),
            $activeContent = $activeTitle.next($content),
            isAnimating = $activeContent.hasClass(className.animating),
            isActive    = $activeContent.hasClass(className.active),
            isOpen      = (isActive && !isAnimating),
            isOpening   = (!isActive && isAnimating)
          ;
          module.debug('Toggling visibility of content', $activeTitle);
          if(isOpen || isOpening) {
            if(settings.collapsible) {
              module.close.call($activeTitle);
            }
            else {
              module.debug('Cannot close accordion content collapsing is disabled');
            }
          }
          else {
            module.open.call($activeTitle);
          }
        },

        open: function(query) {
          var
            $activeTitle = (query !== undefined)
              ? (typeof query === 'number')
                ? $title.eq(query)
                : $(query).closest(selector.title)
              : $(this).closest(selector.title),
            $activeContent = $activeTitle.next($content),
            isAnimating = $activeContent.hasClass(className.animating),
            isActive    = $activeContent.hasClass(className.active),
            isOpen      = (isActive || isAnimating)
          ;
          if(isOpen) {
            module.debug('Accordion already open, skipping', $activeContent);
            return;
          }
          module.debug('Opening accordion content', $activeTitle);
          settings.onOpening.call($activeContent);
          settings.onChanging.call($activeContent);
          if(settings.exclusive) {
            module.closeOthers.call($activeTitle);
          }
          $activeTitle
            .addClass(className.active)
          ;
          $activeContent
            .stop(true, true)
            .addClass(className.animating)
          ;
          if(settings.animateChildren) {
            if($.fn.transition !== undefined && $module.transition('is supported')) {
              $activeContent
                .children()
                  .transition({
                    animation   : 'fade in',
                    queue       : false,
                    useFailSafe : true,
                    debug       : settings.debug,
                    verbose     : settings.verbose,
                    duration    : settings.duration
                  })
              ;
            }
            else {
              $activeContent
                .children()
                  .stop(true, true)
                  .animate({
                    opacity: 1
                  }, settings.duration, module.resetOpacity)
              ;
            }
          }
          $activeContent
            .slideDown(settings.duration, settings.easing, function() {
              $activeContent
                .removeClass(className.animating)
                .addClass(className.active)
              ;
              module.reset.display.call(this);
              settings.onOpen.call(this);
              settings.onChange.call(this);
            })
          ;
        },

        close: function(query) {
          var
            $activeTitle = (query !== undefined)
              ? (typeof query === 'number')
                ? $title.eq(query)
                : $(query).closest(selector.title)
              : $(this).closest(selector.title),
            $activeContent = $activeTitle.next($content),
            isAnimating    = $activeContent.hasClass(className.animating),
            isActive       = $activeContent.hasClass(className.active),
            isOpening      = (!isActive && isAnimating),
            isClosing      = (isActive && isAnimating)
          ;
          if((isActive || isOpening) && !isClosing) {
            module.debug('Closing accordion content', $activeContent);
            settings.onClosing.call($activeContent);
            settings.onChanging.call($activeContent);
            $activeTitle
              .removeClass(className.active)
            ;
            $activeContent
              .stop(true, true)
              .addClass(className.animating)
            ;
            if(settings.animateChildren) {
              if($.fn.transition !== undefined && $module.transition('is supported')) {
                $activeContent
                  .children()
                    .transition({
                      animation   : 'fade out',
                      queue       : false,
                      useFailSafe : true,
                      debug       : settings.debug,
                      verbose     : settings.verbose,
                      duration    : settings.duration
                    })
                ;
              }
              else {
                $activeContent
                  .children()
                    .stop(true, true)
                    .animate({
                      opacity: 0
                    }, settings.duration, module.resetOpacity)
                ;
              }
            }
            $activeContent
              .slideUp(settings.duration, settings.easing, function() {
                $activeContent
                  .removeClass(className.animating)
                  .removeClass(className.active)
                ;
                module.reset.display.call(this);
                settings.onClose.call(this);
                settings.onChange.call(this);
              })
            ;
          }
        },

        closeOthers: function(index) {
          var
            $activeTitle = (index !== undefined)
              ? $title.eq(index)
              : $(this).closest(selector.title),
            $parentTitles    = $activeTitle.parents(selector.content).prev(selector.title),
            $activeAccordion = $activeTitle.closest(selector.accordion),
            activeSelector   = selector.title + '.' + className.active + ':visible',
            activeContent    = selector.content + '.' + className.active + ':visible',
            $openTitles,
            $nestedTitles,
            $openContents
          ;
          if(settings.closeNested) {
            $openTitles   = $activeAccordion.find(activeSelector).not($parentTitles);
            $openContents = $openTitles.next($content);
          }
          else {
            $openTitles   = $activeAccordion.find(activeSelector).not($parentTitles);
            $nestedTitles = $activeAccordion.find(activeContent).find(activeSelector).not($parentTitles);
            $openTitles   = $openTitles.not($nestedTitles);
            $openContents = $openTitles.next($content);
          }
          if( ($openTitles.length > 0) ) {
            module.debug('Exclusive enabled, closing other content', $openTitles);
            $openTitles
              .removeClass(className.active)
            ;
            $openContents
              .removeClass(className.animating)
              .stop(true, true)
            ;
            if(settings.animateChildren) {
              if($.fn.transition !== undefined && $module.transition('is supported')) {
                $openContents
                  .children()
                    .transition({
                      animation   : 'fade out',
                      useFailSafe : true,
                      debug       : settings.debug,
                      verbose     : settings.verbose,
                      duration    : settings.duration
                    })
                ;
              }
              else {
                $openContents
                  .children()
                    .stop(true, true)
                    .animate({
                      opacity: 0
                    }, settings.duration, module.resetOpacity)
                ;
              }
            }
            $openContents
              .slideUp(settings.duration , settings.easing, function() {
                $(this).removeClass(className.active);
                module.reset.display.call(this);
              })
            ;
          }
        },

        reset: {

          display: function() {
            module.verbose('Removing inline display from element', this);
            $(this).css('display', '');
            if( $(this).attr('style') === '') {
              $(this)
                .attr('style', '')
                .removeAttr('style')
              ;
            }
          },

          opacity: function() {
            module.verbose('Removing inline opacity from element', this);
            $(this).css('opacity', '');
            if( $(this).attr('style') === '') {
              $(this)
                .attr('style', '')
                .removeAttr('style')
              ;
            }
          },

        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          module.debug('Changing internal', name, value);
          if(value !== undefined) {
            if( $.isPlainObject(name) ) {
              $.extend(true, module, name);
            }
            else {
              module[name] = value;
            }
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                module.error(error.method, query);
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };
      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;
  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.accordion.settings = {

  name            : 'Accordion',
  namespace       : 'accordion',

  silent          : false,
  debug           : false,
  verbose         : false,
  performance     : true,

  on              : 'click', // event on title that opens accordion

  observeChanges  : true,  // whether accordion should automatically refresh on DOM insertion

  exclusive       : true,  // whether a single accordion content panel should be open at once
  collapsible     : true,  // whether accordion content can be closed
  closeNested     : false, // whether nested content should be closed when a panel is closed
  animateChildren : true,  // whether children opacity should be animated

  duration        : 350, // duration of animation
  easing          : 'easeOutQuad', // easing equation for animation

  onOpening       : function(){}, // callback before open animation
  onClosing       : function(){}, // callback before closing animation
  onChanging      : function(){}, // callback before closing or opening animation

  onOpen          : function(){}, // callback after open animation
  onClose         : function(){}, // callback after closing animation
  onChange        : function(){}, // callback after closing or opening animation

  error: {
    method : 'The method you called is not defined'
  },

  className   : {
    active    : 'active',
    animating : 'animating'
  },

  selector    : {
    accordion : '.accordion',
    title     : '.title',
    trigger   : '.title',
    content   : '.content'
  }

};

// Adds easing
$.extend( $.easing, {
  easeOutQuad: function (x, t, b, c, d) {
    return -c *(t/=d)*(t-2) + b;
  }
});

})( jQuery, window, document );


/*!
 * # Semantic UI 2.4.0 - Checkbox
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.checkbox = function(parameters) {
  var
    $allModules    = $(this),
    moduleSelector = $allModules.selector || '',

    time           = new Date().getTime(),
    performance    = [],

    query          = arguments[0],
    methodInvoked  = (typeof query == 'string'),
    queryArguments = [].slice.call(arguments, 1),
    returnedValue
  ;

  $allModules
    .each(function() {
      var
        settings        = $.extend(true, {}, $.fn.checkbox.settings, parameters),

        className       = settings.className,
        namespace       = settings.namespace,
        selector        = settings.selector,
        error           = settings.error,

        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,

        $module         = $(this),
        $label          = $(this).children(selector.label),
        $input          = $(this).children(selector.input),
        input           = $input[0],

        initialLoad     = false,
        shortcutPressed = false,
        instance        = $module.data(moduleNamespace),

        observer,
        element         = this,
        module
      ;

      module      = {

        initialize: function() {
          module.verbose('Initializing checkbox', settings);

          module.create.label();
          module.bind.events();

          module.set.tabbable();
          module.hide.input();

          module.observeChanges();
          module.instantiate();
          module.setup();
        },

        instantiate: function() {
          module.verbose('Storing instance of module', module);
          instance = module;
          $module
            .data(moduleNamespace, module)
          ;
        },

        destroy: function() {
          module.verbose('Destroying module');
          module.unbind.events();
          module.show.input();
          $module.removeData(moduleNamespace);
        },

        fix: {
          reference: function() {
            if( $module.is(selector.input) ) {
              module.debug('Behavior called on <input> adjusting invoked element');
              $module = $module.closest(selector.checkbox);
              module.refresh();
            }
          }
        },

        setup: function() {
          module.set.initialLoad();
          if( module.is.indeterminate() ) {
            module.debug('Initial value is indeterminate');
            module.indeterminate();
          }
          else if( module.is.checked() ) {
            module.debug('Initial value is checked');
            module.check();
          }
          else {
            module.debug('Initial value is unchecked');
            module.uncheck();
          }
          module.remove.initialLoad();
        },

        refresh: function() {
          $label = $module.children(selector.label);
          $input = $module.children(selector.input);
          input  = $input[0];
        },

        hide: {
          input: function() {
            module.verbose('Modifying <input> z-index to be unselectable');
            $input.addClass(className.hidden);
          }
        },
        show: {
          input: function() {
            module.verbose('Modifying <input> z-index to be selectable');
            $input.removeClass(className.hidden);
          }
        },

        observeChanges: function() {
          if('MutationObserver' in window) {
            observer = new MutationObserver(function(mutations) {
              module.debug('DOM tree modified, updating selector cache');
              module.refresh();
            });
            observer.observe(element, {
              childList : true,
              subtree   : true
            });
            module.debug('Setting up mutation observer', observer);
          }
        },

        attachEvents: function(selector, event) {
          var
            $element = $(selector)
          ;
          event = $.isFunction(module[event])
            ? module[event]
            : module.toggle
          ;
          if($element.length > 0) {
            module.debug('Attaching checkbox events to element', selector, event);
            $element
              .on('click' + eventNamespace, event)
            ;
          }
          else {
            module.error(error.notFound);
          }
        },

        event: {
          click: function(event) {
            var
              $target = $(event.target)
            ;
            if( $target.is(selector.input) ) {
              module.verbose('Using default check action on initialized checkbox');
              return;
            }
            if( $target.is(selector.link) ) {
              module.debug('Clicking link inside checkbox, skipping toggle');
              return;
            }
            module.toggle();
            $input.focus();
            event.preventDefault();
          },
          keydown: function(event) {
            var
              key     = event.which,
              keyCode = {
                enter  : 13,
                space  : 32,
                escape : 27
              }
            ;
            if(key == keyCode.escape) {
              module.verbose('Escape key pressed blurring field');
              $input.blur();
              shortcutPressed = true;
            }
            else if(!event.ctrlKey && ( key == keyCode.space || key == keyCode.enter) ) {
              module.verbose('Enter/space key pressed, toggling checkbox');
              module.toggle();
              shortcutPressed = true;
            }
            else {
              shortcutPressed = false;
            }
          },
          keyup: function(event) {
            if(shortcutPressed) {
              event.preventDefault();
            }
          }
        },

        check: function() {
          if( !module.should.allowCheck() ) {
            return;
          }
          module.debug('Checking checkbox', $input);
          module.set.checked();
          if( !module.should.ignoreCallbacks() ) {
            settings.onChecked.call(input);
            settings.onChange.call(input);
          }
        },

        uncheck: function() {
          if( !module.should.allowUncheck() ) {
            return;
          }
          module.debug('Unchecking checkbox');
          module.set.unchecked();
          if( !module.should.ignoreCallbacks() ) {
            settings.onUnchecked.call(input);
            settings.onChange.call(input);
          }
        },

        indeterminate: function() {
          if( module.should.allowIndeterminate() ) {
            module.debug('Checkbox is already indeterminate');
            return;
          }
          module.debug('Making checkbox indeterminate');
          module.set.indeterminate();
          if( !module.should.ignoreCallbacks() ) {
            settings.onIndeterminate.call(input);
            settings.onChange.call(input);
          }
        },

        determinate: function() {
          if( module.should.allowDeterminate() ) {
            module.debug('Checkbox is already determinate');
            return;
          }
          module.debug('Making checkbox determinate');
          module.set.determinate();
          if( !module.should.ignoreCallbacks() ) {
            settings.onDeterminate.call(input);
            settings.onChange.call(input);
          }
        },

        enable: function() {
          if( module.is.enabled() ) {
            module.debug('Checkbox is already enabled');
            return;
          }
          module.debug('Enabling checkbox');
          module.set.enabled();
          settings.onEnable.call(input);
          // preserve legacy callbacks
          settings.onEnabled.call(input);
        },

        disable: function() {
          if( module.is.disabled() ) {
            module.debug('Checkbox is already disabled');
            return;
          }
          module.debug('Disabling checkbox');
          module.set.disabled();
          settings.onDisable.call(input);
          // preserve legacy callbacks
          settings.onDisabled.call(input);
        },

        get: {
          radios: function() {
            var
              name = module.get.name()
            ;
            return $('input[name="' + name + '"]').closest(selector.checkbox);
          },
          otherRadios: function() {
            return module.get.radios().not($module);
          },
          name: function() {
            return $input.attr('name');
          }
        },

        is: {
          initialLoad: function() {
            return initialLoad;
          },
          radio: function() {
            return ($input.hasClass(className.radio) || $input.attr('type') == 'radio');
          },
          indeterminate: function() {
            return $input.prop('indeterminate') !== undefined && $input.prop('indeterminate');
          },
          checked: function() {
            return $input.prop('checked') !== undefined && $input.prop('checked');
          },
          disabled: function() {
            return $input.prop('disabled') !== undefined && $input.prop('disabled');
          },
          enabled: function() {
            return !module.is.disabled();
          },
          determinate: function() {
            return !module.is.indeterminate();
          },
          unchecked: function() {
            return !module.is.checked();
          }
        },

        should: {
          allowCheck: function() {
            if(module.is.determinate() && module.is.checked() && !module.should.forceCallbacks() ) {
              module.debug('Should not allow check, checkbox is already checked');
              return false;
            }
            if(settings.beforeChecked.apply(input) === false) {
              module.debug('Should not allow check, beforeChecked cancelled');
              return false;
            }
            return true;
          },
          allowUncheck: function() {
            if(module.is.determinate() && module.is.unchecked() && !module.should.forceCallbacks() ) {
              module.debug('Should not allow uncheck, checkbox is already unchecked');
              return false;
            }
            if(settings.beforeUnchecked.apply(input) === false) {
              module.debug('Should not allow uncheck, beforeUnchecked cancelled');
              return false;
            }
            return true;
          },
          allowIndeterminate: function() {
            if(module.is.indeterminate() && !module.should.forceCallbacks() ) {
              module.debug('Should not allow indeterminate, checkbox is already indeterminate');
              return false;
            }
            if(settings.beforeIndeterminate.apply(input) === false) {
              module.debug('Should not allow indeterminate, beforeIndeterminate cancelled');
              return false;
            }
            return true;
          },
          allowDeterminate: function() {
            if(module.is.determinate() && !module.should.forceCallbacks() ) {
              module.debug('Should not allow determinate, checkbox is already determinate');
              return false;
            }
            if(settings.beforeDeterminate.apply(input) === false) {
              module.debug('Should not allow determinate, beforeDeterminate cancelled');
              return false;
            }
            return true;
          },
          forceCallbacks: function() {
            return (module.is.initialLoad() && settings.fireOnInit);
          },
          ignoreCallbacks: function() {
            return (initialLoad && !settings.fireOnInit);
          }
        },

        can: {
          change: function() {
            return !( $module.hasClass(className.disabled) || $module.hasClass(className.readOnly) || $input.prop('disabled') || $input.prop('readonly') );
          },
          uncheck: function() {
            return (typeof settings.uncheckable === 'boolean')
              ? settings.uncheckable
              : !module.is.radio()
            ;
          }
        },

        set: {
          initialLoad: function() {
            initialLoad = true;
          },
          checked: function() {
            module.verbose('Setting class to checked');
            $module
              .removeClass(className.indeterminate)
              .addClass(className.checked)
            ;
            if( module.is.radio() ) {
              module.uncheckOthers();
            }
            if(!module.is.indeterminate() && module.is.checked()) {
              module.debug('Input is already checked, skipping input property change');
              return;
            }
            module.verbose('Setting state to checked', input);
            $input
              .prop('indeterminate', false)
              .prop('checked', true)
            ;
            module.trigger.change();
          },
          unchecked: function() {
            module.verbose('Removing checked class');
            $module
              .removeClass(className.indeterminate)
              .removeClass(className.checked)
            ;
            if(!module.is.indeterminate() &&  module.is.unchecked() ) {
              module.debug('Input is already unchecked');
              return;
            }
            module.debug('Setting state to unchecked');
            $input
              .prop('indeterminate', false)
              .prop('checked', false)
            ;
            module.trigger.change();
          },
          indeterminate: function() {
            module.verbose('Setting class to indeterminate');
            $module
              .addClass(className.indeterminate)
            ;
            if( module.is.indeterminate() ) {
              module.debug('Input is already indeterminate, skipping input property change');
              return;
            }
            module.debug('Setting state to indeterminate');
            $input
              .prop('indeterminate', true)
            ;
            module.trigger.change();
          },
          determinate: function() {
            module.verbose('Removing indeterminate class');
            $module
              .removeClass(className.indeterminate)
            ;
            if( module.is.determinate() ) {
              module.debug('Input is already determinate, skipping input property change');
              return;
            }
            module.debug('Setting state to determinate');
            $input
              .prop('indeterminate', false)
            ;
          },
          disabled: function() {
            module.verbose('Setting class to disabled');
            $module
              .addClass(className.disabled)
            ;
            if( module.is.disabled() ) {
              module.debug('Input is already disabled, skipping input property change');
              return;
            }
            module.debug('Setting state to disabled');
            $input
              .prop('disabled', 'disabled')
            ;
            module.trigger.change();
          },
          enabled: function() {
            module.verbose('Removing disabled class');
            $module.removeClass(className.disabled);
            if( module.is.enabled() ) {
              module.debug('Input is already enabled, skipping input property change');
              return;
            }
            module.debug('Setting state to enabled');
            $input
              .prop('disabled', false)
            ;
            module.trigger.change();
          },
          tabbable: function() {
            module.verbose('Adding tabindex to checkbox');
            if( $input.attr('tabindex') === undefined) {
              $input.attr('tabindex', 0);
            }
          }
        },

        remove: {
          initialLoad: function() {
            initialLoad = false;
          }
        },

        trigger: {
          change: function() {
            var
              events       = document.createEvent('HTMLEvents'),
              inputElement = $input[0]
            ;
            if(inputElement) {
              module.verbose('Triggering native change event');
              events.initEvent('change', true, false);
              inputElement.dispatchEvent(events);
            }
          }
        },


        create: {
          label: function() {
            if($input.prevAll(selector.label).length > 0) {
              $input.prev(selector.label).detach().insertAfter($input);
              module.debug('Moving existing label', $label);
            }
            else if( !module.has.label() ) {
              $label = $('<label>').insertAfter($input);
              module.debug('Creating label', $label);
            }
          }
        },

        has: {
          label: function() {
            return ($label.length > 0);
          }
        },

        bind: {
          events: function() {
            module.verbose('Attaching checkbox events');
            $module
              .on('click'   + eventNamespace, module.event.click)
              .on('keydown' + eventNamespace, selector.input, module.event.keydown)
              .on('keyup'   + eventNamespace, selector.input, module.event.keyup)
            ;
          }
        },

        unbind: {
          events: function() {
            module.debug('Removing events');
            $module
              .off(eventNamespace)
            ;
          }
        },

        uncheckOthers: function() {
          var
            $radios = module.get.otherRadios()
          ;
          module.debug('Unchecking other radios', $radios);
          $radios.removeClass(className.checked);
        },

        toggle: function() {
          if( !module.can.change() ) {
            if(!module.is.radio()) {
              module.debug('Checkbox is read-only or disabled, ignoring toggle');
            }
            return;
          }
          if( module.is.indeterminate() || module.is.unchecked() ) {
            module.debug('Currently unchecked');
            module.check();
          }
          else if( module.is.checked() && module.can.uncheck() ) {
            module.debug('Currently checked');
            module.uncheck();
          }
        },
        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                module.error(error.method, query);
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.checkbox.settings = {

  name                : 'Checkbox',
  namespace           : 'checkbox',

  silent              : false,
  debug               : false,
  verbose             : true,
  performance         : true,

  // delegated event context
  uncheckable         : 'auto',
  fireOnInit          : false,

  onChange            : function(){},

  beforeChecked       : function(){},
  beforeUnchecked     : function(){},
  beforeDeterminate   : function(){},
  beforeIndeterminate : function(){},

  onChecked           : function(){},
  onUnchecked         : function(){},

  onDeterminate       : function() {},
  onIndeterminate     : function() {},

  onEnable            : function(){},
  onDisable           : function(){},

  // preserve misspelled callbacks (will be removed in 3.0)
  onEnabled           : function(){},
  onDisabled          : function(){},

  className       : {
    checked       : 'checked',
    indeterminate : 'indeterminate',
    disabled      : 'disabled',
    hidden        : 'hidden',
    radio         : 'radio',
    readOnly      : 'read-only'
  },

  error     : {
    method       : 'The method you called is not defined'
  },

  selector : {
    checkbox : '.ui.checkbox',
    label    : 'label, .box',
    input    : 'input[type="checkbox"], input[type="radio"]',
    link     : 'a[href]'
  }

};

})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Dimmer
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.dimmer = function(parameters) {
  var
    $allModules     = $(this),

    time            = new Date().getTime(),
    performance     = [],

    query           = arguments[0],
    methodInvoked   = (typeof query == 'string'),
    queryArguments  = [].slice.call(arguments, 1),

    returnedValue
  ;

  $allModules
    .each(function() {
      var
        settings        = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.dimmer.settings, parameters)
          : $.extend({}, $.fn.dimmer.settings),

        selector        = settings.selector,
        namespace       = settings.namespace,
        className       = settings.className,
        error           = settings.error,

        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,
        moduleSelector  = $allModules.selector || '',

        clickEvent      = ('ontouchstart' in document.documentElement)
          ? 'touchstart'
          : 'click',

        $module = $(this),
        $dimmer,
        $dimmable,

        element   = this,
        instance  = $module.data(moduleNamespace),
        module
      ;

      module = {

        preinitialize: function() {
          if( module.is.dimmer() ) {

            $dimmable = $module.parent();
            $dimmer   = $module;
          }
          else {
            $dimmable = $module;
            if( module.has.dimmer() ) {
              if(settings.dimmerName) {
                $dimmer = $dimmable.find(selector.dimmer).filter('.' + settings.dimmerName);
              }
              else {
                $dimmer = $dimmable.find(selector.dimmer);
              }
            }
            else {
              $dimmer = module.create();
            }
          }
        },

        initialize: function() {
          module.debug('Initializing dimmer', settings);

          module.bind.events();
          module.set.dimmable();
          module.instantiate();
        },

        instantiate: function() {
          module.verbose('Storing instance of module', module);
          instance = module;
          $module
            .data(moduleNamespace, instance)
          ;
        },

        destroy: function() {
          module.verbose('Destroying previous module', $dimmer);
          module.unbind.events();
          module.remove.variation();
          $dimmable
            .off(eventNamespace)
          ;
        },

        bind: {
          events: function() {
            if(settings.on == 'hover') {
              $dimmable
                .on('mouseenter' + eventNamespace, module.show)
                .on('mouseleave' + eventNamespace, module.hide)
              ;
            }
            else if(settings.on == 'click') {
              $dimmable
                .on(clickEvent + eventNamespace, module.toggle)
              ;
            }
            if( module.is.page() ) {
              module.debug('Setting as a page dimmer', $dimmable);
              module.set.pageDimmer();
            }

            if( module.is.closable() ) {
              module.verbose('Adding dimmer close event', $dimmer);
              $dimmable
                .on(clickEvent + eventNamespace, selector.dimmer, module.event.click)
              ;
            }
          }
        },

        unbind: {
          events: function() {
            $module
              .removeData(moduleNamespace)
            ;
            $dimmable
              .off(eventNamespace)
            ;
          }
        },

        event: {
          click: function(event) {
            module.verbose('Determining if event occured on dimmer', event);
            if( $dimmer.find(event.target).length === 0 || $(event.target).is(selector.content) ) {
              module.hide();
              event.stopImmediatePropagation();
            }
          },
        },

        addContent: function(element) {
          var
            $content = $(element)
          ;
          module.debug('Add content to dimmer', $content);
          if($content.parent()[0] !== $dimmer[0]) {
            $content.detach().appendTo($dimmer);
          }
        },

        create: function() {
          var
            $element = $( settings.template.dimmer() )
          ;
          if(settings.dimmerName) {
            module.debug('Creating named dimmer', settings.dimmerName);
            $element.addClass(settings.dimmerName);
          }
          $element
            .appendTo($dimmable)
          ;
          return $element;
        },

        show: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          module.debug('Showing dimmer', $dimmer, settings);
          module.set.variation();
          if( (!module.is.dimmed() || module.is.animating()) && module.is.enabled() ) {
            module.animate.show(callback);
            settings.onShow.call(element);
            settings.onChange.call(element);
          }
          else {
            module.debug('Dimmer is already shown or disabled');
          }
        },

        hide: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          if( module.is.dimmed() || module.is.animating() ) {
            module.debug('Hiding dimmer', $dimmer);
            module.animate.hide(callback);
            settings.onHide.call(element);
            settings.onChange.call(element);
          }
          else {
            module.debug('Dimmer is not visible');
          }
        },

        toggle: function() {
          module.verbose('Toggling dimmer visibility', $dimmer);
          if( !module.is.dimmed() ) {
            module.show();
          }
          else {
            module.hide();
          }
        },

        animate: {
          show: function(callback) {
            callback = $.isFunction(callback)
              ? callback
              : function(){}
            ;
            if(settings.useCSS && $.fn.transition !== undefined && $dimmer.transition('is supported')) {
              if(settings.useFlex) {
                module.debug('Using flex dimmer');
                module.remove.legacy();
              }
              else {
                module.debug('Using legacy non-flex dimmer');
                module.set.legacy();
              }
              if(settings.opacity !== 'auto') {
                module.set.opacity();
              }
              $dimmer
                .transition({
                  displayType : settings.useFlex
                    ? 'flex'
                    : 'block',
                  animation   : settings.transition + ' in',
                  queue       : false,
                  duration    : module.get.duration(),
                  useFailSafe : true,
                  onStart     : function() {
                    module.set.dimmed();
                  },
                  onComplete  : function() {
                    module.set.active();
                    callback();
                  }
                })
              ;
            }
            else {
              module.verbose('Showing dimmer animation with javascript');
              module.set.dimmed();
              if(settings.opacity == 'auto') {
                settings.opacity = 0.8;
              }
              $dimmer
                .stop()
                .css({
                  opacity : 0,
                  width   : '100%',
                  height  : '100%'
                })
                .fadeTo(module.get.duration(), settings.opacity, function() {
                  $dimmer.removeAttr('style');
                  module.set.active();
                  callback();
                })
              ;
            }
          },
          hide: function(callback) {
            callback = $.isFunction(callback)
              ? callback
              : function(){}
            ;
            if(settings.useCSS && $.fn.transition !== undefined && $dimmer.transition('is supported')) {
              module.verbose('Hiding dimmer with css');
              $dimmer
                .transition({
                  displayType : settings.useFlex
                    ? 'flex'
                    : 'block',
                  animation   : settings.transition + ' out',
                  queue       : false,
                  duration    : module.get.duration(),
                  useFailSafe : true,
                  onStart     : function() {
                    module.remove.dimmed();
                  },
                  onComplete  : function() {
                    module.remove.variation();
                    module.remove.active();
                    callback();
                  }
                })
              ;
            }
            else {
              module.verbose('Hiding dimmer with javascript');
              module.remove.dimmed();
              $dimmer
                .stop()
                .fadeOut(module.get.duration(), function() {
                  module.remove.active();
                  $dimmer.removeAttr('style');
                  callback();
                })
              ;
            }
          }
        },

        get: {
          dimmer: function() {
            return $dimmer;
          },
          duration: function() {
            if(typeof settings.duration == 'object') {
              if( module.is.active() ) {
                return settings.duration.hide;
              }
              else {
                return settings.duration.show;
              }
            }
            return settings.duration;
          }
        },

        has: {
          dimmer: function() {
            if(settings.dimmerName) {
              return ($module.find(selector.dimmer).filter('.' + settings.dimmerName).length > 0);
            }
            else {
              return ( $module.find(selector.dimmer).length > 0 );
            }
          }
        },

        is: {
          active: function() {
            return $dimmer.hasClass(className.active);
          },
          animating: function() {
            return ( $dimmer.is(':animated') || $dimmer.hasClass(className.animating) );
          },
          closable: function() {
            if(settings.closable == 'auto') {
              if(settings.on == 'hover') {
                return false;
              }
              return true;
            }
            return settings.closable;
          },
          dimmer: function() {
            return $module.hasClass(className.dimmer);
          },
          dimmable: function() {
            return $module.hasClass(className.dimmable);
          },
          dimmed: function() {
            return $dimmable.hasClass(className.dimmed);
          },
          disabled: function() {
            return $dimmable.hasClass(className.disabled);
          },
          enabled: function() {
            return !module.is.disabled();
          },
          page: function () {
            return $dimmable.is('body');
          },
          pageDimmer: function() {
            return $dimmer.hasClass(className.pageDimmer);
          }
        },

        can: {
          show: function() {
            return !$dimmer.hasClass(className.disabled);
          }
        },

        set: {
          opacity: function(opacity) {
            var
              color      = $dimmer.css('background-color'),
              colorArray = color.split(','),
              isRGB      = (colorArray && colorArray.length == 3),
              isRGBA     = (colorArray && colorArray.length == 4)
            ;
            opacity    = settings.opacity === 0 ? 0 : settings.opacity || opacity;
            if(isRGB || isRGBA) {
              colorArray[3] = opacity + ')';
              color         = colorArray.join(',');
            }
            else {
              color = 'rgba(0, 0, 0, ' + opacity + ')';
            }
            module.debug('Setting opacity to', opacity);
            $dimmer.css('background-color', color);
          },
          legacy: function() {
            $dimmer.addClass(className.legacy);
          },
          active: function() {
            $dimmer.addClass(className.active);
          },
          dimmable: function() {
            $dimmable.addClass(className.dimmable);
          },
          dimmed: function() {
            $dimmable.addClass(className.dimmed);
          },
          pageDimmer: function() {
            $dimmer.addClass(className.pageDimmer);
          },
          disabled: function() {
            $dimmer.addClass(className.disabled);
          },
          variation: function(variation) {
            variation = variation || settings.variation;
            if(variation) {
              $dimmer.addClass(variation);
            }
          }
        },

        remove: {
          active: function() {
            $dimmer
              .removeClass(className.active)
            ;
          },
          legacy: function() {
            $dimmer.removeClass(className.legacy);
          },
          dimmed: function() {
            $dimmable.removeClass(className.dimmed);
          },
          disabled: function() {
            $dimmer.removeClass(className.disabled);
          },
          variation: function(variation) {
            variation = variation || settings.variation;
            if(variation) {
              $dimmer.removeClass(variation);
            }
          }
        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if($allModules.length > 1) {
              title += ' ' + '(' + $allModules.length + ')';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                module.error(error.method, query);
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      module.preinitialize();

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.dimmer.settings = {

  name        : 'Dimmer',
  namespace   : 'dimmer',

  silent      : false,
  debug       : false,
  verbose     : false,
  performance : true,

  // whether should use flex layout
  useFlex     : true,

  // name to distinguish between multiple dimmers in context
  dimmerName  : false,

  // whether to add a variation type
  variation   : false,

  // whether to bind close events
  closable    : 'auto',

  // whether to use css animations
  useCSS      : true,

  // css animation to use
  transition  : 'fade',

  // event to bind to
  on          : false,

  // overriding opacity value
  opacity     : 'auto',

  // transition durations
  duration    : {
    show : 500,
    hide : 500
  },

  onChange    : function(){},
  onShow      : function(){},
  onHide      : function(){},

  error   : {
    method   : 'The method you called is not defined.'
  },

  className : {
    active     : 'active',
    animating  : 'animating',
    dimmable   : 'dimmable',
    dimmed     : 'dimmed',
    dimmer     : 'dimmer',
    disabled   : 'disabled',
    hide       : 'hide',
    legacy     : 'legacy',
    pageDimmer : 'page',
    show       : 'show'
  },

  selector: {
    dimmer   : '> .ui.dimmer',
    content  : '.ui.dimmer > .content, .ui.dimmer > .content > .center'
  },

  template: {
    dimmer: function() {
     return $('<div />').attr('class', 'ui dimmer');
    }
  }

};

})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Dropdown
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.dropdown = function(parameters) {
  var
    $allModules    = $(this),
    $document      = $(document),

    moduleSelector = $allModules.selector || '',

    hasTouch       = ('ontouchstart' in document.documentElement),
    time           = new Date().getTime(),
    performance    = [],

    query          = arguments[0],
    methodInvoked  = (typeof query == 'string'),
    queryArguments = [].slice.call(arguments, 1),
    returnedValue
  ;

  $allModules
    .each(function(elementIndex) {
      var
        settings          = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.dropdown.settings, parameters)
          : $.extend({}, $.fn.dropdown.settings),

        className       = settings.className,
        message         = settings.message,
        fields          = settings.fields,
        keys            = settings.keys,
        metadata        = settings.metadata,
        namespace       = settings.namespace,
        regExp          = settings.regExp,
        selector        = settings.selector,
        error           = settings.error,
        templates       = settings.templates,

        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,

        $module         = $(this),
        $context        = $(settings.context),
        $text           = $module.find(selector.text),
        $search         = $module.find(selector.search),
        $sizer          = $module.find(selector.sizer),
        $input          = $module.find(selector.input),
        $icon           = $module.find(selector.icon),

        $combo = ($module.prev().find(selector.text).length > 0)
          ? $module.prev().find(selector.text)
          : $module.prev(),

        $menu           = $module.children(selector.menu),
        $item           = $menu.find(selector.item),

        activated       = false,
        itemActivated   = false,
        internalChange  = false,
        element         = this,
        instance        = $module.data(moduleNamespace),

        initialLoad,
        pageLostFocus,
        willRefocus,
        elementNamespace,
        id,
        selectObserver,
        menuObserver,
        module
      ;

      module = {

        initialize: function() {
          module.debug('Initializing dropdown', settings);

          if( module.is.alreadySetup() ) {
            module.setup.reference();
          }
          else {

            module.setup.layout();

            if(settings.values) {
              module.change.values(settings.values);
            }

            module.refreshData();

            module.save.defaults();
            module.restore.selected();

            module.create.id();
            module.bind.events();

            module.observeChanges();
            module.instantiate();
          }

        },

        instantiate: function() {
          module.verbose('Storing instance of dropdown', module);
          instance = module;
          $module
            .data(moduleNamespace, module)
          ;
        },

        destroy: function() {
          module.verbose('Destroying previous dropdown', $module);
          module.remove.tabbable();
          $module
            .off(eventNamespace)
            .removeData(moduleNamespace)
          ;
          $menu
            .off(eventNamespace)
          ;
          $document
            .off(elementNamespace)
          ;
          module.disconnect.menuObserver();
          module.disconnect.selectObserver();
        },

        observeChanges: function() {
          if('MutationObserver' in window) {
            selectObserver = new MutationObserver(module.event.select.mutation);
            menuObserver   = new MutationObserver(module.event.menu.mutation);
            module.debug('Setting up mutation observer', selectObserver, menuObserver);
            module.observe.select();
            module.observe.menu();
          }
        },

        disconnect: {
          menuObserver: function() {
            if(menuObserver) {
              menuObserver.disconnect();
            }
          },
          selectObserver: function() {
            if(selectObserver) {
              selectObserver.disconnect();
            }
          }
        },
        observe: {
          select: function() {
            if(module.has.input()) {
              selectObserver.observe($module[0], {
                childList : true,
                subtree   : true
              });
            }
          },
          menu: function() {
            if(module.has.menu()) {
              menuObserver.observe($menu[0], {
                childList : true,
                subtree   : true
              });
            }
          }
        },

        create: {
          id: function() {
            id = (Math.random().toString(16) + '000000000').substr(2, 8);
            elementNamespace = '.' + id;
            module.verbose('Creating unique id for element', id);
          },
          userChoice: function(values) {
            var
              $userChoices,
              $userChoice,
              isUserValue,
              html
            ;
            values = values || module.get.userValues();
            if(!values) {
              return false;
            }
            values = $.isArray(values)
              ? values
              : [values]
            ;
            $.each(values, function(index, value) {
              if(module.get.item(value) === false) {
                html         = settings.templates.addition( module.add.variables(message.addResult, value) );
                $userChoice  = $('<div />')
                  .html(html)
                  .attr('data-' + metadata.value, value)
                  .attr('data-' + metadata.text, value)
                  .addClass(className.addition)
                  .addClass(className.item)
                ;
                if(settings.hideAdditions) {
                  $userChoice.addClass(className.hidden);
                }
                $userChoices = ($userChoices === undefined)
                  ? $userChoice
                  : $userChoices.add($userChoice)
                ;
                module.verbose('Creating user choices for value', value, $userChoice);
              }
            });
            return $userChoices;
          },
          userLabels: function(value) {
            var
              userValues = module.get.userValues()
            ;
            if(userValues) {
              module.debug('Adding user labels', userValues);
              $.each(userValues, function(index, value) {
                module.verbose('Adding custom user value');
                module.add.label(value, value);
              });
            }
          },
          menu: function() {
            $menu = $('<div />')
              .addClass(className.menu)
              .appendTo($module)
            ;
          },
          sizer: function() {
            $sizer = $('<span />')
              .addClass(className.sizer)
              .insertAfter($search)
            ;
          }
        },

        search: function(query) {
          query = (query !== undefined)
            ? query
            : module.get.query()
          ;
          module.verbose('Searching for query', query);
          if(module.has.minCharacters(query)) {
            module.filter(query);
          }
          else {
            module.hide();
          }
        },

        select: {
          firstUnfiltered: function() {
            module.verbose('Selecting first non-filtered element');
            module.remove.selectedItem();
            $item
              .not(selector.unselectable)
              .not(selector.addition + selector.hidden)
                .eq(0)
                .addClass(className.selected)
            ;
          },
          nextAvailable: function($selected) {
            $selected = $selected.eq(0);
            var
              $nextAvailable = $selected.nextAll(selector.item).not(selector.unselectable).eq(0),
              $prevAvailable = $selected.prevAll(selector.item).not(selector.unselectable).eq(0),
              hasNext        = ($nextAvailable.length > 0)
            ;
            if(hasNext) {
              module.verbose('Moving selection to', $nextAvailable);
              $nextAvailable.addClass(className.selected);
            }
            else {
              module.verbose('Moving selection to', $prevAvailable);
              $prevAvailable.addClass(className.selected);
            }
          }
        },

        setup: {
          api: function() {
            var
              apiSettings = {
                debug   : settings.debug,
                urlData : {
                  value : module.get.value(),
                  query : module.get.query()
                },
                on    : false
              }
            ;
            module.verbose('First request, initializing API');
            $module
              .api(apiSettings)
            ;
          },
          layout: function() {
            if( $module.is('select') ) {
              module.setup.select();
              module.setup.returnedObject();
            }
            if( !module.has.menu() ) {
              module.create.menu();
            }
            if( module.is.search() && !module.has.search() ) {
              module.verbose('Adding search input');
              $search = $('<input />')
                .addClass(className.search)
                .prop('autocomplete', 'off')
                .insertBefore($text)
              ;
            }
            if( module.is.multiple() && module.is.searchSelection() && !module.has.sizer()) {
              module.create.sizer();
            }
            if(settings.allowTab) {
              module.set.tabbable();
            }
          },
          select: function() {
            var
              selectValues  = module.get.selectValues()
            ;
            module.debug('Dropdown initialized on a select', selectValues);
            if( $module.is('select') ) {
              $input = $module;
            }
            // see if select is placed correctly already
            if($input.parent(selector.dropdown).length > 0) {
              module.debug('UI dropdown already exists. Creating dropdown menu only');
              $module = $input.closest(selector.dropdown);
              if( !module.has.menu() ) {
                module.create.menu();
              }
              $menu = $module.children(selector.menu);
              module.setup.menu(selectValues);
            }
            else {
              module.debug('Creating entire dropdown from select');
              $module = $('<div />')
                .attr('class', $input.attr('class') )
                .addClass(className.selection)
                .addClass(className.dropdown)
                .html( templates.dropdown(selectValues) )
                .insertBefore($input)
              ;
              if($input.hasClass(className.multiple) && $input.prop('multiple') === false) {
                module.error(error.missingMultiple);
                $input.prop('multiple', true);
              }
              if($input.is('[multiple]')) {
                module.set.multiple();
              }
              if ($input.prop('disabled')) {
                module.debug('Disabling dropdown');
                $module.addClass(className.disabled);
              }
              $input
                .removeAttr('class')
                .detach()
                .prependTo($module)
              ;
            }
            module.refresh();
          },
          menu: function(values) {
            $menu.html( templates.menu(values, fields));
            $item = $menu.find(selector.item);
          },
          reference: function() {
            module.debug('Dropdown behavior was called on select, replacing with closest dropdown');
            // replace module reference
            $module  = $module.parent(selector.dropdown);
            instance = $module.data(moduleNamespace);
            element  = $module.get(0);
            module.refresh();
            module.setup.returnedObject();
          },
          returnedObject: function() {
            var
              $firstModules = $allModules.slice(0, elementIndex),
              $lastModules  = $allModules.slice(elementIndex + 1)
            ;
            // adjust all modules to use correct reference
            $allModules = $firstModules.add($module).add($lastModules);
          }
        },

        refresh: function() {
          module.refreshSelectors();
          module.refreshData();
        },

        refreshItems: function() {
          $item = $menu.find(selector.item);
        },

        refreshSelectors: function() {
          module.verbose('Refreshing selector cache');
          $text   = $module.find(selector.text);
          $search = $module.find(selector.search);
          $input  = $module.find(selector.input);
          $icon   = $module.find(selector.icon);
          $combo  = ($module.prev().find(selector.text).length > 0)
            ? $module.prev().find(selector.text)
            : $module.prev()
          ;
          $menu    = $module.children(selector.menu);
          $item    = $menu.find(selector.item);
        },

        refreshData: function() {
          module.verbose('Refreshing cached metadata');
          $item
            .removeData(metadata.text)
            .removeData(metadata.value)
          ;
        },

        clearData: function() {
          module.verbose('Clearing metadata');
          $item
            .removeData(metadata.text)
            .removeData(metadata.value)
          ;
          $module
            .removeData(metadata.defaultText)
            .removeData(metadata.defaultValue)
            .removeData(metadata.placeholderText)
          ;
        },

        toggle: function() {
          module.verbose('Toggling menu visibility');
          if( !module.is.active() ) {
            module.show();
          }
          else {
            module.hide();
          }
        },

        show: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          if(!module.can.show() && module.is.remote()) {
            module.debug('No API results retrieved, searching before show');
            module.queryRemote(module.get.query(), module.show);
          }
          if( module.can.show() && !module.is.active() ) {
            module.debug('Showing dropdown');
            if(module.has.message() && !(module.has.maxSelections() || module.has.allResultsFiltered()) ) {
              module.remove.message();
            }
            if(module.is.allFiltered()) {
              return true;
            }
            if(settings.onShow.call(element) !== false) {
              module.animate.show(function() {
                if( module.can.click() ) {
                  module.bind.intent();
                }
                if(module.has.menuSearch()) {
                  module.focusSearch();
                }
                module.set.visible();
                callback.call(element);
              });
            }
          }
        },

        hide: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          if( module.is.active() && !module.is.animatingOutward() ) {
            module.debug('Hiding dropdown');
            if(settings.onHide.call(element) !== false) {
              module.animate.hide(function() {
                module.remove.visible();
                callback.call(element);
              });
            }
          }
        },

        hideOthers: function() {
          module.verbose('Finding other dropdowns to hide');
          $allModules
            .not($module)
              .has(selector.menu + '.' + className.visible)
                .dropdown('hide')
          ;
        },

        hideMenu: function() {
          module.verbose('Hiding menu  instantaneously');
          module.remove.active();
          module.remove.visible();
          $menu.transition('hide');
        },

        hideSubMenus: function() {
          var
            $subMenus = $menu.children(selector.item).find(selector.menu)
          ;
          module.verbose('Hiding sub menus', $subMenus);
          $subMenus.transition('hide');
        },

        bind: {
          events: function() {
            if(hasTouch) {
              module.bind.touchEvents();
            }
            module.bind.keyboardEvents();
            module.bind.inputEvents();
            module.bind.mouseEvents();
          },
          touchEvents: function() {
            module.debug('Touch device detected binding additional touch events');
            if( module.is.searchSelection() ) {
              // do nothing special yet
            }
            else if( module.is.single() ) {
              $module
                .on('touchstart' + eventNamespace, module.event.test.toggle)
              ;
            }
            $menu
              .on('touchstart' + eventNamespace, selector.item, module.event.item.mouseenter)
            ;
          },
          keyboardEvents: function() {
            module.verbose('Binding keyboard events');
            $module
              .on('keydown' + eventNamespace, module.event.keydown)
            ;
            if( module.has.search() ) {
              $module
                .on(module.get.inputEvent() + eventNamespace, selector.search, module.event.input)
              ;
            }
            if( module.is.multiple() ) {
              $document
                .on('keydown' + elementNamespace, module.event.document.keydown)
              ;
            }
          },
          inputEvents: function() {
            module.verbose('Binding input change events');
            $module
              .on('change' + eventNamespace, selector.input, module.event.change)
            ;
          },
          mouseEvents: function() {
            module.verbose('Binding mouse events');
            if(module.is.multiple()) {
              $module
                .on('click'   + eventNamespace, selector.label,  module.event.label.click)
                .on('click'   + eventNamespace, selector.remove, module.event.remove.click)
              ;
            }
            if( module.is.searchSelection() ) {
              $module
                .on('mousedown' + eventNamespace, module.event.mousedown)
                .on('mouseup'   + eventNamespace, module.event.mouseup)
                .on('mousedown' + eventNamespace, selector.menu,   module.event.menu.mousedown)
                .on('mouseup'   + eventNamespace, selector.menu,   module.event.menu.mouseup)
                .on('click'     + eventNamespace, selector.icon,   module.event.icon.click)
                .on('focus'     + eventNamespace, selector.search, module.event.search.focus)
                .on('click'     + eventNamespace, selector.search, module.event.search.focus)
                .on('blur'      + eventNamespace, selector.search, module.event.search.blur)
                .on('click'     + eventNamespace, selector.text,   module.event.text.focus)
              ;
              if(module.is.multiple()) {
                $module
                  .on('click' + eventNamespace, module.event.click)
                ;
              }
            }
            else {
              if(settings.on == 'click') {
                $module
                  .on('click' + eventNamespace, selector.icon, module.event.icon.click)
                  .on('click' + eventNamespace, module.event.test.toggle)
                ;
              }
              else if(settings.on == 'hover') {
                $module
                  .on('mouseenter' + eventNamespace, module.delay.show)
                  .on('mouseleave' + eventNamespace, module.delay.hide)
                ;
              }
              else {
                $module
                  .on(settings.on + eventNamespace, module.toggle)
                ;
              }
              $module
                .on('mousedown' + eventNamespace, module.event.mousedown)
                .on('mouseup'   + eventNamespace, module.event.mouseup)
                .on('focus'     + eventNamespace, module.event.focus)
              ;
              if(module.has.menuSearch() ) {
                $module
                  .on('blur' + eventNamespace, selector.search, module.event.search.blur)
                ;
              }
              else {
                $module
                  .on('blur' + eventNamespace, module.event.blur)
                ;
              }
            }
            $menu
              .on('mouseenter' + eventNamespace, selector.item, module.event.item.mouseenter)
              .on('mouseleave' + eventNamespace, selector.item, module.event.item.mouseleave)
              .on('click'      + eventNamespace, selector.item, module.event.item.click)
            ;
          },
          intent: function() {
            module.verbose('Binding hide intent event to document');
            if(hasTouch) {
              $document
                .on('touchstart' + elementNamespace, module.event.test.touch)
                .on('touchmove'  + elementNamespace, module.event.test.touch)
              ;
            }
            $document
              .on('click' + elementNamespace, module.event.test.hide)
            ;
          }
        },

        unbind: {
          intent: function() {
            module.verbose('Removing hide intent event from document');
            if(hasTouch) {
              $document
                .off('touchstart' + elementNamespace)
                .off('touchmove' + elementNamespace)
              ;
            }
            $document
              .off('click' + elementNamespace)
            ;
          }
        },

        filter: function(query) {
          var
            searchTerm = (query !== undefined)
              ? query
              : module.get.query(),
            afterFiltered = function() {
              if(module.is.multiple()) {
                module.filterActive();
              }
              if(query || (!query && module.get.activeItem().length == 0)) {
                module.select.firstUnfiltered();
              }
              if( module.has.allResultsFiltered() ) {
                if( settings.onNoResults.call(element, searchTerm) ) {
                  if(settings.allowAdditions) {
                    if(settings.hideAdditions) {
                      module.verbose('User addition with no menu, setting empty style');
                      module.set.empty();
                      module.hideMenu();
                    }
                  }
                  else {
                    module.verbose('All items filtered, showing message', searchTerm);
                    module.add.message(message.noResults);
                  }
                }
                else {
                  module.verbose('All items filtered, hiding dropdown', searchTerm);
                  module.hideMenu();
                }
              }
              else {
                module.remove.empty();
                module.remove.message();
              }
              if(settings.allowAdditions) {
                module.add.userSuggestion(query);
              }
              if(module.is.searchSelection() && module.can.show() && module.is.focusedOnSearch() ) {
                module.show();
              }
            }
          ;
          if(settings.useLabels && module.has.maxSelections()) {
            return;
          }
          if(settings.apiSettings) {
            if( module.can.useAPI() ) {
              module.queryRemote(searchTerm, function() {
                if(settings.filterRemoteData) {
                  module.filterItems(searchTerm);
                }
                afterFiltered();
              });
            }
            else {
              module.error(error.noAPI);
            }
          }
          else {
            module.filterItems(searchTerm);
            afterFiltered();
          }
        },

        queryRemote: function(query, callback) {
          var
            apiSettings = {
              errorDuration : false,
              cache         : 'local',
              throttle      : settings.throttle,
              urlData       : {
                query: query
              },
              onError: function() {
                module.add.message(message.serverError);
                callback();
              },
              onFailure: function() {
                module.add.message(message.serverError);
                callback();
              },
              onSuccess : function(response) {
                var
                  values          = response[fields.remoteValues],
                  hasRemoteValues = ($.isArray(values) && values.length > 0)
                ;
                if(hasRemoteValues) {
                  module.remove.message();
                  module.setup.menu({
                    values: response[fields.remoteValues]
                  });
                }
                else {
                  module.add.message(message.noResults);
                }
                callback();
              }
            }
          ;
          if( !$module.api('get request') ) {
            module.setup.api();
          }
          apiSettings = $.extend(true, {}, apiSettings, settings.apiSettings);
          $module
            .api('setting', apiSettings)
            .api('query')
          ;
        },

        filterItems: function(query) {
          var
            searchTerm = (query !== undefined)
              ? query
              : module.get.query(),
            results          =  null,
            escapedTerm      = module.escape.string(searchTerm),
            beginsWithRegExp = new RegExp('^' + escapedTerm, 'igm')
          ;
          // avoid loop if we're matching nothing
          if( module.has.query() ) {
            results = [];

            module.verbose('Searching for matching values', searchTerm);
            $item
              .each(function(){
                var
                  $choice = $(this),
                  text,
                  value
                ;
                if(settings.match == 'both' || settings.match == 'text') {
                  text = String(module.get.choiceText($choice, false));
                  if(text.search(beginsWithRegExp) !== -1) {
                    results.push(this);
                    return true;
                  }
                  else if (settings.fullTextSearch === 'exact' && module.exactSearch(searchTerm, text)) {
                    results.push(this);
                    return true;
                  }
                  else if (settings.fullTextSearch === true && module.fuzzySearch(searchTerm, text)) {
                    results.push(this);
                    return true;
                  }
                }
                if(settings.match == 'both' || settings.match == 'value') {
                  value = String(module.get.choiceValue($choice, text));
                  if(value.search(beginsWithRegExp) !== -1) {
                    results.push(this);
                    return true;
                  }
                  else if (settings.fullTextSearch === 'exact' && module.exactSearch(searchTerm, value)) {
                    results.push(this);
                    return true;
                  }
                  else if (settings.fullTextSearch === true && module.fuzzySearch(searchTerm, value)) {
                    results.push(this);
                    return true;
                  }
                }
              })
            ;
          }
          module.debug('Showing only matched items', searchTerm);
          module.remove.filteredItem();
          if(results) {
            $item
              .not(results)
              .addClass(className.filtered)
            ;
          }
        },

        fuzzySearch: function(query, term) {
          var
            termLength  = term.length,
            queryLength = query.length
          ;
          query = query.toLowerCase();
          term  = term.toLowerCase();
          if(queryLength > termLength) {
            return false;
          }
          if(queryLength === termLength) {
            return (query === term);
          }
          search: for (var characterIndex = 0, nextCharacterIndex = 0; characterIndex < queryLength; characterIndex++) {
            var
              queryCharacter = query.charCodeAt(characterIndex)
            ;
            while(nextCharacterIndex < termLength) {
              if(term.charCodeAt(nextCharacterIndex++) === queryCharacter) {
                continue search;
              }
            }
            return false;
          }
          return true;
        },
        exactSearch: function (query, term) {
          query = query.toLowerCase();
          term  = term.toLowerCase();
          if(term.indexOf(query) > -1) {
             return true;
          }
          return false;
        },
        filterActive: function() {
          if(settings.useLabels) {
            $item.filter('.' + className.active)
              .addClass(className.filtered)
            ;
          }
        },

        focusSearch: function(skipHandler) {
          if( module.has.search() && !module.is.focusedOnSearch() ) {
            if(skipHandler) {
              $module.off('focus' + eventNamespace, selector.search);
              $search.focus();
              $module.on('focus'  + eventNamespace, selector.search, module.event.search.focus);
            }
            else {
              $search.focus();
            }
          }
        },

        forceSelection: function() {
          var
            $currentlySelected = $item.not(className.filtered).filter('.' + className.selected).eq(0),
            $activeItem        = $item.not(className.filtered).filter('.' + className.active).eq(0),
            $selectedItem      = ($currentlySelected.length > 0)
              ? $currentlySelected
              : $activeItem,
            hasSelected = ($selectedItem.length > 0)
          ;
          if(hasSelected && !module.is.multiple()) {
            module.debug('Forcing partial selection to selected item', $selectedItem);
            module.event.item.click.call($selectedItem, {}, true);
            return;
          }
          else {
            if(settings.allowAdditions) {
              module.set.selected(module.get.query());
              module.remove.searchTerm();
            }
            else {
              module.remove.searchTerm();
            }
          }
        },

        change: {
          values: function(values) {
            if(!settings.allowAdditions) {
              module.clear();
            }
            module.debug('Creating dropdown with specified values', values);
            module.setup.menu({values: values});
            $.each(values, function(index, item) {
              if(item.selected == true) {
                module.debug('Setting initial selection to', item.value);
                module.set.selected(item.value);
                return true;
              }
            });
          }
        },

        event: {
          change: function() {
            if(!internalChange) {
              module.debug('Input changed, updating selection');
              module.set.selected();
            }
          },
          focus: function() {
            if(settings.showOnFocus && !activated && module.is.hidden() && !pageLostFocus) {
              module.show();
            }
          },
          blur: function(event) {
            pageLostFocus = (document.activeElement === this);
            if(!activated && !pageLostFocus) {
              module.remove.activeLabel();
              module.hide();
            }
          },
          mousedown: function() {
            if(module.is.searchSelection()) {
              // prevent menu hiding on immediate re-focus
              willRefocus = true;
            }
            else {
              // prevents focus callback from occurring on mousedown
              activated = true;
            }
          },
          mouseup: function() {
            if(module.is.searchSelection()) {
              // prevent menu hiding on immediate re-focus
              willRefocus = false;
            }
            else {
              activated = false;
            }
          },
          click: function(event) {
            var
              $target = $(event.target)
            ;
            // focus search
            if($target.is($module)) {
              if(!module.is.focusedOnSearch()) {
                module.focusSearch();
              }
              else {
                module.show();
              }
            }
          },
          search: {
            focus: function() {
              activated = true;
              if(module.is.multiple()) {
                module.remove.activeLabel();
              }
              if(settings.showOnFocus) {
                module.search();
              }
            },
            blur: function(event) {
              pageLostFocus = (document.activeElement === this);
              if(module.is.searchSelection() && !willRefocus) {
                if(!itemActivated && !pageLostFocus) {
                  if(settings.forceSelection) {
                    module.forceSelection();
                  }
                  module.hide();
                }
              }
              willRefocus = false;
            }
          },
          icon: {
            click: function(event) {
              if($icon.hasClass(className.clear)) {
                module.clear();
              }
              else {
                module.toggle();
              }
            }
          },
          text: {
            focus: function(event) {
              activated = true;
              module.focusSearch();
            }
          },
          input: function(event) {
            if(module.is.multiple() || module.is.searchSelection()) {
              module.set.filtered();
            }
            clearTimeout(module.timer);
            module.timer = setTimeout(module.search, settings.delay.search);
          },
          label: {
            click: function(event) {
              var
                $label        = $(this),
                $labels       = $module.find(selector.label),
                $activeLabels = $labels.filter('.' + className.active),
                $nextActive   = $label.nextAll('.' + className.active),
                $prevActive   = $label.prevAll('.' + className.active),
                $range = ($nextActive.length > 0)
                  ? $label.nextUntil($nextActive).add($activeLabels).add($label)
                  : $label.prevUntil($prevActive).add($activeLabels).add($label)
              ;
              if(event.shiftKey) {
                $activeLabels.removeClass(className.active);
                $range.addClass(className.active);
              }
              else if(event.ctrlKey) {
                $label.toggleClass(className.active);
              }
              else {
                $activeLabels.removeClass(className.active);
                $label.addClass(className.active);
              }
              settings.onLabelSelect.apply(this, $labels.filter('.' + className.active));
            }
          },
          remove: {
            click: function() {
              var
                $label = $(this).parent()
              ;
              if( $label.hasClass(className.active) ) {
                // remove all selected labels
                module.remove.activeLabels();
              }
              else {
                // remove this label only
                module.remove.activeLabels( $label );
              }
            }
          },
          test: {
            toggle: function(event) {
              var
                toggleBehavior = (module.is.multiple())
                  ? module.show
                  : module.toggle
              ;
              if(module.is.bubbledLabelClick(event) || module.is.bubbledIconClick(event)) {
                return;
              }
              if( module.determine.eventOnElement(event, toggleBehavior) ) {
                event.preventDefault();
              }
            },
            touch: function(event) {
              module.determine.eventOnElement(event, function() {
                if(event.type == 'touchstart') {
                  module.timer = setTimeout(function() {
                    module.hide();
                  }, settings.delay.touch);
                }
                else if(event.type == 'touchmove') {
                  clearTimeout(module.timer);
                }
              });
              event.stopPropagation();
            },
            hide: function(event) {
              module.determine.eventInModule(event, module.hide);
            }
          },
          select: {
            mutation: function(mutations) {
              module.debug('<select> modified, recreating menu');
              var
                isSelectMutation = false
              ;
              $.each(mutations, function(index, mutation) {
                if($(mutation.target).is('select') || $(mutation.addedNodes).is('select')) {
                  isSelectMutation = true;
                  return true;
                }
              });
              if(isSelectMutation) {
                module.disconnect.selectObserver();
                module.refresh();
                module.setup.select();
                module.set.selected();
                module.observe.select();
              }
            }
          },
          menu: {
            mutation: function(mutations) {
              var
                mutation   = mutations[0],
                $addedNode = mutation.addedNodes
                  ? $(mutation.addedNodes[0])
                  : $(false),
                $removedNode = mutation.removedNodes
                  ? $(mutation.removedNodes[0])
                  : $(false),
                $changedNodes  = $addedNode.add($removedNode),
                isUserAddition = $changedNodes.is(selector.addition) || $changedNodes.closest(selector.addition).length > 0,
                isMessage      = $changedNodes.is(selector.message)  || $changedNodes.closest(selector.message).length > 0
              ;
              if(isUserAddition || isMessage) {
                module.debug('Updating item selector cache');
                module.refreshItems();
              }
              else {
                module.debug('Menu modified, updating selector cache');
                module.refresh();
              }
            },
            mousedown: function() {
              itemActivated = true;
            },
            mouseup: function() {
              itemActivated = false;
            }
          },
          item: {
            mouseenter: function(event) {
              var
                $target        = $(event.target),
                $item          = $(this),
                $subMenu       = $item.children(selector.menu),
                $otherMenus    = $item.siblings(selector.item).children(selector.menu),
                hasSubMenu     = ($subMenu.length > 0),
                isBubbledEvent = ($subMenu.find($target).length > 0)
              ;
              if( !isBubbledEvent && hasSubMenu ) {
                clearTimeout(module.itemTimer);
                module.itemTimer = setTimeout(function() {
                  module.verbose('Showing sub-menu', $subMenu);
                  $.each($otherMenus, function() {
                    module.animate.hide(false, $(this));
                  });
                  module.animate.show(false, $subMenu);
                }, settings.delay.show);
                event.preventDefault();
              }
            },
            mouseleave: function(event) {
              var
                $subMenu = $(this).children(selector.menu)
              ;
              if($subMenu.length > 0) {
                clearTimeout(module.itemTimer);
                module.itemTimer = setTimeout(function() {
                  module.verbose('Hiding sub-menu', $subMenu);
                  module.animate.hide(false, $subMenu);
                }, settings.delay.hide);
              }
            },
            click: function (event, skipRefocus) {
              var
                $choice        = $(this),
                $target        = (event)
                  ? $(event.target)
                  : $(''),
                $subMenu       = $choice.find(selector.menu),
                text           = module.get.choiceText($choice),
                value          = module.get.choiceValue($choice, text),
                hasSubMenu     = ($subMenu.length > 0),
                isBubbledEvent = ($subMenu.find($target).length > 0)
              ;
              // prevents IE11 bug where menu receives focus even though `tabindex=-1`
              if(module.has.menuSearch()) {
                $(document.activeElement).blur();
              }
              if(!isBubbledEvent && (!hasSubMenu || settings.allowCategorySelection)) {
                if(module.is.searchSelection()) {
                  if(settings.allowAdditions) {
                    module.remove.userAddition();
                  }
                  module.remove.searchTerm();
                  if(!module.is.focusedOnSearch() && !(skipRefocus == true)) {
                    module.focusSearch(true);
                  }
                }
                if(!settings.useLabels) {
                  module.remove.filteredItem();
                  module.set.scrollPosition($choice);
                }
                module.determine.selectAction.call(this, text, value);
              }
            }
          },

          document: {
            // label selection should occur even when element has no focus
            keydown: function(event) {
              var
                pressedKey    = event.which,
                isShortcutKey = module.is.inObject(pressedKey, keys)
              ;
              if(isShortcutKey) {
                var
                  $label            = $module.find(selector.label),
                  $activeLabel      = $label.filter('.' + className.active),
                  activeValue       = $activeLabel.data(metadata.value),
                  labelIndex        = $label.index($activeLabel),
                  labelCount        = $label.length,
                  hasActiveLabel    = ($activeLabel.length > 0),
                  hasMultipleActive = ($activeLabel.length > 1),
                  isFirstLabel      = (labelIndex === 0),
                  isLastLabel       = (labelIndex + 1 == labelCount),
                  isSearch          = module.is.searchSelection(),
                  isFocusedOnSearch = module.is.focusedOnSearch(),
                  isFocused         = module.is.focused(),
                  caretAtStart      = (isFocusedOnSearch && module.get.caretPosition() === 0),
                  $nextLabel
                ;
                if(isSearch && !hasActiveLabel && !isFocusedOnSearch) {
                  return;
                }

                if(pressedKey == keys.leftArrow) {
                  // activate previous label
                  if((isFocused || caretAtStart) && !hasActiveLabel) {
                    module.verbose('Selecting previous label');
                    $label.last().addClass(className.active);
                  }
                  else if(hasActiveLabel) {
                    if(!event.shiftKey) {
                      module.verbose('Selecting previous label');
                      $label.removeClass(className.active);
                    }
                    else {
                      module.verbose('Adding previous label to selection');
                    }
                    if(isFirstLabel && !hasMultipleActive) {
                      $activeLabel.addClass(className.active);
                    }
                    else {
                      $activeLabel.prev(selector.siblingLabel)
                        .addClass(className.active)
                        .end()
                      ;
                    }
                    event.preventDefault();
                  }
                }
                else if(pressedKey == keys.rightArrow) {
                  // activate first label
                  if(isFocused && !hasActiveLabel) {
                    $label.first().addClass(className.active);
                  }
                  // activate next label
                  if(hasActiveLabel) {
                    if(!event.shiftKey) {
                      module.verbose('Selecting next label');
                      $label.removeClass(className.active);
                    }
                    else {
                      module.verbose('Adding next label to selection');
                    }
                    if(isLastLabel) {
                      if(isSearch) {
                        if(!isFocusedOnSearch) {
                          module.focusSearch();
                        }
                        else {
                          $label.removeClass(className.active);
                        }
                      }
                      else if(hasMultipleActive) {
                        $activeLabel.next(selector.siblingLabel).addClass(className.active);
                      }
                      else {
                        $activeLabel.addClass(className.active);
                      }
                    }
                    else {
                      $activeLabel.next(selector.siblingLabel).addClass(className.active);
                    }
                    event.preventDefault();
                  }
                }
                else if(pressedKey == keys.deleteKey || pressedKey == keys.backspace) {
                  if(hasActiveLabel) {
                    module.verbose('Removing active labels');
                    if(isLastLabel) {
                      if(isSearch && !isFocusedOnSearch) {
                        module.focusSearch();
                      }
                    }
                    $activeLabel.last().next(selector.siblingLabel).addClass(className.active);
                    module.remove.activeLabels($activeLabel);
                    event.preventDefault();
                  }
                  else if(caretAtStart && !hasActiveLabel && pressedKey == keys.backspace) {
                    module.verbose('Removing last label on input backspace');
                    $activeLabel = $label.last().addClass(className.active);
                    module.remove.activeLabels($activeLabel);
                  }
                }
                else {
                  $activeLabel.removeClass(className.active);
                }
              }
            }
          },

          keydown: function(event) {
            var
              pressedKey    = event.which,
              isShortcutKey = module.is.inObject(pressedKey, keys)
            ;
            if(isShortcutKey) {
              var
                $currentlySelected = $item.not(selector.unselectable).filter('.' + className.selected).eq(0),
                $activeItem        = $menu.children('.' + className.active).eq(0),
                $selectedItem      = ($currentlySelected.length > 0)
                  ? $currentlySelected
                  : $activeItem,
                $visibleItems = ($selectedItem.length > 0)
                  ? $selectedItem.siblings(':not(.' + className.filtered +')').addBack()
                  : $menu.children(':not(.' + className.filtered +')'),
                $subMenu              = $selectedItem.children(selector.menu),
                $parentMenu           = $selectedItem.closest(selector.menu),
                inVisibleMenu         = ($parentMenu.hasClass(className.visible) || $parentMenu.hasClass(className.animating) || $parentMenu.parent(selector.menu).length > 0),
                hasSubMenu            = ($subMenu.length> 0),
                hasSelectedItem       = ($selectedItem.length > 0),
                selectedIsSelectable  = ($selectedItem.not(selector.unselectable).length > 0),
                delimiterPressed      = (pressedKey == keys.delimiter && settings.allowAdditions && module.is.multiple()),
                isAdditionWithoutMenu = (settings.allowAdditions && settings.hideAdditions && (pressedKey == keys.enter || delimiterPressed) && selectedIsSelectable),
                $nextItem,
                isSubMenuItem,
                newIndex
              ;
              // allow selection with menu closed
              if(isAdditionWithoutMenu) {
                module.verbose('Selecting item from keyboard shortcut', $selectedItem);
                module.event.item.click.call($selectedItem, event);
                if(module.is.searchSelection()) {
                  module.remove.searchTerm();
                }
              }

              // visible menu keyboard shortcuts
              if( module.is.visible() ) {

                // enter (select or open sub-menu)
                if(pressedKey == keys.enter || delimiterPressed) {
                  if(pressedKey == keys.enter && hasSelectedItem && hasSubMenu && !settings.allowCategorySelection) {
                    module.verbose('Pressed enter on unselectable category, opening sub menu');
                    pressedKey = keys.rightArrow;
                  }
                  else if(selectedIsSelectable) {
                    module.verbose('Selecting item from keyboard shortcut', $selectedItem);
                    module.event.item.click.call($selectedItem, event);
                    if(module.is.searchSelection()) {
                      module.remove.searchTerm();
                    }
                  }
                  event.preventDefault();
                }

                // sub-menu actions
                if(hasSelectedItem) {

                  if(pressedKey == keys.leftArrow) {

                    isSubMenuItem = ($parentMenu[0] !== $menu[0]);

                    if(isSubMenuItem) {
                      module.verbose('Left key pressed, closing sub-menu');
                      module.animate.hide(false, $parentMenu);
                      $selectedItem
                        .removeClass(className.selected)
                      ;
                      $parentMenu
                        .closest(selector.item)
                          .addClass(className.selected)
                      ;
                      event.preventDefault();
                    }
                  }

                  // right arrow (show sub-menu)
                  if(pressedKey == keys.rightArrow) {
                    if(hasSubMenu) {
                      module.verbose('Right key pressed, opening sub-menu');
                      module.animate.show(false, $subMenu);
                      $selectedItem
                        .removeClass(className.selected)
                      ;
                      $subMenu
                        .find(selector.item).eq(0)
                          .addClass(className.selected)
                      ;
                      event.preventDefault();
                    }
                  }
                }

                // up arrow (traverse menu up)
                if(pressedKey == keys.upArrow) {
                  $nextItem = (hasSelectedItem && inVisibleMenu)
                    ? $selectedItem.prevAll(selector.item + ':not(' + selector.unselectable + ')').eq(0)
                    : $item.eq(0)
                  ;
                  if($visibleItems.index( $nextItem ) < 0) {
                    module.verbose('Up key pressed but reached top of current menu');
                    event.preventDefault();
                    return;
                  }
                  else {
                    module.verbose('Up key pressed, changing active item');
                    $selectedItem
                      .removeClass(className.selected)
                    ;
                    $nextItem
                      .addClass(className.selected)
                    ;
                    module.set.scrollPosition($nextItem);
                    if(settings.selectOnKeydown && module.is.single()) {
                      module.set.selectedItem($nextItem);
                    }
                  }
                  event.preventDefault();
                }

                // down arrow (traverse menu down)
                if(pressedKey == keys.downArrow) {
                  $nextItem = (hasSelectedItem && inVisibleMenu)
                    ? $nextItem = $selectedItem.nextAll(selector.item + ':not(' + selector.unselectable + ')').eq(0)
                    : $item.eq(0)
                  ;
                  if($nextItem.length === 0) {
                    module.verbose('Down key pressed but reached bottom of current menu');
                    event.preventDefault();
                    return;
                  }
                  else {
                    module.verbose('Down key pressed, changing active item');
                    $item
                      .removeClass(className.selected)
                    ;
                    $nextItem
                      .addClass(className.selected)
                    ;
                    module.set.scrollPosition($nextItem);
                    if(settings.selectOnKeydown && module.is.single()) {
                      module.set.selectedItem($nextItem);
                    }
                  }
                  event.preventDefault();
                }

                // page down (show next page)
                if(pressedKey == keys.pageUp) {
                  module.scrollPage('up');
                  event.preventDefault();
                }
                if(pressedKey == keys.pageDown) {
                  module.scrollPage('down');
                  event.preventDefault();
                }

                // escape (close menu)
                if(pressedKey == keys.escape) {
                  module.verbose('Escape key pressed, closing dropdown');
                  module.hide();
                }

              }
              else {
                // delimiter key
                if(delimiterPressed) {
                  event.preventDefault();
                }
                // down arrow (open menu)
                if(pressedKey == keys.downArrow && !module.is.visible()) {
                  module.verbose('Down key pressed, showing dropdown');
                  module.show();
                  event.preventDefault();
                }
              }
            }
            else {
              if( !module.has.search() ) {
                module.set.selectedLetter( String.fromCharCode(pressedKey) );
              }
            }
          }
        },

        trigger: {
          change: function() {
            var
              events       = document.createEvent('HTMLEvents'),
              inputElement = $input[0]
            ;
            if(inputElement) {
              module.verbose('Triggering native change event');
              events.initEvent('change', true, false);
              inputElement.dispatchEvent(events);
            }
          }
        },

        determine: {
          selectAction: function(text, value) {
            module.verbose('Determining action', settings.action);
            if( $.isFunction( module.action[settings.action] ) ) {
              module.verbose('Triggering preset action', settings.action, text, value);
              module.action[ settings.action ].call(element, text, value, this);
            }
            else if( $.isFunction(settings.action) ) {
              module.verbose('Triggering user action', settings.action, text, value);
              settings.action.call(element, text, value, this);
            }
            else {
              module.error(error.action, settings.action);
            }
          },
          eventInModule: function(event, callback) {
            var
              $target    = $(event.target),
              inDocument = ($target.closest(document.documentElement).length > 0),
              inModule   = ($target.closest($module).length > 0)
            ;
            callback = $.isFunction(callback)
              ? callback
              : function(){}
            ;
            if(inDocument && !inModule) {
              module.verbose('Triggering event', callback);
              callback();
              return true;
            }
            else {
              module.verbose('Event occurred in dropdown, canceling callback');
              return false;
            }
          },
          eventOnElement: function(event, callback) {
            var
              $target      = $(event.target),
              $label       = $target.closest(selector.siblingLabel),
              inVisibleDOM = document.body.contains(event.target),
              notOnLabel   = ($module.find($label).length === 0),
              notInMenu    = ($target.closest($menu).length === 0)
            ;
            callback = $.isFunction(callback)
              ? callback
              : function(){}
            ;
            if(inVisibleDOM && notOnLabel && notInMenu) {
              module.verbose('Triggering event', callback);
              callback();
              return true;
            }
            else {
              module.verbose('Event occurred in dropdown menu, canceling callback');
              return false;
            }
          }
        },

        action: {

          nothing: function() {},

          activate: function(text, value, element) {
            value = (value !== undefined)
              ? value
              : text
            ;
            if( module.can.activate( $(element) ) ) {
              module.set.selected(value, $(element));
              if(module.is.multiple() && !module.is.allFiltered()) {
                return;
              }
              else {
                module.hideAndClear();
              }
            }
          },

          select: function(text, value, element) {
            value = (value !== undefined)
              ? value
              : text
            ;
            if( module.can.activate( $(element) ) ) {
              module.set.value(value, text, $(element));
              if(module.is.multiple() && !module.is.allFiltered()) {
                return;
              }
              else {
                module.hideAndClear();
              }
            }
          },

          combo: function(text, value, element) {
            value = (value !== undefined)
              ? value
              : text
            ;
            module.set.selected(value, $(element));
            module.hideAndClear();
          },

          hide: function(text, value, element) {
            module.set.value(value, text, $(element));
            module.hideAndClear();
          }

        },

        get: {
          id: function() {
            return id;
          },
          defaultText: function() {
            return $module.data(metadata.defaultText);
          },
          defaultValue: function() {
            return $module.data(metadata.defaultValue);
          },
          placeholderText: function() {
            if(settings.placeholder != 'auto' && typeof settings.placeholder == 'string') {
              return settings.placeholder;
            }
            return $module.data(metadata.placeholderText) || '';
          },
          text: function() {
            return $text.text();
          },
          query: function() {
            return $.trim($search.val());
          },
          searchWidth: function(value) {
            value = (value !== undefined)
              ? value
              : $search.val()
            ;
            $sizer.text(value);
            // prevent rounding issues
            return Math.ceil( $sizer.width() + 1);
          },
          selectionCount: function() {
            var
              values = module.get.values(),
              count
            ;
            count = ( module.is.multiple() )
              ? $.isArray(values)
                ? values.length
                : 0
              : (module.get.value() !== '')
                ? 1
                : 0
            ;
            return count;
          },
          transition: function($subMenu) {
            return (settings.transition == 'auto')
              ? module.is.upward($subMenu)
                ? 'slide up'
                : 'slide down'
              : settings.transition
            ;
          },
          userValues: function() {
            var
              values = module.get.values()
            ;
            if(!values) {
              return false;
            }
            values = $.isArray(values)
              ? values
              : [values]
            ;
            return $.grep(values, function(value) {
              return (module.get.item(value) === false);
            });
          },
          uniqueArray: function(array) {
            return $.grep(array, function (value, index) {
                return $.inArray(value, array) === index;
            });
          },
          caretPosition: function() {
            var
              input = $search.get(0),
              range,
              rangeLength
            ;
            if('selectionStart' in input) {
              return input.selectionStart;
            }
            else if (document.selection) {
              input.focus();
              range       = document.selection.createRange();
              rangeLength = range.text.length;
              range.moveStart('character', -input.value.length);
              return range.text.length - rangeLength;
            }
          },
          value: function() {
            var
              value = ($input.length > 0)
                ? $input.val()
                : $module.data(metadata.value),
              isEmptyMultiselect = ($.isArray(value) && value.length === 1 && value[0] === '')
            ;
            // prevents placeholder element from being selected when multiple
            return (value === undefined || isEmptyMultiselect)
              ? ''
              : value
            ;
          },
          values: function() {
            var
              value = module.get.value()
            ;
            if(value === '') {
              return '';
            }
            return ( !module.has.selectInput() && module.is.multiple() )
              ? (typeof value == 'string') // delimited string
                ? value.split(settings.delimiter)
                : ''
              : value
            ;
          },
          remoteValues: function() {
            var
              values = module.get.values(),
              remoteValues = false
            ;
            if(values) {
              if(typeof values == 'string') {
                values = [values];
              }
              $.each(values, function(index, value) {
                var
                  name = module.read.remoteData(value)
                ;
                module.verbose('Restoring value from session data', name, value);
                if(name) {
                  if(!remoteValues) {
                    remoteValues = {};
                  }
                  remoteValues[value] = name;
                }
              });
            }
            return remoteValues;
          },
          choiceText: function($choice, preserveHTML) {
            preserveHTML = (preserveHTML !== undefined)
              ? preserveHTML
              : settings.preserveHTML
            ;
            if($choice) {
              if($choice.find(selector.menu).length > 0) {
                module.verbose('Retrieving text of element with sub-menu');
                $choice = $choice.clone();
                $choice.find(selector.menu).remove();
                $choice.find(selector.menuIcon).remove();
              }
              return ($choice.data(metadata.text) !== undefined)
                ? $choice.data(metadata.text)
                : (preserveHTML)
                  ? $.trim($choice.html())
                  : $.trim($choice.text())
              ;
            }
          },
          choiceValue: function($choice, choiceText) {
            choiceText = choiceText || module.get.choiceText($choice);
            if(!$choice) {
              return false;
            }
            return ($choice.data(metadata.value) !== undefined)
              ? String( $choice.data(metadata.value) )
              : (typeof choiceText === 'string')
                ? $.trim(choiceText.toLowerCase())
                : String(choiceText)
            ;
          },
          inputEvent: function() {
            var
              input = $search[0]
            ;
            if(input) {
              return (input.oninput !== undefined)
                ? 'input'
                : (input.onpropertychange !== undefined)
                  ? 'propertychange'
                  : 'keyup'
              ;
            }
            return false;
          },
          selectValues: function() {
            var
              select = {}
            ;
            select.values = [];
            $module
              .find('option')
                .each(function() {
                  var
                    $option  = $(this),
                    name     = $option.html(),
                    disabled = $option.attr('disabled'),
                    value    = ( $option.attr('value') !== undefined )
                      ? $option.attr('value')
                      : name
                  ;
                  if(settings.placeholder === 'auto' && value === '') {
                    select.placeholder = name;
                  }
                  else {
                    select.values.push({
                      name     : name,
                      value    : value,
                      disabled : disabled
                    });
                  }
                })
            ;
            if(settings.placeholder && settings.placeholder !== 'auto') {
              module.debug('Setting placeholder value to', settings.placeholder);
              select.placeholder = settings.placeholder;
            }
            if(settings.sortSelect) {
              select.values.sort(function(a, b) {
                return (a.name > b.name)
                  ? 1
                  : -1
                ;
              });
              module.debug('Retrieved and sorted values from select', select);
            }
            else {
              module.debug('Retrieved values from select', select);
            }
            return select;
          },
          activeItem: function() {
            return $item.filter('.'  + className.active);
          },
          selectedItem: function() {
            var
              $selectedItem = $item.not(selector.unselectable).filter('.'  + className.selected)
            ;
            return ($selectedItem.length > 0)
              ? $selectedItem
              : $item.eq(0)
            ;
          },
          itemWithAdditions: function(value) {
            var
              $items       = module.get.item(value),
              $userItems   = module.create.userChoice(value),
              hasUserItems = ($userItems && $userItems.length > 0)
            ;
            if(hasUserItems) {
              $items = ($items.length > 0)
                ? $items.add($userItems)
                : $userItems
              ;
            }
            return $items;
          },
          item: function(value, strict) {
            var
              $selectedItem = false,
              shouldSearch,
              isMultiple
            ;
            value = (value !== undefined)
              ? value
              : ( module.get.values() !== undefined)
                ? module.get.values()
                : module.get.text()
            ;
            shouldSearch = (isMultiple)
              ? (value.length > 0)
              : (value !== undefined && value !== null)
            ;
            isMultiple = (module.is.multiple() && $.isArray(value));
            strict     = (value === '' || value === 0)
              ? true
              : strict || false
            ;
            if(shouldSearch) {
              $item
                .each(function() {
                  var
                    $choice       = $(this),
                    optionText    = module.get.choiceText($choice),
                    optionValue   = module.get.choiceValue($choice, optionText)
                  ;
                  // safe early exit
                  if(optionValue === null || optionValue === undefined) {
                    return;
                  }
                  if(isMultiple) {
                    if($.inArray( String(optionValue), value) !== -1 || $.inArray(optionText, value) !== -1) {
                      $selectedItem = ($selectedItem)
                        ? $selectedItem.add($choice)
                        : $choice
                      ;
                    }
                  }
                  else if(strict) {
                    module.verbose('Ambiguous dropdown value using strict type check', $choice, value);
                    if( optionValue === value || optionText === value) {
                      $selectedItem = $choice;
                      return true;
                    }
                  }
                  else {
                    if( String(optionValue) == String(value) || optionText == value) {
                      module.verbose('Found select item by value', optionValue, value);
                      $selectedItem = $choice;
                      return true;
                    }
                  }
                })
              ;
            }
            return $selectedItem;
          }
        },

        check: {
          maxSelections: function(selectionCount) {
            if(settings.maxSelections) {
              selectionCount = (selectionCount !== undefined)
                ? selectionCount
                : module.get.selectionCount()
              ;
              if(selectionCount >= settings.maxSelections) {
                module.debug('Maximum selection count reached');
                if(settings.useLabels) {
                  $item.addClass(className.filtered);
                  module.add.message(message.maxSelections);
                }
                return true;
              }
              else {
                module.verbose('No longer at maximum selection count');
                module.remove.message();
                module.remove.filteredItem();
                if(module.is.searchSelection()) {
                  module.filterItems();
                }
                return false;
              }
            }
            return true;
          }
        },

        restore: {
          defaults: function() {
            module.clear();
            module.restore.defaultText();
            module.restore.defaultValue();
          },
          defaultText: function() {
            var
              defaultText     = module.get.defaultText(),
              placeholderText = module.get.placeholderText
            ;
            if(defaultText === placeholderText) {
              module.debug('Restoring default placeholder text', defaultText);
              module.set.placeholderText(defaultText);
            }
            else {
              module.debug('Restoring default text', defaultText);
              module.set.text(defaultText);
            }
          },
          placeholderText: function() {
            module.set.placeholderText();
          },
          defaultValue: function() {
            var
              defaultValue = module.get.defaultValue()
            ;
            if(defaultValue !== undefined) {
              module.debug('Restoring default value', defaultValue);
              if(defaultValue !== '') {
                module.set.value(defaultValue);
                module.set.selected();
              }
              else {
                module.remove.activeItem();
                module.remove.selectedItem();
              }
            }
          },
          labels: function() {
            if(settings.allowAdditions) {
              if(!settings.useLabels) {
                module.error(error.labels);
                settings.useLabels = true;
              }
              module.debug('Restoring selected values');
              module.create.userLabels();
            }
            module.check.maxSelections();
          },
          selected: function() {
            module.restore.values();
            if(module.is.multiple()) {
              module.debug('Restoring previously selected values and labels');
              module.restore.labels();
            }
            else {
              module.debug('Restoring previously selected values');
            }
          },
          values: function() {
            // prevents callbacks from occurring on initial load
            module.set.initialLoad();
            if(settings.apiSettings && settings.saveRemoteData && module.get.remoteValues()) {
              module.restore.remoteValues();
            }
            else {
              module.set.selected();
            }
            module.remove.initialLoad();
          },
          remoteValues: function() {
            var
              values = module.get.remoteValues()
            ;
            module.debug('Recreating selected from session data', values);
            if(values) {
              if( module.is.single() ) {
                $.each(values, function(value, name) {
                  module.set.text(name);
                });
              }
              else {
                $.each(values, function(value, name) {
                  module.add.label(value, name);
                });
              }
            }
          }
        },

        read: {
          remoteData: function(value) {
            var
              name
            ;
            if(window.Storage === undefined) {
              module.error(error.noStorage);
              return;
            }
            name = sessionStorage.getItem(value);
            return (name !== undefined)
              ? name
              : false
            ;
          }
        },

        save: {
          defaults: function() {
            module.save.defaultText();
            module.save.placeholderText();
            module.save.defaultValue();
          },
          defaultValue: function() {
            var
              value = module.get.value()
            ;
            module.verbose('Saving default value as', value);
            $module.data(metadata.defaultValue, value);
          },
          defaultText: function() {
            var
              text = module.get.text()
            ;
            module.verbose('Saving default text as', text);
            $module.data(metadata.defaultText, text);
          },
          placeholderText: function() {
            var
              text
            ;
            if(settings.placeholder !== false && $text.hasClass(className.placeholder)) {
              text = module.get.text();
              module.verbose('Saving placeholder text as', text);
              $module.data(metadata.placeholderText, text);
            }
          },
          remoteData: function(name, value) {
            if(window.Storage === undefined) {
              module.error(error.noStorage);
              return;
            }
            module.verbose('Saving remote data to session storage', value, name);
            sessionStorage.setItem(value, name);
          }
        },

        clear: function() {
          if(module.is.multiple() && settings.useLabels) {
            module.remove.labels();
          }
          else {
            module.remove.activeItem();
            module.remove.selectedItem();
          }
          module.set.placeholderText();
          module.clearValue();
        },

        clearValue: function() {
          module.set.value('');
        },

        scrollPage: function(direction, $selectedItem) {
          var
            $currentItem  = $selectedItem || module.get.selectedItem(),
            $menu         = $currentItem.closest(selector.menu),
            menuHeight    = $menu.outerHeight(),
            currentScroll = $menu.scrollTop(),
            itemHeight    = $item.eq(0).outerHeight(),
            itemsPerPage  = Math.floor(menuHeight / itemHeight),
            maxScroll     = $menu.prop('scrollHeight'),
            newScroll     = (direction == 'up')
              ? currentScroll - (itemHeight * itemsPerPage)
              : currentScroll + (itemHeight * itemsPerPage),
            $selectableItem = $item.not(selector.unselectable),
            isWithinRange,
            $nextSelectedItem,
            elementIndex
          ;
          elementIndex      = (direction == 'up')
            ? $selectableItem.index($currentItem) - itemsPerPage
            : $selectableItem.index($currentItem) + itemsPerPage
          ;
          isWithinRange = (direction == 'up')
            ? (elementIndex >= 0)
            : (elementIndex < $selectableItem.length)
          ;
          $nextSelectedItem = (isWithinRange)
            ? $selectableItem.eq(elementIndex)
            : (direction == 'up')
              ? $selectableItem.first()
              : $selectableItem.last()
          ;
          if($nextSelectedItem.length > 0) {
            module.debug('Scrolling page', direction, $nextSelectedItem);
            $currentItem
              .removeClass(className.selected)
            ;
            $nextSelectedItem
              .addClass(className.selected)
            ;
            if(settings.selectOnKeydown && module.is.single()) {
              module.set.selectedItem($nextSelectedItem);
            }
            $menu
              .scrollTop(newScroll)
            ;
          }
        },

        set: {
          filtered: function() {
            var
              isMultiple       = module.is.multiple(),
              isSearch         = module.is.searchSelection(),
              isSearchMultiple = (isMultiple && isSearch),
              searchValue      = (isSearch)
                ? module.get.query()
                : '',
              hasSearchValue   = (typeof searchValue === 'string' && searchValue.length > 0),
              searchWidth      = module.get.searchWidth(),
              valueIsSet       = searchValue !== ''
            ;
            if(isMultiple && hasSearchValue) {
              module.verbose('Adjusting input width', searchWidth, settings.glyphWidth);
              $search.css('width', searchWidth);
            }
            if(hasSearchValue || (isSearchMultiple && valueIsSet)) {
              module.verbose('Hiding placeholder text');
              $text.addClass(className.filtered);
            }
            else if(!isMultiple || (isSearchMultiple && !valueIsSet)) {
              module.verbose('Showing placeholder text');
              $text.removeClass(className.filtered);
            }
          },
          empty: function() {
            $module.addClass(className.empty);
          },
          loading: function() {
            $module.addClass(className.loading);
          },
          placeholderText: function(text) {
            text = text || module.get.placeholderText();
            module.debug('Setting placeholder text', text);
            module.set.text(text);
            $text.addClass(className.placeholder);
          },
          tabbable: function() {
            if( module.is.searchSelection() ) {
              module.debug('Added tabindex to searchable dropdown');
              $search
                .val('')
                .attr('tabindex', 0)
              ;
              $menu
                .attr('tabindex', -1)
              ;
            }
            else {
              module.debug('Added tabindex to dropdown');
              if( $module.attr('tabindex') === undefined) {
                $module
                  .attr('tabindex', 0)
                ;
                $menu
                  .attr('tabindex', -1)
                ;
              }
            }
          },
          initialLoad: function() {
            module.verbose('Setting initial load');
            initialLoad = true;
          },
          activeItem: function($item) {
            if( settings.allowAdditions && $item.filter(selector.addition).length > 0 ) {
              $item.addClass(className.filtered);
            }
            else {
              $item.addClass(className.active);
            }
          },
          partialSearch: function(text) {
            var
              length = module.get.query().length
            ;
            $search.val( text.substr(0, length));
          },
          scrollPosition: function($item, forceScroll) {
            var
              edgeTolerance = 5,
              $menu,
              hasActive,
              offset,
              itemHeight,
              itemOffset,
              menuOffset,
              menuScroll,
              menuHeight,
              abovePage,
              belowPage
            ;

            $item       = $item || module.get.selectedItem();
            $menu       = $item.closest(selector.menu);
            hasActive   = ($item && $item.length > 0);
            forceScroll = (forceScroll !== undefined)
              ? forceScroll
              : false
            ;
            if($item && $menu.length > 0 && hasActive) {
              itemOffset = $item.position().top;

              $menu.addClass(className.loading);
              menuScroll = $menu.scrollTop();
              menuOffset = $menu.offset().top;
              itemOffset = $item.offset().top;
              offset     = menuScroll - menuOffset + itemOffset;
              if(!forceScroll) {
                menuHeight = $menu.height();
                belowPage  = menuScroll + menuHeight < (offset + edgeTolerance);
                abovePage  = ((offset - edgeTolerance) < menuScroll);
              }
              module.debug('Scrolling to active item', offset);
              if(forceScroll || abovePage || belowPage) {
                $menu.scrollTop(offset);
              }
              $menu.removeClass(className.loading);
            }
          },
          text: function(text) {
            if(settings.action !== 'select') {
              if(settings.action == 'combo') {
                module.debug('Changing combo button text', text, $combo);
                if(settings.preserveHTML) {
                  $combo.html(text);
                }
                else {
                  $combo.text(text);
                }
              }
              else {
                if(text !== module.get.placeholderText()) {
                  $text.removeClass(className.placeholder);
                }
                module.debug('Changing text', text, $text);
                $text
                  .removeClass(className.filtered)
                ;
                if(settings.preserveHTML) {
                  $text.html(text);
                }
                else {
                  $text.text(text);
                }
              }
            }
          },
          selectedItem: function($item) {
            var
              value      = module.get.choiceValue($item),
              searchText = module.get.choiceText($item, false),
              text       = module.get.choiceText($item, true)
            ;
            module.debug('Setting user selection to item', $item);
            module.remove.activeItem();
            module.set.partialSearch(searchText);
            module.set.activeItem($item);
            module.set.selected(value, $item);
            module.set.text(text);
          },
          selectedLetter: function(letter) {
            var
              $selectedItem         = $item.filter('.' + className.selected),
              alreadySelectedLetter = $selectedItem.length > 0 && module.has.firstLetter($selectedItem, letter),
              $nextValue            = false,
              $nextItem
            ;
            // check next of same letter
            if(alreadySelectedLetter) {
              $nextItem = $selectedItem.nextAll($item).eq(0);
              if( module.has.firstLetter($nextItem, letter) ) {
                $nextValue  = $nextItem;
              }
            }
            // check all values
            if(!$nextValue) {
              $item
                .each(function(){
                  if(module.has.firstLetter($(this), letter)) {
                    $nextValue = $(this);
                    return false;
                  }
                })
              ;
            }
            // set next value
            if($nextValue) {
              module.verbose('Scrolling to next value with letter', letter);
              module.set.scrollPosition($nextValue);
              $selectedItem.removeClass(className.selected);
              $nextValue.addClass(className.selected);
              if(settings.selectOnKeydown && module.is.single()) {
                module.set.selectedItem($nextValue);
              }
            }
          },
          direction: function($menu) {
            if(settings.direction == 'auto') {
              // reset position
              module.remove.upward();

              if(module.can.openDownward($menu)) {
                module.remove.upward($menu);
              }
              else {
                module.set.upward($menu);
              }
              if(!module.is.leftward($menu) && !module.can.openRightward($menu)) {
                module.set.leftward($menu);
              }
            }
            else if(settings.direction == 'upward') {
              module.set.upward($menu);
            }
          },
          upward: function($currentMenu) {
            var $element = $currentMenu || $module;
            $element.addClass(className.upward);
          },
          leftward: function($currentMenu) {
            var $element = $currentMenu || $menu;
            $element.addClass(className.leftward);
          },
          value: function(value, text, $selected) {
            var
              escapedValue = module.escape.value(value),
              hasInput     = ($input.length > 0),
              currentValue = module.get.values(),
              stringValue  = (value !== undefined)
                ? String(value)
                : value,
              newValue
            ;
            if(hasInput) {
              if(!settings.allowReselection && stringValue == currentValue) {
                module.verbose('Skipping value update already same value', value, currentValue);
                if(!module.is.initialLoad()) {
                  return;
                }
              }

              if( module.is.single() && module.has.selectInput() && module.can.extendSelect() ) {
                module.debug('Adding user option', value);
                module.add.optionValue(value);
              }
              module.debug('Updating input value', escapedValue, currentValue);
              internalChange = true;
              $input
                .val(escapedValue)
              ;
              if(settings.fireOnInit === false && module.is.initialLoad()) {
                module.debug('Input native change event ignored on initial load');
              }
              else {
                module.trigger.change();
              }
              internalChange = false;
            }
            else {
              module.verbose('Storing value in metadata', escapedValue, $input);
              if(escapedValue !== currentValue) {
                $module.data(metadata.value, stringValue);
              }
            }
            if(module.is.single() && settings.clearable) {
              // treat undefined or '' as empty
              if(!escapedValue) {
                module.remove.clearable();
              }
              else {
                module.set.clearable();
              }
            }
            if(settings.fireOnInit === false && module.is.initialLoad()) {
              module.verbose('No callback on initial load', settings.onChange);
            }
            else {
              settings.onChange.call(element, value, text, $selected);
            }
          },
          active: function() {
            $module
              .addClass(className.active)
            ;
          },
          multiple: function() {
            $module.addClass(className.multiple);
          },
          visible: function() {
            $module.addClass(className.visible);
          },
          exactly: function(value, $selectedItem) {
            module.debug('Setting selected to exact values');
            module.clear();
            module.set.selected(value, $selectedItem);
          },
          selected: function(value, $selectedItem) {
            var
              isMultiple = module.is.multiple(),
              $userSelectedItem
            ;
            $selectedItem = (settings.allowAdditions)
              ? $selectedItem || module.get.itemWithAdditions(value)
              : $selectedItem || module.get.item(value)
            ;
            if(!$selectedItem) {
              return;
            }
            module.debug('Setting selected menu item to', $selectedItem);
            if(module.is.multiple()) {
              module.remove.searchWidth();
            }
            if(module.is.single()) {
              module.remove.activeItem();
              module.remove.selectedItem();
            }
            else if(settings.useLabels) {
              module.remove.selectedItem();
            }
            // select each item
            $selectedItem
              .each(function() {
                var
                  $selected      = $(this),
                  selectedText   = module.get.choiceText($selected),
                  selectedValue  = module.get.choiceValue($selected, selectedText),

                  isFiltered     = $selected.hasClass(className.filtered),
                  isActive       = $selected.hasClass(className.active),
                  isUserValue    = $selected.hasClass(className.addition),
                  shouldAnimate  = (isMultiple && $selectedItem.length == 1)
                ;
                if(isMultiple) {
                  if(!isActive || isUserValue) {
                    if(settings.apiSettings && settings.saveRemoteData) {
                      module.save.remoteData(selectedText, selectedValue);
                    }
                    if(settings.useLabels) {
                      module.add.label(selectedValue, selectedText, shouldAnimate);
                      module.add.value(selectedValue, selectedText, $selected);
                      module.set.activeItem($selected);
                      module.filterActive();
                      module.select.nextAvailable($selectedItem);
                    }
                    else {
                      module.add.value(selectedValue, selectedText, $selected);
                      module.set.text(module.add.variables(message.count));
                      module.set.activeItem($selected);
                    }
                  }
                  else if(!isFiltered) {
                    module.debug('Selected active value, removing label');
                    module.remove.selected(selectedValue);
                  }
                }
                else {
                  if(settings.apiSettings && settings.saveRemoteData) {
                    module.save.remoteData(selectedText, selectedValue);
                  }
                  module.set.text(selectedText);
                  module.set.value(selectedValue, selectedText, $selected);
                  $selected
                    .addClass(className.active)
                    .addClass(className.selected)
                  ;
                }
              })
            ;
          },
          clearable: function() {
            $icon.addClass(className.clear);
          },
        },

        add: {
          label: function(value, text, shouldAnimate) {
            var
              $next  = module.is.searchSelection()
                ? $search
                : $text,
              escapedValue = module.escape.value(value),
              $label
            ;
            if(settings.ignoreCase) {
              escapedValue = escapedValue.toLowerCase();
            }
            $label =  $('<a />')
              .addClass(className.label)
              .attr('data-' + metadata.value, escapedValue)
              .html(templates.label(escapedValue, text))
            ;
            $label = settings.onLabelCreate.call($label, escapedValue, text);

            if(module.has.label(value)) {
              module.debug('User selection already exists, skipping', escapedValue);
              return;
            }
            if(settings.label.variation) {
              $label.addClass(settings.label.variation);
            }
            if(shouldAnimate === true) {
              module.debug('Animating in label', $label);
              $label
                .addClass(className.hidden)
                .insertBefore($next)
                .transition(settings.label.transition, settings.label.duration)
              ;
            }
            else {
              module.debug('Adding selection label', $label);
              $label
                .insertBefore($next)
              ;
            }
          },
          message: function(message) {
            var
              $message = $menu.children(selector.message),
              html     = settings.templates.message(module.add.variables(message))
            ;
            if($message.length > 0) {
              $message
                .html(html)
              ;
            }
            else {
              $message = $('<div/>')
                .html(html)
                .addClass(className.message)
                .appendTo($menu)
              ;
            }
          },
          optionValue: function(value) {
            var
              escapedValue = module.escape.value(value),
              $option      = $input.find('option[value="' + module.escape.string(escapedValue) + '"]'),
              hasOption    = ($option.length > 0)
            ;
            if(hasOption) {
              return;
            }
            // temporarily disconnect observer
            module.disconnect.selectObserver();
            if( module.is.single() ) {
              module.verbose('Removing previous user addition');
              $input.find('option.' + className.addition).remove();
            }
            $('<option/>')
              .prop('value', escapedValue)
              .addClass(className.addition)
              .html(value)
              .appendTo($input)
            ;
            module.verbose('Adding user addition as an <option>', value);
            module.observe.select();
          },
          userSuggestion: function(value) {
            var
              $addition         = $menu.children(selector.addition),
              $existingItem     = module.get.item(value),
              alreadyHasValue   = $existingItem && $existingItem.not(selector.addition).length,
              hasUserSuggestion = $addition.length > 0,
              html
            ;
            if(settings.useLabels && module.has.maxSelections()) {
              return;
            }
            if(value === '' || alreadyHasValue) {
              $addition.remove();
              return;
            }
            if(hasUserSuggestion) {
              $addition
                .data(metadata.value, value)
                .data(metadata.text, value)
                .attr('data-' + metadata.value, value)
                .attr('data-' + metadata.text, value)
                .removeClass(className.filtered)
              ;
              if(!settings.hideAdditions) {
                html = settings.templates.addition( module.add.variables(message.addResult, value) );
                $addition
                  .html(html)
                ;
              }
              module.verbose('Replacing user suggestion with new value', $addition);
            }
            else {
              $addition = module.create.userChoice(value);
              $addition
                .prependTo($menu)
              ;
              module.verbose('Adding item choice to menu corresponding with user choice addition', $addition);
            }
            if(!settings.hideAdditions || module.is.allFiltered()) {
              $addition
                .addClass(className.selected)
                .siblings()
                .removeClass(className.selected)
              ;
            }
            module.refreshItems();
          },
          variables: function(message, term) {
            var
              hasCount    = (message.search('{count}') !== -1),
              hasMaxCount = (message.search('{maxCount}') !== -1),
              hasTerm     = (message.search('{term}') !== -1),
              values,
              count,
              query
            ;
            module.verbose('Adding templated variables to message', message);
            if(hasCount) {
              count  = module.get.selectionCount();
              message = message.replace('{count}', count);
            }
            if(hasMaxCount) {
              count  = module.get.selectionCount();
              message = message.replace('{maxCount}', settings.maxSelections);
            }
            if(hasTerm) {
              query   = term || module.get.query();
              message = message.replace('{term}', query);
            }
            return message;
          },
          value: function(addedValue, addedText, $selectedItem) {
            var
              currentValue = module.get.values(),
              newValue
            ;
            if(module.has.value(addedValue)) {
              module.debug('Value already selected');
              return;
            }
            if(addedValue === '') {
              module.debug('Cannot select blank values from multiselect');
              return;
            }
            // extend current array
            if($.isArray(currentValue)) {
              newValue = currentValue.concat([addedValue]);
              newValue = module.get.uniqueArray(newValue);
            }
            else {
              newValue = [addedValue];
            }
            // add values
            if( module.has.selectInput() ) {
              if(module.can.extendSelect()) {
                module.debug('Adding value to select', addedValue, newValue, $input);
                module.add.optionValue(addedValue);
              }
            }
            else {
              newValue = newValue.join(settings.delimiter);
              module.debug('Setting hidden input to delimited value', newValue, $input);
            }

            if(settings.fireOnInit === false && module.is.initialLoad()) {
              module.verbose('Skipping onadd callback on initial load', settings.onAdd);
            }
            else {
              settings.onAdd.call(element, addedValue, addedText, $selectedItem);
            }
            module.set.value(newValue, addedValue, addedText, $selectedItem);
            module.check.maxSelections();
          },
        },

        remove: {
          active: function() {
            $module.removeClass(className.active);
          },
          activeLabel: function() {
            $module.find(selector.label).removeClass(className.active);
          },
          empty: function() {
            $module.removeClass(className.empty);
          },
          loading: function() {
            $module.removeClass(className.loading);
          },
          initialLoad: function() {
            initialLoad = false;
          },
          upward: function($currentMenu) {
            var $element = $currentMenu || $module;
            $element.removeClass(className.upward);
          },
          leftward: function($currentMenu) {
            var $element = $currentMenu || $menu;
            $element.removeClass(className.leftward);
          },
          visible: function() {
            $module.removeClass(className.visible);
          },
          activeItem: function() {
            $item.removeClass(className.active);
          },
          filteredItem: function() {
            if(settings.useLabels && module.has.maxSelections() ) {
              return;
            }
            if(settings.useLabels && module.is.multiple()) {
              $item.not('.' + className.active).removeClass(className.filtered);
            }
            else {
              $item.removeClass(className.filtered);
            }
            module.remove.empty();
          },
          optionValue: function(value) {
            var
              escapedValue = module.escape.value(value),
              $option      = $input.find('option[value="' + module.escape.string(escapedValue) + '"]'),
              hasOption    = ($option.length > 0)
            ;
            if(!hasOption || !$option.hasClass(className.addition)) {
              return;
            }
            // temporarily disconnect observer
            if(selectObserver) {
              selectObserver.disconnect();
              module.verbose('Temporarily disconnecting mutation observer');
            }
            $option.remove();
            module.verbose('Removing user addition as an <option>', escapedValue);
            if(selectObserver) {
              selectObserver.observe($input[0], {
                childList : true,
                subtree   : true
              });
            }
          },
          message: function() {
            $menu.children(selector.message).remove();
          },
          searchWidth: function() {
            $search.css('width', '');
          },
          searchTerm: function() {
            module.verbose('Cleared search term');
            $search.val('');
            module.set.filtered();
          },
          userAddition: function() {
            $item.filter(selector.addition).remove();
          },
          selected: function(value, $selectedItem) {
            $selectedItem = (settings.allowAdditions)
              ? $selectedItem || module.get.itemWithAdditions(value)
              : $selectedItem || module.get.item(value)
            ;

            if(!$selectedItem) {
              return false;
            }

            $selectedItem
              .each(function() {
                var
                  $selected     = $(this),
                  selectedText  = module.get.choiceText($selected),
                  selectedValue = module.get.choiceValue($selected, selectedText)
                ;
                if(module.is.multiple()) {
                  if(settings.useLabels) {
                    module.remove.value(selectedValue, selectedText, $selected);
                    module.remove.label(selectedValue);
                  }
                  else {
                    module.remove.value(selectedValue, selectedText, $selected);
                    if(module.get.selectionCount() === 0) {
                      module.set.placeholderText();
                    }
                    else {
                      module.set.text(module.add.variables(message.count));
                    }
                  }
                }
                else {
                  module.remove.value(selectedValue, selectedText, $selected);
                }
                $selected
                  .removeClass(className.filtered)
                  .removeClass(className.active)
                ;
                if(settings.useLabels) {
                  $selected.removeClass(className.selected);
                }
              })
            ;
          },
          selectedItem: function() {
            $item.removeClass(className.selected);
          },
          value: function(removedValue, removedText, $removedItem) {
            var
              values = module.get.values(),
              newValue
            ;
            if( module.has.selectInput() ) {
              module.verbose('Input is <select> removing selected option', removedValue);
              newValue = module.remove.arrayValue(removedValue, values);
              module.remove.optionValue(removedValue);
            }
            else {
              module.verbose('Removing from delimited values', removedValue);
              newValue = module.remove.arrayValue(removedValue, values);
              newValue = newValue.join(settings.delimiter);
            }
            if(settings.fireOnInit === false && module.is.initialLoad()) {
              module.verbose('No callback on initial load', settings.onRemove);
            }
            else {
              settings.onRemove.call(element, removedValue, removedText, $removedItem);
            }
            module.set.value(newValue, removedText, $removedItem);
            module.check.maxSelections();
          },
          arrayValue: function(removedValue, values) {
            if( !$.isArray(values) ) {
              values = [values];
            }
            values = $.grep(values, function(value){
              return (removedValue != value);
            });
            module.verbose('Removed value from delimited string', removedValue, values);
            return values;
          },
          label: function(value, shouldAnimate) {
            var
              $labels       = $module.find(selector.label),
              $removedLabel = $labels.filter('[data-' + metadata.value + '="' + module.escape.string(value) +'"]')
            ;
            module.verbose('Removing label', $removedLabel);
            $removedLabel.remove();
          },
          activeLabels: function($activeLabels) {
            $activeLabels = $activeLabels || $module.find(selector.label).filter('.' + className.active);
            module.verbose('Removing active label selections', $activeLabels);
            module.remove.labels($activeLabels);
          },
          labels: function($labels) {
            $labels = $labels || $module.find(selector.label);
            module.verbose('Removing labels', $labels);
            $labels
              .each(function(){
                var
                  $label      = $(this),
                  value       = $label.data(metadata.value),
                  stringValue = (value !== undefined)
                    ? String(value)
                    : value,
                  isUserValue = module.is.userValue(stringValue)
                ;
                if(settings.onLabelRemove.call($label, value) === false) {
                  module.debug('Label remove callback cancelled removal');
                  return;
                }
                module.remove.message();
                if(isUserValue) {
                  module.remove.value(stringValue);
                  module.remove.label(stringValue);
                }
                else {
                  // selected will also remove label
                  module.remove.selected(stringValue);
                }
              })
            ;
          },
          tabbable: function() {
            if( module.is.searchSelection() ) {
              module.debug('Searchable dropdown initialized');
              $search
                .removeAttr('tabindex')
              ;
              $menu
                .removeAttr('tabindex')
              ;
            }
            else {
              module.debug('Simple selection dropdown initialized');
              $module
                .removeAttr('tabindex')
              ;
              $menu
                .removeAttr('tabindex')
              ;
            }
          },
          clearable: function() {
            $icon.removeClass(className.clear);
          }
        },

        has: {
          menuSearch: function() {
            return (module.has.search() && $search.closest($menu).length > 0);
          },
          search: function() {
            return ($search.length > 0);
          },
          sizer: function() {
            return ($sizer.length > 0);
          },
          selectInput: function() {
            return ( $input.is('select') );
          },
          minCharacters: function(searchTerm) {
            if(settings.minCharacters) {
              searchTerm = (searchTerm !== undefined)
                ? String(searchTerm)
                : String(module.get.query())
              ;
              return (searchTerm.length >= settings.minCharacters);
            }
            return true;
          },
          firstLetter: function($item, letter) {
            var
              text,
              firstLetter
            ;
            if(!$item || $item.length === 0 || typeof letter !== 'string') {
              return false;
            }
            text        = module.get.choiceText($item, false);
            letter      = letter.toLowerCase();
            firstLetter = String(text).charAt(0).toLowerCase();
            return (letter == firstLetter);
          },
          input: function() {
            return ($input.length > 0);
          },
          items: function() {
            return ($item.length > 0);
          },
          menu: function() {
            return ($menu.length > 0);
          },
          message: function() {
            return ($menu.children(selector.message).length !== 0);
          },
          label: function(value) {
            var
              escapedValue = module.escape.value(value),
              $labels      = $module.find(selector.label)
            ;
            if(settings.ignoreCase) {
              escapedValue = escapedValue.toLowerCase();
            }
            return ($labels.filter('[data-' + metadata.value + '="' + module.escape.string(escapedValue) +'"]').length > 0);
          },
          maxSelections: function() {
            return (settings.maxSelections && module.get.selectionCount() >= settings.maxSelections);
          },
          allResultsFiltered: function() {
            var
              $normalResults = $item.not(selector.addition)
            ;
            return ($normalResults.filter(selector.unselectable).length === $normalResults.length);
          },
          userSuggestion: function() {
            return ($menu.children(selector.addition).length > 0);
          },
          query: function() {
            return (module.get.query() !== '');
          },
          value: function(value) {
            return (settings.ignoreCase)
              ? module.has.valueIgnoringCase(value)
              : module.has.valueMatchingCase(value)
            ;
          },
          valueMatchingCase: function(value) {
            var
              values   = module.get.values(),
              hasValue = $.isArray(values)
               ? values && ($.inArray(value, values) !== -1)
               : (values == value)
            ;
            return (hasValue)
              ? true
              : false
            ;
          },
          valueIgnoringCase: function(value) {
            var
              values   = module.get.values(),
              hasValue = false
            ;
            if(!$.isArray(values)) {
              values = [values];
            }
            $.each(values, function(index, existingValue) {
              if(String(value).toLowerCase() == String(existingValue).toLowerCase()) {
                hasValue = true;
                return false;
              }
            });
            return hasValue;
          }
        },

        is: {
          active: function() {
            return $module.hasClass(className.active);
          },
          animatingInward: function() {
            return $menu.transition('is inward');
          },
          animatingOutward: function() {
            return $menu.transition('is outward');
          },
          bubbledLabelClick: function(event) {
            return $(event.target).is('select, input') && $module.closest('label').length > 0;
          },
          bubbledIconClick: function(event) {
            return $(event.target).closest($icon).length > 0;
          },
          alreadySetup: function() {
            return ($module.is('select') && $module.parent(selector.dropdown).data(moduleNamespace) !== undefined && $module.prev().length === 0);
          },
          animating: function($subMenu) {
            return ($subMenu)
              ? $subMenu.transition && $subMenu.transition('is animating')
              : $menu.transition    && $menu.transition('is animating')
            ;
          },
          leftward: function($subMenu) {
            var $selectedMenu = $subMenu || $menu;
            return $selectedMenu.hasClass(className.leftward);
          },
          disabled: function() {
            return $module.hasClass(className.disabled);
          },
          focused: function() {
            return (document.activeElement === $module[0]);
          },
          focusedOnSearch: function() {
            return (document.activeElement === $search[0]);
          },
          allFiltered: function() {
            return( (module.is.multiple() || module.has.search()) && !(settings.hideAdditions == false && module.has.userSuggestion()) && !module.has.message() && module.has.allResultsFiltered() );
          },
          hidden: function($subMenu) {
            return !module.is.visible($subMenu);
          },
          initialLoad: function() {
            return initialLoad;
          },
          inObject: function(needle, object) {
            var
              found = false
            ;
            $.each(object, function(index, property) {
              if(property == needle) {
                found = true;
                return true;
              }
            });
            return found;
          },
          multiple: function() {
            return $module.hasClass(className.multiple);
          },
          remote: function() {
            return settings.apiSettings && module.can.useAPI();
          },
          single: function() {
            return !module.is.multiple();
          },
          selectMutation: function(mutations) {
            var
              selectChanged = false
            ;
            $.each(mutations, function(index, mutation) {
              if(mutation.target && $(mutation.target).is('select')) {
                selectChanged = true;
                return true;
              }
            });
            return selectChanged;
          },
          search: function() {
            return $module.hasClass(className.search);
          },
          searchSelection: function() {
            return ( module.has.search() && $search.parent(selector.dropdown).length === 1 );
          },
          selection: function() {
            return $module.hasClass(className.selection);
          },
          userValue: function(value) {
            return ($.inArray(value, module.get.userValues()) !== -1);
          },
          upward: function($menu) {
            var $element = $menu || $module;
            return $element.hasClass(className.upward);
          },
          visible: function($subMenu) {
            return ($subMenu)
              ? $subMenu.hasClass(className.visible)
              : $menu.hasClass(className.visible)
            ;
          },
          verticallyScrollableContext: function() {
            var
              overflowY = ($context.get(0) !== window)
                ? $context.css('overflow-y')
                : false
            ;
            return (overflowY == 'auto' || overflowY == 'scroll');
          },
          horizontallyScrollableContext: function() {
            var
              overflowX = ($context.get(0) !== window)
                ? $context.css('overflow-X')
                : false
            ;
            return (overflowX == 'auto' || overflowX == 'scroll');
          }
        },

        can: {
          activate: function($item) {
            if(settings.useLabels) {
              return true;
            }
            if(!module.has.maxSelections()) {
              return true;
            }
            if(module.has.maxSelections() && $item.hasClass(className.active)) {
              return true;
            }
            return false;
          },
          openDownward: function($subMenu) {
            var
              $currentMenu    = $subMenu || $menu,
              canOpenDownward = true,
              onScreen        = {},
              calculations
            ;
            $currentMenu
              .addClass(className.loading)
            ;
            calculations = {
              context: {
                offset    : ($context.get(0) === window)
                  ? { top: 0, left: 0}
                  : $context.offset(),
                scrollTop : $context.scrollTop(),
                height    : $context.outerHeight()
              },
              menu : {
                offset: $currentMenu.offset(),
                height: $currentMenu.outerHeight()
              }
            };
            if(module.is.verticallyScrollableContext()) {
              calculations.menu.offset.top += calculations.context.scrollTop;
            }
            onScreen = {
              above : (calculations.context.scrollTop) <= calculations.menu.offset.top - calculations.context.offset.top - calculations.menu.height,
              below : (calculations.context.scrollTop + calculations.context.height) >= calculations.menu.offset.top - calculations.context.offset.top + calculations.menu.height
            };
            if(onScreen.below) {
              module.verbose('Dropdown can fit in context downward', onScreen);
              canOpenDownward = true;
            }
            else if(!onScreen.below && !onScreen.above) {
              module.verbose('Dropdown cannot fit in either direction, favoring downward', onScreen);
              canOpenDownward = true;
            }
            else {
              module.verbose('Dropdown cannot fit below, opening upward', onScreen);
              canOpenDownward = false;
            }
            $currentMenu.removeClass(className.loading);
            return canOpenDownward;
          },
          openRightward: function($subMenu) {
            var
              $currentMenu     = $subMenu || $menu,
              canOpenRightward = true,
              isOffscreenRight = false,
              calculations
            ;
            $currentMenu
              .addClass(className.loading)
            ;
            calculations = {
              context: {
                offset     : ($context.get(0) === window)
                  ? { top: 0, left: 0}
                  : $context.offset(),
                scrollLeft : $context.scrollLeft(),
                width      : $context.outerWidth()
              },
              menu: {
                offset : $currentMenu.offset(),
                width  : $currentMenu.outerWidth()
              }
            };
            if(module.is.horizontallyScrollableContext()) {
              calculations.menu.offset.left += calculations.context.scrollLeft;
            }
            isOffscreenRight = (calculations.menu.offset.left - calculations.context.offset.left + calculations.menu.width >= calculations.context.scrollLeft + calculations.context.width);
            if(isOffscreenRight) {
              module.verbose('Dropdown cannot fit in context rightward', isOffscreenRight);
              canOpenRightward = false;
            }
            $currentMenu.removeClass(className.loading);
            return canOpenRightward;
          },
          click: function() {
            return (hasTouch || settings.on == 'click');
          },
          extendSelect: function() {
            return settings.allowAdditions || settings.apiSettings;
          },
          show: function() {
            return !module.is.disabled() && (module.has.items() || module.has.message());
          },
          useAPI: function() {
            return $.fn.api !== undefined;
          }
        },

        animate: {
          show: function(callback, $subMenu) {
            var
              $currentMenu = $subMenu || $menu,
              start = ($subMenu)
                ? function() {}
                : function() {
                  module.hideSubMenus();
                  module.hideOthers();
                  module.set.active();
                },
              transition
            ;
            callback = $.isFunction(callback)
              ? callback
              : function(){}
            ;
            module.verbose('Doing menu show animation', $currentMenu);
            module.set.direction($subMenu);
            transition = module.get.transition($subMenu);
            if( module.is.selection() ) {
              module.set.scrollPosition(module.get.selectedItem(), true);
            }
            if( module.is.hidden($currentMenu) || module.is.animating($currentMenu) ) {
              if(transition == 'none') {
                start();
                $currentMenu.transition('show');
                callback.call(element);
              }
              else if($.fn.transition !== undefined && $module.transition('is supported')) {
                $currentMenu
                  .transition({
                    animation  : transition + ' in',
                    debug      : settings.debug,
                    verbose    : settings.verbose,
                    duration   : settings.duration,
                    queue      : true,
                    onStart    : start,
                    onComplete : function() {
                      callback.call(element);
                    }
                  })
                ;
              }
              else {
                module.error(error.noTransition, transition);
              }
            }
          },
          hide: function(callback, $subMenu) {
            var
              $currentMenu = $subMenu || $menu,
              duration = ($subMenu)
                ? (settings.duration * 0.9)
                : settings.duration,
              start = ($subMenu)
                ? function() {}
                : function() {
                  if( module.can.click() ) {
                    module.unbind.intent();
                  }
                  module.remove.active();
                },
              transition = module.get.transition($subMenu)
            ;
            callback = $.isFunction(callback)
              ? callback
              : function(){}
            ;
            if( module.is.visible($currentMenu) || module.is.animating($currentMenu) ) {
              module.verbose('Doing menu hide animation', $currentMenu);

              if(transition == 'none') {
                start();
                $currentMenu.transition('hide');
                callback.call(element);
              }
              else if($.fn.transition !== undefined && $module.transition('is supported')) {
                $currentMenu
                  .transition({
                    animation  : transition + ' out',
                    duration   : settings.duration,
                    debug      : settings.debug,
                    verbose    : settings.verbose,
                    queue      : false,
                    onStart    : start,
                    onComplete : function() {
                      callback.call(element);
                    }
                  })
                ;
              }
              else {
                module.error(error.transition);
              }
            }
          }
        },

        hideAndClear: function() {
          module.remove.searchTerm();
          if( module.has.maxSelections() ) {
            return;
          }
          if(module.has.search()) {
            module.hide(function() {
              module.remove.filteredItem();
            });
          }
          else {
            module.hide();
          }
        },

        delay: {
          show: function() {
            module.verbose('Delaying show event to ensure user intent');
            clearTimeout(module.timer);
            module.timer = setTimeout(module.show, settings.delay.show);
          },
          hide: function() {
            module.verbose('Delaying hide event to ensure user intent');
            clearTimeout(module.timer);
            module.timer = setTimeout(module.hide, settings.delay.hide);
          }
        },

        escape: {
          value: function(value) {
            var
              multipleValues = $.isArray(value),
              stringValue    = (typeof value === 'string'),
              isUnparsable   = (!stringValue && !multipleValues),
              hasQuotes      = (stringValue && value.search(regExp.quote) !== -1),
              values         = []
            ;
            if(isUnparsable || !hasQuotes) {
              return value;
            }
            module.debug('Encoding quote values for use in select', value);
            if(multipleValues) {
              $.each(value, function(index, value){
                values.push(value.replace(regExp.quote, '&quot;'));
              });
              return values;
            }
            return value.replace(regExp.quote, '&quot;');
          },
          string: function(text) {
            text =  String(text);
            return text.replace(regExp.escape, '\\$&');
          }
        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                module.error(error.method, query);
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;
  return (returnedValue !== undefined)
    ? returnedValue
    : $allModules
  ;
};

$.fn.dropdown.settings = {

  silent                 : false,
  debug                  : false,
  verbose                : false,
  performance            : true,

  on                     : 'click',    // what event should show menu action on item selection
  action                 : 'activate', // action on item selection (nothing, activate, select, combo, hide, function(){})

  values                 : false,      // specify values to use for dropdown

  clearable              : false,      // whether the value of the dropdown can be cleared

  apiSettings            : false,
  selectOnKeydown        : true,       // Whether selection should occur automatically when keyboard shortcuts used
  minCharacters          : 0,          // Minimum characters required to trigger API call

  filterRemoteData       : false,      // Whether API results should be filtered after being returned for query term
  saveRemoteData         : true,       // Whether remote name/value pairs should be stored in sessionStorage to allow remote data to be restored on page refresh

  throttle               : 200,        // How long to wait after last user input to search remotely

  context                : window,     // Context to use when determining if on screen
  direction              : 'auto',     // Whether dropdown should always open in one direction
  keepOnScreen           : true,       // Whether dropdown should check whether it is on screen before showing

  match                  : 'both',     // what to match against with search selection (both, text, or label)
  fullTextSearch         : false,      // search anywhere in value (set to 'exact' to require exact matches)

  placeholder            : 'auto',     // whether to convert blank <select> values to placeholder text
  preserveHTML           : true,       // preserve html when selecting value
  sortSelect             : false,      // sort selection on init

  forceSelection         : true,       // force a choice on blur with search selection

  allowAdditions         : false,      // whether multiple select should allow user added values
  ignoreCase             : false,       // whether to consider values not matching in case to be the same
  hideAdditions          : true,       // whether or not to hide special message prompting a user they can enter a value

  maxSelections          : false,      // When set to a number limits the number of selections to this count
  useLabels              : true,       // whether multiple select should filter currently active selections from choices
  delimiter              : ',',        // when multiselect uses normal <input> the values will be delimited with this character

  showOnFocus            : true,       // show menu on focus
  allowReselection       : false,      // whether current value should trigger callbacks when reselected
  allowTab               : true,       // add tabindex to element
  allowCategorySelection : false,      // allow elements with sub-menus to be selected

  fireOnInit             : false,      // Whether callbacks should fire when initializing dropdown values

  transition             : 'auto',     // auto transition will slide down or up based on direction
  duration               : 200,        // duration of transition

  glyphWidth             : 1.037,      // widest glyph width in em (W is 1.037 em) used to calculate multiselect input width

  // label settings on multi-select
  label: {
    transition : 'scale',
    duration   : 200,
    variation  : false
  },

  // delay before event
  delay : {
    hide   : 300,
    show   : 200,
    search : 20,
    touch  : 50
  },

  /* Callbacks */
  onChange      : function(value, text, $selected){},
  onAdd         : function(value, text, $selected){},
  onRemove      : function(value, text, $selected){},

  onLabelSelect : function($selectedLabels){},
  onLabelCreate : function(value, text) { return $(this); },
  onLabelRemove : function(value) { return true; },
  onNoResults   : function(searchTerm) { return true; },
  onShow        : function(){},
  onHide        : function(){},

  /* Component */
  name           : 'Dropdown',
  namespace      : 'dropdown',

  message: {
    addResult     : 'Add <b>{term}</b>',
    count         : '{count} selected',
    maxSelections : 'Max {maxCount} selections',
    noResults     : 'No results found.',
    serverError   : 'There was an error contacting the server'
  },

  error : {
    action          : 'You called a dropdown action that was not defined',
    alreadySetup    : 'Once a select has been initialized behaviors must be called on the created ui dropdown',
    labels          : 'Allowing user additions currently requires the use of labels.',
    missingMultiple : '<select> requires multiple property to be set to correctly preserve multiple values',
    method          : 'The method you called is not defined.',
    noAPI           : 'The API module is required to load resources remotely',
    noStorage       : 'Saving remote data requires session storage',
    noTransition    : 'This module requires ui transitions <https://github.com/Semantic-Org/UI-Transition>'
  },

  regExp : {
    escape   : /[-[\]{}()*+?.,\\^$|#\s]/g,
    quote    : /"/g
  },

  metadata : {
    defaultText     : 'defaultText',
    defaultValue    : 'defaultValue',
    placeholderText : 'placeholder',
    text            : 'text',
    value           : 'value'
  },

  // property names for remote query
  fields: {
    remoteValues : 'results',  // grouping for api results
    values       : 'values',   // grouping for all dropdown values
    disabled     : 'disabled', // whether value should be disabled
    name         : 'name',     // displayed dropdown text
    value        : 'value',    // actual dropdown value
    text         : 'text'      // displayed text when selected
  },

  keys : {
    backspace  : 8,
    delimiter  : 188, // comma
    deleteKey  : 46,
    enter      : 13,
    escape     : 27,
    pageUp     : 33,
    pageDown   : 34,
    leftArrow  : 37,
    upArrow    : 38,
    rightArrow : 39,
    downArrow  : 40
  },

  selector : {
    addition     : '.addition',
    dropdown     : '.ui.dropdown',
    hidden       : '.hidden',
    icon         : '> .dropdown.icon',
    input        : '> input[type="hidden"], > select',
    item         : '.item',
    label        : '> .label',
    remove       : '> .label > .delete.icon',
    siblingLabel : '.label',
    menu         : '.menu',
    message      : '.message',
    menuIcon     : '.dropdown.icon',
    search       : 'input.search, .menu > .search > input, .menu input.search',
    sizer        : '> input.sizer',
    text         : '> .text:not(.icon)',
    unselectable : '.disabled, .filtered'
  },

  className : {
    active      : 'active',
    addition    : 'addition',
    animating   : 'animating',
    clear       : 'clear',
    disabled    : 'disabled',
    empty       : 'empty',
    dropdown    : 'ui dropdown',
    filtered    : 'filtered',
    hidden      : 'hidden transition',
    item        : 'item',
    label       : 'ui label',
    loading     : 'loading',
    menu        : 'menu',
    message     : 'message',
    multiple    : 'multiple',
    placeholder : 'default',
    sizer       : 'sizer',
    search      : 'search',
    selected    : 'selected',
    selection   : 'selection',
    upward      : 'upward',
    leftward    : 'left',
    visible     : 'visible'
  }

};

/* Templates */
$.fn.dropdown.settings.templates = {

  // generates dropdown from select values
  dropdown: function(select) {
    var
      placeholder = select.placeholder || false,
      values      = select.values || {},
      html        = ''
    ;
    html +=  '<i class="dropdown icon"></i>';
    if(select.placeholder) {
      html += '<div class="default text">' + placeholder + '</div>';
    }
    else {
      html += '<div class="text"></div>';
    }
    html += '<div class="menu">';
    $.each(select.values, function(index, option) {
      html += (option.disabled)
        ? '<div class="disabled item" data-value="' + option.value + '">' + option.name + '</div>'
        : '<div class="item" data-value="' + option.value + '">' + option.name + '</div>'
      ;
    });
    html += '</div>';
    return html;
  },

  // generates just menu from select
  menu: function(response, fields) {
    var
      values = response[fields.values] || {},
      html   = ''
    ;
    $.each(values, function(index, option) {
      var
        maybeText = (option[fields.text])
          ? 'data-text="' + option[fields.text] + '"'
          : '',
        maybeDisabled = (option[fields.disabled])
          ? 'disabled '
          : ''
      ;
      html += '<div class="'+ maybeDisabled +'item" data-value="' + option[fields.value] + '"' + maybeText + '>';
      html +=   option[fields.name];
      html += '</div>';
    });
    return html;
  },

  // generates label for multiselect
  label: function(value, text) {
    return text + '<i class="delete icon"></i>';
  },


  // generates messages like "No results"
  message: function(message) {
    return message;
  },

  // generates user addition to selection menu
  addition: function(choice) {
    return choice;
  }

};

})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Embed
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.embed = function(parameters) {

  var
    $allModules     = $(this),

    moduleSelector  = $allModules.selector || '',

    time            = new Date().getTime(),
    performance     = [],

    query           = arguments[0],
    methodInvoked   = (typeof query == 'string'),
    queryArguments  = [].slice.call(arguments, 1),

    returnedValue
  ;

  $allModules
    .each(function() {
      var
        settings        = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.embed.settings, parameters)
          : $.extend({}, $.fn.embed.settings),

        selector        = settings.selector,
        className       = settings.className,
        sources         = settings.sources,
        error           = settings.error,
        metadata        = settings.metadata,
        namespace       = settings.namespace,
        templates       = settings.templates,

        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,

        $window         = $(window),
        $module         = $(this),
        $placeholder    = $module.find(selector.placeholder),
        $icon           = $module.find(selector.icon),
        $embed          = $module.find(selector.embed),

        element         = this,
        instance        = $module.data(moduleNamespace),
        module
      ;

      module = {

        initialize: function() {
          module.debug('Initializing embed');
          module.determine.autoplay();
          module.create();
          module.bind.events();
          module.instantiate();
        },

        instantiate: function() {
          module.verbose('Storing instance of module', module);
          instance = module;
          $module
            .data(moduleNamespace, module)
          ;
        },

        destroy: function() {
          module.verbose('Destroying previous instance of embed');
          module.reset();
          $module
            .removeData(moduleNamespace)
            .off(eventNamespace)
          ;
        },

        refresh: function() {
          module.verbose('Refreshing selector cache');
          $placeholder = $module.find(selector.placeholder);
          $icon        = $module.find(selector.icon);
          $embed       = $module.find(selector.embed);
        },

        bind: {
          events: function() {
            if( module.has.placeholder() ) {
              module.debug('Adding placeholder events');
              $module
                .on('click' + eventNamespace, selector.placeholder, module.createAndShow)
                .on('click' + eventNamespace, selector.icon, module.createAndShow)
              ;
            }
          }
        },

        create: function() {
          var
            placeholder = module.get.placeholder()
          ;
          if(placeholder) {
            module.createPlaceholder();
          }
          else {
            module.createAndShow();
          }
        },

        createPlaceholder: function(placeholder) {
          var
            icon  = module.get.icon(),
            url   = module.get.url(),
            embed = module.generate.embed(url)
          ;
          placeholder = placeholder || module.get.placeholder();
          $module.html( templates.placeholder(placeholder, icon) );
          module.debug('Creating placeholder for embed', placeholder, icon);
        },

        createEmbed: function(url) {
          module.refresh();
          url = url || module.get.url();
          $embed = $('<div/>')
            .addClass(className.embed)
            .html( module.generate.embed(url) )
            .appendTo($module)
          ;
          settings.onCreate.call(element, url);
          module.debug('Creating embed object', $embed);
        },

        changeEmbed: function(url) {
          $embed
            .html( module.generate.embed(url) )
          ;
        },

        createAndShow: function() {
          module.createEmbed();
          module.show();
        },

        // sets new embed
        change: function(source, id, url) {
          module.debug('Changing video to ', source, id, url);
          $module
            .data(metadata.source, source)
            .data(metadata.id, id)
          ;
          if(url) {
            $module.data(metadata.url, url);
          }
          else {
            $module.removeData(metadata.url);
          }
          if(module.has.embed()) {
            module.changeEmbed();
          }
          else {
            module.create();
          }
        },

        // clears embed
        reset: function() {
          module.debug('Clearing embed and showing placeholder');
          module.remove.active();
          module.remove.embed();
          module.showPlaceholder();
          settings.onReset.call(element);
        },

        // shows current embed
        show: function() {
          module.debug('Showing embed');
          module.set.active();
          settings.onDisplay.call(element);
        },

        hide: function() {
          module.debug('Hiding embed');
          module.showPlaceholder();
        },

        showPlaceholder: function() {
          module.debug('Showing placeholder image');
          module.remove.active();
          settings.onPlaceholderDisplay.call(element);
        },

        get: {
          id: function() {
            return settings.id || $module.data(metadata.id);
          },
          placeholder: function() {
            return settings.placeholder || $module.data(metadata.placeholder);
          },
          icon: function() {
            return (settings.icon)
              ? settings.icon
              : ($module.data(metadata.icon) !== undefined)
                ? $module.data(metadata.icon)
                : module.determine.icon()
            ;
          },
          source: function(url) {
            return (settings.source)
              ? settings.source
              : ($module.data(metadata.source) !== undefined)
                ? $module.data(metadata.source)
                : module.determine.source()
            ;
          },
          type: function() {
            var source = module.get.source();
            return (sources[source] !== undefined)
              ? sources[source].type
              : false
            ;
          },
          url: function() {
            return (settings.url)
              ? settings.url
              : ($module.data(metadata.url) !== undefined)
                ? $module.data(metadata.url)
                : module.determine.url()
            ;
          }
        },

        determine: {
          autoplay: function() {
            if(module.should.autoplay()) {
              settings.autoplay = true;
            }
          },
          source: function(url) {
            var
              matchedSource = false
            ;
            url = url || module.get.url();
            if(url) {
              $.each(sources, function(name, source) {
                if(url.search(source.domain) !== -1) {
                  matchedSource = name;
                  return false;
                }
              });
            }
            return matchedSource;
          },
          icon: function() {
            var
              source = module.get.source()
            ;
            return (sources[source] !== undefined)
              ? sources[source].icon
              : false
            ;
          },
          url: function() {
            var
              id     = settings.id     || $module.data(metadata.id),
              source = settings.source || $module.data(metadata.source),
              url
            ;
            url = (sources[source] !== undefined)
              ? sources[source].url.replace('{id}', id)
              : false
            ;
            if(url) {
              $module.data(metadata.url, url);
            }
            return url;
          }
        },


        set: {
          active: function() {
            $module.addClass(className.active);
          }
        },

        remove: {
          active: function() {
            $module.removeClass(className.active);
          },
          embed: function() {
            $embed.empty();
          }
        },

        encode: {
          parameters: function(parameters) {
            var
              urlString = [],
              index
            ;
            for (index in parameters) {
              urlString.push( encodeURIComponent(index) + '=' + encodeURIComponent( parameters[index] ) );
            }
            return urlString.join('&amp;');
          }
        },

        generate: {
          embed: function(url) {
            module.debug('Generating embed html');
            var
              source = module.get.source(),
              html,
              parameters
            ;
            url = module.get.url(url);
            if(url) {
              parameters = module.generate.parameters(source);
              html       = templates.iframe(url, parameters);
            }
            else {
              module.error(error.noURL, $module);
            }
            return html;
          },
          parameters: function(source, extraParameters) {
            var
              parameters = (sources[source] && sources[source].parameters !== undefined)
                ? sources[source].parameters(settings)
                : {}
            ;
            extraParameters = extraParameters || settings.parameters;
            if(extraParameters) {
              parameters = $.extend({}, parameters, extraParameters);
            }
            parameters = settings.onEmbed(parameters);
            return module.encode.parameters(parameters);
          }
        },

        has: {
          embed: function() {
            return ($embed.length > 0);
          },
          placeholder: function() {
            return settings.placeholder || $module.data(metadata.placeholder);
          }
        },

        should: {
          autoplay: function() {
            return (settings.autoplay === 'auto')
              ? (settings.placeholder || $module.data(metadata.placeholder) !== undefined)
              : settings.autoplay
            ;
          }
        },

        is: {
          video: function() {
            return module.get.type() == 'video';
          }
        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if($allModules.length > 1) {
              title += ' ' + '(' + $allModules.length + ')';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                module.error(error.method, query);
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;
  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.embed.settings = {

  name        : 'Embed',
  namespace   : 'embed',

  silent      : false,
  debug       : false,
  verbose     : false,
  performance : true,

  icon     : false,
  source   : false,
  url      : false,
  id       : false,

  // standard video settings
  autoplay  : 'auto',
  color     : '#444444',
  hd        : true,
  brandedUI : false,

  // additional parameters to include with the embed
  parameters: false,

  onDisplay            : function() {},
  onPlaceholderDisplay : function() {},
  onReset              : function() {},
  onCreate             : function(url) {},
  onEmbed              : function(parameters) {
    return parameters;
  },

  metadata    : {
    id          : 'id',
    icon        : 'icon',
    placeholder : 'placeholder',
    source      : 'source',
    url         : 'url'
  },

  error : {
    noURL  : 'No URL specified',
    method : 'The method you called is not defined'
  },

  className : {
    active : 'active',
    embed  : 'embed'
  },

  selector : {
    embed       : '.embed',
    placeholder : '.placeholder',
    icon        : '.icon'
  },

  sources: {
    youtube: {
      name   : 'youtube',
      type   : 'video',
      icon   : 'video play',
      domain : 'youtube.com',
      url    : '//www.youtube.com/embed/{id}',
      parameters: function(settings) {
        return {
          autohide       : !settings.brandedUI,
          autoplay       : settings.autoplay,
          color          : settings.color || undefined,
          hq             : settings.hd,
          jsapi          : settings.api,
          modestbranding : !settings.brandedUI
        };
      }
    },
    vimeo: {
      name   : 'vimeo',
      type   : 'video',
      icon   : 'video play',
      domain : 'vimeo.com',
      url    : '//player.vimeo.com/video/{id}',
      parameters: function(settings) {
        return {
          api      : settings.api,
          autoplay : settings.autoplay,
          byline   : settings.brandedUI,
          color    : settings.color || undefined,
          portrait : settings.brandedUI,
          title    : settings.brandedUI
        };
      }
    }
  },

  templates: {
    iframe : function(url, parameters) {
      var src = url;
      if (parameters) {
          src += '?' + parameters;
      }
      return ''
        + '<iframe src="' + src + '"'
        + ' width="100%" height="100%"'
        + ' frameborder="0" scrolling="no" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'
      ;
    },
    placeholder : function(image, icon) {
      var
        html = ''
      ;
      if(icon) {
        html += '<i class="' + icon + ' icon"></i>';
      }
      if(image) {
        html += '<img class="placeholder" src="' + image + '">';
      }
      return html;
    }
  },

  // NOT YET IMPLEMENTED
  api     : false,
  onPause : function() {},
  onPlay  : function() {},
  onStop  : function() {}

};



})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Modal
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.modal = function(parameters) {
  var
    $allModules    = $(this),
    $window        = $(window),
    $document      = $(document),
    $body          = $('body'),

    moduleSelector = $allModules.selector || '',

    time           = new Date().getTime(),
    performance    = [],

    query          = arguments[0],
    methodInvoked  = (typeof query == 'string'),
    queryArguments = [].slice.call(arguments, 1),

    requestAnimationFrame = window.requestAnimationFrame
      || window.mozRequestAnimationFrame
      || window.webkitRequestAnimationFrame
      || window.msRequestAnimationFrame
      || function(callback) { setTimeout(callback, 0); },

    returnedValue
  ;

  $allModules
    .each(function() {
      var
        settings    = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.modal.settings, parameters)
          : $.extend({}, $.fn.modal.settings),

        selector        = settings.selector,
        className       = settings.className,
        namespace       = settings.namespace,
        error           = settings.error,

        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,

        $module         = $(this),
        $context        = $(settings.context),
        $close          = $module.find(selector.close),

        $allModals,
        $otherModals,
        $focusedElement,
        $dimmable,
        $dimmer,

        element         = this,
        instance        = $module.data(moduleNamespace),

        ignoreRepeatedEvents = false,

        elementEventNamespace,
        id,
        observer,
        module
      ;
      module  = {

        initialize: function() {
          module.verbose('Initializing dimmer', $context);

          module.create.id();
          module.create.dimmer();
          module.refreshModals();

          module.bind.events();
          if(settings.observeChanges) {
            module.observeChanges();
          }
          module.instantiate();
        },

        instantiate: function() {
          module.verbose('Storing instance of modal');
          instance = module;
          $module
            .data(moduleNamespace, instance)
          ;
        },

        create: {
          dimmer: function() {
            var
              defaultSettings = {
                debug      : settings.debug,
                variation  : settings.centered
                  ? false
                  : 'top aligned',
                dimmerName : 'modals'
              },
              dimmerSettings = $.extend(true, defaultSettings, settings.dimmerSettings)
            ;
            if($.fn.dimmer === undefined) {
              module.error(error.dimmer);
              return;
            }
            module.debug('Creating dimmer');
            $dimmable = $context.dimmer(dimmerSettings);
            if(settings.detachable) {
              module.verbose('Modal is detachable, moving content into dimmer');
              $dimmable.dimmer('add content', $module);
            }
            else {
              module.set.undetached();
            }
            $dimmer = $dimmable.dimmer('get dimmer');
          },
          id: function() {
            id = (Math.random().toString(16) + '000000000').substr(2, 8);
            elementEventNamespace = '.' + id;
            module.verbose('Creating unique id for element', id);
          }
        },

        destroy: function() {
          module.verbose('Destroying previous modal');
          $module
            .removeData(moduleNamespace)
            .off(eventNamespace)
          ;
          $window.off(elementEventNamespace);
          $dimmer.off(elementEventNamespace);
          $close.off(eventNamespace);
          $context.dimmer('destroy');
        },

        observeChanges: function() {
          if('MutationObserver' in window) {
            observer = new MutationObserver(function(mutations) {
              module.debug('DOM tree modified, refreshing');
              module.refresh();
            });
            observer.observe(element, {
              childList : true,
              subtree   : true
            });
            module.debug('Setting up mutation observer', observer);
          }
        },

        refresh: function() {
          module.remove.scrolling();
          module.cacheSizes();
          if(!module.can.useFlex()) {
            module.set.modalOffset();
          }
          module.set.screenHeight();
          module.set.type();
        },

        refreshModals: function() {
          $otherModals = $module.siblings(selector.modal);
          $allModals   = $otherModals.add($module);
        },

        attachEvents: function(selector, event) {
          var
            $toggle = $(selector)
          ;
          event = $.isFunction(module[event])
            ? module[event]
            : module.toggle
          ;
          if($toggle.length > 0) {
            module.debug('Attaching modal events to element', selector, event);
            $toggle
              .off(eventNamespace)
              .on('click' + eventNamespace, event)
            ;
          }
          else {
            module.error(error.notFound, selector);
          }
        },

        bind: {
          events: function() {
            module.verbose('Attaching events');
            $module
              .on('click' + eventNamespace, selector.close, module.event.close)
              .on('click' + eventNamespace, selector.approve, module.event.approve)
              .on('click' + eventNamespace, selector.deny, module.event.deny)
            ;
            $window
              .on('resize' + elementEventNamespace, module.event.resize)
            ;
          },
          scrollLock: function() {
            // touch events default to passive, due to changes in chrome to optimize mobile perf
            $dimmable.get(0).addEventListener('touchmove', module.event.preventScroll, { passive: false });
          }
        },

        unbind: {
          scrollLock: function() {
            $dimmable.get(0).removeEventListener('touchmove', module.event.preventScroll, { passive: false });
          }
        },

        get: {
          id: function() {
            return (Math.random().toString(16) + '000000000').substr(2, 8);
          }
        },

        event: {
          approve: function() {
            if(ignoreRepeatedEvents || settings.onApprove.call(element, $(this)) === false) {
              module.verbose('Approve callback returned false cancelling hide');
              return;
            }
            ignoreRepeatedEvents = true;
            module.hide(function() {
              ignoreRepeatedEvents = false;
            });
          },
          preventScroll: function(event) {
            event.preventDefault();
          },
          deny: function() {
            if(ignoreRepeatedEvents || settings.onDeny.call(element, $(this)) === false) {
              module.verbose('Deny callback returned false cancelling hide');
              return;
            }
            ignoreRepeatedEvents = true;
            module.hide(function() {
              ignoreRepeatedEvents = false;
            });
          },
          close: function() {
            module.hide();
          },
          click: function(event) {
            if(!settings.closable) {
              module.verbose('Dimmer clicked but closable setting is disabled');
              return;
            }
            var
              $target   = $(event.target),
              isInModal = ($target.closest(selector.modal).length > 0),
              isInDOM   = $.contains(document.documentElement, event.target)
            ;
            if(!isInModal && isInDOM && module.is.active()) {
              module.debug('Dimmer clicked, hiding all modals');
              module.remove.clickaway();
              if(settings.allowMultiple) {
                module.hide();
              }
              else {
                module.hideAll();
              }
            }
          },
          debounce: function(method, delay) {
            clearTimeout(module.timer);
            module.timer = setTimeout(method, delay);
          },
          keyboard: function(event) {
            var
              keyCode   = event.which,
              escapeKey = 27
            ;
            if(keyCode == escapeKey) {
              if(settings.closable) {
                module.debug('Escape key pressed hiding modal');
                module.hide();
              }
              else {
                module.debug('Escape key pressed, but closable is set to false');
              }
              event.preventDefault();
            }
          },
          resize: function() {
            if( $dimmable.dimmer('is active') && ( module.is.animating() || module.is.active() ) ) {
              requestAnimationFrame(module.refresh);
            }
          }
        },

        toggle: function() {
          if( module.is.active() || module.is.animating() ) {
            module.hide();
          }
          else {
            module.show();
          }
        },

        show: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          module.refreshModals();
          module.set.dimmerSettings();
          module.set.dimmerStyles();

          module.showModal(callback);
        },

        hide: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          module.refreshModals();
          module.hideModal(callback);
        },

        showModal: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          if( module.is.animating() || !module.is.active() ) {
            module.showDimmer();
            module.cacheSizes();
            if(module.can.useFlex()) {
              module.remove.legacy();
            }
            else {
              module.set.legacy();
              module.set.modalOffset();
              module.debug('Using non-flex legacy modal positioning.');
            }
            module.set.screenHeight();
            module.set.type();
            module.set.clickaway();

            if( !settings.allowMultiple && module.others.active() ) {
              module.hideOthers(module.showModal);
            }
            else {
              if(settings.allowMultiple && settings.detachable) {
                $module.detach().appendTo($dimmer);
              }
              settings.onShow.call(element);
              if(settings.transition && $.fn.transition !== undefined && $module.transition('is supported')) {
                module.debug('Showing modal with css animations');
                $module
                  .transition({
                    debug       : settings.debug,
                    animation   : settings.transition + ' in',
                    queue       : settings.queue,
                    duration    : settings.duration,
                    useFailSafe : true,
                    onComplete : function() {
                      settings.onVisible.apply(element);
                      if(settings.keyboardShortcuts) {
                        module.add.keyboardShortcuts();
                      }
                      module.save.focus();
                      module.set.active();
                      if(settings.autofocus) {
                        module.set.autofocus();
                      }
                      callback();
                    }
                  })
                ;
              }
              else {
                module.error(error.noTransition);
              }
            }
          }
          else {
            module.debug('Modal is already visible');
          }
        },

        hideModal: function(callback, keepDimmed) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          module.debug('Hiding modal');
          if(settings.onHide.call(element, $(this)) === false) {
            module.verbose('Hide callback returned false cancelling hide');
            return;
          }

          if( module.is.animating() || module.is.active() ) {
            if(settings.transition && $.fn.transition !== undefined && $module.transition('is supported')) {
              module.remove.active();
              $module
                .transition({
                  debug       : settings.debug,
                  animation   : settings.transition + ' out',
                  queue       : settings.queue,
                  duration    : settings.duration,
                  useFailSafe : true,
                  onStart     : function() {
                    if(!module.others.active() && !keepDimmed) {
                      module.hideDimmer();
                    }
                    if(settings.keyboardShortcuts) {
                      module.remove.keyboardShortcuts();
                    }
                  },
                  onComplete : function() {
                    settings.onHidden.call(element);
                    module.remove.dimmerStyles();
                    module.restore.focus();
                    callback();
                  }
                })
              ;
            }
            else {
              module.error(error.noTransition);
            }
          }
        },

        showDimmer: function() {
          if($dimmable.dimmer('is animating') || !$dimmable.dimmer('is active') ) {
            module.debug('Showing dimmer');
            $dimmable.dimmer('show');
          }
          else {
            module.debug('Dimmer already visible');
          }
        },

        hideDimmer: function() {
          if( $dimmable.dimmer('is animating') || ($dimmable.dimmer('is active')) ) {
            module.unbind.scrollLock();
            $dimmable.dimmer('hide', function() {
              module.remove.clickaway();
              module.remove.screenHeight();
            });
          }
          else {
            module.debug('Dimmer is not visible cannot hide');
            return;
          }
        },

        hideAll: function(callback) {
          var
            $visibleModals = $allModals.filter('.' + className.active + ', .' + className.animating)
          ;
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          if( $visibleModals.length > 0 ) {
            module.debug('Hiding all visible modals');
            module.hideDimmer();
            $visibleModals
              .modal('hide modal', callback)
            ;
          }
        },

        hideOthers: function(callback) {
          var
            $visibleModals = $otherModals.filter('.' + className.active + ', .' + className.animating)
          ;
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          if( $visibleModals.length > 0 ) {
            module.debug('Hiding other modals', $otherModals);
            $visibleModals
              .modal('hide modal', callback, true)
            ;
          }
        },

        others: {
          active: function() {
            return ($otherModals.filter('.' + className.active).length > 0);
          },
          animating: function() {
            return ($otherModals.filter('.' + className.animating).length > 0);
          }
        },


        add: {
          keyboardShortcuts: function() {
            module.verbose('Adding keyboard shortcuts');
            $document
              .on('keyup' + eventNamespace, module.event.keyboard)
            ;
          }
        },

        save: {
          focus: function() {
            var
              $activeElement = $(document.activeElement),
              inCurrentModal = $activeElement.closest($module).length > 0
            ;
            if(!inCurrentModal) {
              $focusedElement = $(document.activeElement).blur();
            }
          }
        },

        restore: {
          focus: function() {
            if($focusedElement && $focusedElement.length > 0) {
              $focusedElement.focus();
            }
          }
        },

        remove: {
          active: function() {
            $module.removeClass(className.active);
          },
          legacy: function() {
            $module.removeClass(className.legacy);
          },
          clickaway: function() {
            $dimmer
              .off('click' + elementEventNamespace)
            ;
          },
          dimmerStyles: function() {
            $dimmer.removeClass(className.inverted);
            $dimmable.removeClass(className.blurring);
          },
          bodyStyle: function() {
            if($body.attr('style') === '') {
              module.verbose('Removing style attribute');
              $body.removeAttr('style');
            }
          },
          screenHeight: function() {
            module.debug('Removing page height');
            $body
              .css('height', '')
            ;
          },
          keyboardShortcuts: function() {
            module.verbose('Removing keyboard shortcuts');
            $document
              .off('keyup' + eventNamespace)
            ;
          },
          scrolling: function() {
            $dimmable.removeClass(className.scrolling);
            $module.removeClass(className.scrolling);
          }
        },

        cacheSizes: function() {
          $module.addClass(className.loading);
          var
            scrollHeight = $module.prop('scrollHeight'),
            modalWidth   = $module.outerWidth(),
            modalHeight  = $module.outerHeight()
          ;
          if(module.cache === undefined || modalHeight !== 0) {
            module.cache = {
              pageHeight    : $(document).outerHeight(),
              width         : modalWidth,
              height        : modalHeight + settings.offset,
              scrollHeight  : scrollHeight + settings.offset,
              contextHeight : (settings.context == 'body')
                ? $(window).height()
                : $dimmable.height(),
            };
            module.cache.topOffset = -(module.cache.height / 2);
          }
          $module.removeClass(className.loading);
          module.debug('Caching modal and container sizes', module.cache);
        },

        can: {
          useFlex: function() {
            return (settings.useFlex == 'auto')
              ? settings.detachable && !module.is.ie()
              : settings.useFlex
            ;
          },
          fit: function() {
            var
              contextHeight  = module.cache.contextHeight,
              verticalCenter = module.cache.contextHeight / 2,
              topOffset      = module.cache.topOffset,
              scrollHeight   = module.cache.scrollHeight,
              height         = module.cache.height,
              paddingHeight  = settings.padding,
              startPosition  = (verticalCenter + topOffset)
            ;
            return (scrollHeight > height)
              ? (startPosition + scrollHeight + paddingHeight < contextHeight)
              : (height + (paddingHeight * 2) < contextHeight)
            ;
          }
        },

        is: {
          active: function() {
            return $module.hasClass(className.active);
          },
          ie: function() {
            var
              isIE11 = (!(window.ActiveXObject) && 'ActiveXObject' in window),
              isIE   = ('ActiveXObject' in window)
            ;
            return (isIE11 || isIE);
          },
          animating: function() {
            return $module.transition('is supported')
              ? $module.transition('is animating')
              : $module.is(':visible')
            ;
          },
          scrolling: function() {
            return $dimmable.hasClass(className.scrolling);
          },
          modernBrowser: function() {
            // appName for IE11 reports 'Netscape' can no longer use
            return !(window.ActiveXObject || 'ActiveXObject' in window);
          }
        },

        set: {
          autofocus: function() {
            var
              $inputs    = $module.find('[tabindex], :input').filter(':visible'),
              $autofocus = $inputs.filter('[autofocus]'),
              $input     = ($autofocus.length > 0)
                ? $autofocus.first()
                : $inputs.first()
            ;
            if($input.length > 0) {
              $input.focus();
            }
          },
          clickaway: function() {
            $dimmer
              .on('click' + elementEventNamespace, module.event.click)
            ;
          },
          dimmerSettings: function() {
            if($.fn.dimmer === undefined) {
              module.error(error.dimmer);
              return;
            }
            var
              defaultSettings = {
                debug      : settings.debug,
                dimmerName : 'modals',
                closable   : 'auto',
                useFlex    : module.can.useFlex(),
                variation  : settings.centered
                  ? false
                  : 'top aligned',
                duration   : {
                  show     : settings.duration,
                  hide     : settings.duration
                }
              },
              dimmerSettings = $.extend(true, defaultSettings, settings.dimmerSettings)
            ;
            if(settings.inverted) {
              dimmerSettings.variation = (dimmerSettings.variation !== undefined)
                ? dimmerSettings.variation + ' inverted'
                : 'inverted'
              ;
            }
            $context.dimmer('setting', dimmerSettings);
          },
          dimmerStyles: function() {
            if(settings.inverted) {
              $dimmer.addClass(className.inverted);
            }
            else {
              $dimmer.removeClass(className.inverted);
            }
            if(settings.blurring) {
              $dimmable.addClass(className.blurring);
            }
            else {
              $dimmable.removeClass(className.blurring);
            }
          },
          modalOffset: function() {
            var
              width = module.cache.width,
              height = module.cache.height
            ;
            $module
              .css({
                marginTop: (settings.centered && module.can.fit())
                  ? -(height / 2)
                  : 0,
                marginLeft: -(width / 2)
              })
            ;
            module.verbose('Setting modal offset for legacy mode');
          },
          screenHeight: function() {
            if( module.can.fit() ) {
              $body.css('height', '');
            }
            else {
              module.debug('Modal is taller than page content, resizing page height');
              $body
                .css('height', module.cache.height + (settings.padding * 2) )
              ;
            }
          },
          active: function() {
            $module.addClass(className.active);
          },
          scrolling: function() {
            $dimmable.addClass(className.scrolling);
            $module.addClass(className.scrolling);
            module.unbind.scrollLock();
          },
          legacy: function() {
            $module.addClass(className.legacy);
          },
          type: function() {
            if(module.can.fit()) {
              module.verbose('Modal fits on screen');
              if(!module.others.active() && !module.others.animating()) {
                module.remove.scrolling();
                module.bind.scrollLock();
              }
            }
            else {
              module.verbose('Modal cannot fit on screen setting to scrolling');
              module.set.scrolling();
            }
          },
          undetached: function() {
            $dimmable.addClass(className.undetached);
          }
        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.modal.settings = {

  name           : 'Modal',
  namespace      : 'modal',

  useFlex        : 'auto',
  offset         : 0,

  silent         : false,
  debug          : false,
  verbose        : false,
  performance    : true,

  observeChanges : false,

  allowMultiple  : false,
  detachable     : true,
  closable       : true,
  autofocus      : true,

  inverted       : false,
  blurring       : false,

  centered       : true,

  dimmerSettings : {
    closable : false,
    useCSS   : true
  },

  // whether to use keyboard shortcuts
  keyboardShortcuts: true,

  context    : 'body',

  queue      : false,
  duration   : 500,
  transition : 'scale',

  // padding with edge of page
  padding    : 50,

  // called before show animation
  onShow     : function(){},

  // called after show animation
  onVisible  : function(){},

  // called before hide animation
  onHide     : function(){ return true; },

  // called after hide animation
  onHidden   : function(){},

  // called after approve selector match
  onApprove  : function(){ return true; },

  // called after deny selector match
  onDeny     : function(){ return true; },

  selector    : {
    close    : '> .close',
    approve  : '.actions .positive, .actions .approve, .actions .ok',
    deny     : '.actions .negative, .actions .deny, .actions .cancel',
    modal    : '.ui.modal'
  },
  error : {
    dimmer    : 'UI Dimmer, a required component is not included in this page',
    method    : 'The method you called is not defined.',
    notFound  : 'The element you specified could not be found'
  },
  className : {
    active     : 'active',
    animating  : 'animating',
    blurring   : 'blurring',
    inverted   : 'inverted',
    legacy     : 'legacy',
    loading    : 'loading',
    scrolling  : 'scrolling',
    undetached : 'undetached'
  }
};


})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Nag
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.nag = function(parameters) {
  var
    $allModules    = $(this),
    moduleSelector = $allModules.selector || '',

    time           = new Date().getTime(),
    performance    = [],

    query          = arguments[0],
    methodInvoked  = (typeof query == 'string'),
    queryArguments = [].slice.call(arguments, 1),
    returnedValue
  ;
  $allModules
    .each(function() {
      var
        settings          = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.nag.settings, parameters)
          : $.extend({}, $.fn.nag.settings),

        className       = settings.className,
        selector        = settings.selector,
        error           = settings.error,
        namespace       = settings.namespace,

        eventNamespace  = '.' + namespace,
        moduleNamespace = namespace + '-module',

        $module         = $(this),

        $close          = $module.find(selector.close),
        $context        = (settings.context)
          ? $(settings.context)
          : $('body'),

        element         = this,
        instance        = $module.data(moduleNamespace),

        moduleOffset,
        moduleHeight,

        contextWidth,
        contextHeight,
        contextOffset,

        yOffset,
        yPosition,

        timer,
        module,

        requestAnimationFrame = window.requestAnimationFrame
          || window.mozRequestAnimationFrame
          || window.webkitRequestAnimationFrame
          || window.msRequestAnimationFrame
          || function(callback) { setTimeout(callback, 0); }
      ;
      module = {

        initialize: function() {
          module.verbose('Initializing element');

          $module
            .on('click' + eventNamespace, selector.close, module.dismiss)
            .data(moduleNamespace, module)
          ;

          if(settings.detachable && $module.parent()[0] !== $context[0]) {
            $module
              .detach()
              .prependTo($context)
            ;
          }

          if(settings.displayTime > 0) {
            setTimeout(module.hide, settings.displayTime);
          }
          module.show();
        },

        destroy: function() {
          module.verbose('Destroying instance');
          $module
            .removeData(moduleNamespace)
            .off(eventNamespace)
          ;
        },

        show: function() {
          if( module.should.show() && !$module.is(':visible') ) {
            module.debug('Showing nag', settings.animation.show);
            if(settings.animation.show == 'fade') {
              $module
                .fadeIn(settings.duration, settings.easing)
              ;
            }
            else {
              $module
                .slideDown(settings.duration, settings.easing)
              ;
            }
          }
        },

        hide: function() {
          module.debug('Showing nag', settings.animation.hide);
          if(settings.animation.show == 'fade') {
            $module
              .fadeIn(settings.duration, settings.easing)
            ;
          }
          else {
            $module
              .slideUp(settings.duration, settings.easing)
            ;
          }
        },

        onHide: function() {
          module.debug('Removing nag', settings.animation.hide);
          $module.remove();
          if (settings.onHide) {
            settings.onHide();
          }
        },

        dismiss: function(event) {
          if(settings.storageMethod) {
            module.storage.set(settings.key, settings.value);
          }
          module.hide();
          event.stopImmediatePropagation();
          event.preventDefault();
        },

        should: {
          show: function() {
            if(settings.persist) {
              module.debug('Persistent nag is set, can show nag');
              return true;
            }
            if( module.storage.get(settings.key) != settings.value.toString() ) {
              module.debug('Stored value is not set, can show nag', module.storage.get(settings.key));
              return true;
            }
            module.debug('Stored value is set, cannot show nag', module.storage.get(settings.key));
            return false;
          }
        },

        get: {
          storageOptions: function() {
            var
              options = {}
            ;
            if(settings.expires) {
              options.expires = settings.expires;
            }
            if(settings.domain) {
              options.domain = settings.domain;
            }
            if(settings.path) {
              options.path = settings.path;
            }
            return options;
          }
        },

        clear: function() {
          module.storage.remove(settings.key);
        },

        storage: {
          set: function(key, value) {
            var
              options = module.get.storageOptions()
            ;
            if(settings.storageMethod == 'localstorage' && window.localStorage !== undefined) {
              window.localStorage.setItem(key, value);
              module.debug('Value stored using local storage', key, value);
            }
            else if(settings.storageMethod == 'sessionstorage' && window.sessionStorage !== undefined) {
              window.sessionStorage.setItem(key, value);
              module.debug('Value stored using session storage', key, value);
            }
            else if($.cookie !== undefined) {
              $.cookie(key, value, options);
              module.debug('Value stored using cookie', key, value, options);
            }
            else {
              module.error(error.noCookieStorage);
              return;
            }
          },
          get: function(key, value) {
            var
              storedValue
            ;
            if(settings.storageMethod == 'localstorage' && window.localStorage !== undefined) {
              storedValue = window.localStorage.getItem(key);
            }
            else if(settings.storageMethod == 'sessionstorage' && window.sessionStorage !== undefined) {
              storedValue = window.sessionStorage.getItem(key);
            }
            // get by cookie
            else if($.cookie !== undefined) {
              storedValue = $.cookie(key);
            }
            else {
              module.error(error.noCookieStorage);
            }
            if(storedValue == 'undefined' || storedValue == 'null' || storedValue === undefined || storedValue === null) {
              storedValue = undefined;
            }
            return storedValue;
          },
          remove: function(key) {
            var
              options = module.get.storageOptions()
            ;
            if(settings.storageMethod == 'localstorage' && window.localStorage !== undefined) {
              window.localStorage.removeItem(key);
            }
            else if(settings.storageMethod == 'sessionstorage' && window.sessionStorage !== undefined) {
              window.sessionStorage.removeItem(key);
            }
            // store by cookie
            else if($.cookie !== undefined) {
              $.removeCookie(key, options);
            }
            else {
              module.error(error.noStorage);
            }
          }
        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                module.error(error.method, query);
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.nag.settings = {

  name        : 'Nag',

  silent      : false,
  debug       : false,
  verbose     : false,
  performance : true,

  namespace   : 'Nag',

  // allows cookie to be overridden
  persist     : false,

  // set to zero to require manually dismissal, otherwise hides on its own
  displayTime : 0,

  animation   : {
    show : 'slide',
    hide : 'slide'
  },

  context       : false,
  detachable    : false,

  expires       : 30,
  domain        : false,
  path          : '/',

  // type of storage to use
  storageMethod : 'cookie',

  // value to store in dismissed localstorage/cookie
  key           : 'nag',
  value         : 'dismiss',

  error: {
    noCookieStorage : '$.cookie is not included. A storage solution is required.',
    noStorage       : 'Neither $.cookie or store is defined. A storage solution is required for storing state',
    method          : 'The method you called is not defined.'
  },

  className     : {
    bottom : 'bottom',
    fixed  : 'fixed'
  },

  selector      : {
    close : '.close.icon'
  },

  speed         : 500,
  easing        : 'easeOutQuad',

  onHide: function() {}

};

// Adds easing
$.extend( $.easing, {
  easeOutQuad: function (x, t, b, c, d) {
    return -c *(t/=d)*(t-2) + b;
  }
});

})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Popup
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.popup = function(parameters) {
  var
    $allModules    = $(this),
    $document      = $(document),
    $window        = $(window),
    $body          = $('body'),

    moduleSelector = $allModules.selector || '',

    hasTouch       = (true),
    time           = new Date().getTime(),
    performance    = [],

    query          = arguments[0],
    methodInvoked  = (typeof query == 'string'),
    queryArguments = [].slice.call(arguments, 1),

    returnedValue
  ;
  $allModules
    .each(function() {
      var
        settings        = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.popup.settings, parameters)
          : $.extend({}, $.fn.popup.settings),

        selector           = settings.selector,
        className          = settings.className,
        error              = settings.error,
        metadata           = settings.metadata,
        namespace          = settings.namespace,

        eventNamespace     = '.' + settings.namespace,
        moduleNamespace    = 'module-' + namespace,

        $module            = $(this),
        $context           = $(settings.context),
        $scrollContext     = $(settings.scrollContext),
        $boundary          = $(settings.boundary),
        $target            = (settings.target)
          ? $(settings.target)
          : $module,

        $popup,
        $offsetParent,

        searchDepth        = 0,
        triedPositions     = false,
        openedWithTouch    = false,

        element            = this,
        instance           = $module.data(moduleNamespace),

        documentObserver,
        elementNamespace,
        id,
        module
      ;

      module = {

        // binds events
        initialize: function() {
          module.debug('Initializing', $module);
          module.createID();
          module.bind.events();
          if(!module.exists() && settings.preserve) {
            module.create();
          }
          if(settings.observeChanges) {
            module.observeChanges();
          }
          module.instantiate();
        },

        instantiate: function() {
          module.verbose('Storing instance', module);
          instance = module;
          $module
            .data(moduleNamespace, instance)
          ;
        },

        observeChanges: function() {
          if('MutationObserver' in window) {
            documentObserver = new MutationObserver(module.event.documentChanged);
            documentObserver.observe(document, {
              childList : true,
              subtree   : true
            });
            module.debug('Setting up mutation observer', documentObserver);
          }
        },

        refresh: function() {
          if(settings.popup) {
            $popup = $(settings.popup).eq(0);
          }
          else {
            if(settings.inline) {
              $popup = $target.nextAll(selector.popup).eq(0);
              settings.popup = $popup;
            }
          }
          if(settings.popup) {
            $popup.addClass(className.loading);
            $offsetParent = module.get.offsetParent();
            $popup.removeClass(className.loading);
            if(settings.movePopup && module.has.popup() && module.get.offsetParent($popup)[0] !== $offsetParent[0]) {
              module.debug('Moving popup to the same offset parent as target');
              $popup
                .detach()
                .appendTo($offsetParent)
              ;
            }
          }
          else {
            $offsetParent = (settings.inline)
              ? module.get.offsetParent($target)
              : module.has.popup()
                ? module.get.offsetParent($popup)
                : $body
            ;
          }
          if( $offsetParent.is('html') && $offsetParent[0] !== $body[0] ) {
            module.debug('Setting page as offset parent');
            $offsetParent = $body;
          }
          if( module.get.variation() ) {
            module.set.variation();
          }
        },

        reposition: function() {
          module.refresh();
          module.set.position();
        },

        destroy: function() {
          module.debug('Destroying previous module');
          if(documentObserver) {
            documentObserver.disconnect();
          }
          // remove element only if was created dynamically
          if($popup && !settings.preserve) {
            module.removePopup();
          }
          // clear all timeouts
          clearTimeout(module.hideTimer);
          clearTimeout(module.showTimer);
          // remove events
          module.unbind.close();
          module.unbind.events();
          $module
            .removeData(moduleNamespace)
          ;
        },

        event: {
          start:  function(event) {
            var
              delay = ($.isPlainObject(settings.delay))
                ? settings.delay.show
                : settings.delay
            ;
            clearTimeout(module.hideTimer);
            if(!openedWithTouch) {
              module.showTimer = setTimeout(module.show, delay);
            }
          },
          end:  function() {
            var
              delay = ($.isPlainObject(settings.delay))
                ? settings.delay.hide
                : settings.delay
            ;
            clearTimeout(module.showTimer);
            module.hideTimer = setTimeout(module.hide, delay);
          },
          touchstart: function(event) {
            openedWithTouch = true;
            module.show();
          },
          resize: function() {
            if( module.is.visible() ) {
              module.set.position();
            }
          },
          documentChanged: function(mutations) {
            [].forEach.call(mutations, function(mutation) {
              if(mutation.removedNodes) {
                [].forEach.call(mutation.removedNodes, function(node) {
                  if(node == element || $(node).find(element).length > 0) {
                    module.debug('Element removed from DOM, tearing down events');
                    module.destroy();
                  }
                });
              }
            });
          },
          hideGracefully: function(event) {
            var
              $target = $(event.target),
              isInDOM = $.contains(document.documentElement, event.target),
              inPopup = ($target.closest(selector.popup).length > 0)
            ;
            // don't close on clicks inside popup
            if(event && !inPopup && isInDOM) {
              module.debug('Click occurred outside popup hiding popup');
              module.hide();
            }
            else {
              module.debug('Click was inside popup, keeping popup open');
            }
          }
        },

        // generates popup html from metadata
        create: function() {
          var
            html      = module.get.html(),
            title     = module.get.title(),
            content   = module.get.content()
          ;

          if(html || content || title) {
            module.debug('Creating pop-up html');
            if(!html) {
              html = settings.templates.popup({
                title   : title,
                content : content
              });
            }
            $popup = $('<div/>')
              .addClass(className.popup)
              .data(metadata.activator, $module)
              .html(html)
            ;
            if(settings.inline) {
              module.verbose('Inserting popup element inline', $popup);
              $popup
                .insertAfter($module)
              ;
            }
            else {
              module.verbose('Appending popup element to body', $popup);
              $popup
                .appendTo( $context )
              ;
            }
            module.refresh();
            module.set.variation();

            if(settings.hoverable) {
              module.bind.popup();
            }
            settings.onCreate.call($popup, element);
          }
          else if($target.next(selector.popup).length !== 0) {
            module.verbose('Pre-existing popup found');
            settings.inline = true;
            settings.popup  = $target.next(selector.popup).data(metadata.activator, $module);
            module.refresh();
            if(settings.hoverable) {
              module.bind.popup();
            }
          }
          else if(settings.popup) {
            $(settings.popup).data(metadata.activator, $module);
            module.verbose('Used popup specified in settings');
            module.refresh();
            if(settings.hoverable) {
              module.bind.popup();
            }
          }
          else {
            module.debug('No content specified skipping display', element);
          }
        },

        createID: function() {
          id = (Math.random().toString(16) + '000000000').substr(2, 8);
          elementNamespace = '.' + id;
          module.verbose('Creating unique id for element', id);
        },

        // determines popup state
        toggle: function() {
          module.debug('Toggling pop-up');
          if( module.is.hidden() ) {
            module.debug('Popup is hidden, showing pop-up');
            module.unbind.close();
            module.show();
          }
          else {
            module.debug('Popup is visible, hiding pop-up');
            module.hide();
          }
        },

        show: function(callback) {
          callback = callback || function(){};
          module.debug('Showing pop-up', settings.transition);
          if(module.is.hidden() && !( module.is.active() && module.is.dropdown()) ) {
            if( !module.exists() ) {
              module.create();
            }
            if(settings.onShow.call($popup, element) === false) {
              module.debug('onShow callback returned false, cancelling popup animation');
              return;
            }
            else if(!settings.preserve && !settings.popup) {
              module.refresh();
            }
            if( $popup && module.set.position() ) {
              module.save.conditions();
              if(settings.exclusive) {
                module.hideAll();
              }
              module.animate.show(callback);
            }
          }
        },


        hide: function(callback) {
          callback = callback || function(){};
          if( module.is.visible() || module.is.animating() ) {
            if(settings.onHide.call($popup, element) === false) {
              module.debug('onHide callback returned false, cancelling popup animation');
              return;
            }
            module.remove.visible();
            module.unbind.close();
            module.restore.conditions();
            module.animate.hide(callback);
          }
        },

        hideAll: function() {
          $(selector.popup)
            .filter('.' + className.popupVisible)
            .each(function() {
              $(this)
                .data(metadata.activator)
                  .popup('hide')
              ;
            })
          ;
        },
        exists: function() {
          if(!$popup) {
            return false;
          }
          if(settings.inline || settings.popup) {
            return ( module.has.popup() );
          }
          else {
            return ( $popup.closest($context).length >= 1 )
              ? true
              : false
            ;
          }
        },

        removePopup: function() {
          if( module.has.popup() && !settings.popup) {
            module.debug('Removing popup', $popup);
            $popup.remove();
            $popup = undefined;
            settings.onRemove.call($popup, element);
          }
        },

        save: {
          conditions: function() {
            module.cache = {
              title: $module.attr('title')
            };
            if (module.cache.title) {
              $module.removeAttr('title');
            }
            module.verbose('Saving original attributes', module.cache.title);
          }
        },
        restore: {
          conditions: function() {
            if(module.cache && module.cache.title) {
              $module.attr('title', module.cache.title);
              module.verbose('Restoring original attributes', module.cache.title);
            }
            return true;
          }
        },
        supports: {
          svg: function() {
            return (typeof SVGGraphicsElement === 'undefined');
          }
        },
        animate: {
          show: function(callback) {
            callback = $.isFunction(callback) ? callback : function(){};
            if(settings.transition && $.fn.transition !== undefined && $module.transition('is supported')) {
              module.set.visible();
              $popup
                .transition({
                  animation  : settings.transition + ' in',
                  queue      : false,
                  debug      : settings.debug,
                  verbose    : settings.verbose,
                  duration   : settings.duration,
                  onComplete : function() {
                    module.bind.close();
                    callback.call($popup, element);
                    settings.onVisible.call($popup, element);
                  }
                })
              ;
            }
            else {
              module.error(error.noTransition);
            }
          },
          hide: function(callback) {
            callback = $.isFunction(callback) ? callback : function(){};
            module.debug('Hiding pop-up');
            if(settings.onHide.call($popup, element) === false) {
              module.debug('onHide callback returned false, cancelling popup animation');
              return;
            }
            if(settings.transition && $.fn.transition !== undefined && $module.transition('is supported')) {
              $popup
                .transition({
                  animation  : settings.transition + ' out',
                  queue      : false,
                  duration   : settings.duration,
                  debug      : settings.debug,
                  verbose    : settings.verbose,
                  onComplete : function() {
                    module.reset();
                    callback.call($popup, element);
                    settings.onHidden.call($popup, element);
                  }
                })
              ;
            }
            else {
              module.error(error.noTransition);
            }
          }
        },

        change: {
          content: function(html) {
            $popup.html(html);
          }
        },

        get: {
          html: function() {
            $module.removeData(metadata.html);
            return $module.data(metadata.html) || settings.html;
          },
          title: function() {
            $module.removeData(metadata.title);
            return $module.data(metadata.title) || settings.title;
          },
          content: function() {
            $module.removeData(metadata.content);
            return $module.data(metadata.content) || settings.content || $module.attr('title');
          },
          variation: function() {
            $module.removeData(metadata.variation);
            return $module.data(metadata.variation) || settings.variation;
          },
          popup: function() {
            return $popup;
          },
          popupOffset: function() {
            return $popup.offset();
          },
          calculations: function() {
            var
              $popupOffsetParent = module.get.offsetParent($popup),
              targetElement      = $target[0],
              isWindow           = ($boundary[0] == window),
              targetPosition     = (settings.inline || (settings.popup && settings.movePopup))
                ? $target.position()
                : $target.offset(),
              screenPosition = (isWindow)
                ? { top: 0, left: 0 }
                : $boundary.offset(),
              calculations   = {},
              scroll = (isWindow)
                ? { top: $window.scrollTop(), left: $window.scrollLeft() }
                : { top: 0, left: 0},
              screen
            ;
            calculations = {
              // element which is launching popup
              target : {
                element : $target[0],
                width   : $target.outerWidth(),
                height  : $target.outerHeight(),
                top     : targetPosition.top,
                left    : targetPosition.left,
                margin  : {}
              },
              // popup itself
              popup : {
                width  : $popup.outerWidth(),
                height : $popup.outerHeight()
              },
              // offset container (or 3d context)
              parent : {
                width  : $offsetParent.outerWidth(),
                height : $offsetParent.outerHeight()
              },
              // screen boundaries
              screen : {
                top  : screenPosition.top,
                left : screenPosition.left,
                scroll: {
                  top  : scroll.top,
                  left : scroll.left
                },
                width  : $boundary.width(),
                height : $boundary.height()
              }
            };

            // if popup offset context is not same as target, then adjust calculations
            if($popupOffsetParent.get(0) !== $offsetParent.get(0)) {
              var
                popupOffset        = $popupOffsetParent.offset()
              ;
              calculations.target.top -= popupOffset.top;
              calculations.target.left -= popupOffset.left;
              calculations.parent.width = $popupOffsetParent.outerWidth();
              calculations.parent.height = $popupOffsetParent.outerHeight();
            }

            // add in container calcs if fluid
            if( settings.setFluidWidth && module.is.fluid() ) {
              calculations.container = {
                width: $popup.parent().outerWidth()
              };
              calculations.popup.width = calculations.container.width;
            }

            // add in margins if inline
            calculations.target.margin.top = (settings.inline)
              ? parseInt( window.getComputedStyle(targetElement).getPropertyValue('margin-top'), 10)
              : 0
            ;
            calculations.target.margin.left = (settings.inline)
              ? module.is.rtl()
                ? parseInt( window.getComputedStyle(targetElement).getPropertyValue('margin-right'), 10)
                : parseInt( window.getComputedStyle(targetElement).getPropertyValue('margin-left'), 10)
              : 0
            ;
            // calculate screen boundaries
            screen = calculations.screen;
            calculations.boundary = {
              top    : screen.top + screen.scroll.top,
              bottom : screen.top + screen.scroll.top + screen.height,
              left   : screen.left + screen.scroll.left,
              right  : screen.left + screen.scroll.left + screen.width
            };
            return calculations;
          },
          id: function() {
            return id;
          },
          startEvent: function() {
            if(settings.on == 'hover') {
              return 'mouseenter';
            }
            else if(settings.on == 'focus') {
              return 'focus';
            }
            return false;
          },
          scrollEvent: function() {
            return 'scroll';
          },
          endEvent: function() {
            if(settings.on == 'hover') {
              return 'mouseleave';
            }
            else if(settings.on == 'focus') {
              return 'blur';
            }
            return false;
          },
          distanceFromBoundary: function(offset, calculations) {
            var
              distanceFromBoundary = {},
              popup,
              boundary
            ;
            calculations = calculations || module.get.calculations();

            // shorthand
            popup        = calculations.popup;
            boundary     = calculations.boundary;

            if(offset) {
              distanceFromBoundary = {
                top    : (offset.top - boundary.top),
                left   : (offset.left - boundary.left),
                right  : (boundary.right - (offset.left + popup.width) ),
                bottom : (boundary.bottom - (offset.top + popup.height) )
              };
              module.verbose('Distance from boundaries determined', offset, distanceFromBoundary);
            }
            return distanceFromBoundary;
          },
          offsetParent: function($element) {
            var
              element = ($element !== undefined)
                ? $element[0]
                : $target[0],
              parentNode = element.parentNode,
              $node    = $(parentNode)
            ;
            if(parentNode) {
              var
                is2D     = ($node.css('transform') === 'none'),
                isStatic = ($node.css('position') === 'static'),
                isBody   = $node.is('body')
              ;
              while(parentNode && !isBody && isStatic && is2D) {
                parentNode = parentNode.parentNode;
                $node    = $(parentNode);
                is2D     = ($node.css('transform') === 'none');
                isStatic = ($node.css('position') === 'static');
                isBody   = $node.is('body');
              }
            }
            return ($node && $node.length > 0)
              ? $node
              : $()
            ;
          },
          positions: function() {
            return {
              'top left'      : false,
              'top center'    : false,
              'top right'     : false,
              'bottom left'   : false,
              'bottom center' : false,
              'bottom right'  : false,
              'left center'   : false,
              'right center'  : false
            };
          },
          nextPosition: function(position) {
            var
              positions          = position.split(' '),
              verticalPosition   = positions[0],
              horizontalPosition = positions[1],
              opposite = {
                top    : 'bottom',
                bottom : 'top',
                left   : 'right',
                right  : 'left'
              },
              adjacent = {
                left   : 'center',
                center : 'right',
                right  : 'left'
              },
              backup = {
                'top left'      : 'top center',
                'top center'    : 'top right',
                'top right'     : 'right center',
                'right center'  : 'bottom right',
                'bottom right'  : 'bottom center',
                'bottom center' : 'bottom left',
                'bottom left'   : 'left center',
                'left center'   : 'top left'
              },
              adjacentsAvailable = (verticalPosition == 'top' || verticalPosition == 'bottom'),
              oppositeTried = false,
              adjacentTried = false,
              nextPosition  = false
            ;
            if(!triedPositions) {
              module.verbose('All available positions available');
              triedPositions = module.get.positions();
            }

            module.debug('Recording last position tried', position);
            triedPositions[position] = true;

            if(settings.prefer === 'opposite') {
              nextPosition  = [opposite[verticalPosition], horizontalPosition];
              nextPosition  = nextPosition.join(' ');
              oppositeTried = (triedPositions[nextPosition] === true);
              module.debug('Trying opposite strategy', nextPosition);
            }
            if((settings.prefer === 'adjacent') && adjacentsAvailable ) {
              nextPosition  = [verticalPosition, adjacent[horizontalPosition]];
              nextPosition  = nextPosition.join(' ');
              adjacentTried = (triedPositions[nextPosition] === true);
              module.debug('Trying adjacent strategy', nextPosition);
            }
            if(adjacentTried || oppositeTried) {
              module.debug('Using backup position', nextPosition);
              nextPosition = backup[position];
            }
            return nextPosition;
          }
        },

        set: {
          position: function(position, calculations) {

            // exit conditions
            if($target.length === 0 || $popup.length === 0) {
              module.error(error.notFound);
              return;
            }
            var
              offset,
              distanceAway,
              target,
              popup,
              parent,
              positioning,
              popupOffset,
              distanceFromBoundary
            ;

            calculations = calculations || module.get.calculations();
            position     = position     || $module.data(metadata.position) || settings.position;

            offset       = $module.data(metadata.offset) || settings.offset;
            distanceAway = settings.distanceAway;

            // shorthand
            target = calculations.target;
            popup  = calculations.popup;
            parent = calculations.parent;

            if(module.should.centerArrow(calculations)) {
              module.verbose('Adjusting offset to center arrow on small target element');
              if(position == 'top left' || position == 'bottom left') {
                offset += (target.width / 2)
                offset -= settings.arrowPixelsFromEdge;
              }
              if(position == 'top right' || position == 'bottom right') {
                offset -= (target.width / 2)
                offset += settings.arrowPixelsFromEdge;
              }
            }

            if(target.width === 0 && target.height === 0 && !module.is.svg(target.element)) {
              module.debug('Popup target is hidden, no action taken');
              return false;
            }

            if(settings.inline) {
              module.debug('Adding margin to calculation', target.margin);
              if(position == 'left center' || position == 'right center') {
                offset       +=  target.margin.top;
                distanceAway += -target.margin.left;
              }
              else if (position == 'top left' || position == 'top center' || position == 'top right') {
                offset       += target.margin.left;
                distanceAway -= target.margin.top;
              }
              else {
                offset       += target.margin.left;
                distanceAway += target.margin.top;
              }
            }

            module.debug('Determining popup position from calculations', position, calculations);

            if (module.is.rtl()) {
              position = position.replace(/left|right/g, function (match) {
                return (match == 'left')
                  ? 'right'
                  : 'left'
                ;
              });
              module.debug('RTL: Popup position updated', position);
            }

            // if last attempt use specified last resort position
            if(searchDepth == settings.maxSearchDepth && typeof settings.lastResort === 'string') {
              position = settings.lastResort;
            }

            switch (position) {
              case 'top left':
                positioning = {
                  top    : 'auto',
                  bottom : parent.height - target.top + distanceAway,
                  left   : target.left + offset,
                  right  : 'auto'
                };
              break;
              case 'top center':
                positioning = {
                  bottom : parent.height - target.top + distanceAway,
                  left   : target.left + (target.width / 2) - (popup.width / 2) + offset,
                  top    : 'auto',
                  right  : 'auto'
                };
              break;
              case 'top right':
                positioning = {
                  bottom :  parent.height - target.top + distanceAway,
                  right  :  parent.width - target.left - target.width - offset,
                  top    : 'auto',
                  left   : 'auto'
                };
              break;
              case 'left center':
                positioning = {
                  top    : target.top + (target.height / 2) - (popup.height / 2) + offset,
                  right  : parent.width - target.left + distanceAway,
                  left   : 'auto',
                  bottom : 'auto'
                };
              break;
              case 'right center':
                positioning = {
                  top    : target.top + (target.height / 2) - (popup.height / 2) + offset,
                  left   : target.left + target.width + distanceAway,
                  bottom : 'auto',
                  right  : 'auto'
                };
              break;
              case 'bottom left':
                positioning = {
                  top    : target.top + target.height + distanceAway,
                  left   : target.left + offset,
                  bottom : 'auto',
                  right  : 'auto'
                };
              break;
              case 'bottom center':
                positioning = {
                  top    : target.top + target.height + distanceAway,
                  left   : target.left + (target.width / 2) - (popup.width / 2) + offset,
                  bottom : 'auto',
                  right  : 'auto'
                };
              break;
              case 'bottom right':
                positioning = {
                  top    : target.top + target.height + distanceAway,
                  right  : parent.width - target.left  - target.width - offset,
                  left   : 'auto',
                  bottom : 'auto'
                };
              break;
            }
            if(positioning === undefined) {
              module.error(error.invalidPosition, position);
            }

            module.debug('Calculated popup positioning values', positioning);

            // tentatively place on stage
            $popup
              .css(positioning)
              .removeClass(className.position)
              .addClass(position)
              .addClass(className.loading)
            ;

            popupOffset = module.get.popupOffset();

            // see if any boundaries are surpassed with this tentative position
            distanceFromBoundary = module.get.distanceFromBoundary(popupOffset, calculations);

            if( module.is.offstage(distanceFromBoundary, position) ) {
              module.debug('Position is outside viewport', position);
              if(searchDepth < settings.maxSearchDepth) {
                searchDepth++;
                position = module.get.nextPosition(position);
                module.debug('Trying new position', position);
                return ($popup)
                  ? module.set.position(position, calculations)
                  : false
                ;
              }
              else {
                if(settings.lastResort) {
                  module.debug('No position found, showing with last position');
                }
                else {
                  module.debug('Popup could not find a position to display', $popup);
                  module.error(error.cannotPlace, element);
                  module.remove.attempts();
                  module.remove.loading();
                  module.reset();
                  settings.onUnplaceable.call($popup, element);
                  return false;
                }
              }
            }
            module.debug('Position is on stage', position);
            module.remove.attempts();
            module.remove.loading();
            if( settings.setFluidWidth && module.is.fluid() ) {
              module.set.fluidWidth(calculations);
            }
            return true;
          },

          fluidWidth: function(calculations) {
            calculations = calculations || module.get.calculations();
            module.debug('Automatically setting element width to parent width', calculations.parent.width);
            $popup.css('width', calculations.container.width);
          },

          variation: function(variation) {
            variation = variation || module.get.variation();
            if(variation && module.has.popup() ) {
              module.verbose('Adding variation to popup', variation);
              $popup.addClass(variation);
            }
          },

          visible: function() {
            $module.addClass(className.visible);
          }
        },

        remove: {
          loading: function() {
            $popup.removeClass(className.loading);
          },
          variation: function(variation) {
            variation = variation || module.get.variation();
            if(variation) {
              module.verbose('Removing variation', variation);
              $popup.removeClass(variation);
            }
          },
          visible: function() {
            $module.removeClass(className.visible);
          },
          attempts: function() {
            module.verbose('Resetting all searched positions');
            searchDepth    = 0;
            triedPositions = false;
          }
        },

        bind: {
          events: function() {
            module.debug('Binding popup events to module');
            if(settings.on == 'click') {
              $module
                .on('click' + eventNamespace, module.toggle)
              ;
            }
            if(settings.on == 'hover' && hasTouch) {
              $module
                .on('touchstart' + eventNamespace, module.event.touchstart)
              ;
            }
            if( module.get.startEvent() ) {
              $module
                .on(module.get.startEvent() + eventNamespace, module.event.start)
                .on(module.get.endEvent() + eventNamespace, module.event.end)
              ;
            }
            if(settings.target) {
              module.debug('Target set to element', $target);
            }
            $window.on('resize' + elementNamespace, module.event.resize);
          },
          popup: function() {
            module.verbose('Allowing hover events on popup to prevent closing');
            if( $popup && module.has.popup() ) {
              $popup
                .on('mouseenter' + eventNamespace, module.event.start)
                .on('mouseleave' + eventNamespace, module.event.end)
              ;
            }
          },
          close: function() {
            if(settings.hideOnScroll === true || (settings.hideOnScroll == 'auto' && settings.on != 'click')) {
              module.bind.closeOnScroll();
            }
            if(module.is.closable()) {
              module.bind.clickaway();
            }
            else if(settings.on == 'hover' && openedWithTouch) {
              module.bind.touchClose();
            }
          },
          closeOnScroll: function() {
            module.verbose('Binding scroll close event to document');
            $scrollContext
              .one(module.get.scrollEvent() + elementNamespace, module.event.hideGracefully)
            ;
          },
          touchClose: function() {
            module.verbose('Binding popup touchclose event to document');
            $document
              .on('touchstart' + elementNamespace, function(event) {
                module.verbose('Touched away from popup');
                module.event.hideGracefully.call(element, event);
              })
            ;
          },
          clickaway: function() {
            module.verbose('Binding popup close event to document');
            $document
              .on('click' + elementNamespace, function(event) {
                module.verbose('Clicked away from popup');
                module.event.hideGracefully.call(element, event);
              })
            ;
          }
        },

        unbind: {
          events: function() {
            $window
              .off(elementNamespace)
            ;
            $module
              .off(eventNamespace)
            ;
          },
          close: function() {
            $document
              .off(elementNamespace)
            ;
            $scrollContext
              .off(elementNamespace)
            ;
          },
        },

        has: {
          popup: function() {
            return ($popup && $popup.length > 0);
          }
        },

        should: {
          centerArrow: function(calculations) {
            return !module.is.basic() && calculations.target.width <= (settings.arrowPixelsFromEdge * 2);
          },
        },

        is: {
          closable: function() {
            if(settings.closable == 'auto') {
              if(settings.on == 'hover') {
                return false;
              }
              return true;
            }
            return settings.closable;
          },
          offstage: function(distanceFromBoundary, position) {
            var
              offstage = []
            ;
            // return boundaries that have been surpassed
            $.each(distanceFromBoundary, function(direction, distance) {
              if(distance < -settings.jitter) {
                module.debug('Position exceeds allowable distance from edge', direction, distance, position);
                offstage.push(direction);
              }
            });
            if(offstage.length > 0) {
              return true;
            }
            else {
              return false;
            }
          },
          svg: function(element) {
            return module.supports.svg() && (element instanceof SVGGraphicsElement);
          },
          basic: function() {
            return $module.hasClass(className.basic);
          },
          active: function() {
            return $module.hasClass(className.active);
          },
          animating: function() {
            return ($popup !== undefined && $popup.hasClass(className.animating) );
          },
          fluid: function() {
            return ($popup !== undefined && $popup.hasClass(className.fluid));
          },
          visible: function() {
            return ($popup !== undefined && $popup.hasClass(className.popupVisible));
          },
          dropdown: function() {
            return $module.hasClass(className.dropdown);
          },
          hidden: function() {
            return !module.is.visible();
          },
          rtl: function () {
            return $module.css('direction') == 'rtl';
          }
        },

        reset: function() {
          module.remove.visible();
          if(settings.preserve) {
            if($.fn.transition !== undefined) {
              $popup
                .transition('remove transition')
              ;
            }
          }
          else {
            module.removePopup();
          }
        },

        setting: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            settings[name] = value;
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.popup.settings = {

  name           : 'Popup',

  // module settings
  silent         : false,
  debug          : false,
  verbose        : false,
  performance    : true,
  namespace      : 'popup',

  // whether it should use dom mutation observers
  observeChanges : true,

  // callback only when element added to dom
  onCreate       : function(){},

  // callback before element removed from dom
  onRemove       : function(){},

  // callback before show animation
  onShow         : function(){},

  // callback after show animation
  onVisible      : function(){},

  // callback before hide animation
  onHide         : function(){},

  // callback when popup cannot be positioned in visible screen
  onUnplaceable  : function(){},

  // callback after hide animation
  onHidden       : function(){},

  // when to show popup
  on             : 'hover',

  // element to use to determine if popup is out of boundary
  boundary       : window,

  // whether to add touchstart events when using hover
  addTouchEvents : true,

  // default position relative to element
  position       : 'top left',

  // name of variation to use
  variation      : '',

  // whether popup should be moved to context
  movePopup      : true,

  // element which popup should be relative to
  target         : false,

  // jq selector or element that should be used as popup
  popup          : false,

  // popup should remain inline next to activator
  inline         : false,

  // popup should be removed from page on hide
  preserve       : false,

  // popup should not close when being hovered on
  hoverable      : false,

  // explicitly set content
  content        : false,

  // explicitly set html
  html           : false,

  // explicitly set title
  title          : false,

  // whether automatically close on clickaway when on click
  closable       : true,

  // automatically hide on scroll
  hideOnScroll   : 'auto',

  // hide other popups on show
  exclusive      : false,

  // context to attach popups
  context        : 'body',

  // context for binding scroll events
  scrollContext  : window,

  // position to prefer when calculating new position
  prefer         : 'opposite',

  // specify position to appear even if it doesn't fit
  lastResort     : false,

  // number of pixels from edge of popup to pointing arrow center (used from centering)
  arrowPixelsFromEdge: 20,

  // delay used to prevent accidental refiring of animations due to user error
  delay : {
    show : 50,
    hide : 70
  },

  // whether fluid variation should assign width explicitly
  setFluidWidth  : true,

  // transition settings
  duration       : 200,
  transition     : 'scale',

  // distance away from activating element in px
  distanceAway   : 0,

  // number of pixels an element is allowed to be "offstage" for a position to be chosen (allows for rounding)
  jitter         : 2,

  // offset on aligning axis from calculated position
  offset         : 0,

  // maximum times to look for a position before failing (9 positions total)
  maxSearchDepth : 15,

  error: {
    invalidPosition : 'The position you specified is not a valid position',
    cannotPlace     : 'Popup does not fit within the boundaries of the viewport',
    method          : 'The method you called is not defined.',
    noTransition    : 'This module requires ui transitions <https://github.com/Semantic-Org/UI-Transition>',
    notFound        : 'The target or popup you specified does not exist on the page'
  },

  metadata: {
    activator : 'activator',
    content   : 'content',
    html      : 'html',
    offset    : 'offset',
    position  : 'position',
    title     : 'title',
    variation : 'variation'
  },

  className   : {
    active       : 'active',
    basic        : 'basic',
    animating    : 'animating',
    dropdown     : 'dropdown',
    fluid        : 'fluid',
    loading      : 'loading',
    popup        : 'ui popup',
    position     : 'top left center bottom right',
    visible      : 'visible',
    popupVisible : 'visible'
  },

  selector    : {
    popup    : '.ui.popup'
  },

  templates: {
    escape: function(string) {
      var
        badChars     = /[&<>"'`]/g,
        shouldEscape = /[&<>"'`]/,
        escape       = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#x27;",
          "`": "&#x60;"
        },
        escapedChar  = function(chr) {
          return escape[chr];
        }
      ;
      if(shouldEscape.test(string)) {
        return string.replace(badChars, escapedChar);
      }
      return string;
    },
    popup: function(text) {
      var
        html   = '',
        escape = $.fn.popup.settings.templates.escape
      ;
      if(typeof text !== undefined) {
        if(typeof text.title !== undefined && text.title) {
          text.title = escape(text.title);
          html += '<div class="header">' + text.title + '</div>';
        }
        if(typeof text.content !== undefined && text.content) {
          text.content = escape(text.content);
          html += '<div class="content">' + text.content + '</div>';
        }
      }
      return html;
    }
  }

};


})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Progress
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

var
  global = (typeof window != 'undefined' && window.Math == Math)
    ? window
    : (typeof self != 'undefined' && self.Math == Math)
      ? self
      : Function('return this')()
;

$.fn.progress = function(parameters) {
  var
    $allModules    = $(this),

    moduleSelector = $allModules.selector || '',

    time           = new Date().getTime(),
    performance    = [],

    query          = arguments[0],
    methodInvoked  = (typeof query == 'string'),
    queryArguments = [].slice.call(arguments, 1),

    returnedValue
  ;

  $allModules
    .each(function() {
      var
        settings          = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.progress.settings, parameters)
          : $.extend({}, $.fn.progress.settings),

        className       = settings.className,
        metadata        = settings.metadata,
        namespace       = settings.namespace,
        selector        = settings.selector,
        error           = settings.error,

        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,

        $module         = $(this),
        $bar            = $(this).find(selector.bar),
        $progress       = $(this).find(selector.progress),
        $label          = $(this).find(selector.label),

        element         = this,
        instance        = $module.data(moduleNamespace),

        animating = false,
        transitionEnd,
        module
      ;

      module = {

        initialize: function() {
          module.debug('Initializing progress bar', settings);

          module.set.duration();
          module.set.transitionEvent();

          module.read.metadata();
          module.read.settings();

          module.instantiate();
        },

        instantiate: function() {
          module.verbose('Storing instance of progress', module);
          instance = module;
          $module
            .data(moduleNamespace, module)
          ;
        },
        destroy: function() {
          module.verbose('Destroying previous progress for', $module);
          clearInterval(instance.interval);
          module.remove.state();
          $module.removeData(moduleNamespace);
          instance = undefined;
        },

        reset: function() {
          module.remove.nextValue();
          module.update.progress(0);
        },

        complete: function() {
          if(module.percent === undefined || module.percent < 100) {
            module.remove.progressPoll();
            module.set.percent(100);
          }
        },

        read: {
          metadata: function() {
            var
              data = {
                percent : $module.data(metadata.percent),
                total   : $module.data(metadata.total),
                value   : $module.data(metadata.value)
              }
            ;
            if(data.percent) {
              module.debug('Current percent value set from metadata', data.percent);
              module.set.percent(data.percent);
            }
            if(data.total) {
              module.debug('Total value set from metadata', data.total);
              module.set.total(data.total);
            }
            if(data.value) {
              module.debug('Current value set from metadata', data.value);
              module.set.value(data.value);
              module.set.progress(data.value);
            }
          },
          settings: function() {
            if(settings.total !== false) {
              module.debug('Current total set in settings', settings.total);
              module.set.total(settings.total);
            }
            if(settings.value !== false) {
              module.debug('Current value set in settings', settings.value);
              module.set.value(settings.value);
              module.set.progress(module.value);
            }
            if(settings.percent !== false) {
              module.debug('Current percent set in settings', settings.percent);
              module.set.percent(settings.percent);
            }
          }
        },

        bind: {
          transitionEnd: function(callback) {
            var
              transitionEnd = module.get.transitionEnd()
            ;
            $bar
              .one(transitionEnd + eventNamespace, function(event) {
                clearTimeout(module.failSafeTimer);
                callback.call(this, event);
              })
            ;
            module.failSafeTimer = setTimeout(function() {
              $bar.triggerHandler(transitionEnd);
            }, settings.duration + settings.failSafeDelay);
            module.verbose('Adding fail safe timer', module.timer);
          }
        },

        increment: function(incrementValue) {
          var
            maxValue,
            startValue,
            newValue
          ;
          if( module.has.total() ) {
            startValue     = module.get.value();
            incrementValue = incrementValue || 1;
            newValue       = startValue + incrementValue;
          }
          else {
            startValue     = module.get.percent();
            incrementValue = incrementValue || module.get.randomValue();

            newValue       = startValue + incrementValue;
            maxValue       = 100;
            module.debug('Incrementing percentage by', startValue, newValue);
          }
          newValue = module.get.normalizedValue(newValue);
          module.set.progress(newValue);
        },
        decrement: function(decrementValue) {
          var
            total     = module.get.total(),
            startValue,
            newValue
          ;
          if(total) {
            startValue     =  module.get.value();
            decrementValue =  decrementValue || 1;
            newValue       =  startValue - decrementValue;
            module.debug('Decrementing value by', decrementValue, startValue);
          }
          else {
            startValue     =  module.get.percent();
            decrementValue =  decrementValue || module.get.randomValue();
            newValue       =  startValue - decrementValue;
            module.debug('Decrementing percentage by', decrementValue, startValue);
          }
          newValue = module.get.normalizedValue(newValue);
          module.set.progress(newValue);
        },

        has: {
          progressPoll: function() {
            return module.progressPoll;
          },
          total: function() {
            return (module.get.total() !== false);
          }
        },

        get: {
          text: function(templateText) {
            var
              value   = module.value                || 0,
              total   = module.total                || 0,
              percent = (animating)
                ? module.get.displayPercent()
                : module.percent || 0,
              left = (module.total > 0)
                ? (total - value)
                : (100 - percent)
            ;
            templateText = templateText || '';
            templateText = templateText
              .replace('{value}', value)
              .replace('{total}', total)
              .replace('{left}', left)
              .replace('{percent}', percent)
            ;
            module.verbose('Adding variables to progress bar text', templateText);
            return templateText;
          },

          normalizedValue: function(value) {
            if(value < 0) {
              module.debug('Value cannot decrement below 0');
              return 0;
            }
            if(module.has.total()) {
              if(value > module.total) {
                module.debug('Value cannot increment above total', module.total);
                return module.total;
              }
            }
            else if(value > 100 ) {
              module.debug('Value cannot increment above 100 percent');
              return 100;
            }
            return value;
          },

          updateInterval: function() {
            if(settings.updateInterval == 'auto') {
              return settings.duration;
            }
            return settings.updateInterval;
          },

          randomValue: function() {
            module.debug('Generating random increment percentage');
            return Math.floor((Math.random() * settings.random.max) + settings.random.min);
          },

          numericValue: function(value) {
            return (typeof value === 'string')
              ? (value.replace(/[^\d.]/g, '') !== '')
                ? +(value.replace(/[^\d.]/g, ''))
                : false
              : value
            ;
          },

          transitionEnd: function() {
            var
              element     = document.createElement('element'),
              transitions = {
                'transition'       :'transitionend',
                'OTransition'      :'oTransitionEnd',
                'MozTransition'    :'transitionend',
                'WebkitTransition' :'webkitTransitionEnd'
              },
              transition
            ;
            for(transition in transitions){
              if( element.style[transition] !== undefined ){
                return transitions[transition];
              }
            }
          },

          // gets current displayed percentage (if animating values this is the intermediary value)
          displayPercent: function() {
            var
              barWidth       = $bar.width(),
              totalWidth     = $module.width(),
              minDisplay     = parseInt($bar.css('min-width'), 10),
              displayPercent = (barWidth > minDisplay)
                ? (barWidth / totalWidth * 100)
                : module.percent
            ;
            return (settings.precision > 0)
              ? Math.round(displayPercent * (10 * settings.precision)) / (10 * settings.precision)
              : Math.round(displayPercent)
            ;
          },

          percent: function() {
            return module.percent || 0;
          },
          value: function() {
            return module.nextValue || module.value || 0;
          },
          total: function() {
            return module.total || false;
          }
        },

        create: {
          progressPoll: function() {
            module.progressPoll = setTimeout(function() {
              module.update.toNextValue();
              module.remove.progressPoll();
            }, module.get.updateInterval());
          },
        },

        is: {
          complete: function() {
            return module.is.success() || module.is.warning() || module.is.error();
          },
          success: function() {
            return $module.hasClass(className.success);
          },
          warning: function() {
            return $module.hasClass(className.warning);
          },
          error: function() {
            return $module.hasClass(className.error);
          },
          active: function() {
            return $module.hasClass(className.active);
          },
          visible: function() {
            return $module.is(':visible');
          }
        },

        remove: {
          progressPoll: function() {
            module.verbose('Removing progress poll timer');
            if(module.progressPoll) {
              clearTimeout(module.progressPoll);
              delete module.progressPoll;
            }
          },
          nextValue: function() {
            module.verbose('Removing progress value stored for next update');
            delete module.nextValue;
          },
          state: function() {
            module.verbose('Removing stored state');
            delete module.total;
            delete module.percent;
            delete module.value;
          },
          active: function() {
            module.verbose('Removing active state');
            $module.removeClass(className.active);
          },
          success: function() {
            module.verbose('Removing success state');
            $module.removeClass(className.success);
          },
          warning: function() {
            module.verbose('Removing warning state');
            $module.removeClass(className.warning);
          },
          error: function() {
            module.verbose('Removing error state');
            $module.removeClass(className.error);
          }
        },

        set: {
          barWidth: function(value) {
            if(value > 100) {
              module.error(error.tooHigh, value);
            }
            else if (value < 0) {
              module.error(error.tooLow, value);
            }
            else {
              $bar
                .css('width', value + '%')
              ;
              $module
                .attr('data-percent', parseInt(value, 10))
              ;
            }
          },
          duration: function(duration) {
            duration = duration || settings.duration;
            duration = (typeof duration == 'number')
              ? duration + 'ms'
              : duration
            ;
            module.verbose('Setting progress bar transition duration', duration);
            $bar
              .css({
                'transition-duration':  duration
              })
            ;
          },
          percent: function(percent) {
            percent = (typeof percent == 'string')
              ? +(percent.replace('%', ''))
              : percent
            ;
            // round display percentage
            percent = (settings.precision > 0)
              ? Math.round(percent * (10 * settings.precision)) / (10 * settings.precision)
              : Math.round(percent)
            ;
            module.percent = percent;
            if( !module.has.total() ) {
              module.value = (settings.precision > 0)
                ? Math.round( (percent / 100) * module.total * (10 * settings.precision)) / (10 * settings.precision)
                : Math.round( (percent / 100) * module.total * 10) / 10
              ;
              if(settings.limitValues) {
                module.value = (module.value > 100)
                  ? 100
                  : (module.value < 0)
                    ? 0
                    : module.value
                ;
              }
            }
            module.set.barWidth(percent);
            module.set.labelInterval();
            module.set.labels();
            settings.onChange.call(element, percent, module.value, module.total);
          },
          labelInterval: function() {
            var
              animationCallback = function() {
                module.verbose('Bar finished animating, removing continuous label updates');
                clearInterval(module.interval);
                animating = false;
                module.set.labels();
              }
            ;
            clearInterval(module.interval);
            module.bind.transitionEnd(animationCallback);
            animating = true;
            module.interval = setInterval(function() {
              var
                isInDOM = $.contains(document.documentElement, element)
              ;
              if(!isInDOM) {
                clearInterval(module.interval);
                animating = false;
              }
              module.set.labels();
            }, settings.framerate);
          },
          labels: function() {
            module.verbose('Setting both bar progress and outer label text');
            module.set.barLabel();
            module.set.state();
          },
          label: function(text) {
            text = text || '';
            if(text) {
              text = module.get.text(text);
              module.verbose('Setting label to text', text);
              $label.text(text);
            }
          },
          state: function(percent) {
            percent = (percent !== undefined)
              ? percent
              : module.percent
            ;
            if(percent === 100) {
              if(settings.autoSuccess && !(module.is.warning() || module.is.error() || module.is.success())) {
                module.set.success();
                module.debug('Automatically triggering success at 100%');
              }
              else {
                module.verbose('Reached 100% removing active state');
                module.remove.active();
                module.remove.progressPoll();
              }
            }
            else if(percent > 0) {
              module.verbose('Adjusting active progress bar label', percent);
              module.set.active();
            }
            else {
              module.remove.active();
              module.set.label(settings.text.active);
            }
          },
          barLabel: function(text) {
            if(text !== undefined) {
              $progress.text( module.get.text(text) );
            }
            else if(settings.label == 'ratio' && module.total) {
              module.verbose('Adding ratio to bar label');
              $progress.text( module.get.text(settings.text.ratio) );
            }
            else if(settings.label == 'percent') {
              module.verbose('Adding percentage to bar label');
              $progress.text( module.get.text(settings.text.percent) );
            }
          },
          active: function(text) {
            text = text || settings.text.active;
            module.debug('Setting active state');
            if(settings.showActivity && !module.is.active() ) {
              $module.addClass(className.active);
            }
            module.remove.warning();
            module.remove.error();
            module.remove.success();
            text = settings.onLabelUpdate('active', text, module.value, module.total);
            if(text) {
              module.set.label(text);
            }
            module.bind.transitionEnd(function() {
              settings.onActive.call(element, module.value, module.total);
            });
          },
          success : function(text) {
            text = text || settings.text.success || settings.text.active;
            module.debug('Setting success state');
            $module.addClass(className.success);
            module.remove.active();
            module.remove.warning();
            module.remove.error();
            module.complete();
            if(settings.text.success) {
              text = settings.onLabelUpdate('success', text, module.value, module.total);
              module.set.label(text);
            }
            else {
              text = settings.onLabelUpdate('active', text, module.value, module.total);
              module.set.label(text);
            }
            module.bind.transitionEnd(function() {
              settings.onSuccess.call(element, module.total);
            });
          },
          warning : function(text) {
            text = text || settings.text.warning;
            module.debug('Setting warning state');
            $module.addClass(className.warning);
            module.remove.active();
            module.remove.success();
            module.remove.error();
            module.complete();
            text = settings.onLabelUpdate('warning', text, module.value, module.total);
            if(text) {
              module.set.label(text);
            }
            module.bind.transitionEnd(function() {
              settings.onWarning.call(element, module.value, module.total);
            });
          },
          error : function(text) {
            text = text || settings.text.error;
            module.debug('Setting error state');
            $module.addClass(className.error);
            module.remove.active();
            module.remove.success();
            module.remove.warning();
            module.complete();
            text = settings.onLabelUpdate('error', text, module.value, module.total);
            if(text) {
              module.set.label(text);
            }
            module.bind.transitionEnd(function() {
              settings.onError.call(element, module.value, module.total);
            });
          },
          transitionEvent: function() {
            transitionEnd = module.get.transitionEnd();
          },
          total: function(totalValue) {
            module.total = totalValue;
          },
          value: function(value) {
            module.value = value;
          },
          progress: function(value) {
            if(!module.has.progressPoll()) {
              module.debug('First update in progress update interval, immediately updating', value);
              module.update.progress(value);
              module.create.progressPoll();
            }
            else {
              module.debug('Updated within interval, setting next update to use new value', value);
              module.set.nextValue(value);
            }
          },
          nextValue: function(value) {
            module.nextValue = value;
          }
        },

        update: {
          toNextValue: function() {
            var
              nextValue = module.nextValue
            ;
            if(nextValue) {
              module.debug('Update interval complete using last updated value', nextValue);
              module.update.progress(nextValue);
              module.remove.nextValue();
            }
          },
          progress: function(value) {
            var
              percentComplete
            ;
            value = module.get.numericValue(value);
            if(value === false) {
              module.error(error.nonNumeric, value);
            }
            value = module.get.normalizedValue(value);
            if( module.has.total() ) {
              module.set.value(value);
              percentComplete = (value / module.total) * 100;
              module.debug('Calculating percent complete from total', percentComplete);
              module.set.percent( percentComplete );
            }
            else {
              percentComplete = value;
              module.debug('Setting value to exact percentage value', percentComplete);
              module.set.percent( percentComplete );
            }
          }
        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                module.error(error.method, query);
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.progress.settings = {

  name         : 'Progress',
  namespace    : 'progress',

  silent       : false,
  debug        : false,
  verbose      : false,
  performance  : true,

  random       : {
    min : 2,
    max : 5
  },

  duration       : 300,

  updateInterval : 'auto',

  autoSuccess    : true,
  showActivity   : true,
  limitValues    : true,

  label          : 'percent',
  precision      : 0,
  framerate      : (1000 / 30), /// 30 fps

  percent        : false,
  total          : false,
  value          : false,

  // delay in ms for fail safe animation callback
  failSafeDelay : 100,

  onLabelUpdate : function(state, text, value, total){
    return text;
  },
  onChange      : function(percent, value, total){},
  onSuccess     : function(total){},
  onActive      : function(value, total){},
  onError       : function(value, total){},
  onWarning     : function(value, total){},

  error    : {
    method     : 'The method you called is not defined.',
    nonNumeric : 'Progress value is non numeric',
    tooHigh    : 'Value specified is above 100%',
    tooLow     : 'Value specified is below 0%'
  },

  regExp: {
    variable: /\{\$*[A-z0-9]+\}/g
  },

  metadata: {
    percent : 'percent',
    total   : 'total',
    value   : 'value'
  },

  selector : {
    bar      : '> .bar',
    label    : '> .label',
    progress : '.bar > .progress'
  },

  text : {
    active  : false,
    error   : false,
    success : false,
    warning : false,
    percent : '{percent}%',
    ratio   : '{value} of {total}'
  },

  className : {
    active  : 'active',
    error   : 'error',
    success : 'success',
    warning : 'warning'
  }

};


})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Rating
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.rating = function(parameters) {
  var
    $allModules     = $(this),
    moduleSelector  = $allModules.selector || '',

    time            = new Date().getTime(),
    performance     = [],

    query           = arguments[0],
    methodInvoked   = (typeof query == 'string'),
    queryArguments  = [].slice.call(arguments, 1),
    returnedValue
  ;
  $allModules
    .each(function() {
      var
        settings        = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.rating.settings, parameters)
          : $.extend({}, $.fn.rating.settings),

        namespace       = settings.namespace,
        className       = settings.className,
        metadata        = settings.metadata,
        selector        = settings.selector,
        error           = settings.error,

        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,

        element         = this,
        instance        = $(this).data(moduleNamespace),

        $module         = $(this),
        $icon           = $module.find(selector.icon),

        initialLoad,
        module
      ;

      module = {

        initialize: function() {
          module.verbose('Initializing rating module', settings);

          if($icon.length === 0) {
            module.setup.layout();
          }

          if(settings.interactive) {
            module.enable();
          }
          else {
            module.disable();
          }
          module.set.initialLoad();
          module.set.rating( module.get.initialRating() );
          module.remove.initialLoad();
          module.instantiate();
        },

        instantiate: function() {
          module.verbose('Instantiating module', settings);
          instance = module;
          $module
            .data(moduleNamespace, module)
          ;
        },

        destroy: function() {
          module.verbose('Destroying previous instance', instance);
          module.remove.events();
          $module
            .removeData(moduleNamespace)
          ;
        },

        refresh: function() {
          $icon   = $module.find(selector.icon);
        },

        setup: {
          layout: function() {
            var
              maxRating = module.get.maxRating(),
              html      = $.fn.rating.settings.templates.icon(maxRating)
            ;
            module.debug('Generating icon html dynamically');
            $module
              .html(html)
            ;
            module.refresh();
          }
        },

        event: {
          mouseenter: function() {
            var
              $activeIcon = $(this)
            ;
            $activeIcon
              .nextAll()
                .removeClass(className.selected)
            ;
            $module
              .addClass(className.selected)
            ;
            $activeIcon
              .addClass(className.selected)
                .prevAll()
                .addClass(className.selected)
            ;
          },
          mouseleave: function() {
            $module
              .removeClass(className.selected)
            ;
            $icon
              .removeClass(className.selected)
            ;
          },
          click: function() {
            var
              $activeIcon   = $(this),
              currentRating = module.get.rating(),
              rating        = $icon.index($activeIcon) + 1,
              canClear      = (settings.clearable == 'auto')
               ? ($icon.length === 1)
               : settings.clearable
            ;
            if(canClear && currentRating == rating) {
              module.clearRating();
            }
            else {
              module.set.rating( rating );
            }
          }
        },

        clearRating: function() {
          module.debug('Clearing current rating');
          module.set.rating(0);
        },

        bind: {
          events: function() {
            module.verbose('Binding events');
            $module
              .on('mouseenter' + eventNamespace, selector.icon, module.event.mouseenter)
              .on('mouseleave' + eventNamespace, selector.icon, module.event.mouseleave)
              .on('click'      + eventNamespace, selector.icon, module.event.click)
            ;
          }
        },

        remove: {
          events: function() {
            module.verbose('Removing events');
            $module
              .off(eventNamespace)
            ;
          },
          initialLoad: function() {
            initialLoad = false;
          }
        },

        enable: function() {
          module.debug('Setting rating to interactive mode');
          module.bind.events();
          $module
            .removeClass(className.disabled)
          ;
        },

        disable: function() {
          module.debug('Setting rating to read-only mode');
          module.remove.events();
          $module
            .addClass(className.disabled)
          ;
        },

        is: {
          initialLoad: function() {
            return initialLoad;
          }
        },

        get: {
          initialRating: function() {
            if($module.data(metadata.rating) !== undefined) {
              $module.removeData(metadata.rating);
              return $module.data(metadata.rating);
            }
            return settings.initialRating;
          },
          maxRating: function() {
            if($module.data(metadata.maxRating) !== undefined) {
              $module.removeData(metadata.maxRating);
              return $module.data(metadata.maxRating);
            }
            return settings.maxRating;
          },
          rating: function() {
            var
              currentRating = $icon.filter('.' + className.active).length
            ;
            module.verbose('Current rating retrieved', currentRating);
            return currentRating;
          }
        },

        set: {
          rating: function(rating) {
            var
              ratingIndex = (rating - 1 >= 0)
                ? (rating - 1)
                : 0,
              $activeIcon = $icon.eq(ratingIndex)
            ;
            $module
              .removeClass(className.selected)
            ;
            $icon
              .removeClass(className.selected)
              .removeClass(className.active)
            ;
            if(rating > 0) {
              module.verbose('Setting current rating to', rating);
              $activeIcon
                .prevAll()
                .addBack()
                  .addClass(className.active)
              ;
            }
            if(!module.is.initialLoad()) {
              settings.onRate.call(element, rating);
            }
          },
          initialLoad: function() {
            initialLoad = true;
          }
        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if($allModules.length > 1) {
              title += ' ' + '(' + $allModules.length + ')';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };
      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.rating.settings = {

  name          : 'Rating',
  namespace     : 'rating',

  slent         : false,
  debug         : false,
  verbose       : false,
  performance   : true,

  initialRating : 0,
  interactive   : true,
  maxRating     : 4,
  clearable     : 'auto',

  fireOnInit    : false,

  onRate        : function(rating){},

  error         : {
    method    : 'The method you called is not defined',
    noMaximum : 'No maximum rating specified. Cannot generate HTML automatically'
  },


  metadata: {
    rating    : 'rating',
    maxRating : 'maxRating'
  },

  className : {
    active   : 'active',
    disabled : 'disabled',
    selected : 'selected',
    loading  : 'loading'
  },

  selector  : {
    icon : '.icon'
  },

  templates: {
    icon: function(maxRating) {
      var
        icon = 1,
        html = ''
      ;
      while(icon <= maxRating) {
        html += '<i class="icon"></i>';
        icon++;
      }
      return html;
    }
  }

};

})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Search
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.search = function(parameters) {
  var
    $allModules     = $(this),
    moduleSelector  = $allModules.selector || '',

    time            = new Date().getTime(),
    performance     = [],

    query           = arguments[0],
    methodInvoked   = (typeof query == 'string'),
    queryArguments  = [].slice.call(arguments, 1),
    returnedValue
  ;
  $(this)
    .each(function() {
      var
        settings          = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.search.settings, parameters)
          : $.extend({}, $.fn.search.settings),

        className        = settings.className,
        metadata         = settings.metadata,
        regExp           = settings.regExp,
        fields           = settings.fields,
        selector         = settings.selector,
        error            = settings.error,
        namespace        = settings.namespace,

        eventNamespace   = '.' + namespace,
        moduleNamespace  = namespace + '-module',

        $module          = $(this),
        $prompt          = $module.find(selector.prompt),
        $searchButton    = $module.find(selector.searchButton),
        $results         = $module.find(selector.results),
        $result          = $module.find(selector.result),
        $category        = $module.find(selector.category),

        element          = this,
        instance         = $module.data(moduleNamespace),

        disabledBubbled  = false,
        resultsDismissed = false,

        module
      ;

      module = {

        initialize: function() {
          module.verbose('Initializing module');
          module.get.settings();
          module.determine.searchFields();
          module.bind.events();
          module.set.type();
          module.create.results();
          module.instantiate();
        },
        instantiate: function() {
          module.verbose('Storing instance of module', module);
          instance = module;
          $module
            .data(moduleNamespace, module)
          ;
        },
        destroy: function() {
          module.verbose('Destroying instance');
          $module
            .off(eventNamespace)
            .removeData(moduleNamespace)
          ;
        },

        refresh: function() {
          module.debug('Refreshing selector cache');
          $prompt         = $module.find(selector.prompt);
          $searchButton   = $module.find(selector.searchButton);
          $category       = $module.find(selector.category);
          $results        = $module.find(selector.results);
          $result         = $module.find(selector.result);
        },

        refreshResults: function() {
          $results = $module.find(selector.results);
          $result  = $module.find(selector.result);
        },

        bind: {
          events: function() {
            module.verbose('Binding events to search');
            if(settings.automatic) {
              $module
                .on(module.get.inputEvent() + eventNamespace, selector.prompt, module.event.input)
              ;
              $prompt
                .attr('autocomplete', 'off')
              ;
            }
            $module
              // prompt
              .on('focus'     + eventNamespace, selector.prompt, module.event.focus)
              .on('blur'      + eventNamespace, selector.prompt, module.event.blur)
              .on('keydown'   + eventNamespace, selector.prompt, module.handleKeyboard)
              // search button
              .on('click'     + eventNamespace, selector.searchButton, module.query)
              // results
              .on('mousedown' + eventNamespace, selector.results, module.event.result.mousedown)
              .on('mouseup'   + eventNamespace, selector.results, module.event.result.mouseup)
              .on('click'     + eventNamespace, selector.result,  module.event.result.click)
            ;
          }
        },

        determine: {
          searchFields: function() {
            // this makes sure $.extend does not add specified search fields to default fields
            // this is the only setting which should not extend defaults
            if(parameters && parameters.searchFields !== undefined) {
              settings.searchFields = parameters.searchFields;
            }
          }
        },

        event: {
          input: function() {
            if(settings.searchDelay) {
              clearTimeout(module.timer);
              module.timer = setTimeout(function() {
                if(module.is.focused()) {
                  module.query();
                }
              }, settings.searchDelay);
            }
            else {
              module.query();
            }
          },
          focus: function() {
            module.set.focus();
            if(settings.searchOnFocus && module.has.minimumCharacters() ) {
              module.query(function() {
                if(module.can.show() ) {
                  module.showResults();
                }
              });
            }
          },
          blur: function(event) {
            var
              pageLostFocus = (document.activeElement === this),
              callback      = function() {
                module.cancel.query();
                module.remove.focus();
                module.timer = setTimeout(module.hideResults, settings.hideDelay);
              }
            ;
            if(pageLostFocus) {
              return;
            }
            resultsDismissed = false;
            if(module.resultsClicked) {
              module.debug('Determining if user action caused search to close');
              $module
                .one('click.close' + eventNamespace, selector.results, function(event) {
                  if(module.is.inMessage(event) || disabledBubbled) {
                    $prompt.focus();
                    return;
                  }
                  disabledBubbled = false;
                  if( !module.is.animating() && !module.is.hidden()) {
                    callback();
                  }
                })
              ;
            }
            else {
              module.debug('Input blurred without user action, closing results');
              callback();
            }
          },
          result: {
            mousedown: function() {
              module.resultsClicked = true;
            },
            mouseup: function() {
              module.resultsClicked = false;
            },
            click: function(event) {
              module.debug('Search result selected');
              var
                $result = $(this),
                $title  = $result.find(selector.title).eq(0),
                $link   = $result.is('a[href]')
                  ? $result
                  : $result.find('a[href]').eq(0),
                href    = $link.attr('href')   || false,
                target  = $link.attr('target') || false,
                title   = $title.html(),
                // title is used for result lookup
                value   = ($title.length > 0)
                  ? $title.text()
                  : false,
                results = module.get.results(),
                result  = $result.data(metadata.result) || module.get.result(value, results),
                returnedValue
              ;
              if( $.isFunction(settings.onSelect) ) {
                if(settings.onSelect.call(element, result, results) === false) {
                  module.debug('Custom onSelect callback cancelled default select action');
                  disabledBubbled = true;
                  return;
                }
              }
              module.hideResults();
              if(value) {
                module.set.value(value);
              }
              if(href) {
                module.verbose('Opening search link found in result', $link);
                if(target == '_blank' || event.ctrlKey) {
                  window.open(href);
                }
                else {
                  window.location.href = (href);
                }
              }
            }
          }
        },
        handleKeyboard: function(event) {
          var
            // force selector refresh
            $result         = $module.find(selector.result),
            $category       = $module.find(selector.category),
            $activeResult   = $result.filter('.' + className.active),
            currentIndex    = $result.index( $activeResult ),
            resultSize      = $result.length,
            hasActiveResult = $activeResult.length > 0,

            keyCode         = event.which,
            keys            = {
              backspace : 8,
              enter     : 13,
              escape    : 27,
              upArrow   : 38,
              downArrow : 40
            },
            newIndex
          ;
          // search shortcuts
          if(keyCode == keys.escape) {
            module.verbose('Escape key pressed, blurring search field');
            module.hideResults();
            resultsDismissed = true;
          }
          if( module.is.visible() ) {
            if(keyCode == keys.enter) {
              module.verbose('Enter key pressed, selecting active result');
              if( $result.filter('.' + className.active).length > 0 ) {
                module.event.result.click.call($result.filter('.' + className.active), event);
                event.preventDefault();
                return false;
              }
            }
            else if(keyCode == keys.upArrow && hasActiveResult) {
              module.verbose('Up key pressed, changing active result');
              newIndex = (currentIndex - 1 < 0)
                ? currentIndex
                : currentIndex - 1
              ;
              $category
                .removeClass(className.active)
              ;
              $result
                .removeClass(className.active)
                .eq(newIndex)
                  .addClass(className.active)
                  .closest($category)
                    .addClass(className.active)
              ;
              event.preventDefault();
            }
            else if(keyCode == keys.downArrow) {
              module.verbose('Down key pressed, changing active result');
              newIndex = (currentIndex + 1 >= resultSize)
                ? currentIndex
                : currentIndex + 1
              ;
              $category
                .removeClass(className.active)
              ;
              $result
                .removeClass(className.active)
                .eq(newIndex)
                  .addClass(className.active)
                  .closest($category)
                    .addClass(className.active)
              ;
              event.preventDefault();
            }
          }
          else {
            // query shortcuts
            if(keyCode == keys.enter) {
              module.verbose('Enter key pressed, executing query');
              module.query();
              module.set.buttonPressed();
              $prompt.one('keyup', module.remove.buttonFocus);
            }
          }
        },

        setup: {
          api: function(searchTerm, callback) {
            var
              apiSettings = {
                debug             : settings.debug,
                on                : false,
                cache             : settings.cache,
                action            : 'search',
                urlData           : {
                  query : searchTerm
                },
                onSuccess         : function(response) {
                  module.parse.response.call(element, response, searchTerm);
                  callback();
                },
                onFailure         : function() {
                  module.displayMessage(error.serverError);
                  callback();
                },
                onAbort : function(response) {
                },
                onError           : module.error
              },
              searchHTML
            ;
            $.extend(true, apiSettings, settings.apiSettings);
            module.verbose('Setting up API request', apiSettings);
            $module.api(apiSettings);
          }
        },

        can: {
          useAPI: function() {
            return $.fn.api !== undefined;
          },
          show: function() {
            return module.is.focused() && !module.is.visible() && !module.is.empty();
          },
          transition: function() {
            return settings.transition && $.fn.transition !== undefined && $module.transition('is supported');
          }
        },

        is: {
          animating: function() {
            return $results.hasClass(className.animating);
          },
          hidden: function() {
            return $results.hasClass(className.hidden);
          },
          inMessage: function(event) {
            if(!event.target) {
              return;
            }
            var
              $target = $(event.target),
              isInDOM = $.contains(document.documentElement, event.target)
            ;
            return (isInDOM && $target.closest(selector.message).length > 0);
          },
          empty: function() {
            return ($results.html() === '');
          },
          visible: function() {
            return ($results.filter(':visible').length > 0);
          },
          focused: function() {
            return ($prompt.filter(':focus').length > 0);
          }
        },

        get: {
          settings: function() {
            if($.isPlainObject(parameters) && parameters.searchFullText) {
              settings.fullTextSearch = parameters.searchFullText;
              module.error(settings.error.oldSearchSyntax, element);
            }
          },
          inputEvent: function() {
            var
              prompt = $prompt[0],
              inputEvent   = (prompt !== undefined && prompt.oninput !== undefined)
                ? 'input'
                : (prompt !== undefined && prompt.onpropertychange !== undefined)
                  ? 'propertychange'
                  : 'keyup'
            ;
            return inputEvent;
          },
          value: function() {
            return $prompt.val();
          },
          results: function() {
            var
              results = $module.data(metadata.results)
            ;
            return results;
          },
          result: function(value, results) {
            var
              lookupFields = ['title', 'id'],
              result       = false
            ;
            value = (value !== undefined)
              ? value
              : module.get.value()
            ;
            results = (results !== undefined)
              ? results
              : module.get.results()
            ;
            if(settings.type === 'category') {
              module.debug('Finding result that matches', value);
              $.each(results, function(index, category) {
                if($.isArray(category.results)) {
                  result = module.search.object(value, category.results, lookupFields)[0];
                  // don't continue searching if a result is found
                  if(result) {
                    return false;
                  }
                }
              });
            }
            else {
              module.debug('Finding result in results object', value);
              result = module.search.object(value, results, lookupFields)[0];
            }
            return result || false;
          },
        },

        select: {
          firstResult: function() {
            module.verbose('Selecting first result');
            $result.first().addClass(className.active);
          }
        },

        set: {
          focus: function() {
            $module.addClass(className.focus);
          },
          loading: function() {
            $module.addClass(className.loading);
          },
          value: function(value) {
            module.verbose('Setting search input value', value);
            $prompt
              .val(value)
            ;
          },
          type: function(type) {
            type = type || settings.type;
            if(settings.type == 'category') {
              $module.addClass(settings.type);
            }
          },
          buttonPressed: function() {
            $searchButton.addClass(className.pressed);
          }
        },

        remove: {
          loading: function() {
            $module.removeClass(className.loading);
          },
          focus: function() {
            $module.removeClass(className.focus);
          },
          buttonPressed: function() {
            $searchButton.removeClass(className.pressed);
          }
        },

        query: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          var
            searchTerm = module.get.value(),
            cache = module.read.cache(searchTerm)
          ;
          callback = callback || function() {};
          if( module.has.minimumCharacters() )  {
            if(cache) {
              module.debug('Reading result from cache', searchTerm);
              module.save.results(cache.results);
              module.addResults(cache.html);
              module.inject.id(cache.results);
              callback();
            }
            else {
              module.debug('Querying for', searchTerm);
              if($.isPlainObject(settings.source) || $.isArray(settings.source)) {
                module.search.local(searchTerm);
                callback();
              }
              else if( module.can.useAPI() ) {
                module.search.remote(searchTerm, callback);
              }
              else {
                module.error(error.source);
                callback();
              }
            }
            settings.onSearchQuery.call(element, searchTerm);
          }
          else {
            module.hideResults();
          }
        },

        search: {
          local: function(searchTerm) {
            var
              results = module.search.object(searchTerm, settings.content),
              searchHTML
            ;
            module.set.loading();
            module.save.results(results);
            module.debug('Returned full local search results', results);
            if(settings.maxResults > 0) {
              module.debug('Using specified max results', results);
              results = results.slice(0, settings.maxResults);
            }
            if(settings.type == 'category') {
              results = module.create.categoryResults(results);
            }
            searchHTML = module.generateResults({
              results: results
            });
            module.remove.loading();
            module.addResults(searchHTML);
            module.inject.id(results);
            module.write.cache(searchTerm, {
              html    : searchHTML,
              results : results
            });
          },
          remote: function(searchTerm, callback) {
            callback = $.isFunction(callback)
              ? callback
              : function(){}
            ;
            if($module.api('is loading')) {
              $module.api('abort');
            }
            module.setup.api(searchTerm, callback);
            $module
              .api('query')
            ;
          },
          object: function(searchTerm, source, searchFields) {
            var
              results      = [],
              exactResults = [],
              fuzzyResults = [],
              searchExp    = searchTerm.toString().replace(regExp.escape, '\\$&'),
              matchRegExp  = new RegExp(regExp.beginsWith + searchExp, 'i'),

              // avoid duplicates when pushing results
              addResult = function(array, result) {
                var
                  notResult      = ($.inArray(result, results) == -1),
                  notFuzzyResult = ($.inArray(result, fuzzyResults) == -1),
                  notExactResults = ($.inArray(result, exactResults) == -1)
                ;
                if(notResult && notFuzzyResult && notExactResults) {
                  array.push(result);
                }
              }
            ;
            source = source || settings.source;
            searchFields = (searchFields !== undefined)
              ? searchFields
              : settings.searchFields
            ;

            // search fields should be array to loop correctly
            if(!$.isArray(searchFields)) {
              searchFields = [searchFields];
            }

            // exit conditions if no source
            if(source === undefined || source === false) {
              module.error(error.source);
              return [];
            }
            // iterate through search fields looking for matches
            $.each(searchFields, function(index, field) {
              $.each(source, function(label, content) {
                var
                  fieldExists = (typeof content[field] == 'string')
                ;
                if(fieldExists) {
                  if( content[field].search(matchRegExp) !== -1) {
                    // content starts with value (first in results)
                    addResult(results, content);
                  }
                  else if(settings.fullTextSearch === 'exact' && module.exactSearch(searchTerm, content[field]) ) {
                    // content fuzzy matches (last in results)
                    addResult(exactResults, content);
                  }
                  else if(settings.fullTextSearch == true && module.fuzzySearch(searchTerm, content[field]) ) {
                    // content fuzzy matches (last in results)
                    addResult(fuzzyResults, content);
                  }
                }
              });
            });
            $.merge(exactResults, fuzzyResults)
            $.merge(results, exactResults);
            return results;
          }
        },
        exactSearch: function (query, term) {
          query = query.toLowerCase();
          term  = term.toLowerCase();
          if(term.indexOf(query) > -1) {
             return true;
          }
          return false;
        },
        fuzzySearch: function(query, term) {
          var
            termLength  = term.length,
            queryLength = query.length
          ;
          if(typeof query !== 'string') {
            return false;
          }
          query = query.toLowerCase();
          term  = term.toLowerCase();
          if(queryLength > termLength) {
            return false;
          }
          if(queryLength === termLength) {
            return (query === term);
          }
          search: for (var characterIndex = 0, nextCharacterIndex = 0; characterIndex < queryLength; characterIndex++) {
            var
              queryCharacter = query.charCodeAt(characterIndex)
            ;
            while(nextCharacterIndex < termLength) {
              if(term.charCodeAt(nextCharacterIndex++) === queryCharacter) {
                continue search;
              }
            }
            return false;
          }
          return true;
        },

        parse: {
          response: function(response, searchTerm) {
            var
              searchHTML = module.generateResults(response)
            ;
            module.verbose('Parsing server response', response);
            if(response !== undefined) {
              if(searchTerm !== undefined && response[fields.results] !== undefined) {
                module.addResults(searchHTML);
                module.inject.id(response[fields.results]);
                module.write.cache(searchTerm, {
                  html    : searchHTML,
                  results : response[fields.results]
                });
                module.save.results(response[fields.results]);
              }
            }
          }
        },

        cancel: {
          query: function() {
            if( module.can.useAPI() ) {
              $module.api('abort');
            }
          }
        },

        has: {
          minimumCharacters: function() {
            var
              searchTerm    = module.get.value(),
              numCharacters = searchTerm.length
            ;
            return (numCharacters >= settings.minCharacters);
          },
          results: function() {
            if($results.length === 0) {
              return false;
            }
            var
              html = $results.html()
            ;
            return html != '';
          }
        },

        clear: {
          cache: function(value) {
            var
              cache = $module.data(metadata.cache)
            ;
            if(!value) {
              module.debug('Clearing cache', value);
              $module.removeData(metadata.cache);
            }
            else if(value && cache && cache[value]) {
              module.debug('Removing value from cache', value);
              delete cache[value];
              $module.data(metadata.cache, cache);
            }
          }
        },

        read: {
          cache: function(name) {
            var
              cache = $module.data(metadata.cache)
            ;
            if(settings.cache) {
              module.verbose('Checking cache for generated html for query', name);
              return (typeof cache == 'object') && (cache[name] !== undefined)
                ? cache[name]
                : false
              ;
            }
            return false;
          }
        },

        create: {
          categoryResults: function(results) {
            var
              categoryResults = {}
            ;
            $.each(results, function(index, result) {
              if(!result.category) {
                return;
              }
              if(categoryResults[result.category] === undefined) {
                module.verbose('Creating new category of results', result.category);
                categoryResults[result.category] = {
                  name    : result.category,
                  results : [result]
                }
              }
              else {
                categoryResults[result.category].results.push(result);
              }
            });
            return categoryResults;
          },
          id: function(resultIndex, categoryIndex) {
            var
              resultID      = (resultIndex + 1), // not zero indexed
              categoryID    = (categoryIndex + 1),
              firstCharCode,
              letterID,
              id
            ;
            if(categoryIndex !== undefined) {
              // start char code for "A"
              letterID = String.fromCharCode(97 + categoryIndex);
              id          = letterID + resultID;
              module.verbose('Creating category result id', id);
            }
            else {
              id = resultID;
              module.verbose('Creating result id', id);
            }
            return id;
          },
          results: function() {
            if($results.length === 0) {
              $results = $('<div />')
                .addClass(className.results)
                .appendTo($module)
              ;
            }
          }
        },

        inject: {
          result: function(result, resultIndex, categoryIndex) {
            module.verbose('Injecting result into results');
            var
              $selectedResult = (categoryIndex !== undefined)
                ? $results
                    .children().eq(categoryIndex)
                      .children(selector.results)
                        .first()
                        .children(selector.result)
                          .eq(resultIndex)
                : $results
                    .children(selector.result).eq(resultIndex)
            ;
            module.verbose('Injecting results metadata', $selectedResult);
            $selectedResult
              .data(metadata.result, result)
            ;
          },
          id: function(results) {
            module.debug('Injecting unique ids into results');
            var
              // since results may be object, we must use counters
              categoryIndex = 0,
              resultIndex   = 0
            ;
            if(settings.type === 'category') {
              // iterate through each category result
              $.each(results, function(index, category) {
                resultIndex = 0;
                $.each(category.results, function(index, value) {
                  var
                    result = category.results[index]
                  ;
                  if(result.id === undefined) {
                    result.id = module.create.id(resultIndex, categoryIndex);
                  }
                  module.inject.result(result, resultIndex, categoryIndex);
                  resultIndex++;
                });
                categoryIndex++;
              });
            }
            else {
              // top level
              $.each(results, function(index, value) {
                var
                  result = results[index]
                ;
                if(result.id === undefined) {
                  result.id = module.create.id(resultIndex);
                }
                module.inject.result(result, resultIndex);
                resultIndex++;
              });
            }
            return results;
          }
        },

        save: {
          results: function(results) {
            module.verbose('Saving current search results to metadata', results);
            $module.data(metadata.results, results);
          }
        },

        write: {
          cache: function(name, value) {
            var
              cache = ($module.data(metadata.cache) !== undefined)
                ? $module.data(metadata.cache)
                : {}
            ;
            if(settings.cache) {
              module.verbose('Writing generated html to cache', name, value);
              cache[name] = value;
              $module
                .data(metadata.cache, cache)
              ;
            }
          }
        },

        addResults: function(html) {
          if( $.isFunction(settings.onResultsAdd) ) {
            if( settings.onResultsAdd.call($results, html) === false ) {
              module.debug('onResultsAdd callback cancelled default action');
              return false;
            }
          }
          if(html) {
            $results
              .html(html)
            ;
            module.refreshResults();
            if(settings.selectFirstResult) {
              module.select.firstResult();
            }
            module.showResults();
          }
          else {
            module.hideResults(function() {
              $results.empty();
            });
          }
        },

        showResults: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          if(resultsDismissed) {
            return;
          }
          if(!module.is.visible() && module.has.results()) {
            if( module.can.transition() ) {
              module.debug('Showing results with css animations');
              $results
                .transition({
                  animation  : settings.transition + ' in',
                  debug      : settings.debug,
                  verbose    : settings.verbose,
                  duration   : settings.duration,
                  onComplete : function() {
                    callback();
                  },
                  queue      : true
                })
              ;
            }
            else {
              module.debug('Showing results with javascript');
              $results
                .stop()
                .fadeIn(settings.duration, settings.easing)
              ;
            }
            settings.onResultsOpen.call($results);
          }
        },
        hideResults: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          if( module.is.visible() ) {
            if( module.can.transition() ) {
              module.debug('Hiding results with css animations');
              $results
                .transition({
                  animation  : settings.transition + ' out',
                  debug      : settings.debug,
                  verbose    : settings.verbose,
                  duration   : settings.duration,
                  onComplete : function() {
                    callback();
                  },
                  queue      : true
                })
              ;
            }
            else {
              module.debug('Hiding results with javascript');
              $results
                .stop()
                .fadeOut(settings.duration, settings.easing)
              ;
            }
            settings.onResultsClose.call($results);
          }
        },

        generateResults: function(response) {
          module.debug('Generating html from response', response);
          var
            template       = settings.templates[settings.type],
            isProperObject = ($.isPlainObject(response[fields.results]) && !$.isEmptyObject(response[fields.results])),
            isProperArray  = ($.isArray(response[fields.results]) && response[fields.results].length > 0),
            html           = ''
          ;
          if(isProperObject || isProperArray ) {
            if(settings.maxResults > 0) {
              if(isProperObject) {
                if(settings.type == 'standard') {
                  module.error(error.maxResults);
                }
              }
              else {
                response[fields.results] = response[fields.results].slice(0, settings.maxResults);
              }
            }
            if($.isFunction(template)) {
              html = template(response, fields);
            }
            else {
              module.error(error.noTemplate, false);
            }
          }
          else if(settings.showNoResults) {
            html = module.displayMessage(error.noResults, 'empty');
          }
          settings.onResults.call(element, response);
          return html;
        },

        displayMessage: function(text, type) {
          type = type || 'standard';
          module.debug('Displaying message', text, type);
          module.addResults( settings.templates.message(text, type) );
          return settings.templates.message(text, type);
        },

        setting: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            settings[name] = value;
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if($allModules.length > 1) {
              title += ' ' + '(' + $allModules.length + ')';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                return false;
              }
            });
          }
          if( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };
      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }

    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.search.settings = {

  name              : 'Search',
  namespace         : 'search',

  silent            : false,
  debug             : false,
  verbose           : false,
  performance       : true,

  // template to use (specified in settings.templates)
  type              : 'standard',

  // minimum characters required to search
  minCharacters     : 1,

  // whether to select first result after searching automatically
  selectFirstResult : false,

  // API config
  apiSettings       : false,

  // object to search
  source            : false,

  // Whether search should query current term on focus
  searchOnFocus     : true,

  // fields to search
  searchFields   : [
    'title',
    'description'
  ],

  // field to display in standard results template
  displayField   : '',

  // search anywhere in value (set to 'exact' to require exact matches
  fullTextSearch : 'exact',

  // whether to add events to prompt automatically
  automatic      : true,

  // delay before hiding menu after blur
  hideDelay      : 0,

  // delay before searching
  searchDelay    : 200,

  // maximum results returned from search
  maxResults     : 7,

  // whether to store lookups in local cache
  cache          : true,

  // whether no results errors should be shown
  showNoResults  : true,

  // transition settings
  transition     : 'scale',
  duration       : 200,
  easing         : 'easeOutExpo',

  // callbacks
  onSelect       : false,
  onResultsAdd   : false,

  onSearchQuery  : function(query){},
  onResults      : function(response){},

  onResultsOpen  : function(){},
  onResultsClose : function(){},

  className: {
    animating : 'animating',
    active    : 'active',
    empty     : 'empty',
    focus     : 'focus',
    hidden    : 'hidden',
    loading   : 'loading',
    results   : 'results',
    pressed   : 'down'
  },

  error : {
    source          : 'Cannot search. No source used, and Semantic API module was not included',
    noResults       : 'Your search returned no results',
    logging         : 'Error in debug logging, exiting.',
    noEndpoint      : 'No search endpoint was specified',
    noTemplate      : 'A valid template name was not specified.',
    oldSearchSyntax : 'searchFullText setting has been renamed fullTextSearch for consistency, please adjust your settings.',
    serverError     : 'There was an issue querying the server.',
    maxResults      : 'Results must be an array to use maxResults setting',
    method          : 'The method you called is not defined.'
  },

  metadata: {
    cache   : 'cache',
    results : 'results',
    result  : 'result'
  },

  regExp: {
    escape     : /[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,
    beginsWith : '(?:\s|^)'
  },

  // maps api response attributes to internal representation
  fields: {
    categories      : 'results',     // array of categories (category view)
    categoryName    : 'name',        // name of category (category view)
    categoryResults : 'results',     // array of results (category view)
    description     : 'description', // result description
    image           : 'image',       // result image
    price           : 'price',       // result price
    results         : 'results',     // array of results (standard)
    title           : 'title',       // result title
    url             : 'url',         // result url
    action          : 'action',      // "view more" object name
    actionText      : 'text',        // "view more" text
    actionURL       : 'url'          // "view more" url
  },

  selector : {
    prompt       : '.prompt',
    searchButton : '.search.button',
    results      : '.results',
    message      : '.results > .message',
    category     : '.category',
    result       : '.result',
    title        : '.title, .name'
  },

  templates: {
    escape: function(string) {
      var
        badChars     = /[&<>"'`]/g,
        shouldEscape = /[&<>"'`]/,
        escape       = {
          "&": "&amp;",
          "<": "&lt;",
          ">": "&gt;",
          '"': "&quot;",
          "'": "&#x27;",
          "`": "&#x60;"
        },
        escapedChar  = function(chr) {
          return escape[chr];
        }
      ;
      if(shouldEscape.test(string)) {
        return string.replace(badChars, escapedChar);
      }
      return string;
    },
    message: function(message, type) {
      var
        html = ''
      ;
      if(message !== undefined && type !== undefined) {
        html +=  ''
          + '<div class="message ' + type + '">'
        ;
        // message type
        if(type == 'empty') {
          html += ''
            + '<div class="header">No Results</div class="header">'
            + '<div class="description">' + message + '</div class="description">'
          ;
        }
        else {
          html += ' <div class="description">' + message + '</div>';
        }
        html += '</div>';
      }
      return html;
    },
    category: function(response, fields) {
      var
        html = '',
        escape = $.fn.search.settings.templates.escape
      ;
      if(response[fields.categoryResults] !== undefined) {

        // each category
        $.each(response[fields.categoryResults], function(index, category) {
          if(category[fields.results] !== undefined && category.results.length > 0) {

            html  += '<div class="category">';

            if(category[fields.categoryName] !== undefined) {
              html += '<div class="name">' + category[fields.categoryName] + '</div>';
            }

            // each item inside category
            html += '<div class="results">';
            $.each(category.results, function(index, result) {
              if(result[fields.url]) {
                html  += '<a class="result" href="' + result[fields.url] + '">';
              }
              else {
                html  += '<a class="result">';
              }
              if(result[fields.image] !== undefined) {
                html += ''
                  + '<div class="image">'
                  + ' <img src="' + result[fields.image] + '">'
                  + '</div>'
                ;
              }
              html += '<div class="content">';
              if(result[fields.price] !== undefined) {
                html += '<div class="price">' + result[fields.price] + '</div>';
              }
              if(result[fields.title] !== undefined) {
                html += '<div class="title">' + result[fields.title] + '</div>';
              }
              if(result[fields.description] !== undefined) {
                html += '<div class="description">' + result[fields.description] + '</div>';
              }
              html  += ''
                + '</div>'
              ;
              html += '</a>';
            });
            html += '</div>';
            html  += ''
              + '</div>'
            ;
          }
        });
        if(response[fields.action]) {
          html += ''
          + '<a href="' + response[fields.action][fields.actionURL] + '" class="action">'
          +   response[fields.action][fields.actionText]
          + '</a>';
        }
        return html;
      }
      return false;
    },
    standard: function(response, fields) {
      var
        html = ''
      ;
      if(response[fields.results] !== undefined) {

        // each result
        $.each(response[fields.results], function(index, result) {
          if(result[fields.url]) {
            html  += '<a class="result" href="' + result[fields.url] + '">';
          }
          else {
            html  += '<a class="result">';
          }
          if(result[fields.image] !== undefined) {
            html += ''
              + '<div class="image">'
              + ' <img src="' + result[fields.image] + '">'
              + '</div>'
            ;
          }
          html += '<div class="content">';
          if(result[fields.price] !== undefined) {
            html += '<div class="price">' + result[fields.price] + '</div>';
          }
          if(result[fields.title] !== undefined) {
            html += '<div class="title">' + result[fields.title] + '</div>';
          }
          if(result[fields.description] !== undefined) {
            html += '<div class="description">' + result[fields.description] + '</div>';
          }
          html  += ''
            + '</div>'
          ;
          html += '</a>';
        });

        if(response[fields.action]) {
          html += ''
          + '<a href="' + response[fields.action][fields.actionURL] + '" class="action">'
          +   response[fields.action][fields.actionText]
          + '</a>';
        }
        return html;
      }
      return false;
    }
  }
};

})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Shape
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.shape = function(parameters) {
  var
    $allModules     = $(this),
    $body           = $('body'),

    time            = new Date().getTime(),
    performance     = [],

    query           = arguments[0],
    methodInvoked   = (typeof query == 'string'),
    queryArguments  = [].slice.call(arguments, 1),

    requestAnimationFrame = window.requestAnimationFrame
      || window.mozRequestAnimationFrame
      || window.webkitRequestAnimationFrame
      || window.msRequestAnimationFrame
      || function(callback) { setTimeout(callback, 0); },

    returnedValue
  ;

  $allModules
    .each(function() {
      var
        moduleSelector = $allModules.selector || '',
        settings       = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.shape.settings, parameters)
          : $.extend({}, $.fn.shape.settings),

        // internal aliases
        namespace     = settings.namespace,
        selector      = settings.selector,
        error         = settings.error,
        className     = settings.className,

        // define namespaces for modules
        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,

        // selector cache
        $module       = $(this),
        $sides        = $module.find(selector.sides),
        $side         = $module.find(selector.side),

        // private variables
        nextIndex = false,
        $activeSide,
        $nextSide,

        // standard module
        element       = this,
        instance      = $module.data(moduleNamespace),
        module
      ;

      module = {

        initialize: function() {
          module.verbose('Initializing module for', element);
          module.set.defaultSide();
          module.instantiate();
        },

        instantiate: function() {
          module.verbose('Storing instance of module', module);
          instance = module;
          $module
            .data(moduleNamespace, instance)
          ;
        },

        destroy: function() {
          module.verbose('Destroying previous module for', element);
          $module
            .removeData(moduleNamespace)
            .off(eventNamespace)
          ;
        },

        refresh: function() {
          module.verbose('Refreshing selector cache for', element);
          $module = $(element);
          $sides  = $(this).find(selector.shape);
          $side   = $(this).find(selector.side);
        },

        repaint: function() {
          module.verbose('Forcing repaint event');
          var
            shape          = $sides[0] || document.createElement('div'),
            fakeAssignment = shape.offsetWidth
          ;
        },

        animate: function(propertyObject, callback) {
          module.verbose('Animating box with properties', propertyObject);
          callback = callback || function(event) {
            module.verbose('Executing animation callback');
            if(event !== undefined) {
              event.stopPropagation();
            }
            module.reset();
            module.set.active();
          };
          settings.beforeChange.call($nextSide[0]);
          if(module.get.transitionEvent()) {
            module.verbose('Starting CSS animation');
            $module
              .addClass(className.animating)
            ;
            $sides
              .css(propertyObject)
              .one(module.get.transitionEvent(), callback)
            ;
            module.set.duration(settings.duration);
            requestAnimationFrame(function() {
              $module
                .addClass(className.animating)
              ;
              $activeSide
                .addClass(className.hidden)
              ;
            });
          }
          else {
            callback();
          }
        },

        queue: function(method) {
          module.debug('Queueing animation of', method);
          $sides
            .one(module.get.transitionEvent(), function() {
              module.debug('Executing queued animation');
              setTimeout(function(){
                $module.shape(method);
              }, 0);
            })
          ;
        },

        reset: function() {
          module.verbose('Animating states reset');
          $module
            .removeClass(className.animating)
            .attr('style', '')
            .removeAttr('style')
          ;
          // removeAttr style does not consistently work in safari
          $sides
            .attr('style', '')
            .removeAttr('style')
          ;
          $side
            .attr('style', '')
            .removeAttr('style')
            .removeClass(className.hidden)
          ;
          $nextSide
            .removeClass(className.animating)
            .attr('style', '')
            .removeAttr('style')
          ;
        },

        is: {
          complete: function() {
            return ($side.filter('.' + className.active)[0] == $nextSide[0]);
          },
          animating: function() {
            return $module.hasClass(className.animating);
          }
        },

        set: {

          defaultSide: function() {
            $activeSide = $module.find('.' + settings.className.active);
            $nextSide   = ( $activeSide.next(selector.side).length > 0 )
              ? $activeSide.next(selector.side)
              : $module.find(selector.side).first()
            ;
            nextIndex = false;
            module.verbose('Active side set to', $activeSide);
            module.verbose('Next side set to', $nextSide);
          },

          duration: function(duration) {
            duration = duration || settings.duration;
            duration = (typeof duration == 'number')
              ? duration + 'ms'
              : duration
            ;
            module.verbose('Setting animation duration', duration);
            if(settings.duration || settings.duration === 0) {
              $sides.add($side)
                .css({
                  '-webkit-transition-duration': duration,
                  '-moz-transition-duration': duration,
                  '-ms-transition-duration': duration,
                  '-o-transition-duration': duration,
                  'transition-duration': duration
                })
              ;
            }
          },

          currentStageSize: function() {
            var
              $activeSide = $module.find('.' + settings.className.active),
              width       = $activeSide.outerWidth(true),
              height      = $activeSide.outerHeight(true)
            ;
            $module
              .css({
                width: width,
                height: height
              })
            ;
          },

          stageSize: function() {
            var
              $clone      = $module.clone().addClass(className.loading),
              $activeSide = $clone.find('.' + settings.className.active),
              $nextSide   = (nextIndex)
                ? $clone.find(selector.side).eq(nextIndex)
                : ( $activeSide.next(selector.side).length > 0 )
                  ? $activeSide.next(selector.side)
                  : $clone.find(selector.side).first(),
              newWidth    = (settings.width == 'next')
                ? $nextSide.outerWidth(true)
                : (settings.width == 'initial')
                  ? $module.width()
                  : settings.width,
              newHeight    = (settings.height == 'next')
                ? $nextSide.outerHeight(true)
                : (settings.height == 'initial')
                  ? $module.height()
                  : settings.height
            ;
            $activeSide.removeClass(className.active);
            $nextSide.addClass(className.active);
            $clone.insertAfter($module);
            $clone.remove();
            if(settings.width != 'auto') {
              $module.css('width', newWidth + settings.jitter);
              module.verbose('Specifying width during animation', newWidth);
            }
            if(settings.height != 'auto') {
              $module.css('height', newHeight + settings.jitter);
              module.verbose('Specifying height during animation', newHeight);
            }
          },

          nextSide: function(selector) {
            nextIndex = selector;
            $nextSide = $side.filter(selector);
            nextIndex = $side.index($nextSide);
            if($nextSide.length === 0) {
              module.set.defaultSide();
              module.error(error.side);
            }
            module.verbose('Next side manually set to', $nextSide);
          },

          active: function() {
            module.verbose('Setting new side to active', $nextSide);
            $side
              .removeClass(className.active)
            ;
            $nextSide
              .addClass(className.active)
            ;
            settings.onChange.call($nextSide[0]);
            module.set.defaultSide();
          }
        },

        flip: {

          up: function() {
            if(module.is.complete() && !module.is.animating() && !settings.allowRepeats) {
              module.debug('Side already visible', $nextSide);
              return;
            }
            if( !module.is.animating()) {
              module.debug('Flipping up', $nextSide);
              var
                transform = module.get.transform.up()
              ;
              module.set.stageSize();
              module.stage.above();
              module.animate(transform);
            }
            else {
              module.queue('flip up');
            }
          },

          down: function() {
            if(module.is.complete() && !module.is.animating() && !settings.allowRepeats) {
              module.debug('Side already visible', $nextSide);
              return;
            }
            if( !module.is.animating()) {
              module.debug('Flipping down', $nextSide);
              var
                transform = module.get.transform.down()
              ;
              module.set.stageSize();
              module.stage.below();
              module.animate(transform);
            }
            else {
              module.queue('flip down');
            }
          },

          left: function() {
            if(module.is.complete() && !module.is.animating() && !settings.allowRepeats) {
              module.debug('Side already visible', $nextSide);
              return;
            }
            if( !module.is.animating()) {
              module.debug('Flipping left', $nextSide);
              var
                transform = module.get.transform.left()
              ;
              module.set.stageSize();
              module.stage.left();
              module.animate(transform);
            }
            else {
              module.queue('flip left');
            }
          },

          right: function() {
            if(module.is.complete() && !module.is.animating() && !settings.allowRepeats) {
              module.debug('Side already visible', $nextSide);
              return;
            }
            if( !module.is.animating()) {
              module.debug('Flipping right', $nextSide);
              var
                transform = module.get.transform.right()
              ;
              module.set.stageSize();
              module.stage.right();
              module.animate(transform);
            }
            else {
              module.queue('flip right');
            }
          },

          over: function() {
            if(module.is.complete() && !module.is.animating() && !settings.allowRepeats) {
              module.debug('Side already visible', $nextSide);
              return;
            }
            if( !module.is.animating()) {
              module.debug('Flipping over', $nextSide);
              module.set.stageSize();
              module.stage.behind();
              module.animate(module.get.transform.over() );
            }
            else {
              module.queue('flip over');
            }
          },

          back: function() {
            if(module.is.complete() && !module.is.animating() && !settings.allowRepeats) {
              module.debug('Side already visible', $nextSide);
              return;
            }
            if( !module.is.animating()) {
              module.debug('Flipping back', $nextSide);
              module.set.stageSize();
              module.stage.behind();
              module.animate(module.get.transform.back() );
            }
            else {
              module.queue('flip back');
            }
          }

        },

        get: {

          transform: {
            up: function() {
              var
                translate = {
                  y: -(($activeSide.outerHeight(true) - $nextSide.outerHeight(true)) / 2),
                  z: -($activeSide.outerHeight(true) / 2)
                }
              ;
              return {
                transform: 'translateY(' + translate.y + 'px) translateZ('+ translate.z + 'px) rotateX(-90deg)'
              };
            },

            down: function() {
              var
                translate = {
                  y: -(($activeSide.outerHeight(true) - $nextSide.outerHeight(true)) / 2),
                  z: -($activeSide.outerHeight(true) / 2)
                }
              ;
              return {
                transform: 'translateY(' + translate.y + 'px) translateZ('+ translate.z + 'px) rotateX(90deg)'
              };
            },

            left: function() {
              var
                translate = {
                  x : -(($activeSide.outerWidth(true) - $nextSide.outerWidth(true)) / 2),
                  z : -($activeSide.outerWidth(true) / 2)
                }
              ;
              return {
                transform: 'translateX(' + translate.x + 'px) translateZ(' + translate.z + 'px) rotateY(90deg)'
              };
            },

            right: function() {
              var
                translate = {
                  x : -(($activeSide.outerWidth(true) - $nextSide.outerWidth(true)) / 2),
                  z : -($activeSide.outerWidth(true) / 2)
                }
              ;
              return {
                transform: 'translateX(' + translate.x + 'px) translateZ(' + translate.z + 'px) rotateY(-90deg)'
              };
            },

            over: function() {
              var
                translate = {
                  x : -(($activeSide.outerWidth(true) - $nextSide.outerWidth(true)) / 2)
                }
              ;
              return {
                transform: 'translateX(' + translate.x + 'px) rotateY(180deg)'
              };
            },

            back: function() {
              var
                translate = {
                  x : -(($activeSide.outerWidth(true) - $nextSide.outerWidth(true)) / 2)
                }
              ;
              return {
                transform: 'translateX(' + translate.x + 'px) rotateY(-180deg)'
              };
            }
          },

          transitionEvent: function() {
            var
              element     = document.createElement('element'),
              transitions = {
                'transition'       :'transitionend',
                'OTransition'      :'oTransitionEnd',
                'MozTransition'    :'transitionend',
                'WebkitTransition' :'webkitTransitionEnd'
              },
              transition
            ;
            for(transition in transitions){
              if( element.style[transition] !== undefined ){
                return transitions[transition];
              }
            }
          },

          nextSide: function() {
            return ( $activeSide.next(selector.side).length > 0 )
              ? $activeSide.next(selector.side)
              : $module.find(selector.side).first()
            ;
          }

        },

        stage: {

          above: function() {
            var
              box = {
                origin : (($activeSide.outerHeight(true) - $nextSide.outerHeight(true)) / 2),
                depth  : {
                  active : ($nextSide.outerHeight(true) / 2),
                  next   : ($activeSide.outerHeight(true) / 2)
                }
              }
            ;
            module.verbose('Setting the initial animation position as above', $nextSide, box);
            $sides
              .css({
                'transform' : 'translateZ(-' + box.depth.active + 'px)'
              })
            ;
            $activeSide
              .css({
                'transform' : 'rotateY(0deg) translateZ(' + box.depth.active + 'px)'
              })
            ;
            $nextSide
              .addClass(className.animating)
              .css({
                'top'       : box.origin + 'px',
                'transform' : 'rotateX(90deg) translateZ(' + box.depth.next + 'px)'
              })
            ;
          },

          below: function() {
            var
              box = {
                origin : (($activeSide.outerHeight(true) - $nextSide.outerHeight(true)) / 2),
                depth  : {
                  active : ($nextSide.outerHeight(true) / 2),
                  next   : ($activeSide.outerHeight(true) / 2)
                }
              }
            ;
            module.verbose('Setting the initial animation position as below', $nextSide, box);
            $sides
              .css({
                'transform' : 'translateZ(-' + box.depth.active + 'px)'
              })
            ;
            $activeSide
              .css({
                'transform' : 'rotateY(0deg) translateZ(' + box.depth.active + 'px)'
              })
            ;
            $nextSide
              .addClass(className.animating)
              .css({
                'top'       : box.origin + 'px',
                'transform' : 'rotateX(-90deg) translateZ(' + box.depth.next + 'px)'
              })
            ;
          },

          left: function() {
            var
              height = {
                active : $activeSide.outerWidth(true),
                next   : $nextSide.outerWidth(true)
              },
              box = {
                origin : ( ( height.active - height.next ) / 2),
                depth  : {
                  active : (height.next / 2),
                  next   : (height.active / 2)
                }
              }
            ;
            module.verbose('Setting the initial animation position as left', $nextSide, box);
            $sides
              .css({
                'transform' : 'translateZ(-' + box.depth.active + 'px)'
              })
            ;
            $activeSide
              .css({
                'transform' : 'rotateY(0deg) translateZ(' + box.depth.active + 'px)'
              })
            ;
            $nextSide
              .addClass(className.animating)
              .css({
                'left'      : box.origin + 'px',
                'transform' : 'rotateY(-90deg) translateZ(' + box.depth.next + 'px)'
              })
            ;
          },

          right: function() {
            var
              height = {
                active : $activeSide.outerWidth(true),
                next   : $nextSide.outerWidth(true)
              },
              box = {
                origin : ( ( height.active - height.next ) / 2),
                depth  : {
                  active : (height.next / 2),
                  next   : (height.active / 2)
                }
              }
            ;
            module.verbose('Setting the initial animation position as left', $nextSide, box);
            $sides
              .css({
                'transform' : 'translateZ(-' + box.depth.active + 'px)'
              })
            ;
            $activeSide
              .css({
                'transform' : 'rotateY(0deg) translateZ(' + box.depth.active + 'px)'
              })
            ;
            $nextSide
              .addClass(className.animating)
              .css({
                'left'      : box.origin + 'px',
                'transform' : 'rotateY(90deg) translateZ(' + box.depth.next + 'px)'
              })
            ;
          },

          behind: function() {
            var
              height = {
                active : $activeSide.outerWidth(true),
                next   : $nextSide.outerWidth(true)
              },
              box = {
                origin : ( ( height.active - height.next ) / 2),
                depth  : {
                  active : (height.next / 2),
                  next   : (height.active / 2)
                }
              }
            ;
            module.verbose('Setting the initial animation position as behind', $nextSide, box);
            $activeSide
              .css({
                'transform' : 'rotateY(0deg)'
              })
            ;
            $nextSide
              .addClass(className.animating)
              .css({
                'left'      : box.origin + 'px',
                'transform' : 'rotateY(-180deg)'
              })
            ;
          }
        },
        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if($allModules.length > 1) {
              title += ' ' + '(' + $allModules.length + ')';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.shape.settings = {

  // module info
  name : 'Shape',

  // hide all debug content
  silent     : false,

  // debug content outputted to console
  debug      : false,

  // verbose debug output
  verbose    : false,

  // fudge factor in pixels when swapping from 2d to 3d (can be useful to correct rounding errors)
  jitter     : 0,

  // performance data output
  performance: true,

  // event namespace
  namespace  : 'shape',

  // width during animation, can be set to 'auto', initial', 'next' or pixel amount
  width: 'initial',

  // height during animation, can be set to 'auto', 'initial', 'next' or pixel amount
  height: 'initial',

  // callback occurs on side change
  beforeChange : function() {},
  onChange     : function() {},

  // allow animation to same side
  allowRepeats: false,

  // animation duration
  duration   : false,

  // possible errors
  error: {
    side   : 'You tried to switch to a side that does not exist.',
    method : 'The method you called is not defined'
  },

  // classnames used
  className   : {
    animating : 'animating',
    hidden    : 'hidden',
    loading   : 'loading',
    active    : 'active'
  },

  // selectors used
  selector    : {
    sides : '.sides',
    side  : '.side'
  }

};


})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Sidebar
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.sidebar = function(parameters) {
  var
    $allModules     = $(this),
    $window         = $(window),
    $document       = $(document),
    $html           = $('html'),
    $head           = $('head'),

    moduleSelector  = $allModules.selector || '',

    time            = new Date().getTime(),
    performance     = [],

    query           = arguments[0],
    methodInvoked   = (typeof query == 'string'),
    queryArguments  = [].slice.call(arguments, 1),

    requestAnimationFrame = window.requestAnimationFrame
      || window.mozRequestAnimationFrame
      || window.webkitRequestAnimationFrame
      || window.msRequestAnimationFrame
      || function(callback) { setTimeout(callback, 0); },

    returnedValue
  ;

  $allModules
    .each(function() {
      var
        settings        = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.sidebar.settings, parameters)
          : $.extend({}, $.fn.sidebar.settings),

        selector        = settings.selector,
        className       = settings.className,
        namespace       = settings.namespace,
        regExp          = settings.regExp,
        error           = settings.error,

        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,

        $module         = $(this),
        $context        = $(settings.context),

        $sidebars       = $module.children(selector.sidebar),
        $fixed          = $context.children(selector.fixed),
        $pusher         = $context.children(selector.pusher),
        $style,

        element         = this,
        instance        = $module.data(moduleNamespace),

        elementNamespace,
        id,
        currentScroll,
        transitionEvent,

        module
      ;

      module      = {

        initialize: function() {
          module.debug('Initializing sidebar', parameters);

          module.create.id();

          transitionEvent = module.get.transitionEvent();

          // avoids locking rendering if initialized in onReady
          if(settings.delaySetup) {
            requestAnimationFrame(module.setup.layout);
          }
          else {
            module.setup.layout();
          }

          requestAnimationFrame(function() {
            module.setup.cache();
          });

          module.instantiate();
        },

        instantiate: function() {
          module.verbose('Storing instance of module', module);
          instance = module;
          $module
            .data(moduleNamespace, module)
          ;
        },

        create: {
          id: function() {
            id = (Math.random().toString(16) + '000000000').substr(2,8);
            elementNamespace = '.' + id;
            module.verbose('Creating unique id for element', id);
          }
        },

        destroy: function() {
          module.verbose('Destroying previous module for', $module);
          $module
            .off(eventNamespace)
            .removeData(moduleNamespace)
          ;
          if(module.is.ios()) {
            module.remove.ios();
          }
          // bound by uuid
          $context.off(elementNamespace);
          $window.off(elementNamespace);
          $document.off(elementNamespace);
        },

        event: {
          clickaway: function(event) {
            var
              clickedInPusher = ($pusher.find(event.target).length > 0 || $pusher.is(event.target)),
              clickedContext  = ($context.is(event.target))
            ;
            if(clickedInPusher) {
              module.verbose('User clicked on dimmed page');
              module.hide();
            }
            if(clickedContext) {
              module.verbose('User clicked on dimmable context (scaled out page)');
              module.hide();
            }
          },
          touch: function(event) {
            //event.stopPropagation();
          },
          containScroll: function(event) {
            if(element.scrollTop <= 0)  {
              element.scrollTop = 1;
            }
            if((element.scrollTop + element.offsetHeight) >= element.scrollHeight) {
              element.scrollTop = element.scrollHeight - element.offsetHeight - 1;
            }
          },
          scroll: function(event) {
            if( $(event.target).closest(selector.sidebar).length === 0 ) {
              event.preventDefault();
            }
          }
        },

        bind: {
          clickaway: function() {
            module.verbose('Adding clickaway events to context', $context);
            if(settings.closable) {
              $context
                .on('click'    + elementNamespace, module.event.clickaway)
                .on('touchend' + elementNamespace, module.event.clickaway)
              ;
            }
          },
          scrollLock: function() {
            if(settings.scrollLock) {
              module.debug('Disabling page scroll');
              $window
                .on('DOMMouseScroll' + elementNamespace, module.event.scroll)
              ;
            }
            module.verbose('Adding events to contain sidebar scroll');
            $document
              .on('touchmove' + elementNamespace, module.event.touch)
            ;
            $module
              .on('scroll' + eventNamespace, module.event.containScroll)
            ;
          }
        },
        unbind: {
          clickaway: function() {
            module.verbose('Removing clickaway events from context', $context);
            $context.off(elementNamespace);
          },
          scrollLock: function() {
            module.verbose('Removing scroll lock from page');
            $document.off(elementNamespace);
            $window.off(elementNamespace);
            $module.off('scroll' + eventNamespace);
          }
        },

        add: {
          inlineCSS: function() {
            var
              width     = module.cache.width  || $module.outerWidth(),
              height    = module.cache.height || $module.outerHeight(),
              isRTL     = module.is.rtl(),
              direction = module.get.direction(),
              distance  = {
                left   : width,
                right  : -width,
                top    : height,
                bottom : -height
              },
              style
            ;

            if(isRTL){
              module.verbose('RTL detected, flipping widths');
              distance.left = -width;
              distance.right = width;
            }

            style  = '<style>';

            if(direction === 'left' || direction === 'right') {
              module.debug('Adding CSS rules for animation distance', width);
              style  += ''
                + ' .ui.visible.' + direction + '.sidebar ~ .fixed,'
                + ' .ui.visible.' + direction + '.sidebar ~ .pusher {'
                + '   -webkit-transform: translate3d('+ distance[direction] + 'px, 0, 0);'
                + '           transform: translate3d('+ distance[direction] + 'px, 0, 0);'
                + ' }'
              ;
            }
            else if(direction === 'top' || direction == 'bottom') {
              style  += ''
                + ' .ui.visible.' + direction + '.sidebar ~ .fixed,'
                + ' .ui.visible.' + direction + '.sidebar ~ .pusher {'
                + '   -webkit-transform: translate3d(0, ' + distance[direction] + 'px, 0);'
                + '           transform: translate3d(0, ' + distance[direction] + 'px, 0);'
                + ' }'
              ;
            }

            /* IE is only browser not to create context with transforms */
            /* https://www.w3.org/Bugs/Public/show_bug.cgi?id=16328 */
            if( module.is.ie() ) {
              if(direction === 'left' || direction === 'right') {
                module.debug('Adding CSS rules for animation distance', width);
                style  += ''
                  + ' body.pushable > .ui.visible.' + direction + '.sidebar ~ .pusher:after {'
                  + '   -webkit-transform: translate3d('+ distance[direction] + 'px, 0, 0);'
                  + '           transform: translate3d('+ distance[direction] + 'px, 0, 0);'
                  + ' }'
                ;
              }
              else if(direction === 'top' || direction == 'bottom') {
                style  += ''
                  + ' body.pushable > .ui.visible.' + direction + '.sidebar ~ .pusher:after {'
                  + '   -webkit-transform: translate3d(0, ' + distance[direction] + 'px, 0);'
                  + '           transform: translate3d(0, ' + distance[direction] + 'px, 0);'
                  + ' }'
                ;
              }
              /* opposite sides visible forces content overlay */
              style += ''
                + ' body.pushable > .ui.visible.left.sidebar ~ .ui.visible.right.sidebar ~ .pusher:after,'
                + ' body.pushable > .ui.visible.right.sidebar ~ .ui.visible.left.sidebar ~ .pusher:after {'
                + '   -webkit-transform: translate3d(0px, 0, 0);'
                + '           transform: translate3d(0px, 0, 0);'
                + ' }'
              ;
            }
            style += '</style>';
            $style = $(style)
              .appendTo($head)
            ;
            module.debug('Adding sizing css to head', $style);
          }
        },

        refresh: function() {
          module.verbose('Refreshing selector cache');
          $context  = $(settings.context);
          $sidebars = $context.children(selector.sidebar);
          $pusher   = $context.children(selector.pusher);
          $fixed    = $context.children(selector.fixed);
          module.clear.cache();
        },

        refreshSidebars: function() {
          module.verbose('Refreshing other sidebars');
          $sidebars = $context.children(selector.sidebar);
        },

        repaint: function() {
          module.verbose('Forcing repaint event');
          element.style.display = 'none';
          var ignored = element.offsetHeight;
          element.scrollTop = element.scrollTop;
          element.style.display = '';
        },

        setup: {
          cache: function() {
            module.cache = {
              width  : $module.outerWidth(),
              height : $module.outerHeight(),
              rtl    : ($module.css('direction') == 'rtl')
            };
          },
          layout: function() {
            if( $context.children(selector.pusher).length === 0 ) {
              module.debug('Adding wrapper element for sidebar');
              module.error(error.pusher);
              $pusher = $('<div class="pusher" />');
              $context
                .children()
                  .not(selector.omitted)
                  .not($sidebars)
                  .wrapAll($pusher)
              ;
              module.refresh();
            }
            if($module.nextAll(selector.pusher).length === 0 || $module.nextAll(selector.pusher)[0] !== $pusher[0]) {
              module.debug('Moved sidebar to correct parent element');
              module.error(error.movedSidebar, element);
              $module.detach().prependTo($context);
              module.refresh();
            }
            module.clear.cache();
            module.set.pushable();
            module.set.direction();
          }
        },

        attachEvents: function(selector, event) {
          var
            $toggle = $(selector)
          ;
          event = $.isFunction(module[event])
            ? module[event]
            : module.toggle
          ;
          if($toggle.length > 0) {
            module.debug('Attaching sidebar events to element', selector, event);
            $toggle
              .on('click' + eventNamespace, event)
            ;
          }
          else {
            module.error(error.notFound, selector);
          }
        },

        show: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          if(module.is.hidden()) {
            module.refreshSidebars();
            if(settings.overlay)  {
              module.error(error.overlay);
              settings.transition = 'overlay';
            }
            module.refresh();
            if(module.othersActive()) {
              module.debug('Other sidebars currently visible');
              if(settings.exclusive) {
                // if not overlay queue animation after hide
                if(settings.transition != 'overlay') {
                  module.hideOthers(module.show);
                  return;
                }
                else {
                  module.hideOthers();
                }
              }
              else {
                settings.transition = 'overlay';
              }
            }
            module.pushPage(function() {
              callback.call(element);
              settings.onShow.call(element);
            });
            settings.onChange.call(element);
            settings.onVisible.call(element);
          }
          else {
            module.debug('Sidebar is already visible');
          }
        },

        hide: function(callback) {
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          if(module.is.visible() || module.is.animating()) {
            module.debug('Hiding sidebar', callback);
            module.refreshSidebars();
            module.pullPage(function() {
              callback.call(element);
              settings.onHidden.call(element);
            });
            settings.onChange.call(element);
            settings.onHide.call(element);
          }
        },

        othersAnimating: function() {
          return ($sidebars.not($module).filter('.' + className.animating).length > 0);
        },
        othersVisible: function() {
          return ($sidebars.not($module).filter('.' + className.visible).length > 0);
        },
        othersActive: function() {
          return(module.othersVisible() || module.othersAnimating());
        },

        hideOthers: function(callback) {
          var
            $otherSidebars = $sidebars.not($module).filter('.' + className.visible),
            sidebarCount   = $otherSidebars.length,
            callbackCount  = 0
          ;
          callback = callback || function(){};
          $otherSidebars
            .sidebar('hide', function() {
              callbackCount++;
              if(callbackCount == sidebarCount) {
                callback();
              }
            })
          ;
        },

        toggle: function() {
          module.verbose('Determining toggled direction');
          if(module.is.hidden()) {
            module.show();
          }
          else {
            module.hide();
          }
        },

        pushPage: function(callback) {
          var
            transition = module.get.transition(),
            $transition = (transition === 'overlay' || module.othersActive())
              ? $module
              : $pusher,
            animate,
            dim,
            transitionEnd
          ;
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          if(settings.transition == 'scale down') {
            module.scrollToTop();
          }
          module.set.transition(transition);
          module.repaint();
          animate = function() {
            module.bind.clickaway();
            module.add.inlineCSS();
            module.set.animating();
            module.set.visible();
          };
          dim = function() {
            module.set.dimmed();
          };
          transitionEnd = function(event) {
            if( event.target == $transition[0] ) {
              $transition.off(transitionEvent + elementNamespace, transitionEnd);
              module.remove.animating();
              module.bind.scrollLock();
              callback.call(element);
            }
          };
          $transition.off(transitionEvent + elementNamespace);
          $transition.on(transitionEvent + elementNamespace, transitionEnd);
          requestAnimationFrame(animate);
          if(settings.dimPage && !module.othersVisible()) {
            requestAnimationFrame(dim);
          }
        },

        pullPage: function(callback) {
          var
            transition = module.get.transition(),
            $transition = (transition == 'overlay' || module.othersActive())
              ? $module
              : $pusher,
            animate,
            transitionEnd
          ;
          callback = $.isFunction(callback)
            ? callback
            : function(){}
          ;
          module.verbose('Removing context push state', module.get.direction());

          module.unbind.clickaway();
          module.unbind.scrollLock();

          animate = function() {
            module.set.transition(transition);
            module.set.animating();
            module.remove.visible();
            if(settings.dimPage && !module.othersVisible()) {
              $pusher.removeClass(className.dimmed);
            }
          };
          transitionEnd = function(event) {
            if( event.target == $transition[0] ) {
              $transition.off(transitionEvent + elementNamespace, transitionEnd);
              module.remove.animating();
              module.remove.transition();
              module.remove.inlineCSS();
              if(transition == 'scale down' || (settings.returnScroll && module.is.mobile()) ) {
                module.scrollBack();
              }
              callback.call(element);
            }
          };
          $transition.off(transitionEvent + elementNamespace);
          $transition.on(transitionEvent + elementNamespace, transitionEnd);
          requestAnimationFrame(animate);
        },

        scrollToTop: function() {
          module.verbose('Scrolling to top of page to avoid animation issues');
          currentScroll = $(window).scrollTop();
          $module.scrollTop(0);
          window.scrollTo(0, 0);
        },

        scrollBack: function() {
          module.verbose('Scrolling back to original page position');
          window.scrollTo(0, currentScroll);
        },

        clear: {
          cache: function() {
            module.verbose('Clearing cached dimensions');
            module.cache = {};
          }
        },

        set: {

          // ios only (scroll on html not document). This prevent auto-resize canvas/scroll in ios
          // (This is no longer necessary in latest iOS)
          ios: function() {
            $html.addClass(className.ios);
          },

          // container
          pushed: function() {
            $context.addClass(className.pushed);
          },
          pushable: function() {
            $context.addClass(className.pushable);
          },

          // pusher
          dimmed: function() {
            $pusher.addClass(className.dimmed);
          },

          // sidebar
          active: function() {
            $module.addClass(className.active);
          },
          animating: function() {
            $module.addClass(className.animating);
          },
          transition: function(transition) {
            transition = transition || module.get.transition();
            $module.addClass(transition);
          },
          direction: function(direction) {
            direction = direction || module.get.direction();
            $module.addClass(className[direction]);
          },
          visible: function() {
            $module.addClass(className.visible);
          },
          overlay: function() {
            $module.addClass(className.overlay);
          }
        },
        remove: {

          inlineCSS: function() {
            module.debug('Removing inline css styles', $style);
            if($style && $style.length > 0) {
              $style.remove();
            }
          },

          // ios scroll on html not document
          ios: function() {
            $html.removeClass(className.ios);
          },

          // context
          pushed: function() {
            $context.removeClass(className.pushed);
          },
          pushable: function() {
            $context.removeClass(className.pushable);
          },

          // sidebar
          active: function() {
            $module.removeClass(className.active);
          },
          animating: function() {
            $module.removeClass(className.animating);
          },
          transition: function(transition) {
            transition = transition || module.get.transition();
            $module.removeClass(transition);
          },
          direction: function(direction) {
            direction = direction || module.get.direction();
            $module.removeClass(className[direction]);
          },
          visible: function() {
            $module.removeClass(className.visible);
          },
          overlay: function() {
            $module.removeClass(className.overlay);
          }
        },

        get: {
          direction: function() {
            if($module.hasClass(className.top)) {
              return className.top;
            }
            else if($module.hasClass(className.right)) {
              return className.right;
            }
            else if($module.hasClass(className.bottom)) {
              return className.bottom;
            }
            return className.left;
          },
          transition: function() {
            var
              direction = module.get.direction(),
              transition
            ;
            transition = ( module.is.mobile() )
              ? (settings.mobileTransition == 'auto')
                ? settings.defaultTransition.mobile[direction]
                : settings.mobileTransition
              : (settings.transition == 'auto')
                ? settings.defaultTransition.computer[direction]
                : settings.transition
            ;
            module.verbose('Determined transition', transition);
            return transition;
          },
          transitionEvent: function() {
            var
              element     = document.createElement('element'),
              transitions = {
                'transition'       :'transitionend',
                'OTransition'      :'oTransitionEnd',
                'MozTransition'    :'transitionend',
                'WebkitTransition' :'webkitTransitionEnd'
              },
              transition
            ;
            for(transition in transitions){
              if( element.style[transition] !== undefined ){
                return transitions[transition];
              }
            }
          }
        },

        is: {

          ie: function() {
            var
              isIE11 = (!(window.ActiveXObject) && 'ActiveXObject' in window),
              isIE   = ('ActiveXObject' in window)
            ;
            return (isIE11 || isIE);
          },

          ios: function() {
            var
              userAgent      = navigator.userAgent,
              isIOS          = userAgent.match(regExp.ios),
              isMobileChrome = userAgent.match(regExp.mobileChrome)
            ;
            if(isIOS && !isMobileChrome) {
              module.verbose('Browser was found to be iOS', userAgent);
              return true;
            }
            else {
              return false;
            }
          },
          mobile: function() {
            var
              userAgent    = navigator.userAgent,
              isMobile     = userAgent.match(regExp.mobile)
            ;
            if(isMobile) {
              module.verbose('Browser was found to be mobile', userAgent);
              return true;
            }
            else {
              module.verbose('Browser is not mobile, using regular transition', userAgent);
              return false;
            }
          },
          hidden: function() {
            return !module.is.visible();
          },
          visible: function() {
            return $module.hasClass(className.visible);
          },
          // alias
          open: function() {
            return module.is.visible();
          },
          closed: function() {
            return module.is.hidden();
          },
          vertical: function() {
            return $module.hasClass(className.top);
          },
          animating: function() {
            return $context.hasClass(className.animating);
          },
          rtl: function () {
            if(module.cache.rtl === undefined) {
              module.cache.rtl = ($module.css('direction') == 'rtl');
            }
            return module.cache.rtl;
          }
        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                module.error(error.method, query);
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      }
    ;

    if(methodInvoked) {
      if(instance === undefined) {
        module.initialize();
      }
      module.invoke(query);
    }
    else {
      if(instance !== undefined) {
        module.invoke('destroy');
      }
      module.initialize();
    }
  });

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.sidebar.settings = {

  name              : 'Sidebar',
  namespace         : 'sidebar',

  silent            : false,
  debug             : false,
  verbose           : false,
  performance       : true,

  transition        : 'auto',
  mobileTransition  : 'auto',

  defaultTransition : {
    computer: {
      left   : 'uncover',
      right  : 'uncover',
      top    : 'overlay',
      bottom : 'overlay'
    },
    mobile: {
      left   : 'uncover',
      right  : 'uncover',
      top    : 'overlay',
      bottom : 'overlay'
    }
  },

  context           : 'body',
  exclusive         : false,
  closable          : true,
  dimPage           : true,
  scrollLock        : false,
  returnScroll      : false,
  delaySetup        : false,

  duration          : 500,

  onChange          : function(){},
  onShow            : function(){},
  onHide            : function(){},

  onHidden          : function(){},
  onVisible         : function(){},

  className         : {
    active    : 'active',
    animating : 'animating',
    dimmed    : 'dimmed',
    ios       : 'ios',
    pushable  : 'pushable',
    pushed    : 'pushed',
    right     : 'right',
    top       : 'top',
    left      : 'left',
    bottom    : 'bottom',
    visible   : 'visible'
  },

  selector: {
    fixed   : '.fixed',
    omitted : 'script, link, style, .ui.modal, .ui.dimmer, .ui.nag, .ui.fixed',
    pusher  : '.pusher',
    sidebar : '.ui.sidebar'
  },

  regExp: {
    ios          : /(iPad|iPhone|iPod)/g,
    mobileChrome : /(CriOS)/g,
    mobile       : /Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|web)OS|Fennec|Minimo|Opera M(obi|ini)|Blazer|Dolfin|Dolphin|Skyfire|Zune/g
  },

  error   : {
    method       : 'The method you called is not defined.',
    pusher       : 'Had to add pusher element. For optimal performance make sure body content is inside a pusher element',
    movedSidebar : 'Had to move sidebar. For optimal performance make sure sidebar and pusher are direct children of your body tag',
    overlay      : 'The overlay setting is no longer supported, use animation: overlay',
    notFound     : 'There were no elements that matched the specified selector'
  }

};


})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Sticky
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.sticky = function(parameters) {
  var
    $allModules    = $(this),
    moduleSelector = $allModules.selector || '',

    time           = new Date().getTime(),
    performance    = [],

    query          = arguments[0],
    methodInvoked  = (typeof query == 'string'),
    queryArguments = [].slice.call(arguments, 1),
    returnedValue
  ;

  $allModules
    .each(function() {
      var
        settings              = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.sticky.settings, parameters)
          : $.extend({}, $.fn.sticky.settings),

        className             = settings.className,
        namespace             = settings.namespace,
        error                 = settings.error,

        eventNamespace        = '.' + namespace,
        moduleNamespace       = 'module-' + namespace,

        $module               = $(this),
        $window               = $(window),
        $scroll               = $(settings.scrollContext),
        $container,
        $context,

        selector              = $module.selector || '',
        instance              = $module.data(moduleNamespace),

        requestAnimationFrame = window.requestAnimationFrame
          || window.mozRequestAnimationFrame
          || window.webkitRequestAnimationFrame
          || window.msRequestAnimationFrame
          || function(callback) { setTimeout(callback, 0); },

        element         = this,

        documentObserver,
        observer,
        module
      ;

      module      = {

        initialize: function() {

          module.determineContainer();
          module.determineContext();
          module.verbose('Initializing sticky', settings, $container);

          module.save.positions();
          module.checkErrors();
          module.bind.events();

          if(settings.observeChanges) {
            module.observeChanges();
          }
          module.instantiate();
        },

        instantiate: function() {
          module.verbose('Storing instance of module', module);
          instance = module;
          $module
            .data(moduleNamespace, module)
          ;
        },

        destroy: function() {
          module.verbose('Destroying previous instance');
          module.reset();
          if(documentObserver) {
            documentObserver.disconnect();
          }
          if(observer) {
            observer.disconnect();
          }
          $window
            .off('load' + eventNamespace, module.event.load)
            .off('resize' + eventNamespace, module.event.resize)
          ;
          $scroll
            .off('scrollchange' + eventNamespace, module.event.scrollchange)
          ;
          $module.removeData(moduleNamespace);
        },

        observeChanges: function() {
          if('MutationObserver' in window) {
            documentObserver = new MutationObserver(module.event.documentChanged);
            observer         = new MutationObserver(module.event.changed);
            documentObserver.observe(document, {
              childList : true,
              subtree   : true
            });
            observer.observe(element, {
              childList : true,
              subtree   : true
            });
            observer.observe($context[0], {
              childList : true,
              subtree   : true
            });
            module.debug('Setting up mutation observer', observer);
          }
        },

        determineContainer: function() {
          if(settings.container) {
            $container = $(settings.container);
          }
          else {
            $container = $module.offsetParent();
          }
        },

        determineContext: function() {
          if(settings.context) {
            $context = $(settings.context);
          }
          else {
            $context = $container;
          }
          if($context.length === 0) {
            module.error(error.invalidContext, settings.context, $module);
            return;
          }
        },

        checkErrors: function() {
          if( module.is.hidden() ) {
            module.error(error.visible, $module);
          }
          if(module.cache.element.height > module.cache.context.height) {
            module.reset();
            module.error(error.elementSize, $module);
            return;
          }
        },

        bind: {
          events: function() {
            $window
              .on('load' + eventNamespace, module.event.load)
              .on('resize' + eventNamespace, module.event.resize)
            ;
            // pub/sub pattern
            $scroll
              .off('scroll' + eventNamespace)
              .on('scroll' + eventNamespace, module.event.scroll)
              .on('scrollchange' + eventNamespace, module.event.scrollchange)
            ;
          }
        },

        event: {
          changed: function(mutations) {
            clearTimeout(module.timer);
            module.timer = setTimeout(function() {
              module.verbose('DOM tree modified, updating sticky menu', mutations);
              module.refresh();
            }, 100);
          },
          documentChanged: function(mutations) {
            [].forEach.call(mutations, function(mutation) {
              if(mutation.removedNodes) {
                [].forEach.call(mutation.removedNodes, function(node) {
                  if(node == element || $(node).find(element).length > 0) {
                    module.debug('Element removed from DOM, tearing down events');
                    module.destroy();
                  }
                });
              }
            });
          },
          load: function() {
            module.verbose('Page contents finished loading');
            requestAnimationFrame(module.refresh);
          },
          resize: function() {
            module.verbose('Window resized');
            requestAnimationFrame(module.refresh);
          },
          scroll: function() {
            requestAnimationFrame(function() {
              $scroll.triggerHandler('scrollchange' + eventNamespace, $scroll.scrollTop() );
            });
          },
          scrollchange: function(event, scrollPosition) {
            module.stick(scrollPosition);
            settings.onScroll.call(element);
          }
        },

        refresh: function(hardRefresh) {
          module.reset();
          if(!settings.context) {
            module.determineContext();
          }
          if(hardRefresh) {
            module.determineContainer();
          }
          module.save.positions();
          module.stick();
          settings.onReposition.call(element);
        },

        supports: {
          sticky: function() {
            var
              $element = $('<div/>'),
              element = $element[0]
            ;
            $element.addClass(className.supported);
            return($element.css('position').match('sticky'));
          }
        },

        save: {
          lastScroll: function(scroll) {
            module.lastScroll = scroll;
          },
          elementScroll: function(scroll) {
            module.elementScroll = scroll;
          },
          positions: function() {
            var
              scrollContext = {
                height : $scroll.height()
              },
              element = {
                margin: {
                  top    : parseInt($module.css('margin-top'), 10),
                  bottom : parseInt($module.css('margin-bottom'), 10),
                },
                offset : $module.offset(),
                width  : $module.outerWidth(),
                height : $module.outerHeight()
              },
              context = {
                offset : $context.offset(),
                height : $context.outerHeight()
              },
              container = {
                height: $container.outerHeight()
              }
            ;
            if( !module.is.standardScroll() ) {
              module.debug('Non-standard scroll. Removing scroll offset from element offset');

              scrollContext.top  = $scroll.scrollTop();
              scrollContext.left = $scroll.scrollLeft();

              element.offset.top  += scrollContext.top;
              context.offset.top  += scrollContext.top;
              element.offset.left += scrollContext.left;
              context.offset.left += scrollContext.left;
            }
            module.cache = {
              fits          : ( (element.height + settings.offset) <= scrollContext.height),
              sameHeight    : (element.height == context.height),
              scrollContext : {
                height : scrollContext.height
              },
              element: {
                margin : element.margin,
                top    : element.offset.top - element.margin.top,
                left   : element.offset.left,
                width  : element.width,
                height : element.height,
                bottom : element.offset.top + element.height
              },
              context: {
                top           : context.offset.top,
                height        : context.height,
                bottom        : context.offset.top + context.height
              }
            };
            module.set.containerSize();

            module.stick();
            module.debug('Caching element positions', module.cache);
          }
        },

        get: {
          direction: function(scroll) {
            var
              direction = 'down'
            ;
            scroll = scroll || $scroll.scrollTop();
            if(module.lastScroll !== undefined) {
              if(module.lastScroll < scroll) {
                direction = 'down';
              }
              else if(module.lastScroll > scroll) {
                direction = 'up';
              }
            }
            return direction;
          },
          scrollChange: function(scroll) {
            scroll = scroll || $scroll.scrollTop();
            return (module.lastScroll)
              ? (scroll - module.lastScroll)
              : 0
            ;
          },
          currentElementScroll: function() {
            if(module.elementScroll) {
              return module.elementScroll;
            }
            return ( module.is.top() )
              ? Math.abs(parseInt($module.css('top'), 10))    || 0
              : Math.abs(parseInt($module.css('bottom'), 10)) || 0
            ;
          },

          elementScroll: function(scroll) {
            scroll = scroll || $scroll.scrollTop();
            var
              element        = module.cache.element,
              scrollContext  = module.cache.scrollContext,
              delta          = module.get.scrollChange(scroll),
              maxScroll      = (element.height - scrollContext.height + settings.offset),
              elementScroll  = module.get.currentElementScroll(),
              possibleScroll = (elementScroll + delta)
            ;
            if(module.cache.fits || possibleScroll < 0) {
              elementScroll = 0;
            }
            else if(possibleScroll > maxScroll ) {
              elementScroll = maxScroll;
            }
            else {
              elementScroll = possibleScroll;
            }
            return elementScroll;
          }
        },

        remove: {
          lastScroll: function() {
            delete module.lastScroll;
          },
          elementScroll: function(scroll) {
            delete module.elementScroll;
          },
          minimumSize: function() {
            $container
              .css('min-height', '')
            ;
          },
          offset: function() {
            $module.css('margin-top', '');
          }
        },

        set: {
          offset: function() {
            module.verbose('Setting offset on element', settings.offset);
            $module
              .css('margin-top', settings.offset)
            ;
          },
          containerSize: function() {
            var
              tagName = $container.get(0).tagName
            ;
            if(tagName === 'HTML' || tagName == 'body') {
              // this can trigger for too many reasons
              //module.error(error.container, tagName, $module);
              module.determineContainer();
            }
            else {
              if( Math.abs($container.outerHeight() - module.cache.context.height) > settings.jitter) {
                module.debug('Context has padding, specifying exact height for container', module.cache.context.height);
                $container.css({
                  height: module.cache.context.height
                });
              }
            }
          },
          minimumSize: function() {
            var
              element   = module.cache.element
            ;
            $container
              .css('min-height', element.height)
            ;
          },
          scroll: function(scroll) {
            module.debug('Setting scroll on element', scroll);
            if(module.elementScroll == scroll) {
              return;
            }
            if( module.is.top() ) {
              $module
                .css('bottom', '')
                .css('top', -scroll)
              ;
            }
            if( module.is.bottom() ) {
              $module
                .css('top', '')
                .css('bottom', scroll)
              ;
            }
          },
          size: function() {
            if(module.cache.element.height !== 0 && module.cache.element.width !== 0) {
              element.style.setProperty('width',  module.cache.element.width  + 'px', 'important');
              element.style.setProperty('height', module.cache.element.height + 'px', 'important');
            }
          }
        },

        is: {
          standardScroll: function() {
            return ($scroll[0] == window);
          },
          top: function() {
            return $module.hasClass(className.top);
          },
          bottom: function() {
            return $module.hasClass(className.bottom);
          },
          initialPosition: function() {
            return (!module.is.fixed() && !module.is.bound());
          },
          hidden: function() {
            return (!$module.is(':visible'));
          },
          bound: function() {
            return $module.hasClass(className.bound);
          },
          fixed: function() {
            return $module.hasClass(className.fixed);
          }
        },

        stick: function(scroll) {
          var
            cachedPosition = scroll || $scroll.scrollTop(),
            cache          = module.cache,
            fits           = cache.fits,
            sameHeight     = cache.sameHeight,
            element        = cache.element,
            scrollContext  = cache.scrollContext,
            context        = cache.context,
            offset         = (module.is.bottom() && settings.pushing)
              ? settings.bottomOffset
              : settings.offset,
            scroll         = {
              top    : cachedPosition + offset,
              bottom : cachedPosition + offset + scrollContext.height
            },
            direction      = module.get.direction(scroll.top),
            elementScroll  = (fits)
              ? 0
              : module.get.elementScroll(scroll.top),

            // shorthand
            doesntFit      = !fits,
            elementVisible = (element.height !== 0)
          ;
          if(elementVisible && !sameHeight) {

            if( module.is.initialPosition() ) {
              if(scroll.top >= context.bottom) {
                module.debug('Initial element position is bottom of container');
                module.bindBottom();
              }
              else if(scroll.top > element.top) {
                if( (element.height + scroll.top - elementScroll) >= context.bottom ) {
                  module.debug('Initial element position is bottom of container');
                  module.bindBottom();
                }
                else {
                  module.debug('Initial element position is fixed');
                  module.fixTop();
                }
              }

            }
            else if( module.is.fixed() ) {

              // currently fixed top
              if( module.is.top() ) {
                if( scroll.top <= element.top ) {
                  module.debug('Fixed element reached top of container');
                  module.setInitialPosition();
                }
                else if( (element.height + scroll.top - elementScroll) >= context.bottom ) {
                  module.debug('Fixed element reached bottom of container');
                  module.bindBottom();
                }
                // scroll element if larger than screen
                else if(doesntFit) {
                  module.set.scroll(elementScroll);
                  module.save.lastScroll(scroll.top);
                  module.save.elementScroll(elementScroll);
                }
              }

              // currently fixed bottom
              else if(module.is.bottom() ) {

                // top edge
                if( (scroll.bottom - element.height) <= element.top) {
                  module.debug('Bottom fixed rail has reached top of container');
                  module.setInitialPosition();
                }
                // bottom edge
                else if(scroll.bottom >= context.bottom) {
                  module.debug('Bottom fixed rail has reached bottom of container');
                  module.bindBottom();
                }
                // scroll element if larger than screen
                else if(doesntFit) {
                  module.set.scroll(elementScroll);
                  module.save.lastScroll(scroll.top);
                  module.save.elementScroll(elementScroll);
                }

              }
            }
            else if( module.is.bottom() ) {
              if( scroll.top <= element.top ) {
                module.debug('Jumped from bottom fixed to top fixed, most likely used home/end button');
                module.setInitialPosition();
              }
              else {
                if(settings.pushing) {
                  if(module.is.bound() && scroll.bottom <= context.bottom ) {
                    module.debug('Fixing bottom attached element to bottom of browser.');
                    module.fixBottom();
                  }
                }
                else {
                  if(module.is.bound() && (scroll.top <= context.bottom - element.height) ) {
                    module.debug('Fixing bottom attached element to top of browser.');
                    module.fixTop();
                  }
                }
              }
            }
          }
        },

        bindTop: function() {
          module.debug('Binding element to top of parent container');
          module.remove.offset();
          $module
            .css({
              left         : '',
              top          : '',
              marginBottom : ''
            })
            .removeClass(className.fixed)
            .removeClass(className.bottom)
            .addClass(className.bound)
            .addClass(className.top)
          ;
          settings.onTop.call(element);
          settings.onUnstick.call(element);
        },
        bindBottom: function() {
          module.debug('Binding element to bottom of parent container');
          module.remove.offset();
          $module
            .css({
              left         : '',
              top          : ''
            })
            .removeClass(className.fixed)
            .removeClass(className.top)
            .addClass(className.bound)
            .addClass(className.bottom)
          ;
          settings.onBottom.call(element);
          settings.onUnstick.call(element);
        },

        setInitialPosition: function() {
          module.debug('Returning to initial position');
          module.unfix();
          module.unbind();
        },


        fixTop: function() {
          module.debug('Fixing element to top of page');
          if(settings.setSize) {
            module.set.size();
          }
          module.set.minimumSize();
          module.set.offset();
          $module
            .css({
              left         : module.cache.element.left,
              bottom       : '',
              marginBottom : ''
            })
            .removeClass(className.bound)
            .removeClass(className.bottom)
            .addClass(className.fixed)
            .addClass(className.top)
          ;
          settings.onStick.call(element);
        },

        fixBottom: function() {
          module.debug('Sticking element to bottom of page');
          if(settings.setSize) {
            module.set.size();
          }
          module.set.minimumSize();
          module.set.offset();
          $module
            .css({
              left         : module.cache.element.left,
              bottom       : '',
              marginBottom : ''
            })
            .removeClass(className.bound)
            .removeClass(className.top)
            .addClass(className.fixed)
            .addClass(className.bottom)
          ;
          settings.onStick.call(element);
        },

        unbind: function() {
          if( module.is.bound() ) {
            module.debug('Removing container bound position on element');
            module.remove.offset();
            $module
              .removeClass(className.bound)
              .removeClass(className.top)
              .removeClass(className.bottom)
            ;
          }
        },

        unfix: function() {
          if( module.is.fixed() ) {
            module.debug('Removing fixed position on element');
            module.remove.minimumSize();
            module.remove.offset();
            $module
              .removeClass(className.fixed)
              .removeClass(className.top)
              .removeClass(className.bottom)
            ;
            settings.onUnstick.call(element);
          }
        },

        reset: function() {
          module.debug('Resetting elements position');
          module.unbind();
          module.unfix();
          module.resetCSS();
          module.remove.offset();
          module.remove.lastScroll();
        },

        resetCSS: function() {
          $module
            .css({
              width  : '',
              height : ''
            })
          ;
          $container
            .css({
              height: ''
            })
          ;
        },

        setting: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            settings[name] = value;
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 0);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.sticky.settings = {

  name           : 'Sticky',
  namespace      : 'sticky',

  silent         : false,
  debug          : false,
  verbose        : true,
  performance    : true,

  // whether to stick in the opposite direction on scroll up
  pushing        : false,

  context        : false,
  container      : false,

  // Context to watch scroll events
  scrollContext  : window,

  // Offset to adjust scroll
  offset         : 0,

  // Offset to adjust scroll when attached to bottom of screen
  bottomOffset   : 0,

  // will only set container height if difference between context and container is larger than this number
  jitter         : 5,

  // set width of sticky element when it is fixed to page (used to make sure 100% width is maintained if no fixed size set)
  setSize        : true,

  // Whether to automatically observe changes with Mutation Observers
  observeChanges : false,

  // Called when position is recalculated
  onReposition   : function(){},

  // Called on each scroll
  onScroll       : function(){},

  // Called when element is stuck to viewport
  onStick        : function(){},

  // Called when element is unstuck from viewport
  onUnstick      : function(){},

  // Called when element reaches top of context
  onTop          : function(){},

  // Called when element reaches bottom of context
  onBottom       : function(){},

  error         : {
    container      : 'Sticky element must be inside a relative container',
    visible        : 'Element is hidden, you must call refresh after element becomes visible. Use silent setting to surpress this warning in production.',
    method         : 'The method you called is not defined.',
    invalidContext : 'Context specified does not exist',
    elementSize    : 'Sticky element is larger than its container, cannot create sticky.'
  },

  className : {
    bound     : 'bound',
    fixed     : 'fixed',
    supported : 'native',
    top       : 'top',
    bottom    : 'bottom'
  }

};

})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Tab
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.tab = function(parameters) {

  var
    // use window context if none specified
    $allModules     = $.isFunction(this)
        ? $(window)
        : $(this),

    moduleSelector  = $allModules.selector || '',
    time            = new Date().getTime(),
    performance     = [],

    query           = arguments[0],
    methodInvoked   = (typeof query == 'string'),
    queryArguments  = [].slice.call(arguments, 1),

    initializedHistory = false,
    returnedValue
  ;

  $allModules
    .each(function() {
      var

        settings        = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.tab.settings, parameters)
          : $.extend({}, $.fn.tab.settings),

        className       = settings.className,
        metadata        = settings.metadata,
        selector        = settings.selector,
        error           = settings.error,

        eventNamespace  = '.' + settings.namespace,
        moduleNamespace = 'module-' + settings.namespace,

        $module         = $(this),
        $context,
        $tabs,

        cache           = {},
        firstLoad       = true,
        recursionDepth  = 0,
        element         = this,
        instance        = $module.data(moduleNamespace),

        activeTabPath,
        parameterArray,
        module,

        historyEvent

      ;

      module = {

        initialize: function() {
          module.debug('Initializing tab menu item', $module);
          module.fix.callbacks();
          module.determineTabs();

          module.debug('Determining tabs', settings.context, $tabs);
          // set up automatic routing
          if(settings.auto) {
            module.set.auto();
          }
          module.bind.events();

          if(settings.history && !initializedHistory) {
            module.initializeHistory();
            initializedHistory = true;
          }

          module.instantiate();
        },

        instantiate: function () {
          module.verbose('Storing instance of module', module);
          instance = module;
          $module
            .data(moduleNamespace, module)
          ;
        },

        destroy: function() {
          module.debug('Destroying tabs', $module);
          $module
            .removeData(moduleNamespace)
            .off(eventNamespace)
          ;
        },

        bind: {
          events: function() {
            // if using $.tab don't add events
            if( !$.isWindow( element ) ) {
              module.debug('Attaching tab activation events to element', $module);
              $module
                .on('click' + eventNamespace, module.event.click)
              ;
            }
          }
        },

        determineTabs: function() {
          var
            $reference
          ;

          // determine tab context
          if(settings.context === 'parent') {
            if($module.closest(selector.ui).length > 0) {
              $reference = $module.closest(selector.ui);
              module.verbose('Using closest UI element as parent', $reference);
            }
            else {
              $reference = $module;
            }
            $context = $reference.parent();
            module.verbose('Determined parent element for creating context', $context);
          }
          else if(settings.context) {
            $context = $(settings.context);
            module.verbose('Using selector for tab context', settings.context, $context);
          }
          else {
            $context = $('body');
          }
          // find tabs
          if(settings.childrenOnly) {
            $tabs = $context.children(selector.tabs);
            module.debug('Searching tab context children for tabs', $context, $tabs);
          }
          else {
            $tabs = $context.find(selector.tabs);
            module.debug('Searching tab context for tabs', $context, $tabs);
          }
        },

        fix: {
          callbacks: function() {
            if( $.isPlainObject(parameters) && (parameters.onTabLoad || parameters.onTabInit) ) {
              if(parameters.onTabLoad) {
                parameters.onLoad = parameters.onTabLoad;
                delete parameters.onTabLoad;
                module.error(error.legacyLoad, parameters.onLoad);
              }
              if(parameters.onTabInit) {
                parameters.onFirstLoad = parameters.onTabInit;
                delete parameters.onTabInit;
                module.error(error.legacyInit, parameters.onFirstLoad);
              }
              settings = $.extend(true, {}, $.fn.tab.settings, parameters);
            }
          }
        },

        initializeHistory: function() {
          module.debug('Initializing page state');
          if( $.address === undefined ) {
            module.error(error.state);
            return false;
          }
          else {
            if(settings.historyType == 'state') {
              module.debug('Using HTML5 to manage state');
              if(settings.path !== false) {
                $.address
                  .history(true)
                  .state(settings.path)
                ;
              }
              else {
                module.error(error.path);
                return false;
              }
            }
            $.address
              .bind('change', module.event.history.change)
            ;
          }
        },

        event: {
          click: function(event) {
            var
              tabPath = $(this).data(metadata.tab)
            ;
            if(tabPath !== undefined) {
              if(settings.history) {
                module.verbose('Updating page state', event);
                $.address.value(tabPath);
              }
              else {
                module.verbose('Changing tab', event);
                module.changeTab(tabPath);
              }
              event.preventDefault();
            }
            else {
              module.debug('No tab specified');
            }
          },
          history: {
            change: function(event) {
              var
                tabPath   = event.pathNames.join('/') || module.get.initialPath(),
                pageTitle = settings.templates.determineTitle(tabPath) || false
              ;
              module.performance.display();
              module.debug('History change event', tabPath, event);
              historyEvent = event;
              if(tabPath !== undefined) {
                module.changeTab(tabPath);
              }
              if(pageTitle) {
                $.address.title(pageTitle);
              }
            }
          }
        },

        refresh: function() {
          if(activeTabPath) {
            module.debug('Refreshing tab', activeTabPath);
            module.changeTab(activeTabPath);
          }
        },

        cache: {

          read: function(cacheKey) {
            return (cacheKey !== undefined)
              ? cache[cacheKey]
              : false
            ;
          },
          add: function(cacheKey, content) {
            cacheKey = cacheKey || activeTabPath;
            module.debug('Adding cached content for', cacheKey);
            cache[cacheKey] = content;
          },
          remove: function(cacheKey) {
            cacheKey = cacheKey || activeTabPath;
            module.debug('Removing cached content for', cacheKey);
            delete cache[cacheKey];
          }
        },

        set: {
          auto: function() {
            var
              url = (typeof settings.path == 'string')
                ? settings.path.replace(/\/$/, '') + '/{$tab}'
                : '/{$tab}'
            ;
            module.verbose('Setting up automatic tab retrieval from server', url);
            if($.isPlainObject(settings.apiSettings)) {
              settings.apiSettings.url = url;
            }
            else {
              settings.apiSettings = {
                url: url
              };
            }
          },
          loading: function(tabPath) {
            var
              $tab      = module.get.tabElement(tabPath),
              isLoading = $tab.hasClass(className.loading)
            ;
            if(!isLoading) {
              module.verbose('Setting loading state for', $tab);
              $tab
                .addClass(className.loading)
                .siblings($tabs)
                  .removeClass(className.active + ' ' + className.loading)
              ;
              if($tab.length > 0) {
                settings.onRequest.call($tab[0], tabPath);
              }
            }
          },
          state: function(state) {
            $.address.value(state);
          }
        },

        changeTab: function(tabPath) {
          var
            pushStateAvailable = (window.history && window.history.pushState),
            shouldIgnoreLoad   = (pushStateAvailable && settings.ignoreFirstLoad && firstLoad),
            remoteContent      = (settings.auto || $.isPlainObject(settings.apiSettings) ),
            // only add default path if not remote content
            pathArray = (remoteContent && !shouldIgnoreLoad)
              ? module.utilities.pathToArray(tabPath)
              : module.get.defaultPathArray(tabPath)
          ;
          tabPath = module.utilities.arrayToPath(pathArray);
          $.each(pathArray, function(index, tab) {
            var
              currentPathArray   = pathArray.slice(0, index + 1),
              currentPath        = module.utilities.arrayToPath(currentPathArray),

              isTab              = module.is.tab(currentPath),
              isLastIndex        = (index + 1 == pathArray.length),

              $tab               = module.get.tabElement(currentPath),
              $anchor,
              nextPathArray,
              nextPath,
              isLastTab
            ;
            module.verbose('Looking for tab', tab);
            if(isTab) {
              module.verbose('Tab was found', tab);
              // scope up
              activeTabPath  = currentPath;
              parameterArray = module.utilities.filterArray(pathArray, currentPathArray);

              if(isLastIndex) {
                isLastTab = true;
              }
              else {
                nextPathArray = pathArray.slice(0, index + 2);
                nextPath      = module.utilities.arrayToPath(nextPathArray);
                isLastTab     = ( !module.is.tab(nextPath) );
                if(isLastTab) {
                  module.verbose('Tab parameters found', nextPathArray);
                }
              }
              if(isLastTab && remoteContent) {
                if(!shouldIgnoreLoad) {
                  module.activate.navigation(currentPath);
                  module.fetch.content(currentPath, tabPath);
                }
                else {
                  module.debug('Ignoring remote content on first tab load', currentPath);
                  firstLoad = false;
                  module.cache.add(tabPath, $tab.html());
                  module.activate.all(currentPath);
                  settings.onFirstLoad.call($tab[0], currentPath, parameterArray, historyEvent);
                  settings.onLoad.call($tab[0], currentPath, parameterArray, historyEvent);
                }
                return false;
              }
              else {
                module.debug('Opened local tab', currentPath);
                module.activate.all(currentPath);
                if( !module.cache.read(currentPath) ) {
                  module.cache.add(currentPath, true);
                  module.debug('First time tab loaded calling tab init');
                  settings.onFirstLoad.call($tab[0], currentPath, parameterArray, historyEvent);
                }
                settings.onLoad.call($tab[0], currentPath, parameterArray, historyEvent);
              }

            }
            else if(tabPath.search('/') == -1 && tabPath !== '') {
              // look for in page anchor
              $anchor     = $('#' + tabPath + ', a[name="' + tabPath + '"]');
              currentPath = $anchor.closest('[data-tab]').data(metadata.tab);
              $tab        = module.get.tabElement(currentPath);
              // if anchor exists use parent tab
              if($anchor && $anchor.length > 0 && currentPath) {
                module.debug('Anchor link used, opening parent tab', $tab, $anchor);
                if( !$tab.hasClass(className.active) ) {
                  setTimeout(function() {
                    module.scrollTo($anchor);
                  }, 0);
                }
                module.activate.all(currentPath);
                if( !module.cache.read(currentPath) ) {
                  module.cache.add(currentPath, true);
                  module.debug('First time tab loaded calling tab init');
                  settings.onFirstLoad.call($tab[0], currentPath, parameterArray, historyEvent);
                }
                settings.onLoad.call($tab[0], currentPath, parameterArray, historyEvent);
                return false;
              }
            }
            else {
              module.error(error.missingTab, $module, $context, currentPath);
              return false;
            }
          });
        },

        scrollTo: function($element) {
          var
            scrollOffset = ($element && $element.length > 0)
              ? $element.offset().top
              : false
          ;
          if(scrollOffset !== false) {
            module.debug('Forcing scroll to an in-page link in a hidden tab', scrollOffset, $element);
            $(document).scrollTop(scrollOffset);
          }
        },

        update: {
          content: function(tabPath, html, evaluateScripts) {
            var
              $tab = module.get.tabElement(tabPath),
              tab  = $tab[0]
            ;
            evaluateScripts = (evaluateScripts !== undefined)
              ? evaluateScripts
              : settings.evaluateScripts
            ;
            if(typeof settings.cacheType == 'string' && settings.cacheType.toLowerCase() == 'dom' && typeof html !== 'string') {
              $tab
                .empty()
                .append($(html).clone(true))
              ;
            }
            else {
              if(evaluateScripts) {
                module.debug('Updating HTML and evaluating inline scripts', tabPath, html);
                $tab.html(html);
              }
              else {
                module.debug('Updating HTML', tabPath, html);
                tab.innerHTML = html;
              }
            }
          }
        },

        fetch: {

          content: function(tabPath, fullTabPath) {
            var
              $tab        = module.get.tabElement(tabPath),
              apiSettings = {
                dataType         : 'html',
                encodeParameters : false,
                on               : 'now',
                cache            : settings.alwaysRefresh,
                headers          : {
                  'X-Remote': true
                },
                onSuccess : function(response) {
                  if(settings.cacheType == 'response') {
                    module.cache.add(fullTabPath, response);
                  }
                  module.update.content(tabPath, response);
                  if(tabPath == activeTabPath) {
                    module.debug('Content loaded', tabPath);
                    module.activate.tab(tabPath);
                  }
                  else {
                    module.debug('Content loaded in background', tabPath);
                  }
                  settings.onFirstLoad.call($tab[0], tabPath, parameterArray, historyEvent);
                  settings.onLoad.call($tab[0], tabPath, parameterArray, historyEvent);

                  if(settings.loadOnce) {
                    module.cache.add(fullTabPath, true);
                  }
                  else if(typeof settings.cacheType == 'string' && settings.cacheType.toLowerCase() == 'dom' && $tab.children().length > 0) {
                    setTimeout(function() {
                      var
                        $clone = $tab.children().clone(true)
                      ;
                      $clone = $clone.not('script');
                      module.cache.add(fullTabPath, $clone);
                    }, 0);
                  }
                  else {
                    module.cache.add(fullTabPath, $tab.html());
                  }
                },
                urlData: {
                  tab: fullTabPath
                }
              },
              request         = $tab.api('get request') || false,
              existingRequest = ( request && request.state() === 'pending' ),
              requestSettings,
              cachedContent
            ;

            fullTabPath   = fullTabPath || tabPath;
            cachedContent = module.cache.read(fullTabPath);


            if(settings.cache && cachedContent) {
              module.activate.tab(tabPath);
              module.debug('Adding cached content', fullTabPath);
              if(!settings.loadOnce) {
                if(settings.evaluateScripts == 'once') {
                  module.update.content(tabPath, cachedContent, false);
                }
                else {
                  module.update.content(tabPath, cachedContent);
                }
              }
              settings.onLoad.call($tab[0], tabPath, parameterArray, historyEvent);
            }
            else if(existingRequest) {
              module.set.loading(tabPath);
              module.debug('Content is already loading', fullTabPath);
            }
            else if($.api !== undefined) {
              requestSettings = $.extend(true, {}, settings.apiSettings, apiSettings);
              module.debug('Retrieving remote content', fullTabPath, requestSettings);
              module.set.loading(tabPath);
              $tab.api(requestSettings);
            }
            else {
              module.error(error.api);
            }
          }
        },

        activate: {
          all: function(tabPath) {
            module.activate.tab(tabPath);
            module.activate.navigation(tabPath);
          },
          tab: function(tabPath) {
            var
              $tab          = module.get.tabElement(tabPath),
              $deactiveTabs = (settings.deactivate == 'siblings')
                ? $tab.siblings($tabs)
                : $tabs.not($tab),
              isActive      = $tab.hasClass(className.active)
            ;
            module.verbose('Showing tab content for', $tab);
            if(!isActive) {
              $tab
                .addClass(className.active)
              ;
              $deactiveTabs
                .removeClass(className.active + ' ' + className.loading)
              ;
              if($tab.length > 0) {
                settings.onVisible.call($tab[0], tabPath);
              }
            }
          },
          navigation: function(tabPath) {
            var
              $navigation         = module.get.navElement(tabPath),
              $deactiveNavigation = (settings.deactivate == 'siblings')
                ? $navigation.siblings($allModules)
                : $allModules.not($navigation),
              isActive    = $navigation.hasClass(className.active)
            ;
            module.verbose('Activating tab navigation for', $navigation, tabPath);
            if(!isActive) {
              $navigation
                .addClass(className.active)
              ;
              $deactiveNavigation
                .removeClass(className.active + ' ' + className.loading)
              ;
            }
          }
        },

        deactivate: {
          all: function() {
            module.deactivate.navigation();
            module.deactivate.tabs();
          },
          navigation: function() {
            $allModules
              .removeClass(className.active)
            ;
          },
          tabs: function() {
            $tabs
              .removeClass(className.active + ' ' + className.loading)
            ;
          }
        },

        is: {
          tab: function(tabName) {
            return (tabName !== undefined)
              ? ( module.get.tabElement(tabName).length > 0 )
              : false
            ;
          }
        },

        get: {
          initialPath: function() {
            return $allModules.eq(0).data(metadata.tab) || $tabs.eq(0).data(metadata.tab);
          },
          path: function() {
            return $.address.value();
          },
          // adds default tabs to tab path
          defaultPathArray: function(tabPath) {
            return module.utilities.pathToArray( module.get.defaultPath(tabPath) );
          },
          defaultPath: function(tabPath) {
            var
              $defaultNav = $allModules.filter('[data-' + metadata.tab + '^="' + tabPath + '/"]').eq(0),
              defaultTab  = $defaultNav.data(metadata.tab) || false
            ;
            if( defaultTab ) {
              module.debug('Found default tab', defaultTab);
              if(recursionDepth < settings.maxDepth) {
                recursionDepth++;
                return module.get.defaultPath(defaultTab);
              }
              module.error(error.recursion);
            }
            else {
              module.debug('No default tabs found for', tabPath, $tabs);
            }
            recursionDepth = 0;
            return tabPath;
          },
          navElement: function(tabPath) {
            tabPath = tabPath || activeTabPath;
            return $allModules.filter('[data-' + metadata.tab + '="' + tabPath + '"]');
          },
          tabElement: function(tabPath) {
            var
              $fullPathTab,
              $simplePathTab,
              tabPathArray,
              lastTab
            ;
            tabPath        = tabPath || activeTabPath;
            tabPathArray   = module.utilities.pathToArray(tabPath);
            lastTab        = module.utilities.last(tabPathArray);
            $fullPathTab   = $tabs.filter('[data-' + metadata.tab + '="' + tabPath + '"]');
            $simplePathTab = $tabs.filter('[data-' + metadata.tab + '="' + lastTab + '"]');
            return ($fullPathTab.length > 0)
              ? $fullPathTab
              : $simplePathTab
            ;
          },
          tab: function() {
            return activeTabPath;
          }
        },

        utilities: {
          filterArray: function(keepArray, removeArray) {
            return $.grep(keepArray, function(keepValue) {
              return ( $.inArray(keepValue, removeArray) == -1);
            });
          },
          last: function(array) {
            return $.isArray(array)
              ? array[ array.length - 1]
              : false
            ;
          },
          pathToArray: function(pathName) {
            if(pathName === undefined) {
              pathName = activeTabPath;
            }
            return typeof pathName == 'string'
              ? pathName.split('/')
              : [pathName]
            ;
          },
          arrayToPath: function(pathArray) {
            return $.isArray(pathArray)
              ? pathArray.join('/')
              : false
            ;
          }
        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                module.error(error.method, query);
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };
      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;
  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;

};

// shortcut for tabbed content with no defined navigation
$.tab = function() {
  $(window).tab.apply(this, arguments);
};

$.fn.tab.settings = {

  name            : 'Tab',
  namespace       : 'tab',

  silent          : false,
  debug           : false,
  verbose         : false,
  performance     : true,

  auto            : false,      // uses pjax style endpoints fetching content from same url with remote-content headers
  history         : false,      // use browser history
  historyType     : 'hash',     // #/ or html5 state
  path            : false,      // base path of url

  context         : false,      // specify a context that tabs must appear inside
  childrenOnly    : false,      // use only tabs that are children of context
  maxDepth        : 25,         // max depth a tab can be nested

  deactivate      : 'siblings', // whether tabs should deactivate sibling menu elements or all elements initialized together

  alwaysRefresh   : false,      // load tab content new every tab click
  cache           : true,       // cache the content requests to pull locally
  loadOnce        : false,      // Whether tab data should only be loaded once when using remote content
  cacheType       : 'response', // Whether to cache exact response, or to html cache contents after scripts execute
  ignoreFirstLoad : false,      // don't load remote content on first load

  apiSettings     : false,      // settings for api call
  evaluateScripts : 'once',     // whether inline scripts should be parsed (true/false/once). Once will not re-evaluate on cached content

  onFirstLoad : function(tabPath, parameterArray, historyEvent) {}, // called first time loaded
  onLoad      : function(tabPath, parameterArray, historyEvent) {}, // called on every load
  onVisible   : function(tabPath, parameterArray, historyEvent) {}, // called every time tab visible
  onRequest   : function(tabPath, parameterArray, historyEvent) {}, // called ever time a tab beings loading remote content

  templates : {
    determineTitle: function(tabArray) {} // returns page title for path
  },

  error: {
    api        : 'You attempted to load content without API module',
    method     : 'The method you called is not defined',
    missingTab : 'Activated tab cannot be found. Tabs are case-sensitive.',
    noContent  : 'The tab you specified is missing a content url.',
    path       : 'History enabled, but no path was specified',
    recursion  : 'Max recursive depth reached',
    legacyInit : 'onTabInit has been renamed to onFirstLoad in 2.0, please adjust your code.',
    legacyLoad : 'onTabLoad has been renamed to onLoad in 2.0. Please adjust your code',
    state      : 'History requires Asual\'s Address library <https://github.com/asual/jquery-address>'
  },

  metadata : {
    tab    : 'tab',
    loaded : 'loaded',
    promise: 'promise'
  },

  className   : {
    loading : 'loading',
    active  : 'active'
  },

  selector    : {
    tabs : '.ui.tab',
    ui   : '.ui'
  }

};

})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Transition
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.transition = function() {
  var
    $allModules     = $(this),
    moduleSelector  = $allModules.selector || '',

    time            = new Date().getTime(),
    performance     = [],

    moduleArguments = arguments,
    query           = moduleArguments[0],
    queryArguments  = [].slice.call(arguments, 1),
    methodInvoked   = (typeof query === 'string'),

    requestAnimationFrame = window.requestAnimationFrame
      || window.mozRequestAnimationFrame
      || window.webkitRequestAnimationFrame
      || window.msRequestAnimationFrame
      || function(callback) { setTimeout(callback, 0); },

    returnedValue
  ;
  $allModules
    .each(function(index) {
      var
        $module  = $(this),
        element  = this,

        // set at run time
        settings,
        instance,

        error,
        className,
        metadata,
        animationEnd,
        animationName,

        namespace,
        moduleNamespace,
        eventNamespace,
        module
      ;

      module = {

        initialize: function() {

          // get full settings
          settings        = module.get.settings.apply(element, moduleArguments);

          // shorthand
          className       = settings.className;
          error           = settings.error;
          metadata        = settings.metadata;

          // define namespace
          eventNamespace  = '.' + settings.namespace;
          moduleNamespace = 'module-' + settings.namespace;
          instance        = $module.data(moduleNamespace) || module;

          // get vendor specific events
          animationEnd    = module.get.animationEndEvent();

          if(methodInvoked) {
            methodInvoked = module.invoke(query);
          }

          // method not invoked, lets run an animation
          if(methodInvoked === false) {
            module.verbose('Converted arguments into settings object', settings);
            if(settings.interval) {
              module.delay(settings.animate);
            }
            else  {
              module.animate();
            }
            module.instantiate();
          }
        },

        instantiate: function() {
          module.verbose('Storing instance of module', module);
          instance = module;
          $module
            .data(moduleNamespace, instance)
          ;
        },

        destroy: function() {
          module.verbose('Destroying previous module for', element);
          $module
            .removeData(moduleNamespace)
          ;
        },

        refresh: function() {
          module.verbose('Refreshing display type on next animation');
          delete module.displayType;
        },

        forceRepaint: function() {
          module.verbose('Forcing element repaint');
          var
            $parentElement = $module.parent(),
            $nextElement = $module.next()
          ;
          if($nextElement.length === 0) {
            $module.detach().appendTo($parentElement);
          }
          else {
            $module.detach().insertBefore($nextElement);
          }
        },

        repaint: function() {
          module.verbose('Repainting element');
          var
            fakeAssignment = element.offsetWidth
          ;
        },

        delay: function(interval) {
          var
            direction = module.get.animationDirection(),
            shouldReverse,
            delay
          ;
          if(!direction) {
            direction = module.can.transition()
              ? module.get.direction()
              : 'static'
            ;
          }
          interval = (interval !== undefined)
            ? interval
            : settings.interval
          ;
          shouldReverse = (settings.reverse == 'auto' && direction == className.outward);
          delay = (shouldReverse || settings.reverse == true)
            ? ($allModules.length - index) * settings.interval
            : index * settings.interval
          ;
          module.debug('Delaying animation by', delay);
          setTimeout(module.animate, delay);
        },

        animate: function(overrideSettings) {
          settings = overrideSettings || settings;
          if(!module.is.supported()) {
            module.error(error.support);
            return false;
          }
          module.debug('Preparing animation', settings.animation);
          if(module.is.animating()) {
            if(settings.queue) {
              if(!settings.allowRepeats && module.has.direction() && module.is.occurring() && module.queuing !== true) {
                module.debug('Animation is currently occurring, preventing queueing same animation', settings.animation);
              }
              else {
                module.queue(settings.animation);
              }
              return false;
            }
            else if(!settings.allowRepeats && module.is.occurring()) {
              module.debug('Animation is already occurring, will not execute repeated animation', settings.animation);
              return false;
            }
            else {
              module.debug('New animation started, completing previous early', settings.animation);
              instance.complete();
            }
          }
          if( module.can.animate() ) {
            module.set.animating(settings.animation);
          }
          else {
            module.error(error.noAnimation, settings.animation, element);
          }
        },

        reset: function() {
          module.debug('Resetting animation to beginning conditions');
          module.remove.animationCallbacks();
          module.restore.conditions();
          module.remove.animating();
        },

        queue: function(animation) {
          module.debug('Queueing animation of', animation);
          module.queuing = true;
          $module
            .one(animationEnd + '.queue' + eventNamespace, function() {
              module.queuing = false;
              module.repaint();
              module.animate.apply(this, settings);
            })
          ;
        },

        complete: function (event) {
          module.debug('Animation complete', settings.animation);
          module.remove.completeCallback();
          module.remove.failSafe();
          if(!module.is.looping()) {
            if( module.is.outward() ) {
              module.verbose('Animation is outward, hiding element');
              module.restore.conditions();
              module.hide();
            }
            else if( module.is.inward() ) {
              module.verbose('Animation is outward, showing element');
              module.restore.conditions();
              module.show();
            }
            else {
              module.verbose('Static animation completed');
              module.restore.conditions();
              settings.onComplete.call(element);
            }
          }
        },

        force: {
          visible: function() {
            var
              style          = $module.attr('style'),
              userStyle      = module.get.userStyle(),
              displayType    = module.get.displayType(),
              overrideStyle  = userStyle + 'display: ' + displayType + ' !important;',
              currentDisplay = $module.css('display'),
              emptyStyle     = (style === undefined || style === '')
            ;
            if(currentDisplay !== displayType) {
              module.verbose('Overriding default display to show element', displayType);
              $module
                .attr('style', overrideStyle)
              ;
            }
            else if(emptyStyle) {
              $module.removeAttr('style');
            }
          },
          hidden: function() {
            var
              style          = $module.attr('style'),
              currentDisplay = $module.css('display'),
              emptyStyle     = (style === undefined || style === '')
            ;
            if(currentDisplay !== 'none' && !module.is.hidden()) {
              module.verbose('Overriding default display to hide element');
              $module
                .css('display', 'none')
              ;
            }
            else if(emptyStyle) {
              $module
                .removeAttr('style')
              ;
            }
          }
        },

        has: {
          direction: function(animation) {
            var
              hasDirection = false
            ;
            animation = animation || settings.animation;
            if(typeof animation === 'string') {
              animation = animation.split(' ');
              $.each(animation, function(index, word){
                if(word === className.inward || word === className.outward) {
                  hasDirection = true;
                }
              });
            }
            return hasDirection;
          },
          inlineDisplay: function() {
            var
              style = $module.attr('style') || ''
            ;
            return $.isArray(style.match(/display.*?;/, ''));
          }
        },

        set: {
          animating: function(animation) {
            var
              animationClass,
              direction
            ;
            // remove previous callbacks
            module.remove.completeCallback();

            // determine exact animation
            animation      = animation || settings.animation;
            animationClass = module.get.animationClass(animation);

            // save animation class in cache to restore class names
            module.save.animation(animationClass);

            // override display if necessary so animation appears visibly
            module.force.visible();

            module.remove.hidden();
            module.remove.direction();

            module.start.animation(animationClass);

          },
          duration: function(animationName, duration) {
            duration = duration || settings.duration;
            duration = (typeof duration == 'number')
              ? duration + 'ms'
              : duration
            ;
            if(duration || duration === 0) {
              module.verbose('Setting animation duration', duration);
              $module
                .css({
                  'animation-duration':  duration
                })
              ;
            }
          },
          direction: function(direction) {
            direction = direction || module.get.direction();
            if(direction == className.inward) {
              module.set.inward();
            }
            else {
              module.set.outward();
            }
          },
          looping: function() {
            module.debug('Transition set to loop');
            $module
              .addClass(className.looping)
            ;
          },
          hidden: function() {
            $module
              .addClass(className.transition)
              .addClass(className.hidden)
            ;
          },
          inward: function() {
            module.debug('Setting direction to inward');
            $module
              .removeClass(className.outward)
              .addClass(className.inward)
            ;
          },
          outward: function() {
            module.debug('Setting direction to outward');
            $module
              .removeClass(className.inward)
              .addClass(className.outward)
            ;
          },
          visible: function() {
            $module
              .addClass(className.transition)
              .addClass(className.visible)
            ;
          }
        },

        start: {
          animation: function(animationClass) {
            animationClass = animationClass || module.get.animationClass();
            module.debug('Starting tween', animationClass);
            $module
              .addClass(animationClass)
              .one(animationEnd + '.complete' + eventNamespace, module.complete)
            ;
            if(settings.useFailSafe) {
              module.add.failSafe();
            }
            module.set.duration(settings.duration);
            settings.onStart.call(element);
          }
        },

        save: {
          animation: function(animation) {
            if(!module.cache) {
              module.cache = {};
            }
            module.cache.animation = animation;
          },
          displayType: function(displayType) {
            if(displayType !== 'none') {
              $module.data(metadata.displayType, displayType);
            }
          },
          transitionExists: function(animation, exists) {
            $.fn.transition.exists[animation] = exists;
            module.verbose('Saving existence of transition', animation, exists);
          }
        },

        restore: {
          conditions: function() {
            var
              animation = module.get.currentAnimation()
            ;
            if(animation) {
              $module
                .removeClass(animation)
              ;
              module.verbose('Removing animation class', module.cache);
            }
            module.remove.duration();
          }
        },

        add: {
          failSafe: function() {
            var
              duration = module.get.duration()
            ;
            module.timer = setTimeout(function() {
              $module.triggerHandler(animationEnd);
            }, duration + settings.failSafeDelay);
            module.verbose('Adding fail safe timer', module.timer);
          }
        },

        remove: {
          animating: function() {
            $module.removeClass(className.animating);
          },
          animationCallbacks: function() {
            module.remove.queueCallback();
            module.remove.completeCallback();
          },
          queueCallback: function() {
            $module.off('.queue' + eventNamespace);
          },
          completeCallback: function() {
            $module.off('.complete' + eventNamespace);
          },
          display: function() {
            $module.css('display', '');
          },
          direction: function() {
            $module
              .removeClass(className.inward)
              .removeClass(className.outward)
            ;
          },
          duration: function() {
            $module
              .css('animation-duration', '')
            ;
          },
          failSafe: function() {
            module.verbose('Removing fail safe timer', module.timer);
            if(module.timer) {
              clearTimeout(module.timer);
            }
          },
          hidden: function() {
            $module.removeClass(className.hidden);
          },
          visible: function() {
            $module.removeClass(className.visible);
          },
          looping: function() {
            module.debug('Transitions are no longer looping');
            if( module.is.looping() ) {
              module.reset();
              $module
                .removeClass(className.looping)
              ;
            }
          },
          transition: function() {
            $module
              .removeClass(className.visible)
              .removeClass(className.hidden)
            ;
          }
        },
        get: {
          settings: function(animation, duration, onComplete) {
            // single settings object
            if(typeof animation == 'object') {
              return $.extend(true, {}, $.fn.transition.settings, animation);
            }
            // all arguments provided
            else if(typeof onComplete == 'function') {
              return $.extend({}, $.fn.transition.settings, {
                animation  : animation,
                onComplete : onComplete,
                duration   : duration
              });
            }
            // only duration provided
            else if(typeof duration == 'string' || typeof duration == 'number') {
              return $.extend({}, $.fn.transition.settings, {
                animation : animation,
                duration  : duration
              });
            }
            // duration is actually settings object
            else if(typeof duration == 'object') {
              return $.extend({}, $.fn.transition.settings, duration, {
                animation : animation
              });
            }
            // duration is actually callback
            else if(typeof duration == 'function') {
              return $.extend({}, $.fn.transition.settings, {
                animation  : animation,
                onComplete : duration
              });
            }
            // only animation provided
            else {
              return $.extend({}, $.fn.transition.settings, {
                animation : animation
              });
            }
          },
          animationClass: function(animation) {
            var
              animationClass = animation || settings.animation,
              directionClass = (module.can.transition() && !module.has.direction())
                ? module.get.direction() + ' '
                : ''
            ;
            return className.animating + ' '
              + className.transition + ' '
              + directionClass
              + animationClass
            ;
          },
          currentAnimation: function() {
            return (module.cache && module.cache.animation !== undefined)
              ? module.cache.animation
              : false
            ;
          },
          currentDirection: function() {
            return module.is.inward()
              ? className.inward
              : className.outward
            ;
          },
          direction: function() {
            return module.is.hidden() || !module.is.visible()
              ? className.inward
              : className.outward
            ;
          },
          animationDirection: function(animation) {
            var
              direction
            ;
            animation = animation || settings.animation;
            if(typeof animation === 'string') {
              animation = animation.split(' ');
              // search animation name for out/in class
              $.each(animation, function(index, word){
                if(word === className.inward) {
                  direction = className.inward;
                }
                else if(word === className.outward) {
                  direction = className.outward;
                }
              });
            }
            // return found direction
            if(direction) {
              return direction;
            }
            return false;
          },
          duration: function(duration) {
            duration = duration || settings.duration;
            if(duration === false) {
              duration = $module.css('animation-duration') || 0;
            }
            return (typeof duration === 'string')
              ? (duration.indexOf('ms') > -1)
                ? parseFloat(duration)
                : parseFloat(duration) * 1000
              : duration
            ;
          },
          displayType: function(shouldDetermine) {
            shouldDetermine = (shouldDetermine !== undefined)
              ? shouldDetermine
              : true
            ;
            if(settings.displayType) {
              return settings.displayType;
            }
            if(shouldDetermine && $module.data(metadata.displayType) === undefined) {
              // create fake element to determine display state
              module.can.transition(true);
            }
            return $module.data(metadata.displayType);
          },
          userStyle: function(style) {
            style = style || $module.attr('style') || '';
            return style.replace(/display.*?;/, '');
          },
          transitionExists: function(animation) {
            return $.fn.transition.exists[animation];
          },
          animationStartEvent: function() {
            var
              element     = document.createElement('div'),
              animations  = {
                'animation'       :'animationstart',
                'OAnimation'      :'oAnimationStart',
                'MozAnimation'    :'mozAnimationStart',
                'WebkitAnimation' :'webkitAnimationStart'
              },
              animation
            ;
            for(animation in animations){
              if( element.style[animation] !== undefined ){
                return animations[animation];
              }
            }
            return false;
          },
          animationEndEvent: function() {
            var
              element     = document.createElement('div'),
              animations  = {
                'animation'       :'animationend',
                'OAnimation'      :'oAnimationEnd',
                'MozAnimation'    :'mozAnimationEnd',
                'WebkitAnimation' :'webkitAnimationEnd'
              },
              animation
            ;
            for(animation in animations){
              if( element.style[animation] !== undefined ){
                return animations[animation];
              }
            }
            return false;
          }

        },

        can: {
          transition: function(forced) {
            var
              animation         = settings.animation,
              transitionExists  = module.get.transitionExists(animation),
              displayType       = module.get.displayType(false),
              elementClass,
              tagName,
              $clone,
              currentAnimation,
              inAnimation,
              directionExists
            ;
            if( transitionExists === undefined || forced) {
              module.verbose('Determining whether animation exists');
              elementClass = $module.attr('class');
              tagName      = $module.prop('tagName');

              $clone = $('<' + tagName + ' />').addClass( elementClass ).insertAfter($module);
              currentAnimation = $clone
                .addClass(animation)
                .removeClass(className.inward)
                .removeClass(className.outward)
                .addClass(className.animating)
                .addClass(className.transition)
                .css('animationName')
              ;
              inAnimation = $clone
                .addClass(className.inward)
                .css('animationName')
              ;
              if(!displayType) {
                displayType = $clone
                  .attr('class', elementClass)
                  .removeAttr('style')
                  .removeClass(className.hidden)
                  .removeClass(className.visible)
                  .show()
                  .css('display')
                ;
                module.verbose('Determining final display state', displayType);
                module.save.displayType(displayType);
              }

              $clone.remove();
              if(currentAnimation != inAnimation) {
                module.debug('Direction exists for animation', animation);
                directionExists = true;
              }
              else if(currentAnimation == 'none' || !currentAnimation) {
                module.debug('No animation defined in css', animation);
                return;
              }
              else {
                module.debug('Static animation found', animation, displayType);
                directionExists = false;
              }
              module.save.transitionExists(animation, directionExists);
            }
            return (transitionExists !== undefined)
              ? transitionExists
              : directionExists
            ;
          },
          animate: function() {
            // can transition does not return a value if animation does not exist
            return (module.can.transition() !== undefined);
          }
        },

        is: {
          animating: function() {
            return $module.hasClass(className.animating);
          },
          inward: function() {
            return $module.hasClass(className.inward);
          },
          outward: function() {
            return $module.hasClass(className.outward);
          },
          looping: function() {
            return $module.hasClass(className.looping);
          },
          occurring: function(animation) {
            animation = animation || settings.animation;
            animation = '.' + animation.replace(' ', '.');
            return ( $module.filter(animation).length > 0 );
          },
          visible: function() {
            return $module.is(':visible');
          },
          hidden: function() {
            return $module.css('visibility') === 'hidden';
          },
          supported: function() {
            return(animationEnd !== false);
          }
        },

        hide: function() {
          module.verbose('Hiding element');
          if( module.is.animating() ) {
            module.reset();
          }
          element.blur(); // IE will trigger focus change if element is not blurred before hiding
          module.remove.display();
          module.remove.visible();
          module.set.hidden();
          module.force.hidden();
          settings.onHide.call(element);
          settings.onComplete.call(element);
          // module.repaint();
        },

        show: function(display) {
          module.verbose('Showing element', display);
          module.remove.hidden();
          module.set.visible();
          module.force.visible();
          settings.onShow.call(element);
          settings.onComplete.call(element);
          // module.repaint();
        },

        toggle: function() {
          if( module.is.visible() ) {
            module.hide();
          }
          else {
            module.show();
          }
        },

        stop: function() {
          module.debug('Stopping current animation');
          $module.triggerHandler(animationEnd);
        },

        stopAll: function() {
          module.debug('Stopping all animation');
          module.remove.queueCallback();
          $module.triggerHandler(animationEnd);
        },

        clear: {
          queue: function() {
            module.debug('Clearing animation queue');
            module.remove.queueCallback();
          }
        },

        enable: function() {
          module.verbose('Starting animation');
          $module.removeClass(className.disabled);
        },

        disable: function() {
          module.debug('Stopping animation');
          $module.addClass(className.disabled);
        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if($allModules.length > 1) {
              title += ' ' + '(' + $allModules.length + ')';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        // modified for transition to return invoke success
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }

          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return (found !== undefined)
            ? found
            : false
          ;
        }
      };
      module.initialize();
    })
  ;
  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

// Records if CSS transition is available
$.fn.transition.exists = {};

$.fn.transition.settings = {

  // module info
  name          : 'Transition',

  // hide all output from this component regardless of other settings
  silent        : false,

  // debug content outputted to console
  debug         : false,

  // verbose debug output
  verbose       : false,

  // performance data output
  performance   : true,

  // event namespace
  namespace     : 'transition',

  // delay between animations in group
  interval      : 0,

  // whether group animations should be reversed
  reverse       : 'auto',

  // animation callback event
  onStart       : function() {},
  onComplete    : function() {},
  onShow        : function() {},
  onHide        : function() {},

  // whether timeout should be used to ensure callback fires in cases animationend does not
  useFailSafe   : true,

  // delay in ms for fail safe
  failSafeDelay : 100,

  // whether EXACT animation can occur twice in a row
  allowRepeats  : false,

  // Override final display type on visible
  displayType   : false,

  // animation duration
  animation     : 'fade',
  duration      : false,

  // new animations will occur after previous ones
  queue         : true,

  metadata : {
    displayType: 'display'
  },

  className   : {
    animating  : 'animating',
    disabled   : 'disabled',
    hidden     : 'hidden',
    inward     : 'in',
    loading    : 'loading',
    looping    : 'looping',
    outward    : 'out',
    transition : 'transition',
    visible    : 'visible'
  },

  // possible errors
  error: {
    noAnimation : 'Element is no longer attached to DOM. Unable to animate.  Use silent setting to surpress this warning in production.',
    repeated    : 'That animation is already occurring, cancelling repeated animation',
    method      : 'The method you called is not defined',
    support     : 'This browser does not support CSS animations'
  }

};


})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - API
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

var
  window = (typeof window != 'undefined' && window.Math == Math)
    ? window
    : (typeof self != 'undefined' && self.Math == Math)
      ? self
      : Function('return this')()
;

$.api = $.fn.api = function(parameters) {

  var
    // use window context if none specified
    $allModules     = $.isFunction(this)
        ? $(window)
        : $(this),
    moduleSelector = $allModules.selector || '',
    time           = new Date().getTime(),
    performance    = [],

    query          = arguments[0],
    methodInvoked  = (typeof query == 'string'),
    queryArguments = [].slice.call(arguments, 1),

    returnedValue
  ;

  $allModules
    .each(function() {
      var
        settings          = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.api.settings, parameters)
          : $.extend({}, $.fn.api.settings),

        // internal aliases
        namespace       = settings.namespace,
        metadata        = settings.metadata,
        selector        = settings.selector,
        error           = settings.error,
        className       = settings.className,

        // define namespaces for modules
        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,

        // element that creates request
        $module         = $(this),
        $form           = $module.closest(selector.form),

        // context used for state
        $context        = (settings.stateContext)
          ? $(settings.stateContext)
          : $module,

        // request details
        ajaxSettings,
        requestSettings,
        url,
        data,
        requestStartTime,

        // standard module
        element         = this,
        context         = $context[0],
        instance        = $module.data(moduleNamespace),
        module
      ;

      module = {

        initialize: function() {
          if(!methodInvoked) {
            module.bind.events();
          }
          module.instantiate();
        },

        instantiate: function() {
          module.verbose('Storing instance of module', module);
          instance = module;
          $module
            .data(moduleNamespace, instance)
          ;
        },

        destroy: function() {
          module.verbose('Destroying previous module for', element);
          $module
            .removeData(moduleNamespace)
            .off(eventNamespace)
          ;
        },

        bind: {
          events: function() {
            var
              triggerEvent = module.get.event()
            ;
            if( triggerEvent ) {
              module.verbose('Attaching API events to element', triggerEvent);
              $module
                .on(triggerEvent + eventNamespace, module.event.trigger)
              ;
            }
            else if(settings.on == 'now') {
              module.debug('Querying API endpoint immediately');
              module.query();
            }
          }
        },

        decode: {
          json: function(response) {
            if(response !== undefined && typeof response == 'string') {
              try {
               response = JSON.parse(response);
              }
              catch(e) {
                // isnt json string
              }
            }
            return response;
          }
        },

        read: {
          cachedResponse: function(url) {
            var
              response
            ;
            if(window.Storage === undefined) {
              module.error(error.noStorage);
              return;
            }
            response = sessionStorage.getItem(url);
            module.debug('Using cached response', url, response);
            response = module.decode.json(response);
            return response;
          }
        },
        write: {
          cachedResponse: function(url, response) {
            if(response && response === '') {
              module.debug('Response empty, not caching', response);
              return;
            }
            if(window.Storage === undefined) {
              module.error(error.noStorage);
              return;
            }
            if( $.isPlainObject(response) ) {
              response = JSON.stringify(response);
            }
            sessionStorage.setItem(url, response);
            module.verbose('Storing cached response for url', url, response);
          }
        },

        query: function() {

          if(module.is.disabled()) {
            module.debug('Element is disabled API request aborted');
            return;
          }

          if(module.is.loading()) {
            if(settings.interruptRequests) {
              module.debug('Interrupting previous request');
              module.abort();
            }
            else {
              module.debug('Cancelling request, previous request is still pending');
              return;
            }
          }

          // pass element metadata to url (value, text)
          if(settings.defaultData) {
            $.extend(true, settings.urlData, module.get.defaultData());
          }

          // Add form content
          if(settings.serializeForm) {
            settings.data = module.add.formData(settings.data);
          }

          // call beforesend and get any settings changes
          requestSettings = module.get.settings();

          // check if before send cancelled request
          if(requestSettings === false) {
            module.cancelled = true;
            module.error(error.beforeSend);
            return;
          }
          else {
            module.cancelled = false;
          }

          // get url
          url = module.get.templatedURL();

          if(!url && !module.is.mocked()) {
            module.error(error.missingURL);
            return;
          }

          // replace variables
          url = module.add.urlData( url );
          // missing url parameters
          if( !url && !module.is.mocked()) {
            return;
          }

          requestSettings.url = settings.base + url;

          // look for jQuery ajax parameters in settings
          ajaxSettings = $.extend(true, {}, settings, {
            type       : settings.method || settings.type,
            data       : data,
            url        : settings.base + url,
            beforeSend : settings.beforeXHR,
            success    : function() {},
            failure    : function() {},
            complete   : function() {}
          });

          module.debug('Querying URL', ajaxSettings.url);
          module.verbose('Using AJAX settings', ajaxSettings);
          if(settings.cache === 'local' && module.read.cachedResponse(url)) {
            module.debug('Response returned from local cache');
            module.request = module.create.request();
            module.request.resolveWith(context, [ module.read.cachedResponse(url) ]);
            return;
          }

          if( !settings.throttle ) {
            module.debug('Sending request', data, ajaxSettings.method);
            module.send.request();
          }
          else {
            if(!settings.throttleFirstRequest && !module.timer) {
              module.debug('Sending request', data, ajaxSettings.method);
              module.send.request();
              module.timer = setTimeout(function(){}, settings.throttle);
            }
            else {
              module.debug('Throttling request', settings.throttle);
              clearTimeout(module.timer);
              module.timer = setTimeout(function() {
                if(module.timer) {
                  delete module.timer;
                }
                module.debug('Sending throttled request', data, ajaxSettings.method);
                module.send.request();
              }, settings.throttle);
            }
          }

        },

        should: {
          removeError: function() {
            return ( settings.hideError === true || (settings.hideError === 'auto' && !module.is.form()) );
          }
        },

        is: {
          disabled: function() {
            return ($module.filter(selector.disabled).length > 0);
          },
          expectingJSON: function() {
            return settings.dataType === 'json' || settings.dataType === 'jsonp';
          },
          form: function() {
            return $module.is('form') || $context.is('form');
          },
          mocked: function() {
            return (settings.mockResponse || settings.mockResponseAsync || settings.response || settings.responseAsync);
          },
          input: function() {
            return $module.is('input');
          },
          loading: function() {
            return (module.request)
              ? (module.request.state() == 'pending')
              : false
            ;
          },
          abortedRequest: function(xhr) {
            if(xhr && xhr.readyState !== undefined && xhr.readyState === 0) {
              module.verbose('XHR request determined to be aborted');
              return true;
            }
            else {
              module.verbose('XHR request was not aborted');
              return false;
            }
          },
          validResponse: function(response) {
            if( (!module.is.expectingJSON()) || !$.isFunction(settings.successTest) ) {
              module.verbose('Response is not JSON, skipping validation', settings.successTest, response);
              return true;
            }
            module.debug('Checking JSON returned success', settings.successTest, response);
            if( settings.successTest(response) ) {
              module.debug('Response passed success test', response);
              return true;
            }
            else {
              module.debug('Response failed success test', response);
              return false;
            }
          }
        },

        was: {
          cancelled: function() {
            return (module.cancelled || false);
          },
          succesful: function() {
            return (module.request && module.request.state() == 'resolved');
          },
          failure: function() {
            return (module.request && module.request.state() == 'rejected');
          },
          complete: function() {
            return (module.request && (module.request.state() == 'resolved' || module.request.state() == 'rejected') );
          }
        },

        add: {
          urlData: function(url, urlData) {
            var
              requiredVariables,
              optionalVariables
            ;
            if(url) {
              requiredVariables = url.match(settings.regExp.required);
              optionalVariables = url.match(settings.regExp.optional);
              urlData           = urlData || settings.urlData;
              if(requiredVariables) {
                module.debug('Looking for required URL variables', requiredVariables);
                $.each(requiredVariables, function(index, templatedString) {
                  var
                    // allow legacy {$var} style
                    variable = (templatedString.indexOf('$') !== -1)
                      ? templatedString.substr(2, templatedString.length - 3)
                      : templatedString.substr(1, templatedString.length - 2),
                    value   = ($.isPlainObject(urlData) && urlData[variable] !== undefined)
                      ? urlData[variable]
                      : ($module.data(variable) !== undefined)
                        ? $module.data(variable)
                        : ($context.data(variable) !== undefined)
                          ? $context.data(variable)
                          : urlData[variable]
                  ;
                  // remove value
                  if(value === undefined) {
                    module.error(error.requiredParameter, variable, url);
                    url = false;
                    return false;
                  }
                  else {
                    module.verbose('Found required variable', variable, value);
                    value = (settings.encodeParameters)
                      ? module.get.urlEncodedValue(value)
                      : value
                    ;
                    url = url.replace(templatedString, value);
                  }
                });
              }
              if(optionalVariables) {
                module.debug('Looking for optional URL variables', requiredVariables);
                $.each(optionalVariables, function(index, templatedString) {
                  var
                    // allow legacy {/$var} style
                    variable = (templatedString.indexOf('$') !== -1)
                      ? templatedString.substr(3, templatedString.length - 4)
                      : templatedString.substr(2, templatedString.length - 3),
                    value   = ($.isPlainObject(urlData) && urlData[variable] !== undefined)
                      ? urlData[variable]
                      : ($module.data(variable) !== undefined)
                        ? $module.data(variable)
                        : ($context.data(variable) !== undefined)
                          ? $context.data(variable)
                          : urlData[variable]
                  ;
                  // optional replacement
                  if(value !== undefined) {
                    module.verbose('Optional variable Found', variable, value);
                    url = url.replace(templatedString, value);
                  }
                  else {
                    module.verbose('Optional variable not found', variable);
                    // remove preceding slash if set
                    if(url.indexOf('/' + templatedString) !== -1) {
                      url = url.replace('/' + templatedString, '');
                    }
                    else {
                      url = url.replace(templatedString, '');
                    }
                  }
                });
              }
            }
            return url;
          },
          formData: function(data) {
            var
              canSerialize = ($.fn.serializeObject !== undefined),
              formData     = (canSerialize)
                ? $form.serializeObject()
                : $form.serialize(),
              hasOtherData
            ;
            data         = data || settings.data;
            hasOtherData = $.isPlainObject(data);

            if(hasOtherData) {
              if(canSerialize) {
                module.debug('Extending existing data with form data', data, formData);
                data = $.extend(true, {}, data, formData);
              }
              else {
                module.error(error.missingSerialize);
                module.debug('Cant extend data. Replacing data with form data', data, formData);
                data = formData;
              }
            }
            else {
              module.debug('Adding form data', formData);
              data = formData;
            }
            return data;
          }
        },

        send: {
          request: function() {
            module.set.loading();
            module.request = module.create.request();
            if( module.is.mocked() ) {
              module.mockedXHR = module.create.mockedXHR();
            }
            else {
              module.xhr = module.create.xhr();
            }
            settings.onRequest.call(context, module.request, module.xhr);
          }
        },

        event: {
          trigger: function(event) {
            module.query();
            if(event.type == 'submit' || event.type == 'click') {
              event.preventDefault();
            }
          },
          xhr: {
            always: function() {
              // nothing special
            },
            done: function(response, textStatus, xhr) {
              var
                context            = this,
                elapsedTime        = (new Date().getTime() - requestStartTime),
                timeLeft           = (settings.loadingDuration - elapsedTime),
                translatedResponse = ( $.isFunction(settings.onResponse) )
                  ? module.is.expectingJSON()
                    ? settings.onResponse.call(context, $.extend(true, {}, response))
                    : settings.onResponse.call(context, response)
                  : false
              ;
              timeLeft = (timeLeft > 0)
                ? timeLeft
                : 0
              ;
              if(translatedResponse) {
                module.debug('Modified API response in onResponse callback', settings.onResponse, translatedResponse, response);
                response = translatedResponse;
              }
              if(timeLeft > 0) {
                module.debug('Response completed early delaying state change by', timeLeft);
              }
              setTimeout(function() {
                if( module.is.validResponse(response) ) {
                  module.request.resolveWith(context, [response, xhr]);
                }
                else {
                  module.request.rejectWith(context, [xhr, 'invalid']);
                }
              }, timeLeft);
            },
            fail: function(xhr, status, httpMessage) {
              var
                context     = this,
                elapsedTime = (new Date().getTime() - requestStartTime),
                timeLeft    = (settings.loadingDuration - elapsedTime)
              ;
              timeLeft = (timeLeft > 0)
                ? timeLeft
                : 0
              ;
              if(timeLeft > 0) {
                module.debug('Response completed early delaying state change by', timeLeft);
              }
              setTimeout(function() {
                if( module.is.abortedRequest(xhr) ) {
                  module.request.rejectWith(context, [xhr, 'aborted', httpMessage]);
                }
                else {
                  module.request.rejectWith(context, [xhr, 'error', status, httpMessage]);
                }
              }, timeLeft);
            }
          },
          request: {
            done: function(response, xhr) {
              module.debug('Successful API Response', response);
              if(settings.cache === 'local' && url) {
                module.write.cachedResponse(url, response);
                module.debug('Saving server response locally', module.cache);
              }
              settings.onSuccess.call(context, response, $module, xhr);
            },
            complete: function(firstParameter, secondParameter) {
              var
                xhr,
                response
              ;
              // have to guess callback parameters based on request success
              if( module.was.succesful() ) {
                response = firstParameter;
                xhr      = secondParameter;
              }
              else {
                xhr      = firstParameter;
                response = module.get.responseFromXHR(xhr);
              }
              module.remove.loading();
              settings.onComplete.call(context, response, $module, xhr);
            },
            fail: function(xhr, status, httpMessage) {
              var
                // pull response from xhr if available
                response     = module.get.responseFromXHR(xhr),
                errorMessage = module.get.errorFromRequest(response, status, httpMessage)
              ;
              if(status == 'aborted') {
                module.debug('XHR Aborted (Most likely caused by page navigation or CORS Policy)', status, httpMessage);
                settings.onAbort.call(context, status, $module, xhr);
                return true;
              }
              else if(status == 'invalid') {
                module.debug('JSON did not pass success test. A server-side error has most likely occurred', response);
              }
              else if(status == 'error') {
                if(xhr !== undefined) {
                  module.debug('XHR produced a server error', status, httpMessage);
                  // make sure we have an error to display to console
                  if( xhr.status != 200 && httpMessage !== undefined && httpMessage !== '') {
                    module.error(error.statusMessage + httpMessage, ajaxSettings.url);
                  }
                  settings.onError.call(context, errorMessage, $module, xhr);
                }
              }

              if(settings.errorDuration && status !== 'aborted') {
                module.debug('Adding error state');
                module.set.error();
                if( module.should.removeError() ) {
                  setTimeout(module.remove.error, settings.errorDuration);
                }
              }
              module.debug('API Request failed', errorMessage, xhr);
              settings.onFailure.call(context, response, $module, xhr);
            }
          }
        },

        create: {

          request: function() {
            // api request promise
            return $.Deferred()
              .always(module.event.request.complete)
              .done(module.event.request.done)
              .fail(module.event.request.fail)
            ;
          },

          mockedXHR: function () {
            var
              // xhr does not simulate these properties of xhr but must return them
              textStatus     = false,
              status         = false,
              httpMessage    = false,
              responder      = settings.mockResponse      || settings.response,
              asyncResponder = settings.mockResponseAsync || settings.responseAsync,
              asyncCallback,
              response,
              mockedXHR
            ;

            mockedXHR = $.Deferred()
              .always(module.event.xhr.complete)
              .done(module.event.xhr.done)
              .fail(module.event.xhr.fail)
            ;

            if(responder) {
              if( $.isFunction(responder) ) {
                module.debug('Using specified synchronous callback', responder);
                response = responder.call(context, requestSettings);
              }
              else {
                module.debug('Using settings specified response', responder);
                response = responder;
              }
              // simulating response
              mockedXHR.resolveWith(context, [ response, textStatus, { responseText: response }]);
            }
            else if( $.isFunction(asyncResponder) ) {
              asyncCallback = function(response) {
                module.debug('Async callback returned response', response);

                if(response) {
                  mockedXHR.resolveWith(context, [ response, textStatus, { responseText: response }]);
                }
                else {
                  mockedXHR.rejectWith(context, [{ responseText: response }, status, httpMessage]);
                }
              };
              module.debug('Using specified async response callback', asyncResponder);
              asyncResponder.call(context, requestSettings, asyncCallback);
            }
            return mockedXHR;
          },

          xhr: function() {
            var
              xhr
            ;
            // ajax request promise
            xhr = $.ajax(ajaxSettings)
              .always(module.event.xhr.always)
              .done(module.event.xhr.done)
              .fail(module.event.xhr.fail)
            ;
            module.verbose('Created server request', xhr, ajaxSettings);
            return xhr;
          }
        },

        set: {
          error: function() {
            module.verbose('Adding error state to element', $context);
            $context.addClass(className.error);
          },
          loading: function() {
            module.verbose('Adding loading state to element', $context);
            $context.addClass(className.loading);
            requestStartTime = new Date().getTime();
          }
        },

        remove: {
          error: function() {
            module.verbose('Removing error state from element', $context);
            $context.removeClass(className.error);
          },
          loading: function() {
            module.verbose('Removing loading state from element', $context);
            $context.removeClass(className.loading);
          }
        },

        get: {
          responseFromXHR: function(xhr) {
            return $.isPlainObject(xhr)
              ? (module.is.expectingJSON())
                ? module.decode.json(xhr.responseText)
                : xhr.responseText
              : false
            ;
          },
          errorFromRequest: function(response, status, httpMessage) {
            return ($.isPlainObject(response) && response.error !== undefined)
              ? response.error // use json error message
              : (settings.error[status] !== undefined) // use server error message
                ? settings.error[status]
                : httpMessage
            ;
          },
          request: function() {
            return module.request || false;
          },
          xhr: function() {
            return module.xhr || false;
          },
          settings: function() {
            var
              runSettings
            ;
            runSettings = settings.beforeSend.call(context, settings);
            if(runSettings) {
              if(runSettings.success !== undefined) {
                module.debug('Legacy success callback detected', runSettings);
                module.error(error.legacyParameters, runSettings.success);
                runSettings.onSuccess = runSettings.success;
              }
              if(runSettings.failure !== undefined) {
                module.debug('Legacy failure callback detected', runSettings);
                module.error(error.legacyParameters, runSettings.failure);
                runSettings.onFailure = runSettings.failure;
              }
              if(runSettings.complete !== undefined) {
                module.debug('Legacy complete callback detected', runSettings);
                module.error(error.legacyParameters, runSettings.complete);
                runSettings.onComplete = runSettings.complete;
              }
            }
            if(runSettings === undefined) {
              module.error(error.noReturnedValue);
            }
            if(runSettings === false) {
              return runSettings;
            }
            return (runSettings !== undefined)
              ? $.extend(true, {}, runSettings)
              : $.extend(true, {}, settings)
            ;
          },
          urlEncodedValue: function(value) {
            var
              decodedValue   = window.decodeURIComponent(value),
              encodedValue   = window.encodeURIComponent(value),
              alreadyEncoded = (decodedValue !== value)
            ;
            if(alreadyEncoded) {
              module.debug('URL value is already encoded, avoiding double encoding', value);
              return value;
            }
            module.verbose('Encoding value using encodeURIComponent', value, encodedValue);
            return encodedValue;
          },
          defaultData: function() {
            var
              data = {}
            ;
            if( !$.isWindow(element) ) {
              if( module.is.input() ) {
                data.value = $module.val();
              }
              else if( module.is.form() ) {

              }
              else {
                data.text = $module.text();
              }
            }
            return data;
          },
          event: function() {
            if( $.isWindow(element) || settings.on == 'now' ) {
              module.debug('API called without element, no events attached');
              return false;
            }
            else if(settings.on == 'auto') {
              if( $module.is('input') ) {
                return (element.oninput !== undefined)
                  ? 'input'
                  : (element.onpropertychange !== undefined)
                    ? 'propertychange'
                    : 'keyup'
                ;
              }
              else if( $module.is('form') ) {
                return 'submit';
              }
              else {
                return 'click';
              }
            }
            else {
              return settings.on;
            }
          },
          templatedURL: function(action) {
            action = action || $module.data(metadata.action) || settings.action || false;
            url    = $module.data(metadata.url) || settings.url || false;
            if(url) {
              module.debug('Using specified url', url);
              return url;
            }
            if(action) {
              module.debug('Looking up url for action', action, settings.api);
              if(settings.api[action] === undefined && !module.is.mocked()) {
                module.error(error.missingAction, settings.action, settings.api);
                return;
              }
              url = settings.api[action];
            }
            else if( module.is.form() ) {
              url = $module.attr('action') || $context.attr('action') || false;
              module.debug('No url or action specified, defaulting to form action', url);
            }
            return url;
          }
        },

        abort: function() {
          var
            xhr = module.get.xhr()
          ;
          if( xhr && xhr.state() !== 'resolved') {
            module.debug('Cancelling API request');
            xhr.abort();
          }
        },

        // reset state
        reset: function() {
          module.remove.error();
          module.remove.loading();
        },

        setting: function(name, value) {
          module.debug('Changing setting', name, value);
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            if($.isPlainObject(settings[name])) {
              $.extend(true, settings[name], value);
            }
            else {
              settings[name] = value;
            }
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                //'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                module.error(error.method, query);
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.api.settings = {

  name              : 'API',
  namespace         : 'api',

  debug             : false,
  verbose           : false,
  performance       : true,

  // object containing all templates endpoints
  api               : {},

  // whether to cache responses
  cache             : true,

  // whether new requests should abort previous requests
  interruptRequests : true,

  // event binding
  on                : 'auto',

  // context for applying state classes
  stateContext      : false,

  // duration for loading state
  loadingDuration   : 0,

  // whether to hide errors after a period of time
  hideError         : 'auto',

  // duration for error state
  errorDuration     : 2000,

  // whether parameters should be encoded with encodeURIComponent
  encodeParameters  : true,

  // API action to use
  action            : false,

  // templated URL to use
  url               : false,

  // base URL to apply to all endpoints
  base              : '',

  // data that will
  urlData           : {},

  // whether to add default data to url data
  defaultData          : true,

  // whether to serialize closest form
  serializeForm        : false,

  // how long to wait before request should occur
  throttle             : 0,

  // whether to throttle first request or only repeated
  throttleFirstRequest : true,

  // standard ajax settings
  method            : 'get',
  data              : {},
  dataType          : 'json',

  // mock response
  mockResponse      : false,
  mockResponseAsync : false,

  // aliases for mock
  response          : false,
  responseAsync     : false,

  // callbacks before request
  beforeSend  : function(settings) { return settings; },
  beforeXHR   : function(xhr) {},
  onRequest   : function(promise, xhr) {},

  // after request
  onResponse  : false, // function(response) { },

  // response was successful, if JSON passed validation
  onSuccess   : function(response, $module) {},

  // request finished without aborting
  onComplete  : function(response, $module) {},

  // failed JSON success test
  onFailure   : function(response, $module) {},

  // server error
  onError     : function(errorMessage, $module) {},

  // request aborted
  onAbort     : function(errorMessage, $module) {},

  successTest : false,

  // errors
  error : {
    beforeSend        : 'The before send function has aborted the request',
    error             : 'There was an error with your request',
    exitConditions    : 'API Request Aborted. Exit conditions met',
    JSONParse         : 'JSON could not be parsed during error handling',
    legacyParameters  : 'You are using legacy API success callback names',
    method            : 'The method you called is not defined',
    missingAction     : 'API action used but no url was defined',
    missingSerialize  : 'jquery-serialize-object is required to add form data to an existing data object',
    missingURL        : 'No URL specified for api event',
    noReturnedValue   : 'The beforeSend callback must return a settings object, beforeSend ignored.',
    noStorage         : 'Caching responses locally requires session storage',
    parseError        : 'There was an error parsing your request',
    requiredParameter : 'Missing a required URL parameter: ',
    statusMessage     : 'Server gave an error: ',
    timeout           : 'Your request timed out'
  },

  regExp  : {
    required : /\{\$*[A-z0-9]+\}/g,
    optional : /\{\/\$*[A-z0-9]+\}/g,
  },

  className: {
    loading : 'loading',
    error   : 'error'
  },

  selector: {
    disabled : '.disabled',
    form      : 'form'
  },

  metadata: {
    action  : 'action',
    url     : 'url'
  }
};



})( jQuery, window, document );

/*!
 * # Semantic UI 2.4.0 - Visibility
 * http://github.com/semantic-org/semantic-ui/
 *
 *
 * Released under the MIT license
 * http://opensource.org/licenses/MIT
 *
 */

;(function ($, window, document, undefined) {

'use strict';

window = (typeof window != 'undefined' && window.Math == Math)
  ? window
  : (typeof self != 'undefined' && self.Math == Math)
    ? self
    : Function('return this')()
;

$.fn.visibility = function(parameters) {
  var
    $allModules    = $(this),
    moduleSelector = $allModules.selector || '',

    time           = new Date().getTime(),
    performance    = [],

    query          = arguments[0],
    methodInvoked  = (typeof query == 'string'),
    queryArguments = [].slice.call(arguments, 1),
    returnedValue,

    moduleCount    = $allModules.length,
    loadedCount    = 0
  ;

  $allModules
    .each(function() {
      var
        settings        = ( $.isPlainObject(parameters) )
          ? $.extend(true, {}, $.fn.visibility.settings, parameters)
          : $.extend({}, $.fn.visibility.settings),

        className       = settings.className,
        namespace       = settings.namespace,
        error           = settings.error,
        metadata        = settings.metadata,

        eventNamespace  = '.' + namespace,
        moduleNamespace = 'module-' + namespace,

        $window         = $(window),

        $module         = $(this),
        $context        = $(settings.context),

        $placeholder,

        selector        = $module.selector || '',
        instance        = $module.data(moduleNamespace),

        requestAnimationFrame = window.requestAnimationFrame
          || window.mozRequestAnimationFrame
          || window.webkitRequestAnimationFrame
          || window.msRequestAnimationFrame
          || function(callback) { setTimeout(callback, 0); },

        element         = this,
        disabled        = false,

        contextObserver,
        observer,
        module
      ;

      module = {

        initialize: function() {
          module.debug('Initializing', settings);

          module.setup.cache();

          if( module.should.trackChanges() ) {

            if(settings.type == 'image') {
              module.setup.image();
            }
            if(settings.type == 'fixed') {
              module.setup.fixed();
            }

            if(settings.observeChanges) {
              module.observeChanges();
            }
            module.bind.events();
          }

          module.save.position();
          if( !module.is.visible() ) {
            module.error(error.visible, $module);
          }

          if(settings.initialCheck) {
            module.checkVisibility();
          }
          module.instantiate();
        },

        instantiate: function() {
          module.debug('Storing instance', module);
          $module
            .data(moduleNamespace, module)
          ;
          instance = module;
        },

        destroy: function() {
          module.verbose('Destroying previous module');
          if(observer) {
            observer.disconnect();
          }
          if(contextObserver) {
            contextObserver.disconnect();
          }
          $window
            .off('load'   + eventNamespace, module.event.load)
            .off('resize' + eventNamespace, module.event.resize)
          ;
          $context
            .off('scroll'       + eventNamespace, module.event.scroll)
            .off('scrollchange' + eventNamespace, module.event.scrollchange)
          ;
          if(settings.type == 'fixed') {
            module.resetFixed();
            module.remove.placeholder();
          }
          $module
            .off(eventNamespace)
            .removeData(moduleNamespace)
          ;
        },

        observeChanges: function() {
          if('MutationObserver' in window) {
            contextObserver = new MutationObserver(module.event.contextChanged);
            observer        = new MutationObserver(module.event.changed);
            contextObserver.observe(document, {
              childList : true,
              subtree   : true
            });
            observer.observe(element, {
              childList : true,
              subtree   : true
            });
            module.debug('Setting up mutation observer', observer);
          }
        },

        bind: {
          events: function() {
            module.verbose('Binding visibility events to scroll and resize');
            if(settings.refreshOnLoad) {
              $window
                .on('load'   + eventNamespace, module.event.load)
              ;
            }
            $window
              .on('resize' + eventNamespace, module.event.resize)
            ;
            // pub/sub pattern
            $context
              .off('scroll'      + eventNamespace)
              .on('scroll'       + eventNamespace, module.event.scroll)
              .on('scrollchange' + eventNamespace, module.event.scrollchange)
            ;
          }
        },

        event: {
          changed: function(mutations) {
            module.verbose('DOM tree modified, updating visibility calculations');
            module.timer = setTimeout(function() {
              module.verbose('DOM tree modified, updating sticky menu');
              module.refresh();
            }, 100);
          },
          contextChanged: function(mutations) {
            [].forEach.call(mutations, function(mutation) {
              if(mutation.removedNodes) {
                [].forEach.call(mutation.removedNodes, function(node) {
                  if(node == element || $(node).find(element).length > 0) {
                    module.debug('Element removed from DOM, tearing down events');
                    module.destroy();
                  }
                });
              }
            });
          },
          resize: function() {
            module.debug('Window resized');
            if(settings.refreshOnResize) {
              requestAnimationFrame(module.refresh);
            }
          },
          load: function() {
            module.debug('Page finished loading');
            requestAnimationFrame(module.refresh);
          },
          // publishes scrollchange event on one scroll
          scroll: function() {
            if(settings.throttle) {
              clearTimeout(module.timer);
              module.timer = setTimeout(function() {
                $context.triggerHandler('scrollchange' + eventNamespace, [ $context.scrollTop() ]);
              }, settings.throttle);
            }
            else {
              requestAnimationFrame(function() {
                $context.triggerHandler('scrollchange' + eventNamespace, [ $context.scrollTop() ]);
              });
            }
          },
          // subscribes to scrollchange
          scrollchange: function(event, scrollPosition) {
            module.checkVisibility(scrollPosition);
          },
        },

        precache: function(images, callback) {
          if (!(images instanceof Array)) {
            images = [images];
          }
          var
            imagesLength  = images.length,
            loadedCounter = 0,
            cache         = [],
            cacheImage    = document.createElement('img'),
            handleLoad    = function() {
              loadedCounter++;
              if (loadedCounter >= images.length) {
                if ($.isFunction(callback)) {
                  callback();
                }
              }
            }
          ;
          while (imagesLength--) {
            cacheImage         = document.createElement('img');
            cacheImage.onload  = handleLoad;
            cacheImage.onerror = handleLoad;
            cacheImage.src     = images[imagesLength];
            cache.push(cacheImage);
          }
        },

        enableCallbacks: function() {
          module.debug('Allowing callbacks to occur');
          disabled = false;
        },

        disableCallbacks: function() {
          module.debug('Disabling all callbacks temporarily');
          disabled = true;
        },

        should: {
          trackChanges: function() {
            if(methodInvoked) {
              module.debug('One time query, no need to bind events');
              return false;
            }
            module.debug('Callbacks being attached');
            return true;
          }
        },

        setup: {
          cache: function() {
            module.cache = {
              occurred : {},
              screen   : {},
              element  : {},
            };
          },
          image: function() {
            var
              src = $module.data(metadata.src)
            ;
            if(src) {
              module.verbose('Lazy loading image', src);
              settings.once           = true;
              settings.observeChanges = false;

              // show when top visible
              settings.onOnScreen = function() {
                module.debug('Image on screen', element);
                module.precache(src, function() {
                  module.set.image(src, function() {
                    loadedCount++;
                    if(loadedCount == moduleCount) {
                      settings.onAllLoaded.call(this);
                    }
                    settings.onLoad.call(this);
                  });
                });
              };
            }
          },
          fixed: function() {
            module.debug('Setting up fixed');
            settings.once           = false;
            settings.observeChanges = false;
            settings.initialCheck   = true;
            settings.refreshOnLoad  = true;
            if(!parameters.transition) {
              settings.transition = false;
            }
            module.create.placeholder();
            module.debug('Added placeholder', $placeholder);
            settings.onTopPassed = function() {
              module.debug('Element passed, adding fixed position', $module);
              module.show.placeholder();
              module.set.fixed();
              if(settings.transition) {
                if($.fn.transition !== undefined) {
                  $module.transition(settings.transition, settings.duration);
                }
              }
            };
            settings.onTopPassedReverse = function() {
              module.debug('Element returned to position, removing fixed', $module);
              module.hide.placeholder();
              module.remove.fixed();
            };
          }
        },

        create: {
          placeholder: function() {
            module.verbose('Creating fixed position placeholder');
            $placeholder = $module
              .clone(false)
              .css('display', 'none')
              .addClass(className.placeholder)
              .insertAfter($module)
            ;
          }
        },

        show: {
          placeholder: function() {
            module.verbose('Showing placeholder');
            $placeholder
              .css('display', 'block')
              .css('visibility', 'hidden')
            ;
          }
        },
        hide: {
          placeholder: function() {
            module.verbose('Hiding placeholder');
            $placeholder
              .css('display', 'none')
              .css('visibility', '')
            ;
          }
        },

        set: {
          fixed: function() {
            module.verbose('Setting element to fixed position');
            $module
              .addClass(className.fixed)
              .css({
                position : 'fixed',
                top      : settings.offset + 'px',
                left     : 'auto',
                zIndex   : settings.zIndex
              })
            ;
            settings.onFixed.call(element);
          },
          image: function(src, callback) {
            $module
              .attr('src', src)
            ;
            if(settings.transition) {
              if( $.fn.transition !== undefined) {
                if($module.hasClass(className.visible)) {
                  module.debug('Transition already occurred on this image, skipping animation');
                  return;
                }
                $module.transition(settings.transition, settings.duration, callback);
              }
              else {
                $module.fadeIn(settings.duration, callback);
              }
            }
            else {
              $module.show();
            }
          }
        },

        is: {
          onScreen: function() {
            var
              calculations   = module.get.elementCalculations()
            ;
            return calculations.onScreen;
          },
          offScreen: function() {
            var
              calculations   = module.get.elementCalculations()
            ;
            return calculations.offScreen;
          },
          visible: function() {
            if(module.cache && module.cache.element) {
              return !(module.cache.element.width === 0 && module.cache.element.offset.top === 0);
            }
            return false;
          },
          verticallyScrollableContext: function() {
            var
              overflowY = ($context.get(0) !== window)
                ? $context.css('overflow-y')
                : false
            ;
            return (overflowY == 'auto' || overflowY == 'scroll');
          },
          horizontallyScrollableContext: function() {
            var
              overflowX = ($context.get(0) !== window)
                ? $context.css('overflow-x')
                : false
            ;
            return (overflowX == 'auto' || overflowX == 'scroll');
          }
        },

        refresh: function() {
          module.debug('Refreshing constants (width/height)');
          if(settings.type == 'fixed') {
            module.resetFixed();
          }
          module.reset();
          module.save.position();
          if(settings.checkOnRefresh) {
            module.checkVisibility();
          }
          settings.onRefresh.call(element);
        },

        resetFixed: function () {
          module.remove.fixed();
          module.remove.occurred();
        },

        reset: function() {
          module.verbose('Resetting all cached values');
          if( $.isPlainObject(module.cache) ) {
            module.cache.screen = {};
            module.cache.element = {};
          }
        },

        checkVisibility: function(scroll) {
          module.verbose('Checking visibility of element', module.cache.element);

          if( !disabled && module.is.visible() ) {

            // save scroll position
            module.save.scroll(scroll);

            // update calculations derived from scroll
            module.save.calculations();

            // percentage
            module.passed();

            // reverse (must be first)
            module.passingReverse();
            module.topVisibleReverse();
            module.bottomVisibleReverse();
            module.topPassedReverse();
            module.bottomPassedReverse();

            // one time
            module.onScreen();
            module.offScreen();
            module.passing();
            module.topVisible();
            module.bottomVisible();
            module.topPassed();
            module.bottomPassed();

            // on update callback
            if(settings.onUpdate) {
              settings.onUpdate.call(element, module.get.elementCalculations());
            }
          }
        },

        passed: function(amount, newCallback) {
          var
            calculations   = module.get.elementCalculations(),
            amountInPixels
          ;
          // assign callback
          if(amount && newCallback) {
            settings.onPassed[amount] = newCallback;
          }
          else if(amount !== undefined) {
            return (module.get.pixelsPassed(amount) > calculations.pixelsPassed);
          }
          else if(calculations.passing) {
            $.each(settings.onPassed, function(amount, callback) {
              if(calculations.bottomVisible || calculations.pixelsPassed > module.get.pixelsPassed(amount)) {
                module.execute(callback, amount);
              }
              else if(!settings.once) {
                module.remove.occurred(callback);
              }
            });
          }
        },

        onScreen: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onOnScreen,
            callbackName = 'onScreen'
          ;
          if(newCallback) {
            module.debug('Adding callback for onScreen', newCallback);
            settings.onOnScreen = newCallback;
          }
          if(calculations.onScreen) {
            module.execute(callback, callbackName);
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback !== undefined) {
            return calculations.onOnScreen;
          }
        },

        offScreen: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onOffScreen,
            callbackName = 'offScreen'
          ;
          if(newCallback) {
            module.debug('Adding callback for offScreen', newCallback);
            settings.onOffScreen = newCallback;
          }
          if(calculations.offScreen) {
            module.execute(callback, callbackName);
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback !== undefined) {
            return calculations.onOffScreen;
          }
        },

        passing: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onPassing,
            callbackName = 'passing'
          ;
          if(newCallback) {
            module.debug('Adding callback for passing', newCallback);
            settings.onPassing = newCallback;
          }
          if(calculations.passing) {
            module.execute(callback, callbackName);
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback !== undefined) {
            return calculations.passing;
          }
        },


        topVisible: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onTopVisible,
            callbackName = 'topVisible'
          ;
          if(newCallback) {
            module.debug('Adding callback for top visible', newCallback);
            settings.onTopVisible = newCallback;
          }
          if(calculations.topVisible) {
            module.execute(callback, callbackName);
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback === undefined) {
            return calculations.topVisible;
          }
        },

        bottomVisible: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onBottomVisible,
            callbackName = 'bottomVisible'
          ;
          if(newCallback) {
            module.debug('Adding callback for bottom visible', newCallback);
            settings.onBottomVisible = newCallback;
          }
          if(calculations.bottomVisible) {
            module.execute(callback, callbackName);
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback === undefined) {
            return calculations.bottomVisible;
          }
        },

        topPassed: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onTopPassed,
            callbackName = 'topPassed'
          ;
          if(newCallback) {
            module.debug('Adding callback for top passed', newCallback);
            settings.onTopPassed = newCallback;
          }
          if(calculations.topPassed) {
            module.execute(callback, callbackName);
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback === undefined) {
            return calculations.topPassed;
          }
        },

        bottomPassed: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onBottomPassed,
            callbackName = 'bottomPassed'
          ;
          if(newCallback) {
            module.debug('Adding callback for bottom passed', newCallback);
            settings.onBottomPassed = newCallback;
          }
          if(calculations.bottomPassed) {
            module.execute(callback, callbackName);
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback === undefined) {
            return calculations.bottomPassed;
          }
        },

        passingReverse: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onPassingReverse,
            callbackName = 'passingReverse'
          ;
          if(newCallback) {
            module.debug('Adding callback for passing reverse', newCallback);
            settings.onPassingReverse = newCallback;
          }
          if(!calculations.passing) {
            if(module.get.occurred('passing')) {
              module.execute(callback, callbackName);
            }
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback !== undefined) {
            return !calculations.passing;
          }
        },


        topVisibleReverse: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onTopVisibleReverse,
            callbackName = 'topVisibleReverse'
          ;
          if(newCallback) {
            module.debug('Adding callback for top visible reverse', newCallback);
            settings.onTopVisibleReverse = newCallback;
          }
          if(!calculations.topVisible) {
            if(module.get.occurred('topVisible')) {
              module.execute(callback, callbackName);
            }
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback === undefined) {
            return !calculations.topVisible;
          }
        },

        bottomVisibleReverse: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onBottomVisibleReverse,
            callbackName = 'bottomVisibleReverse'
          ;
          if(newCallback) {
            module.debug('Adding callback for bottom visible reverse', newCallback);
            settings.onBottomVisibleReverse = newCallback;
          }
          if(!calculations.bottomVisible) {
            if(module.get.occurred('bottomVisible')) {
              module.execute(callback, callbackName);
            }
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback === undefined) {
            return !calculations.bottomVisible;
          }
        },

        topPassedReverse: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onTopPassedReverse,
            callbackName = 'topPassedReverse'
          ;
          if(newCallback) {
            module.debug('Adding callback for top passed reverse', newCallback);
            settings.onTopPassedReverse = newCallback;
          }
          if(!calculations.topPassed) {
            if(module.get.occurred('topPassed')) {
              module.execute(callback, callbackName);
            }
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback === undefined) {
            return !calculations.onTopPassed;
          }
        },

        bottomPassedReverse: function(newCallback) {
          var
            calculations = module.get.elementCalculations(),
            callback     = newCallback || settings.onBottomPassedReverse,
            callbackName = 'bottomPassedReverse'
          ;
          if(newCallback) {
            module.debug('Adding callback for bottom passed reverse', newCallback);
            settings.onBottomPassedReverse = newCallback;
          }
          if(!calculations.bottomPassed) {
            if(module.get.occurred('bottomPassed')) {
              module.execute(callback, callbackName);
            }
          }
          else if(!settings.once) {
            module.remove.occurred(callbackName);
          }
          if(newCallback === undefined) {
            return !calculations.bottomPassed;
          }
        },

        execute: function(callback, callbackName) {
          var
            calculations = module.get.elementCalculations(),
            screen       = module.get.screenCalculations()
          ;
          callback = callback || false;
          if(callback) {
            if(settings.continuous) {
              module.debug('Callback being called continuously', callbackName, calculations);
              callback.call(element, calculations, screen);
            }
            else if(!module.get.occurred(callbackName)) {
              module.debug('Conditions met', callbackName, calculations);
              callback.call(element, calculations, screen);
            }
          }
          module.save.occurred(callbackName);
        },

        remove: {
          fixed: function() {
            module.debug('Removing fixed position');
            $module
              .removeClass(className.fixed)
              .css({
                position : '',
                top      : '',
                left     : '',
                zIndex   : ''
              })
            ;
            settings.onUnfixed.call(element);
          },
          placeholder: function() {
            module.debug('Removing placeholder content');
            if($placeholder) {
              $placeholder.remove();
            }
          },
          occurred: function(callback) {
            if(callback) {
              var
                occurred = module.cache.occurred
              ;
              if(occurred[callback] !== undefined && occurred[callback] === true) {
                module.debug('Callback can now be called again', callback);
                module.cache.occurred[callback] = false;
              }
            }
            else {
              module.cache.occurred = {};
            }
          }
        },

        save: {
          calculations: function() {
            module.verbose('Saving all calculations necessary to determine positioning');
            module.save.direction();
            module.save.screenCalculations();
            module.save.elementCalculations();
          },
          occurred: function(callback) {
            if(callback) {
              if(module.cache.occurred[callback] === undefined || (module.cache.occurred[callback] !== true)) {
                module.verbose('Saving callback occurred', callback);
                module.cache.occurred[callback] = true;
              }
            }
          },
          scroll: function(scrollPosition) {
            scrollPosition      = scrollPosition + settings.offset || $context.scrollTop() + settings.offset;
            module.cache.scroll = scrollPosition;
          },
          direction: function() {
            var
              scroll     = module.get.scroll(),
              lastScroll = module.get.lastScroll(),
              direction
            ;
            if(scroll > lastScroll && lastScroll) {
              direction = 'down';
            }
            else if(scroll < lastScroll && lastScroll) {
              direction = 'up';
            }
            else {
              direction = 'static';
            }
            module.cache.direction = direction;
            return module.cache.direction;
          },
          elementPosition: function() {
            var
              element = module.cache.element,
              screen  = module.get.screenSize()
            ;
            module.verbose('Saving element position');
            // (quicker than $.extend)
            element.fits          = (element.height < screen.height);
            element.offset        = $module.offset();
            element.width         = $module.outerWidth();
            element.height        = $module.outerHeight();
            // compensate for scroll in context
            if(module.is.verticallyScrollableContext()) {
              element.offset.top += $context.scrollTop() - $context.offset().top;
            }
            if(module.is.horizontallyScrollableContext()) {
              element.offset.left += $context.scrollLeft - $context.offset().left;
            }
            // store
            module.cache.element = element;
            return element;
          },
          elementCalculations: function() {
            var
              screen     = module.get.screenCalculations(),
              element    = module.get.elementPosition()
            ;
            // offset
            if(settings.includeMargin) {
              element.margin        = {};
              element.margin.top    = parseInt($module.css('margin-top'), 10);
              element.margin.bottom = parseInt($module.css('margin-bottom'), 10);
              element.top    = element.offset.top - element.margin.top;
              element.bottom = element.offset.top + element.height + element.margin.bottom;
            }
            else {
              element.top    = element.offset.top;
              element.bottom = element.offset.top + element.height;
            }

            // visibility
            element.topPassed        = (screen.top >= element.top);
            element.bottomPassed     = (screen.top >= element.bottom);
            element.topVisible       = (screen.bottom >= element.top) && !element.topPassed;
            element.bottomVisible    = (screen.bottom >= element.bottom) && !element.bottomPassed;
            element.pixelsPassed     = 0;
            element.percentagePassed = 0;

            // meta calculations
            element.onScreen  = ((element.topVisible || element.passing) && !element.bottomPassed);
            element.passing   = (element.topPassed && !element.bottomPassed);
            element.offScreen = (!element.onScreen);

            // passing calculations
            if(element.passing) {
              element.pixelsPassed     = (screen.top - element.top);
              element.percentagePassed = (screen.top - element.top) / element.height;
            }
            module.cache.element = element;
            module.verbose('Updated element calculations', element);
            return element;
          },
          screenCalculations: function() {
            var
              scroll = module.get.scroll()
            ;
            module.save.direction();
            module.cache.screen.top    = scroll;
            module.cache.screen.bottom = scroll + module.cache.screen.height;
            return module.cache.screen;
          },
          screenSize: function() {
            module.verbose('Saving window position');
            module.cache.screen = {
              height: $context.height()
            };
          },
          position: function() {
            module.save.screenSize();
            module.save.elementPosition();
          }
        },

        get: {
          pixelsPassed: function(amount) {
            var
              element = module.get.elementCalculations()
            ;
            if(amount.search('%') > -1) {
              return ( element.height * (parseInt(amount, 10) / 100) );
            }
            return parseInt(amount, 10);
          },
          occurred: function(callback) {
            return (module.cache.occurred !== undefined)
              ? module.cache.occurred[callback] || false
              : false
            ;
          },
          direction: function() {
            if(module.cache.direction === undefined) {
              module.save.direction();
            }
            return module.cache.direction;
          },
          elementPosition: function() {
            if(module.cache.element === undefined) {
              module.save.elementPosition();
            }
            return module.cache.element;
          },
          elementCalculations: function() {
            if(module.cache.element === undefined) {
              module.save.elementCalculations();
            }
            return module.cache.element;
          },
          screenCalculations: function() {
            if(module.cache.screen === undefined) {
              module.save.screenCalculations();
            }
            return module.cache.screen;
          },
          screenSize: function() {
            if(module.cache.screen === undefined) {
              module.save.screenSize();
            }
            return module.cache.screen;
          },
          scroll: function() {
            if(module.cache.scroll === undefined) {
              module.save.scroll();
            }
            return module.cache.scroll;
          },
          lastScroll: function() {
            if(module.cache.screen === undefined) {
              module.debug('First scroll event, no last scroll could be found');
              return false;
            }
            return module.cache.screen.top;
          }
        },

        setting: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, settings, name);
          }
          else if(value !== undefined) {
            settings[name] = value;
          }
          else {
            return settings[name];
          }
        },
        internal: function(name, value) {
          if( $.isPlainObject(name) ) {
            $.extend(true, module, name);
          }
          else if(value !== undefined) {
            module[name] = value;
          }
          else {
            return module[name];
          }
        },
        debug: function() {
          if(!settings.silent && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.debug = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.debug.apply(console, arguments);
            }
          }
        },
        verbose: function() {
          if(!settings.silent && settings.verbose && settings.debug) {
            if(settings.performance) {
              module.performance.log(arguments);
            }
            else {
              module.verbose = Function.prototype.bind.call(console.info, console, settings.name + ':');
              module.verbose.apply(console, arguments);
            }
          }
        },
        error: function() {
          if(!settings.silent) {
            module.error = Function.prototype.bind.call(console.error, console, settings.name + ':');
            module.error.apply(console, arguments);
          }
        },
        performance: {
          log: function(message) {
            var
              currentTime,
              executionTime,
              previousTime
            ;
            if(settings.performance) {
              currentTime   = new Date().getTime();
              previousTime  = time || currentTime;
              executionTime = currentTime - previousTime;
              time          = currentTime;
              performance.push({
                'Name'           : message[0],
                'Arguments'      : [].slice.call(message, 1) || '',
                'Element'        : element,
                'Execution Time' : executionTime
              });
            }
            clearTimeout(module.performance.timer);
            module.performance.timer = setTimeout(module.performance.display, 500);
          },
          display: function() {
            var
              title = settings.name + ':',
              totalTime = 0
            ;
            time = false;
            clearTimeout(module.performance.timer);
            $.each(performance, function(index, data) {
              totalTime += data['Execution Time'];
            });
            title += ' ' + totalTime + 'ms';
            if(moduleSelector) {
              title += ' \'' + moduleSelector + '\'';
            }
            if( (console.group !== undefined || console.table !== undefined) && performance.length > 0) {
              console.groupCollapsed(title);
              if(console.table) {
                console.table(performance);
              }
              else {
                $.each(performance, function(index, data) {
                  console.log(data['Name'] + ': ' + data['Execution Time']+'ms');
                });
              }
              console.groupEnd();
            }
            performance = [];
          }
        },
        invoke: function(query, passedArguments, context) {
          var
            object = instance,
            maxDepth,
            found,
            response
          ;
          passedArguments = passedArguments || queryArguments;
          context         = element         || context;
          if(typeof query == 'string' && object !== undefined) {
            query    = query.split(/[\. ]/);
            maxDepth = query.length - 1;
            $.each(query, function(depth, value) {
              var camelCaseValue = (depth != maxDepth)
                ? value + query[depth + 1].charAt(0).toUpperCase() + query[depth + 1].slice(1)
                : query
              ;
              if( $.isPlainObject( object[camelCaseValue] ) && (depth != maxDepth) ) {
                object = object[camelCaseValue];
              }
              else if( object[camelCaseValue] !== undefined ) {
                found = object[camelCaseValue];
                return false;
              }
              else if( $.isPlainObject( object[value] ) && (depth != maxDepth) ) {
                object = object[value];
              }
              else if( object[value] !== undefined ) {
                found = object[value];
                return false;
              }
              else {
                module.error(error.method, query);
                return false;
              }
            });
          }
          if ( $.isFunction( found ) ) {
            response = found.apply(context, passedArguments);
          }
          else if(found !== undefined) {
            response = found;
          }
          if($.isArray(returnedValue)) {
            returnedValue.push(response);
          }
          else if(returnedValue !== undefined) {
            returnedValue = [returnedValue, response];
          }
          else if(response !== undefined) {
            returnedValue = response;
          }
          return found;
        }
      };

      if(methodInvoked) {
        if(instance === undefined) {
          module.initialize();
        }
        instance.save.scroll();
        instance.save.calculations();
        module.invoke(query);
      }
      else {
        if(instance !== undefined) {
          instance.invoke('destroy');
        }
        module.initialize();
      }
    })
  ;

  return (returnedValue !== undefined)
    ? returnedValue
    : this
  ;
};

$.fn.visibility.settings = {

  name                   : 'Visibility',
  namespace              : 'visibility',

  debug                  : false,
  verbose                : false,
  performance            : true,

  // whether to use mutation observers to follow changes
  observeChanges         : true,

  // check position immediately on init
  initialCheck           : true,

  // whether to refresh calculations after all page images load
  refreshOnLoad          : true,

  // whether to refresh calculations after page resize event
  refreshOnResize        : true,

  // should call callbacks on refresh event (resize, etc)
  checkOnRefresh         : true,

  // callback should only occur one time
  once                   : true,

  // callback should fire continuously whe evaluates to true
  continuous             : false,

  // offset to use with scroll top
  offset                 : 0,

  // whether to include margin in elements position
  includeMargin          : false,

  // scroll context for visibility checks
  context                : window,

  // visibility check delay in ms (defaults to animationFrame)
  throttle               : false,

  // special visibility type (image, fixed)
  type                   : false,

  // z-index to use with visibility 'fixed'
  zIndex                 : '10',

  // image only animation settings
  transition             : 'fade in',
  duration               : 1000,

  // array of callbacks for percentage
  onPassed               : {},

  // standard callbacks
  onOnScreen             : false,
  onOffScreen            : false,
  onPassing              : false,
  onTopVisible           : false,
  onBottomVisible        : false,
  onTopPassed            : false,
  onBottomPassed         : false,

  // reverse callbacks
  onPassingReverse       : false,
  onTopVisibleReverse    : false,
  onBottomVisibleReverse : false,
  onTopPassedReverse     : false,
  onBottomPassedReverse  : false,

  // special callbacks for image
  onLoad                 : function() {},
  onAllLoaded            : function() {},

  // special callbacks for fixed position
  onFixed                : function() {},
  onUnfixed              : function() {},

  // utility callbacks
  onUpdate               : false, // disabled by default for performance
  onRefresh              : function(){},

  metadata : {
    src: 'src'
  },

  className: {
    fixed       : 'fixed',
    placeholder : 'placeholder',
    visible     : 'visible'
  },

  error : {
    method  : 'The method you called is not defined.',
    visible : 'Element is hidden, you must call refresh after element becomes visible'
  }

};

})( jQuery, window, document );


/***/ }),

/***/ 721:
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(__resourceQuery) {

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _regenerator = __webpack_require__(86);

var _regenerator2 = _interopRequireDefault(_regenerator);

var _asyncToGenerator2 = __webpack_require__(87);

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _getPrototypeOf = __webpack_require__(41);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(15);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(16);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(42);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(46);

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = __webpack_require__(17);

var _react2 = _interopRequireDefault(_react);

var _semanticUiReact = __webpack_require__(722);

var _factory = __webpack_require__(975);

var _factory2 = _interopRequireDefault(_factory);

__webpack_require__(1149);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _jsxFileName = '/Users/kosuke.muramatsu/Documents/test/Ethereum/kickstart/pages/index.js?entry';


var CampaignIndex = function (_Component) {
  (0, _inherits3.default)(CampaignIndex, _Component);

  function CampaignIndex() {
    (0, _classCallCheck3.default)(this, CampaignIndex);

    return (0, _possibleConstructorReturn3.default)(this, (CampaignIndex.__proto__ || (0, _getPrototypeOf2.default)(CampaignIndex)).apply(this, arguments));
  }

  (0, _createClass3.default)(CampaignIndex, [{
    key: 'renderCampaigns',
    value: function renderCampaigns() {
      var items = this.props.campaigns.map(function (address) {
        return {
          header: address,
          description: _react2.default.createElement('a', { href: '', __source: {
              fileName: _jsxFileName,
              lineNumber: 17
            }
          }, 'view campaign'),
          fluid: true
        };
      });

      return _react2.default.createElement(_semanticUiReact.Card.Group, { items: items, __source: {
          fileName: _jsxFileName,
          lineNumber: 22
        }
      });
    }
  }, {
    key: 'render',
    value: function render() {
      return _react2.default.createElement('div', {
        __source: {
          fileName: _jsxFileName,
          lineNumber: 26
        }
      }, this.renderCampaigns());
    }
  }], [{
    key: 'getInitialProps',
    value: function () {
      var _ref = (0, _asyncToGenerator3.default)( /*#__PURE__*/_regenerator2.default.mark(function _callee() {
        var campaigns;
        return _regenerator2.default.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                _context.next = 2;
                return _factory2.default.methods.getDeployedCampaigns().call();

              case 2:
                campaigns = _context.sent;
                return _context.abrupt('return', { campaigns: campaigns });

              case 4:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, this);
      }));

      function getInitialProps() {
        return _ref.apply(this, arguments);
      }

      return getInitialProps;
    }()
  }]);

  return CampaignIndex;
}(_react.Component);

exports.default = CampaignIndex;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhZ2VzL2luZGV4LmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwiQ29tcG9uZW50IiwiQ2FyZCIsImZhY3RvcnkiLCJDYW1wYWlnbkluZGV4IiwiaXRlbXMiLCJwcm9wcyIsImNhbXBhaWducyIsIm1hcCIsImhlYWRlciIsImFkZHJlc3MiLCJkZXNjcmlwdGlvbiIsImZsdWlkIiwicmVuZGVyQ2FtcGFpZ25zIiwibWV0aG9kcyIsImdldERlcGxveWVkQ2FtcGFpZ25zIiwiY2FsbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLEFBQU8sQUFBUzs7OztBQUNoQixBQUFTOztBQUNULEFBQU8sQUFBYTs7OztBQUNwQjs7Ozs7OztJQUVNLEE7Ozs7Ozs7Ozs7O3NDQU9jLEFBQ2hCO1VBQU0sYUFBUSxBQUFLLE1BQUwsQUFBVyxVQUFYLEFBQXFCLElBQUksbUJBQVcsQUFDaEQ7O2tCQUFPLEFBQ0csQUFDUjt1Q0FBYSxjQUFBLE9BQUcsTUFBSCxBQUFRO3dCQUFSOzBCQUFBO0FBQUE7V0FBQSxFQUZSLEFBRVEsQUFDYjtpQkFIRixBQUFPLEFBR0UsQUFFVjtBQUxRLEFBQ0w7QUFGSixBQUFjLEFBUWQsT0FSYzs7MkNBUVAsQUFBQyxzQkFBRCxBQUFNLFNBQU0sT0FBWixBQUFtQjtvQkFBbkI7c0JBQVAsQUFBTyxBQUNSO0FBRFE7T0FBQTs7Ozs2QkFHQSxBQUNQOzZCQUFPLGNBQUE7O29CQUFBO3NCQUFBLEFBQU07QUFBTjtBQUFBLE9BQUEsT0FBUCxBQUFPLEFBQU0sQUFBSyxBQUNuQjs7Ozs7Ozs7Ozs7O3VCQW5CeUIsa0JBQUEsQUFBUSxRQUFSLEFBQWdCLHVCQUFoQixBLEFBQXVDOzttQkFBekQ7QTtpREFFQyxFQUFFLFdBQUYsQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUppQixBLEFBd0I1Qjs7a0JBQUEsQUFBZSIsImZpbGUiOiJpbmRleC5qcz9lbnRyeSIsInNvdXJjZVJvb3QiOiIvVXNlcnMva29zdWtlLm11cmFtYXRzdS9Eb2N1bWVudHMvdGVzdC9FdGhlcmV1bS9raWNrc3RhcnQifQ==

 ;(function register() { /* react-hot-loader/webpack */ if (true) { if (typeof __REACT_HOT_LOADER__ === 'undefined') { return; } /* eslint-disable camelcase, no-undef */ var webpackExports = typeof __webpack_exports__ !== 'undefined' ? __webpack_exports__ : module.exports; /* eslint-enable camelcase, no-undef */ if (typeof webpackExports === 'function') { __REACT_HOT_LOADER__.register(webpackExports, 'module.exports', "/Users/kosuke.muramatsu/Documents/test/Ethereum/kickstart/pages/index.js"); return; } /* eslint-disable no-restricted-syntax */ for (var key in webpackExports) { /* eslint-enable no-restricted-syntax */ if (!Object.prototype.hasOwnProperty.call(webpackExports, key)) { continue; } var namedExport = void 0; try { namedExport = webpackExports[key]; } catch (err) { continue; } __REACT_HOT_LOADER__.register(namedExport, key, "/Users/kosuke.muramatsu/Documents/test/Ethereum/kickstart/pages/index.js"); } } })();
    (function (Component, route) {
      if (false) return
      if (false) return

      var qs = __webpack_require__(84)
      var params = qs.parse(__resourceQuery.slice(1))
      if (params.entry == null) return

      module.hot.accept()
      Component.__route = route

      if (module.hot.status() === 'idle') return

      var components = next.router.components
      for (var r in components) {
        if (!components.hasOwnProperty(r)) continue

        if (components[r].Component.__route === route) {
          next.router.update(r, Component)
        }
      }
    })(typeof __webpack_exports__ !== 'undefined' ? __webpack_exports__.default : (module.exports.default || module.exports), "/")
  
/* WEBPACK VAR INJECTION */}.call(exports, "?entry"))

/***/ })

})
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNS5lNmNhMzhkNjgwYmY2Y2I3YjNiZS5ob3QtdXBkYXRlLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3NlbWFudGljLXVpLWNzcy9zZW1hbnRpYy5qcz9iZjc1NWIxIiwid2VicGFjazovLy8uL3BhZ2VzP2Q1MzNkM2QiXSwic291cmNlc0NvbnRlbnQiOlsiIC8qXG4gKiAjIFNlbWFudGljIFVJIC0gMi40LjBcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9TZW1hbnRpYy1PcmcvU2VtYW50aWMtVUlcbiAqIGh0dHA6Ly93d3cuc2VtYW50aWMtdWkuY29tL1xuICpcbiAqIENvcHlyaWdodCAyMDE0IENvbnRyaWJ1dG9yc1xuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG4vKiFcbiAqICMgU2VtYW50aWMgVUkgMi40LjAgLSBTaXRlXG4gKiBodHRwOi8vZ2l0aHViLmNvbS9zZW1hbnRpYy1vcmcvc2VtYW50aWMtdWkvXG4gKlxuICpcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuICpcbiAqL1xuXG47KGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHtcblxuJC5zaXRlID0gJC5mbi5zaXRlID0gZnVuY3Rpb24ocGFyYW1ldGVycykge1xuICB2YXJcbiAgICB0aW1lICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgID0gW10sXG5cbiAgICBxdWVyeSAgICAgICAgICA9IGFyZ3VtZW50c1swXSxcbiAgICBtZXRob2RJbnZva2VkICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLFxuXG4gICAgc2V0dGluZ3MgICAgICAgID0gKCAkLmlzUGxhaW5PYmplY3QocGFyYW1ldGVycykgKVxuICAgICAgPyAkLmV4dGVuZCh0cnVlLCB7fSwgJC5zaXRlLnNldHRpbmdzLCBwYXJhbWV0ZXJzKVxuICAgICAgOiAkLmV4dGVuZCh7fSwgJC5zaXRlLnNldHRpbmdzKSxcblxuICAgIG5hbWVzcGFjZSAgICAgICA9IHNldHRpbmdzLm5hbWVzcGFjZSxcbiAgICBlcnJvciAgICAgICAgICAgPSBzZXR0aW5ncy5lcnJvcixcblxuICAgIGV2ZW50TmFtZXNwYWNlICA9ICcuJyArIG5hbWVzcGFjZSxcbiAgICBtb2R1bGVOYW1lc3BhY2UgPSAnbW9kdWxlLScgKyBuYW1lc3BhY2UsXG5cbiAgICAkZG9jdW1lbnQgICAgICAgPSAkKGRvY3VtZW50KSxcbiAgICAkbW9kdWxlICAgICAgICAgPSAkZG9jdW1lbnQsXG4gICAgZWxlbWVudCAgICAgICAgID0gdGhpcyxcbiAgICBpbnN0YW5jZSAgICAgICAgPSAkbW9kdWxlLmRhdGEobW9kdWxlTmFtZXNwYWNlKSxcblxuICAgIG1vZHVsZSxcbiAgICByZXR1cm5lZFZhbHVlXG4gIDtcbiAgbW9kdWxlID0ge1xuXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICBtb2R1bGUuaW5zdGFudGlhdGUoKTtcbiAgICB9LFxuXG4gICAgaW5zdGFudGlhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgbW9kdWxlLnZlcmJvc2UoJ1N0b3JpbmcgaW5zdGFuY2Ugb2Ygc2l0ZScsIG1vZHVsZSk7XG4gICAgICBpbnN0YW5jZSA9IG1vZHVsZTtcbiAgICAgICRtb2R1bGVcbiAgICAgICAgLmRhdGEobW9kdWxlTmFtZXNwYWNlLCBtb2R1bGUpXG4gICAgICA7XG4gICAgfSxcblxuICAgIG5vcm1hbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICBtb2R1bGUuZml4LmNvbnNvbGUoKTtcbiAgICAgIG1vZHVsZS5maXgucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCk7XG4gICAgfSxcblxuICAgIGZpeDoge1xuICAgICAgY29uc29sZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIG1vZHVsZS5kZWJ1ZygnTm9ybWFsaXppbmcgd2luZG93LmNvbnNvbGUnKTtcbiAgICAgICAgaWYgKGNvbnNvbGUgPT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLmxvZyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0NvbnNvbGUgbm90IGF2YWlsYWJsZSwgbm9ybWFsaXppbmcgZXZlbnRzJyk7XG4gICAgICAgICAgbW9kdWxlLmRpc2FibGUuY29uc29sZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgY29uc29sZS5ncm91cCA9PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgY29uc29sZS5ncm91cEVuZCA9PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgY29uc29sZS5ncm91cENvbGxhcHNlZCA9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdDb25zb2xlIGdyb3VwIG5vdCBhdmFpbGFibGUsIG5vcm1hbGl6aW5nIGV2ZW50cycpO1xuICAgICAgICAgIHdpbmRvdy5jb25zb2xlLmdyb3VwID0gZnVuY3Rpb24oKSB7fTtcbiAgICAgICAgICB3aW5kb3cuY29uc29sZS5ncm91cEVuZCA9IGZ1bmN0aW9uKCkge307XG4gICAgICAgICAgd2luZG93LmNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQgPSBmdW5jdGlvbigpIHt9O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgY29uc29sZS5tYXJrVGltZWxpbmUgPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTWFyayB0aW1lbGluZSBub3QgYXZhaWxhYmxlLCBub3JtYWxpemluZyBldmVudHMnKTtcbiAgICAgICAgICB3aW5kb3cuY29uc29sZS5tYXJrVGltZWxpbmUgPSBmdW5jdGlvbigpIHt9O1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgY29uc29sZUNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgbW9kdWxlLmRlYnVnKCdEaXNhYmxpbmcgcHJvZ3JhbW1hdGljIGNvbnNvbGUgY2xlYXJpbmcnKTtcbiAgICAgICAgd2luZG93LmNvbnNvbGUuY2xlYXIgPSBmdW5jdGlvbigpIHt9O1xuICAgICAgfSxcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZTogZnVuY3Rpb24oKSB7XG4gICAgICAgIG1vZHVsZS5kZWJ1ZygnTm9ybWFsaXppbmcgcmVxdWVzdEFuaW1hdGlvbkZyYW1lJyk7XG4gICAgICAgIGlmKHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUmVxdWVzdEFuaW1hdGlvbkZyYW1lIG5vdCBhdmFpbGFibGUsIG5vcm1hbGl6aW5nIGV2ZW50Jyk7XG4gICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgICAgICAgIHx8IHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgICAgICAgIHx8IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgICAgICAgIHx8IHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAgICAgICAgfHwgZnVuY3Rpb24oY2FsbGJhY2spIHsgc2V0VGltZW91dChjYWxsYmFjaywgMCk7IH1cbiAgICAgICAgICA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuXG4gICAgbW9kdWxlRXhpc3RzOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICByZXR1cm4gKCQuZm5bbmFtZV0gIT09IHVuZGVmaW5lZCAmJiAkLmZuW25hbWVdLnNldHRpbmdzICE9PSB1bmRlZmluZWQpO1xuICAgIH0sXG5cbiAgICBlbmFibGVkOiB7XG4gICAgICBtb2R1bGVzOiBmdW5jdGlvbihtb2R1bGVzKSB7XG4gICAgICAgIHZhclxuICAgICAgICAgIGVuYWJsZWRNb2R1bGVzID0gW11cbiAgICAgICAgO1xuICAgICAgICBtb2R1bGVzID0gbW9kdWxlcyB8fCBzZXR0aW5ncy5tb2R1bGVzO1xuICAgICAgICAkLmVhY2gobW9kdWxlcywgZnVuY3Rpb24oaW5kZXgsIG5hbWUpIHtcbiAgICAgICAgICBpZihtb2R1bGUubW9kdWxlRXhpc3RzKG5hbWUpKSB7XG4gICAgICAgICAgICBlbmFibGVkTW9kdWxlcy5wdXNoKG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBlbmFibGVkTW9kdWxlcztcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgZGlzYWJsZWQ6IHtcbiAgICAgIG1vZHVsZXM6IGZ1bmN0aW9uKG1vZHVsZXMpIHtcbiAgICAgICAgdmFyXG4gICAgICAgICAgZGlzYWJsZWRNb2R1bGVzID0gW11cbiAgICAgICAgO1xuICAgICAgICBtb2R1bGVzID0gbW9kdWxlcyB8fCBzZXR0aW5ncy5tb2R1bGVzO1xuICAgICAgICAkLmVhY2gobW9kdWxlcywgZnVuY3Rpb24oaW5kZXgsIG5hbWUpIHtcbiAgICAgICAgICBpZighbW9kdWxlLm1vZHVsZUV4aXN0cyhuYW1lKSkge1xuICAgICAgICAgICAgZGlzYWJsZWRNb2R1bGVzLnB1c2gobmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRpc2FibGVkTW9kdWxlcztcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgY2hhbmdlOiB7XG4gICAgICBzZXR0aW5nOiBmdW5jdGlvbihzZXR0aW5nLCB2YWx1ZSwgbW9kdWxlcywgbW9kaWZ5RXhpc3RpbmcpIHtcbiAgICAgICAgbW9kdWxlcyA9ICh0eXBlb2YgbW9kdWxlcyA9PT0gJ3N0cmluZycpXG4gICAgICAgICAgPyAobW9kdWxlcyA9PT0gJ2FsbCcpXG4gICAgICAgICAgICA/IHNldHRpbmdzLm1vZHVsZXNcbiAgICAgICAgICAgIDogW21vZHVsZXNdXG4gICAgICAgICAgOiBtb2R1bGVzIHx8IHNldHRpbmdzLm1vZHVsZXNcbiAgICAgICAgO1xuICAgICAgICBtb2RpZnlFeGlzdGluZyA9IChtb2RpZnlFeGlzdGluZyAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgID8gbW9kaWZ5RXhpc3RpbmdcbiAgICAgICAgICA6IHRydWVcbiAgICAgICAgO1xuICAgICAgICAkLmVhY2gobW9kdWxlcywgZnVuY3Rpb24oaW5kZXgsIG5hbWUpIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIG5hbWVzcGFjZSA9IChtb2R1bGUubW9kdWxlRXhpc3RzKG5hbWUpKVxuICAgICAgICAgICAgICA/ICQuZm5bbmFtZV0uc2V0dGluZ3MubmFtZXNwYWNlIHx8IGZhbHNlXG4gICAgICAgICAgICAgIDogdHJ1ZSxcbiAgICAgICAgICAgICRleGlzdGluZ01vZHVsZXNcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYobW9kdWxlLm1vZHVsZUV4aXN0cyhuYW1lKSkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0NoYW5naW5nIGRlZmF1bHQgc2V0dGluZycsIHNldHRpbmcsIHZhbHVlLCBuYW1lKTtcbiAgICAgICAgICAgICQuZm5bbmFtZV0uc2V0dGluZ3Nbc2V0dGluZ10gPSB2YWx1ZTtcbiAgICAgICAgICAgIGlmKG1vZGlmeUV4aXN0aW5nICYmIG5hbWVzcGFjZSkge1xuICAgICAgICAgICAgICAkZXhpc3RpbmdNb2R1bGVzID0gJCgnOmRhdGEobW9kdWxlLScgKyBuYW1lc3BhY2UgKyAnKScpO1xuICAgICAgICAgICAgICBpZigkZXhpc3RpbmdNb2R1bGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTW9kaWZ5aW5nIGV4aXN0aW5nIHNldHRpbmdzJywgJGV4aXN0aW5nTW9kdWxlcyk7XG4gICAgICAgICAgICAgICAgJGV4aXN0aW5nTW9kdWxlc1tuYW1lXSgnc2V0dGluZycsIHNldHRpbmcsIHZhbHVlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgc2V0dGluZ3M6IGZ1bmN0aW9uKG5ld1NldHRpbmdzLCBtb2R1bGVzLCBtb2RpZnlFeGlzdGluZykge1xuICAgICAgICBtb2R1bGVzID0gKHR5cGVvZiBtb2R1bGVzID09PSAnc3RyaW5nJylcbiAgICAgICAgICA/IFttb2R1bGVzXVxuICAgICAgICAgIDogbW9kdWxlcyB8fCBzZXR0aW5ncy5tb2R1bGVzXG4gICAgICAgIDtcbiAgICAgICAgbW9kaWZ5RXhpc3RpbmcgPSAobW9kaWZ5RXhpc3RpbmcgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICA/IG1vZGlmeUV4aXN0aW5nXG4gICAgICAgICAgOiB0cnVlXG4gICAgICAgIDtcbiAgICAgICAgJC5lYWNoKG1vZHVsZXMsIGZ1bmN0aW9uKGluZGV4LCBuYW1lKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAkZXhpc3RpbmdNb2R1bGVzXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKG1vZHVsZS5tb2R1bGVFeGlzdHMobmFtZSkpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdDaGFuZ2luZyBkZWZhdWx0IHNldHRpbmcnLCBuZXdTZXR0aW5ncywgbmFtZSk7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCAkLmZuW25hbWVdLnNldHRpbmdzLCBuZXdTZXR0aW5ncyk7XG4gICAgICAgICAgICBpZihtb2RpZnlFeGlzdGluZyAmJiBuYW1lc3BhY2UpIHtcbiAgICAgICAgICAgICAgJGV4aXN0aW5nTW9kdWxlcyA9ICQoJzpkYXRhKG1vZHVsZS0nICsgbmFtZXNwYWNlICsgJyknKTtcbiAgICAgICAgICAgICAgaWYoJGV4aXN0aW5nTW9kdWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ01vZGlmeWluZyBleGlzdGluZyBzZXR0aW5ncycsICRleGlzdGluZ01vZHVsZXMpO1xuICAgICAgICAgICAgICAgICRleGlzdGluZ01vZHVsZXNbbmFtZV0oJ3NldHRpbmcnLCBuZXdTZXR0aW5ncyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBlbmFibGU6IHtcbiAgICAgIGNvbnNvbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICBtb2R1bGUuY29uc29sZSh0cnVlKTtcbiAgICAgIH0sXG4gICAgICBkZWJ1ZzogZnVuY3Rpb24obW9kdWxlcywgbW9kaWZ5RXhpc3RpbmcpIHtcbiAgICAgICAgbW9kdWxlcyA9IG1vZHVsZXMgfHwgc2V0dGluZ3MubW9kdWxlcztcbiAgICAgICAgbW9kdWxlLmRlYnVnKCdFbmFibGluZyBkZWJ1ZyBmb3IgbW9kdWxlcycsIG1vZHVsZXMpO1xuICAgICAgICBtb2R1bGUuY2hhbmdlLnNldHRpbmcoJ2RlYnVnJywgdHJ1ZSwgbW9kdWxlcywgbW9kaWZ5RXhpc3RpbmcpO1xuICAgICAgfSxcbiAgICAgIHZlcmJvc2U6IGZ1bmN0aW9uKG1vZHVsZXMsIG1vZGlmeUV4aXN0aW5nKSB7XG4gICAgICAgIG1vZHVsZXMgPSBtb2R1bGVzIHx8IHNldHRpbmdzLm1vZHVsZXM7XG4gICAgICAgIG1vZHVsZS5kZWJ1ZygnRW5hYmxpbmcgdmVyYm9zZSBkZWJ1ZyBmb3IgbW9kdWxlcycsIG1vZHVsZXMpO1xuICAgICAgICBtb2R1bGUuY2hhbmdlLnNldHRpbmcoJ3ZlcmJvc2UnLCB0cnVlLCBtb2R1bGVzLCBtb2RpZnlFeGlzdGluZyk7XG4gICAgICB9XG4gICAgfSxcbiAgICBkaXNhYmxlOiB7XG4gICAgICBjb25zb2xlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgbW9kdWxlLmNvbnNvbGUoZmFsc2UpO1xuICAgICAgfSxcbiAgICAgIGRlYnVnOiBmdW5jdGlvbihtb2R1bGVzLCBtb2RpZnlFeGlzdGluZykge1xuICAgICAgICBtb2R1bGVzID0gbW9kdWxlcyB8fCBzZXR0aW5ncy5tb2R1bGVzO1xuICAgICAgICBtb2R1bGUuZGVidWcoJ0Rpc2FibGluZyBkZWJ1ZyBmb3IgbW9kdWxlcycsIG1vZHVsZXMpO1xuICAgICAgICBtb2R1bGUuY2hhbmdlLnNldHRpbmcoJ2RlYnVnJywgZmFsc2UsIG1vZHVsZXMsIG1vZGlmeUV4aXN0aW5nKTtcbiAgICAgIH0sXG4gICAgICB2ZXJib3NlOiBmdW5jdGlvbihtb2R1bGVzLCBtb2RpZnlFeGlzdGluZykge1xuICAgICAgICBtb2R1bGVzID0gbW9kdWxlcyB8fCBzZXR0aW5ncy5tb2R1bGVzO1xuICAgICAgICBtb2R1bGUuZGVidWcoJ0Rpc2FibGluZyB2ZXJib3NlIGRlYnVnIGZvciBtb2R1bGVzJywgbW9kdWxlcyk7XG4gICAgICAgIG1vZHVsZS5jaGFuZ2Uuc2V0dGluZygndmVyYm9zZScsIGZhbHNlLCBtb2R1bGVzLCBtb2RpZnlFeGlzdGluZyk7XG4gICAgICB9XG4gICAgfSxcblxuICAgIGNvbnNvbGU6IGZ1bmN0aW9uKGVuYWJsZSkge1xuICAgICAgaWYoZW5hYmxlKSB7XG4gICAgICAgIGlmKGluc3RhbmNlLmNhY2hlLmNvbnNvbGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5jb25zb2xlKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbW9kdWxlLmRlYnVnKCdSZXN0b3JpbmcgY29uc29sZSBmdW5jdGlvbicpO1xuICAgICAgICB3aW5kb3cuY29uc29sZSA9IGluc3RhbmNlLmNhY2hlLmNvbnNvbGU7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgbW9kdWxlLmRlYnVnKCdEaXNhYmxpbmcgY29uc29sZSBmdW5jdGlvbicpO1xuICAgICAgICBpbnN0YW5jZS5jYWNoZS5jb25zb2xlID0gd2luZG93LmNvbnNvbGU7XG4gICAgICAgIHdpbmRvdy5jb25zb2xlID0ge1xuICAgICAgICAgIGNsZWFyICAgICAgICAgIDogZnVuY3Rpb24oKXt9LFxuICAgICAgICAgIGVycm9yICAgICAgICAgIDogZnVuY3Rpb24oKXt9LFxuICAgICAgICAgIGdyb3VwICAgICAgICAgIDogZnVuY3Rpb24oKXt9LFxuICAgICAgICAgIGdyb3VwQ29sbGFwc2VkIDogZnVuY3Rpb24oKXt9LFxuICAgICAgICAgIGdyb3VwRW5kICAgICAgIDogZnVuY3Rpb24oKXt9LFxuICAgICAgICAgIGluZm8gICAgICAgICAgIDogZnVuY3Rpb24oKXt9LFxuICAgICAgICAgIGxvZyAgICAgICAgICAgIDogZnVuY3Rpb24oKXt9LFxuICAgICAgICAgIG1hcmtUaW1lbGluZSAgIDogZnVuY3Rpb24oKXt9LFxuICAgICAgICAgIHdhcm4gICAgICAgICAgIDogZnVuY3Rpb24oKXt9XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSxcblxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgbW9kdWxlLnZlcmJvc2UoJ0Rlc3Ryb3lpbmcgcHJldmlvdXMgc2l0ZSBmb3InLCAkbW9kdWxlKTtcbiAgICAgICRtb2R1bGVcbiAgICAgICAgLnJlbW92ZURhdGEobW9kdWxlTmFtZXNwYWNlKVxuICAgICAgO1xuICAgIH0sXG5cbiAgICBjYWNoZToge30sXG5cbiAgICBzZXR0aW5nOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgJC5leHRlbmQodHJ1ZSwgc2V0dGluZ3MsIG5hbWUpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHNldHRpbmdzW25hbWVdID0gdmFsdWU7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHNldHRpbmdzW25hbWVdO1xuICAgICAgfVxuICAgIH0sXG4gICAgaW50ZXJuYWw6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAkLmV4dGVuZCh0cnVlLCBtb2R1bGUsIG5hbWUpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG1vZHVsZVtuYW1lXSA9IHZhbHVlO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBtb2R1bGVbbmFtZV07XG4gICAgICB9XG4gICAgfSxcbiAgICBkZWJ1ZzogZnVuY3Rpb24oKSB7XG4gICAgICBpZihzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHZlcmJvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYoc2V0dGluZ3MudmVyYm9zZSAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5pbmZvLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZS5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICBtb2R1bGUuZXJyb3IgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuZXJyb3IsIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgbW9kdWxlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgfSxcbiAgICBwZXJmb3JtYW5jZToge1xuICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgIHZhclxuICAgICAgICAgIGN1cnJlbnRUaW1lLFxuICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgICAgcHJldmlvdXNUaW1lXG4gICAgICAgIDtcbiAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICBjdXJyZW50VGltZSAgID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgcHJldmlvdXNUaW1lICA9IHRpbWUgfHwgY3VycmVudFRpbWU7XG4gICAgICAgICAgZXhlY3V0aW9uVGltZSA9IGN1cnJlbnRUaW1lIC0gcHJldmlvdXNUaW1lO1xuICAgICAgICAgIHRpbWUgICAgICAgICAgPSBjdXJyZW50VGltZTtcbiAgICAgICAgICBwZXJmb3JtYW5jZS5wdXNoKHtcbiAgICAgICAgICAgICdFbGVtZW50JyAgICAgICAgOiBlbGVtZW50LFxuICAgICAgICAgICAgJ05hbWUnICAgICAgICAgICA6IG1lc3NhZ2VbMF0sXG4gICAgICAgICAgICAnQXJndW1lbnRzJyAgICAgIDogW10uc2xpY2UuY2FsbChtZXNzYWdlLCAxKSB8fCAnJyxcbiAgICAgICAgICAgICdFeGVjdXRpb24gVGltZScgOiBleGVjdXRpb25UaW1lXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lciA9IHNldFRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLmRpc3BsYXksIDUwMCk7XG4gICAgICB9LFxuICAgICAgZGlzcGxheTogZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhclxuICAgICAgICAgIHRpdGxlID0gc2V0dGluZ3MubmFtZSArICc6JyxcbiAgICAgICAgICB0b3RhbFRpbWUgPSAwXG4gICAgICAgIDtcbiAgICAgICAgdGltZSA9IGZhbHNlO1xuICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgIHRvdGFsVGltZSArPSBkYXRhWydFeGVjdXRpb24gVGltZSddO1xuICAgICAgICB9KTtcbiAgICAgICAgdGl0bGUgKz0gJyAnICsgdG90YWxUaW1lICsgJ21zJztcbiAgICAgICAgaWYoIChjb25zb2xlLmdyb3VwICE9PSB1bmRlZmluZWQgfHwgY29uc29sZS50YWJsZSAhPT0gdW5kZWZpbmVkKSAmJiBwZXJmb3JtYW5jZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgaWYoY29uc29sZS50YWJsZSkge1xuICAgICAgICAgICAgY29uc29sZS50YWJsZShwZXJmb3JtYW5jZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgIH1cbiAgICAgICAgcGVyZm9ybWFuY2UgPSBbXTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGludm9rZTogZnVuY3Rpb24ocXVlcnksIHBhc3NlZEFyZ3VtZW50cywgY29udGV4dCkge1xuICAgICAgdmFyXG4gICAgICAgIG9iamVjdCA9IGluc3RhbmNlLFxuICAgICAgICBtYXhEZXB0aCxcbiAgICAgICAgZm91bmQsXG4gICAgICAgIHJlc3BvbnNlXG4gICAgICA7XG4gICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICBjb250ZXh0ICAgICAgICAgPSBlbGVtZW50ICAgICAgICAgfHwgY29udGV4dDtcbiAgICAgIGlmKHR5cGVvZiBxdWVyeSA9PSAnc3RyaW5nJyAmJiBvYmplY3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgbWF4RGVwdGggPSBxdWVyeS5sZW5ndGggLSAxO1xuICAgICAgICAkLmVhY2gocXVlcnksIGZ1bmN0aW9uKGRlcHRoLCB2YWx1ZSkge1xuICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgID8gdmFsdWUgKyBxdWVyeVtkZXB0aCArIDFdLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcXVlcnlbZGVwdGggKyAxXS5zbGljZSgxKVxuICAgICAgICAgICAgOiBxdWVyeVxuICAgICAgICAgIDtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICkgJiYgKGRlcHRoICE9IG1heERlcHRoKSApIHtcbiAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFtjYW1lbENhc2VWYWx1ZV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoIG9iamVjdFtjYW1lbENhc2VWYWx1ZV0gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZiggJC5pc1BsYWluT2JqZWN0KCBvYmplY3RbdmFsdWVdICkgJiYgKGRlcHRoICE9IG1heERlcHRoKSApIHtcbiAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoIG9iamVjdFt2YWx1ZV0gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IubWV0aG9kLCBxdWVyeSk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCBmb3VuZCApICkge1xuICAgICAgICByZXNwb25zZSA9IGZvdW5kLmFwcGx5KGNvbnRleHQsIHBhc3NlZEFyZ3VtZW50cyk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmKGZvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmVzcG9uc2UgPSBmb3VuZDtcbiAgICAgIH1cbiAgICAgIGlmKCQuaXNBcnJheShyZXR1cm5lZFZhbHVlKSkge1xuICAgICAgICByZXR1cm5lZFZhbHVlLnB1c2gocmVzcG9uc2UpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZihyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IFtyZXR1cm5lZFZhbHVlLCByZXNwb25zZV07XG4gICAgICB9XG4gICAgICBlbHNlIGlmKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IHJlc3BvbnNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZvdW5kO1xuICAgIH1cbiAgfTtcblxuICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgaWYoaW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgbW9kdWxlLmluaXRpYWxpemUoKTtcbiAgICB9XG4gICAgbW9kdWxlLmludm9rZShxdWVyeSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYoaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbW9kdWxlLmRlc3Ryb3koKTtcbiAgICB9XG4gICAgbW9kdWxlLmluaXRpYWxpemUoKTtcbiAgfVxuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xufTtcblxuJC5zaXRlLnNldHRpbmdzID0ge1xuXG4gIG5hbWUgICAgICAgIDogJ1NpdGUnLFxuICBuYW1lc3BhY2UgICA6ICdzaXRlJyxcblxuICBlcnJvciA6IHtcbiAgICBjb25zb2xlIDogJ0NvbnNvbGUgY2Fubm90IGJlIHJlc3RvcmVkLCBtb3N0IGxpa2VseSBpdCB3YXMgb3ZlcndyaXR0ZW4gb3V0c2lkZSBvZiBtb2R1bGUnLFxuICAgIG1ldGhvZCA6ICdUaGUgbWV0aG9kIHlvdSBjYWxsZWQgaXMgbm90IGRlZmluZWQuJ1xuICB9LFxuXG4gIGRlYnVnICAgICAgIDogZmFsc2UsXG4gIHZlcmJvc2UgICAgIDogZmFsc2UsXG4gIHBlcmZvcm1hbmNlIDogdHJ1ZSxcblxuICBtb2R1bGVzOiBbXG4gICAgJ2FjY29yZGlvbicsXG4gICAgJ2FwaScsXG4gICAgJ2NoZWNrYm94JyxcbiAgICAnZGltbWVyJyxcbiAgICAnZHJvcGRvd24nLFxuICAgICdlbWJlZCcsXG4gICAgJ2Zvcm0nLFxuICAgICdtb2RhbCcsXG4gICAgJ25hZycsXG4gICAgJ3BvcHVwJyxcbiAgICAncmF0aW5nJyxcbiAgICAnc2hhcGUnLFxuICAgICdzaWRlYmFyJyxcbiAgICAnc3RhdGUnLFxuICAgICdzdGlja3knLFxuICAgICd0YWInLFxuICAgICd0cmFuc2l0aW9uJyxcbiAgICAndmlzaXQnLFxuICAgICd2aXNpYmlsaXR5J1xuICBdLFxuXG4gIHNpdGVOYW1lc3BhY2UgICA6ICdzaXRlJyxcbiAgbmFtZXNwYWNlU3R1YiAgIDoge1xuICAgIGNhY2hlICAgICA6IHt9LFxuICAgIGNvbmZpZyAgICA6IHt9LFxuICAgIHNlY3Rpb25zICA6IHt9LFxuICAgIHNlY3Rpb24gICA6IHt9LFxuICAgIHV0aWxpdGllcyA6IHt9XG4gIH1cblxufTtcblxuLy8gYWxsb3dzIGZvciBzZWxlY3Rpb24gb2YgZWxlbWVudHMgd2l0aCBkYXRhIGF0dHJpYnV0ZXNcbiQuZXh0ZW5kKCQuZXhwclsgXCI6XCIgXSwge1xuICBkYXRhOiAoJC5leHByLmNyZWF0ZVBzZXVkbylcbiAgICA/ICQuZXhwci5jcmVhdGVQc2V1ZG8oZnVuY3Rpb24oZGF0YU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVsZW0pIHtcbiAgICAgICAgICByZXR1cm4gISEkLmRhdGEoZWxlbSwgZGF0YU5hbWUpO1xuICAgICAgICB9O1xuICAgICAgfSlcbiAgICA6IGZ1bmN0aW9uKGVsZW0sIGksIG1hdGNoKSB7XG4gICAgICAvLyBzdXBwb3J0OiBqUXVlcnkgPCAxLjhcbiAgICAgIHJldHVybiAhISQuZGF0YShlbGVtLCBtYXRjaFsgMyBdKTtcbiAgICB9XG59KTtcblxuXG59KSggalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50ICk7XG5cbi8qIVxuICogIyBTZW1hbnRpYyBVSSAyLjQuMCAtIEZvcm0gVmFsaWRhdGlvblxuICogaHR0cDovL2dpdGh1Yi5jb20vc2VtYW50aWMtb3JnL3NlbWFudGljLXVpL1xuICpcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqXG4gKi9cblxuOyhmdW5jdGlvbiAoJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7XG5cbid1c2Ugc3RyaWN0Jztcblxud2luZG93ID0gKHR5cGVvZiB3aW5kb3cgIT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93Lk1hdGggPT0gTWF0aClcbiAgPyB3aW5kb3dcbiAgOiAodHlwZW9mIHNlbGYgIT0gJ3VuZGVmaW5lZCcgJiYgc2VsZi5NYXRoID09IE1hdGgpXG4gICAgPyBzZWxmXG4gICAgOiBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpXG47XG5cbiQuZm4uZm9ybSA9IGZ1bmN0aW9uKHBhcmFtZXRlcnMpIHtcbiAgdmFyXG4gICAgJGFsbE1vZHVsZXMgICAgICA9ICQodGhpcyksXG4gICAgbW9kdWxlU2VsZWN0b3IgICA9ICRhbGxNb2R1bGVzLnNlbGVjdG9yIHx8ICcnLFxuXG4gICAgdGltZSAgICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgICAgPSBbXSxcblxuICAgIHF1ZXJ5ICAgICAgICAgICAgPSBhcmd1bWVudHNbMF0sXG4gICAgbGVnYWN5UGFyYW1ldGVycyA9IGFyZ3VtZW50c1sxXSxcbiAgICBtZXRob2RJbnZva2VkICAgID0gKHR5cGVvZiBxdWVyeSA9PSAnc3RyaW5nJyksXG4gICAgcXVlcnlBcmd1bWVudHMgICA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcbiAgICByZXR1cm5lZFZhbHVlXG4gIDtcbiAgJGFsbE1vZHVsZXNcbiAgICAuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIHZhclxuICAgICAgICAkbW9kdWxlICAgICA9ICQodGhpcyksXG4gICAgICAgIGVsZW1lbnQgICAgID0gdGhpcyxcblxuICAgICAgICBmb3JtRXJyb3JzICA9IFtdLFxuICAgICAgICBrZXlIZWxkRG93biA9IGZhbHNlLFxuXG4gICAgICAgIC8vIHNldCBhdCBydW4tdGltZVxuICAgICAgICAkZmllbGQsXG4gICAgICAgICRncm91cCxcbiAgICAgICAgJG1lc3NhZ2UsXG4gICAgICAgICRwcm9tcHQsXG4gICAgICAgICRzdWJtaXQsXG4gICAgICAgICRjbGVhcixcbiAgICAgICAgJHJlc2V0LFxuXG4gICAgICAgIHNldHRpbmdzLFxuICAgICAgICB2YWxpZGF0aW9uLFxuXG4gICAgICAgIG1ldGFkYXRhLFxuICAgICAgICBzZWxlY3RvcixcbiAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICByZWdFeHAsXG4gICAgICAgIGVycm9yLFxuXG4gICAgICAgIG5hbWVzcGFjZSxcbiAgICAgICAgbW9kdWxlTmFtZXNwYWNlLFxuICAgICAgICBldmVudE5hbWVzcGFjZSxcblxuICAgICAgICBpbnN0YW5jZSxcbiAgICAgICAgbW9kdWxlXG4gICAgICA7XG5cbiAgICAgIG1vZHVsZSAgICAgID0ge1xuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgLy8gc2V0dGluZ3MgZ3JhYmJlZCBhdCBydW4gdGltZVxuICAgICAgICAgIG1vZHVsZS5nZXQuc2V0dGluZ3MoKTtcbiAgICAgICAgICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgICAgICAgICBpZihpbnN0YW5jZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5pbnN0YW50aWF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLmludm9rZShxdWVyeSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYoaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBpbnN0YW5jZS5pbnZva2UoJ2Rlc3Ryb3knKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdJbml0aWFsaXppbmcgZm9ybSB2YWxpZGF0aW9uJywgJG1vZHVsZSwgc2V0dGluZ3MpO1xuICAgICAgICAgICAgbW9kdWxlLmJpbmRFdmVudHMoKTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQuZGVmYXVsdHMoKTtcbiAgICAgICAgICAgIG1vZHVsZS5pbnN0YW50aWF0ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpbnN0YW50aWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1N0b3JpbmcgaW5zdGFuY2Ugb2YgbW9kdWxlJywgbW9kdWxlKTtcbiAgICAgICAgICBpbnN0YW5jZSA9IG1vZHVsZTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAuZGF0YShtb2R1bGVOYW1lc3BhY2UsIG1vZHVsZSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0Rlc3Ryb3lpbmcgcHJldmlvdXMgbW9kdWxlJywgaW5zdGFuY2UpO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmVFdmVudHMoKTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAucmVtb3ZlRGF0YShtb2R1bGVOYW1lc3BhY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZWZyZXNoaW5nIHNlbGVjdG9yIGNhY2hlJyk7XG4gICAgICAgICAgJGZpZWxkICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IuZmllbGQpO1xuICAgICAgICAgICRncm91cCAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLmdyb3VwKTtcbiAgICAgICAgICAkbWVzc2FnZSAgICA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5tZXNzYWdlKTtcbiAgICAgICAgICAkcHJvbXB0ICAgICA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5wcm9tcHQpO1xuXG4gICAgICAgICAgJHN1Ym1pdCAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3Iuc3VibWl0KTtcbiAgICAgICAgICAkY2xlYXIgICAgICA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5jbGVhcik7XG4gICAgICAgICAgJHJlc2V0ICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IucmVzZXQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHN1Ym1pdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1N1Ym1pdHRpbmcgZm9ybScsICRtb2R1bGUpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5zdWJtaXQoKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBhdHRhY2hFdmVudHM6IGZ1bmN0aW9uKHNlbGVjdG9yLCBhY3Rpb24pIHtcbiAgICAgICAgICBhY3Rpb24gPSBhY3Rpb24gfHwgJ3N1Ym1pdCc7XG4gICAgICAgICAgJChzZWxlY3RvcilcbiAgICAgICAgICAgIC5vbignY2xpY2snICsgZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgIG1vZHVsZVthY3Rpb25dKCk7XG4gICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBiaW5kRXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQXR0YWNoaW5nIGZvcm0gZXZlbnRzJyk7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLm9uKCdzdWJtaXQnICsgZXZlbnROYW1lc3BhY2UsIG1vZHVsZS52YWxpZGF0ZS5mb3JtKVxuICAgICAgICAgICAgLm9uKCdibHVyJyAgICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLmZpZWxkLCBtb2R1bGUuZXZlbnQuZmllbGQuYmx1cilcbiAgICAgICAgICAgIC5vbignY2xpY2snICArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5zdWJtaXQsIG1vZHVsZS5zdWJtaXQpXG4gICAgICAgICAgICAub24oJ2NsaWNrJyAgKyBldmVudE5hbWVzcGFjZSwgc2VsZWN0b3IucmVzZXQsIG1vZHVsZS5yZXNldClcbiAgICAgICAgICAgIC5vbignY2xpY2snICArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5jbGVhciwgbW9kdWxlLmNsZWFyKVxuICAgICAgICAgIDtcbiAgICAgICAgICBpZihzZXR0aW5ncy5rZXlib2FyZFNob3J0Y3V0cykge1xuICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAub24oJ2tleWRvd24nICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLmZpZWxkLCBtb2R1bGUuZXZlbnQuZmllbGQua2V5ZG93bilcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgICAgJGZpZWxkXG4gICAgICAgICAgICAuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgJGlucHV0ICAgICA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgdHlwZSAgICAgICA9ICRpbnB1dC5wcm9wKCd0eXBlJyksXG4gICAgICAgICAgICAgICAgaW5wdXRFdmVudCA9IG1vZHVsZS5nZXQuY2hhbmdlRXZlbnQodHlwZSwgJGlucHV0KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICQodGhpcylcbiAgICAgICAgICAgICAgICAub24oaW5wdXRFdmVudCArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuZmllbGQuY2hhbmdlKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBjbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJGZpZWxkXG4gICAgICAgICAgICAuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICRmaWVsZCAgICAgICA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgJGVsZW1lbnQgICAgID0gJGZpZWxkLnBhcmVudCgpLFxuICAgICAgICAgICAgICAgICRmaWVsZEdyb3VwICA9ICRmaWVsZC5jbG9zZXN0KCRncm91cCksXG4gICAgICAgICAgICAgICAgJHByb21wdCAgICAgID0gJGZpZWxkR3JvdXAuZmluZChzZWxlY3Rvci5wcm9tcHQpLFxuICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZSA9ICRmaWVsZC5kYXRhKG1ldGFkYXRhLmRlZmF1bHRWYWx1ZSkgfHwgJycsXG4gICAgICAgICAgICAgICAgaXNDaGVja2JveCAgID0gJGVsZW1lbnQuaXMoc2VsZWN0b3IudWlDaGVja2JveCksXG4gICAgICAgICAgICAgICAgaXNEcm9wZG93biAgID0gJGVsZW1lbnQuaXMoc2VsZWN0b3IudWlEcm9wZG93biksXG4gICAgICAgICAgICAgICAgaXNFcnJvcmVkICAgID0gJGZpZWxkR3JvdXAuaGFzQ2xhc3MoY2xhc3NOYW1lLmVycm9yKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKGlzRXJyb3JlZCkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZXNldHRpbmcgZXJyb3Igb24gZmllbGQnLCAkZmllbGRHcm91cCk7XG4gICAgICAgICAgICAgICAgJGZpZWxkR3JvdXAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmVycm9yKTtcbiAgICAgICAgICAgICAgICAkcHJvbXB0LnJlbW92ZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKGlzRHJvcGRvd24pIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVzZXR0aW5nIGRyb3Bkb3duIHZhbHVlJywgJGVsZW1lbnQsIGRlZmF1bHRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgJGVsZW1lbnQuZHJvcGRvd24oJ2NsZWFyJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZihpc0NoZWNrYm94KSB7XG4gICAgICAgICAgICAgICAgJGZpZWxkLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1Jlc2V0dGluZyBmaWVsZCB2YWx1ZScsICRmaWVsZCwgZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgICAgICAgICAkZmllbGQudmFsKCcnKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICRmaWVsZFxuICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAkZmllbGQgICAgICAgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICRlbGVtZW50ICAgICA9ICRmaWVsZC5wYXJlbnQoKSxcbiAgICAgICAgICAgICAgICAkZmllbGRHcm91cCAgPSAkZmllbGQuY2xvc2VzdCgkZ3JvdXApLFxuICAgICAgICAgICAgICAgICRwcm9tcHQgICAgICA9ICRmaWVsZEdyb3VwLmZpbmQoc2VsZWN0b3IucHJvbXB0KSxcbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWUgPSAkZmllbGQuZGF0YShtZXRhZGF0YS5kZWZhdWx0VmFsdWUpLFxuICAgICAgICAgICAgICAgIGlzQ2hlY2tib3ggICA9ICRlbGVtZW50LmlzKHNlbGVjdG9yLnVpQ2hlY2tib3gpLFxuICAgICAgICAgICAgICAgIGlzRHJvcGRvd24gICA9ICRlbGVtZW50LmlzKHNlbGVjdG9yLnVpRHJvcGRvd24pLFxuICAgICAgICAgICAgICAgIGlzRXJyb3JlZCAgICA9ICRmaWVsZEdyb3VwLmhhc0NsYXNzKGNsYXNzTmFtZS5lcnJvcilcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBpZihkZWZhdWx0VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZihpc0Vycm9yZWQpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVzZXR0aW5nIGVycm9yIG9uIGZpZWxkJywgJGZpZWxkR3JvdXApO1xuICAgICAgICAgICAgICAgICRmaWVsZEdyb3VwLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5lcnJvcik7XG4gICAgICAgICAgICAgICAgJHByb21wdC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZihpc0Ryb3Bkb3duKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1Jlc2V0dGluZyBkcm9wZG93biB2YWx1ZScsICRlbGVtZW50LCBkZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgICAgICRlbGVtZW50LmRyb3Bkb3duKCdyZXN0b3JlIGRlZmF1bHRzJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZihpc0NoZWNrYm94KSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1Jlc2V0dGluZyBjaGVja2JveCB2YWx1ZScsICRlbGVtZW50LCBkZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgICAgICRmaWVsZC5wcm9wKCdjaGVja2VkJywgZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVzZXR0aW5nIGZpZWxkIHZhbHVlJywgJGZpZWxkLCBkZWZhdWx0VmFsdWUpO1xuICAgICAgICAgICAgICAgICRmaWVsZC52YWwoZGVmYXVsdFZhbHVlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGV0ZXJtaW5lOiB7XG4gICAgICAgICAgaXNWYWxpZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgYWxsVmFsaWQgPSB0cnVlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkLmVhY2godmFsaWRhdGlvbiwgZnVuY3Rpb24oZmllbGROYW1lLCBmaWVsZCkge1xuICAgICAgICAgICAgICBpZiggISggbW9kdWxlLnZhbGlkYXRlLmZpZWxkKGZpZWxkLCBmaWVsZE5hbWUsIHRydWUpICkgKSB7XG4gICAgICAgICAgICAgICAgYWxsVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gYWxsVmFsaWQ7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGlzOiB7XG4gICAgICAgICAgYnJhY2tldGVkUnVsZTogZnVuY3Rpb24ocnVsZSkge1xuICAgICAgICAgICAgcmV0dXJuIChydWxlLnR5cGUgJiYgcnVsZS50eXBlLm1hdGNoKHNldHRpbmdzLnJlZ0V4cC5icmFja2V0KSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzaG9ydGhhbmRGaWVsZHM6IGZ1bmN0aW9uKGZpZWxkcykge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGZpZWxkS2V5cyA9IE9iamVjdC5rZXlzKGZpZWxkcyksXG4gICAgICAgICAgICAgIGZpcnN0UnVsZSA9IGZpZWxkc1tmaWVsZEtleXNbMF1dXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLmlzLnNob3J0aGFuZFJ1bGVzKGZpcnN0UnVsZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICAvLyBkdWNrIHR5cGUgcnVsZSB0ZXN0XG4gICAgICAgICAgc2hvcnRoYW5kUnVsZXM6IGZ1bmN0aW9uKHJ1bGVzKSB7XG4gICAgICAgICAgICByZXR1cm4gKHR5cGVvZiBydWxlcyA9PSAnc3RyaW5nJyB8fCAkLmlzQXJyYXkocnVsZXMpKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVtcHR5OiBmdW5jdGlvbigkZmllbGQpIHtcbiAgICAgICAgICAgIGlmKCEkZmllbGQgfHwgJGZpZWxkLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoJGZpZWxkLmlzKCdpbnB1dFt0eXBlPVwiY2hlY2tib3hcIl0nKSkge1xuICAgICAgICAgICAgICByZXR1cm4gISRmaWVsZC5pcygnOmNoZWNrZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gbW9kdWxlLmlzLmJsYW5rKCRmaWVsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBibGFuazogZnVuY3Rpb24oJGZpZWxkKSB7XG4gICAgICAgICAgICByZXR1cm4gJC50cmltKCRmaWVsZC52YWwoKSkgPT09ICcnO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsaWQ6IGZ1bmN0aW9uKGZpZWxkKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgYWxsVmFsaWQgPSB0cnVlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihmaWVsZCkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQ2hlY2tpbmcgaWYgZmllbGQgaXMgdmFsaWQnLCBmaWVsZCk7XG4gICAgICAgICAgICAgIHJldHVybiBtb2R1bGUudmFsaWRhdGUuZmllbGQodmFsaWRhdGlvbltmaWVsZF0sIGZpZWxkLCBmYWxzZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0NoZWNraW5nIGlmIGZvcm0gaXMgdmFsaWQnKTtcbiAgICAgICAgICAgICAgJC5lYWNoKHZhbGlkYXRpb24sIGZ1bmN0aW9uKGZpZWxkTmFtZSwgZmllbGQpIHtcbiAgICAgICAgICAgICAgICBpZiggIW1vZHVsZS5pcy52YWxpZChmaWVsZE5hbWUpICkge1xuICAgICAgICAgICAgICAgICAgYWxsVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICByZXR1cm4gYWxsVmFsaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZUV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLm9mZihldmVudE5hbWVzcGFjZSlcbiAgICAgICAgICA7XG4gICAgICAgICAgJGZpZWxkXG4gICAgICAgICAgICAub2ZmKGV2ZW50TmFtZXNwYWNlKVxuICAgICAgICAgIDtcbiAgICAgICAgICAkc3VibWl0XG4gICAgICAgICAgICAub2ZmKGV2ZW50TmFtZXNwYWNlKVxuICAgICAgICAgIDtcbiAgICAgICAgICAkZmllbGRcbiAgICAgICAgICAgIC5vZmYoZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50OiB7XG4gICAgICAgICAgZmllbGQ6IHtcbiAgICAgICAgICAgIGtleWRvd246IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICRmaWVsZCAgICAgICA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAga2V5ICAgICAgICAgID0gZXZlbnQud2hpY2gsXG4gICAgICAgICAgICAgICAgaXNJbnB1dCAgICAgID0gJGZpZWxkLmlzKHNlbGVjdG9yLmlucHV0KSxcbiAgICAgICAgICAgICAgICBpc0NoZWNrYm94ICAgPSAkZmllbGQuaXMoc2VsZWN0b3IuY2hlY2tib3gpLFxuICAgICAgICAgICAgICAgIGlzSW5Ecm9wZG93biA9ICgkZmllbGQuY2xvc2VzdChzZWxlY3Rvci51aURyb3Bkb3duKS5sZW5ndGggPiAwKSxcbiAgICAgICAgICAgICAgICBrZXlDb2RlICAgICAgPSB7XG4gICAgICAgICAgICAgICAgICBlbnRlciAgOiAxMyxcbiAgICAgICAgICAgICAgICAgIGVzY2FwZSA6IDI3XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCBrZXkgPT0ga2V5Q29kZS5lc2NhcGUpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRXNjYXBlIGtleSBwcmVzc2VkIGJsdXJyaW5nIGZpZWxkJyk7XG4gICAgICAgICAgICAgICAgJGZpZWxkXG4gICAgICAgICAgICAgICAgICAuYmx1cigpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKCFldmVudC5jdHJsS2V5ICYmIGtleSA9PSBrZXlDb2RlLmVudGVyICYmIGlzSW5wdXQgJiYgIWlzSW5Ecm9wZG93biAmJiAhaXNDaGVja2JveCkge1xuICAgICAgICAgICAgICAgIGlmKCFrZXlIZWxkRG93bikge1xuICAgICAgICAgICAgICAgICAgJGZpZWxkXG4gICAgICAgICAgICAgICAgICAgIC5vbmUoJ2tleXVwJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuZmllbGQua2V5dXApXG4gICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuc3VibWl0KCk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0VudGVyIHByZXNzZWQgb24gaW5wdXQgc3VibWl0dGluZyBmb3JtJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGtleUhlbGREb3duID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGtleXVwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAga2V5SGVsZERvd24gPSBmYWxzZTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBibHVyOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAkZmllbGQgICAgICAgICAgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICRmaWVsZEdyb3VwICAgICA9ICRmaWVsZC5jbG9zZXN0KCRncm91cCksXG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvblJ1bGVzID0gbW9kdWxlLmdldC52YWxpZGF0aW9uKCRmaWVsZClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBpZiggJGZpZWxkR3JvdXAuaGFzQ2xhc3MoY2xhc3NOYW1lLmVycm9yKSApIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JldmFsaWRhdGluZyBmaWVsZCcsICRmaWVsZCwgdmFsaWRhdGlvblJ1bGVzKTtcbiAgICAgICAgICAgICAgICBpZih2YWxpZGF0aW9uUnVsZXMpIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS52YWxpZGF0ZS5maWVsZCggdmFsaWRhdGlvblJ1bGVzICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoc2V0dGluZ3Mub24gPT0gJ2JsdXInKSB7XG4gICAgICAgICAgICAgICAgaWYodmFsaWRhdGlvblJ1bGVzKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUudmFsaWRhdGUuZmllbGQoIHZhbGlkYXRpb25SdWxlcyApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNoYW5nZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgJGZpZWxkICAgICAgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICRmaWVsZEdyb3VwID0gJGZpZWxkLmNsb3Nlc3QoJGdyb3VwKSxcbiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uUnVsZXMgPSBtb2R1bGUuZ2V0LnZhbGlkYXRpb24oJGZpZWxkKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKHZhbGlkYXRpb25SdWxlcyAmJiAoc2V0dGluZ3Mub24gPT0gJ2NoYW5nZScgfHwgKCAkZmllbGRHcm91cC5oYXNDbGFzcyhjbGFzc05hbWUuZXJyb3IpICYmIHNldHRpbmdzLnJldmFsaWRhdGUpICkpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnRpbWVyKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUudGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZXZhbGlkYXRpbmcgZmllbGQnLCAkZmllbGQsICBtb2R1bGUuZ2V0LnZhbGlkYXRpb24oJGZpZWxkKSk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUudmFsaWRhdGUuZmllbGQoIHZhbGlkYXRpb25SdWxlcyApO1xuICAgICAgICAgICAgICAgIH0sIHNldHRpbmdzLmRlbGF5KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIGdldDoge1xuICAgICAgICAgIGFuY2lsbGFyeVZhbHVlOiBmdW5jdGlvbihydWxlKSB7XG4gICAgICAgICAgICBpZighcnVsZS50eXBlIHx8ICghcnVsZS52YWx1ZSAmJiAhbW9kdWxlLmlzLmJyYWNrZXRlZFJ1bGUocnVsZSkpKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAocnVsZS52YWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICA/IHJ1bGUudmFsdWVcbiAgICAgICAgICAgICAgOiBydWxlLnR5cGUubWF0Y2goc2V0dGluZ3MucmVnRXhwLmJyYWNrZXQpWzFdICsgJydcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJ1bGVOYW1lOiBmdW5jdGlvbihydWxlKSB7XG4gICAgICAgICAgICBpZiggbW9kdWxlLmlzLmJyYWNrZXRlZFJ1bGUocnVsZSkgKSB7XG4gICAgICAgICAgICAgIHJldHVybiBydWxlLnR5cGUucmVwbGFjZShydWxlLnR5cGUubWF0Y2goc2V0dGluZ3MucmVnRXhwLmJyYWNrZXQpWzBdLCAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcnVsZS50eXBlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2hhbmdlRXZlbnQ6IGZ1bmN0aW9uKHR5cGUsICRpbnB1dCkge1xuICAgICAgICAgICAgaWYodHlwZSA9PSAnY2hlY2tib3gnIHx8IHR5cGUgPT0gJ3JhZGlvJyB8fCB0eXBlID09ICdoaWRkZW4nIHx8ICRpbnB1dC5pcygnc2VsZWN0JykpIHtcbiAgICAgICAgICAgICAgcmV0dXJuICdjaGFuZ2UnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBtb2R1bGUuZ2V0LmlucHV0RXZlbnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGlucHV0RXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpLm9uaW5wdXQgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyAnaW5wdXQnXG4gICAgICAgICAgICAgIDogKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jykub25wcm9wZXJ0eWNoYW5nZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgID8gJ3Byb3BlcnR5Y2hhbmdlJ1xuICAgICAgICAgICAgICAgIDogJ2tleXVwJ1xuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZmllbGRzRnJvbVNob3J0aGFuZDogZnVuY3Rpb24oZmllbGRzKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZnVsbEZpZWxkcyA9IHt9XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkLmVhY2goZmllbGRzLCBmdW5jdGlvbihuYW1lLCBydWxlcykge1xuICAgICAgICAgICAgICBpZih0eXBlb2YgcnVsZXMgPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBydWxlcyA9IFtydWxlc107XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZnVsbEZpZWxkc1tuYW1lXSA9IHtcbiAgICAgICAgICAgICAgICBydWxlczogW11cbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgJC5lYWNoKHJ1bGVzLCBmdW5jdGlvbihpbmRleCwgcnVsZSkge1xuICAgICAgICAgICAgICAgIGZ1bGxGaWVsZHNbbmFtZV0ucnVsZXMucHVzaCh7IHR5cGU6IHJ1bGUgfSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZnVsbEZpZWxkcztcbiAgICAgICAgICB9LFxuICAgICAgICAgIHByb21wdDogZnVuY3Rpb24ocnVsZSwgZmllbGQpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBydWxlTmFtZSAgICAgID0gbW9kdWxlLmdldC5ydWxlTmFtZShydWxlKSxcbiAgICAgICAgICAgICAgYW5jaWxsYXJ5ICAgICA9IG1vZHVsZS5nZXQuYW5jaWxsYXJ5VmFsdWUocnVsZSksXG4gICAgICAgICAgICAgICRmaWVsZCAgICAgICAgPSBtb2R1bGUuZ2V0LmZpZWxkKGZpZWxkLmlkZW50aWZpZXIpLFxuICAgICAgICAgICAgICB2YWx1ZSAgICAgICAgID0gJGZpZWxkLnZhbCgpLFxuICAgICAgICAgICAgICBwcm9tcHQgICAgICAgID0gJC5pc0Z1bmN0aW9uKHJ1bGUucHJvbXB0KVxuICAgICAgICAgICAgICAgID8gcnVsZS5wcm9tcHQodmFsdWUpXG4gICAgICAgICAgICAgICAgOiBydWxlLnByb21wdCB8fCBzZXR0aW5ncy5wcm9tcHRbcnVsZU5hbWVdIHx8IHNldHRpbmdzLnRleHQudW5zcGVjaWZpZWRSdWxlLFxuICAgICAgICAgICAgICByZXF1aXJlc1ZhbHVlID0gKHByb21wdC5zZWFyY2goJ3t2YWx1ZX0nKSAhPT0gLTEpLFxuICAgICAgICAgICAgICByZXF1aXJlc05hbWUgID0gKHByb21wdC5zZWFyY2goJ3tuYW1lfScpICE9PSAtMSksXG4gICAgICAgICAgICAgICRsYWJlbCxcbiAgICAgICAgICAgICAgbmFtZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYocmVxdWlyZXNWYWx1ZSkge1xuICAgICAgICAgICAgICBwcm9tcHQgPSBwcm9tcHQucmVwbGFjZSgne3ZhbHVlfScsICRmaWVsZC52YWwoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihyZXF1aXJlc05hbWUpIHtcbiAgICAgICAgICAgICAgJGxhYmVsID0gJGZpZWxkLmNsb3Nlc3Qoc2VsZWN0b3IuZ3JvdXApLmZpbmQoJ2xhYmVsJykuZXEoMCk7XG4gICAgICAgICAgICAgIG5hbWUgPSAoJGxhYmVsLmxlbmd0aCA9PSAxKVxuICAgICAgICAgICAgICAgID8gJGxhYmVsLnRleHQoKVxuICAgICAgICAgICAgICAgIDogJGZpZWxkLnByb3AoJ3BsYWNlaG9sZGVyJykgfHwgc2V0dGluZ3MudGV4dC51bnNwZWNpZmllZEZpZWxkXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgcHJvbXB0ID0gcHJvbXB0LnJlcGxhY2UoJ3tuYW1lfScsIG5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcHJvbXB0ID0gcHJvbXB0LnJlcGxhY2UoJ3tpZGVudGlmaWVyfScsIGZpZWxkLmlkZW50aWZpZXIpO1xuICAgICAgICAgICAgcHJvbXB0ID0gcHJvbXB0LnJlcGxhY2UoJ3tydWxlVmFsdWV9JywgYW5jaWxsYXJ5KTtcbiAgICAgICAgICAgIGlmKCFydWxlLnByb21wdCkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnVXNpbmcgZGVmYXVsdCB2YWxpZGF0aW9uIHByb21wdCBmb3IgdHlwZScsIHByb21wdCwgcnVsZU5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHByb21wdDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNldHRpbmdzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCQuaXNQbGFpbk9iamVjdChwYXJhbWV0ZXJzKSkge1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICBrZXlzICAgICA9IE9iamVjdC5rZXlzKHBhcmFtZXRlcnMpLFxuICAgICAgICAgICAgICAgIGlzTGVnYWN5U2V0dGluZ3MgPSAoa2V5cy5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgICAgPyAocGFyYW1ldGVyc1trZXlzWzBdXS5pZGVudGlmaWVyICE9PSB1bmRlZmluZWQgJiYgcGFyYW1ldGVyc1trZXlzWzBdXS5ydWxlcyAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBydWxlS2V5c1xuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKGlzTGVnYWN5U2V0dGluZ3MpIHtcbiAgICAgICAgICAgICAgICAvLyAxLnggKGR1Y2t0eXBlZClcbiAgICAgICAgICAgICAgICBzZXR0aW5ncyAgID0gJC5leHRlbmQodHJ1ZSwge30sICQuZm4uZm9ybS5zZXR0aW5ncywgbGVnYWN5UGFyYW1ldGVycyk7XG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvbiA9ICQuZXh0ZW5kKHt9LCAkLmZuLmZvcm0uc2V0dGluZ3MuZGVmYXVsdHMsIHBhcmFtZXRlcnMpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihzZXR0aW5ncy5lcnJvci5vbGRTeW50YXgsIGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdFeHRlbmRpbmcgc2V0dGluZ3MgZnJvbSBsZWdhY3kgcGFyYW1ldGVycycsIHZhbGlkYXRpb24sIHNldHRpbmdzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyAyLnhcbiAgICAgICAgICAgICAgICBpZihwYXJhbWV0ZXJzLmZpZWxkcyAmJiBtb2R1bGUuaXMuc2hvcnRoYW5kRmllbGRzKHBhcmFtZXRlcnMuZmllbGRzKSkge1xuICAgICAgICAgICAgICAgICAgcGFyYW1ldGVycy5maWVsZHMgPSBtb2R1bGUuZ2V0LmZpZWxkc0Zyb21TaG9ydGhhbmQocGFyYW1ldGVycy5maWVsZHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXR0aW5ncyAgID0gJC5leHRlbmQodHJ1ZSwge30sICQuZm4uZm9ybS5zZXR0aW5ncywgcGFyYW1ldGVycyk7XG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvbiA9ICQuZXh0ZW5kKHt9LCAkLmZuLmZvcm0uc2V0dGluZ3MuZGVmYXVsdHMsIHNldHRpbmdzLmZpZWxkcyk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0V4dGVuZGluZyBzZXR0aW5ncycsIHZhbGlkYXRpb24sIHNldHRpbmdzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzICAgPSAkLmZuLmZvcm0uc2V0dGluZ3M7XG4gICAgICAgICAgICAgIHZhbGlkYXRpb24gPSAkLmZuLmZvcm0uc2V0dGluZ3MuZGVmYXVsdHM7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdVc2luZyBkZWZhdWx0IGZvcm0gdmFsaWRhdGlvbicsIHZhbGlkYXRpb24sIHNldHRpbmdzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2hvcnRoYW5kXG4gICAgICAgICAgICBuYW1lc3BhY2UgICAgICAgPSBzZXR0aW5ncy5uYW1lc3BhY2U7XG4gICAgICAgICAgICBtZXRhZGF0YSAgICAgICAgPSBzZXR0aW5ncy5tZXRhZGF0YTtcbiAgICAgICAgICAgIHNlbGVjdG9yICAgICAgICA9IHNldHRpbmdzLnNlbGVjdG9yO1xuICAgICAgICAgICAgY2xhc3NOYW1lICAgICAgID0gc2V0dGluZ3MuY2xhc3NOYW1lO1xuICAgICAgICAgICAgcmVnRXhwICAgICAgICAgID0gc2V0dGluZ3MucmVnRXhwO1xuICAgICAgICAgICAgZXJyb3IgICAgICAgICAgID0gc2V0dGluZ3MuZXJyb3I7XG4gICAgICAgICAgICBtb2R1bGVOYW1lc3BhY2UgPSAnbW9kdWxlLScgKyBuYW1lc3BhY2U7XG4gICAgICAgICAgICBldmVudE5hbWVzcGFjZSAgPSAnLicgKyBuYW1lc3BhY2U7XG5cbiAgICAgICAgICAgIC8vIGdyYWIgaW5zdGFuY2VcbiAgICAgICAgICAgIGluc3RhbmNlID0gJG1vZHVsZS5kYXRhKG1vZHVsZU5hbWVzcGFjZSk7XG5cbiAgICAgICAgICAgIC8vIHJlZnJlc2ggc2VsZWN0b3IgY2FjaGVcbiAgICAgICAgICAgIG1vZHVsZS5yZWZyZXNoKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmaWVsZDogZnVuY3Rpb24oaWRlbnRpZmllcikge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0ZpbmRpbmcgZmllbGQgd2l0aCBpZGVudGlmaWVyJywgaWRlbnRpZmllcik7XG4gICAgICAgICAgICBpZGVudGlmaWVyID0gbW9kdWxlLmVzY2FwZS5zdHJpbmcoaWRlbnRpZmllcik7XG4gICAgICAgICAgICBpZigkZmllbGQuZmlsdGVyKCcjJyArIGlkZW50aWZpZXIpLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgIHJldHVybiAkZmllbGQuZmlsdGVyKCcjJyArIGlkZW50aWZpZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiggJGZpZWxkLmZpbHRlcignW25hbWU9XCInICsgaWRlbnRpZmllciArJ1wiXScpLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgIHJldHVybiAkZmllbGQuZmlsdGVyKCdbbmFtZT1cIicgKyBpZGVudGlmaWVyICsnXCJdJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKCAkZmllbGQuZmlsdGVyKCdbbmFtZT1cIicgKyBpZGVudGlmaWVyICsnW11cIl0nKS5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgICByZXR1cm4gJGZpZWxkLmZpbHRlcignW25hbWU9XCInICsgaWRlbnRpZmllciArJ1tdXCJdJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKCAkZmllbGQuZmlsdGVyKCdbZGF0YS0nICsgbWV0YWRhdGEudmFsaWRhdGUgKyAnPVwiJysgaWRlbnRpZmllciArJ1wiXScpLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgIHJldHVybiAkZmllbGQuZmlsdGVyKCdbZGF0YS0nICsgbWV0YWRhdGEudmFsaWRhdGUgKyAnPVwiJysgaWRlbnRpZmllciArJ1wiXScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQoJzxpbnB1dC8+Jyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmaWVsZHM6IGZ1bmN0aW9uKGZpZWxkcykge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICRmaWVsZHMgPSAkKClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgICQuZWFjaChmaWVsZHMsIGZ1bmN0aW9uKGluZGV4LCBuYW1lKSB7XG4gICAgICAgICAgICAgICRmaWVsZHMgPSAkZmllbGRzLmFkZCggbW9kdWxlLmdldC5maWVsZChuYW1lKSApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gJGZpZWxkcztcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbGlkYXRpb246IGZ1bmN0aW9uKCRmaWVsZCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGZpZWxkVmFsaWRhdGlvbixcbiAgICAgICAgICAgICAgaWRlbnRpZmllclxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoIXZhbGlkYXRpb24pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5lYWNoKHZhbGlkYXRpb24sIGZ1bmN0aW9uKGZpZWxkTmFtZSwgZmllbGQpIHtcbiAgICAgICAgICAgICAgaWRlbnRpZmllciA9IGZpZWxkLmlkZW50aWZpZXIgfHwgZmllbGROYW1lO1xuICAgICAgICAgICAgICBpZiggbW9kdWxlLmdldC5maWVsZChpZGVudGlmaWVyKVswXSA9PSAkZmllbGRbMF0gKSB7XG4gICAgICAgICAgICAgICAgZmllbGQuaWRlbnRpZmllciA9IGlkZW50aWZpZXI7XG4gICAgICAgICAgICAgICAgZmllbGRWYWxpZGF0aW9uID0gZmllbGQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGZpZWxkVmFsaWRhdGlvbiB8fCBmYWxzZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiAoZmllbGQpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBmaWVsZHMgPSBbXSxcbiAgICAgICAgICAgICAgcmVzdWx0c1xuICAgICAgICAgICAgO1xuICAgICAgICAgICAgZmllbGRzLnB1c2goZmllbGQpO1xuICAgICAgICAgICAgcmVzdWx0cyA9IG1vZHVsZS5nZXQudmFsdWVzLmNhbGwoZWxlbWVudCwgZmllbGRzKTtcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRzW2ZpZWxkXTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlczogZnVuY3Rpb24gKGZpZWxkcykge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICRmaWVsZHMgPSAkLmlzQXJyYXkoZmllbGRzKVxuICAgICAgICAgICAgICAgID8gbW9kdWxlLmdldC5maWVsZHMoZmllbGRzKVxuICAgICAgICAgICAgICAgIDogJGZpZWxkLFxuICAgICAgICAgICAgICB2YWx1ZXMgPSB7fVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJGZpZWxkcy5lYWNoKGZ1bmN0aW9uKGluZGV4LCBmaWVsZCkge1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAkZmllbGQgICAgID0gJChmaWVsZCksXG4gICAgICAgICAgICAgICAgdHlwZSAgICAgICA9ICRmaWVsZC5wcm9wKCd0eXBlJyksXG4gICAgICAgICAgICAgICAgbmFtZSAgICAgICA9ICRmaWVsZC5wcm9wKCduYW1lJyksXG4gICAgICAgICAgICAgICAgdmFsdWUgICAgICA9ICRmaWVsZC52YWwoKSxcbiAgICAgICAgICAgICAgICBpc0NoZWNrYm94ID0gJGZpZWxkLmlzKHNlbGVjdG9yLmNoZWNrYm94KSxcbiAgICAgICAgICAgICAgICBpc1JhZGlvICAgID0gJGZpZWxkLmlzKHNlbGVjdG9yLnJhZGlvKSxcbiAgICAgICAgICAgICAgICBpc011bHRpcGxlID0gKG5hbWUuaW5kZXhPZignW10nKSAhPT0gLTEpLFxuICAgICAgICAgICAgICAgIGlzQ2hlY2tlZCAgPSAoaXNDaGVja2JveClcbiAgICAgICAgICAgICAgICAgID8gJGZpZWxkLmlzKCc6Y2hlY2tlZCcpXG4gICAgICAgICAgICAgICAgICA6IGZhbHNlXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYobmFtZSkge1xuICAgICAgICAgICAgICAgIGlmKGlzTXVsdGlwbGUpIHtcbiAgICAgICAgICAgICAgICAgIG5hbWUgPSBuYW1lLnJlcGxhY2UoJ1tdJywgJycpO1xuICAgICAgICAgICAgICAgICAgaWYoIXZhbHVlc1tuYW1lXSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbbmFtZV0gPSBbXTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGlmKGlzQ2hlY2tib3gpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoaXNDaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW25hbWVdLnB1c2godmFsdWUgfHwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW25hbWVdLnB1c2goZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW25hbWVdLnB1c2godmFsdWUpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGlmKGlzUmFkaW8pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYodmFsdWVzW25hbWVdID09PSB1bmRlZmluZWQgfHwgdmFsdWVzW25hbWVdID09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW25hbWVdID0gKGlzQ2hlY2tlZClcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdmFsdWUgfHwgdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSBpZihpc0NoZWNrYm94KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGlzQ2hlY2tlZCkge1xuICAgICAgICAgICAgICAgICAgICAgIHZhbHVlc1tuYW1lXSA9IHZhbHVlIHx8IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWVzW25hbWVdID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGFzOiB7XG5cbiAgICAgICAgICBmaWVsZDogZnVuY3Rpb24oaWRlbnRpZmllcikge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0NoZWNraW5nIGZvciBleGlzdGVuY2Ugb2YgYSBmaWVsZCB3aXRoIGlkZW50aWZpZXInLCBpZGVudGlmaWVyKTtcbiAgICAgICAgICAgIGlkZW50aWZpZXIgPSBtb2R1bGUuZXNjYXBlLnN0cmluZyhpZGVudGlmaWVyKTtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBpZGVudGlmaWVyICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IuaWRlbnRpZmllciwgaWRlbnRpZmllcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZigkZmllbGQuZmlsdGVyKCcjJyArIGlkZW50aWZpZXIpLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiggJGZpZWxkLmZpbHRlcignW25hbWU9XCInICsgaWRlbnRpZmllciArJ1wiXScpLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiggJGZpZWxkLmZpbHRlcignW2RhdGEtJyArIG1ldGFkYXRhLnZhbGlkYXRlICsgJz1cIicrIGlkZW50aWZpZXIgKydcIl0nKS5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBlc2NhcGU6IHtcbiAgICAgICAgICBzdHJpbmc6IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgICAgICAgIHRleHQgPSAgU3RyaW5nKHRleHQpO1xuICAgICAgICAgICAgcmV0dXJuIHRleHQucmVwbGFjZShyZWdFeHAuZXNjYXBlLCAnXFxcXCQmJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGFkZDoge1xuICAgICAgICAgIC8vIGFsaWFzXG4gICAgICAgICAgcnVsZTogZnVuY3Rpb24obmFtZSwgcnVsZXMpIHtcbiAgICAgICAgICAgIG1vZHVsZS5hZGQuZmllbGQobmFtZSwgcnVsZXMpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZmllbGQ6IGZ1bmN0aW9uKG5hbWUsIHJ1bGVzKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgbmV3VmFsaWRhdGlvbiA9IHt9XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMuc2hvcnRoYW5kUnVsZXMocnVsZXMpKSB7XG4gICAgICAgICAgICAgIHJ1bGVzID0gJC5pc0FycmF5KHJ1bGVzKVxuICAgICAgICAgICAgICAgID8gcnVsZXNcbiAgICAgICAgICAgICAgICA6IFtydWxlc11cbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBuZXdWYWxpZGF0aW9uW25hbWVdID0ge1xuICAgICAgICAgICAgICAgIHJ1bGVzOiBbXVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAkLmVhY2gocnVsZXMsIGZ1bmN0aW9uKGluZGV4LCBydWxlKSB7XG4gICAgICAgICAgICAgICAgbmV3VmFsaWRhdGlvbltuYW1lXS5ydWxlcy5wdXNoKHsgdHlwZTogcnVsZSB9KTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbmV3VmFsaWRhdGlvbltuYW1lXSA9IHJ1bGVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFsaWRhdGlvbiA9ICQuZXh0ZW5kKHt9LCB2YWxpZGF0aW9uLCBuZXdWYWxpZGF0aW9uKTtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIHJ1bGVzJywgbmV3VmFsaWRhdGlvbiwgdmFsaWRhdGlvbik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmaWVsZHM6IGZ1bmN0aW9uKGZpZWxkcykge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIG5ld1ZhbGlkYXRpb25cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKGZpZWxkcyAmJiBtb2R1bGUuaXMuc2hvcnRoYW5kRmllbGRzKGZpZWxkcykpIHtcbiAgICAgICAgICAgICAgbmV3VmFsaWRhdGlvbiA9IG1vZHVsZS5nZXQuZmllbGRzRnJvbVNob3J0aGFuZChmaWVsZHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG5ld1ZhbGlkYXRpb24gPSBmaWVsZHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YWxpZGF0aW9uID0gJC5leHRlbmQoe30sIHZhbGlkYXRpb24sIG5ld1ZhbGlkYXRpb24pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHJvbXB0OiBmdW5jdGlvbihpZGVudGlmaWVyLCBlcnJvcnMpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkZmllbGQgICAgICAgPSBtb2R1bGUuZ2V0LmZpZWxkKGlkZW50aWZpZXIpLFxuICAgICAgICAgICAgICAkZmllbGRHcm91cCAgPSAkZmllbGQuY2xvc2VzdCgkZ3JvdXApLFxuICAgICAgICAgICAgICAkcHJvbXB0ICAgICAgPSAkZmllbGRHcm91cC5jaGlsZHJlbihzZWxlY3Rvci5wcm9tcHQpLFxuICAgICAgICAgICAgICBwcm9tcHRFeGlzdHMgPSAoJHByb21wdC5sZW5ndGggIT09IDApXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBlcnJvcnMgPSAodHlwZW9mIGVycm9ycyA9PSAnc3RyaW5nJylcbiAgICAgICAgICAgICAgPyBbZXJyb3JzXVxuICAgICAgICAgICAgICA6IGVycm9yc1xuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FkZGluZyBmaWVsZCBlcnJvciBzdGF0ZScsIGlkZW50aWZpZXIpO1xuICAgICAgICAgICAgJGZpZWxkR3JvdXBcbiAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5lcnJvcilcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmlubGluZSkge1xuICAgICAgICAgICAgICBpZighcHJvbXB0RXhpc3RzKSB7XG4gICAgICAgICAgICAgICAgJHByb21wdCA9IHNldHRpbmdzLnRlbXBsYXRlcy5wcm9tcHQoZXJyb3JzKTtcbiAgICAgICAgICAgICAgICAkcHJvbXB0XG4gICAgICAgICAgICAgICAgICAuYXBwZW5kVG8oJGZpZWxkR3JvdXApXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICRwcm9tcHRcbiAgICAgICAgICAgICAgICAuaHRtbChlcnJvcnNbMF0pXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoIXByb21wdEV4aXN0cykge1xuICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLnRyYW5zaXRpb24gJiYgJC5mbi50cmFuc2l0aW9uICE9PSB1bmRlZmluZWQgJiYgJG1vZHVsZS50cmFuc2l0aW9uKCdpcyBzdXBwb3J0ZWQnKSkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0Rpc3BsYXlpbmcgZXJyb3Igd2l0aCBjc3MgdHJhbnNpdGlvbicsIHNldHRpbmdzLnRyYW5zaXRpb24pO1xuICAgICAgICAgICAgICAgICAgJHByb21wdC50cmFuc2l0aW9uKHNldHRpbmdzLnRyYW5zaXRpb24gKyAnIGluJywgc2V0dGluZ3MuZHVyYXRpb24pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEaXNwbGF5aW5nIGVycm9yIHdpdGggZmFsbGJhY2sgamF2YXNjcmlwdCBhbmltYXRpb24nKTtcbiAgICAgICAgICAgICAgICAgICRwcm9tcHRcbiAgICAgICAgICAgICAgICAgICAgLmZhZGVJbihzZXR0aW5ncy5kdXJhdGlvbilcbiAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0lubGluZSBlcnJvcnMgYXJlIGRpc2FibGVkLCBubyBpbmxpbmUgZXJyb3IgYWRkZWQnLCBpZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3JzOiBmdW5jdGlvbihlcnJvcnMpIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIGZvcm0gZXJyb3IgbWVzc2FnZXMnLCBlcnJvcnMpO1xuICAgICAgICAgICAgbW9kdWxlLnNldC5lcnJvcigpO1xuICAgICAgICAgICAgJG1lc3NhZ2VcbiAgICAgICAgICAgICAgLmh0bWwoIHNldHRpbmdzLnRlbXBsYXRlcy5lcnJvcihlcnJvcnMpIClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVtb3ZlOiB7XG4gICAgICAgICAgcnVsZTogZnVuY3Rpb24oZmllbGQsIHJ1bGUpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBydWxlcyA9ICQuaXNBcnJheShydWxlKVxuICAgICAgICAgICAgICAgID8gcnVsZVxuICAgICAgICAgICAgICAgIDogW3J1bGVdXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihydWxlID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JlbW92ZWQgYWxsIHJ1bGVzJyk7XG4gICAgICAgICAgICAgIHZhbGlkYXRpb25bZmllbGRdLnJ1bGVzID0gW107XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHZhbGlkYXRpb25bZmllbGRdID09IHVuZGVmaW5lZCB8fCAhJC5pc0FycmF5KHZhbGlkYXRpb25bZmllbGRdLnJ1bGVzKSkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkLmVhY2godmFsaWRhdGlvbltmaWVsZF0ucnVsZXMsIGZ1bmN0aW9uKGluZGV4LCBydWxlKSB7XG4gICAgICAgICAgICAgIGlmKHJ1bGVzLmluZGV4T2YocnVsZS50eXBlKSAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JlbW92ZWQgcnVsZScsIHJ1bGUudHlwZSk7XG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvbltmaWVsZF0ucnVsZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmaWVsZDogZnVuY3Rpb24oZmllbGQpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBmaWVsZHMgPSAkLmlzQXJyYXkoZmllbGQpXG4gICAgICAgICAgICAgICAgPyBmaWVsZFxuICAgICAgICAgICAgICAgIDogW2ZpZWxkXVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJC5lYWNoKGZpZWxkcywgZnVuY3Rpb24oaW5kZXgsIGZpZWxkKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUucnVsZShmaWVsZCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8vIGFsaWFzXG4gICAgICAgICAgcnVsZXM6IGZ1bmN0aW9uKGZpZWxkLCBydWxlcykge1xuICAgICAgICAgICAgaWYoJC5pc0FycmF5KGZpZWxkKSkge1xuICAgICAgICAgICAgICAkLmVhY2goZmllbGRzLCBmdW5jdGlvbihpbmRleCwgZmllbGQpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnJ1bGUoZmllbGQsIHJ1bGVzKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5ydWxlKGZpZWxkLCBydWxlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmaWVsZHM6IGZ1bmN0aW9uKGZpZWxkcykge1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5maWVsZChmaWVsZHMpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHJvbXB0OiBmdW5jdGlvbihpZGVudGlmaWVyKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJGZpZWxkICAgICAgPSBtb2R1bGUuZ2V0LmZpZWxkKGlkZW50aWZpZXIpLFxuICAgICAgICAgICAgICAkZmllbGRHcm91cCA9ICRmaWVsZC5jbG9zZXN0KCRncm91cCksXG4gICAgICAgICAgICAgICRwcm9tcHQgICAgID0gJGZpZWxkR3JvdXAuY2hpbGRyZW4oc2VsZWN0b3IucHJvbXB0KVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJGZpZWxkR3JvdXBcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5lcnJvcilcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmlubGluZSAmJiAkcHJvbXB0LmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyBwcm9tcHQgZm9yIGZpZWxkJywgaWRlbnRpZmllcik7XG4gICAgICAgICAgICAgIGlmKHNldHRpbmdzLnRyYW5zaXRpb24gJiYgJC5mbi50cmFuc2l0aW9uICE9PSB1bmRlZmluZWQgJiYgJG1vZHVsZS50cmFuc2l0aW9uKCdpcyBzdXBwb3J0ZWQnKSkge1xuICAgICAgICAgICAgICAgICRwcm9tcHQudHJhbnNpdGlvbihzZXR0aW5ncy50cmFuc2l0aW9uICsgJyBvdXQnLCBzZXR0aW5ncy5kdXJhdGlvbiwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAkcHJvbXB0LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICRwcm9tcHRcbiAgICAgICAgICAgICAgICAgIC5mYWRlT3V0KHNldHRpbmdzLmR1cmF0aW9uLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAkcHJvbXB0LnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiB7XG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuZXJyb3IpXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuc3VjY2VzcylcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRlZmF1bHRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkZmllbGRcbiAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICAgJGZpZWxkICAgICA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgICBpc0NoZWNrYm94ID0gKCRmaWVsZC5maWx0ZXIoc2VsZWN0b3IuY2hlY2tib3gpLmxlbmd0aCA+IDApLFxuICAgICAgICAgICAgICAgICAgdmFsdWUgICAgICA9IChpc0NoZWNrYm94KVxuICAgICAgICAgICAgICAgICAgICA/ICRmaWVsZC5pcygnOmNoZWNrZWQnKVxuICAgICAgICAgICAgICAgICAgICA6ICRmaWVsZC52YWwoKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAkZmllbGQuZGF0YShtZXRhZGF0YS5kZWZhdWx0VmFsdWUsIHZhbHVlKTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5zdWNjZXNzKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLmVycm9yKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIChmaWVsZCwgdmFsdWUpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBmaWVsZHMgPSB7fVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgZmllbGRzW2ZpZWxkXSA9IHZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS5zZXQudmFsdWVzLmNhbGwoZWxlbWVudCwgZmllbGRzKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlczogZnVuY3Rpb24gKGZpZWxkcykge1xuICAgICAgICAgICAgaWYoJC5pc0VtcHR5T2JqZWN0KGZpZWxkcykpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5lYWNoKGZpZWxkcywgZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAkZmllbGQgICAgICA9IG1vZHVsZS5nZXQuZmllbGQoa2V5KSxcbiAgICAgICAgICAgICAgICAkZWxlbWVudCAgICA9ICRmaWVsZC5wYXJlbnQoKSxcbiAgICAgICAgICAgICAgICBpc011bHRpcGxlICA9ICQuaXNBcnJheSh2YWx1ZSksXG4gICAgICAgICAgICAgICAgaXNDaGVja2JveCAgPSAkZWxlbWVudC5pcyhzZWxlY3Rvci51aUNoZWNrYm94KSxcbiAgICAgICAgICAgICAgICBpc0Ryb3Bkb3duICA9ICRlbGVtZW50LmlzKHNlbGVjdG9yLnVpRHJvcGRvd24pLFxuICAgICAgICAgICAgICAgIGlzUmFkaW8gICAgID0gKCRmaWVsZC5pcyhzZWxlY3Rvci5yYWRpbykgJiYgaXNDaGVja2JveCksXG4gICAgICAgICAgICAgICAgZmllbGRFeGlzdHMgPSAoJGZpZWxkLmxlbmd0aCA+IDApLFxuICAgICAgICAgICAgICAgICRtdWx0aXBsZUZpZWxkXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoZmllbGRFeGlzdHMpIHtcbiAgICAgICAgICAgICAgICBpZihpc011bHRpcGxlICYmIGlzQ2hlY2tib3gpIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTZWxlY3RpbmcgbXVsdGlwbGUnLCB2YWx1ZSwgJGZpZWxkKTtcbiAgICAgICAgICAgICAgICAgICRlbGVtZW50LmNoZWNrYm94KCd1bmNoZWNrJyk7XG4gICAgICAgICAgICAgICAgICAkLmVhY2godmFsdWUsIGZ1bmN0aW9uKGluZGV4LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAkbXVsdGlwbGVGaWVsZCA9ICRmaWVsZC5maWx0ZXIoJ1t2YWx1ZT1cIicgKyB2YWx1ZSArICdcIl0nKTtcbiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQgICAgICAgPSAkbXVsdGlwbGVGaWVsZC5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoJG11bHRpcGxlRmllbGQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICRlbGVtZW50LmNoZWNrYm94KCdjaGVjaycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZihpc1JhZGlvKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2VsZWN0aW5nIHJhZGlvIHZhbHVlJywgdmFsdWUsICRmaWVsZCk7XG4gICAgICAgICAgICAgICAgICAkZmllbGQuZmlsdGVyKCdbdmFsdWU9XCInICsgdmFsdWUgKyAnXCJdJylcbiAgICAgICAgICAgICAgICAgICAgLnBhcmVudChzZWxlY3Rvci51aUNoZWNrYm94KVxuICAgICAgICAgICAgICAgICAgICAgIC5jaGVja2JveCgnY2hlY2snKVxuICAgICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmKGlzQ2hlY2tib3gpIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTZXR0aW5nIGNoZWNrYm94IHZhbHVlJywgdmFsdWUsICRlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgIGlmKHZhbHVlID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICRlbGVtZW50LmNoZWNrYm94KCdjaGVjaycpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRlbGVtZW50LmNoZWNrYm94KCd1bmNoZWNrJyk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYoaXNEcm9wZG93bikge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NldHRpbmcgZHJvcGRvd24gdmFsdWUnLCB2YWx1ZSwgJGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgJGVsZW1lbnQuZHJvcGRvd24oJ3NldCBzZWxlY3RlZCcsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2V0dGluZyBmaWVsZCB2YWx1ZScsIHZhbHVlLCAkZmllbGQpO1xuICAgICAgICAgICAgICAgICAgJGZpZWxkLnZhbCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgdmFsaWRhdGU6IHtcblxuICAgICAgICAgIGZvcm06IGZ1bmN0aW9uKGV2ZW50LCBpZ25vcmVDYWxsYmFja3MpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB2YWx1ZXMgPSBtb2R1bGUuZ2V0LnZhbHVlcygpLFxuICAgICAgICAgICAgICBhcGlSZXF1ZXN0XG4gICAgICAgICAgICA7XG5cbiAgICAgICAgICAgIC8vIGlucHV0IGtleWRvd24gZXZlbnQgd2lsbCBmaXJlIHN1Ym1pdCByZXBlYXRlZGx5IGJ5IGJyb3dzZXIgZGVmYXVsdFxuICAgICAgICAgICAgaWYoa2V5SGVsZERvd24pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyByZXNldCBlcnJvcnNcbiAgICAgICAgICAgIGZvcm1FcnJvcnMgPSBbXTtcbiAgICAgICAgICAgIGlmKCBtb2R1bGUuZGV0ZXJtaW5lLmlzVmFsaWQoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdGb3JtIGhhcyBubyB2YWxpZGF0aW9uIGVycm9ycywgc3VibWl0dGluZycpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgICAgaWYoaWdub3JlQ2FsbGJhY2tzICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzLm9uU3VjY2Vzcy5jYWxsKGVsZW1lbnQsIGV2ZW50LCB2YWx1ZXMpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdGb3JtIGhhcyBlcnJvcnMnKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5lcnJvcigpO1xuICAgICAgICAgICAgICBpZighc2V0dGluZ3MuaW5saW5lKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmFkZC5lcnJvcnMoZm9ybUVycm9ycyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgLy8gcHJldmVudCBhamF4IHN1Ym1pdFxuICAgICAgICAgICAgICBpZigkbW9kdWxlLmRhdGEoJ21vZHVsZUFwaScpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZihpZ25vcmVDYWxsYmFja3MgIT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gc2V0dGluZ3Mub25GYWlsdXJlLmNhbGwoZWxlbWVudCwgZm9ybUVycm9ycywgdmFsdWVzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICAvLyB0YWtlcyBhIHZhbGlkYXRpb24gb2JqZWN0IGFuZCByZXR1cm5zIHdoZXRoZXIgZmllbGQgcGFzc2VzIHZhbGlkYXRpb25cbiAgICAgICAgICBmaWVsZDogZnVuY3Rpb24oZmllbGQsIGZpZWxkTmFtZSwgc2hvd0Vycm9ycykge1xuICAgICAgICAgICAgc2hvd0Vycm9ycyA9IChzaG93RXJyb3JzICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gc2hvd0Vycm9yc1xuICAgICAgICAgICAgICA6IHRydWVcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBmaWVsZCA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnVmFsaWRhdGluZyBmaWVsZCcsIGZpZWxkKTtcbiAgICAgICAgICAgICAgZmllbGROYW1lID0gZmllbGQ7XG4gICAgICAgICAgICAgIGZpZWxkICAgICA9IHZhbGlkYXRpb25bZmllbGRdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGlkZW50aWZpZXIgICAgPSBmaWVsZC5pZGVudGlmaWVyIHx8IGZpZWxkTmFtZSxcbiAgICAgICAgICAgICAgJGZpZWxkICAgICAgICA9IG1vZHVsZS5nZXQuZmllbGQoaWRlbnRpZmllciksXG4gICAgICAgICAgICAgICRkZXBlbmRzRmllbGQgPSAoZmllbGQuZGVwZW5kcylcbiAgICAgICAgICAgICAgICA/IG1vZHVsZS5nZXQuZmllbGQoZmllbGQuZGVwZW5kcylcbiAgICAgICAgICAgICAgICA6IGZhbHNlLFxuICAgICAgICAgICAgICBmaWVsZFZhbGlkICA9IHRydWUsXG4gICAgICAgICAgICAgIGZpZWxkRXJyb3JzID0gW11cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCFmaWVsZC5pZGVudGlmaWVyKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVXNpbmcgZmllbGQgbmFtZSBhcyBpZGVudGlmaWVyJywgaWRlbnRpZmllcik7XG4gICAgICAgICAgICAgIGZpZWxkLmlkZW50aWZpZXIgPSBpZGVudGlmaWVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoJGZpZWxkLnByb3AoJ2Rpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdGaWVsZCBpcyBkaXNhYmxlZC4gU2tpcHBpbmcnLCBpZGVudGlmaWVyKTtcbiAgICAgICAgICAgICAgZmllbGRWYWxpZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGZpZWxkLm9wdGlvbmFsICYmIG1vZHVsZS5pcy5ibGFuaygkZmllbGQpKXtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdGaWVsZCBpcyBvcHRpb25hbCBhbmQgYmxhbmsuIFNraXBwaW5nJywgaWRlbnRpZmllcik7XG4gICAgICAgICAgICAgIGZpZWxkVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihmaWVsZC5kZXBlbmRzICYmIG1vZHVsZS5pcy5lbXB0eSgkZGVwZW5kc0ZpZWxkKSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0ZpZWxkIGRlcGVuZHMgb24gYW5vdGhlciB2YWx1ZSB0aGF0IGlzIG5vdCBwcmVzZW50IG9yIGVtcHR5LiBTa2lwcGluZycsICRkZXBlbmRzRmllbGQpO1xuICAgICAgICAgICAgICBmaWVsZFZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoZmllbGQucnVsZXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAkLmVhY2goZmllbGQucnVsZXMsIGZ1bmN0aW9uKGluZGV4LCBydWxlKSB7XG4gICAgICAgICAgICAgICAgaWYoIG1vZHVsZS5oYXMuZmllbGQoaWRlbnRpZmllcikgJiYgISggbW9kdWxlLnZhbGlkYXRlLnJ1bGUoZmllbGQsIHJ1bGUpICkgKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0ZpZWxkIGlzIGludmFsaWQnLCBpZGVudGlmaWVyLCBydWxlLnR5cGUpO1xuICAgICAgICAgICAgICAgICAgZmllbGRFcnJvcnMucHVzaChtb2R1bGUuZ2V0LnByb21wdChydWxlLCBmaWVsZCkpO1xuICAgICAgICAgICAgICAgICAgZmllbGRWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihmaWVsZFZhbGlkKSB7XG4gICAgICAgICAgICAgIGlmKHNob3dFcnJvcnMpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnByb21wdChpZGVudGlmaWVyLCBmaWVsZEVycm9ycyk7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3Mub25WYWxpZC5jYWxsKCRmaWVsZCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBpZihzaG93RXJyb3JzKSB7XG4gICAgICAgICAgICAgICAgZm9ybUVycm9ycyA9IGZvcm1FcnJvcnMuY29uY2F0KGZpZWxkRXJyb3JzKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuYWRkLnByb21wdChpZGVudGlmaWVyLCBmaWVsZEVycm9ycyk7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3Mub25JbnZhbGlkLmNhbGwoJGZpZWxkLCBmaWVsZEVycm9ycyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIC8vIHRha2VzIHZhbGlkYXRpb24gcnVsZSBhbmQgcmV0dXJucyB3aGV0aGVyIGZpZWxkIHBhc3NlcyBydWxlXG4gICAgICAgICAgcnVsZTogZnVuY3Rpb24oZmllbGQsIHJ1bGUpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkZmllbGQgICAgICAgPSBtb2R1bGUuZ2V0LmZpZWxkKGZpZWxkLmlkZW50aWZpZXIpLFxuICAgICAgICAgICAgICB0eXBlICAgICAgICAgPSBydWxlLnR5cGUsXG4gICAgICAgICAgICAgIHZhbHVlICAgICAgICA9ICRmaWVsZC52YWwoKSxcbiAgICAgICAgICAgICAgaXNWYWxpZCAgICAgID0gdHJ1ZSxcbiAgICAgICAgICAgICAgYW5jaWxsYXJ5ICAgID0gbW9kdWxlLmdldC5hbmNpbGxhcnlWYWx1ZShydWxlKSxcbiAgICAgICAgICAgICAgcnVsZU5hbWUgICAgID0gbW9kdWxlLmdldC5ydWxlTmFtZShydWxlKSxcbiAgICAgICAgICAgICAgcnVsZUZ1bmN0aW9uID0gc2V0dGluZ3MucnVsZXNbcnVsZU5hbWVdXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZiggISQuaXNGdW5jdGlvbihydWxlRnVuY3Rpb24pICkge1xuICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3Iubm9SdWxlLCBydWxlTmFtZSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGNhc3QgdG8gc3RyaW5nIGF2b2lkaW5nIGVuY29kaW5nIHNwZWNpYWwgdmFsdWVzXG4gICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSAnJyB8fCB2YWx1ZSA9PT0gbnVsbClcbiAgICAgICAgICAgICAgPyAnJ1xuICAgICAgICAgICAgICA6ICQudHJpbSh2YWx1ZSArICcnKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgcmV0dXJuIHJ1bGVGdW5jdGlvbi5jYWxsKCRmaWVsZCwgdmFsdWUsIGFuY2lsbGFyeSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldHRpbmc6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBzZXR0aW5nc1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5nc1tuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGludGVybmFsOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBtb2R1bGUsIG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG1vZHVsZVtuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGVbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBkZWJ1ZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZyA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5pbmZvLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB2ZXJib3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLnZlcmJvc2UgJiYgc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5pbmZvLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50KSB7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuZXJyb3IsIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBwZXJmb3JtYW5jZToge1xuICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGN1cnJlbnRUaW1lLFxuICAgICAgICAgICAgICBleGVjdXRpb25UaW1lLFxuICAgICAgICAgICAgICBwcmV2aW91c1RpbWVcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRUaW1lICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgcHJldmlvdXNUaW1lICA9IHRpbWUgfHwgY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUgPSBjdXJyZW50VGltZSAtIHByZXZpb3VzVGltZTtcbiAgICAgICAgICAgICAgdGltZSAgICAgICAgICA9IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICBwZXJmb3JtYW5jZS5wdXNoKHtcbiAgICAgICAgICAgICAgICAnTmFtZScgICAgICAgICAgIDogbWVzc2FnZVswXSxcbiAgICAgICAgICAgICAgICAnQXJndW1lbnRzJyAgICAgIDogW10uc2xpY2UuY2FsbChtZXNzYWdlLCAxKSB8fCAnJyxcbiAgICAgICAgICAgICAgICAnRWxlbWVudCcgICAgICAgIDogZWxlbWVudCxcbiAgICAgICAgICAgICAgICAnRXhlY3V0aW9uIFRpbWUnIDogZXhlY3V0aW9uVGltZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyID0gc2V0VGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UuZGlzcGxheSwgNTAwKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpc3BsYXk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHRpdGxlID0gc2V0dGluZ3MubmFtZSArICc6JyxcbiAgICAgICAgICAgICAgdG90YWxUaW1lID0gMFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgdGltZSA9IGZhbHNlO1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgIHRvdGFsVGltZSArPSBkYXRhWydFeGVjdXRpb24gVGltZSddO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aXRsZSArPSAnICcgKyB0b3RhbFRpbWUgKyAnbXMnO1xuICAgICAgICAgICAgaWYobW9kdWxlU2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgdGl0bGUgKz0gJyBcXCcnICsgbW9kdWxlU2VsZWN0b3IgKyAnXFwnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCRhbGxNb2R1bGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgdGl0bGUgKz0gJyAnICsgJygnICsgJGFsbE1vZHVsZXMubGVuZ3RoICsgJyknO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIChjb25zb2xlLmdyb3VwICE9PSB1bmRlZmluZWQgfHwgY29uc29sZS50YWJsZSAhPT0gdW5kZWZpbmVkKSAmJiBwZXJmb3JtYW5jZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQodGl0bGUpO1xuICAgICAgICAgICAgICBpZihjb25zb2xlLnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS50YWJsZShwZXJmb3JtYW5jZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YVsnTmFtZSddICsgJzogJyArIGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ10rJ21zJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGVyZm9ybWFuY2UgPSBbXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGludm9rZTogZnVuY3Rpb24ocXVlcnksIHBhc3NlZEFyZ3VtZW50cywgY29udGV4dCkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgb2JqZWN0ID0gaW5zdGFuY2UsXG4gICAgICAgICAgICBtYXhEZXB0aCxcbiAgICAgICAgICAgIGZvdW5kLFxuICAgICAgICAgICAgcmVzcG9uc2VcbiAgICAgICAgICA7XG4gICAgICAgICAgcGFzc2VkQXJndW1lbnRzID0gcGFzc2VkQXJndW1lbnRzIHx8IHF1ZXJ5QXJndW1lbnRzO1xuICAgICAgICAgIGNvbnRleHQgICAgICAgICA9IGVsZW1lbnQgICAgICAgICB8fCBjb250ZXh0O1xuICAgICAgICAgIGlmKHR5cGVvZiBxdWVyeSA9PSAnc3RyaW5nJyAmJiBvYmplY3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcXVlcnkgICAgPSBxdWVyeS5zcGxpdCgvW1xcLiBdLyk7XG4gICAgICAgICAgICBtYXhEZXB0aCA9IHF1ZXJ5Lmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAkLmVhY2gocXVlcnksIGZ1bmN0aW9uKGRlcHRoLCB2YWx1ZSkge1xuICAgICAgICAgICAgICB2YXIgY2FtZWxDYXNlVmFsdWUgPSAoZGVwdGggIT0gbWF4RGVwdGgpXG4gICAgICAgICAgICAgICAgPyB2YWx1ZSArIHF1ZXJ5W2RlcHRoICsgMV0uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBxdWVyeVtkZXB0aCArIDFdLnNsaWNlKDEpXG4gICAgICAgICAgICAgICAgOiBxdWVyeVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFtjYW1lbENhc2VWYWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFtjYW1lbENhc2VWYWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggJC5pc1BsYWluT2JqZWN0KCBvYmplY3RbdmFsdWVdICkgJiYgKGRlcHRoICE9IG1heERlcHRoKSApIHtcbiAgICAgICAgICAgICAgICBvYmplY3QgPSBvYmplY3RbdmFsdWVdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoIG9iamVjdFt2YWx1ZV0gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCAkLmlzRnVuY3Rpb24oIGZvdW5kICkgKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGZvdW5kLmFwcGx5KGNvbnRleHQsIHBhc3NlZEFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoZm91bmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoJC5pc0FycmF5KHJldHVybmVkVmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlLnB1c2gocmVzcG9uc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IFtyZXR1cm5lZFZhbHVlLCByZXNwb25zZV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYocmVzcG9uc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IHJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZm91bmQ7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgIH0pXG4gIDtcblxuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xufTtcblxuJC5mbi5mb3JtLnNldHRpbmdzID0ge1xuXG4gIG5hbWUgICAgICAgICAgICAgIDogJ0Zvcm0nLFxuICBuYW1lc3BhY2UgICAgICAgICA6ICdmb3JtJyxcblxuICBkZWJ1ZyAgICAgICAgICAgICA6IGZhbHNlLFxuICB2ZXJib3NlICAgICAgICAgICA6IGZhbHNlLFxuICBwZXJmb3JtYW5jZSAgICAgICA6IHRydWUsXG5cbiAgZmllbGRzICAgICAgICAgICAgOiBmYWxzZSxcblxuICBrZXlib2FyZFNob3J0Y3V0cyA6IHRydWUsXG4gIG9uICAgICAgICAgICAgICAgIDogJ3N1Ym1pdCcsXG4gIGlubGluZSAgICAgICAgICAgIDogZmFsc2UsXG5cbiAgZGVsYXkgICAgICAgICAgICAgOiAyMDAsXG4gIHJldmFsaWRhdGUgICAgICAgIDogdHJ1ZSxcblxuICB0cmFuc2l0aW9uICAgICAgICA6ICdzY2FsZScsXG4gIGR1cmF0aW9uICAgICAgICAgIDogMjAwLFxuXG4gIG9uVmFsaWQgICAgICAgICAgIDogZnVuY3Rpb24oKSB7fSxcbiAgb25JbnZhbGlkICAgICAgICAgOiBmdW5jdGlvbigpIHt9LFxuICBvblN1Y2Nlc3MgICAgICAgICA6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdHJ1ZTsgfSxcbiAgb25GYWlsdXJlICAgICAgICAgOiBmdW5jdGlvbigpIHsgcmV0dXJuIGZhbHNlOyB9LFxuXG4gIG1ldGFkYXRhIDoge1xuICAgIGRlZmF1bHRWYWx1ZSA6ICdkZWZhdWx0JyxcbiAgICB2YWxpZGF0ZSAgICAgOiAndmFsaWRhdGUnXG4gIH0sXG5cbiAgcmVnRXhwOiB7XG4gICAgaHRtbElEICA6IC9eW2EtekEtWl1bXFx3Oi4tXSokL2csXG4gICAgYnJhY2tldCA6IC9cXFsoLiopXFxdL2ksXG4gICAgZGVjaW1hbCA6IC9eXFxkK1xcLj9cXGQqJC8sXG4gICAgZW1haWwgICA6IC9eW2EtejAtOSEjJCUmJyorXFwvPT9eX2B7fH1+Li1dK0BbYS16MC05XShbYS16MC05LV0qW2EtejAtOV0pPyhcXC5bYS16MC05XShbYS16MC05LV0qW2EtejAtOV0pPykqJC9pLFxuICAgIGVzY2FwZSAgOiAvW1xcLVxcW1xcXVxcL1xce1xcfVxcKFxcKVxcKlxcK1xcP1xcLlxcXFxcXF5cXCRcXHxdL2csXG4gICAgZmxhZ3MgICA6IC9eXFwvKC4qKVxcLyguKik/LyxcbiAgICBpbnRlZ2VyIDogL15cXC0/XFxkKyQvLFxuICAgIG51bWJlciAgOiAvXlxcLT9cXGQqKFxcLlxcZCspPyQvLFxuICAgIHVybCAgICAgOiAvKGh0dHBzPzpcXC9cXC8oPzp3d3dcXC58KD8hd3d3KSlbXlxcc1xcLl0rXFwuW15cXHNdezIsfXx3d3dcXC5bXlxcc10rXFwuW15cXHNdezIsfSkvaVxuICB9LFxuXG4gIHRleHQ6IHtcbiAgICB1bnNwZWNpZmllZFJ1bGUgIDogJ1BsZWFzZSBlbnRlciBhIHZhbGlkIHZhbHVlJyxcbiAgICB1bnNwZWNpZmllZEZpZWxkIDogJ1RoaXMgZmllbGQnXG4gIH0sXG5cbiAgcHJvbXB0OiB7XG4gICAgZW1wdHkgICAgICAgICAgICAgICAgOiAne25hbWV9IG11c3QgaGF2ZSBhIHZhbHVlJyxcbiAgICBjaGVja2VkICAgICAgICAgICAgICA6ICd7bmFtZX0gbXVzdCBiZSBjaGVja2VkJyxcbiAgICBlbWFpbCAgICAgICAgICAgICAgICA6ICd7bmFtZX0gbXVzdCBiZSBhIHZhbGlkIGUtbWFpbCcsXG4gICAgdXJsICAgICAgICAgICAgICAgICAgOiAne25hbWV9IG11c3QgYmUgYSB2YWxpZCB1cmwnLFxuICAgIHJlZ0V4cCAgICAgICAgICAgICAgIDogJ3tuYW1lfSBpcyBub3QgZm9ybWF0dGVkIGNvcnJlY3RseScsXG4gICAgaW50ZWdlciAgICAgICAgICAgICAgOiAne25hbWV9IG11c3QgYmUgYW4gaW50ZWdlcicsXG4gICAgZGVjaW1hbCAgICAgICAgICAgICAgOiAne25hbWV9IG11c3QgYmUgYSBkZWNpbWFsIG51bWJlcicsXG4gICAgbnVtYmVyICAgICAgICAgICAgICAgOiAne25hbWV9IG11c3QgYmUgc2V0IHRvIGEgbnVtYmVyJyxcbiAgICBpcyAgICAgICAgICAgICAgICAgICA6ICd7bmFtZX0gbXVzdCBiZSBcIntydWxlVmFsdWV9XCInLFxuICAgIGlzRXhhY3RseSAgICAgICAgICAgIDogJ3tuYW1lfSBtdXN0IGJlIGV4YWN0bHkgXCJ7cnVsZVZhbHVlfVwiJyxcbiAgICBub3QgICAgICAgICAgICAgICAgICA6ICd7bmFtZX0gY2Fubm90IGJlIHNldCB0byBcIntydWxlVmFsdWV9XCInLFxuICAgIG5vdEV4YWN0bHkgICAgICAgICAgIDogJ3tuYW1lfSBjYW5ub3QgYmUgc2V0IHRvIGV4YWN0bHkgXCJ7cnVsZVZhbHVlfVwiJyxcbiAgICBjb250YWluICAgICAgICAgICAgICA6ICd7bmFtZX0gbXVzdCBjb250YWluIFwie3J1bGVWYWx1ZX1cIicsXG4gICAgY29udGFpbkV4YWN0bHkgICAgICAgOiAne25hbWV9IG11c3QgY29udGFpbiBleGFjdGx5IFwie3J1bGVWYWx1ZX1cIicsXG4gICAgZG9lc250Q29udGFpbiAgICAgICAgOiAne25hbWV9IGNhbm5vdCBjb250YWluICBcIntydWxlVmFsdWV9XCInLFxuICAgIGRvZXNudENvbnRhaW5FeGFjdGx5IDogJ3tuYW1lfSBjYW5ub3QgY29udGFpbiBleGFjdGx5IFwie3J1bGVWYWx1ZX1cIicsXG4gICAgbWluTGVuZ3RoICAgICAgICAgICAgOiAne25hbWV9IG11c3QgYmUgYXQgbGVhc3Qge3J1bGVWYWx1ZX0gY2hhcmFjdGVycycsXG4gICAgbGVuZ3RoICAgICAgICAgICAgICAgOiAne25hbWV9IG11c3QgYmUgYXQgbGVhc3Qge3J1bGVWYWx1ZX0gY2hhcmFjdGVycycsXG4gICAgZXhhY3RMZW5ndGggICAgICAgICAgOiAne25hbWV9IG11c3QgYmUgZXhhY3RseSB7cnVsZVZhbHVlfSBjaGFyYWN0ZXJzJyxcbiAgICBtYXhMZW5ndGggICAgICAgICAgICA6ICd7bmFtZX0gY2Fubm90IGJlIGxvbmdlciB0aGFuIHtydWxlVmFsdWV9IGNoYXJhY3RlcnMnLFxuICAgIG1hdGNoICAgICAgICAgICAgICAgIDogJ3tuYW1lfSBtdXN0IG1hdGNoIHtydWxlVmFsdWV9IGZpZWxkJyxcbiAgICBkaWZmZXJlbnQgICAgICAgICAgICA6ICd7bmFtZX0gbXVzdCBoYXZlIGEgZGlmZmVyZW50IHZhbHVlIHRoYW4ge3J1bGVWYWx1ZX0gZmllbGQnLFxuICAgIGNyZWRpdENhcmQgICAgICAgICAgIDogJ3tuYW1lfSBtdXN0IGJlIGEgdmFsaWQgY3JlZGl0IGNhcmQgbnVtYmVyJyxcbiAgICBtaW5Db3VudCAgICAgICAgICAgICA6ICd7bmFtZX0gbXVzdCBoYXZlIGF0IGxlYXN0IHtydWxlVmFsdWV9IGNob2ljZXMnLFxuICAgIGV4YWN0Q291bnQgICAgICAgICAgIDogJ3tuYW1lfSBtdXN0IGhhdmUgZXhhY3RseSB7cnVsZVZhbHVlfSBjaG9pY2VzJyxcbiAgICBtYXhDb3VudCAgICAgICAgICAgICA6ICd7bmFtZX0gbXVzdCBoYXZlIHtydWxlVmFsdWV9IG9yIGxlc3MgY2hvaWNlcydcbiAgfSxcblxuICBzZWxlY3RvciA6IHtcbiAgICBjaGVja2JveCAgIDogJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXSwgaW5wdXRbdHlwZT1cInJhZGlvXCJdJyxcbiAgICBjbGVhciAgICAgIDogJy5jbGVhcicsXG4gICAgZmllbGQgICAgICA6ICdpbnB1dCwgdGV4dGFyZWEsIHNlbGVjdCcsXG4gICAgZ3JvdXAgICAgICA6ICcuZmllbGQnLFxuICAgIGlucHV0ICAgICAgOiAnaW5wdXQnLFxuICAgIG1lc3NhZ2UgICAgOiAnLmVycm9yLm1lc3NhZ2UnLFxuICAgIHByb21wdCAgICAgOiAnLnByb21wdC5sYWJlbCcsXG4gICAgcmFkaW8gICAgICA6ICdpbnB1dFt0eXBlPVwicmFkaW9cIl0nLFxuICAgIHJlc2V0ICAgICAgOiAnLnJlc2V0Om5vdChbdHlwZT1cInJlc2V0XCJdKScsXG4gICAgc3VibWl0ICAgICA6ICcuc3VibWl0Om5vdChbdHlwZT1cInN1Ym1pdFwiXSknLFxuICAgIHVpQ2hlY2tib3ggOiAnLnVpLmNoZWNrYm94JyxcbiAgICB1aURyb3Bkb3duIDogJy51aS5kcm9wZG93bidcbiAgfSxcblxuICBjbGFzc05hbWUgOiB7XG4gICAgZXJyb3IgICA6ICdlcnJvcicsXG4gICAgbGFiZWwgICA6ICd1aSBwcm9tcHQgbGFiZWwnLFxuICAgIHByZXNzZWQgOiAnZG93bicsXG4gICAgc3VjY2VzcyA6ICdzdWNjZXNzJ1xuICB9LFxuXG4gIGVycm9yOiB7XG4gICAgaWRlbnRpZmllciA6ICdZb3UgbXVzdCBzcGVjaWZ5IGEgc3RyaW5nIGlkZW50aWZpZXIgZm9yIGVhY2ggZmllbGQnLFxuICAgIG1ldGhvZCAgICAgOiAnVGhlIG1ldGhvZCB5b3UgY2FsbGVkIGlzIG5vdCBkZWZpbmVkLicsXG4gICAgbm9SdWxlICAgICA6ICdUaGVyZSBpcyBubyBydWxlIG1hdGNoaW5nIHRoZSBvbmUgeW91IHNwZWNpZmllZCcsXG4gICAgb2xkU3ludGF4ICA6ICdTdGFydGluZyBpbiAyLjAgZm9ybXMgbm93IG9ubHkgdGFrZSBhIHNpbmdsZSBzZXR0aW5ncyBvYmplY3QuIFZhbGlkYXRpb24gc2V0dGluZ3MgY29udmVydGVkIHRvIG5ldyBzeW50YXggYXV0b21hdGljYWxseS4nXG4gIH0sXG5cbiAgdGVtcGxhdGVzOiB7XG5cbiAgICAvLyB0ZW1wbGF0ZSB0aGF0IHByb2R1Y2VzIGVycm9yIG1lc3NhZ2VcbiAgICBlcnJvcjogZnVuY3Rpb24oZXJyb3JzKSB7XG4gICAgICB2YXJcbiAgICAgICAgaHRtbCA9ICc8dWwgY2xhc3M9XCJsaXN0XCI+J1xuICAgICAgO1xuICAgICAgJC5lYWNoKGVycm9ycywgZnVuY3Rpb24oaW5kZXgsIHZhbHVlKSB7XG4gICAgICAgIGh0bWwgKz0gJzxsaT4nICsgdmFsdWUgKyAnPC9saT4nO1xuICAgICAgfSk7XG4gICAgICBodG1sICs9ICc8L3VsPic7XG4gICAgICByZXR1cm4gJChodG1sKTtcbiAgICB9LFxuXG4gICAgLy8gdGVtcGxhdGUgdGhhdCBwcm9kdWNlcyBsYWJlbFxuICAgIHByb21wdDogZnVuY3Rpb24oZXJyb3JzKSB7XG4gICAgICByZXR1cm4gJCgnPGRpdi8+JylcbiAgICAgICAgLmFkZENsYXNzKCd1aSBiYXNpYyByZWQgcG9pbnRpbmcgcHJvbXB0IGxhYmVsJylcbiAgICAgICAgLmh0bWwoZXJyb3JzWzBdKVxuICAgICAgO1xuICAgIH1cbiAgfSxcblxuICBydWxlczoge1xuXG4gICAgLy8gaXMgbm90IGVtcHR5IG9yIGJsYW5rIHN0cmluZ1xuICAgIGVtcHR5OiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgcmV0dXJuICEodmFsdWUgPT09IHVuZGVmaW5lZCB8fCAnJyA9PT0gdmFsdWUgfHwgJC5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDApO1xuICAgIH0sXG5cbiAgICAvLyBjaGVja2JveCBjaGVja2VkXG4gICAgY2hlY2tlZDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gKCQodGhpcykuZmlsdGVyKCc6Y2hlY2tlZCcpLmxlbmd0aCA+IDApO1xuICAgIH0sXG5cbiAgICAvLyBpcyBtb3N0IGxpa2VseSBhbiBlbWFpbFxuICAgIGVtYWlsOiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICByZXR1cm4gJC5mbi5mb3JtLnNldHRpbmdzLnJlZ0V4cC5lbWFpbC50ZXN0KHZhbHVlKTtcbiAgICB9LFxuXG4gICAgLy8gdmFsdWUgaXMgbW9zdCBsaWtlbHkgdXJsXG4gICAgdXJsOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgcmV0dXJuICQuZm4uZm9ybS5zZXR0aW5ncy5yZWdFeHAudXJsLnRlc3QodmFsdWUpO1xuICAgIH0sXG5cbiAgICAvLyBtYXRjaGVzIHNwZWNpZmllZCByZWdFeHBcbiAgICByZWdFeHA6IGZ1bmN0aW9uKHZhbHVlLCByZWdFeHApIHtcbiAgICAgIGlmKHJlZ0V4cCBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuICAgICAgICByZXR1cm4gdmFsdWUubWF0Y2gocmVnRXhwKTtcbiAgICAgIH1cbiAgICAgIHZhclxuICAgICAgICByZWdFeHBQYXJ0cyA9IHJlZ0V4cC5tYXRjaCgkLmZuLmZvcm0uc2V0dGluZ3MucmVnRXhwLmZsYWdzKSxcbiAgICAgICAgZmxhZ3NcbiAgICAgIDtcbiAgICAgIC8vIHJlZ3VsYXIgZXhwcmVzc2lvbiBzcGVjaWZpZWQgYXMgL2Jhei9naSAoZmxhZ3MpXG4gICAgICBpZihyZWdFeHBQYXJ0cykge1xuICAgICAgICByZWdFeHAgPSAocmVnRXhwUGFydHMubGVuZ3RoID49IDIpXG4gICAgICAgICAgPyByZWdFeHBQYXJ0c1sxXVxuICAgICAgICAgIDogcmVnRXhwXG4gICAgICAgIDtcbiAgICAgICAgZmxhZ3MgPSAocmVnRXhwUGFydHMubGVuZ3RoID49IDMpXG4gICAgICAgICAgPyByZWdFeHBQYXJ0c1syXVxuICAgICAgICAgIDogJydcbiAgICAgICAgO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZhbHVlLm1hdGNoKCBuZXcgUmVnRXhwKHJlZ0V4cCwgZmxhZ3MpICk7XG4gICAgfSxcblxuICAgIC8vIGlzIHZhbGlkIGludGVnZXIgb3IgbWF0Y2hlcyByYW5nZVxuICAgIGludGVnZXI6IGZ1bmN0aW9uKHZhbHVlLCByYW5nZSkge1xuICAgICAgdmFyXG4gICAgICAgIGludFJlZ0V4cCA9ICQuZm4uZm9ybS5zZXR0aW5ncy5yZWdFeHAuaW50ZWdlcixcbiAgICAgICAgbWluLFxuICAgICAgICBtYXgsXG4gICAgICAgIHBhcnRzXG4gICAgICA7XG4gICAgICBpZiggIXJhbmdlIHx8IFsnJywgJy4uJ10uaW5kZXhPZihyYW5nZSkgIT09IC0xKSB7XG4gICAgICAgIC8vIGRvIG5vdGhpbmdcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYocmFuZ2UuaW5kZXhPZignLi4nKSA9PSAtMSkge1xuICAgICAgICBpZihpbnRSZWdFeHAudGVzdChyYW5nZSkpIHtcbiAgICAgICAgICBtaW4gPSBtYXggPSByYW5nZSAtIDA7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBwYXJ0cyA9IHJhbmdlLnNwbGl0KCcuLicsIDIpO1xuICAgICAgICBpZihpbnRSZWdFeHAudGVzdChwYXJ0c1swXSkpIHtcbiAgICAgICAgICBtaW4gPSBwYXJ0c1swXSAtIDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYoaW50UmVnRXhwLnRlc3QocGFydHNbMV0pKSB7XG4gICAgICAgICAgbWF4ID0gcGFydHNbMV0gLSAwO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gKFxuICAgICAgICBpbnRSZWdFeHAudGVzdCh2YWx1ZSkgJiZcbiAgICAgICAgKG1pbiA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID49IG1pbikgJiZcbiAgICAgICAgKG1heCA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlIDw9IG1heClcbiAgICAgICk7XG4gICAgfSxcblxuICAgIC8vIGlzIHZhbGlkIG51bWJlciAod2l0aCBkZWNpbWFsKVxuICAgIGRlY2ltYWw6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXR1cm4gJC5mbi5mb3JtLnNldHRpbmdzLnJlZ0V4cC5kZWNpbWFsLnRlc3QodmFsdWUpO1xuICAgIH0sXG5cbiAgICAvLyBpcyB2YWxpZCBudW1iZXJcbiAgICBudW1iZXI6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICByZXR1cm4gJC5mbi5mb3JtLnNldHRpbmdzLnJlZ0V4cC5udW1iZXIudGVzdCh2YWx1ZSk7XG4gICAgfSxcblxuICAgIC8vIGlzIHZhbHVlIChjYXNlIGluc2Vuc2l0aXZlKVxuICAgIGlzOiBmdW5jdGlvbih2YWx1ZSwgdGV4dCkge1xuICAgICAgdGV4dCA9ICh0eXBlb2YgdGV4dCA9PSAnc3RyaW5nJylcbiAgICAgICAgPyB0ZXh0LnRvTG93ZXJDYXNlKClcbiAgICAgICAgOiB0ZXh0XG4gICAgICA7XG4gICAgICB2YWx1ZSA9ICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycpXG4gICAgICAgID8gdmFsdWUudG9Mb3dlckNhc2UoKVxuICAgICAgICA6IHZhbHVlXG4gICAgICA7XG4gICAgICByZXR1cm4gKHZhbHVlID09IHRleHQpO1xuICAgIH0sXG5cbiAgICAvLyBpcyB2YWx1ZVxuICAgIGlzRXhhY3RseTogZnVuY3Rpb24odmFsdWUsIHRleHQpIHtcbiAgICAgIHJldHVybiAodmFsdWUgPT0gdGV4dCk7XG4gICAgfSxcblxuICAgIC8vIHZhbHVlIGlzIG5vdCBhbm90aGVyIHZhbHVlIChjYXNlIGluc2Vuc2l0aXZlKVxuICAgIG5vdDogZnVuY3Rpb24odmFsdWUsIG5vdFZhbHVlKSB7XG4gICAgICB2YWx1ZSA9ICh0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycpXG4gICAgICAgID8gdmFsdWUudG9Mb3dlckNhc2UoKVxuICAgICAgICA6IHZhbHVlXG4gICAgICA7XG4gICAgICBub3RWYWx1ZSA9ICh0eXBlb2Ygbm90VmFsdWUgPT0gJ3N0cmluZycpXG4gICAgICAgID8gbm90VmFsdWUudG9Mb3dlckNhc2UoKVxuICAgICAgICA6IG5vdFZhbHVlXG4gICAgICA7XG4gICAgICByZXR1cm4gKHZhbHVlICE9IG5vdFZhbHVlKTtcbiAgICB9LFxuXG4gICAgLy8gdmFsdWUgaXMgbm90IGFub3RoZXIgdmFsdWUgKGNhc2Ugc2Vuc2l0aXZlKVxuICAgIG5vdEV4YWN0bHk6IGZ1bmN0aW9uKHZhbHVlLCBub3RWYWx1ZSkge1xuICAgICAgcmV0dXJuICh2YWx1ZSAhPSBub3RWYWx1ZSk7XG4gICAgfSxcblxuICAgIC8vIHZhbHVlIGNvbnRhaW5zIHRleHQgKGluc2Vuc2l0aXZlKVxuICAgIGNvbnRhaW5zOiBmdW5jdGlvbih2YWx1ZSwgdGV4dCkge1xuICAgICAgLy8gZXNjYXBlIHJlZ2V4IGNoYXJhY3RlcnNcbiAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoJC5mbi5mb3JtLnNldHRpbmdzLnJlZ0V4cC5lc2NhcGUsIFwiXFxcXCQmXCIpO1xuICAgICAgcmV0dXJuICh2YWx1ZS5zZWFyY2goIG5ldyBSZWdFeHAodGV4dCwgJ2knKSApICE9PSAtMSk7XG4gICAgfSxcblxuICAgIC8vIHZhbHVlIGNvbnRhaW5zIHRleHQgKGNhc2Ugc2Vuc2l0aXZlKVxuICAgIGNvbnRhaW5zRXhhY3RseTogZnVuY3Rpb24odmFsdWUsIHRleHQpIHtcbiAgICAgIC8vIGVzY2FwZSByZWdleCBjaGFyYWN0ZXJzXG4gICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKCQuZm4uZm9ybS5zZXR0aW5ncy5yZWdFeHAuZXNjYXBlLCBcIlxcXFwkJlwiKTtcbiAgICAgIHJldHVybiAodmFsdWUuc2VhcmNoKCBuZXcgUmVnRXhwKHRleHQpICkgIT09IC0xKTtcbiAgICB9LFxuXG4gICAgLy8gdmFsdWUgY29udGFpbnMgdGV4dCAoaW5zZW5zaXRpdmUpXG4gICAgZG9lc250Q29udGFpbjogZnVuY3Rpb24odmFsdWUsIHRleHQpIHtcbiAgICAgIC8vIGVzY2FwZSByZWdleCBjaGFyYWN0ZXJzXG4gICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKCQuZm4uZm9ybS5zZXR0aW5ncy5yZWdFeHAuZXNjYXBlLCBcIlxcXFwkJlwiKTtcbiAgICAgIHJldHVybiAodmFsdWUuc2VhcmNoKCBuZXcgUmVnRXhwKHRleHQsICdpJykgKSA9PT0gLTEpO1xuICAgIH0sXG5cbiAgICAvLyB2YWx1ZSBjb250YWlucyB0ZXh0IChjYXNlIHNlbnNpdGl2ZSlcbiAgICBkb2VzbnRDb250YWluRXhhY3RseTogZnVuY3Rpb24odmFsdWUsIHRleHQpIHtcbiAgICAgIC8vIGVzY2FwZSByZWdleCBjaGFyYWN0ZXJzXG4gICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKCQuZm4uZm9ybS5zZXR0aW5ncy5yZWdFeHAuZXNjYXBlLCBcIlxcXFwkJlwiKTtcbiAgICAgIHJldHVybiAodmFsdWUuc2VhcmNoKCBuZXcgUmVnRXhwKHRleHQpICkgPT09IC0xKTtcbiAgICB9LFxuXG4gICAgLy8gaXMgYXQgbGVhc3Qgc3RyaW5nIGxlbmd0aFxuICAgIG1pbkxlbmd0aDogZnVuY3Rpb24odmFsdWUsIHJlcXVpcmVkTGVuZ3RoKSB7XG4gICAgICByZXR1cm4gKHZhbHVlICE9PSB1bmRlZmluZWQpXG4gICAgICAgID8gKHZhbHVlLmxlbmd0aCA+PSByZXF1aXJlZExlbmd0aClcbiAgICAgICAgOiBmYWxzZVxuICAgICAgO1xuICAgIH0sXG5cbiAgICAvLyBzZWUgcmxzIG5vdGVzIGZvciAyLjAuNiAodGhpcyBpcyBhIGR1cGxpY2F0ZSBvZiBtaW5MZW5ndGgpXG4gICAgbGVuZ3RoOiBmdW5jdGlvbih2YWx1ZSwgcmVxdWlyZWRMZW5ndGgpIHtcbiAgICAgIHJldHVybiAodmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICAgICAgPyAodmFsdWUubGVuZ3RoID49IHJlcXVpcmVkTGVuZ3RoKVxuICAgICAgICA6IGZhbHNlXG4gICAgICA7XG4gICAgfSxcblxuICAgIC8vIGlzIGV4YWN0bHkgbGVuZ3RoXG4gICAgZXhhY3RMZW5ndGg6IGZ1bmN0aW9uKHZhbHVlLCByZXF1aXJlZExlbmd0aCkge1xuICAgICAgcmV0dXJuICh2YWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICA/ICh2YWx1ZS5sZW5ndGggPT0gcmVxdWlyZWRMZW5ndGgpXG4gICAgICAgIDogZmFsc2VcbiAgICAgIDtcbiAgICB9LFxuXG4gICAgLy8gaXMgbGVzcyB0aGFuIGxlbmd0aFxuICAgIG1heExlbmd0aDogZnVuY3Rpb24odmFsdWUsIG1heExlbmd0aCkge1xuICAgICAgcmV0dXJuICh2YWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICA/ICh2YWx1ZS5sZW5ndGggPD0gbWF4TGVuZ3RoKVxuICAgICAgICA6IGZhbHNlXG4gICAgICA7XG4gICAgfSxcblxuICAgIC8vIG1hdGNoZXMgYW5vdGhlciBmaWVsZFxuICAgIG1hdGNoOiBmdW5jdGlvbih2YWx1ZSwgaWRlbnRpZmllcikge1xuICAgICAgdmFyXG4gICAgICAgICRmb3JtID0gJCh0aGlzKSxcbiAgICAgICAgbWF0Y2hpbmdWYWx1ZVxuICAgICAgO1xuICAgICAgaWYoICQoJ1tkYXRhLXZhbGlkYXRlPVwiJysgaWRlbnRpZmllciArJ1wiXScpLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgIG1hdGNoaW5nVmFsdWUgPSAkKCdbZGF0YS12YWxpZGF0ZT1cIicrIGlkZW50aWZpZXIgKydcIl0nKS52YWwoKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYoJCgnIycgKyBpZGVudGlmaWVyKS5sZW5ndGggPiAwKSB7XG4gICAgICAgIG1hdGNoaW5nVmFsdWUgPSAkKCcjJyArIGlkZW50aWZpZXIpLnZhbCgpO1xuICAgICAgfVxuICAgICAgZWxzZSBpZigkKCdbbmFtZT1cIicgKyBpZGVudGlmaWVyICsnXCJdJykubGVuZ3RoID4gMCkge1xuICAgICAgICBtYXRjaGluZ1ZhbHVlID0gJCgnW25hbWU9XCInICsgaWRlbnRpZmllciArICdcIl0nKS52YWwoKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYoICQoJ1tuYW1lPVwiJyArIGlkZW50aWZpZXIgKydbXVwiXScpLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgIG1hdGNoaW5nVmFsdWUgPSAkKCdbbmFtZT1cIicgKyBpZGVudGlmaWVyICsnW11cIl0nKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAobWF0Y2hpbmdWYWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICA/ICggdmFsdWUudG9TdHJpbmcoKSA9PSBtYXRjaGluZ1ZhbHVlLnRvU3RyaW5nKCkgKVxuICAgICAgICA6IGZhbHNlXG4gICAgICA7XG4gICAgfSxcblxuICAgIC8vIGRpZmZlcmVudCB0aGFuIGFub3RoZXIgZmllbGRcbiAgICBkaWZmZXJlbnQ6IGZ1bmN0aW9uKHZhbHVlLCBpZGVudGlmaWVyKSB7XG4gICAgICAvLyB1c2UgZWl0aGVyIGlkIG9yIG5hbWUgb2YgZmllbGRcbiAgICAgIHZhclxuICAgICAgICAkZm9ybSA9ICQodGhpcyksXG4gICAgICAgIG1hdGNoaW5nVmFsdWVcbiAgICAgIDtcbiAgICAgIGlmKCAkKCdbZGF0YS12YWxpZGF0ZT1cIicrIGlkZW50aWZpZXIgKydcIl0nKS5sZW5ndGggPiAwICkge1xuICAgICAgICBtYXRjaGluZ1ZhbHVlID0gJCgnW2RhdGEtdmFsaWRhdGU9XCInKyBpZGVudGlmaWVyICsnXCJdJykudmFsKCk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmKCQoJyMnICsgaWRlbnRpZmllcikubGVuZ3RoID4gMCkge1xuICAgICAgICBtYXRjaGluZ1ZhbHVlID0gJCgnIycgKyBpZGVudGlmaWVyKS52YWwoKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYoJCgnW25hbWU9XCInICsgaWRlbnRpZmllciArJ1wiXScpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbWF0Y2hpbmdWYWx1ZSA9ICQoJ1tuYW1lPVwiJyArIGlkZW50aWZpZXIgKyAnXCJdJykudmFsKCk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmKCAkKCdbbmFtZT1cIicgKyBpZGVudGlmaWVyICsnW11cIl0nKS5sZW5ndGggPiAwICkge1xuICAgICAgICBtYXRjaGluZ1ZhbHVlID0gJCgnW25hbWU9XCInICsgaWRlbnRpZmllciArJ1tdXCJdJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gKG1hdGNoaW5nVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICAgICAgPyAoIHZhbHVlLnRvU3RyaW5nKCkgIT09IG1hdGNoaW5nVmFsdWUudG9TdHJpbmcoKSApXG4gICAgICAgIDogZmFsc2VcbiAgICAgIDtcbiAgICB9LFxuXG4gICAgY3JlZGl0Q2FyZDogZnVuY3Rpb24oY2FyZE51bWJlciwgY2FyZFR5cGVzKSB7XG4gICAgICB2YXJcbiAgICAgICAgY2FyZHMgPSB7XG4gICAgICAgICAgdmlzYToge1xuICAgICAgICAgICAgcGF0dGVybiA6IC9eNC8sXG4gICAgICAgICAgICBsZW5ndGggIDogWzE2XVxuICAgICAgICAgIH0sXG4gICAgICAgICAgYW1leDoge1xuICAgICAgICAgICAgcGF0dGVybiA6IC9eM1s0N10vLFxuICAgICAgICAgICAgbGVuZ3RoICA6IFsxNV1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG1hc3RlcmNhcmQ6IHtcbiAgICAgICAgICAgIHBhdHRlcm4gOiAvXjVbMS01XS8sXG4gICAgICAgICAgICBsZW5ndGggIDogWzE2XVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlzY292ZXI6IHtcbiAgICAgICAgICAgIHBhdHRlcm4gOiAvXig2MDExfDYyMigxMls2LTldfDFbMy05XVswLTldfFsyLThdWzAtOV17Mn18OVswLTFdWzAtOV18OTJbMC01XXw2NFs0LTldKXw2NSkvLFxuICAgICAgICAgICAgbGVuZ3RoICA6IFsxNl1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHVuaW9uUGF5OiB7XG4gICAgICAgICAgICBwYXR0ZXJuIDogL14oNjJ8ODgpLyxcbiAgICAgICAgICAgIGxlbmd0aCAgOiBbMTYsIDE3LCAxOCwgMTldXG4gICAgICAgICAgfSxcbiAgICAgICAgICBqY2I6IHtcbiAgICAgICAgICAgIHBhdHRlcm4gOiAvXjM1KDJbODldfFszLThdWzAtOV0pLyxcbiAgICAgICAgICAgIGxlbmd0aCAgOiBbMTZdXG4gICAgICAgICAgfSxcbiAgICAgICAgICBtYWVzdHJvOiB7XG4gICAgICAgICAgICBwYXR0ZXJuIDogL14oNTAxOHw1MDIwfDUwMzh8NjMwNHw2NzU5fDY3NlsxLTNdKS8sXG4gICAgICAgICAgICBsZW5ndGggIDogWzEyLCAxMywgMTQsIDE1LCAxNiwgMTcsIDE4LCAxOV1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpbmVyc0NsdWI6IHtcbiAgICAgICAgICAgIHBhdHRlcm4gOiAvXigzMFswLTVdfF4zNikvLFxuICAgICAgICAgICAgbGVuZ3RoICA6IFsxNF1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGxhc2VyOiB7XG4gICAgICAgICAgICBwYXR0ZXJuIDogL14oNjMwNHw2NzBbNjldfDY3NzEpLyxcbiAgICAgICAgICAgIGxlbmd0aCAgOiBbMTYsIDE3LCAxOCwgMTldXG4gICAgICAgICAgfSxcbiAgICAgICAgICB2aXNhRWxlY3Ryb246IHtcbiAgICAgICAgICAgIHBhdHRlcm4gOiAvXig0MDI2fDQxNzUwMHw0NTA4fDQ4NDR8NDkxKDN8NykpLyxcbiAgICAgICAgICAgIGxlbmd0aCAgOiBbMTZdXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB2YWxpZCAgICAgICAgID0ge30sXG4gICAgICAgIHZhbGlkQ2FyZCAgICAgPSBmYWxzZSxcbiAgICAgICAgcmVxdWlyZWRUeXBlcyA9ICh0eXBlb2YgY2FyZFR5cGVzID09ICdzdHJpbmcnKVxuICAgICAgICAgID8gY2FyZFR5cGVzLnNwbGl0KCcsJylcbiAgICAgICAgICA6IGZhbHNlLFxuICAgICAgICB1bmlvblBheSxcbiAgICAgICAgdmFsaWRhdGlvblxuICAgICAgO1xuXG4gICAgICBpZih0eXBlb2YgY2FyZE51bWJlciAhPT0gJ3N0cmluZycgfHwgY2FyZE51bWJlci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBhbGxvdyBkYXNoZXMgaW4gY2FyZFxuICAgICAgY2FyZE51bWJlciA9IGNhcmROdW1iZXIucmVwbGFjZSgvW1xcLV0vZywgJycpO1xuXG4gICAgICAvLyB2ZXJpZnkgY2FyZCB0eXBlc1xuICAgICAgaWYocmVxdWlyZWRUeXBlcykge1xuICAgICAgICAkLmVhY2gocmVxdWlyZWRUeXBlcywgZnVuY3Rpb24oaW5kZXgsIHR5cGUpe1xuICAgICAgICAgIC8vIHZlcmlmeSBlYWNoIGNhcmQgdHlwZVxuICAgICAgICAgIHZhbGlkYXRpb24gPSBjYXJkc1t0eXBlXTtcbiAgICAgICAgICBpZih2YWxpZGF0aW9uKSB7XG4gICAgICAgICAgICB2YWxpZCA9IHtcbiAgICAgICAgICAgICAgbGVuZ3RoICA6ICgkLmluQXJyYXkoY2FyZE51bWJlci5sZW5ndGgsIHZhbGlkYXRpb24ubGVuZ3RoKSAhPT0gLTEpLFxuICAgICAgICAgICAgICBwYXR0ZXJuIDogKGNhcmROdW1iZXIuc2VhcmNoKHZhbGlkYXRpb24ucGF0dGVybikgIT09IC0xKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmKHZhbGlkLmxlbmd0aCAmJiB2YWxpZC5wYXR0ZXJuKSB7XG4gICAgICAgICAgICAgIHZhbGlkQ2FyZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBpZighdmFsaWRDYXJkKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIHNraXAgbHVobiBmb3IgVW5pb25QYXlcbiAgICAgIHVuaW9uUGF5ID0ge1xuICAgICAgICBudW1iZXIgIDogKCQuaW5BcnJheShjYXJkTnVtYmVyLmxlbmd0aCwgY2FyZHMudW5pb25QYXkubGVuZ3RoKSAhPT0gLTEpLFxuICAgICAgICBwYXR0ZXJuIDogKGNhcmROdW1iZXIuc2VhcmNoKGNhcmRzLnVuaW9uUGF5LnBhdHRlcm4pICE9PSAtMSlcbiAgICAgIH07XG4gICAgICBpZih1bmlvblBheS5udW1iZXIgJiYgdW5pb25QYXkucGF0dGVybikge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgLy8gdmVyaWZ5IGx1aG4sIGFkYXB0ZWQgZnJvbSAgPGh0dHBzOi8vZ2lzdC5naXRodWIuY29tLzIxMzQzNzY+XG4gICAgICB2YXJcbiAgICAgICAgbGVuZ3RoICAgICAgICA9IGNhcmROdW1iZXIubGVuZ3RoLFxuICAgICAgICBtdWx0aXBsZSAgICAgID0gMCxcbiAgICAgICAgcHJvZHVjZWRWYWx1ZSA9IFtcbiAgICAgICAgICBbMCwgMSwgMiwgMywgNCwgNSwgNiwgNywgOCwgOV0sXG4gICAgICAgICAgWzAsIDIsIDQsIDYsIDgsIDEsIDMsIDUsIDcsIDldXG4gICAgICAgIF0sXG4gICAgICAgIHN1bSAgICAgICAgICAgPSAwXG4gICAgICA7XG4gICAgICB3aGlsZSAobGVuZ3RoLS0pIHtcbiAgICAgICAgc3VtICs9IHByb2R1Y2VkVmFsdWVbbXVsdGlwbGVdW3BhcnNlSW50KGNhcmROdW1iZXIuY2hhckF0KGxlbmd0aCksIDEwKV07XG4gICAgICAgIG11bHRpcGxlIF49IDE7XG4gICAgICB9XG4gICAgICByZXR1cm4gKHN1bSAlIDEwID09PSAwICYmIHN1bSA+IDApO1xuICAgIH0sXG5cbiAgICBtaW5Db3VudDogZnVuY3Rpb24odmFsdWUsIG1pbkNvdW50KSB7XG4gICAgICBpZihtaW5Db3VudCA9PSAwKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgaWYobWluQ291bnQgPT0gMSkge1xuICAgICAgICByZXR1cm4gKHZhbHVlICE9PSAnJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gKHZhbHVlLnNwbGl0KCcsJykubGVuZ3RoID49IG1pbkNvdW50KTtcbiAgICB9LFxuXG4gICAgZXhhY3RDb3VudDogZnVuY3Rpb24odmFsdWUsIGV4YWN0Q291bnQpIHtcbiAgICAgIGlmKGV4YWN0Q291bnQgPT0gMCkge1xuICAgICAgICByZXR1cm4gKHZhbHVlID09PSAnJyk7XG4gICAgICB9XG4gICAgICBpZihleGFjdENvdW50ID09IDEpIHtcbiAgICAgICAgcmV0dXJuICh2YWx1ZSAhPT0gJycgJiYgdmFsdWUuc2VhcmNoKCcsJykgPT09IC0xKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAodmFsdWUuc3BsaXQoJywnKS5sZW5ndGggPT0gZXhhY3RDb3VudCk7XG4gICAgfSxcblxuICAgIG1heENvdW50OiBmdW5jdGlvbih2YWx1ZSwgbWF4Q291bnQpIHtcbiAgICAgIGlmKG1heENvdW50ID09IDApIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYobWF4Q291bnQgPT0gMSkge1xuICAgICAgICByZXR1cm4gKHZhbHVlLnNlYXJjaCgnLCcpID09PSAtMSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gKHZhbHVlLnNwbGl0KCcsJykubGVuZ3RoIDw9IG1heENvdW50KTtcbiAgICB9XG4gIH1cblxufTtcblxufSkoIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCApO1xuXG4vKiFcbiAqICMgU2VtYW50aWMgVUkgMi40LjAgLSBBY2NvcmRpb25cbiAqIGh0dHA6Ly9naXRodWIuY29tL3NlbWFudGljLW9yZy9zZW1hbnRpYy11aS9cbiAqXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG5cbjsoZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG4ndXNlIHN0cmljdCc7XG5cbndpbmRvdyA9ICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGgpXG4gID8gd2luZG93XG4gIDogKHR5cGVvZiBzZWxmICE9ICd1bmRlZmluZWQnICYmIHNlbGYuTWF0aCA9PSBNYXRoKVxuICAgID8gc2VsZlxuICAgIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKVxuO1xuXG4kLmZuLmFjY29yZGlvbiA9IGZ1bmN0aW9uKHBhcmFtZXRlcnMpIHtcbiAgdmFyXG4gICAgJGFsbE1vZHVsZXMgICAgID0gJCh0aGlzKSxcblxuICAgIHRpbWUgICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgICA9IFtdLFxuXG4gICAgcXVlcnkgICAgICAgICAgID0gYXJndW1lbnRzWzBdLFxuICAgIG1ldGhvZEludm9rZWQgICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzICA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAgfHwgZnVuY3Rpb24oY2FsbGJhY2spIHsgc2V0VGltZW91dChjYWxsYmFjaywgMCk7IH0sXG5cbiAgICByZXR1cm5lZFZhbHVlXG4gIDtcbiAgJGFsbE1vZHVsZXNcbiAgICAuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIHZhclxuICAgICAgICBzZXR0aW5ncyAgICAgICAgPSAoICQuaXNQbGFpbk9iamVjdChwYXJhbWV0ZXJzKSApXG4gICAgICAgICAgPyAkLmV4dGVuZCh0cnVlLCB7fSwgJC5mbi5hY2NvcmRpb24uc2V0dGluZ3MsIHBhcmFtZXRlcnMpXG4gICAgICAgICAgOiAkLmV4dGVuZCh7fSwgJC5mbi5hY2NvcmRpb24uc2V0dGluZ3MpLFxuXG4gICAgICAgIGNsYXNzTmFtZSAgICAgICA9IHNldHRpbmdzLmNsYXNzTmFtZSxcbiAgICAgICAgbmFtZXNwYWNlICAgICAgID0gc2V0dGluZ3MubmFtZXNwYWNlLFxuICAgICAgICBzZWxlY3RvciAgICAgICAgPSBzZXR0aW5ncy5zZWxlY3RvcixcbiAgICAgICAgZXJyb3IgICAgICAgICAgID0gc2V0dGluZ3MuZXJyb3IsXG5cbiAgICAgICAgZXZlbnROYW1lc3BhY2UgID0gJy4nICsgbmFtZXNwYWNlLFxuICAgICAgICBtb2R1bGVOYW1lc3BhY2UgPSAnbW9kdWxlLScgKyBuYW1lc3BhY2UsXG4gICAgICAgIG1vZHVsZVNlbGVjdG9yICA9ICRhbGxNb2R1bGVzLnNlbGVjdG9yIHx8ICcnLFxuXG4gICAgICAgICRtb2R1bGUgID0gJCh0aGlzKSxcbiAgICAgICAgJHRpdGxlICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IudGl0bGUpLFxuICAgICAgICAkY29udGVudCA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5jb250ZW50KSxcblxuICAgICAgICBlbGVtZW50ICA9IHRoaXMsXG4gICAgICAgIGluc3RhbmNlID0gJG1vZHVsZS5kYXRhKG1vZHVsZU5hbWVzcGFjZSksXG4gICAgICAgIG9ic2VydmVyLFxuICAgICAgICBtb2R1bGVcbiAgICAgIDtcblxuICAgICAgbW9kdWxlID0ge1xuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW5pdGlhbGl6aW5nJywgJG1vZHVsZSk7XG4gICAgICAgICAgbW9kdWxlLmJpbmQuZXZlbnRzKCk7XG4gICAgICAgICAgaWYoc2V0dGluZ3Mub2JzZXJ2ZUNoYW5nZXMpIHtcbiAgICAgICAgICAgIG1vZHVsZS5vYnNlcnZlQ2hhbmdlcygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuaW5zdGFudGlhdGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbnN0YW50aWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaW5zdGFuY2UgPSBtb2R1bGU7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLmRhdGEobW9kdWxlTmFtZXNwYWNlLCBtb2R1bGUpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRGVzdHJveWluZyBwcmV2aW91cyBpbnN0YW5jZScsICRtb2R1bGUpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5vZmYoZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgICAucmVtb3ZlRGF0YShtb2R1bGVOYW1lc3BhY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICR0aXRsZSAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLnRpdGxlKTtcbiAgICAgICAgICAkY29udGVudCA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5jb250ZW50KTtcbiAgICAgICAgfSxcblxuICAgICAgICBvYnNlcnZlQ2hhbmdlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoJ011dGF0aW9uT2JzZXJ2ZXInIGluIHdpbmRvdykge1xuICAgICAgICAgICAgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbihtdXRhdGlvbnMpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdET00gdHJlZSBtb2RpZmllZCwgdXBkYXRpbmcgc2VsZWN0b3IgY2FjaGUnKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlZnJlc2goKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShlbGVtZW50LCB7XG4gICAgICAgICAgICAgIGNoaWxkTGlzdCA6IHRydWUsXG4gICAgICAgICAgICAgIHN1YnRyZWUgICA6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZXR0aW5nIHVwIG11dGF0aW9uIG9ic2VydmVyJywgb2JzZXJ2ZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBiaW5kOiB7XG4gICAgICAgICAgZXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQmluZGluZyBkZWxlZ2F0ZWQgZXZlbnRzJyk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5vbihzZXR0aW5ncy5vbiArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci50cmlnZ2VyLCBtb2R1bGUuZXZlbnQuY2xpY2spXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50OiB7XG4gICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnRvZ2dsZS5jYWxsKHRoaXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAkYWN0aXZlVGl0bGUgPSAocXVlcnkgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyAodHlwZW9mIHF1ZXJ5ID09PSAnbnVtYmVyJylcbiAgICAgICAgICAgICAgICA/ICR0aXRsZS5lcShxdWVyeSlcbiAgICAgICAgICAgICAgICA6ICQocXVlcnkpLmNsb3Nlc3Qoc2VsZWN0b3IudGl0bGUpXG4gICAgICAgICAgICAgIDogJCh0aGlzKS5jbG9zZXN0KHNlbGVjdG9yLnRpdGxlKSxcbiAgICAgICAgICAgICRhY3RpdmVDb250ZW50ID0gJGFjdGl2ZVRpdGxlLm5leHQoJGNvbnRlbnQpLFxuICAgICAgICAgICAgaXNBbmltYXRpbmcgPSAkYWN0aXZlQ29udGVudC5oYXNDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKSxcbiAgICAgICAgICAgIGlzQWN0aXZlICAgID0gJGFjdGl2ZUNvbnRlbnQuaGFzQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSksXG4gICAgICAgICAgICBpc09wZW4gICAgICA9IChpc0FjdGl2ZSAmJiAhaXNBbmltYXRpbmcpLFxuICAgICAgICAgICAgaXNPcGVuaW5nICAgPSAoIWlzQWN0aXZlICYmIGlzQW5pbWF0aW5nKVxuICAgICAgICAgIDtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ1RvZ2dsaW5nIHZpc2liaWxpdHkgb2YgY29udGVudCcsICRhY3RpdmVUaXRsZSk7XG4gICAgICAgICAgaWYoaXNPcGVuIHx8IGlzT3BlbmluZykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuY29sbGFwc2libGUpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmNsb3NlLmNhbGwoJGFjdGl2ZVRpdGxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0Nhbm5vdCBjbG9zZSBhY2NvcmRpb24gY29udGVudCBjb2xsYXBzaW5nIGlzIGRpc2FibGVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbW9kdWxlLm9wZW4uY2FsbCgkYWN0aXZlVGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvcGVuOiBmdW5jdGlvbihxdWVyeSkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgJGFjdGl2ZVRpdGxlID0gKHF1ZXJ5ICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gKHR5cGVvZiBxdWVyeSA9PT0gJ251bWJlcicpXG4gICAgICAgICAgICAgICAgPyAkdGl0bGUuZXEocXVlcnkpXG4gICAgICAgICAgICAgICAgOiAkKHF1ZXJ5KS5jbG9zZXN0KHNlbGVjdG9yLnRpdGxlKVxuICAgICAgICAgICAgICA6ICQodGhpcykuY2xvc2VzdChzZWxlY3Rvci50aXRsZSksXG4gICAgICAgICAgICAkYWN0aXZlQ29udGVudCA9ICRhY3RpdmVUaXRsZS5uZXh0KCRjb250ZW50KSxcbiAgICAgICAgICAgIGlzQW5pbWF0aW5nID0gJGFjdGl2ZUNvbnRlbnQuaGFzQ2xhc3MoY2xhc3NOYW1lLmFuaW1hdGluZyksXG4gICAgICAgICAgICBpc0FjdGl2ZSAgICA9ICRhY3RpdmVDb250ZW50Lmhhc0NsYXNzKGNsYXNzTmFtZS5hY3RpdmUpLFxuICAgICAgICAgICAgaXNPcGVuICAgICAgPSAoaXNBY3RpdmUgfHwgaXNBbmltYXRpbmcpXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKGlzT3Blbikge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBY2NvcmRpb24gYWxyZWFkeSBvcGVuLCBza2lwcGluZycsICRhY3RpdmVDb250ZW50KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdPcGVuaW5nIGFjY29yZGlvbiBjb250ZW50JywgJGFjdGl2ZVRpdGxlKTtcbiAgICAgICAgICBzZXR0aW5ncy5vbk9wZW5pbmcuY2FsbCgkYWN0aXZlQ29udGVudCk7XG4gICAgICAgICAgc2V0dGluZ3Mub25DaGFuZ2luZy5jYWxsKCRhY3RpdmVDb250ZW50KTtcbiAgICAgICAgICBpZihzZXR0aW5ncy5leGNsdXNpdmUpIHtcbiAgICAgICAgICAgIG1vZHVsZS5jbG9zZU90aGVycy5jYWxsKCRhY3RpdmVUaXRsZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgICRhY3RpdmVUaXRsZVxuICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5hY3RpdmUpXG4gICAgICAgICAgO1xuICAgICAgICAgICRhY3RpdmVDb250ZW50XG4gICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5hbmltYXRpbmcpXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKHNldHRpbmdzLmFuaW1hdGVDaGlsZHJlbikge1xuICAgICAgICAgICAgaWYoJC5mbi50cmFuc2l0aW9uICE9PSB1bmRlZmluZWQgJiYgJG1vZHVsZS50cmFuc2l0aW9uKCdpcyBzdXBwb3J0ZWQnKSkge1xuICAgICAgICAgICAgICAkYWN0aXZlQ29udGVudFxuICAgICAgICAgICAgICAgIC5jaGlsZHJlbigpXG4gICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbih7XG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbiAgIDogJ2ZhZGUgaW4nLFxuICAgICAgICAgICAgICAgICAgICBxdWV1ZSAgICAgICA6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB1c2VGYWlsU2FmZSA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGRlYnVnICAgICAgIDogc2V0dGluZ3MuZGVidWcsXG4gICAgICAgICAgICAgICAgICAgIHZlcmJvc2UgICAgIDogc2V0dGluZ3MudmVyYm9zZSxcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb24gICAgOiBzZXR0aW5ncy5kdXJhdGlvblxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICRhY3RpdmVDb250ZW50XG4gICAgICAgICAgICAgICAgLmNoaWxkcmVuKClcbiAgICAgICAgICAgICAgICAgIC5zdG9wKHRydWUsIHRydWUpXG4gICAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDFcbiAgICAgICAgICAgICAgICAgIH0sIHNldHRpbmdzLmR1cmF0aW9uLCBtb2R1bGUucmVzZXRPcGFjaXR5KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgICRhY3RpdmVDb250ZW50XG4gICAgICAgICAgICAuc2xpZGVEb3duKHNldHRpbmdzLmR1cmF0aW9uLCBzZXR0aW5ncy5lYXNpbmcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAkYWN0aXZlQ29udGVudFxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZXNldC5kaXNwbGF5LmNhbGwodGhpcyk7XG4gICAgICAgICAgICAgIHNldHRpbmdzLm9uT3Blbi5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgICBzZXR0aW5ncy5vbkNoYW5nZS5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKHF1ZXJ5KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAkYWN0aXZlVGl0bGUgPSAocXVlcnkgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyAodHlwZW9mIHF1ZXJ5ID09PSAnbnVtYmVyJylcbiAgICAgICAgICAgICAgICA/ICR0aXRsZS5lcShxdWVyeSlcbiAgICAgICAgICAgICAgICA6ICQocXVlcnkpLmNsb3Nlc3Qoc2VsZWN0b3IudGl0bGUpXG4gICAgICAgICAgICAgIDogJCh0aGlzKS5jbG9zZXN0KHNlbGVjdG9yLnRpdGxlKSxcbiAgICAgICAgICAgICRhY3RpdmVDb250ZW50ID0gJGFjdGl2ZVRpdGxlLm5leHQoJGNvbnRlbnQpLFxuICAgICAgICAgICAgaXNBbmltYXRpbmcgICAgPSAkYWN0aXZlQ29udGVudC5oYXNDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKSxcbiAgICAgICAgICAgIGlzQWN0aXZlICAgICAgID0gJGFjdGl2ZUNvbnRlbnQuaGFzQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSksXG4gICAgICAgICAgICBpc09wZW5pbmcgICAgICA9ICghaXNBY3RpdmUgJiYgaXNBbmltYXRpbmcpLFxuICAgICAgICAgICAgaXNDbG9zaW5nICAgICAgPSAoaXNBY3RpdmUgJiYgaXNBbmltYXRpbmcpXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKChpc0FjdGl2ZSB8fCBpc09wZW5pbmcpICYmICFpc0Nsb3NpbmcpIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ2xvc2luZyBhY2NvcmRpb24gY29udGVudCcsICRhY3RpdmVDb250ZW50KTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uQ2xvc2luZy5jYWxsKCRhY3RpdmVDb250ZW50KTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uQ2hhbmdpbmcuY2FsbCgkYWN0aXZlQ29udGVudCk7XG4gICAgICAgICAgICAkYWN0aXZlVGl0bGVcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hY3RpdmUpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkYWN0aXZlQ29udGVudFxuICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLmFuaW1hdGluZylcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmFuaW1hdGVDaGlsZHJlbikge1xuICAgICAgICAgICAgICBpZigkLmZuLnRyYW5zaXRpb24gIT09IHVuZGVmaW5lZCAmJiAkbW9kdWxlLnRyYW5zaXRpb24oJ2lzIHN1cHBvcnRlZCcpKSB7XG4gICAgICAgICAgICAgICAgJGFjdGl2ZUNvbnRlbnRcbiAgICAgICAgICAgICAgICAgIC5jaGlsZHJlbigpXG4gICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKHtcbiAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb24gICA6ICdmYWRlIG91dCcsXG4gICAgICAgICAgICAgICAgICAgICAgcXVldWUgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICB1c2VGYWlsU2FmZSA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgZGVidWcgICAgICAgOiBzZXR0aW5ncy5kZWJ1ZyxcbiAgICAgICAgICAgICAgICAgICAgICB2ZXJib3NlICAgICA6IHNldHRpbmdzLnZlcmJvc2UsXG4gICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb24gICAgOiBzZXR0aW5ncy5kdXJhdGlvblxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkYWN0aXZlQ29udGVudFxuICAgICAgICAgICAgICAgICAgLmNoaWxkcmVuKClcbiAgICAgICAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDBcbiAgICAgICAgICAgICAgICAgICAgfSwgc2V0dGluZ3MuZHVyYXRpb24sIG1vZHVsZS5yZXNldE9wYWNpdHkpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkYWN0aXZlQ29udGVudFxuICAgICAgICAgICAgICAuc2xpZGVVcChzZXR0aW5ncy5kdXJhdGlvbiwgc2V0dGluZ3MuZWFzaW5nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAkYWN0aXZlQ29udGVudFxuICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hbmltYXRpbmcpXG4gICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSlcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnJlc2V0LmRpc3BsYXkuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5vbkNsb3NlLmNhbGwodGhpcyk7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3Mub25DaGFuZ2UuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xvc2VPdGhlcnM6IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAkYWN0aXZlVGl0bGUgPSAoaW5kZXggIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyAkdGl0bGUuZXEoaW5kZXgpXG4gICAgICAgICAgICAgIDogJCh0aGlzKS5jbG9zZXN0KHNlbGVjdG9yLnRpdGxlKSxcbiAgICAgICAgICAgICRwYXJlbnRUaXRsZXMgICAgPSAkYWN0aXZlVGl0bGUucGFyZW50cyhzZWxlY3Rvci5jb250ZW50KS5wcmV2KHNlbGVjdG9yLnRpdGxlKSxcbiAgICAgICAgICAgICRhY3RpdmVBY2NvcmRpb24gPSAkYWN0aXZlVGl0bGUuY2xvc2VzdChzZWxlY3Rvci5hY2NvcmRpb24pLFxuICAgICAgICAgICAgYWN0aXZlU2VsZWN0b3IgICA9IHNlbGVjdG9yLnRpdGxlICsgJy4nICsgY2xhc3NOYW1lLmFjdGl2ZSArICc6dmlzaWJsZScsXG4gICAgICAgICAgICBhY3RpdmVDb250ZW50ICAgID0gc2VsZWN0b3IuY29udGVudCArICcuJyArIGNsYXNzTmFtZS5hY3RpdmUgKyAnOnZpc2libGUnLFxuICAgICAgICAgICAgJG9wZW5UaXRsZXMsXG4gICAgICAgICAgICAkbmVzdGVkVGl0bGVzLFxuICAgICAgICAgICAgJG9wZW5Db250ZW50c1xuICAgICAgICAgIDtcbiAgICAgICAgICBpZihzZXR0aW5ncy5jbG9zZU5lc3RlZCkge1xuICAgICAgICAgICAgJG9wZW5UaXRsZXMgICA9ICRhY3RpdmVBY2NvcmRpb24uZmluZChhY3RpdmVTZWxlY3Rvcikubm90KCRwYXJlbnRUaXRsZXMpO1xuICAgICAgICAgICAgJG9wZW5Db250ZW50cyA9ICRvcGVuVGl0bGVzLm5leHQoJGNvbnRlbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICRvcGVuVGl0bGVzICAgPSAkYWN0aXZlQWNjb3JkaW9uLmZpbmQoYWN0aXZlU2VsZWN0b3IpLm5vdCgkcGFyZW50VGl0bGVzKTtcbiAgICAgICAgICAgICRuZXN0ZWRUaXRsZXMgPSAkYWN0aXZlQWNjb3JkaW9uLmZpbmQoYWN0aXZlQ29udGVudCkuZmluZChhY3RpdmVTZWxlY3Rvcikubm90KCRwYXJlbnRUaXRsZXMpO1xuICAgICAgICAgICAgJG9wZW5UaXRsZXMgICA9ICRvcGVuVGl0bGVzLm5vdCgkbmVzdGVkVGl0bGVzKTtcbiAgICAgICAgICAgICRvcGVuQ29udGVudHMgPSAkb3BlblRpdGxlcy5uZXh0KCRjb250ZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoICgkb3BlblRpdGxlcy5sZW5ndGggPiAwKSApIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRXhjbHVzaXZlIGVuYWJsZWQsIGNsb3Npbmcgb3RoZXIgY29udGVudCcsICRvcGVuVGl0bGVzKTtcbiAgICAgICAgICAgICRvcGVuVGl0bGVzXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJG9wZW5Db250ZW50c1xuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFuaW1hdGluZylcbiAgICAgICAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmFuaW1hdGVDaGlsZHJlbikge1xuICAgICAgICAgICAgICBpZigkLmZuLnRyYW5zaXRpb24gIT09IHVuZGVmaW5lZCAmJiAkbW9kdWxlLnRyYW5zaXRpb24oJ2lzIHN1cHBvcnRlZCcpKSB7XG4gICAgICAgICAgICAgICAgJG9wZW5Db250ZW50c1xuICAgICAgICAgICAgICAgICAgLmNoaWxkcmVuKClcbiAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oe1xuICAgICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbiAgIDogJ2ZhZGUgb3V0JyxcbiAgICAgICAgICAgICAgICAgICAgICB1c2VGYWlsU2FmZSA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgZGVidWcgICAgICAgOiBzZXR0aW5ncy5kZWJ1ZyxcbiAgICAgICAgICAgICAgICAgICAgICB2ZXJib3NlICAgICA6IHNldHRpbmdzLnZlcmJvc2UsXG4gICAgICAgICAgICAgICAgICAgICAgZHVyYXRpb24gICAgOiBzZXR0aW5ncy5kdXJhdGlvblxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkb3BlbkNvbnRlbnRzXG4gICAgICAgICAgICAgICAgICAuY2hpbGRyZW4oKVxuICAgICAgICAgICAgICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMFxuICAgICAgICAgICAgICAgICAgICB9LCBzZXR0aW5ncy5kdXJhdGlvbiwgbW9kdWxlLnJlc2V0T3BhY2l0eSlcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRvcGVuQ29udGVudHNcbiAgICAgICAgICAgICAgLnNsaWRlVXAoc2V0dGluZ3MuZHVyYXRpb24gLCBzZXR0aW5ncy5lYXNpbmcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnJlc2V0LmRpc3BsYXkuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXQ6IHtcblxuICAgICAgICAgIGRpc3BsYXk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlbW92aW5nIGlubGluZSBkaXNwbGF5IGZyb20gZWxlbWVudCcsIHRoaXMpO1xuICAgICAgICAgICAgJCh0aGlzKS5jc3MoJ2Rpc3BsYXknLCAnJyk7XG4gICAgICAgICAgICBpZiggJCh0aGlzKS5hdHRyKCdzdHlsZScpID09PSAnJykge1xuICAgICAgICAgICAgICAkKHRoaXMpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ3N0eWxlJywgJycpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ3N0eWxlJylcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBvcGFjaXR5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyBpbmxpbmUgb3BhY2l0eSBmcm9tIGVsZW1lbnQnLCB0aGlzKTtcbiAgICAgICAgICAgICQodGhpcykuY3NzKCdvcGFjaXR5JywgJycpO1xuICAgICAgICAgICAgaWYoICQodGhpcykuYXR0cignc3R5bGUnKSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgJCh0aGlzKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdzdHlsZScsICcnKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVBdHRyKCdzdHlsZScpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dGluZzogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NoYW5naW5nIHNldHRpbmcnLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZigkLmlzUGxhaW5PYmplY3Qoc2V0dGluZ3NbbmFtZV0pKSB7XG4gICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzW25hbWVdLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3NbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZ3NbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnRlcm5hbDogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NoYW5naW5nIGludGVybmFsJywgbmFtZSwgdmFsdWUpO1xuICAgICAgICAgIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIG1vZHVsZSwgbmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVtuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlYnVnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHZlcmJvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MudmVyYm9zZSAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZS5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQpIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvciA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5lcnJvciwgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUsXG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICBwcmV2aW91c1RpbWUgID0gdGltZSB8fCBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSA9IGN1cnJlbnRUaW1lIC0gcHJldmlvdXNUaW1lO1xuICAgICAgICAgICAgICB0aW1lICAgICAgICAgID0gY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIHBlcmZvcm1hbmNlLnB1c2goe1xuICAgICAgICAgICAgICAgICdOYW1lJyAgICAgICAgICAgOiBtZXNzYWdlWzBdLFxuICAgICAgICAgICAgICAgICdBcmd1bWVudHMnICAgICAgOiBbXS5zbGljZS5jYWxsKG1lc3NhZ2UsIDEpIHx8ICcnLFxuICAgICAgICAgICAgICAgICdFbGVtZW50JyAgICAgICAgOiBlbGVtZW50LFxuICAgICAgICAgICAgICAgICdFeGVjdXRpb24gVGltZScgOiBleGVjdXRpb25UaW1lXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UudGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS5kaXNwbGF5LCA1MDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlzcGxheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdGl0bGUgPSBzZXR0aW5ncy5uYW1lICsgJzonLFxuICAgICAgICAgICAgICB0b3RhbFRpbWUgPSAwXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICB0aW1lID0gZmFsc2U7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgICQuZWFjaChwZXJmb3JtYW5jZSwgZnVuY3Rpb24oaW5kZXgsIGRhdGEpIHtcbiAgICAgICAgICAgICAgdG90YWxUaW1lICs9IGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRpdGxlICs9ICcgJyArIHRvdGFsVGltZSArICdtcyc7XG4gICAgICAgICAgICBpZihtb2R1bGVTZWxlY3Rvcikge1xuICAgICAgICAgICAgICB0aXRsZSArPSAnIFxcJycgKyBtb2R1bGVTZWxlY3RvciArICdcXCcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIChjb25zb2xlLmdyb3VwICE9PSB1bmRlZmluZWQgfHwgY29uc29sZS50YWJsZSAhPT0gdW5kZWZpbmVkKSAmJiBwZXJmb3JtYW5jZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQodGl0bGUpO1xuICAgICAgICAgICAgICBpZihjb25zb2xlLnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS50YWJsZShwZXJmb3JtYW5jZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YVsnTmFtZSddICsgJzogJyArIGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ10rJ21zJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGVyZm9ybWFuY2UgPSBbXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGludm9rZTogZnVuY3Rpb24ocXVlcnksIHBhc3NlZEFyZ3VtZW50cywgY29udGV4dCkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgb2JqZWN0ID0gaW5zdGFuY2UsXG4gICAgICAgICAgICBtYXhEZXB0aCxcbiAgICAgICAgICAgIGZvdW5kLFxuICAgICAgICAgICAgcmVzcG9uc2VcbiAgICAgICAgICA7XG4gICAgICAgICAgcGFzc2VkQXJndW1lbnRzID0gcGFzc2VkQXJndW1lbnRzIHx8IHF1ZXJ5QXJndW1lbnRzO1xuICAgICAgICAgIGNvbnRleHQgICAgICAgICA9IGVsZW1lbnQgICAgICAgICB8fCBjb250ZXh0O1xuICAgICAgICAgIGlmKHR5cGVvZiBxdWVyeSA9PSAnc3RyaW5nJyAmJiBvYmplY3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcXVlcnkgICAgPSBxdWVyeS5zcGxpdCgvW1xcLiBdLyk7XG4gICAgICAgICAgICBtYXhEZXB0aCA9IHF1ZXJ5Lmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAkLmVhY2gocXVlcnksIGZ1bmN0aW9uKGRlcHRoLCB2YWx1ZSkge1xuICAgICAgICAgICAgICB2YXIgY2FtZWxDYXNlVmFsdWUgPSAoZGVwdGggIT0gbWF4RGVwdGgpXG4gICAgICAgICAgICAgICAgPyB2YWx1ZSArIHF1ZXJ5W2RlcHRoICsgMV0uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBxdWVyeVtkZXB0aCArIDFdLnNsaWNlKDEpXG4gICAgICAgICAgICAgICAgOiBxdWVyeVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFtjYW1lbENhc2VWYWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFtjYW1lbENhc2VWYWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggJC5pc1BsYWluT2JqZWN0KCBvYmplY3RbdmFsdWVdICkgJiYgKGRlcHRoICE9IG1heERlcHRoKSApIHtcbiAgICAgICAgICAgICAgICBvYmplY3QgPSBvYmplY3RbdmFsdWVdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoIG9iamVjdFt2YWx1ZV0gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5tZXRob2QsIHF1ZXJ5KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoICQuaXNGdW5jdGlvbiggZm91bmQgKSApIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQuYXBwbHkoY29udGV4dCwgcGFzc2VkQXJndW1lbnRzKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihmb3VuZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGZvdW5kO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZigkLmlzQXJyYXkocmV0dXJuZWRWYWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUucHVzaChyZXNwb25zZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYocmV0dXJuZWRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlID0gW3JldHVybmVkVmFsdWUsIHJlc3BvbnNlXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlID0gcmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmb3VuZDtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGlmKG1ldGhvZEludm9rZWQpIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICAgIH1cbiAgICAgICAgbW9kdWxlLmludm9rZShxdWVyeSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGluc3RhbmNlLmludm9rZSgnZGVzdHJveScpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICB9XG4gICAgfSlcbiAgO1xuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xufTtcblxuJC5mbi5hY2NvcmRpb24uc2V0dGluZ3MgPSB7XG5cbiAgbmFtZSAgICAgICAgICAgIDogJ0FjY29yZGlvbicsXG4gIG5hbWVzcGFjZSAgICAgICA6ICdhY2NvcmRpb24nLFxuXG4gIHNpbGVudCAgICAgICAgICA6IGZhbHNlLFxuICBkZWJ1ZyAgICAgICAgICAgOiBmYWxzZSxcbiAgdmVyYm9zZSAgICAgICAgIDogZmFsc2UsXG4gIHBlcmZvcm1hbmNlICAgICA6IHRydWUsXG5cbiAgb24gICAgICAgICAgICAgIDogJ2NsaWNrJywgLy8gZXZlbnQgb24gdGl0bGUgdGhhdCBvcGVucyBhY2NvcmRpb25cblxuICBvYnNlcnZlQ2hhbmdlcyAgOiB0cnVlLCAgLy8gd2hldGhlciBhY2NvcmRpb24gc2hvdWxkIGF1dG9tYXRpY2FsbHkgcmVmcmVzaCBvbiBET00gaW5zZXJ0aW9uXG5cbiAgZXhjbHVzaXZlICAgICAgIDogdHJ1ZSwgIC8vIHdoZXRoZXIgYSBzaW5nbGUgYWNjb3JkaW9uIGNvbnRlbnQgcGFuZWwgc2hvdWxkIGJlIG9wZW4gYXQgb25jZVxuICBjb2xsYXBzaWJsZSAgICAgOiB0cnVlLCAgLy8gd2hldGhlciBhY2NvcmRpb24gY29udGVudCBjYW4gYmUgY2xvc2VkXG4gIGNsb3NlTmVzdGVkICAgICA6IGZhbHNlLCAvLyB3aGV0aGVyIG5lc3RlZCBjb250ZW50IHNob3VsZCBiZSBjbG9zZWQgd2hlbiBhIHBhbmVsIGlzIGNsb3NlZFxuICBhbmltYXRlQ2hpbGRyZW4gOiB0cnVlLCAgLy8gd2hldGhlciBjaGlsZHJlbiBvcGFjaXR5IHNob3VsZCBiZSBhbmltYXRlZFxuXG4gIGR1cmF0aW9uICAgICAgICA6IDM1MCwgLy8gZHVyYXRpb24gb2YgYW5pbWF0aW9uXG4gIGVhc2luZyAgICAgICAgICA6ICdlYXNlT3V0UXVhZCcsIC8vIGVhc2luZyBlcXVhdGlvbiBmb3IgYW5pbWF0aW9uXG5cbiAgb25PcGVuaW5nICAgICAgIDogZnVuY3Rpb24oKXt9LCAvLyBjYWxsYmFjayBiZWZvcmUgb3BlbiBhbmltYXRpb25cbiAgb25DbG9zaW5nICAgICAgIDogZnVuY3Rpb24oKXt9LCAvLyBjYWxsYmFjayBiZWZvcmUgY2xvc2luZyBhbmltYXRpb25cbiAgb25DaGFuZ2luZyAgICAgIDogZnVuY3Rpb24oKXt9LCAvLyBjYWxsYmFjayBiZWZvcmUgY2xvc2luZyBvciBvcGVuaW5nIGFuaW1hdGlvblxuXG4gIG9uT3BlbiAgICAgICAgICA6IGZ1bmN0aW9uKCl7fSwgLy8gY2FsbGJhY2sgYWZ0ZXIgb3BlbiBhbmltYXRpb25cbiAgb25DbG9zZSAgICAgICAgIDogZnVuY3Rpb24oKXt9LCAvLyBjYWxsYmFjayBhZnRlciBjbG9zaW5nIGFuaW1hdGlvblxuICBvbkNoYW5nZSAgICAgICAgOiBmdW5jdGlvbigpe30sIC8vIGNhbGxiYWNrIGFmdGVyIGNsb3Npbmcgb3Igb3BlbmluZyBhbmltYXRpb25cblxuICBlcnJvcjoge1xuICAgIG1ldGhvZCA6ICdUaGUgbWV0aG9kIHlvdSBjYWxsZWQgaXMgbm90IGRlZmluZWQnXG4gIH0sXG5cbiAgY2xhc3NOYW1lICAgOiB7XG4gICAgYWN0aXZlICAgIDogJ2FjdGl2ZScsXG4gICAgYW5pbWF0aW5nIDogJ2FuaW1hdGluZydcbiAgfSxcblxuICBzZWxlY3RvciAgICA6IHtcbiAgICBhY2NvcmRpb24gOiAnLmFjY29yZGlvbicsXG4gICAgdGl0bGUgICAgIDogJy50aXRsZScsXG4gICAgdHJpZ2dlciAgIDogJy50aXRsZScsXG4gICAgY29udGVudCAgIDogJy5jb250ZW50J1xuICB9XG5cbn07XG5cbi8vIEFkZHMgZWFzaW5nXG4kLmV4dGVuZCggJC5lYXNpbmcsIHtcbiAgZWFzZU91dFF1YWQ6IGZ1bmN0aW9uICh4LCB0LCBiLCBjLCBkKSB7XG4gICAgcmV0dXJuIC1jICoodC89ZCkqKHQtMikgKyBiO1xuICB9XG59KTtcblxufSkoIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCApO1xuXG5cbi8qIVxuICogIyBTZW1hbnRpYyBVSSAyLjQuMCAtIENoZWNrYm94XG4gKiBodHRwOi8vZ2l0aHViLmNvbS9zZW1hbnRpYy1vcmcvc2VtYW50aWMtdWkvXG4gKlxuICpcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuICpcbiAqL1xuXG47KGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHtcblxuJ3VzZSBzdHJpY3QnO1xuXG53aW5kb3cgPSAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoKVxuICA/IHdpbmRvd1xuICA6ICh0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aClcbiAgICA/IHNlbGZcbiAgICA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKClcbjtcblxuJC5mbi5jaGVja2JveCA9IGZ1bmN0aW9uKHBhcmFtZXRlcnMpIHtcbiAgdmFyXG4gICAgJGFsbE1vZHVsZXMgICAgPSAkKHRoaXMpLFxuICAgIG1vZHVsZVNlbGVjdG9yID0gJGFsbE1vZHVsZXMuc2VsZWN0b3IgfHwgJycsXG5cbiAgICB0aW1lICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgID0gW10sXG5cbiAgICBxdWVyeSAgICAgICAgICA9IGFyZ3VtZW50c1swXSxcbiAgICBtZXRob2RJbnZva2VkICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLFxuICAgIHJldHVybmVkVmFsdWVcbiAgO1xuXG4gICRhbGxNb2R1bGVzXG4gICAgLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXJcbiAgICAgICAgc2V0dGluZ3MgICAgICAgID0gJC5leHRlbmQodHJ1ZSwge30sICQuZm4uY2hlY2tib3guc2V0dGluZ3MsIHBhcmFtZXRlcnMpLFxuXG4gICAgICAgIGNsYXNzTmFtZSAgICAgICA9IHNldHRpbmdzLmNsYXNzTmFtZSxcbiAgICAgICAgbmFtZXNwYWNlICAgICAgID0gc2V0dGluZ3MubmFtZXNwYWNlLFxuICAgICAgICBzZWxlY3RvciAgICAgICAgPSBzZXR0aW5ncy5zZWxlY3RvcixcbiAgICAgICAgZXJyb3IgICAgICAgICAgID0gc2V0dGluZ3MuZXJyb3IsXG5cbiAgICAgICAgZXZlbnROYW1lc3BhY2UgID0gJy4nICsgbmFtZXNwYWNlLFxuICAgICAgICBtb2R1bGVOYW1lc3BhY2UgPSAnbW9kdWxlLScgKyBuYW1lc3BhY2UsXG5cbiAgICAgICAgJG1vZHVsZSAgICAgICAgID0gJCh0aGlzKSxcbiAgICAgICAgJGxhYmVsICAgICAgICAgID0gJCh0aGlzKS5jaGlsZHJlbihzZWxlY3Rvci5sYWJlbCksXG4gICAgICAgICRpbnB1dCAgICAgICAgICA9ICQodGhpcykuY2hpbGRyZW4oc2VsZWN0b3IuaW5wdXQpLFxuICAgICAgICBpbnB1dCAgICAgICAgICAgPSAkaW5wdXRbMF0sXG5cbiAgICAgICAgaW5pdGlhbExvYWQgICAgID0gZmFsc2UsXG4gICAgICAgIHNob3J0Y3V0UHJlc3NlZCA9IGZhbHNlLFxuICAgICAgICBpbnN0YW5jZSAgICAgICAgPSAkbW9kdWxlLmRhdGEobW9kdWxlTmFtZXNwYWNlKSxcblxuICAgICAgICBvYnNlcnZlcixcbiAgICAgICAgZWxlbWVudCAgICAgICAgID0gdGhpcyxcbiAgICAgICAgbW9kdWxlXG4gICAgICA7XG5cbiAgICAgIG1vZHVsZSAgICAgID0ge1xuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdJbml0aWFsaXppbmcgY2hlY2tib3gnLCBzZXR0aW5ncyk7XG5cbiAgICAgICAgICBtb2R1bGUuY3JlYXRlLmxhYmVsKCk7XG4gICAgICAgICAgbW9kdWxlLmJpbmQuZXZlbnRzKCk7XG5cbiAgICAgICAgICBtb2R1bGUuc2V0LnRhYmJhYmxlKCk7XG4gICAgICAgICAgbW9kdWxlLmhpZGUuaW5wdXQoKTtcblxuICAgICAgICAgIG1vZHVsZS5vYnNlcnZlQ2hhbmdlcygpO1xuICAgICAgICAgIG1vZHVsZS5pbnN0YW50aWF0ZSgpO1xuICAgICAgICAgIG1vZHVsZS5zZXR1cCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluc3RhbnRpYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU3RvcmluZyBpbnN0YW5jZSBvZiBtb2R1bGUnLCBtb2R1bGUpO1xuICAgICAgICAgIGluc3RhbmNlID0gbW9kdWxlO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5kYXRhKG1vZHVsZU5hbWVzcGFjZSwgbW9kdWxlKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRGVzdHJveWluZyBtb2R1bGUnKTtcbiAgICAgICAgICBtb2R1bGUudW5iaW5kLmV2ZW50cygpO1xuICAgICAgICAgIG1vZHVsZS5zaG93LmlucHV0KCk7XG4gICAgICAgICAgJG1vZHVsZS5yZW1vdmVEYXRhKG1vZHVsZU5hbWVzcGFjZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZml4OiB7XG4gICAgICAgICAgcmVmZXJlbmNlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCAkbW9kdWxlLmlzKHNlbGVjdG9yLmlucHV0KSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdCZWhhdmlvciBjYWxsZWQgb24gPGlucHV0PiBhZGp1c3RpbmcgaW52b2tlZCBlbGVtZW50Jyk7XG4gICAgICAgICAgICAgICRtb2R1bGUgPSAkbW9kdWxlLmNsb3Nlc3Qoc2VsZWN0b3IuY2hlY2tib3gpO1xuICAgICAgICAgICAgICBtb2R1bGUucmVmcmVzaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXR1cDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnNldC5pbml0aWFsTG9hZCgpO1xuICAgICAgICAgIGlmKCBtb2R1bGUuaXMuaW5kZXRlcm1pbmF0ZSgpICkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdJbml0aWFsIHZhbHVlIGlzIGluZGV0ZXJtaW5hdGUnKTtcbiAgICAgICAgICAgIG1vZHVsZS5pbmRldGVybWluYXRlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoIG1vZHVsZS5pcy5jaGVja2VkKCkgKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0luaXRpYWwgdmFsdWUgaXMgY2hlY2tlZCcpO1xuICAgICAgICAgICAgbW9kdWxlLmNoZWNrKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdJbml0aWFsIHZhbHVlIGlzIHVuY2hlY2tlZCcpO1xuICAgICAgICAgICAgbW9kdWxlLnVuY2hlY2soKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS5pbml0aWFsTG9hZCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICRsYWJlbCA9ICRtb2R1bGUuY2hpbGRyZW4oc2VsZWN0b3IubGFiZWwpO1xuICAgICAgICAgICRpbnB1dCA9ICRtb2R1bGUuY2hpbGRyZW4oc2VsZWN0b3IuaW5wdXQpO1xuICAgICAgICAgIGlucHV0ICA9ICRpbnB1dFswXTtcbiAgICAgICAgfSxcblxuICAgICAgICBoaWRlOiB7XG4gICAgICAgICAgaW5wdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ01vZGlmeWluZyA8aW5wdXQ+IHotaW5kZXggdG8gYmUgdW5zZWxlY3RhYmxlJyk7XG4gICAgICAgICAgICAkaW5wdXQuYWRkQ2xhc3MoY2xhc3NOYW1lLmhpZGRlbik7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzaG93OiB7XG4gICAgICAgICAgaW5wdXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ01vZGlmeWluZyA8aW5wdXQ+IHotaW5kZXggdG8gYmUgc2VsZWN0YWJsZScpO1xuICAgICAgICAgICAgJGlucHV0LnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5oaWRkZW4pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvYnNlcnZlQ2hhbmdlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoJ011dGF0aW9uT2JzZXJ2ZXInIGluIHdpbmRvdykge1xuICAgICAgICAgICAgb2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbihtdXRhdGlvbnMpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdET00gdHJlZSBtb2RpZmllZCwgdXBkYXRpbmcgc2VsZWN0b3IgY2FjaGUnKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlZnJlc2goKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZShlbGVtZW50LCB7XG4gICAgICAgICAgICAgIGNoaWxkTGlzdCA6IHRydWUsXG4gICAgICAgICAgICAgIHN1YnRyZWUgICA6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZXR0aW5nIHVwIG11dGF0aW9uIG9ic2VydmVyJywgb2JzZXJ2ZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBhdHRhY2hFdmVudHM6IGZ1bmN0aW9uKHNlbGVjdG9yLCBldmVudCkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgJGVsZW1lbnQgPSAkKHNlbGVjdG9yKVxuICAgICAgICAgIDtcbiAgICAgICAgICBldmVudCA9ICQuaXNGdW5jdGlvbihtb2R1bGVbZXZlbnRdKVxuICAgICAgICAgICAgPyBtb2R1bGVbZXZlbnRdXG4gICAgICAgICAgICA6IG1vZHVsZS50b2dnbGVcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYoJGVsZW1lbnQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBdHRhY2hpbmcgY2hlY2tib3ggZXZlbnRzIHRvIGVsZW1lbnQnLCBzZWxlY3RvciwgZXZlbnQpO1xuICAgICAgICAgICAgJGVsZW1lbnRcbiAgICAgICAgICAgICAgLm9uKCdjbGljaycgKyBldmVudE5hbWVzcGFjZSwgZXZlbnQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm5vdEZvdW5kKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXZlbnQ6IHtcbiAgICAgICAgICBjbGljazogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkdGFyZ2V0ID0gJChldmVudC50YXJnZXQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZiggJHRhcmdldC5pcyhzZWxlY3Rvci5pbnB1dCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdVc2luZyBkZWZhdWx0IGNoZWNrIGFjdGlvbiBvbiBpbml0aWFsaXplZCBjaGVja2JveCcpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggJHRhcmdldC5pcyhzZWxlY3Rvci5saW5rKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDbGlja2luZyBsaW5rIGluc2lkZSBjaGVja2JveCwgc2tpcHBpbmcgdG9nZ2xlJyk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS50b2dnbGUoKTtcbiAgICAgICAgICAgICRpbnB1dC5mb2N1cygpO1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGtleWRvd246IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAga2V5ICAgICA9IGV2ZW50LndoaWNoLFxuICAgICAgICAgICAgICBrZXlDb2RlID0ge1xuICAgICAgICAgICAgICAgIGVudGVyICA6IDEzLFxuICAgICAgICAgICAgICAgIHNwYWNlICA6IDMyLFxuICAgICAgICAgICAgICAgIGVzY2FwZSA6IDI3XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKGtleSA9PSBrZXlDb2RlLmVzY2FwZSkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRXNjYXBlIGtleSBwcmVzc2VkIGJsdXJyaW5nIGZpZWxkJyk7XG4gICAgICAgICAgICAgICRpbnB1dC5ibHVyKCk7XG4gICAgICAgICAgICAgIHNob3J0Y3V0UHJlc3NlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKCFldmVudC5jdHJsS2V5ICYmICgga2V5ID09IGtleUNvZGUuc3BhY2UgfHwga2V5ID09IGtleUNvZGUuZW50ZXIpICkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRW50ZXIvc3BhY2Uga2V5IHByZXNzZWQsIHRvZ2dsaW5nIGNoZWNrYm94Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS50b2dnbGUoKTtcbiAgICAgICAgICAgICAgc2hvcnRjdXRQcmVzc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBzaG9ydGN1dFByZXNzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGtleXVwOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgaWYoc2hvcnRjdXRQcmVzc2VkKSB7XG4gICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoZWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiggIW1vZHVsZS5zaG91bGQuYWxsb3dDaGVjaygpICkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NoZWNraW5nIGNoZWNrYm94JywgJGlucHV0KTtcbiAgICAgICAgICBtb2R1bGUuc2V0LmNoZWNrZWQoKTtcbiAgICAgICAgICBpZiggIW1vZHVsZS5zaG91bGQuaWdub3JlQ2FsbGJhY2tzKCkgKSB7XG4gICAgICAgICAgICBzZXR0aW5ncy5vbkNoZWNrZWQuY2FsbChpbnB1dCk7XG4gICAgICAgICAgICBzZXR0aW5ncy5vbkNoYW5nZS5jYWxsKGlucHV0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgdW5jaGVjazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoICFtb2R1bGUuc2hvdWxkLmFsbG93VW5jaGVjaygpICkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ1VuY2hlY2tpbmcgY2hlY2tib3gnKTtcbiAgICAgICAgICBtb2R1bGUuc2V0LnVuY2hlY2tlZCgpO1xuICAgICAgICAgIGlmKCAhbW9kdWxlLnNob3VsZC5pZ25vcmVDYWxsYmFja3MoKSApIHtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uVW5jaGVja2VkLmNhbGwoaW5wdXQpO1xuICAgICAgICAgICAgc2V0dGluZ3Mub25DaGFuZ2UuY2FsbChpbnB1dCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGluZGV0ZXJtaW5hdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCBtb2R1bGUuc2hvdWxkLmFsbG93SW5kZXRlcm1pbmF0ZSgpICkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDaGVja2JveCBpcyBhbHJlYWR5IGluZGV0ZXJtaW5hdGUnKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdNYWtpbmcgY2hlY2tib3ggaW5kZXRlcm1pbmF0ZScpO1xuICAgICAgICAgIG1vZHVsZS5zZXQuaW5kZXRlcm1pbmF0ZSgpO1xuICAgICAgICAgIGlmKCAhbW9kdWxlLnNob3VsZC5pZ25vcmVDYWxsYmFja3MoKSApIHtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uSW5kZXRlcm1pbmF0ZS5jYWxsKGlucHV0KTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uQ2hhbmdlLmNhbGwoaW5wdXQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXRlcm1pbmF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIG1vZHVsZS5zaG91bGQuYWxsb3dEZXRlcm1pbmF0ZSgpICkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDaGVja2JveCBpcyBhbHJlYWR5IGRldGVybWluYXRlJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnTWFraW5nIGNoZWNrYm94IGRldGVybWluYXRlJyk7XG4gICAgICAgICAgbW9kdWxlLnNldC5kZXRlcm1pbmF0ZSgpO1xuICAgICAgICAgIGlmKCAhbW9kdWxlLnNob3VsZC5pZ25vcmVDYWxsYmFja3MoKSApIHtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uRGV0ZXJtaW5hdGUuY2FsbChpbnB1dCk7XG4gICAgICAgICAgICBzZXR0aW5ncy5vbkNoYW5nZS5jYWxsKGlucHV0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZW5hYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiggbW9kdWxlLmlzLmVuYWJsZWQoKSApIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ2hlY2tib3ggaXMgYWxyZWFkeSBlbmFibGVkJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRW5hYmxpbmcgY2hlY2tib3gnKTtcbiAgICAgICAgICBtb2R1bGUuc2V0LmVuYWJsZWQoKTtcbiAgICAgICAgICBzZXR0aW5ncy5vbkVuYWJsZS5jYWxsKGlucHV0KTtcbiAgICAgICAgICAvLyBwcmVzZXJ2ZSBsZWdhY3kgY2FsbGJhY2tzXG4gICAgICAgICAgc2V0dGluZ3Mub25FbmFibGVkLmNhbGwoaW5wdXQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCBtb2R1bGUuaXMuZGlzYWJsZWQoKSApIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ2hlY2tib3ggaXMgYWxyZWFkeSBkaXNhYmxlZCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0Rpc2FibGluZyBjaGVja2JveCcpO1xuICAgICAgICAgIG1vZHVsZS5zZXQuZGlzYWJsZWQoKTtcbiAgICAgICAgICBzZXR0aW5ncy5vbkRpc2FibGUuY2FsbChpbnB1dCk7XG4gICAgICAgICAgLy8gcHJlc2VydmUgbGVnYWN5IGNhbGxiYWNrc1xuICAgICAgICAgIHNldHRpbmdzLm9uRGlzYWJsZWQuY2FsbChpbnB1dCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0OiB7XG4gICAgICAgICAgcmFkaW9zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBuYW1lID0gbW9kdWxlLmdldC5uYW1lKClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiAkKCdpbnB1dFtuYW1lPVwiJyArIG5hbWUgKyAnXCJdJykuY2xvc2VzdChzZWxlY3Rvci5jaGVja2JveCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvdGhlclJhZGlvczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLmdldC5yYWRpb3MoKS5ub3QoJG1vZHVsZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBuYW1lOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaW5wdXQuYXR0cignbmFtZScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpczoge1xuICAgICAgICAgIGluaXRpYWxMb2FkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBpbml0aWFsTG9hZDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJhZGlvOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoJGlucHV0Lmhhc0NsYXNzKGNsYXNzTmFtZS5yYWRpbykgfHwgJGlucHV0LmF0dHIoJ3R5cGUnKSA9PSAncmFkaW8nKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGluZGV0ZXJtaW5hdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRpbnB1dC5wcm9wKCdpbmRldGVybWluYXRlJykgIT09IHVuZGVmaW5lZCAmJiAkaW5wdXQucHJvcCgnaW5kZXRlcm1pbmF0ZScpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2hlY2tlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGlucHV0LnByb3AoJ2NoZWNrZWQnKSAhPT0gdW5kZWZpbmVkICYmICRpbnB1dC5wcm9wKCdjaGVja2VkJyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGlucHV0LnByb3AoJ2Rpc2FibGVkJykgIT09IHVuZGVmaW5lZCAmJiAkaW5wdXQucHJvcCgnZGlzYWJsZWQnKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVuYWJsZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICFtb2R1bGUuaXMuZGlzYWJsZWQoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRldGVybWluYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAhbW9kdWxlLmlzLmluZGV0ZXJtaW5hdGUoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVuY2hlY2tlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gIW1vZHVsZS5pcy5jaGVja2VkKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNob3VsZDoge1xuICAgICAgICAgIGFsbG93Q2hlY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmlzLmRldGVybWluYXRlKCkgJiYgbW9kdWxlLmlzLmNoZWNrZWQoKSAmJiAhbW9kdWxlLnNob3VsZC5mb3JjZUNhbGxiYWNrcygpICkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Nob3VsZCBub3QgYWxsb3cgY2hlY2ssIGNoZWNrYm94IGlzIGFscmVhZHkgY2hlY2tlZCcpO1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5iZWZvcmVDaGVja2VkLmFwcGx5KGlucHV0KSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaG91bGQgbm90IGFsbG93IGNoZWNrLCBiZWZvcmVDaGVja2VkIGNhbmNlbGxlZCcpO1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFsbG93VW5jaGVjazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMuZGV0ZXJtaW5hdGUoKSAmJiBtb2R1bGUuaXMudW5jaGVja2VkKCkgJiYgIW1vZHVsZS5zaG91bGQuZm9yY2VDYWxsYmFja3MoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaG91bGQgbm90IGFsbG93IHVuY2hlY2ssIGNoZWNrYm94IGlzIGFscmVhZHkgdW5jaGVja2VkJyk7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmJlZm9yZVVuY2hlY2tlZC5hcHBseShpbnB1dCkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2hvdWxkIG5vdCBhbGxvdyB1bmNoZWNrLCBiZWZvcmVVbmNoZWNrZWQgY2FuY2VsbGVkJyk7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYWxsb3dJbmRldGVybWluYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5pbmRldGVybWluYXRlKCkgJiYgIW1vZHVsZS5zaG91bGQuZm9yY2VDYWxsYmFja3MoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaG91bGQgbm90IGFsbG93IGluZGV0ZXJtaW5hdGUsIGNoZWNrYm94IGlzIGFscmVhZHkgaW5kZXRlcm1pbmF0ZScpO1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5iZWZvcmVJbmRldGVybWluYXRlLmFwcGx5KGlucHV0KSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaG91bGQgbm90IGFsbG93IGluZGV0ZXJtaW5hdGUsIGJlZm9yZUluZGV0ZXJtaW5hdGUgY2FuY2VsbGVkJyk7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYWxsb3dEZXRlcm1pbmF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMuZGV0ZXJtaW5hdGUoKSAmJiAhbW9kdWxlLnNob3VsZC5mb3JjZUNhbGxiYWNrcygpICkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Nob3VsZCBub3QgYWxsb3cgZGV0ZXJtaW5hdGUsIGNoZWNrYm94IGlzIGFscmVhZHkgZGV0ZXJtaW5hdGUnKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoc2V0dGluZ3MuYmVmb3JlRGV0ZXJtaW5hdGUuYXBwbHkoaW5wdXQpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Nob3VsZCBub3QgYWxsb3cgZGV0ZXJtaW5hdGUsIGJlZm9yZURldGVybWluYXRlIGNhbmNlbGxlZCcpO1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvcmNlQ2FsbGJhY2tzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAobW9kdWxlLmlzLmluaXRpYWxMb2FkKCkgJiYgc2V0dGluZ3MuZmlyZU9uSW5pdCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpZ25vcmVDYWxsYmFja3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChpbml0aWFsTG9hZCAmJiAhc2V0dGluZ3MuZmlyZU9uSW5pdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNhbjoge1xuICAgICAgICAgIGNoYW5nZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gISggJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUuZGlzYWJsZWQpIHx8ICRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLnJlYWRPbmx5KSB8fCAkaW5wdXQucHJvcCgnZGlzYWJsZWQnKSB8fCAkaW5wdXQucHJvcCgncmVhZG9ubHknKSApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdW5jaGVjazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKHR5cGVvZiBzZXR0aW5ncy51bmNoZWNrYWJsZSA9PT0gJ2Jvb2xlYW4nKVxuICAgICAgICAgICAgICA/IHNldHRpbmdzLnVuY2hlY2thYmxlXG4gICAgICAgICAgICAgIDogIW1vZHVsZS5pcy5yYWRpbygpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldDoge1xuICAgICAgICAgIGluaXRpYWxMb2FkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGluaXRpYWxMb2FkID0gdHJ1ZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNoZWNrZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NldHRpbmcgY2xhc3MgdG8gY2hlY2tlZCcpO1xuICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmluZGV0ZXJtaW5hdGUpXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuY2hlY2tlZClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCBtb2R1bGUuaXMucmFkaW8oKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnVuY2hlY2tPdGhlcnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCFtb2R1bGUuaXMuaW5kZXRlcm1pbmF0ZSgpICYmIG1vZHVsZS5pcy5jaGVja2VkKCkpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdJbnB1dCBpcyBhbHJlYWR5IGNoZWNrZWQsIHNraXBwaW5nIGlucHV0IHByb3BlcnR5IGNoYW5nZScpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2V0dGluZyBzdGF0ZSB0byBjaGVja2VkJywgaW5wdXQpO1xuICAgICAgICAgICAgJGlucHV0XG4gICAgICAgICAgICAgIC5wcm9wKCdpbmRldGVybWluYXRlJywgZmFsc2UpXG4gICAgICAgICAgICAgIC5wcm9wKCdjaGVja2VkJywgdHJ1ZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS50cmlnZ2VyLmNoYW5nZSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdW5jaGVja2VkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyBjaGVja2VkIGNsYXNzJyk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuaW5kZXRlcm1pbmF0ZSlcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5jaGVja2VkKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoIW1vZHVsZS5pcy5pbmRldGVybWluYXRlKCkgJiYgIG1vZHVsZS5pcy51bmNoZWNrZWQoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdJbnB1dCBpcyBhbHJlYWR5IHVuY2hlY2tlZCcpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgc3RhdGUgdG8gdW5jaGVja2VkJyk7XG4gICAgICAgICAgICAkaW5wdXRcbiAgICAgICAgICAgICAgLnByb3AoJ2luZGV0ZXJtaW5hdGUnLCBmYWxzZSlcbiAgICAgICAgICAgICAgLnByb3AoJ2NoZWNrZWQnLCBmYWxzZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS50cmlnZ2VyLmNoYW5nZSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5kZXRlcm1pbmF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2V0dGluZyBjbGFzcyB0byBpbmRldGVybWluYXRlJyk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuaW5kZXRlcm1pbmF0ZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCBtb2R1bGUuaXMuaW5kZXRlcm1pbmF0ZSgpICkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0lucHV0IGlzIGFscmVhZHkgaW5kZXRlcm1pbmF0ZSwgc2tpcHBpbmcgaW5wdXQgcHJvcGVydHkgY2hhbmdlJyk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2V0dGluZyBzdGF0ZSB0byBpbmRldGVybWluYXRlJyk7XG4gICAgICAgICAgICAkaW5wdXRcbiAgICAgICAgICAgICAgLnByb3AoJ2luZGV0ZXJtaW5hdGUnLCB0cnVlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnRyaWdnZXIuY2hhbmdlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkZXRlcm1pbmF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3ZpbmcgaW5kZXRlcm1pbmF0ZSBjbGFzcycpO1xuICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmluZGV0ZXJtaW5hdGUpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZiggbW9kdWxlLmlzLmRldGVybWluYXRlKCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW5wdXQgaXMgYWxyZWFkeSBkZXRlcm1pbmF0ZSwgc2tpcHBpbmcgaW5wdXQgcHJvcGVydHkgY2hhbmdlJyk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2V0dGluZyBzdGF0ZSB0byBkZXRlcm1pbmF0ZScpO1xuICAgICAgICAgICAgJGlucHV0XG4gICAgICAgICAgICAgIC5wcm9wKCdpbmRldGVybWluYXRlJywgZmFsc2UpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2V0dGluZyBjbGFzcyB0byBkaXNhYmxlZCcpO1xuICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLmRpc2FibGVkKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5kaXNhYmxlZCgpICkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0lucHV0IGlzIGFscmVhZHkgZGlzYWJsZWQsIHNraXBwaW5nIGlucHV0IHByb3BlcnR5IGNoYW5nZScpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgc3RhdGUgdG8gZGlzYWJsZWQnKTtcbiAgICAgICAgICAgICRpbnB1dFxuICAgICAgICAgICAgICAucHJvcCgnZGlzYWJsZWQnLCAnZGlzYWJsZWQnKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnRyaWdnZXIuY2hhbmdlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlbmFibGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyBkaXNhYmxlZCBjbGFzcycpO1xuICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVDbGFzcyhjbGFzc05hbWUuZGlzYWJsZWQpO1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5lbmFibGVkKCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW5wdXQgaXMgYWxyZWFkeSBlbmFibGVkLCBza2lwcGluZyBpbnB1dCBwcm9wZXJ0eSBjaGFuZ2UnKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZXR0aW5nIHN0YXRlIHRvIGVuYWJsZWQnKTtcbiAgICAgICAgICAgICRpbnB1dFxuICAgICAgICAgICAgICAucHJvcCgnZGlzYWJsZWQnLCBmYWxzZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS50cmlnZ2VyLmNoYW5nZSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdGFiYmFibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FkZGluZyB0YWJpbmRleCB0byBjaGVja2JveCcpO1xuICAgICAgICAgICAgaWYoICRpbnB1dC5hdHRyKCd0YWJpbmRleCcpID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgJGlucHV0LmF0dHIoJ3RhYmluZGV4JywgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZToge1xuICAgICAgICAgIGluaXRpYWxMb2FkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGluaXRpYWxMb2FkID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHRyaWdnZXI6IHtcbiAgICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGV2ZW50cyAgICAgICA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdIVE1MRXZlbnRzJyksXG4gICAgICAgICAgICAgIGlucHV0RWxlbWVudCA9ICRpbnB1dFswXVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoaW5wdXRFbGVtZW50KSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdUcmlnZ2VyaW5nIG5hdGl2ZSBjaGFuZ2UgZXZlbnQnKTtcbiAgICAgICAgICAgICAgZXZlbnRzLmluaXRFdmVudCgnY2hhbmdlJywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgICBpbnB1dEVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuXG4gICAgICAgIGNyZWF0ZToge1xuICAgICAgICAgIGxhYmVsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCRpbnB1dC5wcmV2QWxsKHNlbGVjdG9yLmxhYmVsKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICRpbnB1dC5wcmV2KHNlbGVjdG9yLmxhYmVsKS5kZXRhY2goKS5pbnNlcnRBZnRlcigkaW5wdXQpO1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ01vdmluZyBleGlzdGluZyBsYWJlbCcsICRsYWJlbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKCAhbW9kdWxlLmhhcy5sYWJlbCgpICkge1xuICAgICAgICAgICAgICAkbGFiZWwgPSAkKCc8bGFiZWw+JykuaW5zZXJ0QWZ0ZXIoJGlucHV0KTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDcmVhdGluZyBsYWJlbCcsICRsYWJlbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGhhczoge1xuICAgICAgICAgIGxhYmVsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoJGxhYmVsLmxlbmd0aCA+IDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBiaW5kOiB7XG4gICAgICAgICAgZXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBdHRhY2hpbmcgY2hlY2tib3ggZXZlbnRzJyk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5vbignY2xpY2snICAgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LmNsaWNrKVxuICAgICAgICAgICAgICAub24oJ2tleWRvd24nICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLmlucHV0LCBtb2R1bGUuZXZlbnQua2V5ZG93bilcbiAgICAgICAgICAgICAgLm9uKCdrZXl1cCcgICArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5pbnB1dCwgbW9kdWxlLmV2ZW50LmtleXVwKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB1bmJpbmQ6IHtcbiAgICAgICAgICBldmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZW1vdmluZyBldmVudHMnKTtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLm9mZihldmVudE5hbWVzcGFjZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgdW5jaGVja090aGVyczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAkcmFkaW9zID0gbW9kdWxlLmdldC5vdGhlclJhZGlvcygpXG4gICAgICAgICAgO1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVW5jaGVja2luZyBvdGhlciByYWRpb3MnLCAkcmFkaW9zKTtcbiAgICAgICAgICAkcmFkaW9zLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5jaGVja2VkKTtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCAhbW9kdWxlLmNhbi5jaGFuZ2UoKSApIHtcbiAgICAgICAgICAgIGlmKCFtb2R1bGUuaXMucmFkaW8oKSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NoZWNrYm94IGlzIHJlYWQtb25seSBvciBkaXNhYmxlZCwgaWdub3JpbmcgdG9nZ2xlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCBtb2R1bGUuaXMuaW5kZXRlcm1pbmF0ZSgpIHx8IG1vZHVsZS5pcy51bmNoZWNrZWQoKSApIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ3VycmVudGx5IHVuY2hlY2tlZCcpO1xuICAgICAgICAgICAgbW9kdWxlLmNoZWNrKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoIG1vZHVsZS5pcy5jaGVja2VkKCkgJiYgbW9kdWxlLmNhbi51bmNoZWNrKCkgKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0N1cnJlbnRseSBjaGVja2VkJyk7XG4gICAgICAgICAgICBtb2R1bGUudW5jaGVjaygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2V0dGluZzogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NoYW5naW5nIHNldHRpbmcnLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZigkLmlzUGxhaW5PYmplY3Qoc2V0dGluZ3NbbmFtZV0pKSB7XG4gICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzW25hbWVdLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3NbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZ3NbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnRlcm5hbDogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgbW9kdWxlLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBtb2R1bGVbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZGVidWc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1Zy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdmVyYm9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCAmJiBzZXR0aW5ncy52ZXJib3NlICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCkge1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmVycm9yLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvci5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGVyZm9ybWFuY2U6IHtcbiAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjdXJyZW50VGltZSxcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSxcbiAgICAgICAgICAgICAgcHJldmlvdXNUaW1lXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBjdXJyZW50VGltZSAgID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZSAgPSB0aW1lIHx8IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICBleGVjdXRpb25UaW1lID0gY3VycmVudFRpbWUgLSBwcmV2aW91c1RpbWU7XG4gICAgICAgICAgICAgIHRpbWUgICAgICAgICAgPSBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgcGVyZm9ybWFuY2UucHVzaCh7XG4gICAgICAgICAgICAgICAgJ05hbWUnICAgICAgICAgICA6IG1lc3NhZ2VbMF0sXG4gICAgICAgICAgICAgICAgJ0FyZ3VtZW50cycgICAgICA6IFtdLnNsaWNlLmNhbGwobWVzc2FnZSwgMSkgfHwgJycsXG4gICAgICAgICAgICAgICAgJ0VsZW1lbnQnICAgICAgICA6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgJ0V4ZWN1dGlvbiBUaW1lJyA6IGV4ZWN1dGlvblRpbWVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lciA9IHNldFRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLmRpc3BsYXksIDUwMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNwbGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB0aXRsZSA9IHNldHRpbmdzLm5hbWUgKyAnOicsXG4gICAgICAgICAgICAgIHRvdGFsVGltZSA9IDBcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHRpbWUgPSBmYWxzZTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICB0b3RhbFRpbWUgKz0gZGF0YVsnRXhlY3V0aW9uIFRpbWUnXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGl0bGUgKz0gJyAnICsgdG90YWxUaW1lICsgJ21zJztcbiAgICAgICAgICAgIGlmKG1vZHVsZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgIHRpdGxlICs9ICcgXFwnJyArIG1vZHVsZVNlbGVjdG9yICsgJ1xcJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggKGNvbnNvbGUuZ3JvdXAgIT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLnRhYmxlICE9PSB1bmRlZmluZWQpICYmIHBlcmZvcm1hbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgICAgIGlmKGNvbnNvbGUudGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKHBlcmZvcm1hbmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZXJmb3JtYW5jZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm1ldGhvZCwgcXVlcnkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCBmb3VuZCApICkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZC5hcHBseShjb250ZXh0LCBwYXNzZWRBcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGZvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCQuaXNBcnJheShyZXR1cm5lZFZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZS5wdXNoKHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSBbcmV0dXJuZWRWYWx1ZSwgcmVzcG9uc2VdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSByZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgICAgIGlmKGluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbnZva2UocXVlcnkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmKGluc3RhbmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpbnN0YW5jZS5pbnZva2UoJ2Rlc3Ryb3knKTtcbiAgICAgICAgfVxuICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgfVxuICAgIH0pXG4gIDtcblxuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xufTtcblxuJC5mbi5jaGVja2JveC5zZXR0aW5ncyA9IHtcblxuICBuYW1lICAgICAgICAgICAgICAgIDogJ0NoZWNrYm94JyxcbiAgbmFtZXNwYWNlICAgICAgICAgICA6ICdjaGVja2JveCcsXG5cbiAgc2lsZW50ICAgICAgICAgICAgICA6IGZhbHNlLFxuICBkZWJ1ZyAgICAgICAgICAgICAgIDogZmFsc2UsXG4gIHZlcmJvc2UgICAgICAgICAgICAgOiB0cnVlLFxuICBwZXJmb3JtYW5jZSAgICAgICAgIDogdHJ1ZSxcblxuICAvLyBkZWxlZ2F0ZWQgZXZlbnQgY29udGV4dFxuICB1bmNoZWNrYWJsZSAgICAgICAgIDogJ2F1dG8nLFxuICBmaXJlT25Jbml0ICAgICAgICAgIDogZmFsc2UsXG5cbiAgb25DaGFuZ2UgICAgICAgICAgICA6IGZ1bmN0aW9uKCl7fSxcblxuICBiZWZvcmVDaGVja2VkICAgICAgIDogZnVuY3Rpb24oKXt9LFxuICBiZWZvcmVVbmNoZWNrZWQgICAgIDogZnVuY3Rpb24oKXt9LFxuICBiZWZvcmVEZXRlcm1pbmF0ZSAgIDogZnVuY3Rpb24oKXt9LFxuICBiZWZvcmVJbmRldGVybWluYXRlIDogZnVuY3Rpb24oKXt9LFxuXG4gIG9uQ2hlY2tlZCAgICAgICAgICAgOiBmdW5jdGlvbigpe30sXG4gIG9uVW5jaGVja2VkICAgICAgICAgOiBmdW5jdGlvbigpe30sXG5cbiAgb25EZXRlcm1pbmF0ZSAgICAgICA6IGZ1bmN0aW9uKCkge30sXG4gIG9uSW5kZXRlcm1pbmF0ZSAgICAgOiBmdW5jdGlvbigpIHt9LFxuXG4gIG9uRW5hYmxlICAgICAgICAgICAgOiBmdW5jdGlvbigpe30sXG4gIG9uRGlzYWJsZSAgICAgICAgICAgOiBmdW5jdGlvbigpe30sXG5cbiAgLy8gcHJlc2VydmUgbWlzc3BlbGxlZCBjYWxsYmFja3MgKHdpbGwgYmUgcmVtb3ZlZCBpbiAzLjApXG4gIG9uRW5hYmxlZCAgICAgICAgICAgOiBmdW5jdGlvbigpe30sXG4gIG9uRGlzYWJsZWQgICAgICAgICAgOiBmdW5jdGlvbigpe30sXG5cbiAgY2xhc3NOYW1lICAgICAgIDoge1xuICAgIGNoZWNrZWQgICAgICAgOiAnY2hlY2tlZCcsXG4gICAgaW5kZXRlcm1pbmF0ZSA6ICdpbmRldGVybWluYXRlJyxcbiAgICBkaXNhYmxlZCAgICAgIDogJ2Rpc2FibGVkJyxcbiAgICBoaWRkZW4gICAgICAgIDogJ2hpZGRlbicsXG4gICAgcmFkaW8gICAgICAgICA6ICdyYWRpbycsXG4gICAgcmVhZE9ubHkgICAgICA6ICdyZWFkLW9ubHknXG4gIH0sXG5cbiAgZXJyb3IgICAgIDoge1xuICAgIG1ldGhvZCAgICAgICA6ICdUaGUgbWV0aG9kIHlvdSBjYWxsZWQgaXMgbm90IGRlZmluZWQnXG4gIH0sXG5cbiAgc2VsZWN0b3IgOiB7XG4gICAgY2hlY2tib3ggOiAnLnVpLmNoZWNrYm94JyxcbiAgICBsYWJlbCAgICA6ICdsYWJlbCwgLmJveCcsXG4gICAgaW5wdXQgICAgOiAnaW5wdXRbdHlwZT1cImNoZWNrYm94XCJdLCBpbnB1dFt0eXBlPVwicmFkaW9cIl0nLFxuICAgIGxpbmsgICAgIDogJ2FbaHJlZl0nXG4gIH1cblxufTtcblxufSkoIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCApO1xuXG4vKiFcbiAqICMgU2VtYW50aWMgVUkgMi40LjAgLSBEaW1tZXJcbiAqIGh0dHA6Ly9naXRodWIuY29tL3NlbWFudGljLW9yZy9zZW1hbnRpYy11aS9cbiAqXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG5cbjsoZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG4ndXNlIHN0cmljdCc7XG5cbndpbmRvdyA9ICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGgpXG4gID8gd2luZG93XG4gIDogKHR5cGVvZiBzZWxmICE9ICd1bmRlZmluZWQnICYmIHNlbGYuTWF0aCA9PSBNYXRoKVxuICAgID8gc2VsZlxuICAgIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKVxuO1xuXG4kLmZuLmRpbW1lciA9IGZ1bmN0aW9uKHBhcmFtZXRlcnMpIHtcbiAgdmFyXG4gICAgJGFsbE1vZHVsZXMgICAgID0gJCh0aGlzKSxcblxuICAgIHRpbWUgICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgICA9IFtdLFxuXG4gICAgcXVlcnkgICAgICAgICAgID0gYXJndW1lbnRzWzBdLFxuICAgIG1ldGhvZEludm9rZWQgICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzICA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcblxuICAgIHJldHVybmVkVmFsdWVcbiAgO1xuXG4gICRhbGxNb2R1bGVzXG4gICAgLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXJcbiAgICAgICAgc2V0dGluZ3MgICAgICAgID0gKCAkLmlzUGxhaW5PYmplY3QocGFyYW1ldGVycykgKVxuICAgICAgICAgID8gJC5leHRlbmQodHJ1ZSwge30sICQuZm4uZGltbWVyLnNldHRpbmdzLCBwYXJhbWV0ZXJzKVxuICAgICAgICAgIDogJC5leHRlbmQoe30sICQuZm4uZGltbWVyLnNldHRpbmdzKSxcblxuICAgICAgICBzZWxlY3RvciAgICAgICAgPSBzZXR0aW5ncy5zZWxlY3RvcixcbiAgICAgICAgbmFtZXNwYWNlICAgICAgID0gc2V0dGluZ3MubmFtZXNwYWNlLFxuICAgICAgICBjbGFzc05hbWUgICAgICAgPSBzZXR0aW5ncy5jbGFzc05hbWUsXG4gICAgICAgIGVycm9yICAgICAgICAgICA9IHNldHRpbmdzLmVycm9yLFxuXG4gICAgICAgIGV2ZW50TmFtZXNwYWNlICA9ICcuJyArIG5hbWVzcGFjZSxcbiAgICAgICAgbW9kdWxlTmFtZXNwYWNlID0gJ21vZHVsZS0nICsgbmFtZXNwYWNlLFxuICAgICAgICBtb2R1bGVTZWxlY3RvciAgPSAkYWxsTW9kdWxlcy5zZWxlY3RvciB8fCAnJyxcblxuICAgICAgICBjbGlja0V2ZW50ICAgICAgPSAoJ29udG91Y2hzdGFydCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KVxuICAgICAgICAgID8gJ3RvdWNoc3RhcnQnXG4gICAgICAgICAgOiAnY2xpY2snLFxuXG4gICAgICAgICRtb2R1bGUgPSAkKHRoaXMpLFxuICAgICAgICAkZGltbWVyLFxuICAgICAgICAkZGltbWFibGUsXG5cbiAgICAgICAgZWxlbWVudCAgID0gdGhpcyxcbiAgICAgICAgaW5zdGFuY2UgID0gJG1vZHVsZS5kYXRhKG1vZHVsZU5hbWVzcGFjZSksXG4gICAgICAgIG1vZHVsZVxuICAgICAgO1xuXG4gICAgICBtb2R1bGUgPSB7XG5cbiAgICAgICAgcHJlaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIG1vZHVsZS5pcy5kaW1tZXIoKSApIHtcblxuICAgICAgICAgICAgJGRpbW1hYmxlID0gJG1vZHVsZS5wYXJlbnQoKTtcbiAgICAgICAgICAgICRkaW1tZXIgICA9ICRtb2R1bGU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJGRpbW1hYmxlID0gJG1vZHVsZTtcbiAgICAgICAgICAgIGlmKCBtb2R1bGUuaGFzLmRpbW1lcigpICkge1xuICAgICAgICAgICAgICBpZihzZXR0aW5ncy5kaW1tZXJOYW1lKSB7XG4gICAgICAgICAgICAgICAgJGRpbW1lciA9ICRkaW1tYWJsZS5maW5kKHNlbGVjdG9yLmRpbW1lcikuZmlsdGVyKCcuJyArIHNldHRpbmdzLmRpbW1lck5hbWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICRkaW1tZXIgPSAkZGltbWFibGUuZmluZChzZWxlY3Rvci5kaW1tZXIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgJGRpbW1lciA9IG1vZHVsZS5jcmVhdGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdJbml0aWFsaXppbmcgZGltbWVyJywgc2V0dGluZ3MpO1xuXG4gICAgICAgICAgbW9kdWxlLmJpbmQuZXZlbnRzKCk7XG4gICAgICAgICAgbW9kdWxlLnNldC5kaW1tYWJsZSgpO1xuICAgICAgICAgIG1vZHVsZS5pbnN0YW50aWF0ZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluc3RhbnRpYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU3RvcmluZyBpbnN0YW5jZSBvZiBtb2R1bGUnLCBtb2R1bGUpO1xuICAgICAgICAgIGluc3RhbmNlID0gbW9kdWxlO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5kYXRhKG1vZHVsZU5hbWVzcGFjZSwgaW5zdGFuY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXN0cm95aW5nIHByZXZpb3VzIG1vZHVsZScsICRkaW1tZXIpO1xuICAgICAgICAgIG1vZHVsZS51bmJpbmQuZXZlbnRzKCk7XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS52YXJpYXRpb24oKTtcbiAgICAgICAgICAkZGltbWFibGVcbiAgICAgICAgICAgIC5vZmYoZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGJpbmQ6IHtcbiAgICAgICAgICBldmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3Mub24gPT0gJ2hvdmVyJykge1xuICAgICAgICAgICAgICAkZGltbWFibGVcbiAgICAgICAgICAgICAgICAub24oJ21vdXNlZW50ZXInICsgZXZlbnROYW1lc3BhY2UsIG1vZHVsZS5zaG93KVxuICAgICAgICAgICAgICAgIC5vbignbW91c2VsZWF2ZScgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmhpZGUpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoc2V0dGluZ3Mub24gPT0gJ2NsaWNrJykge1xuICAgICAgICAgICAgICAkZGltbWFibGVcbiAgICAgICAgICAgICAgICAub24oY2xpY2tFdmVudCArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUudG9nZ2xlKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggbW9kdWxlLmlzLnBhZ2UoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZXR0aW5nIGFzIGEgcGFnZSBkaW1tZXInLCAkZGltbWFibGUpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnBhZ2VEaW1tZXIoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5jbG9zYWJsZSgpICkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQWRkaW5nIGRpbW1lciBjbG9zZSBldmVudCcsICRkaW1tZXIpO1xuICAgICAgICAgICAgICAkZGltbWFibGVcbiAgICAgICAgICAgICAgICAub24oY2xpY2tFdmVudCArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5kaW1tZXIsIG1vZHVsZS5ldmVudC5jbGljaylcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB1bmJpbmQ6IHtcbiAgICAgICAgICBldmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAucmVtb3ZlRGF0YShtb2R1bGVOYW1lc3BhY2UpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkZGltbWFibGVcbiAgICAgICAgICAgICAgLm9mZihldmVudE5hbWVzcGFjZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXZlbnQ6IHtcbiAgICAgICAgICBjbGljazogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXRlcm1pbmluZyBpZiBldmVudCBvY2N1cmVkIG9uIGRpbW1lcicsIGV2ZW50KTtcbiAgICAgICAgICAgIGlmKCAkZGltbWVyLmZpbmQoZXZlbnQudGFyZ2V0KS5sZW5ndGggPT09IDAgfHwgJChldmVudC50YXJnZXQpLmlzKHNlbGVjdG9yLmNvbnRlbnQpICkge1xuICAgICAgICAgICAgICBtb2R1bGUuaGlkZSgpO1xuICAgICAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuXG4gICAgICAgIGFkZENvbnRlbnQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgICRjb250ZW50ID0gJChlbGVtZW50KVxuICAgICAgICAgIDtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0FkZCBjb250ZW50IHRvIGRpbW1lcicsICRjb250ZW50KTtcbiAgICAgICAgICBpZigkY29udGVudC5wYXJlbnQoKVswXSAhPT0gJGRpbW1lclswXSkge1xuICAgICAgICAgICAgJGNvbnRlbnQuZGV0YWNoKCkuYXBwZW5kVG8oJGRpbW1lcik7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAkZWxlbWVudCA9ICQoIHNldHRpbmdzLnRlbXBsYXRlLmRpbW1lcigpIClcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYoc2V0dGluZ3MuZGltbWVyTmFtZSkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDcmVhdGluZyBuYW1lZCBkaW1tZXInLCBzZXR0aW5ncy5kaW1tZXJOYW1lKTtcbiAgICAgICAgICAgICRlbGVtZW50LmFkZENsYXNzKHNldHRpbmdzLmRpbW1lck5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAkZWxlbWVudFxuICAgICAgICAgICAgLmFwcGVuZFRvKCRkaW1tYWJsZSlcbiAgICAgICAgICA7XG4gICAgICAgICAgcmV0dXJuICRlbGVtZW50O1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgY2FsbGJhY2sgPSAkLmlzRnVuY3Rpb24oY2FsbGJhY2spXG4gICAgICAgICAgICA/IGNhbGxiYWNrXG4gICAgICAgICAgICA6IGZ1bmN0aW9uKCl7fVxuICAgICAgICAgIDtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Nob3dpbmcgZGltbWVyJywgJGRpbW1lciwgc2V0dGluZ3MpO1xuICAgICAgICAgIG1vZHVsZS5zZXQudmFyaWF0aW9uKCk7XG4gICAgICAgICAgaWYoICghbW9kdWxlLmlzLmRpbW1lZCgpIHx8IG1vZHVsZS5pcy5hbmltYXRpbmcoKSkgJiYgbW9kdWxlLmlzLmVuYWJsZWQoKSApIHtcbiAgICAgICAgICAgIG1vZHVsZS5hbmltYXRlLnNob3coY2FsbGJhY2spO1xuICAgICAgICAgICAgc2V0dGluZ3Mub25TaG93LmNhbGwoZWxlbWVudCk7XG4gICAgICAgICAgICBzZXR0aW5ncy5vbkNoYW5nZS5jYWxsKGVsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRGltbWVyIGlzIGFscmVhZHkgc2hvd24gb3IgZGlzYWJsZWQnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGlkZTogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICBjYWxsYmFjayA9ICQuaXNGdW5jdGlvbihjYWxsYmFjaylcbiAgICAgICAgICAgID8gY2FsbGJhY2tcbiAgICAgICAgICAgIDogZnVuY3Rpb24oKXt9XG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKCBtb2R1bGUuaXMuZGltbWVkKCkgfHwgbW9kdWxlLmlzLmFuaW1hdGluZygpICkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdIaWRpbmcgZGltbWVyJywgJGRpbW1lcik7XG4gICAgICAgICAgICBtb2R1bGUuYW5pbWF0ZS5oaWRlKGNhbGxiYWNrKTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uSGlkZS5jYWxsKGVsZW1lbnQpO1xuICAgICAgICAgICAgc2V0dGluZ3Mub25DaGFuZ2UuY2FsbChlbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0RpbW1lciBpcyBub3QgdmlzaWJsZScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdUb2dnbGluZyBkaW1tZXIgdmlzaWJpbGl0eScsICRkaW1tZXIpO1xuICAgICAgICAgIGlmKCAhbW9kdWxlLmlzLmRpbW1lZCgpICkge1xuICAgICAgICAgICAgbW9kdWxlLnNob3coKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUuaGlkZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBhbmltYXRlOiB7XG4gICAgICAgICAgc2hvdzogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGNhbGxiYWNrID0gJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKVxuICAgICAgICAgICAgICA/IGNhbGxiYWNrXG4gICAgICAgICAgICAgIDogZnVuY3Rpb24oKXt9XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy51c2VDU1MgJiYgJC5mbi50cmFuc2l0aW9uICE9PSB1bmRlZmluZWQgJiYgJGRpbW1lci50cmFuc2l0aW9uKCdpcyBzdXBwb3J0ZWQnKSkge1xuICAgICAgICAgICAgICBpZihzZXR0aW5ncy51c2VGbGV4KSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdVc2luZyBmbGV4IGRpbW1lcicpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUubGVnYWN5KCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdVc2luZyBsZWdhY3kgbm9uLWZsZXggZGltbWVyJyk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNldC5sZWdhY3koKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZihzZXR0aW5ncy5vcGFjaXR5ICE9PSAnYXV0bycpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuc2V0Lm9wYWNpdHkoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAkZGltbWVyXG4gICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oe1xuICAgICAgICAgICAgICAgICAgZGlzcGxheVR5cGUgOiBzZXR0aW5ncy51c2VGbGV4XG4gICAgICAgICAgICAgICAgICAgID8gJ2ZsZXgnXG4gICAgICAgICAgICAgICAgICAgIDogJ2Jsb2NrJyxcbiAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbiAgIDogc2V0dGluZ3MudHJhbnNpdGlvbiArICcgaW4nLFxuICAgICAgICAgICAgICAgICAgcXVldWUgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgIGR1cmF0aW9uICAgIDogbW9kdWxlLmdldC5kdXJhdGlvbigpLFxuICAgICAgICAgICAgICAgICAgdXNlRmFpbFNhZmUgOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgb25TdGFydCAgICAgOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC5kaW1tZWQoKTtcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICBvbkNvbXBsZXRlICA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuc2V0LmFjdGl2ZSgpO1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2hvd2luZyBkaW1tZXIgYW5pbWF0aW9uIHdpdGggamF2YXNjcmlwdCcpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LmRpbW1lZCgpO1xuICAgICAgICAgICAgICBpZihzZXR0aW5ncy5vcGFjaXR5ID09ICdhdXRvJykge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLm9wYWNpdHkgPSAwLjg7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgJGRpbW1lclxuICAgICAgICAgICAgICAgIC5zdG9wKClcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgIG9wYWNpdHkgOiAwLFxuICAgICAgICAgICAgICAgICAgd2lkdGggICA6ICcxMDAlJyxcbiAgICAgICAgICAgICAgICAgIGhlaWdodCAgOiAnMTAwJSdcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5mYWRlVG8obW9kdWxlLmdldC5kdXJhdGlvbigpLCBzZXR0aW5ncy5vcGFjaXR5LCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICRkaW1tZXIucmVtb3ZlQXR0cignc3R5bGUnKTtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5zZXQuYWN0aXZlKCk7XG4gICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGhpZGU6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICBjYWxsYmFjayA9ICQuaXNGdW5jdGlvbihjYWxsYmFjaylcbiAgICAgICAgICAgICAgPyBjYWxsYmFja1xuICAgICAgICAgICAgICA6IGZ1bmN0aW9uKCl7fVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MudXNlQ1NTICYmICQuZm4udHJhbnNpdGlvbiAhPT0gdW5kZWZpbmVkICYmICRkaW1tZXIudHJhbnNpdGlvbignaXMgc3VwcG9ydGVkJykpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0hpZGluZyBkaW1tZXIgd2l0aCBjc3MnKTtcbiAgICAgICAgICAgICAgJGRpbW1lclxuICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKHtcbiAgICAgICAgICAgICAgICAgIGRpc3BsYXlUeXBlIDogc2V0dGluZ3MudXNlRmxleFxuICAgICAgICAgICAgICAgICAgICA/ICdmbGV4J1xuICAgICAgICAgICAgICAgICAgICA6ICdibG9jaycsXG4gICAgICAgICAgICAgICAgICBhbmltYXRpb24gICA6IHNldHRpbmdzLnRyYW5zaXRpb24gKyAnIG91dCcsXG4gICAgICAgICAgICAgICAgICBxdWV1ZSAgICAgICA6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgZHVyYXRpb24gICAgOiBtb2R1bGUuZ2V0LmR1cmF0aW9uKCksXG4gICAgICAgICAgICAgICAgICB1c2VGYWlsU2FmZSA6IHRydWUsXG4gICAgICAgICAgICAgICAgICBvblN0YXJ0ICAgICA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmRpbW1lZCgpO1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIG9uQ29tcGxldGUgIDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUudmFyaWF0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuYWN0aXZlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdIaWRpbmcgZGltbWVyIHdpdGggamF2YXNjcmlwdCcpO1xuICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmRpbW1lZCgpO1xuICAgICAgICAgICAgICAkZGltbWVyXG4gICAgICAgICAgICAgICAgLnN0b3AoKVxuICAgICAgICAgICAgICAgIC5mYWRlT3V0KG1vZHVsZS5nZXQuZHVyYXRpb24oKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmFjdGl2ZSgpO1xuICAgICAgICAgICAgICAgICAgJGRpbW1lci5yZW1vdmVBdHRyKCdzdHlsZScpO1xuICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGdldDoge1xuICAgICAgICAgIGRpbW1lcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGRpbW1lcjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGR1cmF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKHR5cGVvZiBzZXR0aW5ncy5kdXJhdGlvbiA9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICBpZiggbW9kdWxlLmlzLmFjdGl2ZSgpICkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5kdXJhdGlvbi5oaWRlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5kdXJhdGlvbi5zaG93O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MuZHVyYXRpb247XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGhhczoge1xuICAgICAgICAgIGRpbW1lcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5kaW1tZXJOYW1lKSB7XG4gICAgICAgICAgICAgIHJldHVybiAoJG1vZHVsZS5maW5kKHNlbGVjdG9yLmRpbW1lcikuZmlsdGVyKCcuJyArIHNldHRpbmdzLmRpbW1lck5hbWUpLmxlbmd0aCA+IDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiAoICRtb2R1bGUuZmluZChzZWxlY3Rvci5kaW1tZXIpLmxlbmd0aCA+IDAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXM6IHtcbiAgICAgICAgICBhY3RpdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRkaW1tZXIuaGFzQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhbmltYXRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICggJGRpbW1lci5pcygnOmFuaW1hdGVkJykgfHwgJGRpbW1lci5oYXNDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKSApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2xvc2FibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuY2xvc2FibGUgPT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICAgIGlmKHNldHRpbmdzLm9uID09ICdob3ZlcicpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MuY2xvc2FibGU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaW1tZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLmRpbW1lcik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaW1tYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUuZGltbWFibGUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGltbWVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkZGltbWFibGUuaGFzQ2xhc3MoY2xhc3NOYW1lLmRpbW1lZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGRpbW1hYmxlLmhhc0NsYXNzKGNsYXNzTmFtZS5kaXNhYmxlZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlbmFibGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAhbW9kdWxlLmlzLmRpc2FibGVkKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwYWdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gJGRpbW1hYmxlLmlzKCdib2R5Jyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwYWdlRGltbWVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkZGltbWVyLmhhc0NsYXNzKGNsYXNzTmFtZS5wYWdlRGltbWVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FuOiB7XG4gICAgICAgICAgc2hvdzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gISRkaW1tZXIuaGFzQ2xhc3MoY2xhc3NOYW1lLmRpc2FibGVkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiB7XG4gICAgICAgICAgb3BhY2l0eTogZnVuY3Rpb24ob3BhY2l0eSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGNvbG9yICAgICAgPSAkZGltbWVyLmNzcygnYmFja2dyb3VuZC1jb2xvcicpLFxuICAgICAgICAgICAgICBjb2xvckFycmF5ID0gY29sb3Iuc3BsaXQoJywnKSxcbiAgICAgICAgICAgICAgaXNSR0IgICAgICA9IChjb2xvckFycmF5ICYmIGNvbG9yQXJyYXkubGVuZ3RoID09IDMpLFxuICAgICAgICAgICAgICBpc1JHQkEgICAgID0gKGNvbG9yQXJyYXkgJiYgY29sb3JBcnJheS5sZW5ndGggPT0gNClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG9wYWNpdHkgICAgPSBzZXR0aW5ncy5vcGFjaXR5ID09PSAwID8gMCA6IHNldHRpbmdzLm9wYWNpdHkgfHwgb3BhY2l0eTtcbiAgICAgICAgICAgIGlmKGlzUkdCIHx8IGlzUkdCQSkge1xuICAgICAgICAgICAgICBjb2xvckFycmF5WzNdID0gb3BhY2l0eSArICcpJztcbiAgICAgICAgICAgICAgY29sb3IgICAgICAgICA9IGNvbG9yQXJyYXkuam9pbignLCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIGNvbG9yID0gJ3JnYmEoMCwgMCwgMCwgJyArIG9wYWNpdHkgKyAnKSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgb3BhY2l0eSB0bycsIG9wYWNpdHkpO1xuICAgICAgICAgICAgJGRpbW1lci5jc3MoJ2JhY2tncm91bmQtY29sb3InLCBjb2xvcik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsZWdhY3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGRpbW1lci5hZGRDbGFzcyhjbGFzc05hbWUubGVnYWN5KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkZGltbWVyLmFkZENsYXNzKGNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGltbWFibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGRpbW1hYmxlLmFkZENsYXNzKGNsYXNzTmFtZS5kaW1tYWJsZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaW1tZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGRpbW1hYmxlLmFkZENsYXNzKGNsYXNzTmFtZS5kaW1tZWQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcGFnZURpbW1lcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkZGltbWVyLmFkZENsYXNzKGNsYXNzTmFtZS5wYWdlRGltbWVyKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpc2FibGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRkaW1tZXIuYWRkQ2xhc3MoY2xhc3NOYW1lLmRpc2FibGVkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhcmlhdGlvbjogZnVuY3Rpb24odmFyaWF0aW9uKSB7XG4gICAgICAgICAgICB2YXJpYXRpb24gPSB2YXJpYXRpb24gfHwgc2V0dGluZ3MudmFyaWF0aW9uO1xuICAgICAgICAgICAgaWYodmFyaWF0aW9uKSB7XG4gICAgICAgICAgICAgICRkaW1tZXIuYWRkQ2xhc3ModmFyaWF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVtb3ZlOiB7XG4gICAgICAgICAgYWN0aXZlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRkaW1tZXJcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hY3RpdmUpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsZWdhY3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGRpbW1lci5yZW1vdmVDbGFzcyhjbGFzc05hbWUubGVnYWN5KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpbW1lZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkZGltbWFibGUucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmRpbW1lZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNhYmxlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkZGltbWVyLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5kaXNhYmxlZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB2YXJpYXRpb246IGZ1bmN0aW9uKHZhcmlhdGlvbikge1xuICAgICAgICAgICAgdmFyaWF0aW9uID0gdmFyaWF0aW9uIHx8IHNldHRpbmdzLnZhcmlhdGlvbjtcbiAgICAgICAgICAgIGlmKHZhcmlhdGlvbikge1xuICAgICAgICAgICAgICAkZGltbWVyLnJlbW92ZUNsYXNzKHZhcmlhdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldHRpbmc6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdDaGFuZ2luZyBzZXR0aW5nJywgbmFtZSwgdmFsdWUpO1xuICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBzZXR0aW5ncywgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYoJC5pc1BsYWluT2JqZWN0KHNldHRpbmdzW25hbWVdKSkge1xuICAgICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBzZXR0aW5nc1tuYW1lXSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW50ZXJuYWw6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIG1vZHVsZSwgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbW9kdWxlW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVtuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlYnVnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHZlcmJvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MudmVyYm9zZSAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZS5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQpIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvciA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5lcnJvciwgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUsXG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICBwcmV2aW91c1RpbWUgID0gdGltZSB8fCBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSA9IGN1cnJlbnRUaW1lIC0gcHJldmlvdXNUaW1lO1xuICAgICAgICAgICAgICB0aW1lICAgICAgICAgID0gY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIHBlcmZvcm1hbmNlLnB1c2goe1xuICAgICAgICAgICAgICAgICdOYW1lJyAgICAgICAgICAgOiBtZXNzYWdlWzBdLFxuICAgICAgICAgICAgICAgICdBcmd1bWVudHMnICAgICAgOiBbXS5zbGljZS5jYWxsKG1lc3NhZ2UsIDEpIHx8ICcnLFxuICAgICAgICAgICAgICAgICdFbGVtZW50JyAgICAgICAgOiBlbGVtZW50LFxuICAgICAgICAgICAgICAgICdFeGVjdXRpb24gVGltZScgOiBleGVjdXRpb25UaW1lXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UudGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS5kaXNwbGF5LCA1MDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlzcGxheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdGl0bGUgPSBzZXR0aW5ncy5uYW1lICsgJzonLFxuICAgICAgICAgICAgICB0b3RhbFRpbWUgPSAwXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICB0aW1lID0gZmFsc2U7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgICQuZWFjaChwZXJmb3JtYW5jZSwgZnVuY3Rpb24oaW5kZXgsIGRhdGEpIHtcbiAgICAgICAgICAgICAgdG90YWxUaW1lICs9IGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRpdGxlICs9ICcgJyArIHRvdGFsVGltZSArICdtcyc7XG4gICAgICAgICAgICBpZihtb2R1bGVTZWxlY3Rvcikge1xuICAgICAgICAgICAgICB0aXRsZSArPSAnIFxcJycgKyBtb2R1bGVTZWxlY3RvciArICdcXCcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoJGFsbE1vZHVsZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICB0aXRsZSArPSAnICcgKyAnKCcgKyAkYWxsTW9kdWxlcy5sZW5ndGggKyAnKSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggKGNvbnNvbGUuZ3JvdXAgIT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLnRhYmxlICE9PSB1bmRlZmluZWQpICYmIHBlcmZvcm1hbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgICAgIGlmKGNvbnNvbGUudGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKHBlcmZvcm1hbmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZXJmb3JtYW5jZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm1ldGhvZCwgcXVlcnkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCBmb3VuZCApICkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZC5hcHBseShjb250ZXh0LCBwYXNzZWRBcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGZvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCQuaXNBcnJheShyZXR1cm5lZFZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZS5wdXNoKHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSBbcmV0dXJuZWRWYWx1ZSwgcmVzcG9uc2VdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSByZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBtb2R1bGUucHJlaW5pdGlhbGl6ZSgpO1xuXG4gICAgICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgICAgIGlmKGluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbnZva2UocXVlcnkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmKGluc3RhbmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpbnN0YW5jZS5pbnZva2UoJ2Rlc3Ryb3knKTtcbiAgICAgICAgfVxuICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgfVxuICAgIH0pXG4gIDtcblxuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xufTtcblxuJC5mbi5kaW1tZXIuc2V0dGluZ3MgPSB7XG5cbiAgbmFtZSAgICAgICAgOiAnRGltbWVyJyxcbiAgbmFtZXNwYWNlICAgOiAnZGltbWVyJyxcblxuICBzaWxlbnQgICAgICA6IGZhbHNlLFxuICBkZWJ1ZyAgICAgICA6IGZhbHNlLFxuICB2ZXJib3NlICAgICA6IGZhbHNlLFxuICBwZXJmb3JtYW5jZSA6IHRydWUsXG5cbiAgLy8gd2hldGhlciBzaG91bGQgdXNlIGZsZXggbGF5b3V0XG4gIHVzZUZsZXggICAgIDogdHJ1ZSxcblxuICAvLyBuYW1lIHRvIGRpc3Rpbmd1aXNoIGJldHdlZW4gbXVsdGlwbGUgZGltbWVycyBpbiBjb250ZXh0XG4gIGRpbW1lck5hbWUgIDogZmFsc2UsXG5cbiAgLy8gd2hldGhlciB0byBhZGQgYSB2YXJpYXRpb24gdHlwZVxuICB2YXJpYXRpb24gICA6IGZhbHNlLFxuXG4gIC8vIHdoZXRoZXIgdG8gYmluZCBjbG9zZSBldmVudHNcbiAgY2xvc2FibGUgICAgOiAnYXV0bycsXG5cbiAgLy8gd2hldGhlciB0byB1c2UgY3NzIGFuaW1hdGlvbnNcbiAgdXNlQ1NTICAgICAgOiB0cnVlLFxuXG4gIC8vIGNzcyBhbmltYXRpb24gdG8gdXNlXG4gIHRyYW5zaXRpb24gIDogJ2ZhZGUnLFxuXG4gIC8vIGV2ZW50IHRvIGJpbmQgdG9cbiAgb24gICAgICAgICAgOiBmYWxzZSxcblxuICAvLyBvdmVycmlkaW5nIG9wYWNpdHkgdmFsdWVcbiAgb3BhY2l0eSAgICAgOiAnYXV0bycsXG5cbiAgLy8gdHJhbnNpdGlvbiBkdXJhdGlvbnNcbiAgZHVyYXRpb24gICAgOiB7XG4gICAgc2hvdyA6IDUwMCxcbiAgICBoaWRlIDogNTAwXG4gIH0sXG5cbiAgb25DaGFuZ2UgICAgOiBmdW5jdGlvbigpe30sXG4gIG9uU2hvdyAgICAgIDogZnVuY3Rpb24oKXt9LFxuICBvbkhpZGUgICAgICA6IGZ1bmN0aW9uKCl7fSxcblxuICBlcnJvciAgIDoge1xuICAgIG1ldGhvZCAgIDogJ1RoZSBtZXRob2QgeW91IGNhbGxlZCBpcyBub3QgZGVmaW5lZC4nXG4gIH0sXG5cbiAgY2xhc3NOYW1lIDoge1xuICAgIGFjdGl2ZSAgICAgOiAnYWN0aXZlJyxcbiAgICBhbmltYXRpbmcgIDogJ2FuaW1hdGluZycsXG4gICAgZGltbWFibGUgICA6ICdkaW1tYWJsZScsXG4gICAgZGltbWVkICAgICA6ICdkaW1tZWQnLFxuICAgIGRpbW1lciAgICAgOiAnZGltbWVyJyxcbiAgICBkaXNhYmxlZCAgIDogJ2Rpc2FibGVkJyxcbiAgICBoaWRlICAgICAgIDogJ2hpZGUnLFxuICAgIGxlZ2FjeSAgICAgOiAnbGVnYWN5JyxcbiAgICBwYWdlRGltbWVyIDogJ3BhZ2UnLFxuICAgIHNob3cgICAgICAgOiAnc2hvdydcbiAgfSxcblxuICBzZWxlY3Rvcjoge1xuICAgIGRpbW1lciAgIDogJz4gLnVpLmRpbW1lcicsXG4gICAgY29udGVudCAgOiAnLnVpLmRpbW1lciA+IC5jb250ZW50LCAudWkuZGltbWVyID4gLmNvbnRlbnQgPiAuY2VudGVyJ1xuICB9LFxuXG4gIHRlbXBsYXRlOiB7XG4gICAgZGltbWVyOiBmdW5jdGlvbigpIHtcbiAgICAgcmV0dXJuICQoJzxkaXYgLz4nKS5hdHRyKCdjbGFzcycsICd1aSBkaW1tZXInKTtcbiAgICB9XG4gIH1cblxufTtcblxufSkoIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCApO1xuXG4vKiFcbiAqICMgU2VtYW50aWMgVUkgMi40LjAgLSBEcm9wZG93blxuICogaHR0cDovL2dpdGh1Yi5jb20vc2VtYW50aWMtb3JnL3NlbWFudGljLXVpL1xuICpcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqXG4gKi9cblxuOyhmdW5jdGlvbiAoJCwgd2luZG93LCBkb2N1bWVudCwgdW5kZWZpbmVkKSB7XG5cbid1c2Ugc3RyaWN0Jztcblxud2luZG93ID0gKHR5cGVvZiB3aW5kb3cgIT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93Lk1hdGggPT0gTWF0aClcbiAgPyB3aW5kb3dcbiAgOiAodHlwZW9mIHNlbGYgIT0gJ3VuZGVmaW5lZCcgJiYgc2VsZi5NYXRoID09IE1hdGgpXG4gICAgPyBzZWxmXG4gICAgOiBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpXG47XG5cbiQuZm4uZHJvcGRvd24gPSBmdW5jdGlvbihwYXJhbWV0ZXJzKSB7XG4gIHZhclxuICAgICRhbGxNb2R1bGVzICAgID0gJCh0aGlzKSxcbiAgICAkZG9jdW1lbnQgICAgICA9ICQoZG9jdW1lbnQpLFxuXG4gICAgbW9kdWxlU2VsZWN0b3IgPSAkYWxsTW9kdWxlcy5zZWxlY3RvciB8fCAnJyxcblxuICAgIGhhc1RvdWNoICAgICAgID0gKCdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCksXG4gICAgdGltZSAgICAgICAgICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICBwZXJmb3JtYW5jZSAgICA9IFtdLFxuXG4gICAgcXVlcnkgICAgICAgICAgPSBhcmd1bWVudHNbMF0sXG4gICAgbWV0aG9kSW52b2tlZCAgPSAodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnKSxcbiAgICBxdWVyeUFyZ3VtZW50cyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcbiAgICByZXR1cm5lZFZhbHVlXG4gIDtcblxuICAkYWxsTW9kdWxlc1xuICAgIC5lYWNoKGZ1bmN0aW9uKGVsZW1lbnRJbmRleCkge1xuICAgICAgdmFyXG4gICAgICAgIHNldHRpbmdzICAgICAgICAgID0gKCAkLmlzUGxhaW5PYmplY3QocGFyYW1ldGVycykgKVxuICAgICAgICAgID8gJC5leHRlbmQodHJ1ZSwge30sICQuZm4uZHJvcGRvd24uc2V0dGluZ3MsIHBhcmFtZXRlcnMpXG4gICAgICAgICAgOiAkLmV4dGVuZCh7fSwgJC5mbi5kcm9wZG93bi5zZXR0aW5ncyksXG5cbiAgICAgICAgY2xhc3NOYW1lICAgICAgID0gc2V0dGluZ3MuY2xhc3NOYW1lLFxuICAgICAgICBtZXNzYWdlICAgICAgICAgPSBzZXR0aW5ncy5tZXNzYWdlLFxuICAgICAgICBmaWVsZHMgICAgICAgICAgPSBzZXR0aW5ncy5maWVsZHMsXG4gICAgICAgIGtleXMgICAgICAgICAgICA9IHNldHRpbmdzLmtleXMsXG4gICAgICAgIG1ldGFkYXRhICAgICAgICA9IHNldHRpbmdzLm1ldGFkYXRhLFxuICAgICAgICBuYW1lc3BhY2UgICAgICAgPSBzZXR0aW5ncy5uYW1lc3BhY2UsXG4gICAgICAgIHJlZ0V4cCAgICAgICAgICA9IHNldHRpbmdzLnJlZ0V4cCxcbiAgICAgICAgc2VsZWN0b3IgICAgICAgID0gc2V0dGluZ3Muc2VsZWN0b3IsXG4gICAgICAgIGVycm9yICAgICAgICAgICA9IHNldHRpbmdzLmVycm9yLFxuICAgICAgICB0ZW1wbGF0ZXMgICAgICAgPSBzZXR0aW5ncy50ZW1wbGF0ZXMsXG5cbiAgICAgICAgZXZlbnROYW1lc3BhY2UgID0gJy4nICsgbmFtZXNwYWNlLFxuICAgICAgICBtb2R1bGVOYW1lc3BhY2UgPSAnbW9kdWxlLScgKyBuYW1lc3BhY2UsXG5cbiAgICAgICAgJG1vZHVsZSAgICAgICAgID0gJCh0aGlzKSxcbiAgICAgICAgJGNvbnRleHQgICAgICAgID0gJChzZXR0aW5ncy5jb250ZXh0KSxcbiAgICAgICAgJHRleHQgICAgICAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLnRleHQpLFxuICAgICAgICAkc2VhcmNoICAgICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3Iuc2VhcmNoKSxcbiAgICAgICAgJHNpemVyICAgICAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLnNpemVyKSxcbiAgICAgICAgJGlucHV0ICAgICAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLmlucHV0KSxcbiAgICAgICAgJGljb24gICAgICAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLmljb24pLFxuXG4gICAgICAgICRjb21ibyA9ICgkbW9kdWxlLnByZXYoKS5maW5kKHNlbGVjdG9yLnRleHQpLmxlbmd0aCA+IDApXG4gICAgICAgICAgPyAkbW9kdWxlLnByZXYoKS5maW5kKHNlbGVjdG9yLnRleHQpXG4gICAgICAgICAgOiAkbW9kdWxlLnByZXYoKSxcblxuICAgICAgICAkbWVudSAgICAgICAgICAgPSAkbW9kdWxlLmNoaWxkcmVuKHNlbGVjdG9yLm1lbnUpLFxuICAgICAgICAkaXRlbSAgICAgICAgICAgPSAkbWVudS5maW5kKHNlbGVjdG9yLml0ZW0pLFxuXG4gICAgICAgIGFjdGl2YXRlZCAgICAgICA9IGZhbHNlLFxuICAgICAgICBpdGVtQWN0aXZhdGVkICAgPSBmYWxzZSxcbiAgICAgICAgaW50ZXJuYWxDaGFuZ2UgID0gZmFsc2UsXG4gICAgICAgIGVsZW1lbnQgICAgICAgICA9IHRoaXMsXG4gICAgICAgIGluc3RhbmNlICAgICAgICA9ICRtb2R1bGUuZGF0YShtb2R1bGVOYW1lc3BhY2UpLFxuXG4gICAgICAgIGluaXRpYWxMb2FkLFxuICAgICAgICBwYWdlTG9zdEZvY3VzLFxuICAgICAgICB3aWxsUmVmb2N1cyxcbiAgICAgICAgZWxlbWVudE5hbWVzcGFjZSxcbiAgICAgICAgaWQsXG4gICAgICAgIHNlbGVjdE9ic2VydmVyLFxuICAgICAgICBtZW51T2JzZXJ2ZXIsXG4gICAgICAgIG1vZHVsZVxuICAgICAgO1xuXG4gICAgICBtb2R1bGUgPSB7XG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdJbml0aWFsaXppbmcgZHJvcGRvd24nLCBzZXR0aW5ncyk7XG5cbiAgICAgICAgICBpZiggbW9kdWxlLmlzLmFscmVhZHlTZXR1cCgpICkge1xuICAgICAgICAgICAgbW9kdWxlLnNldHVwLnJlZmVyZW5jZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcblxuICAgICAgICAgICAgbW9kdWxlLnNldHVwLmxheW91dCgpO1xuXG4gICAgICAgICAgICBpZihzZXR0aW5ncy52YWx1ZXMpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmNoYW5nZS52YWx1ZXMoc2V0dGluZ3MudmFsdWVzKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbW9kdWxlLnJlZnJlc2hEYXRhKCk7XG5cbiAgICAgICAgICAgIG1vZHVsZS5zYXZlLmRlZmF1bHRzKCk7XG4gICAgICAgICAgICBtb2R1bGUucmVzdG9yZS5zZWxlY3RlZCgpO1xuXG4gICAgICAgICAgICBtb2R1bGUuY3JlYXRlLmlkKCk7XG4gICAgICAgICAgICBtb2R1bGUuYmluZC5ldmVudHMoKTtcblxuICAgICAgICAgICAgbW9kdWxlLm9ic2VydmVDaGFuZ2VzKCk7XG4gICAgICAgICAgICBtb2R1bGUuaW5zdGFudGlhdGUoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBpbnN0YW50aWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1N0b3JpbmcgaW5zdGFuY2Ugb2YgZHJvcGRvd24nLCBtb2R1bGUpO1xuICAgICAgICAgIGluc3RhbmNlID0gbW9kdWxlO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5kYXRhKG1vZHVsZU5hbWVzcGFjZSwgbW9kdWxlKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRGVzdHJveWluZyBwcmV2aW91cyBkcm9wZG93bicsICRtb2R1bGUpO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUudGFiYmFibGUoKTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAub2ZmKGV2ZW50TmFtZXNwYWNlKVxuICAgICAgICAgICAgLnJlbW92ZURhdGEobW9kdWxlTmFtZXNwYWNlKVxuICAgICAgICAgIDtcbiAgICAgICAgICAkbWVudVxuICAgICAgICAgICAgLm9mZihldmVudE5hbWVzcGFjZSlcbiAgICAgICAgICA7XG4gICAgICAgICAgJGRvY3VtZW50XG4gICAgICAgICAgICAub2ZmKGVsZW1lbnROYW1lc3BhY2UpXG4gICAgICAgICAgO1xuICAgICAgICAgIG1vZHVsZS5kaXNjb25uZWN0Lm1lbnVPYnNlcnZlcigpO1xuICAgICAgICAgIG1vZHVsZS5kaXNjb25uZWN0LnNlbGVjdE9ic2VydmVyKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb2JzZXJ2ZUNoYW5nZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCdNdXRhdGlvbk9ic2VydmVyJyBpbiB3aW5kb3cpIHtcbiAgICAgICAgICAgIHNlbGVjdE9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIobW9kdWxlLmV2ZW50LnNlbGVjdC5tdXRhdGlvbik7XG4gICAgICAgICAgICBtZW51T2JzZXJ2ZXIgICA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKG1vZHVsZS5ldmVudC5tZW51Lm11dGF0aW9uKTtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2V0dGluZyB1cCBtdXRhdGlvbiBvYnNlcnZlcicsIHNlbGVjdE9ic2VydmVyLCBtZW51T2JzZXJ2ZXIpO1xuICAgICAgICAgICAgbW9kdWxlLm9ic2VydmUuc2VsZWN0KCk7XG4gICAgICAgICAgICBtb2R1bGUub2JzZXJ2ZS5tZW51KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRpc2Nvbm5lY3Q6IHtcbiAgICAgICAgICBtZW51T2JzZXJ2ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYobWVudU9ic2VydmVyKSB7XG4gICAgICAgICAgICAgIG1lbnVPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWxlY3RPYnNlcnZlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihzZWxlY3RPYnNlcnZlcikge1xuICAgICAgICAgICAgICBzZWxlY3RPYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvYnNlcnZlOiB7XG4gICAgICAgICAgc2VsZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5oYXMuaW5wdXQoKSkge1xuICAgICAgICAgICAgICBzZWxlY3RPYnNlcnZlci5vYnNlcnZlKCRtb2R1bGVbMF0sIHtcbiAgICAgICAgICAgICAgICBjaGlsZExpc3QgOiB0cnVlLFxuICAgICAgICAgICAgICAgIHN1YnRyZWUgICA6IHRydWVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtZW51OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5oYXMubWVudSgpKSB7XG4gICAgICAgICAgICAgIG1lbnVPYnNlcnZlci5vYnNlcnZlKCRtZW51WzBdLCB7XG4gICAgICAgICAgICAgICAgY2hpbGRMaXN0IDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzdWJ0cmVlICAgOiB0cnVlXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICBpZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZCA9IChNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KSArICcwMDAwMDAwMDAnKS5zdWJzdHIoMiwgOCk7XG4gICAgICAgICAgICBlbGVtZW50TmFtZXNwYWNlID0gJy4nICsgaWQ7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQ3JlYXRpbmcgdW5pcXVlIGlkIGZvciBlbGVtZW50JywgaWQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdXNlckNob2ljZTogZnVuY3Rpb24odmFsdWVzKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJHVzZXJDaG9pY2VzLFxuICAgICAgICAgICAgICAkdXNlckNob2ljZSxcbiAgICAgICAgICAgICAgaXNVc2VyVmFsdWUsXG4gICAgICAgICAgICAgIGh0bWxcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHZhbHVlcyA9IHZhbHVlcyB8fCBtb2R1bGUuZ2V0LnVzZXJWYWx1ZXMoKTtcbiAgICAgICAgICAgIGlmKCF2YWx1ZXMpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFsdWVzID0gJC5pc0FycmF5KHZhbHVlcylcbiAgICAgICAgICAgICAgPyB2YWx1ZXNcbiAgICAgICAgICAgICAgOiBbdmFsdWVzXVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJC5lYWNoKHZhbHVlcywgZnVuY3Rpb24oaW5kZXgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIGlmKG1vZHVsZS5nZXQuaXRlbSh2YWx1ZSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgaHRtbCAgICAgICAgID0gc2V0dGluZ3MudGVtcGxhdGVzLmFkZGl0aW9uKCBtb2R1bGUuYWRkLnZhcmlhYmxlcyhtZXNzYWdlLmFkZFJlc3VsdCwgdmFsdWUpICk7XG4gICAgICAgICAgICAgICAgJHVzZXJDaG9pY2UgID0gJCgnPGRpdiAvPicpXG4gICAgICAgICAgICAgICAgICAuaHRtbChodG1sKVxuICAgICAgICAgICAgICAgICAgLmF0dHIoJ2RhdGEtJyArIG1ldGFkYXRhLnZhbHVlLCB2YWx1ZSlcbiAgICAgICAgICAgICAgICAgIC5hdHRyKCdkYXRhLScgKyBtZXRhZGF0YS50ZXh0LCB2YWx1ZSlcbiAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYWRkaXRpb24pXG4gICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLml0ZW0pXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLmhpZGVBZGRpdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICR1c2VyQ2hvaWNlLmFkZENsYXNzKGNsYXNzTmFtZS5oaWRkZW4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAkdXNlckNob2ljZXMgPSAoJHVzZXJDaG9pY2VzID09PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICA/ICR1c2VyQ2hvaWNlXG4gICAgICAgICAgICAgICAgICA6ICR1c2VyQ2hvaWNlcy5hZGQoJHVzZXJDaG9pY2UpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdDcmVhdGluZyB1c2VyIGNob2ljZXMgZm9yIHZhbHVlJywgdmFsdWUsICR1c2VyQ2hvaWNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gJHVzZXJDaG9pY2VzO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdXNlckxhYmVsczogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB1c2VyVmFsdWVzID0gbW9kdWxlLmdldC51c2VyVmFsdWVzKClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHVzZXJWYWx1ZXMpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgdXNlciBsYWJlbHMnLCB1c2VyVmFsdWVzKTtcbiAgICAgICAgICAgICAgJC5lYWNoKHVzZXJWYWx1ZXMsIGZ1bmN0aW9uKGluZGV4LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBZGRpbmcgY3VzdG9tIHVzZXIgdmFsdWUnKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuYWRkLmxhYmVsKHZhbHVlLCB2YWx1ZSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbWVudTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbWVudSA9ICQoJzxkaXYgLz4nKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLm1lbnUpXG4gICAgICAgICAgICAgIC5hcHBlbmRUbygkbW9kdWxlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2l6ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNpemVyID0gJCgnPHNwYW4gLz4nKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLnNpemVyKVxuICAgICAgICAgICAgICAuaW5zZXJ0QWZ0ZXIoJHNlYXJjaClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2VhcmNoOiBmdW5jdGlvbihxdWVyeSkge1xuICAgICAgICAgIHF1ZXJ5ID0gKHF1ZXJ5ICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICA/IHF1ZXJ5XG4gICAgICAgICAgICA6IG1vZHVsZS5nZXQucXVlcnkoKVxuICAgICAgICAgIDtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2VhcmNoaW5nIGZvciBxdWVyeScsIHF1ZXJ5KTtcbiAgICAgICAgICBpZihtb2R1bGUuaGFzLm1pbkNoYXJhY3RlcnMocXVlcnkpKSB7XG4gICAgICAgICAgICBtb2R1bGUuZmlsdGVyKHF1ZXJ5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUuaGlkZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICBmaXJzdFVuZmlsdGVyZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NlbGVjdGluZyBmaXJzdCBub24tZmlsdGVyZWQgZWxlbWVudCcpO1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5zZWxlY3RlZEl0ZW0oKTtcbiAgICAgICAgICAgICRpdGVtXG4gICAgICAgICAgICAgIC5ub3Qoc2VsZWN0b3IudW5zZWxlY3RhYmxlKVxuICAgICAgICAgICAgICAubm90KHNlbGVjdG9yLmFkZGl0aW9uICsgc2VsZWN0b3IuaGlkZGVuKVxuICAgICAgICAgICAgICAgIC5lcSgwKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBuZXh0QXZhaWxhYmxlOiBmdW5jdGlvbigkc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICRzZWxlY3RlZCA9ICRzZWxlY3RlZC5lcSgwKTtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkbmV4dEF2YWlsYWJsZSA9ICRzZWxlY3RlZC5uZXh0QWxsKHNlbGVjdG9yLml0ZW0pLm5vdChzZWxlY3Rvci51bnNlbGVjdGFibGUpLmVxKDApLFxuICAgICAgICAgICAgICAkcHJldkF2YWlsYWJsZSA9ICRzZWxlY3RlZC5wcmV2QWxsKHNlbGVjdG9yLml0ZW0pLm5vdChzZWxlY3Rvci51bnNlbGVjdGFibGUpLmVxKDApLFxuICAgICAgICAgICAgICBoYXNOZXh0ICAgICAgICA9ICgkbmV4dEF2YWlsYWJsZS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoaGFzTmV4dCkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTW92aW5nIHNlbGVjdGlvbiB0bycsICRuZXh0QXZhaWxhYmxlKTtcbiAgICAgICAgICAgICAgJG5leHRBdmFpbGFibGUuYWRkQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTW92aW5nIHNlbGVjdGlvbiB0bycsICRwcmV2QXZhaWxhYmxlKTtcbiAgICAgICAgICAgICAgJHByZXZBdmFpbGFibGUuYWRkQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dXA6IHtcbiAgICAgICAgICBhcGk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGFwaVNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIGRlYnVnICAgOiBzZXR0aW5ncy5kZWJ1ZyxcbiAgICAgICAgICAgICAgICB1cmxEYXRhIDoge1xuICAgICAgICAgICAgICAgICAgdmFsdWUgOiBtb2R1bGUuZ2V0LnZhbHVlKCksXG4gICAgICAgICAgICAgICAgICBxdWVyeSA6IG1vZHVsZS5nZXQucXVlcnkoKVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb24gICAgOiBmYWxzZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRmlyc3QgcmVxdWVzdCwgaW5pdGlhbGl6aW5nIEFQSScpO1xuICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAuYXBpKGFwaVNldHRpbmdzKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbGF5b3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCAkbW9kdWxlLmlzKCdzZWxlY3QnKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldHVwLnNlbGVjdCgpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0dXAucmV0dXJuZWRPYmplY3QoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCAhbW9kdWxlLmhhcy5tZW51KCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5jcmVhdGUubWVudSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5zZWFyY2goKSAmJiAhbW9kdWxlLmhhcy5zZWFyY2goKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FkZGluZyBzZWFyY2ggaW5wdXQnKTtcbiAgICAgICAgICAgICAgJHNlYXJjaCA9ICQoJzxpbnB1dCAvPicpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5zZWFyY2gpXG4gICAgICAgICAgICAgICAgLnByb3AoJ2F1dG9jb21wbGV0ZScsICdvZmYnKVxuICAgICAgICAgICAgICAgIC5pbnNlcnRCZWZvcmUoJHRleHQpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCBtb2R1bGUuaXMubXVsdGlwbGUoKSAmJiBtb2R1bGUuaXMuc2VhcmNoU2VsZWN0aW9uKCkgJiYgIW1vZHVsZS5oYXMuc2l6ZXIoKSkge1xuICAgICAgICAgICAgICBtb2R1bGUuY3JlYXRlLnNpemVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5hbGxvd1RhYikge1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnRhYmJhYmxlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWxlY3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHNlbGVjdFZhbHVlcyAgPSBtb2R1bGUuZ2V0LnNlbGVjdFZhbHVlcygpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0Ryb3Bkb3duIGluaXRpYWxpemVkIG9uIGEgc2VsZWN0Jywgc2VsZWN0VmFsdWVzKTtcbiAgICAgICAgICAgIGlmKCAkbW9kdWxlLmlzKCdzZWxlY3QnKSApIHtcbiAgICAgICAgICAgICAgJGlucHV0ID0gJG1vZHVsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHNlZSBpZiBzZWxlY3QgaXMgcGxhY2VkIGNvcnJlY3RseSBhbHJlYWR5XG4gICAgICAgICAgICBpZigkaW5wdXQucGFyZW50KHNlbGVjdG9yLmRyb3Bkb3duKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVUkgZHJvcGRvd24gYWxyZWFkeSBleGlzdHMuIENyZWF0aW5nIGRyb3Bkb3duIG1lbnUgb25seScpO1xuICAgICAgICAgICAgICAkbW9kdWxlID0gJGlucHV0LmNsb3Nlc3Qoc2VsZWN0b3IuZHJvcGRvd24pO1xuICAgICAgICAgICAgICBpZiggIW1vZHVsZS5oYXMubWVudSgpICkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5jcmVhdGUubWVudSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICRtZW51ID0gJG1vZHVsZS5jaGlsZHJlbihzZWxlY3Rvci5tZW51KTtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldHVwLm1lbnUoc2VsZWN0VmFsdWVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NyZWF0aW5nIGVudGlyZSBkcm9wZG93biBmcm9tIHNlbGVjdCcpO1xuICAgICAgICAgICAgICAkbW9kdWxlID0gJCgnPGRpdiAvPicpXG4gICAgICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJGlucHV0LmF0dHIoJ2NsYXNzJykgKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuc2VsZWN0aW9uKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuZHJvcGRvd24pXG4gICAgICAgICAgICAgICAgLmh0bWwoIHRlbXBsYXRlcy5kcm9wZG93bihzZWxlY3RWYWx1ZXMpIClcbiAgICAgICAgICAgICAgICAuaW5zZXJ0QmVmb3JlKCRpbnB1dClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBpZigkaW5wdXQuaGFzQ2xhc3MoY2xhc3NOYW1lLm11bHRpcGxlKSAmJiAkaW5wdXQucHJvcCgnbXVsdGlwbGUnKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IubWlzc2luZ011bHRpcGxlKTtcbiAgICAgICAgICAgICAgICAkaW5wdXQucHJvcCgnbXVsdGlwbGUnLCB0cnVlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZigkaW5wdXQuaXMoJ1ttdWx0aXBsZV0nKSkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5zZXQubXVsdGlwbGUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoJGlucHV0LnByb3AoJ2Rpc2FibGVkJykpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0Rpc2FibGluZyBkcm9wZG93bicpO1xuICAgICAgICAgICAgICAgICRtb2R1bGUuYWRkQ2xhc3MoY2xhc3NOYW1lLmRpc2FibGVkKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAkaW5wdXRcbiAgICAgICAgICAgICAgICAucmVtb3ZlQXR0cignY2xhc3MnKVxuICAgICAgICAgICAgICAgIC5kZXRhY2goKVxuICAgICAgICAgICAgICAgIC5wcmVwZW5kVG8oJG1vZHVsZSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLnJlZnJlc2goKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1lbnU6IGZ1bmN0aW9uKHZhbHVlcykge1xuICAgICAgICAgICAgJG1lbnUuaHRtbCggdGVtcGxhdGVzLm1lbnUodmFsdWVzLCBmaWVsZHMpKTtcbiAgICAgICAgICAgICRpdGVtID0gJG1lbnUuZmluZChzZWxlY3Rvci5pdGVtKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlZmVyZW5jZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0Ryb3Bkb3duIGJlaGF2aW9yIHdhcyBjYWxsZWQgb24gc2VsZWN0LCByZXBsYWNpbmcgd2l0aCBjbG9zZXN0IGRyb3Bkb3duJyk7XG4gICAgICAgICAgICAvLyByZXBsYWNlIG1vZHVsZSByZWZlcmVuY2VcbiAgICAgICAgICAgICRtb2R1bGUgID0gJG1vZHVsZS5wYXJlbnQoc2VsZWN0b3IuZHJvcGRvd24pO1xuICAgICAgICAgICAgaW5zdGFuY2UgPSAkbW9kdWxlLmRhdGEobW9kdWxlTmFtZXNwYWNlKTtcbiAgICAgICAgICAgIGVsZW1lbnQgID0gJG1vZHVsZS5nZXQoMCk7XG4gICAgICAgICAgICBtb2R1bGUucmVmcmVzaCgpO1xuICAgICAgICAgICAgbW9kdWxlLnNldHVwLnJldHVybmVkT2JqZWN0KCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXR1cm5lZE9iamVjdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJGZpcnN0TW9kdWxlcyA9ICRhbGxNb2R1bGVzLnNsaWNlKDAsIGVsZW1lbnRJbmRleCksXG4gICAgICAgICAgICAgICRsYXN0TW9kdWxlcyAgPSAkYWxsTW9kdWxlcy5zbGljZShlbGVtZW50SW5kZXggKyAxKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgLy8gYWRqdXN0IGFsbCBtb2R1bGVzIHRvIHVzZSBjb3JyZWN0IHJlZmVyZW5jZVxuICAgICAgICAgICAgJGFsbE1vZHVsZXMgPSAkZmlyc3RNb2R1bGVzLmFkZCgkbW9kdWxlKS5hZGQoJGxhc3RNb2R1bGVzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnJlZnJlc2hTZWxlY3RvcnMoKTtcbiAgICAgICAgICBtb2R1bGUucmVmcmVzaERhdGEoKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZWZyZXNoSXRlbXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICRpdGVtID0gJG1lbnUuZmluZChzZWxlY3Rvci5pdGVtKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZWZyZXNoU2VsZWN0b3JzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVmcmVzaGluZyBzZWxlY3RvciBjYWNoZScpO1xuICAgICAgICAgICR0ZXh0ICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IudGV4dCk7XG4gICAgICAgICAgJHNlYXJjaCA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5zZWFyY2gpO1xuICAgICAgICAgICRpbnB1dCAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IuaW5wdXQpO1xuICAgICAgICAgICRpY29uICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IuaWNvbik7XG4gICAgICAgICAgJGNvbWJvICA9ICgkbW9kdWxlLnByZXYoKS5maW5kKHNlbGVjdG9yLnRleHQpLmxlbmd0aCA+IDApXG4gICAgICAgICAgICA/ICRtb2R1bGUucHJldigpLmZpbmQoc2VsZWN0b3IudGV4dClcbiAgICAgICAgICAgIDogJG1vZHVsZS5wcmV2KClcbiAgICAgICAgICA7XG4gICAgICAgICAgJG1lbnUgICAgPSAkbW9kdWxlLmNoaWxkcmVuKHNlbGVjdG9yLm1lbnUpO1xuICAgICAgICAgICRpdGVtICAgID0gJG1lbnUuZmluZChzZWxlY3Rvci5pdGVtKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZWZyZXNoRGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlZnJlc2hpbmcgY2FjaGVkIG1ldGFkYXRhJyk7XG4gICAgICAgICAgJGl0ZW1cbiAgICAgICAgICAgIC5yZW1vdmVEYXRhKG1ldGFkYXRhLnRleHQpXG4gICAgICAgICAgICAucmVtb3ZlRGF0YShtZXRhZGF0YS52YWx1ZSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xlYXJEYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQ2xlYXJpbmcgbWV0YWRhdGEnKTtcbiAgICAgICAgICAkaXRlbVxuICAgICAgICAgICAgLnJlbW92ZURhdGEobWV0YWRhdGEudGV4dClcbiAgICAgICAgICAgIC5yZW1vdmVEYXRhKG1ldGFkYXRhLnZhbHVlKVxuICAgICAgICAgIDtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAucmVtb3ZlRGF0YShtZXRhZGF0YS5kZWZhdWx0VGV4dClcbiAgICAgICAgICAgIC5yZW1vdmVEYXRhKG1ldGFkYXRhLmRlZmF1bHRWYWx1ZSlcbiAgICAgICAgICAgIC5yZW1vdmVEYXRhKG1ldGFkYXRhLnBsYWNlaG9sZGVyVGV4dClcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9nZ2xlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnVG9nZ2xpbmcgbWVudSB2aXNpYmlsaXR5Jyk7XG4gICAgICAgICAgaWYoICFtb2R1bGUuaXMuYWN0aXZlKCkgKSB7XG4gICAgICAgICAgICBtb2R1bGUuc2hvdygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vZHVsZS5oaWRlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgY2FsbGJhY2sgPSAkLmlzRnVuY3Rpb24oY2FsbGJhY2spXG4gICAgICAgICAgICA/IGNhbGxiYWNrXG4gICAgICAgICAgICA6IGZ1bmN0aW9uKCl7fVxuICAgICAgICAgIDtcbiAgICAgICAgICBpZighbW9kdWxlLmNhbi5zaG93KCkgJiYgbW9kdWxlLmlzLnJlbW90ZSgpKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ05vIEFQSSByZXN1bHRzIHJldHJpZXZlZCwgc2VhcmNoaW5nIGJlZm9yZSBzaG93Jyk7XG4gICAgICAgICAgICBtb2R1bGUucXVlcnlSZW1vdGUobW9kdWxlLmdldC5xdWVyeSgpLCBtb2R1bGUuc2hvdyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCBtb2R1bGUuY2FuLnNob3coKSAmJiAhbW9kdWxlLmlzLmFjdGl2ZSgpICkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaG93aW5nIGRyb3Bkb3duJyk7XG4gICAgICAgICAgICBpZihtb2R1bGUuaGFzLm1lc3NhZ2UoKSAmJiAhKG1vZHVsZS5oYXMubWF4U2VsZWN0aW9ucygpIHx8IG1vZHVsZS5oYXMuYWxsUmVzdWx0c0ZpbHRlcmVkKCkpICkge1xuICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLm1lc3NhZ2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5hbGxGaWx0ZXJlZCgpKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoc2V0dGluZ3Mub25TaG93LmNhbGwoZWxlbWVudCkgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5hbmltYXRlLnNob3coZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYoIG1vZHVsZS5jYW4uY2xpY2soKSApIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5iaW5kLmludGVudCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihtb2R1bGUuaGFzLm1lbnVTZWFyY2goKSkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmZvY3VzU2VhcmNoKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG1vZHVsZS5zZXQudmlzaWJsZSgpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwoZWxlbWVudCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBoaWRlOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgIGNhbGxiYWNrID0gJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKVxuICAgICAgICAgICAgPyBjYWxsYmFja1xuICAgICAgICAgICAgOiBmdW5jdGlvbigpe31cbiAgICAgICAgICA7XG4gICAgICAgICAgaWYoIG1vZHVsZS5pcy5hY3RpdmUoKSAmJiAhbW9kdWxlLmlzLmFuaW1hdGluZ091dHdhcmQoKSApIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSGlkaW5nIGRyb3Bkb3duJyk7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5vbkhpZGUuY2FsbChlbGVtZW50KSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmFuaW1hdGUuaGlkZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnZpc2libGUoKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKGVsZW1lbnQpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGlkZU90aGVyczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0ZpbmRpbmcgb3RoZXIgZHJvcGRvd25zIHRvIGhpZGUnKTtcbiAgICAgICAgICAkYWxsTW9kdWxlc1xuICAgICAgICAgICAgLm5vdCgkbW9kdWxlKVxuICAgICAgICAgICAgICAuaGFzKHNlbGVjdG9yLm1lbnUgKyAnLicgKyBjbGFzc05hbWUudmlzaWJsZSlcbiAgICAgICAgICAgICAgICAuZHJvcGRvd24oJ2hpZGUnKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBoaWRlTWVudTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0hpZGluZyBtZW51ICBpbnN0YW50YW5lb3VzbHknKTtcbiAgICAgICAgICBtb2R1bGUucmVtb3ZlLmFjdGl2ZSgpO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUudmlzaWJsZSgpO1xuICAgICAgICAgICRtZW51LnRyYW5zaXRpb24oJ2hpZGUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBoaWRlU3ViTWVudXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgJHN1Yk1lbnVzID0gJG1lbnUuY2hpbGRyZW4oc2VsZWN0b3IuaXRlbSkuZmluZChzZWxlY3Rvci5tZW51KVxuICAgICAgICAgIDtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnSGlkaW5nIHN1YiBtZW51cycsICRzdWJNZW51cyk7XG4gICAgICAgICAgJHN1Yk1lbnVzLnRyYW5zaXRpb24oJ2hpZGUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBiaW5kOiB7XG4gICAgICAgICAgZXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKGhhc1RvdWNoKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5iaW5kLnRvdWNoRXZlbnRzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuYmluZC5rZXlib2FyZEV2ZW50cygpO1xuICAgICAgICAgICAgbW9kdWxlLmJpbmQuaW5wdXRFdmVudHMoKTtcbiAgICAgICAgICAgIG1vZHVsZS5iaW5kLm1vdXNlRXZlbnRzKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0b3VjaEV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1RvdWNoIGRldmljZSBkZXRlY3RlZCBiaW5kaW5nIGFkZGl0aW9uYWwgdG91Y2ggZXZlbnRzJyk7XG4gICAgICAgICAgICBpZiggbW9kdWxlLmlzLnNlYXJjaFNlbGVjdGlvbigpICkge1xuICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nIHNwZWNpYWwgeWV0XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKCBtb2R1bGUuaXMuc2luZ2xlKCkgKSB7XG4gICAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgICAub24oJ3RvdWNoc3RhcnQnICsgZXZlbnROYW1lc3BhY2UsIG1vZHVsZS5ldmVudC50ZXN0LnRvZ2dsZSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJG1lbnVcbiAgICAgICAgICAgICAgLm9uKCd0b3VjaHN0YXJ0JyArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5pdGVtLCBtb2R1bGUuZXZlbnQuaXRlbS5tb3VzZWVudGVyKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAga2V5Ym9hcmRFdmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0JpbmRpbmcga2V5Ym9hcmQgZXZlbnRzJyk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5vbigna2V5ZG93bicgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LmtleWRvd24pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZiggbW9kdWxlLmhhcy5zZWFyY2goKSApIHtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5vbihtb2R1bGUuZ2V0LmlucHV0RXZlbnQoKSArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5zZWFyY2gsIG1vZHVsZS5ldmVudC5pbnB1dClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5tdWx0aXBsZSgpICkge1xuICAgICAgICAgICAgICAkZG9jdW1lbnRcbiAgICAgICAgICAgICAgICAub24oJ2tleWRvd24nICsgZWxlbWVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LmRvY3VtZW50LmtleWRvd24pXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGlucHV0RXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdCaW5kaW5nIGlucHV0IGNoYW5nZSBldmVudHMnKTtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLm9uKCdjaGFuZ2UnICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLmlucHV0LCBtb2R1bGUuZXZlbnQuY2hhbmdlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbW91c2VFdmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0JpbmRpbmcgbW91c2UgZXZlbnRzJyk7XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMubXVsdGlwbGUoKSkge1xuICAgICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgICAgLm9uKCdjbGljaycgICArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5sYWJlbCwgIG1vZHVsZS5ldmVudC5sYWJlbC5jbGljaylcbiAgICAgICAgICAgICAgICAub24oJ2NsaWNrJyAgICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLnJlbW92ZSwgbW9kdWxlLmV2ZW50LnJlbW92ZS5jbGljaylcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5zZWFyY2hTZWxlY3Rpb24oKSApIHtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5vbignbW91c2Vkb3duJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQubW91c2Vkb3duKVxuICAgICAgICAgICAgICAgIC5vbignbW91c2V1cCcgICArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQubW91c2V1cClcbiAgICAgICAgICAgICAgICAub24oJ21vdXNlZG93bicgKyBldmVudE5hbWVzcGFjZSwgc2VsZWN0b3IubWVudSwgICBtb2R1bGUuZXZlbnQubWVudS5tb3VzZWRvd24pXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZXVwJyAgICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLm1lbnUsICAgbW9kdWxlLmV2ZW50Lm1lbnUubW91c2V1cClcbiAgICAgICAgICAgICAgICAub24oJ2NsaWNrJyAgICAgKyBldmVudE5hbWVzcGFjZSwgc2VsZWN0b3IuaWNvbiwgICBtb2R1bGUuZXZlbnQuaWNvbi5jbGljaylcbiAgICAgICAgICAgICAgICAub24oJ2ZvY3VzJyAgICAgKyBldmVudE5hbWVzcGFjZSwgc2VsZWN0b3Iuc2VhcmNoLCBtb2R1bGUuZXZlbnQuc2VhcmNoLmZvY3VzKVxuICAgICAgICAgICAgICAgIC5vbignY2xpY2snICAgICArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5zZWFyY2gsIG1vZHVsZS5ldmVudC5zZWFyY2guZm9jdXMpXG4gICAgICAgICAgICAgICAgLm9uKCdibHVyJyAgICAgICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLnNlYXJjaCwgbW9kdWxlLmV2ZW50LnNlYXJjaC5ibHVyKVxuICAgICAgICAgICAgICAgIC5vbignY2xpY2snICAgICArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci50ZXh0LCAgIG1vZHVsZS5ldmVudC50ZXh0LmZvY3VzKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5tdWx0aXBsZSgpKSB7XG4gICAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgICAgLm9uKCdjbGljaycgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LmNsaWNrKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIGlmKHNldHRpbmdzLm9uID09ICdjbGljaycpIHtcbiAgICAgICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgICAgICAub24oJ2NsaWNrJyArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5pY29uLCBtb2R1bGUuZXZlbnQuaWNvbi5jbGljaylcbiAgICAgICAgICAgICAgICAgIC5vbignY2xpY2snICsgZXZlbnROYW1lc3BhY2UsIG1vZHVsZS5ldmVudC50ZXN0LnRvZ2dsZSlcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZihzZXR0aW5ncy5vbiA9PSAnaG92ZXInKSB7XG4gICAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgICAgLm9uKCdtb3VzZWVudGVyJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZGVsYXkuc2hvdylcbiAgICAgICAgICAgICAgICAgIC5vbignbW91c2VsZWF2ZScgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmRlbGF5LmhpZGUpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgICAgIC5vbihzZXR0aW5ncy5vbiArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUudG9nZ2xlKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZWRvd24nICsgZXZlbnROYW1lc3BhY2UsIG1vZHVsZS5ldmVudC5tb3VzZWRvd24pXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZXVwJyAgICsgZXZlbnROYW1lc3BhY2UsIG1vZHVsZS5ldmVudC5tb3VzZXVwKVxuICAgICAgICAgICAgICAgIC5vbignZm9jdXMnICAgICArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuZm9jdXMpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYobW9kdWxlLmhhcy5tZW51U2VhcmNoKCkgKSB7XG4gICAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgICAgLm9uKCdibHVyJyArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5zZWFyY2gsIG1vZHVsZS5ldmVudC5zZWFyY2guYmx1cilcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgICAgLm9uKCdibHVyJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuYmx1cilcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRtZW51XG4gICAgICAgICAgICAgIC5vbignbW91c2VlbnRlcicgKyBldmVudE5hbWVzcGFjZSwgc2VsZWN0b3IuaXRlbSwgbW9kdWxlLmV2ZW50Lml0ZW0ubW91c2VlbnRlcilcbiAgICAgICAgICAgICAgLm9uKCdtb3VzZWxlYXZlJyArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5pdGVtLCBtb2R1bGUuZXZlbnQuaXRlbS5tb3VzZWxlYXZlKVxuICAgICAgICAgICAgICAub24oJ2NsaWNrJyAgICAgICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLml0ZW0sIG1vZHVsZS5ldmVudC5pdGVtLmNsaWNrKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaW50ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdCaW5kaW5nIGhpZGUgaW50ZW50IGV2ZW50IHRvIGRvY3VtZW50Jyk7XG4gICAgICAgICAgICBpZihoYXNUb3VjaCkge1xuICAgICAgICAgICAgICAkZG9jdW1lbnRcbiAgICAgICAgICAgICAgICAub24oJ3RvdWNoc3RhcnQnICsgZWxlbWVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LnRlc3QudG91Y2gpXG4gICAgICAgICAgICAgICAgLm9uKCd0b3VjaG1vdmUnICArIGVsZW1lbnROYW1lc3BhY2UsIG1vZHVsZS5ldmVudC50ZXN0LnRvdWNoKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkZG9jdW1lbnRcbiAgICAgICAgICAgICAgLm9uKCdjbGljaycgKyBlbGVtZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQudGVzdC5oaWRlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB1bmJpbmQ6IHtcbiAgICAgICAgICBpbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlbW92aW5nIGhpZGUgaW50ZW50IGV2ZW50IGZyb20gZG9jdW1lbnQnKTtcbiAgICAgICAgICAgIGlmKGhhc1RvdWNoKSB7XG4gICAgICAgICAgICAgICRkb2N1bWVudFxuICAgICAgICAgICAgICAgIC5vZmYoJ3RvdWNoc3RhcnQnICsgZWxlbWVudE5hbWVzcGFjZSlcbiAgICAgICAgICAgICAgICAub2ZmKCd0b3VjaG1vdmUnICsgZWxlbWVudE5hbWVzcGFjZSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGRvY3VtZW50XG4gICAgICAgICAgICAgIC5vZmYoJ2NsaWNrJyArIGVsZW1lbnROYW1lc3BhY2UpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGZpbHRlcjogZnVuY3Rpb24ocXVlcnkpIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIHNlYXJjaFRlcm0gPSAocXVlcnkgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyBxdWVyeVxuICAgICAgICAgICAgICA6IG1vZHVsZS5nZXQucXVlcnkoKSxcbiAgICAgICAgICAgIGFmdGVyRmlsdGVyZWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgaWYobW9kdWxlLmlzLm11bHRpcGxlKCkpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZmlsdGVyQWN0aXZlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYocXVlcnkgfHwgKCFxdWVyeSAmJiBtb2R1bGUuZ2V0LmFjdGl2ZUl0ZW0oKS5sZW5ndGggPT0gMCkpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuc2VsZWN0LmZpcnN0VW5maWx0ZXJlZCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKCBtb2R1bGUuaGFzLmFsbFJlc3VsdHNGaWx0ZXJlZCgpICkge1xuICAgICAgICAgICAgICAgIGlmKCBzZXR0aW5ncy5vbk5vUmVzdWx0cy5jYWxsKGVsZW1lbnQsIHNlYXJjaFRlcm0pICkge1xuICAgICAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuYWxsb3dBZGRpdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuaGlkZUFkZGl0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdVc2VyIGFkZGl0aW9uIHdpdGggbm8gbWVudSwgc2V0dGluZyBlbXB0eSBzdHlsZScpO1xuICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS5zZXQuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUuaGlkZU1lbnUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBbGwgaXRlbXMgZmlsdGVyZWQsIHNob3dpbmcgbWVzc2FnZScsIHNlYXJjaFRlcm0pO1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuYWRkLm1lc3NhZ2UobWVzc2FnZS5ub1Jlc3VsdHMpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBbGwgaXRlbXMgZmlsdGVyZWQsIGhpZGluZyBkcm9wZG93bicsIHNlYXJjaFRlcm0pO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmhpZGVNZW51KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLm1lc3NhZ2UoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZihzZXR0aW5ncy5hbGxvd0FkZGl0aW9ucykge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5hZGQudXNlclN1Z2dlc3Rpb24ocXVlcnkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5zZWFyY2hTZWxlY3Rpb24oKSAmJiBtb2R1bGUuY2FuLnNob3coKSAmJiBtb2R1bGUuaXMuZm9jdXNlZE9uU2VhcmNoKCkgKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNob3coKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIDtcbiAgICAgICAgICBpZihzZXR0aW5ncy51c2VMYWJlbHMgJiYgbW9kdWxlLmhhcy5tYXhTZWxlY3Rpb25zKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoc2V0dGluZ3MuYXBpU2V0dGluZ3MpIHtcbiAgICAgICAgICAgIGlmKCBtb2R1bGUuY2FuLnVzZUFQSSgpICkge1xuICAgICAgICAgICAgICBtb2R1bGUucXVlcnlSZW1vdGUoc2VhcmNoVGVybSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuZmlsdGVyUmVtb3RlRGF0YSkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmZpbHRlckl0ZW1zKHNlYXJjaFRlcm0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhZnRlckZpbHRlcmVkKCk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5ub0FQSSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbW9kdWxlLmZpbHRlckl0ZW1zKHNlYXJjaFRlcm0pO1xuICAgICAgICAgICAgYWZ0ZXJGaWx0ZXJlZCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBxdWVyeVJlbW90ZTogZnVuY3Rpb24ocXVlcnksIGNhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBhcGlTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgZXJyb3JEdXJhdGlvbiA6IGZhbHNlLFxuICAgICAgICAgICAgICBjYWNoZSAgICAgICAgIDogJ2xvY2FsJyxcbiAgICAgICAgICAgICAgdGhyb3R0bGUgICAgICA6IHNldHRpbmdzLnRocm90dGxlLFxuICAgICAgICAgICAgICB1cmxEYXRhICAgICAgIDoge1xuICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBvbkVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuYWRkLm1lc3NhZ2UobWVzc2FnZS5zZXJ2ZXJFcnJvcik7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgb25GYWlsdXJlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuYWRkLm1lc3NhZ2UobWVzc2FnZS5zZXJ2ZXJFcnJvcik7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgb25TdWNjZXNzIDogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAgIHZhbHVlcyAgICAgICAgICA9IHJlc3BvbnNlW2ZpZWxkcy5yZW1vdGVWYWx1ZXNdLFxuICAgICAgICAgICAgICAgICAgaGFzUmVtb3RlVmFsdWVzID0gKCQuaXNBcnJheSh2YWx1ZXMpICYmIHZhbHVlcy5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICBpZihoYXNSZW1vdGVWYWx1ZXMpIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUubWVzc2FnZSgpO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldHVwLm1lbnUoe1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6IHJlc3BvbnNlW2ZpZWxkcy5yZW1vdGVWYWx1ZXNdXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuYWRkLm1lc3NhZ2UobWVzc2FnZS5ub1Jlc3VsdHMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKCAhJG1vZHVsZS5hcGkoJ2dldCByZXF1ZXN0JykgKSB7XG4gICAgICAgICAgICBtb2R1bGUuc2V0dXAuYXBpKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGFwaVNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGFwaVNldHRpbmdzLCBzZXR0aW5ncy5hcGlTZXR0aW5ncyk7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLmFwaSgnc2V0dGluZycsIGFwaVNldHRpbmdzKVxuICAgICAgICAgICAgLmFwaSgncXVlcnknKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBmaWx0ZXJJdGVtczogZnVuY3Rpb24ocXVlcnkpIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIHNlYXJjaFRlcm0gPSAocXVlcnkgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyBxdWVyeVxuICAgICAgICAgICAgICA6IG1vZHVsZS5nZXQucXVlcnkoKSxcbiAgICAgICAgICAgIHJlc3VsdHMgICAgICAgICAgPSAgbnVsbCxcbiAgICAgICAgICAgIGVzY2FwZWRUZXJtICAgICAgPSBtb2R1bGUuZXNjYXBlLnN0cmluZyhzZWFyY2hUZXJtKSxcbiAgICAgICAgICAgIGJlZ2luc1dpdGhSZWdFeHAgPSBuZXcgUmVnRXhwKCdeJyArIGVzY2FwZWRUZXJtLCAnaWdtJylcbiAgICAgICAgICA7XG4gICAgICAgICAgLy8gYXZvaWQgbG9vcCBpZiB3ZSdyZSBtYXRjaGluZyBub3RoaW5nXG4gICAgICAgICAgaWYoIG1vZHVsZS5oYXMucXVlcnkoKSApIHtcbiAgICAgICAgICAgIHJlc3VsdHMgPSBbXTtcblxuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NlYXJjaGluZyBmb3IgbWF0Y2hpbmcgdmFsdWVzJywgc2VhcmNoVGVybSk7XG4gICAgICAgICAgICAkaXRlbVxuICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICAgJGNob2ljZSA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgICB0ZXh0LFxuICAgICAgICAgICAgICAgICAgdmFsdWVcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgaWYoc2V0dGluZ3MubWF0Y2ggPT0gJ2JvdGgnIHx8IHNldHRpbmdzLm1hdGNoID09ICd0ZXh0Jykge1xuICAgICAgICAgICAgICAgICAgdGV4dCA9IFN0cmluZyhtb2R1bGUuZ2V0LmNob2ljZVRleHQoJGNob2ljZSwgZmFsc2UpKTtcbiAgICAgICAgICAgICAgICAgIGlmKHRleHQuc2VhcmNoKGJlZ2luc1dpdGhSZWdFeHApICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2godGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc2V0dGluZ3MuZnVsbFRleHRTZWFyY2ggPT09ICdleGFjdCcgJiYgbW9kdWxlLmV4YWN0U2VhcmNoKHNlYXJjaFRlcm0sIHRleHQpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBlbHNlIGlmIChzZXR0aW5ncy5mdWxsVGV4dFNlYXJjaCA9PT0gdHJ1ZSAmJiBtb2R1bGUuZnV6enlTZWFyY2goc2VhcmNoVGVybSwgdGV4dCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0cy5wdXNoKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYoc2V0dGluZ3MubWF0Y2ggPT0gJ2JvdGgnIHx8IHNldHRpbmdzLm1hdGNoID09ICd2YWx1ZScpIHtcbiAgICAgICAgICAgICAgICAgIHZhbHVlID0gU3RyaW5nKG1vZHVsZS5nZXQuY2hvaWNlVmFsdWUoJGNob2ljZSwgdGV4dCkpO1xuICAgICAgICAgICAgICAgICAgaWYodmFsdWUuc2VhcmNoKGJlZ2luc1dpdGhSZWdFeHApICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2godGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc2V0dGluZ3MuZnVsbFRleHRTZWFyY2ggPT09ICdleGFjdCcgJiYgbW9kdWxlLmV4YWN0U2VhcmNoKHNlYXJjaFRlcm0sIHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2godGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoc2V0dGluZ3MuZnVsbFRleHRTZWFyY2ggPT09IHRydWUgJiYgbW9kdWxlLmZ1enp5U2VhcmNoKHNlYXJjaFRlcm0sIHZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2godGhpcyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaG93aW5nIG9ubHkgbWF0Y2hlZCBpdGVtcycsIHNlYXJjaFRlcm0pO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUuZmlsdGVyZWRJdGVtKCk7XG4gICAgICAgICAgaWYocmVzdWx0cykge1xuICAgICAgICAgICAgJGl0ZW1cbiAgICAgICAgICAgICAgLm5vdChyZXN1bHRzKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLmZpbHRlcmVkKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBmdXp6eVNlYXJjaDogZnVuY3Rpb24ocXVlcnksIHRlcm0pIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIHRlcm1MZW5ndGggID0gdGVybS5sZW5ndGgsXG4gICAgICAgICAgICBxdWVyeUxlbmd0aCA9IHF1ZXJ5Lmxlbmd0aFxuICAgICAgICAgIDtcbiAgICAgICAgICBxdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgdGVybSAgPSB0ZXJtLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgaWYocXVlcnlMZW5ndGggPiB0ZXJtTGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKHF1ZXJ5TGVuZ3RoID09PSB0ZXJtTGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gKHF1ZXJ5ID09PSB0ZXJtKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc2VhcmNoOiBmb3IgKHZhciBjaGFyYWN0ZXJJbmRleCA9IDAsIG5leHRDaGFyYWN0ZXJJbmRleCA9IDA7IGNoYXJhY3RlckluZGV4IDwgcXVlcnlMZW5ndGg7IGNoYXJhY3RlckluZGV4KyspIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBxdWVyeUNoYXJhY3RlciA9IHF1ZXJ5LmNoYXJDb2RlQXQoY2hhcmFjdGVySW5kZXgpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICB3aGlsZShuZXh0Q2hhcmFjdGVySW5kZXggPCB0ZXJtTGVuZ3RoKSB7XG4gICAgICAgICAgICAgIGlmKHRlcm0uY2hhckNvZGVBdChuZXh0Q2hhcmFjdGVySW5kZXgrKykgPT09IHF1ZXJ5Q2hhcmFjdGVyKSB7XG4gICAgICAgICAgICAgICAgY29udGludWUgc2VhcmNoO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9LFxuICAgICAgICBleGFjdFNlYXJjaDogZnVuY3Rpb24gKHF1ZXJ5LCB0ZXJtKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIHRlcm0gID0gdGVybS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIGlmKHRlcm0uaW5kZXhPZihxdWVyeSkgPiAtMSkge1xuICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICAgIGZpbHRlckFjdGl2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoc2V0dGluZ3MudXNlTGFiZWxzKSB7XG4gICAgICAgICAgICAkaXRlbS5maWx0ZXIoJy4nICsgY2xhc3NOYW1lLmFjdGl2ZSlcbiAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5maWx0ZXJlZClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZm9jdXNTZWFyY2g6IGZ1bmN0aW9uKHNraXBIYW5kbGVyKSB7XG4gICAgICAgICAgaWYoIG1vZHVsZS5oYXMuc2VhcmNoKCkgJiYgIW1vZHVsZS5pcy5mb2N1c2VkT25TZWFyY2goKSApIHtcbiAgICAgICAgICAgIGlmKHNraXBIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICRtb2R1bGUub2ZmKCdmb2N1cycgKyBldmVudE5hbWVzcGFjZSwgc2VsZWN0b3Iuc2VhcmNoKTtcbiAgICAgICAgICAgICAgJHNlYXJjaC5mb2N1cygpO1xuICAgICAgICAgICAgICAkbW9kdWxlLm9uKCdmb2N1cycgICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLnNlYXJjaCwgbW9kdWxlLmV2ZW50LnNlYXJjaC5mb2N1cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgJHNlYXJjaC5mb2N1cygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBmb3JjZVNlbGVjdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAkY3VycmVudGx5U2VsZWN0ZWQgPSAkaXRlbS5ub3QoY2xhc3NOYW1lLmZpbHRlcmVkKS5maWx0ZXIoJy4nICsgY2xhc3NOYW1lLnNlbGVjdGVkKS5lcSgwKSxcbiAgICAgICAgICAgICRhY3RpdmVJdGVtICAgICAgICA9ICRpdGVtLm5vdChjbGFzc05hbWUuZmlsdGVyZWQpLmZpbHRlcignLicgKyBjbGFzc05hbWUuYWN0aXZlKS5lcSgwKSxcbiAgICAgICAgICAgICRzZWxlY3RlZEl0ZW0gICAgICA9ICgkY3VycmVudGx5U2VsZWN0ZWQubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgPyAkY3VycmVudGx5U2VsZWN0ZWRcbiAgICAgICAgICAgICAgOiAkYWN0aXZlSXRlbSxcbiAgICAgICAgICAgIGhhc1NlbGVjdGVkID0gKCRzZWxlY3RlZEl0ZW0ubGVuZ3RoID4gMClcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYoaGFzU2VsZWN0ZWQgJiYgIW1vZHVsZS5pcy5tdWx0aXBsZSgpKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0ZvcmNpbmcgcGFydGlhbCBzZWxlY3Rpb24gdG8gc2VsZWN0ZWQgaXRlbScsICRzZWxlY3RlZEl0ZW0pO1xuICAgICAgICAgICAgbW9kdWxlLmV2ZW50Lml0ZW0uY2xpY2suY2FsbCgkc2VsZWN0ZWRJdGVtLCB7fSwgdHJ1ZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuYWxsb3dBZGRpdGlvbnMpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5zZWxlY3RlZChtb2R1bGUuZ2V0LnF1ZXJ5KCkpO1xuICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnNlYXJjaFRlcm0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnNlYXJjaFRlcm0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlOiB7XG4gICAgICAgICAgdmFsdWVzOiBmdW5jdGlvbih2YWx1ZXMpIHtcbiAgICAgICAgICAgIGlmKCFzZXR0aW5ncy5hbGxvd0FkZGl0aW9ucykge1xuICAgICAgICAgICAgICBtb2R1bGUuY2xlYXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ3JlYXRpbmcgZHJvcGRvd24gd2l0aCBzcGVjaWZpZWQgdmFsdWVzJywgdmFsdWVzKTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXR1cC5tZW51KHt2YWx1ZXM6IHZhbHVlc30pO1xuICAgICAgICAgICAgJC5lYWNoKHZhbHVlcywgZnVuY3Rpb24oaW5kZXgsIGl0ZW0pIHtcbiAgICAgICAgICAgICAgaWYoaXRlbS5zZWxlY3RlZCA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZXR0aW5nIGluaXRpYWwgc2VsZWN0aW9uIHRvJywgaXRlbS52YWx1ZSk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zZWxlY3RlZChpdGVtLnZhbHVlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50OiB7XG4gICAgICAgICAgY2hhbmdlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCFpbnRlcm5hbENoYW5nZSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0lucHV0IGNoYW5nZWQsIHVwZGF0aW5nIHNlbGVjdGlvbicpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnNlbGVjdGVkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmb2N1czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5zaG93T25Gb2N1cyAmJiAhYWN0aXZhdGVkICYmIG1vZHVsZS5pcy5oaWRkZW4oKSAmJiAhcGFnZUxvc3RGb2N1cykge1xuICAgICAgICAgICAgICBtb2R1bGUuc2hvdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgYmx1cjogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHBhZ2VMb3N0Rm9jdXMgPSAoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gdGhpcyk7XG4gICAgICAgICAgICBpZighYWN0aXZhdGVkICYmICFwYWdlTG9zdEZvY3VzKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuYWN0aXZlTGFiZWwoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG1vdXNlZG93bjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMuc2VhcmNoU2VsZWN0aW9uKCkpIHtcbiAgICAgICAgICAgICAgLy8gcHJldmVudCBtZW51IGhpZGluZyBvbiBpbW1lZGlhdGUgcmUtZm9jdXNcbiAgICAgICAgICAgICAgd2lsbFJlZm9jdXMgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIC8vIHByZXZlbnRzIGZvY3VzIGNhbGxiYWNrIGZyb20gb2NjdXJyaW5nIG9uIG1vdXNlZG93blxuICAgICAgICAgICAgICBhY3RpdmF0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbW91c2V1cDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMuc2VhcmNoU2VsZWN0aW9uKCkpIHtcbiAgICAgICAgICAgICAgLy8gcHJldmVudCBtZW51IGhpZGluZyBvbiBpbW1lZGlhdGUgcmUtZm9jdXNcbiAgICAgICAgICAgICAgd2lsbFJlZm9jdXMgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBhY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICR0YXJnZXQgPSAkKGV2ZW50LnRhcmdldClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIC8vIGZvY3VzIHNlYXJjaFxuICAgICAgICAgICAgaWYoJHRhcmdldC5pcygkbW9kdWxlKSkge1xuICAgICAgICAgICAgICBpZighbW9kdWxlLmlzLmZvY3VzZWRPblNlYXJjaCgpKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmZvY3VzU2VhcmNoKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNob3coKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VhcmNoOiB7XG4gICAgICAgICAgICBmb2N1czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGFjdGl2YXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5tdWx0aXBsZSgpKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5hY3RpdmVMYWJlbCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKHNldHRpbmdzLnNob3dPbkZvY3VzKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNlYXJjaCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYmx1cjogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgcGFnZUxvc3RGb2N1cyA9IChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSB0aGlzKTtcbiAgICAgICAgICAgICAgaWYobW9kdWxlLmlzLnNlYXJjaFNlbGVjdGlvbigpICYmICF3aWxsUmVmb2N1cykge1xuICAgICAgICAgICAgICAgIGlmKCFpdGVtQWN0aXZhdGVkICYmICFwYWdlTG9zdEZvY3VzKSB7XG4gICAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5mb3JjZVNlbGVjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuZm9yY2VTZWxlY3Rpb24oKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHdpbGxSZWZvY3VzID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpY29uOiB7XG4gICAgICAgICAgICBjbGljazogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgaWYoJGljb24uaGFzQ2xhc3MoY2xhc3NOYW1lLmNsZWFyKSkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5jbGVhcigpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS50b2dnbGUoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGV4dDoge1xuICAgICAgICAgICAgZm9jdXM6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgIGFjdGl2YXRlZCA9IHRydWU7XG4gICAgICAgICAgICAgIG1vZHVsZS5mb2N1c1NlYXJjaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5wdXQ6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMubXVsdGlwbGUoKSB8fCBtb2R1bGUuaXMuc2VhcmNoU2VsZWN0aW9uKCkpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5maWx0ZXJlZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS50aW1lcik7XG4gICAgICAgICAgICBtb2R1bGUudGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5zZWFyY2gsIHNldHRpbmdzLmRlbGF5LnNlYXJjaCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICRsYWJlbCAgICAgICAgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICRsYWJlbHMgICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IubGFiZWwpLFxuICAgICAgICAgICAgICAgICRhY3RpdmVMYWJlbHMgPSAkbGFiZWxzLmZpbHRlcignLicgKyBjbGFzc05hbWUuYWN0aXZlKSxcbiAgICAgICAgICAgICAgICAkbmV4dEFjdGl2ZSAgID0gJGxhYmVsLm5leHRBbGwoJy4nICsgY2xhc3NOYW1lLmFjdGl2ZSksXG4gICAgICAgICAgICAgICAgJHByZXZBY3RpdmUgICA9ICRsYWJlbC5wcmV2QWxsKCcuJyArIGNsYXNzTmFtZS5hY3RpdmUpLFxuICAgICAgICAgICAgICAgICRyYW5nZSA9ICgkbmV4dEFjdGl2ZS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgICAgPyAkbGFiZWwubmV4dFVudGlsKCRuZXh0QWN0aXZlKS5hZGQoJGFjdGl2ZUxhYmVscykuYWRkKCRsYWJlbClcbiAgICAgICAgICAgICAgICAgIDogJGxhYmVsLnByZXZVbnRpbCgkcHJldkFjdGl2ZSkuYWRkKCRhY3RpdmVMYWJlbHMpLmFkZCgkbGFiZWwpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICAkYWN0aXZlTGFiZWxzLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgICAgICAgICRyYW5nZS5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKGV2ZW50LmN0cmxLZXkpIHtcbiAgICAgICAgICAgICAgICAkbGFiZWwudG9nZ2xlQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJGFjdGl2ZUxhYmVscy5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICAgICAgICAkbGFiZWwuYWRkQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgc2V0dGluZ3Mub25MYWJlbFNlbGVjdC5hcHBseSh0aGlzLCAkbGFiZWxzLmZpbHRlcignLicgKyBjbGFzc05hbWUuYWN0aXZlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZW1vdmU6IHtcbiAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgJGxhYmVsID0gJCh0aGlzKS5wYXJlbnQoKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCAkbGFiZWwuaGFzQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSkgKSB7XG4gICAgICAgICAgICAgICAgLy8gcmVtb3ZlIGFsbCBzZWxlY3RlZCBsYWJlbHNcbiAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmFjdGl2ZUxhYmVscygpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSB0aGlzIGxhYmVsIG9ubHlcbiAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmFjdGl2ZUxhYmVscyggJGxhYmVsICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRlc3Q6IHtcbiAgICAgICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgdG9nZ2xlQmVoYXZpb3IgPSAobW9kdWxlLmlzLm11bHRpcGxlKCkpXG4gICAgICAgICAgICAgICAgICA/IG1vZHVsZS5zaG93XG4gICAgICAgICAgICAgICAgICA6IG1vZHVsZS50b2dnbGVcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBpZihtb2R1bGUuaXMuYnViYmxlZExhYmVsQ2xpY2soZXZlbnQpIHx8IG1vZHVsZS5pcy5idWJibGVkSWNvbkNsaWNrKGV2ZW50KSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiggbW9kdWxlLmRldGVybWluZS5ldmVudE9uRWxlbWVudChldmVudCwgdG9nZ2xlQmVoYXZpb3IpICkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b3VjaDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRldGVybWluZS5ldmVudE9uRWxlbWVudChldmVudCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYoZXZlbnQudHlwZSA9PSAndG91Y2hzdGFydCcpIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS50aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICB9LCBzZXR0aW5ncy5kZWxheS50b3VjaCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYoZXZlbnQudHlwZSA9PSAndG91Y2htb3ZlJykge1xuICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS50aW1lcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaGlkZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRldGVybWluZS5ldmVudEluTW9kdWxlKGV2ZW50LCBtb2R1bGUuaGlkZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgIG11dGF0aW9uOiBmdW5jdGlvbihtdXRhdGlvbnMpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCc8c2VsZWN0PiBtb2RpZmllZCwgcmVjcmVhdGluZyBtZW51Jyk7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgIGlzU2VsZWN0TXV0YXRpb24gPSBmYWxzZVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICQuZWFjaChtdXRhdGlvbnMsIGZ1bmN0aW9uKGluZGV4LCBtdXRhdGlvbikge1xuICAgICAgICAgICAgICAgIGlmKCQobXV0YXRpb24udGFyZ2V0KS5pcygnc2VsZWN0JykgfHwgJChtdXRhdGlvbi5hZGRlZE5vZGVzKS5pcygnc2VsZWN0JykpIHtcbiAgICAgICAgICAgICAgICAgIGlzU2VsZWN0TXV0YXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgaWYoaXNTZWxlY3RNdXRhdGlvbikge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kaXNjb25uZWN0LnNlbGVjdE9ic2VydmVyKCk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnJlZnJlc2goKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuc2V0dXAuc2VsZWN0KCk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zZWxlY3RlZCgpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5vYnNlcnZlLnNlbGVjdCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtZW51OiB7XG4gICAgICAgICAgICBtdXRhdGlvbjogZnVuY3Rpb24obXV0YXRpb25zKSB7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgIG11dGF0aW9uICAgPSBtdXRhdGlvbnNbMF0sXG4gICAgICAgICAgICAgICAgJGFkZGVkTm9kZSA9IG11dGF0aW9uLmFkZGVkTm9kZXNcbiAgICAgICAgICAgICAgICAgID8gJChtdXRhdGlvbi5hZGRlZE5vZGVzWzBdKVxuICAgICAgICAgICAgICAgICAgOiAkKGZhbHNlKSxcbiAgICAgICAgICAgICAgICAkcmVtb3ZlZE5vZGUgPSBtdXRhdGlvbi5yZW1vdmVkTm9kZXNcbiAgICAgICAgICAgICAgICAgID8gJChtdXRhdGlvbi5yZW1vdmVkTm9kZXNbMF0pXG4gICAgICAgICAgICAgICAgICA6ICQoZmFsc2UpLFxuICAgICAgICAgICAgICAgICRjaGFuZ2VkTm9kZXMgID0gJGFkZGVkTm9kZS5hZGQoJHJlbW92ZWROb2RlKSxcbiAgICAgICAgICAgICAgICBpc1VzZXJBZGRpdGlvbiA9ICRjaGFuZ2VkTm9kZXMuaXMoc2VsZWN0b3IuYWRkaXRpb24pIHx8ICRjaGFuZ2VkTm9kZXMuY2xvc2VzdChzZWxlY3Rvci5hZGRpdGlvbikubGVuZ3RoID4gMCxcbiAgICAgICAgICAgICAgICBpc01lc3NhZ2UgICAgICA9ICRjaGFuZ2VkTm9kZXMuaXMoc2VsZWN0b3IubWVzc2FnZSkgIHx8ICRjaGFuZ2VkTm9kZXMuY2xvc2VzdChzZWxlY3Rvci5tZXNzYWdlKS5sZW5ndGggPiAwXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoaXNVc2VyQWRkaXRpb24gfHwgaXNNZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdVcGRhdGluZyBpdGVtIHNlbGVjdG9yIGNhY2hlJyk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnJlZnJlc2hJdGVtcygpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnTWVudSBtb2RpZmllZCwgdXBkYXRpbmcgc2VsZWN0b3IgY2FjaGUnKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUucmVmcmVzaCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbW91c2Vkb3duOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgaXRlbUFjdGl2YXRlZCA9IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbW91c2V1cDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGl0ZW1BY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGl0ZW06IHtcbiAgICAgICAgICAgIG1vdXNlZW50ZXI6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICR0YXJnZXQgICAgICAgID0gJChldmVudC50YXJnZXQpLFxuICAgICAgICAgICAgICAgICRpdGVtICAgICAgICAgID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAkc3ViTWVudSAgICAgICA9ICRpdGVtLmNoaWxkcmVuKHNlbGVjdG9yLm1lbnUpLFxuICAgICAgICAgICAgICAgICRvdGhlck1lbnVzICAgID0gJGl0ZW0uc2libGluZ3Moc2VsZWN0b3IuaXRlbSkuY2hpbGRyZW4oc2VsZWN0b3IubWVudSksXG4gICAgICAgICAgICAgICAgaGFzU3ViTWVudSAgICAgPSAoJHN1Yk1lbnUubGVuZ3RoID4gMCksXG4gICAgICAgICAgICAgICAgaXNCdWJibGVkRXZlbnQgPSAoJHN1Yk1lbnUuZmluZCgkdGFyZ2V0KS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCAhaXNCdWJibGVkRXZlbnQgJiYgaGFzU3ViTWVudSApIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLml0ZW1UaW1lcik7XG4gICAgICAgICAgICAgICAgbW9kdWxlLml0ZW1UaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2hvd2luZyBzdWItbWVudScsICRzdWJNZW51KTtcbiAgICAgICAgICAgICAgICAgICQuZWFjaCgkb3RoZXJNZW51cywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5hbmltYXRlLmhpZGUoZmFsc2UsICQodGhpcykpO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuYW5pbWF0ZS5zaG93KGZhbHNlLCAkc3ViTWVudSk7XG4gICAgICAgICAgICAgICAgfSwgc2V0dGluZ3MuZGVsYXkuc2hvdyk7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG1vdXNlbGVhdmU6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICRzdWJNZW51ID0gJCh0aGlzKS5jaGlsZHJlbihzZWxlY3Rvci5tZW51KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCRzdWJNZW51Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLml0ZW1UaW1lcik7XG4gICAgICAgICAgICAgICAgbW9kdWxlLml0ZW1UaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnSGlkaW5nIHN1Yi1tZW51JywgJHN1Yk1lbnUpO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmFuaW1hdGUuaGlkZShmYWxzZSwgJHN1Yk1lbnUpO1xuICAgICAgICAgICAgICAgIH0sIHNldHRpbmdzLmRlbGF5LmhpZGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uIChldmVudCwgc2tpcFJlZm9jdXMpIHtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgJGNob2ljZSAgICAgICAgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICR0YXJnZXQgICAgICAgID0gKGV2ZW50KVxuICAgICAgICAgICAgICAgICAgPyAkKGV2ZW50LnRhcmdldClcbiAgICAgICAgICAgICAgICAgIDogJCgnJyksXG4gICAgICAgICAgICAgICAgJHN1Yk1lbnUgICAgICAgPSAkY2hvaWNlLmZpbmQoc2VsZWN0b3IubWVudSksXG4gICAgICAgICAgICAgICAgdGV4dCAgICAgICAgICAgPSBtb2R1bGUuZ2V0LmNob2ljZVRleHQoJGNob2ljZSksXG4gICAgICAgICAgICAgICAgdmFsdWUgICAgICAgICAgPSBtb2R1bGUuZ2V0LmNob2ljZVZhbHVlKCRjaG9pY2UsIHRleHQpLFxuICAgICAgICAgICAgICAgIGhhc1N1Yk1lbnUgICAgID0gKCRzdWJNZW51Lmxlbmd0aCA+IDApLFxuICAgICAgICAgICAgICAgIGlzQnViYmxlZEV2ZW50ID0gKCRzdWJNZW51LmZpbmQoJHRhcmdldCkubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAvLyBwcmV2ZW50cyBJRTExIGJ1ZyB3aGVyZSBtZW51IHJlY2VpdmVzIGZvY3VzIGV2ZW4gdGhvdWdoIGB0YWJpbmRleD0tMWBcbiAgICAgICAgICAgICAgaWYobW9kdWxlLmhhcy5tZW51U2VhcmNoKCkpIHtcbiAgICAgICAgICAgICAgICAkKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLmJsdXIoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZighaXNCdWJibGVkRXZlbnQgJiYgKCFoYXNTdWJNZW51IHx8IHNldHRpbmdzLmFsbG93Q2F0ZWdvcnlTZWxlY3Rpb24pKSB7XG4gICAgICAgICAgICAgICAgaWYobW9kdWxlLmlzLnNlYXJjaFNlbGVjdGlvbigpKSB7XG4gICAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5hbGxvd0FkZGl0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnVzZXJBZGRpdGlvbigpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5zZWFyY2hUZXJtKCk7XG4gICAgICAgICAgICAgICAgICBpZighbW9kdWxlLmlzLmZvY3VzZWRPblNlYXJjaCgpICYmICEoc2tpcFJlZm9jdXMgPT0gdHJ1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLmZvY3VzU2VhcmNoKHRydWUpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZighc2V0dGluZ3MudXNlTGFiZWxzKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmZpbHRlcmVkSXRlbSgpO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zY3JvbGxQb3NpdGlvbigkY2hvaWNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRldGVybWluZS5zZWxlY3RBY3Rpb24uY2FsbCh0aGlzLCB0ZXh0LCB2YWx1ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgZG9jdW1lbnQ6IHtcbiAgICAgICAgICAgIC8vIGxhYmVsIHNlbGVjdGlvbiBzaG91bGQgb2NjdXIgZXZlbiB3aGVuIGVsZW1lbnQgaGFzIG5vIGZvY3VzXG4gICAgICAgICAgICBrZXlkb3duOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICBwcmVzc2VkS2V5ICAgID0gZXZlbnQud2hpY2gsXG4gICAgICAgICAgICAgICAgaXNTaG9ydGN1dEtleSA9IG1vZHVsZS5pcy5pbk9iamVjdChwcmVzc2VkS2V5LCBrZXlzKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKGlzU2hvcnRjdXRLZXkpIHtcbiAgICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAgICRsYWJlbCAgICAgICAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLmxhYmVsKSxcbiAgICAgICAgICAgICAgICAgICRhY3RpdmVMYWJlbCAgICAgID0gJGxhYmVsLmZpbHRlcignLicgKyBjbGFzc05hbWUuYWN0aXZlKSxcbiAgICAgICAgICAgICAgICAgIGFjdGl2ZVZhbHVlICAgICAgID0gJGFjdGl2ZUxhYmVsLmRhdGEobWV0YWRhdGEudmFsdWUpLFxuICAgICAgICAgICAgICAgICAgbGFiZWxJbmRleCAgICAgICAgPSAkbGFiZWwuaW5kZXgoJGFjdGl2ZUxhYmVsKSxcbiAgICAgICAgICAgICAgICAgIGxhYmVsQ291bnQgICAgICAgID0gJGxhYmVsLmxlbmd0aCxcbiAgICAgICAgICAgICAgICAgIGhhc0FjdGl2ZUxhYmVsICAgID0gKCRhY3RpdmVMYWJlbC5sZW5ndGggPiAwKSxcbiAgICAgICAgICAgICAgICAgIGhhc011bHRpcGxlQWN0aXZlID0gKCRhY3RpdmVMYWJlbC5sZW5ndGggPiAxKSxcbiAgICAgICAgICAgICAgICAgIGlzRmlyc3RMYWJlbCAgICAgID0gKGxhYmVsSW5kZXggPT09IDApLFxuICAgICAgICAgICAgICAgICAgaXNMYXN0TGFiZWwgICAgICAgPSAobGFiZWxJbmRleCArIDEgPT0gbGFiZWxDb3VudCksXG4gICAgICAgICAgICAgICAgICBpc1NlYXJjaCAgICAgICAgICA9IG1vZHVsZS5pcy5zZWFyY2hTZWxlY3Rpb24oKSxcbiAgICAgICAgICAgICAgICAgIGlzRm9jdXNlZE9uU2VhcmNoID0gbW9kdWxlLmlzLmZvY3VzZWRPblNlYXJjaCgpLFxuICAgICAgICAgICAgICAgICAgaXNGb2N1c2VkICAgICAgICAgPSBtb2R1bGUuaXMuZm9jdXNlZCgpLFxuICAgICAgICAgICAgICAgICAgY2FyZXRBdFN0YXJ0ICAgICAgPSAoaXNGb2N1c2VkT25TZWFyY2ggJiYgbW9kdWxlLmdldC5jYXJldFBvc2l0aW9uKCkgPT09IDApLFxuICAgICAgICAgICAgICAgICAgJG5leHRMYWJlbFxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICBpZihpc1NlYXJjaCAmJiAhaGFzQWN0aXZlTGFiZWwgJiYgIWlzRm9jdXNlZE9uU2VhcmNoKSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYocHJlc3NlZEtleSA9PSBrZXlzLmxlZnRBcnJvdykge1xuICAgICAgICAgICAgICAgICAgLy8gYWN0aXZhdGUgcHJldmlvdXMgbGFiZWxcbiAgICAgICAgICAgICAgICAgIGlmKChpc0ZvY3VzZWQgfHwgY2FyZXRBdFN0YXJ0KSAmJiAhaGFzQWN0aXZlTGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NlbGVjdGluZyBwcmV2aW91cyBsYWJlbCcpO1xuICAgICAgICAgICAgICAgICAgICAkbGFiZWwubGFzdCgpLmFkZENsYXNzKGNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSBpZihoYXNBY3RpdmVMYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBpZighZXZlbnQuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2VsZWN0aW5nIHByZXZpb3VzIGxhYmVsJyk7XG4gICAgICAgICAgICAgICAgICAgICAgJGxhYmVsLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBZGRpbmcgcHJldmlvdXMgbGFiZWwgdG8gc2VsZWN0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoaXNGaXJzdExhYmVsICYmICFoYXNNdWx0aXBsZUFjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICRhY3RpdmVMYWJlbC5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAkYWN0aXZlTGFiZWwucHJldihzZWxlY3Rvci5zaWJsaW5nTGFiZWwpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5lbmQoKVxuICAgICAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmKHByZXNzZWRLZXkgPT0ga2V5cy5yaWdodEFycm93KSB7XG4gICAgICAgICAgICAgICAgICAvLyBhY3RpdmF0ZSBmaXJzdCBsYWJlbFxuICAgICAgICAgICAgICAgICAgaWYoaXNGb2N1c2VkICYmICFoYXNBY3RpdmVMYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICAkbGFiZWwuZmlyc3QoKS5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIC8vIGFjdGl2YXRlIG5leHQgbGFiZWxcbiAgICAgICAgICAgICAgICAgIGlmKGhhc0FjdGl2ZUxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTZWxlY3RpbmcgbmV4dCBsYWJlbCcpO1xuICAgICAgICAgICAgICAgICAgICAgICRsYWJlbC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQWRkaW5nIG5leHQgbGFiZWwgdG8gc2VsZWN0aW9uJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoaXNMYXN0TGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZihpc1NlYXJjaCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIWlzRm9jdXNlZE9uU2VhcmNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS5mb2N1c1NlYXJjaCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICRsYWJlbC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZihoYXNNdWx0aXBsZUFjdGl2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJGFjdGl2ZUxhYmVsLm5leHQoc2VsZWN0b3Iuc2libGluZ0xhYmVsKS5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkYWN0aXZlTGFiZWwuYWRkQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICRhY3RpdmVMYWJlbC5uZXh0KHNlbGVjdG9yLnNpYmxpbmdMYWJlbCkuYWRkQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZihwcmVzc2VkS2V5ID09IGtleXMuZGVsZXRlS2V5IHx8IHByZXNzZWRLZXkgPT0ga2V5cy5iYWNrc3BhY2UpIHtcbiAgICAgICAgICAgICAgICAgIGlmKGhhc0FjdGl2ZUxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyBhY3RpdmUgbGFiZWxzJyk7XG4gICAgICAgICAgICAgICAgICAgIGlmKGlzTGFzdExhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYoaXNTZWFyY2ggJiYgIWlzRm9jdXNlZE9uU2VhcmNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUuZm9jdXNTZWFyY2goKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgJGFjdGl2ZUxhYmVsLmxhc3QoKS5uZXh0KHNlbGVjdG9yLnNpYmxpbmdMYWJlbCkuYWRkQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuYWN0aXZlTGFiZWxzKCRhY3RpdmVMYWJlbCk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBlbHNlIGlmKGNhcmV0QXRTdGFydCAmJiAhaGFzQWN0aXZlTGFiZWwgJiYgcHJlc3NlZEtleSA9PSBrZXlzLmJhY2tzcGFjZSkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3ZpbmcgbGFzdCBsYWJlbCBvbiBpbnB1dCBiYWNrc3BhY2UnKTtcbiAgICAgICAgICAgICAgICAgICAgJGFjdGl2ZUxhYmVsID0gJGxhYmVsLmxhc3QoKS5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5hY3RpdmVMYWJlbHMoJGFjdGl2ZUxhYmVsKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAkYWN0aXZlTGFiZWwucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGtleWRvd246IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgcHJlc3NlZEtleSAgICA9IGV2ZW50LndoaWNoLFxuICAgICAgICAgICAgICBpc1Nob3J0Y3V0S2V5ID0gbW9kdWxlLmlzLmluT2JqZWN0KHByZXNzZWRLZXksIGtleXMpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihpc1Nob3J0Y3V0S2V5KSB7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICRjdXJyZW50bHlTZWxlY3RlZCA9ICRpdGVtLm5vdChzZWxlY3Rvci51bnNlbGVjdGFibGUpLmZpbHRlcignLicgKyBjbGFzc05hbWUuc2VsZWN0ZWQpLmVxKDApLFxuICAgICAgICAgICAgICAgICRhY3RpdmVJdGVtICAgICAgICA9ICRtZW51LmNoaWxkcmVuKCcuJyArIGNsYXNzTmFtZS5hY3RpdmUpLmVxKDApLFxuICAgICAgICAgICAgICAgICRzZWxlY3RlZEl0ZW0gICAgICA9ICgkY3VycmVudGx5U2VsZWN0ZWQubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgICAgID8gJGN1cnJlbnRseVNlbGVjdGVkXG4gICAgICAgICAgICAgICAgICA6ICRhY3RpdmVJdGVtLFxuICAgICAgICAgICAgICAgICR2aXNpYmxlSXRlbXMgPSAoJHNlbGVjdGVkSXRlbS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICAgICAgPyAkc2VsZWN0ZWRJdGVtLnNpYmxpbmdzKCc6bm90KC4nICsgY2xhc3NOYW1lLmZpbHRlcmVkICsnKScpLmFkZEJhY2soKVxuICAgICAgICAgICAgICAgICAgOiAkbWVudS5jaGlsZHJlbignOm5vdCguJyArIGNsYXNzTmFtZS5maWx0ZXJlZCArJyknKSxcbiAgICAgICAgICAgICAgICAkc3ViTWVudSAgICAgICAgICAgICAgPSAkc2VsZWN0ZWRJdGVtLmNoaWxkcmVuKHNlbGVjdG9yLm1lbnUpLFxuICAgICAgICAgICAgICAgICRwYXJlbnRNZW51ICAgICAgICAgICA9ICRzZWxlY3RlZEl0ZW0uY2xvc2VzdChzZWxlY3Rvci5tZW51KSxcbiAgICAgICAgICAgICAgICBpblZpc2libGVNZW51ICAgICAgICAgPSAoJHBhcmVudE1lbnUuaGFzQ2xhc3MoY2xhc3NOYW1lLnZpc2libGUpIHx8ICRwYXJlbnRNZW51Lmhhc0NsYXNzKGNsYXNzTmFtZS5hbmltYXRpbmcpIHx8ICRwYXJlbnRNZW51LnBhcmVudChzZWxlY3Rvci5tZW51KS5sZW5ndGggPiAwKSxcbiAgICAgICAgICAgICAgICBoYXNTdWJNZW51ICAgICAgICAgICAgPSAoJHN1Yk1lbnUubGVuZ3RoPiAwKSxcbiAgICAgICAgICAgICAgICBoYXNTZWxlY3RlZEl0ZW0gICAgICAgPSAoJHNlbGVjdGVkSXRlbS5sZW5ndGggPiAwKSxcbiAgICAgICAgICAgICAgICBzZWxlY3RlZElzU2VsZWN0YWJsZSAgPSAoJHNlbGVjdGVkSXRlbS5ub3Qoc2VsZWN0b3IudW5zZWxlY3RhYmxlKS5sZW5ndGggPiAwKSxcbiAgICAgICAgICAgICAgICBkZWxpbWl0ZXJQcmVzc2VkICAgICAgPSAocHJlc3NlZEtleSA9PSBrZXlzLmRlbGltaXRlciAmJiBzZXR0aW5ncy5hbGxvd0FkZGl0aW9ucyAmJiBtb2R1bGUuaXMubXVsdGlwbGUoKSksXG4gICAgICAgICAgICAgICAgaXNBZGRpdGlvbldpdGhvdXRNZW51ID0gKHNldHRpbmdzLmFsbG93QWRkaXRpb25zICYmIHNldHRpbmdzLmhpZGVBZGRpdGlvbnMgJiYgKHByZXNzZWRLZXkgPT0ga2V5cy5lbnRlciB8fCBkZWxpbWl0ZXJQcmVzc2VkKSAmJiBzZWxlY3RlZElzU2VsZWN0YWJsZSksXG4gICAgICAgICAgICAgICAgJG5leHRJdGVtLFxuICAgICAgICAgICAgICAgIGlzU3ViTWVudUl0ZW0sXG4gICAgICAgICAgICAgICAgbmV3SW5kZXhcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAvLyBhbGxvdyBzZWxlY3Rpb24gd2l0aCBtZW51IGNsb3NlZFxuICAgICAgICAgICAgICBpZihpc0FkZGl0aW9uV2l0aG91dE1lbnUpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2VsZWN0aW5nIGl0ZW0gZnJvbSBrZXlib2FyZCBzaG9ydGN1dCcsICRzZWxlY3RlZEl0ZW0pO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5ldmVudC5pdGVtLmNsaWNrLmNhbGwoJHNlbGVjdGVkSXRlbSwgZXZlbnQpO1xuICAgICAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5zZWFyY2hTZWxlY3Rpb24oKSkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5zZWFyY2hUZXJtKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgLy8gdmlzaWJsZSBtZW51IGtleWJvYXJkIHNob3J0Y3V0c1xuICAgICAgICAgICAgICBpZiggbW9kdWxlLmlzLnZpc2libGUoKSApIHtcblxuICAgICAgICAgICAgICAgIC8vIGVudGVyIChzZWxlY3Qgb3Igb3BlbiBzdWItbWVudSlcbiAgICAgICAgICAgICAgICBpZihwcmVzc2VkS2V5ID09IGtleXMuZW50ZXIgfHwgZGVsaW1pdGVyUHJlc3NlZCkge1xuICAgICAgICAgICAgICAgICAgaWYocHJlc3NlZEtleSA9PSBrZXlzLmVudGVyICYmIGhhc1NlbGVjdGVkSXRlbSAmJiBoYXNTdWJNZW51ICYmICFzZXR0aW5ncy5hbGxvd0NhdGVnb3J5U2VsZWN0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdQcmVzc2VkIGVudGVyIG9uIHVuc2VsZWN0YWJsZSBjYXRlZ29yeSwgb3BlbmluZyBzdWIgbWVudScpO1xuICAgICAgICAgICAgICAgICAgICBwcmVzc2VkS2V5ID0ga2V5cy5yaWdodEFycm93O1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSBpZihzZWxlY3RlZElzU2VsZWN0YWJsZSkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2VsZWN0aW5nIGl0ZW0gZnJvbSBrZXlib2FyZCBzaG9ydGN1dCcsICRzZWxlY3RlZEl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuZXZlbnQuaXRlbS5jbGljay5jYWxsKCRzZWxlY3RlZEl0ZW0sIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgaWYobW9kdWxlLmlzLnNlYXJjaFNlbGVjdGlvbigpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5zZWFyY2hUZXJtKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gc3ViLW1lbnUgYWN0aW9uc1xuICAgICAgICAgICAgICAgIGlmKGhhc1NlbGVjdGVkSXRlbSkge1xuXG4gICAgICAgICAgICAgICAgICBpZihwcmVzc2VkS2V5ID09IGtleXMubGVmdEFycm93KSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaXNTdWJNZW51SXRlbSA9ICgkcGFyZW50TWVudVswXSAhPT0gJG1lbnVbMF0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmKGlzU3ViTWVudUl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTGVmdCBrZXkgcHJlc3NlZCwgY2xvc2luZyBzdWItbWVudScpO1xuICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS5hbmltYXRlLmhpZGUoZmFsc2UsICRwYXJlbnRNZW51KTtcbiAgICAgICAgICAgICAgICAgICAgICAkc2VsZWN0ZWRJdGVtXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKVxuICAgICAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAgICAgICAkcGFyZW50TWVudVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNsb3Nlc3Qoc2VsZWN0b3IuaXRlbSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5zZWxlY3RlZClcbiAgICAgICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAvLyByaWdodCBhcnJvdyAoc2hvdyBzdWItbWVudSlcbiAgICAgICAgICAgICAgICAgIGlmKHByZXNzZWRLZXkgPT0ga2V5cy5yaWdodEFycm93KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGhhc1N1Yk1lbnUpIHtcbiAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmlnaHQga2V5IHByZXNzZWQsIG9wZW5pbmcgc3ViLW1lbnUnKTtcbiAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUuYW5pbWF0ZS5zaG93KGZhbHNlLCAkc3ViTWVudSk7XG4gICAgICAgICAgICAgICAgICAgICAgJHNlbGVjdGVkSXRlbVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5zZWxlY3RlZClcbiAgICAgICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgICAgICAgJHN1Yk1lbnVcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKHNlbGVjdG9yLml0ZW0pLmVxKDApXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpXG4gICAgICAgICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyB1cCBhcnJvdyAodHJhdmVyc2UgbWVudSB1cClcbiAgICAgICAgICAgICAgICBpZihwcmVzc2VkS2V5ID09IGtleXMudXBBcnJvdykge1xuICAgICAgICAgICAgICAgICAgJG5leHRJdGVtID0gKGhhc1NlbGVjdGVkSXRlbSAmJiBpblZpc2libGVNZW51KVxuICAgICAgICAgICAgICAgICAgICA/ICRzZWxlY3RlZEl0ZW0ucHJldkFsbChzZWxlY3Rvci5pdGVtICsgJzpub3QoJyArIHNlbGVjdG9yLnVuc2VsZWN0YWJsZSArICcpJykuZXEoMClcbiAgICAgICAgICAgICAgICAgICAgOiAkaXRlbS5lcSgwKVxuICAgICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgICAgaWYoJHZpc2libGVJdGVtcy5pbmRleCggJG5leHRJdGVtICkgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdVcCBrZXkgcHJlc3NlZCBidXQgcmVhY2hlZCB0b3Agb2YgY3VycmVudCBtZW51Jyk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnVXAga2V5IHByZXNzZWQsIGNoYW5naW5nIGFjdGl2ZSBpdGVtJyk7XG4gICAgICAgICAgICAgICAgICAgICRzZWxlY3RlZEl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKVxuICAgICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgICAgICRuZXh0SXRlbVxuICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpXG4gICAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zY3JvbGxQb3NpdGlvbigkbmV4dEl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5zZWxlY3RPbktleWRvd24gJiYgbW9kdWxlLmlzLnNpbmdsZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zZWxlY3RlZEl0ZW0oJG5leHRJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBkb3duIGFycm93ICh0cmF2ZXJzZSBtZW51IGRvd24pXG4gICAgICAgICAgICAgICAgaWYocHJlc3NlZEtleSA9PSBrZXlzLmRvd25BcnJvdykge1xuICAgICAgICAgICAgICAgICAgJG5leHRJdGVtID0gKGhhc1NlbGVjdGVkSXRlbSAmJiBpblZpc2libGVNZW51KVxuICAgICAgICAgICAgICAgICAgICA/ICRuZXh0SXRlbSA9ICRzZWxlY3RlZEl0ZW0ubmV4dEFsbChzZWxlY3Rvci5pdGVtICsgJzpub3QoJyArIHNlbGVjdG9yLnVuc2VsZWN0YWJsZSArICcpJykuZXEoMClcbiAgICAgICAgICAgICAgICAgICAgOiAkaXRlbS5lcSgwKVxuICAgICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgICAgaWYoJG5leHRJdGVtLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRG93biBrZXkgcHJlc3NlZCBidXQgcmVhY2hlZCBib3R0b20gb2YgY3VycmVudCBtZW51Jyk7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRG93biBrZXkgcHJlc3NlZCwgY2hhbmdpbmcgYWN0aXZlIGl0ZW0nKTtcbiAgICAgICAgICAgICAgICAgICAgJGl0ZW1cbiAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKVxuICAgICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgICAgICRuZXh0SXRlbVxuICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpXG4gICAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zY3JvbGxQb3NpdGlvbigkbmV4dEl0ZW0pO1xuICAgICAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5zZWxlY3RPbktleWRvd24gJiYgbW9kdWxlLmlzLnNpbmdsZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zZWxlY3RlZEl0ZW0oJG5leHRJdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBwYWdlIGRvd24gKHNob3cgbmV4dCBwYWdlKVxuICAgICAgICAgICAgICAgIGlmKHByZXNzZWRLZXkgPT0ga2V5cy5wYWdlVXApIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5zY3JvbGxQYWdlKCd1cCcpO1xuICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYocHJlc3NlZEtleSA9PSBrZXlzLnBhZ2VEb3duKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuc2Nyb2xsUGFnZSgnZG93bicpO1xuICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBlc2NhcGUgKGNsb3NlIG1lbnUpXG4gICAgICAgICAgICAgICAgaWYocHJlc3NlZEtleSA9PSBrZXlzLmVzY2FwZSkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0VzY2FwZSBrZXkgcHJlc3NlZCwgY2xvc2luZyBkcm9wZG93bicpO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBkZWxpbWl0ZXIga2V5XG4gICAgICAgICAgICAgICAgaWYoZGVsaW1pdGVyUHJlc3NlZCkge1xuICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gZG93biBhcnJvdyAob3BlbiBtZW51KVxuICAgICAgICAgICAgICAgIGlmKHByZXNzZWRLZXkgPT0ga2V5cy5kb3duQXJyb3cgJiYgIW1vZHVsZS5pcy52aXNpYmxlKCkpIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEb3duIGtleSBwcmVzc2VkLCBzaG93aW5nIGRyb3Bkb3duJyk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBpZiggIW1vZHVsZS5oYXMuc2VhcmNoKCkgKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zZWxlY3RlZExldHRlciggU3RyaW5nLmZyb21DaGFyQ29kZShwcmVzc2VkS2V5KSApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHRyaWdnZXI6IHtcbiAgICAgICAgICBjaGFuZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGV2ZW50cyAgICAgICA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCdIVE1MRXZlbnRzJyksXG4gICAgICAgICAgICAgIGlucHV0RWxlbWVudCA9ICRpbnB1dFswXVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoaW5wdXRFbGVtZW50KSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdUcmlnZ2VyaW5nIG5hdGl2ZSBjaGFuZ2UgZXZlbnQnKTtcbiAgICAgICAgICAgICAgZXZlbnRzLmluaXRFdmVudCgnY2hhbmdlJywgdHJ1ZSwgZmFsc2UpO1xuICAgICAgICAgICAgICBpbnB1dEVsZW1lbnQuZGlzcGF0Y2hFdmVudChldmVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXRlcm1pbmU6IHtcbiAgICAgICAgICBzZWxlY3RBY3Rpb246IGZ1bmN0aW9uKHRleHQsIHZhbHVlKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRGV0ZXJtaW5pbmcgYWN0aW9uJywgc2V0dGluZ3MuYWN0aW9uKTtcbiAgICAgICAgICAgIGlmKCAkLmlzRnVuY3Rpb24oIG1vZHVsZS5hY3Rpb25bc2V0dGluZ3MuYWN0aW9uXSApICkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnVHJpZ2dlcmluZyBwcmVzZXQgYWN0aW9uJywgc2V0dGluZ3MuYWN0aW9uLCB0ZXh0LCB2YWx1ZSk7XG4gICAgICAgICAgICAgIG1vZHVsZS5hY3Rpb25bIHNldHRpbmdzLmFjdGlvbiBdLmNhbGwoZWxlbWVudCwgdGV4dCwgdmFsdWUsIHRoaXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiggJC5pc0Z1bmN0aW9uKHNldHRpbmdzLmFjdGlvbikgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdUcmlnZ2VyaW5nIHVzZXIgYWN0aW9uJywgc2V0dGluZ3MuYWN0aW9uLCB0ZXh0LCB2YWx1ZSk7XG4gICAgICAgICAgICAgIHNldHRpbmdzLmFjdGlvbi5jYWxsKGVsZW1lbnQsIHRleHQsIHZhbHVlLCB0aGlzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IuYWN0aW9uLCBzZXR0aW5ncy5hY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXZlbnRJbk1vZHVsZTogZnVuY3Rpb24oZXZlbnQsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJHRhcmdldCAgICA9ICQoZXZlbnQudGFyZ2V0KSxcbiAgICAgICAgICAgICAgaW5Eb2N1bWVudCA9ICgkdGFyZ2V0LmNsb3Nlc3QoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5sZW5ndGggPiAwKSxcbiAgICAgICAgICAgICAgaW5Nb2R1bGUgICA9ICgkdGFyZ2V0LmNsb3Nlc3QoJG1vZHVsZSkubGVuZ3RoID4gMClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGNhbGxiYWNrID0gJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKVxuICAgICAgICAgICAgICA/IGNhbGxiYWNrXG4gICAgICAgICAgICAgIDogZnVuY3Rpb24oKXt9XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihpbkRvY3VtZW50ICYmICFpbk1vZHVsZSkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnVHJpZ2dlcmluZyBldmVudCcsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0V2ZW50IG9jY3VycmVkIGluIGRyb3Bkb3duLCBjYW5jZWxpbmcgY2FsbGJhY2snKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZXZlbnRPbkVsZW1lbnQ6IGZ1bmN0aW9uKGV2ZW50LCBjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICR0YXJnZXQgICAgICA9ICQoZXZlbnQudGFyZ2V0KSxcbiAgICAgICAgICAgICAgJGxhYmVsICAgICAgID0gJHRhcmdldC5jbG9zZXN0KHNlbGVjdG9yLnNpYmxpbmdMYWJlbCksXG4gICAgICAgICAgICAgIGluVmlzaWJsZURPTSA9IGRvY3VtZW50LmJvZHkuY29udGFpbnMoZXZlbnQudGFyZ2V0KSxcbiAgICAgICAgICAgICAgbm90T25MYWJlbCAgID0gKCRtb2R1bGUuZmluZCgkbGFiZWwpLmxlbmd0aCA9PT0gMCksXG4gICAgICAgICAgICAgIG5vdEluTWVudSAgICA9ICgkdGFyZ2V0LmNsb3Nlc3QoJG1lbnUpLmxlbmd0aCA9PT0gMClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGNhbGxiYWNrID0gJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKVxuICAgICAgICAgICAgICA/IGNhbGxiYWNrXG4gICAgICAgICAgICAgIDogZnVuY3Rpb24oKXt9XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihpblZpc2libGVET00gJiYgbm90T25MYWJlbCAmJiBub3RJbk1lbnUpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1RyaWdnZXJpbmcgZXZlbnQnLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdFdmVudCBvY2N1cnJlZCBpbiBkcm9wZG93biBtZW51LCBjYW5jZWxpbmcgY2FsbGJhY2snKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBhY3Rpb246IHtcblxuICAgICAgICAgIG5vdGhpbmc6IGZ1bmN0aW9uKCkge30sXG5cbiAgICAgICAgICBhY3RpdmF0ZTogZnVuY3Rpb24odGV4dCwgdmFsdWUsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhbHVlID0gKHZhbHVlICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gdmFsdWVcbiAgICAgICAgICAgICAgOiB0ZXh0XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZiggbW9kdWxlLmNhbi5hY3RpdmF0ZSggJChlbGVtZW50KSApICkge1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnNlbGVjdGVkKHZhbHVlLCAkKGVsZW1lbnQpKTtcbiAgICAgICAgICAgICAgaWYobW9kdWxlLmlzLm11bHRpcGxlKCkgJiYgIW1vZHVsZS5pcy5hbGxGaWx0ZXJlZCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5oaWRlQW5kQ2xlYXIoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBzZWxlY3Q6IGZ1bmN0aW9uKHRleHQsIHZhbHVlLCBlbGVtZW50KSB7XG4gICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICA/IHZhbHVlXG4gICAgICAgICAgICAgIDogdGV4dFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5jYW4uYWN0aXZhdGUoICQoZWxlbWVudCkgKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC52YWx1ZSh2YWx1ZSwgdGV4dCwgJChlbGVtZW50KSk7XG4gICAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5tdWx0aXBsZSgpICYmICFtb2R1bGUuaXMuYWxsRmlsdGVyZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuaGlkZUFuZENsZWFyKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgY29tYm86IGZ1bmN0aW9uKHRleHQsIHZhbHVlLCBlbGVtZW50KSB7XG4gICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICA/IHZhbHVlXG4gICAgICAgICAgICAgIDogdGV4dFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnNldC5zZWxlY3RlZCh2YWx1ZSwgJChlbGVtZW50KSk7XG4gICAgICAgICAgICBtb2R1bGUuaGlkZUFuZENsZWFyKCk7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGhpZGU6IGZ1bmN0aW9uKHRleHQsIHZhbHVlLCBlbGVtZW50KSB7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LnZhbHVlKHZhbHVlLCB0ZXh0LCAkKGVsZW1lbnQpKTtcbiAgICAgICAgICAgIG1vZHVsZS5oaWRlQW5kQ2xlYXIoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBnZXQ6IHtcbiAgICAgICAgICBpZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gaWQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkZWZhdWx0VGV4dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5kYXRhKG1ldGFkYXRhLmRlZmF1bHRUZXh0KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRlZmF1bHRWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5kYXRhKG1ldGFkYXRhLmRlZmF1bHRWYWx1ZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwbGFjZWhvbGRlclRleHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGxhY2Vob2xkZXIgIT0gJ2F1dG8nICYmIHR5cGVvZiBzZXR0aW5ncy5wbGFjZWhvbGRlciA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MucGxhY2Vob2xkZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5kYXRhKG1ldGFkYXRhLnBsYWNlaG9sZGVyVGV4dCkgfHwgJyc7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0ZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkdGV4dC50ZXh0KCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBxdWVyeTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJC50cmltKCRzZWFyY2gudmFsKCkpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VhcmNoV2lkdGg6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICA/IHZhbHVlXG4gICAgICAgICAgICAgIDogJHNlYXJjaC52YWwoKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJHNpemVyLnRleHQodmFsdWUpO1xuICAgICAgICAgICAgLy8gcHJldmVudCByb3VuZGluZyBpc3N1ZXNcbiAgICAgICAgICAgIHJldHVybiBNYXRoLmNlaWwoICRzaXplci53aWR0aCgpICsgMSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWxlY3Rpb25Db3VudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdmFsdWVzID0gbW9kdWxlLmdldC52YWx1ZXMoKSxcbiAgICAgICAgICAgICAgY291bnRcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGNvdW50ID0gKCBtb2R1bGUuaXMubXVsdGlwbGUoKSApXG4gICAgICAgICAgICAgID8gJC5pc0FycmF5KHZhbHVlcylcbiAgICAgICAgICAgICAgICA/IHZhbHVlcy5sZW5ndGhcbiAgICAgICAgICAgICAgICA6IDBcbiAgICAgICAgICAgICAgOiAobW9kdWxlLmdldC52YWx1ZSgpICE9PSAnJylcbiAgICAgICAgICAgICAgICA/IDFcbiAgICAgICAgICAgICAgICA6IDBcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiBjb3VudDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRyYW5zaXRpb246IGZ1bmN0aW9uKCRzdWJNZW51KSB7XG4gICAgICAgICAgICByZXR1cm4gKHNldHRpbmdzLnRyYW5zaXRpb24gPT0gJ2F1dG8nKVxuICAgICAgICAgICAgICA/IG1vZHVsZS5pcy51cHdhcmQoJHN1Yk1lbnUpXG4gICAgICAgICAgICAgICAgPyAnc2xpZGUgdXAnXG4gICAgICAgICAgICAgICAgOiAnc2xpZGUgZG93bidcbiAgICAgICAgICAgICAgOiBzZXR0aW5ncy50cmFuc2l0aW9uXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB1c2VyVmFsdWVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB2YWx1ZXMgPSBtb2R1bGUuZ2V0LnZhbHVlcygpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZighdmFsdWVzKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhbHVlcyA9ICQuaXNBcnJheSh2YWx1ZXMpXG4gICAgICAgICAgICAgID8gdmFsdWVzXG4gICAgICAgICAgICAgIDogW3ZhbHVlc11cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiAkLmdyZXAodmFsdWVzLCBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgICByZXR1cm4gKG1vZHVsZS5nZXQuaXRlbSh2YWx1ZSkgPT09IGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdW5pcXVlQXJyYXk6IGZ1bmN0aW9uKGFycmF5KSB7XG4gICAgICAgICAgICByZXR1cm4gJC5ncmVwKGFycmF5LCBmdW5jdGlvbiAodmFsdWUsIGluZGV4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQuaW5BcnJheSh2YWx1ZSwgYXJyYXkpID09PSBpbmRleDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2FyZXRQb3NpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgaW5wdXQgPSAkc2VhcmNoLmdldCgwKSxcbiAgICAgICAgICAgICAgcmFuZ2UsXG4gICAgICAgICAgICAgIHJhbmdlTGVuZ3RoXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZignc2VsZWN0aW9uU3RhcnQnIGluIGlucHV0KSB7XG4gICAgICAgICAgICAgIHJldHVybiBpbnB1dC5zZWxlY3Rpb25TdGFydDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikge1xuICAgICAgICAgICAgICBpbnB1dC5mb2N1cygpO1xuICAgICAgICAgICAgICByYW5nZSAgICAgICA9IGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpO1xuICAgICAgICAgICAgICByYW5nZUxlbmd0aCA9IHJhbmdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgICByYW5nZS5tb3ZlU3RhcnQoJ2NoYXJhY3RlcicsIC1pbnB1dC52YWx1ZS5sZW5ndGgpO1xuICAgICAgICAgICAgICByZXR1cm4gcmFuZ2UudGV4dC5sZW5ndGggLSByYW5nZUxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB2YWx1ZSA9ICgkaW5wdXQubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgICA/ICRpbnB1dC52YWwoKVxuICAgICAgICAgICAgICAgIDogJG1vZHVsZS5kYXRhKG1ldGFkYXRhLnZhbHVlKSxcbiAgICAgICAgICAgICAgaXNFbXB0eU11bHRpc2VsZWN0ID0gKCQuaXNBcnJheSh2YWx1ZSkgJiYgdmFsdWUubGVuZ3RoID09PSAxICYmIHZhbHVlWzBdID09PSAnJylcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIC8vIHByZXZlbnRzIHBsYWNlaG9sZGVyIGVsZW1lbnQgZnJvbSBiZWluZyBzZWxlY3RlZCB3aGVuIG11bHRpcGxlXG4gICAgICAgICAgICByZXR1cm4gKHZhbHVlID09PSB1bmRlZmluZWQgfHwgaXNFbXB0eU11bHRpc2VsZWN0KVxuICAgICAgICAgICAgICA/ICcnXG4gICAgICAgICAgICAgIDogdmFsdWVcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdmFsdWUgPSBtb2R1bGUuZ2V0LnZhbHVlKClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHZhbHVlID09PSAnJykge1xuICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKCAhbW9kdWxlLmhhcy5zZWxlY3RJbnB1dCgpICYmIG1vZHVsZS5pcy5tdWx0aXBsZSgpIClcbiAgICAgICAgICAgICAgPyAodHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSAvLyBkZWxpbWl0ZWQgc3RyaW5nXG4gICAgICAgICAgICAgICAgPyB2YWx1ZS5zcGxpdChzZXR0aW5ncy5kZWxpbWl0ZXIpXG4gICAgICAgICAgICAgICAgOiAnJ1xuICAgICAgICAgICAgICA6IHZhbHVlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZW1vdGVWYWx1ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHZhbHVlcyA9IG1vZHVsZS5nZXQudmFsdWVzKCksXG4gICAgICAgICAgICAgIHJlbW90ZVZhbHVlcyA9IGZhbHNlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZih2YWx1ZXMpIHtcbiAgICAgICAgICAgICAgaWYodHlwZW9mIHZhbHVlcyA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgIHZhbHVlcyA9IFt2YWx1ZXNdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICQuZWFjaCh2YWx1ZXMsIGZ1bmN0aW9uKGluZGV4LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICAgbmFtZSA9IG1vZHVsZS5yZWFkLnJlbW90ZURhdGEodmFsdWUpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZXN0b3JpbmcgdmFsdWUgZnJvbSBzZXNzaW9uIGRhdGEnLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYobmFtZSkge1xuICAgICAgICAgICAgICAgICAgaWYoIXJlbW90ZVZhbHVlcykge1xuICAgICAgICAgICAgICAgICAgICByZW1vdGVWYWx1ZXMgPSB7fTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHJlbW90ZVZhbHVlc1t2YWx1ZV0gPSBuYW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVtb3RlVmFsdWVzO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2hvaWNlVGV4dDogZnVuY3Rpb24oJGNob2ljZSwgcHJlc2VydmVIVE1MKSB7XG4gICAgICAgICAgICBwcmVzZXJ2ZUhUTUwgPSAocHJlc2VydmVIVE1MICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gcHJlc2VydmVIVE1MXG4gICAgICAgICAgICAgIDogc2V0dGluZ3MucHJlc2VydmVIVE1MXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZigkY2hvaWNlKSB7XG4gICAgICAgICAgICAgIGlmKCRjaG9pY2UuZmluZChzZWxlY3Rvci5tZW51KS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JldHJpZXZpbmcgdGV4dCBvZiBlbGVtZW50IHdpdGggc3ViLW1lbnUnKTtcbiAgICAgICAgICAgICAgICAkY2hvaWNlID0gJGNob2ljZS5jbG9uZSgpO1xuICAgICAgICAgICAgICAgICRjaG9pY2UuZmluZChzZWxlY3Rvci5tZW51KS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAkY2hvaWNlLmZpbmQoc2VsZWN0b3IubWVudUljb24pLnJlbW92ZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiAoJGNob2ljZS5kYXRhKG1ldGFkYXRhLnRleHQpICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgPyAkY2hvaWNlLmRhdGEobWV0YWRhdGEudGV4dClcbiAgICAgICAgICAgICAgICA6IChwcmVzZXJ2ZUhUTUwpXG4gICAgICAgICAgICAgICAgICA/ICQudHJpbSgkY2hvaWNlLmh0bWwoKSlcbiAgICAgICAgICAgICAgICAgIDogJC50cmltKCRjaG9pY2UudGV4dCgpKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjaG9pY2VWYWx1ZTogZnVuY3Rpb24oJGNob2ljZSwgY2hvaWNlVGV4dCkge1xuICAgICAgICAgICAgY2hvaWNlVGV4dCA9IGNob2ljZVRleHQgfHwgbW9kdWxlLmdldC5jaG9pY2VUZXh0KCRjaG9pY2UpO1xuICAgICAgICAgICAgaWYoISRjaG9pY2UpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICgkY2hvaWNlLmRhdGEobWV0YWRhdGEudmFsdWUpICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gU3RyaW5nKCAkY2hvaWNlLmRhdGEobWV0YWRhdGEudmFsdWUpIClcbiAgICAgICAgICAgICAgOiAodHlwZW9mIGNob2ljZVRleHQgPT09ICdzdHJpbmcnKVxuICAgICAgICAgICAgICAgID8gJC50cmltKGNob2ljZVRleHQudG9Mb3dlckNhc2UoKSlcbiAgICAgICAgICAgICAgICA6IFN0cmluZyhjaG9pY2VUZXh0KVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5wdXRFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgaW5wdXQgPSAkc2VhcmNoWzBdXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihpbnB1dCkge1xuICAgICAgICAgICAgICByZXR1cm4gKGlucHV0Lm9uaW5wdXQgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICA/ICdpbnB1dCdcbiAgICAgICAgICAgICAgICA6IChpbnB1dC5vbnByb3BlcnR5Y2hhbmdlICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICA/ICdwcm9wZXJ0eWNoYW5nZSdcbiAgICAgICAgICAgICAgICAgIDogJ2tleXVwJ1xuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWxlY3RWYWx1ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHNlbGVjdCA9IHt9XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBzZWxlY3QudmFsdWVzID0gW107XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5maW5kKCdvcHRpb24nKVxuICAgICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgICAgICRvcHRpb24gID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgbmFtZSAgICAgPSAkb3B0aW9uLmh0bWwoKSxcbiAgICAgICAgICAgICAgICAgICAgZGlzYWJsZWQgPSAkb3B0aW9uLmF0dHIoJ2Rpc2FibGVkJyksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlICAgID0gKCAkb3B0aW9uLmF0dHIoJ3ZhbHVlJykgIT09IHVuZGVmaW5lZCApXG4gICAgICAgICAgICAgICAgICAgICAgPyAkb3B0aW9uLmF0dHIoJ3ZhbHVlJylcbiAgICAgICAgICAgICAgICAgICAgICA6IG5hbWVcbiAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLnBsYWNlaG9sZGVyID09PSAnYXV0bycgJiYgdmFsdWUgPT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdC5wbGFjZWhvbGRlciA9IG5hbWU7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0LnZhbHVlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICBuYW1lICAgICA6IG5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgdmFsdWUgICAgOiB2YWx1ZSxcbiAgICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZCA6IGRpc2FibGVkXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wbGFjZWhvbGRlciAmJiBzZXR0aW5ncy5wbGFjZWhvbGRlciAhPT0gJ2F1dG8nKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2V0dGluZyBwbGFjZWhvbGRlciB2YWx1ZSB0bycsIHNldHRpbmdzLnBsYWNlaG9sZGVyKTtcbiAgICAgICAgICAgICAgc2VsZWN0LnBsYWNlaG9sZGVyID0gc2V0dGluZ3MucGxhY2Vob2xkZXI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5zb3J0U2VsZWN0KSB7XG4gICAgICAgICAgICAgIHNlbGVjdC52YWx1ZXMuc29ydChmdW5jdGlvbihhLCBiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChhLm5hbWUgPiBiLm5hbWUpXG4gICAgICAgICAgICAgICAgICA/IDFcbiAgICAgICAgICAgICAgICAgIDogLTFcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JldHJpZXZlZCBhbmQgc29ydGVkIHZhbHVlcyBmcm9tIHNlbGVjdCcsIHNlbGVjdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZXRyaWV2ZWQgdmFsdWVzIGZyb20gc2VsZWN0Jywgc2VsZWN0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzZWxlY3Q7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhY3RpdmVJdGVtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkaXRlbS5maWx0ZXIoJy4nICArIGNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VsZWN0ZWRJdGVtOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkc2VsZWN0ZWRJdGVtID0gJGl0ZW0ubm90KHNlbGVjdG9yLnVuc2VsZWN0YWJsZSkuZmlsdGVyKCcuJyAgKyBjbGFzc05hbWUuc2VsZWN0ZWQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICByZXR1cm4gKCRzZWxlY3RlZEl0ZW0ubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgPyAkc2VsZWN0ZWRJdGVtXG4gICAgICAgICAgICAgIDogJGl0ZW0uZXEoMClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGl0ZW1XaXRoQWRkaXRpb25zOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICRpdGVtcyAgICAgICA9IG1vZHVsZS5nZXQuaXRlbSh2YWx1ZSksXG4gICAgICAgICAgICAgICR1c2VySXRlbXMgICA9IG1vZHVsZS5jcmVhdGUudXNlckNob2ljZSh2YWx1ZSksXG4gICAgICAgICAgICAgIGhhc1VzZXJJdGVtcyA9ICgkdXNlckl0ZW1zICYmICR1c2VySXRlbXMubGVuZ3RoID4gMClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKGhhc1VzZXJJdGVtcykge1xuICAgICAgICAgICAgICAkaXRlbXMgPSAoJGl0ZW1zLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAgICAgPyAkaXRlbXMuYWRkKCR1c2VySXRlbXMpXG4gICAgICAgICAgICAgICAgOiAkdXNlckl0ZW1zXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkaXRlbXM7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpdGVtOiBmdW5jdGlvbih2YWx1ZSwgc3RyaWN0KSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJHNlbGVjdGVkSXRlbSA9IGZhbHNlLFxuICAgICAgICAgICAgICBzaG91bGRTZWFyY2gsXG4gICAgICAgICAgICAgIGlzTXVsdGlwbGVcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHZhbHVlID0gKHZhbHVlICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gdmFsdWVcbiAgICAgICAgICAgICAgOiAoIG1vZHVsZS5nZXQudmFsdWVzKCkgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICA/IG1vZHVsZS5nZXQudmFsdWVzKClcbiAgICAgICAgICAgICAgICA6IG1vZHVsZS5nZXQudGV4dCgpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBzaG91bGRTZWFyY2ggPSAoaXNNdWx0aXBsZSlcbiAgICAgICAgICAgICAgPyAodmFsdWUubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgOiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSAhPT0gbnVsbClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlzTXVsdGlwbGUgPSAobW9kdWxlLmlzLm11bHRpcGxlKCkgJiYgJC5pc0FycmF5KHZhbHVlKSk7XG4gICAgICAgICAgICBzdHJpY3QgICAgID0gKHZhbHVlID09PSAnJyB8fCB2YWx1ZSA9PT0gMClcbiAgICAgICAgICAgICAgPyB0cnVlXG4gICAgICAgICAgICAgIDogc3RyaWN0IHx8IGZhbHNlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzaG91bGRTZWFyY2gpIHtcbiAgICAgICAgICAgICAgJGl0ZW1cbiAgICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICAgICAkY2hvaWNlICAgICAgID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uVGV4dCAgICA9IG1vZHVsZS5nZXQuY2hvaWNlVGV4dCgkY2hvaWNlKSxcbiAgICAgICAgICAgICAgICAgICAgb3B0aW9uVmFsdWUgICA9IG1vZHVsZS5nZXQuY2hvaWNlVmFsdWUoJGNob2ljZSwgb3B0aW9uVGV4dClcbiAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAgIC8vIHNhZmUgZWFybHkgZXhpdFxuICAgICAgICAgICAgICAgICAgaWYob3B0aW9uVmFsdWUgPT09IG51bGwgfHwgb3B0aW9uVmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZihpc011bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCQuaW5BcnJheSggU3RyaW5nKG9wdGlvblZhbHVlKSwgdmFsdWUpICE9PSAtMSB8fCAkLmluQXJyYXkob3B0aW9uVGV4dCwgdmFsdWUpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICRzZWxlY3RlZEl0ZW0gPSAoJHNlbGVjdGVkSXRlbSlcbiAgICAgICAgICAgICAgICAgICAgICAgID8gJHNlbGVjdGVkSXRlbS5hZGQoJGNob2ljZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogJGNob2ljZVxuICAgICAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSBpZihzdHJpY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FtYmlndW91cyBkcm9wZG93biB2YWx1ZSB1c2luZyBzdHJpY3QgdHlwZSBjaGVjaycsICRjaG9pY2UsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoIG9wdGlvblZhbHVlID09PSB2YWx1ZSB8fCBvcHRpb25UZXh0ID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICRzZWxlY3RlZEl0ZW0gPSAkY2hvaWNlO1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoIFN0cmluZyhvcHRpb25WYWx1ZSkgPT0gU3RyaW5nKHZhbHVlKSB8fCBvcHRpb25UZXh0ID09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0ZvdW5kIHNlbGVjdCBpdGVtIGJ5IHZhbHVlJywgb3B0aW9uVmFsdWUsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAkc2VsZWN0ZWRJdGVtID0gJGNob2ljZTtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkc2VsZWN0ZWRJdGVtO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjaGVjazoge1xuICAgICAgICAgIG1heFNlbGVjdGlvbnM6IGZ1bmN0aW9uKHNlbGVjdGlvbkNvdW50KSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5tYXhTZWxlY3Rpb25zKSB7XG4gICAgICAgICAgICAgIHNlbGVjdGlvbkNvdW50ID0gKHNlbGVjdGlvbkNvdW50ICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgPyBzZWxlY3Rpb25Db3VudFxuICAgICAgICAgICAgICAgIDogbW9kdWxlLmdldC5zZWxlY3Rpb25Db3VudCgpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoc2VsZWN0aW9uQ291bnQgPj0gc2V0dGluZ3MubWF4U2VsZWN0aW9ucykge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnTWF4aW11bSBzZWxlY3Rpb24gY291bnQgcmVhY2hlZCcpO1xuICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLnVzZUxhYmVscykge1xuICAgICAgICAgICAgICAgICAgJGl0ZW0uYWRkQ2xhc3MoY2xhc3NOYW1lLmZpbHRlcmVkKTtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5hZGQubWVzc2FnZShtZXNzYWdlLm1heFNlbGVjdGlvbnMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTm8gbG9uZ2VyIGF0IG1heGltdW0gc2VsZWN0aW9uIGNvdW50Jyk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5tZXNzYWdlKCk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5maWx0ZXJlZEl0ZW0oKTtcbiAgICAgICAgICAgICAgICBpZihtb2R1bGUuaXMuc2VhcmNoU2VsZWN0aW9uKCkpIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5maWx0ZXJJdGVtcygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZXN0b3JlOiB7XG4gICAgICAgICAgZGVmYXVsdHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLmNsZWFyKCk7XG4gICAgICAgICAgICBtb2R1bGUucmVzdG9yZS5kZWZhdWx0VGV4dCgpO1xuICAgICAgICAgICAgbW9kdWxlLnJlc3RvcmUuZGVmYXVsdFZhbHVlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkZWZhdWx0VGV4dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZGVmYXVsdFRleHQgICAgID0gbW9kdWxlLmdldC5kZWZhdWx0VGV4dCgpLFxuICAgICAgICAgICAgICBwbGFjZWhvbGRlclRleHQgPSBtb2R1bGUuZ2V0LnBsYWNlaG9sZGVyVGV4dFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoZGVmYXVsdFRleHQgPT09IHBsYWNlaG9sZGVyVGV4dCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Jlc3RvcmluZyBkZWZhdWx0IHBsYWNlaG9sZGVyIHRleHQnLCBkZWZhdWx0VGV4dCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQucGxhY2Vob2xkZXJUZXh0KGRlZmF1bHRUZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Jlc3RvcmluZyBkZWZhdWx0IHRleHQnLCBkZWZhdWx0VGV4dCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQudGV4dChkZWZhdWx0VGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwbGFjZWhvbGRlclRleHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnNldC5wbGFjZWhvbGRlclRleHQoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRlZmF1bHRWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlID0gbW9kdWxlLmdldC5kZWZhdWx0VmFsdWUoKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoZGVmYXVsdFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZXN0b3JpbmcgZGVmYXVsdCB2YWx1ZScsIGRlZmF1bHRWYWx1ZSk7XG4gICAgICAgICAgICAgIGlmKGRlZmF1bHRWYWx1ZSAhPT0gJycpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuc2V0LnZhbHVlKGRlZmF1bHRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zZWxlY3RlZCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuYWN0aXZlSXRlbSgpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuc2VsZWN0ZWRJdGVtKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGxhYmVsczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5hbGxvd0FkZGl0aW9ucykge1xuICAgICAgICAgICAgICBpZighc2V0dGluZ3MudXNlTGFiZWxzKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLmxhYmVscyk7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3MudXNlTGFiZWxzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Jlc3RvcmluZyBzZWxlY3RlZCB2YWx1ZXMnKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmNyZWF0ZS51c2VyTGFiZWxzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuY2hlY2subWF4U2VsZWN0aW9ucygpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VsZWN0ZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnJlc3RvcmUudmFsdWVzKCk7XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMubXVsdGlwbGUoKSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Jlc3RvcmluZyBwcmV2aW91c2x5IHNlbGVjdGVkIHZhbHVlcyBhbmQgbGFiZWxzJyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZXN0b3JlLmxhYmVscygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUmVzdG9yaW5nIHByZXZpb3VzbHkgc2VsZWN0ZWQgdmFsdWVzJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB2YWx1ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gcHJldmVudHMgY2FsbGJhY2tzIGZyb20gb2NjdXJyaW5nIG9uIGluaXRpYWwgbG9hZFxuICAgICAgICAgICAgbW9kdWxlLnNldC5pbml0aWFsTG9hZCgpO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuYXBpU2V0dGluZ3MgJiYgc2V0dGluZ3Muc2F2ZVJlbW90ZURhdGEgJiYgbW9kdWxlLmdldC5yZW1vdGVWYWx1ZXMoKSkge1xuICAgICAgICAgICAgICBtb2R1bGUucmVzdG9yZS5yZW1vdGVWYWx1ZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnNlbGVjdGVkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmluaXRpYWxMb2FkKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZW1vdGVWYWx1ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHZhbHVlcyA9IG1vZHVsZS5nZXQucmVtb3RlVmFsdWVzKClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUmVjcmVhdGluZyBzZWxlY3RlZCBmcm9tIHNlc3Npb24gZGF0YScsIHZhbHVlcyk7XG4gICAgICAgICAgICBpZih2YWx1ZXMpIHtcbiAgICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5zaW5nbGUoKSApIHtcbiAgICAgICAgICAgICAgICAkLmVhY2godmFsdWVzLCBmdW5jdGlvbih2YWx1ZSwgbmFtZSkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC50ZXh0KG5hbWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQuZWFjaCh2YWx1ZXMsIGZ1bmN0aW9uKHZhbHVlLCBuYW1lKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuYWRkLmxhYmVsKHZhbHVlLCBuYW1lKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZWFkOiB7XG4gICAgICAgICAgcmVtb3RlRGF0YTogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBuYW1lXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZih3aW5kb3cuU3RvcmFnZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5ub1N0b3JhZ2UpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuYW1lID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh2YWx1ZSk7XG4gICAgICAgICAgICByZXR1cm4gKG5hbWUgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyBuYW1lXG4gICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2F2ZToge1xuICAgICAgICAgIGRlZmF1bHRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS5zYXZlLmRlZmF1bHRUZXh0KCk7XG4gICAgICAgICAgICBtb2R1bGUuc2F2ZS5wbGFjZWhvbGRlclRleHQoKTtcbiAgICAgICAgICAgIG1vZHVsZS5zYXZlLmRlZmF1bHRWYWx1ZSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGVmYXVsdFZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB2YWx1ZSA9IG1vZHVsZS5nZXQudmFsdWUoKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NhdmluZyBkZWZhdWx0IHZhbHVlIGFzJywgdmFsdWUpO1xuICAgICAgICAgICAgJG1vZHVsZS5kYXRhKG1ldGFkYXRhLmRlZmF1bHRWYWx1ZSwgdmFsdWUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGVmYXVsdFRleHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHRleHQgPSBtb2R1bGUuZ2V0LnRleHQoKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NhdmluZyBkZWZhdWx0IHRleHQgYXMnLCB0ZXh0KTtcbiAgICAgICAgICAgICRtb2R1bGUuZGF0YShtZXRhZGF0YS5kZWZhdWx0VGV4dCwgdGV4dCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwbGFjZWhvbGRlclRleHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHRleHRcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBsYWNlaG9sZGVyICE9PSBmYWxzZSAmJiAkdGV4dC5oYXNDbGFzcyhjbGFzc05hbWUucGxhY2Vob2xkZXIpKSB7XG4gICAgICAgICAgICAgIHRleHQgPSBtb2R1bGUuZ2V0LnRleHQoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NhdmluZyBwbGFjZWhvbGRlciB0ZXh0IGFzJywgdGV4dCk7XG4gICAgICAgICAgICAgICRtb2R1bGUuZGF0YShtZXRhZGF0YS5wbGFjZWhvbGRlclRleHQsIHRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVtb3RlRGF0YTogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICAgIGlmKHdpbmRvdy5TdG9yYWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm5vU3RvcmFnZSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTYXZpbmcgcmVtb3RlIGRhdGEgdG8gc2Vzc2lvbiBzdG9yYWdlJywgdmFsdWUsIG5hbWUpO1xuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSh2YWx1ZSwgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZihtb2R1bGUuaXMubXVsdGlwbGUoKSAmJiBzZXR0aW5ncy51c2VMYWJlbHMpIHtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUubGFiZWxzKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5hY3RpdmVJdGVtKCk7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnNlbGVjdGVkSXRlbSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuc2V0LnBsYWNlaG9sZGVyVGV4dCgpO1xuICAgICAgICAgIG1vZHVsZS5jbGVhclZhbHVlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xlYXJWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnNldC52YWx1ZSgnJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2Nyb2xsUGFnZTogZnVuY3Rpb24oZGlyZWN0aW9uLCAkc2VsZWN0ZWRJdGVtKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAkY3VycmVudEl0ZW0gID0gJHNlbGVjdGVkSXRlbSB8fCBtb2R1bGUuZ2V0LnNlbGVjdGVkSXRlbSgpLFxuICAgICAgICAgICAgJG1lbnUgICAgICAgICA9ICRjdXJyZW50SXRlbS5jbG9zZXN0KHNlbGVjdG9yLm1lbnUpLFxuICAgICAgICAgICAgbWVudUhlaWdodCAgICA9ICRtZW51Lm91dGVySGVpZ2h0KCksXG4gICAgICAgICAgICBjdXJyZW50U2Nyb2xsID0gJG1lbnUuc2Nyb2xsVG9wKCksXG4gICAgICAgICAgICBpdGVtSGVpZ2h0ICAgID0gJGl0ZW0uZXEoMCkub3V0ZXJIZWlnaHQoKSxcbiAgICAgICAgICAgIGl0ZW1zUGVyUGFnZSAgPSBNYXRoLmZsb29yKG1lbnVIZWlnaHQgLyBpdGVtSGVpZ2h0KSxcbiAgICAgICAgICAgIG1heFNjcm9sbCAgICAgPSAkbWVudS5wcm9wKCdzY3JvbGxIZWlnaHQnKSxcbiAgICAgICAgICAgIG5ld1Njcm9sbCAgICAgPSAoZGlyZWN0aW9uID09ICd1cCcpXG4gICAgICAgICAgICAgID8gY3VycmVudFNjcm9sbCAtIChpdGVtSGVpZ2h0ICogaXRlbXNQZXJQYWdlKVxuICAgICAgICAgICAgICA6IGN1cnJlbnRTY3JvbGwgKyAoaXRlbUhlaWdodCAqIGl0ZW1zUGVyUGFnZSksXG4gICAgICAgICAgICAkc2VsZWN0YWJsZUl0ZW0gPSAkaXRlbS5ub3Qoc2VsZWN0b3IudW5zZWxlY3RhYmxlKSxcbiAgICAgICAgICAgIGlzV2l0aGluUmFuZ2UsXG4gICAgICAgICAgICAkbmV4dFNlbGVjdGVkSXRlbSxcbiAgICAgICAgICAgIGVsZW1lbnRJbmRleFxuICAgICAgICAgIDtcbiAgICAgICAgICBlbGVtZW50SW5kZXggICAgICA9IChkaXJlY3Rpb24gPT0gJ3VwJylcbiAgICAgICAgICAgID8gJHNlbGVjdGFibGVJdGVtLmluZGV4KCRjdXJyZW50SXRlbSkgLSBpdGVtc1BlclBhZ2VcbiAgICAgICAgICAgIDogJHNlbGVjdGFibGVJdGVtLmluZGV4KCRjdXJyZW50SXRlbSkgKyBpdGVtc1BlclBhZ2VcbiAgICAgICAgICA7XG4gICAgICAgICAgaXNXaXRoaW5SYW5nZSA9IChkaXJlY3Rpb24gPT0gJ3VwJylcbiAgICAgICAgICAgID8gKGVsZW1lbnRJbmRleCA+PSAwKVxuICAgICAgICAgICAgOiAoZWxlbWVudEluZGV4IDwgJHNlbGVjdGFibGVJdGVtLmxlbmd0aClcbiAgICAgICAgICA7XG4gICAgICAgICAgJG5leHRTZWxlY3RlZEl0ZW0gPSAoaXNXaXRoaW5SYW5nZSlcbiAgICAgICAgICAgID8gJHNlbGVjdGFibGVJdGVtLmVxKGVsZW1lbnRJbmRleClcbiAgICAgICAgICAgIDogKGRpcmVjdGlvbiA9PSAndXAnKVxuICAgICAgICAgICAgICA/ICRzZWxlY3RhYmxlSXRlbS5maXJzdCgpXG4gICAgICAgICAgICAgIDogJHNlbGVjdGFibGVJdGVtLmxhc3QoKVxuICAgICAgICAgIDtcbiAgICAgICAgICBpZigkbmV4dFNlbGVjdGVkSXRlbS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Njcm9sbGluZyBwYWdlJywgZGlyZWN0aW9uLCAkbmV4dFNlbGVjdGVkSXRlbSk7XG4gICAgICAgICAgICAkY3VycmVudEl0ZW1cbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5zZWxlY3RlZClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgICRuZXh0U2VsZWN0ZWRJdGVtXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5zZWxlY3RPbktleWRvd24gJiYgbW9kdWxlLmlzLnNpbmdsZSgpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQuc2VsZWN0ZWRJdGVtKCRuZXh0U2VsZWN0ZWRJdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRtZW51XG4gICAgICAgICAgICAgIC5zY3JvbGxUb3AobmV3U2Nyb2xsKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXQ6IHtcbiAgICAgICAgICBmaWx0ZXJlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgaXNNdWx0aXBsZSAgICAgICA9IG1vZHVsZS5pcy5tdWx0aXBsZSgpLFxuICAgICAgICAgICAgICBpc1NlYXJjaCAgICAgICAgID0gbW9kdWxlLmlzLnNlYXJjaFNlbGVjdGlvbigpLFxuICAgICAgICAgICAgICBpc1NlYXJjaE11bHRpcGxlID0gKGlzTXVsdGlwbGUgJiYgaXNTZWFyY2gpLFxuICAgICAgICAgICAgICBzZWFyY2hWYWx1ZSAgICAgID0gKGlzU2VhcmNoKVxuICAgICAgICAgICAgICAgID8gbW9kdWxlLmdldC5xdWVyeSgpXG4gICAgICAgICAgICAgICAgOiAnJyxcbiAgICAgICAgICAgICAgaGFzU2VhcmNoVmFsdWUgICA9ICh0eXBlb2Ygc2VhcmNoVmFsdWUgPT09ICdzdHJpbmcnICYmIHNlYXJjaFZhbHVlLmxlbmd0aCA+IDApLFxuICAgICAgICAgICAgICBzZWFyY2hXaWR0aCAgICAgID0gbW9kdWxlLmdldC5zZWFyY2hXaWR0aCgpLFxuICAgICAgICAgICAgICB2YWx1ZUlzU2V0ICAgICAgID0gc2VhcmNoVmFsdWUgIT09ICcnXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihpc011bHRpcGxlICYmIGhhc1NlYXJjaFZhbHVlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBZGp1c3RpbmcgaW5wdXQgd2lkdGgnLCBzZWFyY2hXaWR0aCwgc2V0dGluZ3MuZ2x5cGhXaWR0aCk7XG4gICAgICAgICAgICAgICRzZWFyY2guY3NzKCd3aWR0aCcsIHNlYXJjaFdpZHRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGhhc1NlYXJjaFZhbHVlIHx8IChpc1NlYXJjaE11bHRpcGxlICYmIHZhbHVlSXNTZXQpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdIaWRpbmcgcGxhY2Vob2xkZXIgdGV4dCcpO1xuICAgICAgICAgICAgICAkdGV4dC5hZGRDbGFzcyhjbGFzc05hbWUuZmlsdGVyZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZighaXNNdWx0aXBsZSB8fCAoaXNTZWFyY2hNdWx0aXBsZSAmJiAhdmFsdWVJc1NldCkpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1Nob3dpbmcgcGxhY2Vob2xkZXIgdGV4dCcpO1xuICAgICAgICAgICAgICAkdGV4dC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuZmlsdGVyZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZW1wdHk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5hZGRDbGFzcyhjbGFzc05hbWUuZW1wdHkpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbG9hZGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLmFkZENsYXNzKGNsYXNzTmFtZS5sb2FkaW5nKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBsYWNlaG9sZGVyVGV4dDogZnVuY3Rpb24odGV4dCkge1xuICAgICAgICAgICAgdGV4dCA9IHRleHQgfHwgbW9kdWxlLmdldC5wbGFjZWhvbGRlclRleHQoKTtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2V0dGluZyBwbGFjZWhvbGRlciB0ZXh0JywgdGV4dCk7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LnRleHQodGV4dCk7XG4gICAgICAgICAgICAkdGV4dC5hZGRDbGFzcyhjbGFzc05hbWUucGxhY2Vob2xkZXIpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdGFiYmFibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5zZWFyY2hTZWxlY3Rpb24oKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRlZCB0YWJpbmRleCB0byBzZWFyY2hhYmxlIGRyb3Bkb3duJyk7XG4gICAgICAgICAgICAgICRzZWFyY2hcbiAgICAgICAgICAgICAgICAudmFsKCcnKVxuICAgICAgICAgICAgICAgIC5hdHRyKCd0YWJpbmRleCcsIDApXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgJG1lbnVcbiAgICAgICAgICAgICAgICAuYXR0cigndGFiaW5kZXgnLCAtMSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkZWQgdGFiaW5kZXggdG8gZHJvcGRvd24nKTtcbiAgICAgICAgICAgICAgaWYoICRtb2R1bGUuYXR0cigndGFiaW5kZXgnKSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgICAgLmF0dHIoJ3RhYmluZGV4JywgMClcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgJG1lbnVcbiAgICAgICAgICAgICAgICAgIC5hdHRyKCd0YWJpbmRleCcsIC0xKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5pdGlhbExvYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NldHRpbmcgaW5pdGlhbCBsb2FkJyk7XG4gICAgICAgICAgICBpbml0aWFsTG9hZCA9IHRydWU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhY3RpdmVJdGVtOiBmdW5jdGlvbigkaXRlbSkge1xuICAgICAgICAgICAgaWYoIHNldHRpbmdzLmFsbG93QWRkaXRpb25zICYmICRpdGVtLmZpbHRlcihzZWxlY3Rvci5hZGRpdGlvbikubGVuZ3RoID4gMCApIHtcbiAgICAgICAgICAgICAgJGl0ZW0uYWRkQ2xhc3MoY2xhc3NOYW1lLmZpbHRlcmVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAkaXRlbS5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHBhcnRpYWxTZWFyY2g6IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBsZW5ndGggPSBtb2R1bGUuZ2V0LnF1ZXJ5KCkubGVuZ3RoXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkc2VhcmNoLnZhbCggdGV4dC5zdWJzdHIoMCwgbGVuZ3RoKSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzY3JvbGxQb3NpdGlvbjogZnVuY3Rpb24oJGl0ZW0sIGZvcmNlU2Nyb2xsKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZWRnZVRvbGVyYW5jZSA9IDUsXG4gICAgICAgICAgICAgICRtZW51LFxuICAgICAgICAgICAgICBoYXNBY3RpdmUsXG4gICAgICAgICAgICAgIG9mZnNldCxcbiAgICAgICAgICAgICAgaXRlbUhlaWdodCxcbiAgICAgICAgICAgICAgaXRlbU9mZnNldCxcbiAgICAgICAgICAgICAgbWVudU9mZnNldCxcbiAgICAgICAgICAgICAgbWVudVNjcm9sbCxcbiAgICAgICAgICAgICAgbWVudUhlaWdodCxcbiAgICAgICAgICAgICAgYWJvdmVQYWdlLFxuICAgICAgICAgICAgICBiZWxvd1BhZ2VcbiAgICAgICAgICAgIDtcblxuICAgICAgICAgICAgJGl0ZW0gICAgICAgPSAkaXRlbSB8fCBtb2R1bGUuZ2V0LnNlbGVjdGVkSXRlbSgpO1xuICAgICAgICAgICAgJG1lbnUgICAgICAgPSAkaXRlbS5jbG9zZXN0KHNlbGVjdG9yLm1lbnUpO1xuICAgICAgICAgICAgaGFzQWN0aXZlICAgPSAoJGl0ZW0gJiYgJGl0ZW0ubGVuZ3RoID4gMCk7XG4gICAgICAgICAgICBmb3JjZVNjcm9sbCA9IChmb3JjZVNjcm9sbCAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICA/IGZvcmNlU2Nyb2xsXG4gICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCRpdGVtICYmICRtZW51Lmxlbmd0aCA+IDAgJiYgaGFzQWN0aXZlKSB7XG4gICAgICAgICAgICAgIGl0ZW1PZmZzZXQgPSAkaXRlbS5wb3NpdGlvbigpLnRvcDtcblxuICAgICAgICAgICAgICAkbWVudS5hZGRDbGFzcyhjbGFzc05hbWUubG9hZGluZyk7XG4gICAgICAgICAgICAgIG1lbnVTY3JvbGwgPSAkbWVudS5zY3JvbGxUb3AoKTtcbiAgICAgICAgICAgICAgbWVudU9mZnNldCA9ICRtZW51Lm9mZnNldCgpLnRvcDtcbiAgICAgICAgICAgICAgaXRlbU9mZnNldCA9ICRpdGVtLm9mZnNldCgpLnRvcDtcbiAgICAgICAgICAgICAgb2Zmc2V0ICAgICA9IG1lbnVTY3JvbGwgLSBtZW51T2Zmc2V0ICsgaXRlbU9mZnNldDtcbiAgICAgICAgICAgICAgaWYoIWZvcmNlU2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgbWVudUhlaWdodCA9ICRtZW51LmhlaWdodCgpO1xuICAgICAgICAgICAgICAgIGJlbG93UGFnZSAgPSBtZW51U2Nyb2xsICsgbWVudUhlaWdodCA8IChvZmZzZXQgKyBlZGdlVG9sZXJhbmNlKTtcbiAgICAgICAgICAgICAgICBhYm92ZVBhZ2UgID0gKChvZmZzZXQgLSBlZGdlVG9sZXJhbmNlKSA8IG1lbnVTY3JvbGwpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2Nyb2xsaW5nIHRvIGFjdGl2ZSBpdGVtJywgb2Zmc2V0KTtcbiAgICAgICAgICAgICAgaWYoZm9yY2VTY3JvbGwgfHwgYWJvdmVQYWdlIHx8IGJlbG93UGFnZSkge1xuICAgICAgICAgICAgICAgICRtZW51LnNjcm9sbFRvcChvZmZzZXQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICRtZW51LnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5sb2FkaW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHQ6IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmFjdGlvbiAhPT0gJ3NlbGVjdCcpIHtcbiAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuYWN0aW9uID09ICdjb21ibycpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NoYW5naW5nIGNvbWJvIGJ1dHRvbiB0ZXh0JywgdGV4dCwgJGNvbWJvKTtcbiAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5wcmVzZXJ2ZUhUTUwpIHtcbiAgICAgICAgICAgICAgICAgICRjb21iby5odG1sKHRleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICRjb21iby50ZXh0KHRleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZih0ZXh0ICE9PSBtb2R1bGUuZ2V0LnBsYWNlaG9sZGVyVGV4dCgpKSB7XG4gICAgICAgICAgICAgICAgICAkdGV4dC5yZW1vdmVDbGFzcyhjbGFzc05hbWUucGxhY2Vob2xkZXIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NoYW5naW5nIHRleHQnLCB0ZXh0LCAkdGV4dCk7XG4gICAgICAgICAgICAgICAgJHRleHRcbiAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuZmlsdGVyZWQpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLnByZXNlcnZlSFRNTCkge1xuICAgICAgICAgICAgICAgICAgJHRleHQuaHRtbCh0ZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAkdGV4dC50ZXh0KHRleHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VsZWN0ZWRJdGVtOiBmdW5jdGlvbigkaXRlbSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHZhbHVlICAgICAgPSBtb2R1bGUuZ2V0LmNob2ljZVZhbHVlKCRpdGVtKSxcbiAgICAgICAgICAgICAgc2VhcmNoVGV4dCA9IG1vZHVsZS5nZXQuY2hvaWNlVGV4dCgkaXRlbSwgZmFsc2UpLFxuICAgICAgICAgICAgICB0ZXh0ICAgICAgID0gbW9kdWxlLmdldC5jaG9pY2VUZXh0KCRpdGVtLCB0cnVlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZXR0aW5nIHVzZXIgc2VsZWN0aW9uIHRvIGl0ZW0nLCAkaXRlbSk7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmFjdGl2ZUl0ZW0oKTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQucGFydGlhbFNlYXJjaChzZWFyY2hUZXh0KTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQuYWN0aXZlSXRlbSgkaXRlbSk7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LnNlbGVjdGVkKHZhbHVlLCAkaXRlbSk7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LnRleHQodGV4dCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWxlY3RlZExldHRlcjogZnVuY3Rpb24obGV0dGVyKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJHNlbGVjdGVkSXRlbSAgICAgICAgID0gJGl0ZW0uZmlsdGVyKCcuJyArIGNsYXNzTmFtZS5zZWxlY3RlZCksXG4gICAgICAgICAgICAgIGFscmVhZHlTZWxlY3RlZExldHRlciA9ICRzZWxlY3RlZEl0ZW0ubGVuZ3RoID4gMCAmJiBtb2R1bGUuaGFzLmZpcnN0TGV0dGVyKCRzZWxlY3RlZEl0ZW0sIGxldHRlciksXG4gICAgICAgICAgICAgICRuZXh0VmFsdWUgICAgICAgICAgICA9IGZhbHNlLFxuICAgICAgICAgICAgICAkbmV4dEl0ZW1cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIC8vIGNoZWNrIG5leHQgb2Ygc2FtZSBsZXR0ZXJcbiAgICAgICAgICAgIGlmKGFscmVhZHlTZWxlY3RlZExldHRlcikge1xuICAgICAgICAgICAgICAkbmV4dEl0ZW0gPSAkc2VsZWN0ZWRJdGVtLm5leHRBbGwoJGl0ZW0pLmVxKDApO1xuICAgICAgICAgICAgICBpZiggbW9kdWxlLmhhcy5maXJzdExldHRlcigkbmV4dEl0ZW0sIGxldHRlcikgKSB7XG4gICAgICAgICAgICAgICAgJG5leHRWYWx1ZSAgPSAkbmV4dEl0ZW07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGNoZWNrIGFsbCB2YWx1ZXNcbiAgICAgICAgICAgIGlmKCEkbmV4dFZhbHVlKSB7XG4gICAgICAgICAgICAgICRpdGVtXG4gICAgICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgIGlmKG1vZHVsZS5oYXMuZmlyc3RMZXR0ZXIoJCh0aGlzKSwgbGV0dGVyKSkge1xuICAgICAgICAgICAgICAgICAgICAkbmV4dFZhbHVlID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHNldCBuZXh0IHZhbHVlXG4gICAgICAgICAgICBpZigkbmV4dFZhbHVlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTY3JvbGxpbmcgdG8gbmV4dCB2YWx1ZSB3aXRoIGxldHRlcicsIGxldHRlcik7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQuc2Nyb2xsUG9zaXRpb24oJG5leHRWYWx1ZSk7XG4gICAgICAgICAgICAgICRzZWxlY3RlZEl0ZW0ucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKTtcbiAgICAgICAgICAgICAgJG5leHRWYWx1ZS5hZGRDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpO1xuICAgICAgICAgICAgICBpZihzZXR0aW5ncy5zZWxlY3RPbktleWRvd24gJiYgbW9kdWxlLmlzLnNpbmdsZSgpKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zZWxlY3RlZEl0ZW0oJG5leHRWYWx1ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpcmVjdGlvbjogZnVuY3Rpb24oJG1lbnUpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmRpcmVjdGlvbiA9PSAnYXV0bycpIHtcbiAgICAgICAgICAgICAgLy8gcmVzZXQgcG9zaXRpb25cbiAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS51cHdhcmQoKTtcblxuICAgICAgICAgICAgICBpZihtb2R1bGUuY2FuLm9wZW5Eb3dud2FyZCgkbWVudSkpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnVwd2FyZCgkbWVudSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNldC51cHdhcmQoJG1lbnUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKCFtb2R1bGUuaXMubGVmdHdhcmQoJG1lbnUpICYmICFtb2R1bGUuY2FuLm9wZW5SaWdodHdhcmQoJG1lbnUpKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNldC5sZWZ0d2FyZCgkbWVudSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoc2V0dGluZ3MuZGlyZWN0aW9uID09ICd1cHdhcmQnKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQudXB3YXJkKCRtZW51KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHVwd2FyZDogZnVuY3Rpb24oJGN1cnJlbnRNZW51KSB7XG4gICAgICAgICAgICB2YXIgJGVsZW1lbnQgPSAkY3VycmVudE1lbnUgfHwgJG1vZHVsZTtcbiAgICAgICAgICAgICRlbGVtZW50LmFkZENsYXNzKGNsYXNzTmFtZS51cHdhcmQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbGVmdHdhcmQ6IGZ1bmN0aW9uKCRjdXJyZW50TWVudSkge1xuICAgICAgICAgICAgdmFyICRlbGVtZW50ID0gJGN1cnJlbnRNZW51IHx8ICRtZW51O1xuICAgICAgICAgICAgJGVsZW1lbnQuYWRkQ2xhc3MoY2xhc3NOYW1lLmxlZnR3YXJkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbih2YWx1ZSwgdGV4dCwgJHNlbGVjdGVkKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZXNjYXBlZFZhbHVlID0gbW9kdWxlLmVzY2FwZS52YWx1ZSh2YWx1ZSksXG4gICAgICAgICAgICAgIGhhc0lucHV0ICAgICA9ICgkaW5wdXQubGVuZ3RoID4gMCksXG4gICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IG1vZHVsZS5nZXQudmFsdWVzKCksXG4gICAgICAgICAgICAgIHN0cmluZ1ZhbHVlICA9ICh2YWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgID8gU3RyaW5nKHZhbHVlKVxuICAgICAgICAgICAgICAgIDogdmFsdWUsXG4gICAgICAgICAgICAgIG5ld1ZhbHVlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihoYXNJbnB1dCkge1xuICAgICAgICAgICAgICBpZighc2V0dGluZ3MuYWxsb3dSZXNlbGVjdGlvbiAmJiBzdHJpbmdWYWx1ZSA9PSBjdXJyZW50VmFsdWUpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2tpcHBpbmcgdmFsdWUgdXBkYXRlIGFscmVhZHkgc2FtZSB2YWx1ZScsIHZhbHVlLCBjdXJyZW50VmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmKCFtb2R1bGUuaXMuaW5pdGlhbExvYWQoKSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmKCBtb2R1bGUuaXMuc2luZ2xlKCkgJiYgbW9kdWxlLmhhcy5zZWxlY3RJbnB1dCgpICYmIG1vZHVsZS5jYW4uZXh0ZW5kU2VsZWN0KCkgKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgdXNlciBvcHRpb24nLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmFkZC5vcHRpb25WYWx1ZSh2YWx1ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdVcGRhdGluZyBpbnB1dCB2YWx1ZScsIGVzY2FwZWRWYWx1ZSwgY3VycmVudFZhbHVlKTtcbiAgICAgICAgICAgICAgaW50ZXJuYWxDaGFuZ2UgPSB0cnVlO1xuICAgICAgICAgICAgICAkaW5wdXRcbiAgICAgICAgICAgICAgICAudmFsKGVzY2FwZWRWYWx1ZSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBpZihzZXR0aW5ncy5maXJlT25Jbml0ID09PSBmYWxzZSAmJiBtb2R1bGUuaXMuaW5pdGlhbExvYWQoKSkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW5wdXQgbmF0aXZlIGNoYW5nZSBldmVudCBpZ25vcmVkIG9uIGluaXRpYWwgbG9hZCcpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS50cmlnZ2VyLmNoYW5nZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGludGVybmFsQ2hhbmdlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1N0b3JpbmcgdmFsdWUgaW4gbWV0YWRhdGEnLCBlc2NhcGVkVmFsdWUsICRpbnB1dCk7XG4gICAgICAgICAgICAgIGlmKGVzY2FwZWRWYWx1ZSAhPT0gY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgICAgICAgJG1vZHVsZS5kYXRhKG1ldGFkYXRhLnZhbHVlLCBzdHJpbmdWYWx1ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5zaW5nbGUoKSAmJiBzZXR0aW5ncy5jbGVhcmFibGUpIHtcbiAgICAgICAgICAgICAgLy8gdHJlYXQgdW5kZWZpbmVkIG9yICcnIGFzIGVtcHR5XG4gICAgICAgICAgICAgIGlmKCFlc2NhcGVkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmNsZWFyYWJsZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5zZXQuY2xlYXJhYmxlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmZpcmVPbkluaXQgPT09IGZhbHNlICYmIG1vZHVsZS5pcy5pbml0aWFsTG9hZCgpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdObyBjYWxsYmFjayBvbiBpbml0aWFsIGxvYWQnLCBzZXR0aW5ncy5vbkNoYW5nZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3Mub25DaGFuZ2UuY2FsbChlbGVtZW50LCB2YWx1ZSwgdGV4dCwgJHNlbGVjdGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbXVsdGlwbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5hZGRDbGFzcyhjbGFzc05hbWUubXVsdGlwbGUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmlzaWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLmFkZENsYXNzKGNsYXNzTmFtZS52aXNpYmxlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGV4YWN0bHk6IGZ1bmN0aW9uKHZhbHVlLCAkc2VsZWN0ZWRJdGVtKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgc2VsZWN0ZWQgdG8gZXhhY3QgdmFsdWVzJyk7XG4gICAgICAgICAgICBtb2R1bGUuY2xlYXIoKTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQuc2VsZWN0ZWQodmFsdWUsICRzZWxlY3RlZEl0ZW0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VsZWN0ZWQ6IGZ1bmN0aW9uKHZhbHVlLCAkc2VsZWN0ZWRJdGVtKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgaXNNdWx0aXBsZSA9IG1vZHVsZS5pcy5tdWx0aXBsZSgpLFxuICAgICAgICAgICAgICAkdXNlclNlbGVjdGVkSXRlbVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJHNlbGVjdGVkSXRlbSA9IChzZXR0aW5ncy5hbGxvd0FkZGl0aW9ucylcbiAgICAgICAgICAgICAgPyAkc2VsZWN0ZWRJdGVtIHx8IG1vZHVsZS5nZXQuaXRlbVdpdGhBZGRpdGlvbnModmFsdWUpXG4gICAgICAgICAgICAgIDogJHNlbGVjdGVkSXRlbSB8fCBtb2R1bGUuZ2V0Lml0ZW0odmFsdWUpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZighJHNlbGVjdGVkSXRlbSkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgc2VsZWN0ZWQgbWVudSBpdGVtIHRvJywgJHNlbGVjdGVkSXRlbSk7XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMubXVsdGlwbGUoKSkge1xuICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnNlYXJjaFdpZHRoKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMuc2luZ2xlKCkpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5hY3RpdmVJdGVtKCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuc2VsZWN0ZWRJdGVtKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKHNldHRpbmdzLnVzZUxhYmVscykge1xuICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnNlbGVjdGVkSXRlbSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gc2VsZWN0IGVhY2ggaXRlbVxuICAgICAgICAgICAgJHNlbGVjdGVkSXRlbVxuICAgICAgICAgICAgICAuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAgICRzZWxlY3RlZCAgICAgID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICAgIHNlbGVjdGVkVGV4dCAgID0gbW9kdWxlLmdldC5jaG9pY2VUZXh0KCRzZWxlY3RlZCksXG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlICA9IG1vZHVsZS5nZXQuY2hvaWNlVmFsdWUoJHNlbGVjdGVkLCBzZWxlY3RlZFRleHQpLFxuXG4gICAgICAgICAgICAgICAgICBpc0ZpbHRlcmVkICAgICA9ICRzZWxlY3RlZC5oYXNDbGFzcyhjbGFzc05hbWUuZmlsdGVyZWQpLFxuICAgICAgICAgICAgICAgICAgaXNBY3RpdmUgICAgICAgPSAkc2VsZWN0ZWQuaGFzQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSksXG4gICAgICAgICAgICAgICAgICBpc1VzZXJWYWx1ZSAgICA9ICRzZWxlY3RlZC5oYXNDbGFzcyhjbGFzc05hbWUuYWRkaXRpb24pLFxuICAgICAgICAgICAgICAgICAgc2hvdWxkQW5pbWF0ZSAgPSAoaXNNdWx0aXBsZSAmJiAkc2VsZWN0ZWRJdGVtLmxlbmd0aCA9PSAxKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICBpZihpc011bHRpcGxlKSB7XG4gICAgICAgICAgICAgICAgICBpZighaXNBY3RpdmUgfHwgaXNVc2VyVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuYXBpU2V0dGluZ3MgJiYgc2V0dGluZ3Muc2F2ZVJlbW90ZURhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUuc2F2ZS5yZW1vdGVEYXRhKHNlbGVjdGVkVGV4dCwgc2VsZWN0ZWRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYoc2V0dGluZ3MudXNlTGFiZWxzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLmFkZC5sYWJlbChzZWxlY3RlZFZhbHVlLCBzZWxlY3RlZFRleHQsIHNob3VsZEFuaW1hdGUpO1xuICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS5hZGQudmFsdWUoc2VsZWN0ZWRWYWx1ZSwgc2VsZWN0ZWRUZXh0LCAkc2VsZWN0ZWQpO1xuICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS5zZXQuYWN0aXZlSXRlbSgkc2VsZWN0ZWQpO1xuICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS5maWx0ZXJBY3RpdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUuc2VsZWN0Lm5leHRBdmFpbGFibGUoJHNlbGVjdGVkSXRlbSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLmFkZC52YWx1ZShzZWxlY3RlZFZhbHVlLCBzZWxlY3RlZFRleHQsICRzZWxlY3RlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC50ZXh0KG1vZHVsZS5hZGQudmFyaWFibGVzKG1lc3NhZ2UuY291bnQpKTtcbiAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUuc2V0LmFjdGl2ZUl0ZW0oJHNlbGVjdGVkKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSBpZighaXNGaWx0ZXJlZCkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NlbGVjdGVkIGFjdGl2ZSB2YWx1ZSwgcmVtb3ZpbmcgbGFiZWwnKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5zZWxlY3RlZChzZWxlY3RlZFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5hcGlTZXR0aW5ncyAmJiBzZXR0aW5ncy5zYXZlUmVtb3RlRGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuc2F2ZS5yZW1vdGVEYXRhKHNlbGVjdGVkVGV4dCwgc2VsZWN0ZWRWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuc2V0LnRleHQoc2VsZWN0ZWRUZXh0KTtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5zZXQudmFsdWUoc2VsZWN0ZWRWYWx1ZSwgc2VsZWN0ZWRUZXh0LCAkc2VsZWN0ZWQpO1xuICAgICAgICAgICAgICAgICAgJHNlbGVjdGVkXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKVxuICAgICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNsZWFyYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkaWNvbi5hZGRDbGFzcyhjbGFzc05hbWUuY2xlYXIpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG5cbiAgICAgICAgYWRkOiB7XG4gICAgICAgICAgbGFiZWw6IGZ1bmN0aW9uKHZhbHVlLCB0ZXh0LCBzaG91bGRBbmltYXRlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJG5leHQgID0gbW9kdWxlLmlzLnNlYXJjaFNlbGVjdGlvbigpXG4gICAgICAgICAgICAgICAgPyAkc2VhcmNoXG4gICAgICAgICAgICAgICAgOiAkdGV4dCxcbiAgICAgICAgICAgICAgZXNjYXBlZFZhbHVlID0gbW9kdWxlLmVzY2FwZS52YWx1ZSh2YWx1ZSksXG4gICAgICAgICAgICAgICRsYWJlbFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuaWdub3JlQ2FzZSkge1xuICAgICAgICAgICAgICBlc2NhcGVkVmFsdWUgPSBlc2NhcGVkVmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRsYWJlbCA9ICAkKCc8YSAvPicpXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUubGFiZWwpXG4gICAgICAgICAgICAgIC5hdHRyKCdkYXRhLScgKyBtZXRhZGF0YS52YWx1ZSwgZXNjYXBlZFZhbHVlKVxuICAgICAgICAgICAgICAuaHRtbCh0ZW1wbGF0ZXMubGFiZWwoZXNjYXBlZFZhbHVlLCB0ZXh0KSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgICRsYWJlbCA9IHNldHRpbmdzLm9uTGFiZWxDcmVhdGUuY2FsbCgkbGFiZWwsIGVzY2FwZWRWYWx1ZSwgdGV4dCk7XG5cbiAgICAgICAgICAgIGlmKG1vZHVsZS5oYXMubGFiZWwodmFsdWUpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVXNlciBzZWxlY3Rpb24gYWxyZWFkeSBleGlzdHMsIHNraXBwaW5nJywgZXNjYXBlZFZhbHVlKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoc2V0dGluZ3MubGFiZWwudmFyaWF0aW9uKSB7XG4gICAgICAgICAgICAgICRsYWJlbC5hZGRDbGFzcyhzZXR0aW5ncy5sYWJlbC52YXJpYXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoc2hvdWxkQW5pbWF0ZSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0FuaW1hdGluZyBpbiBsYWJlbCcsICRsYWJlbCk7XG4gICAgICAgICAgICAgICRsYWJlbFxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuaGlkZGVuKVxuICAgICAgICAgICAgICAgIC5pbnNlcnRCZWZvcmUoJG5leHQpXG4gICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oc2V0dGluZ3MubGFiZWwudHJhbnNpdGlvbiwgc2V0dGluZ3MubGFiZWwuZHVyYXRpb24pXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0FkZGluZyBzZWxlY3Rpb24gbGFiZWwnLCAkbGFiZWwpO1xuICAgICAgICAgICAgICAkbGFiZWxcbiAgICAgICAgICAgICAgICAuaW5zZXJ0QmVmb3JlKCRuZXh0KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtZXNzYWdlOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAkbWVudS5jaGlsZHJlbihzZWxlY3Rvci5tZXNzYWdlKSxcbiAgICAgICAgICAgICAgaHRtbCAgICAgPSBzZXR0aW5ncy50ZW1wbGF0ZXMubWVzc2FnZShtb2R1bGUuYWRkLnZhcmlhYmxlcyhtZXNzYWdlKSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCRtZXNzYWdlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgJG1lc3NhZ2VcbiAgICAgICAgICAgICAgICAuaHRtbChodG1sKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgJG1lc3NhZ2UgPSAkKCc8ZGl2Lz4nKVxuICAgICAgICAgICAgICAgIC5odG1sKGh0bWwpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5tZXNzYWdlKVxuICAgICAgICAgICAgICAgIC5hcHBlbmRUbygkbWVudSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgb3B0aW9uVmFsdWU6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZXNjYXBlZFZhbHVlID0gbW9kdWxlLmVzY2FwZS52YWx1ZSh2YWx1ZSksXG4gICAgICAgICAgICAgICRvcHRpb24gICAgICA9ICRpbnB1dC5maW5kKCdvcHRpb25bdmFsdWU9XCInICsgbW9kdWxlLmVzY2FwZS5zdHJpbmcoZXNjYXBlZFZhbHVlKSArICdcIl0nKSxcbiAgICAgICAgICAgICAgaGFzT3B0aW9uICAgID0gKCRvcHRpb24ubGVuZ3RoID4gMClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKGhhc09wdGlvbikge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyB0ZW1wb3JhcmlseSBkaXNjb25uZWN0IG9ic2VydmVyXG4gICAgICAgICAgICBtb2R1bGUuZGlzY29ubmVjdC5zZWxlY3RPYnNlcnZlcigpO1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5zaW5nbGUoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlbW92aW5nIHByZXZpb3VzIHVzZXIgYWRkaXRpb24nKTtcbiAgICAgICAgICAgICAgJGlucHV0LmZpbmQoJ29wdGlvbi4nICsgY2xhc3NOYW1lLmFkZGl0aW9uKS5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoJzxvcHRpb24vPicpXG4gICAgICAgICAgICAgIC5wcm9wKCd2YWx1ZScsIGVzY2FwZWRWYWx1ZSlcbiAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5hZGRpdGlvbilcbiAgICAgICAgICAgICAgLmh0bWwodmFsdWUpXG4gICAgICAgICAgICAgIC5hcHBlbmRUbygkaW5wdXQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQWRkaW5nIHVzZXIgYWRkaXRpb24gYXMgYW4gPG9wdGlvbj4nLCB2YWx1ZSk7XG4gICAgICAgICAgICBtb2R1bGUub2JzZXJ2ZS5zZWxlY3QoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVzZXJTdWdnZXN0aW9uOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICRhZGRpdGlvbiAgICAgICAgID0gJG1lbnUuY2hpbGRyZW4oc2VsZWN0b3IuYWRkaXRpb24pLFxuICAgICAgICAgICAgICAkZXhpc3RpbmdJdGVtICAgICA9IG1vZHVsZS5nZXQuaXRlbSh2YWx1ZSksXG4gICAgICAgICAgICAgIGFscmVhZHlIYXNWYWx1ZSAgID0gJGV4aXN0aW5nSXRlbSAmJiAkZXhpc3RpbmdJdGVtLm5vdChzZWxlY3Rvci5hZGRpdGlvbikubGVuZ3RoLFxuICAgICAgICAgICAgICBoYXNVc2VyU3VnZ2VzdGlvbiA9ICRhZGRpdGlvbi5sZW5ndGggPiAwLFxuICAgICAgICAgICAgICBodG1sXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy51c2VMYWJlbHMgJiYgbW9kdWxlLmhhcy5tYXhTZWxlY3Rpb25zKCkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYodmFsdWUgPT09ICcnIHx8IGFscmVhZHlIYXNWYWx1ZSkge1xuICAgICAgICAgICAgICAkYWRkaXRpb24ucmVtb3ZlKCk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGhhc1VzZXJTdWdnZXN0aW9uKSB7XG4gICAgICAgICAgICAgICRhZGRpdGlvblxuICAgICAgICAgICAgICAgIC5kYXRhKG1ldGFkYXRhLnZhbHVlLCB2YWx1ZSlcbiAgICAgICAgICAgICAgICAuZGF0YShtZXRhZGF0YS50ZXh0LCB2YWx1ZSlcbiAgICAgICAgICAgICAgICAuYXR0cignZGF0YS0nICsgbWV0YWRhdGEudmFsdWUsIHZhbHVlKVxuICAgICAgICAgICAgICAgIC5hdHRyKCdkYXRhLScgKyBtZXRhZGF0YS50ZXh0LCB2YWx1ZSlcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmZpbHRlcmVkKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCFzZXR0aW5ncy5oaWRlQWRkaXRpb25zKSB7XG4gICAgICAgICAgICAgICAgaHRtbCA9IHNldHRpbmdzLnRlbXBsYXRlcy5hZGRpdGlvbiggbW9kdWxlLmFkZC52YXJpYWJsZXMobWVzc2FnZS5hZGRSZXN1bHQsIHZhbHVlKSApO1xuICAgICAgICAgICAgICAgICRhZGRpdGlvblxuICAgICAgICAgICAgICAgICAgLmh0bWwoaHRtbClcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlcGxhY2luZyB1c2VyIHN1Z2dlc3Rpb24gd2l0aCBuZXcgdmFsdWUnLCAkYWRkaXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICRhZGRpdGlvbiA9IG1vZHVsZS5jcmVhdGUudXNlckNob2ljZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICRhZGRpdGlvblxuICAgICAgICAgICAgICAgIC5wcmVwZW5kVG8oJG1lbnUpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FkZGluZyBpdGVtIGNob2ljZSB0byBtZW51IGNvcnJlc3BvbmRpbmcgd2l0aCB1c2VyIGNob2ljZSBhZGRpdGlvbicsICRhZGRpdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZighc2V0dGluZ3MuaGlkZUFkZGl0aW9ucyB8fCBtb2R1bGUuaXMuYWxsRmlsdGVyZWQoKSkge1xuICAgICAgICAgICAgICAkYWRkaXRpb25cbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKVxuICAgICAgICAgICAgICAgIC5zaWJsaW5ncygpXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5zZWxlY3RlZClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLnJlZnJlc2hJdGVtcygpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFyaWFibGVzOiBmdW5jdGlvbihtZXNzYWdlLCB0ZXJtKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgaGFzQ291bnQgICAgPSAobWVzc2FnZS5zZWFyY2goJ3tjb3VudH0nKSAhPT0gLTEpLFxuICAgICAgICAgICAgICBoYXNNYXhDb3VudCA9IChtZXNzYWdlLnNlYXJjaCgne21heENvdW50fScpICE9PSAtMSksXG4gICAgICAgICAgICAgIGhhc1Rlcm0gICAgID0gKG1lc3NhZ2Uuc2VhcmNoKCd7dGVybX0nKSAhPT0gLTEpLFxuICAgICAgICAgICAgICB2YWx1ZXMsXG4gICAgICAgICAgICAgIGNvdW50LFxuICAgICAgICAgICAgICBxdWVyeVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FkZGluZyB0ZW1wbGF0ZWQgdmFyaWFibGVzIHRvIG1lc3NhZ2UnLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIGlmKGhhc0NvdW50KSB7XG4gICAgICAgICAgICAgIGNvdW50ICA9IG1vZHVsZS5nZXQuc2VsZWN0aW9uQ291bnQoKTtcbiAgICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UucmVwbGFjZSgne2NvdW50fScsIGNvdW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGhhc01heENvdW50KSB7XG4gICAgICAgICAgICAgIGNvdW50ICA9IG1vZHVsZS5nZXQuc2VsZWN0aW9uQ291bnQoKTtcbiAgICAgICAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UucmVwbGFjZSgne21heENvdW50fScsIHNldHRpbmdzLm1heFNlbGVjdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoaGFzVGVybSkge1xuICAgICAgICAgICAgICBxdWVyeSAgID0gdGVybSB8fCBtb2R1bGUuZ2V0LnF1ZXJ5KCk7XG4gICAgICAgICAgICAgIG1lc3NhZ2UgPSBtZXNzYWdlLnJlcGxhY2UoJ3t0ZXJtfScsIHF1ZXJ5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKGFkZGVkVmFsdWUsIGFkZGVkVGV4dCwgJHNlbGVjdGVkSXRlbSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IG1vZHVsZS5nZXQudmFsdWVzKCksXG4gICAgICAgICAgICAgIG5ld1ZhbHVlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihtb2R1bGUuaGFzLnZhbHVlKGFkZGVkVmFsdWUpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVmFsdWUgYWxyZWFkeSBzZWxlY3RlZCcpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihhZGRlZFZhbHVlID09PSAnJykge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0Nhbm5vdCBzZWxlY3QgYmxhbmsgdmFsdWVzIGZyb20gbXVsdGlzZWxlY3QnKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZXh0ZW5kIGN1cnJlbnQgYXJyYXlcbiAgICAgICAgICAgIGlmKCQuaXNBcnJheShjdXJyZW50VmFsdWUpKSB7XG4gICAgICAgICAgICAgIG5ld1ZhbHVlID0gY3VycmVudFZhbHVlLmNvbmNhdChbYWRkZWRWYWx1ZV0pO1xuICAgICAgICAgICAgICBuZXdWYWx1ZSA9IG1vZHVsZS5nZXQudW5pcXVlQXJyYXkobmV3VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG5ld1ZhbHVlID0gW2FkZGVkVmFsdWVdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gYWRkIHZhbHVlc1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5oYXMuc2VsZWN0SW5wdXQoKSApIHtcbiAgICAgICAgICAgICAgaWYobW9kdWxlLmNhbi5leHRlbmRTZWxlY3QoKSkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIHZhbHVlIHRvIHNlbGVjdCcsIGFkZGVkVmFsdWUsIG5ld1ZhbHVlLCAkaW5wdXQpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5hZGQub3B0aW9uVmFsdWUoYWRkZWRWYWx1ZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBuZXdWYWx1ZSA9IG5ld1ZhbHVlLmpvaW4oc2V0dGluZ3MuZGVsaW1pdGVyKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZXR0aW5nIGhpZGRlbiBpbnB1dCB0byBkZWxpbWl0ZWQgdmFsdWUnLCBuZXdWYWx1ZSwgJGlucHV0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYoc2V0dGluZ3MuZmlyZU9uSW5pdCA9PT0gZmFsc2UgJiYgbW9kdWxlLmlzLmluaXRpYWxMb2FkKCkpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NraXBwaW5nIG9uYWRkIGNhbGxiYWNrIG9uIGluaXRpYWwgbG9hZCcsIHNldHRpbmdzLm9uQWRkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBzZXR0aW5ncy5vbkFkZC5jYWxsKGVsZW1lbnQsIGFkZGVkVmFsdWUsIGFkZGVkVGV4dCwgJHNlbGVjdGVkSXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuc2V0LnZhbHVlKG5ld1ZhbHVlLCBhZGRlZFZhbHVlLCBhZGRlZFRleHQsICRzZWxlY3RlZEl0ZW0pO1xuICAgICAgICAgICAgbW9kdWxlLmNoZWNrLm1heFNlbGVjdGlvbnMoKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZToge1xuICAgICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYWN0aXZlTGFiZWw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5maW5kKHNlbGVjdG9yLmxhYmVsKS5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVtcHR5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmVtcHR5KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGxvYWRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVDbGFzcyhjbGFzc05hbWUubG9hZGluZyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbml0aWFsTG9hZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpbml0aWFsTG9hZCA9IGZhbHNlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdXB3YXJkOiBmdW5jdGlvbigkY3VycmVudE1lbnUpIHtcbiAgICAgICAgICAgIHZhciAkZWxlbWVudCA9ICRjdXJyZW50TWVudSB8fCAkbW9kdWxlO1xuICAgICAgICAgICAgJGVsZW1lbnQucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLnVwd2FyZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsZWZ0d2FyZDogZnVuY3Rpb24oJGN1cnJlbnRNZW51KSB7XG4gICAgICAgICAgICB2YXIgJGVsZW1lbnQgPSAkY3VycmVudE1lbnUgfHwgJG1lbnU7XG4gICAgICAgICAgICAkZWxlbWVudC5yZW1vdmVDbGFzcyhjbGFzc05hbWUubGVmdHdhcmQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmlzaWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS52aXNpYmxlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFjdGl2ZUl0ZW06IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGl0ZW0ucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmaWx0ZXJlZEl0ZW06IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MudXNlTGFiZWxzICYmIG1vZHVsZS5oYXMubWF4U2VsZWN0aW9ucygpICkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzZXR0aW5ncy51c2VMYWJlbHMgJiYgbW9kdWxlLmlzLm11bHRpcGxlKCkpIHtcbiAgICAgICAgICAgICAgJGl0ZW0ubm90KCcuJyArIGNsYXNzTmFtZS5hY3RpdmUpLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5maWx0ZXJlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgJGl0ZW0ucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmZpbHRlcmVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuZW1wdHkoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wdGlvblZhbHVlOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGVzY2FwZWRWYWx1ZSA9IG1vZHVsZS5lc2NhcGUudmFsdWUodmFsdWUpLFxuICAgICAgICAgICAgICAkb3B0aW9uICAgICAgPSAkaW5wdXQuZmluZCgnb3B0aW9uW3ZhbHVlPVwiJyArIG1vZHVsZS5lc2NhcGUuc3RyaW5nKGVzY2FwZWRWYWx1ZSkgKyAnXCJdJyksXG4gICAgICAgICAgICAgIGhhc09wdGlvbiAgICA9ICgkb3B0aW9uLmxlbmd0aCA+IDApXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZighaGFzT3B0aW9uIHx8ICEkb3B0aW9uLmhhc0NsYXNzKGNsYXNzTmFtZS5hZGRpdGlvbikpIHtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gdGVtcG9yYXJpbHkgZGlzY29ubmVjdCBvYnNlcnZlclxuICAgICAgICAgICAgaWYoc2VsZWN0T2JzZXJ2ZXIpIHtcbiAgICAgICAgICAgICAgc2VsZWN0T2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnVGVtcG9yYXJpbHkgZGlzY29ubmVjdGluZyBtdXRhdGlvbiBvYnNlcnZlcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJG9wdGlvbi5yZW1vdmUoKTtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyB1c2VyIGFkZGl0aW9uIGFzIGFuIDxvcHRpb24+JywgZXNjYXBlZFZhbHVlKTtcbiAgICAgICAgICAgIGlmKHNlbGVjdE9ic2VydmVyKSB7XG4gICAgICAgICAgICAgIHNlbGVjdE9ic2VydmVyLm9ic2VydmUoJGlucHV0WzBdLCB7XG4gICAgICAgICAgICAgICAgY2hpbGRMaXN0IDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBzdWJ0cmVlICAgOiB0cnVlXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbWVzc2FnZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbWVudS5jaGlsZHJlbihzZWxlY3Rvci5tZXNzYWdlKS5yZW1vdmUoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlYXJjaFdpZHRoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzZWFyY2guY3NzKCd3aWR0aCcsICcnKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlYXJjaFRlcm06IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0NsZWFyZWQgc2VhcmNoIHRlcm0nKTtcbiAgICAgICAgICAgICRzZWFyY2gudmFsKCcnKTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQuZmlsdGVyZWQoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVzZXJBZGRpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkaXRlbS5maWx0ZXIoc2VsZWN0b3IuYWRkaXRpb24pLnJlbW92ZSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2VsZWN0ZWQ6IGZ1bmN0aW9uKHZhbHVlLCAkc2VsZWN0ZWRJdGVtKSB7XG4gICAgICAgICAgICAkc2VsZWN0ZWRJdGVtID0gKHNldHRpbmdzLmFsbG93QWRkaXRpb25zKVxuICAgICAgICAgICAgICA/ICRzZWxlY3RlZEl0ZW0gfHwgbW9kdWxlLmdldC5pdGVtV2l0aEFkZGl0aW9ucyh2YWx1ZSlcbiAgICAgICAgICAgICAgOiAkc2VsZWN0ZWRJdGVtIHx8IG1vZHVsZS5nZXQuaXRlbSh2YWx1ZSlcbiAgICAgICAgICAgIDtcblxuICAgICAgICAgICAgaWYoISRzZWxlY3RlZEl0ZW0pIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkc2VsZWN0ZWRJdGVtXG4gICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICAgJHNlbGVjdGVkICAgICA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZFRleHQgID0gbW9kdWxlLmdldC5jaG9pY2VUZXh0KCRzZWxlY3RlZCksXG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZFZhbHVlID0gbW9kdWxlLmdldC5jaG9pY2VWYWx1ZSgkc2VsZWN0ZWQsIHNlbGVjdGVkVGV4dClcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgaWYobW9kdWxlLmlzLm11bHRpcGxlKCkpIHtcbiAgICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLnVzZUxhYmVscykge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnZhbHVlKHNlbGVjdGVkVmFsdWUsIHNlbGVjdGVkVGV4dCwgJHNlbGVjdGVkKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5sYWJlbChzZWxlY3RlZFZhbHVlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnZhbHVlKHNlbGVjdGVkVmFsdWUsIHNlbGVjdGVkVGV4dCwgJHNlbGVjdGVkKTtcbiAgICAgICAgICAgICAgICAgICAgaWYobW9kdWxlLmdldC5zZWxlY3Rpb25Db3VudCgpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC5wbGFjZWhvbGRlclRleHQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUuc2V0LnRleHQobW9kdWxlLmFkZC52YXJpYWJsZXMobWVzc2FnZS5jb3VudCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS52YWx1ZShzZWxlY3RlZFZhbHVlLCBzZWxlY3RlZFRleHQsICRzZWxlY3RlZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICRzZWxlY3RlZFxuICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5maWx0ZXJlZClcbiAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy51c2VMYWJlbHMpIHtcbiAgICAgICAgICAgICAgICAgICRzZWxlY3RlZC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlbGVjdGVkSXRlbTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkaXRlbS5yZW1vdmVDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKHJlbW92ZWRWYWx1ZSwgcmVtb3ZlZFRleHQsICRyZW1vdmVkSXRlbSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHZhbHVlcyA9IG1vZHVsZS5nZXQudmFsdWVzKCksXG4gICAgICAgICAgICAgIG5ld1ZhbHVlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZiggbW9kdWxlLmhhcy5zZWxlY3RJbnB1dCgpICkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnSW5wdXQgaXMgPHNlbGVjdD4gcmVtb3Zpbmcgc2VsZWN0ZWQgb3B0aW9uJywgcmVtb3ZlZFZhbHVlKTtcbiAgICAgICAgICAgICAgbmV3VmFsdWUgPSBtb2R1bGUucmVtb3ZlLmFycmF5VmFsdWUocmVtb3ZlZFZhbHVlLCB2YWx1ZXMpO1xuICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLm9wdGlvblZhbHVlKHJlbW92ZWRWYWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlbW92aW5nIGZyb20gZGVsaW1pdGVkIHZhbHVlcycsIHJlbW92ZWRWYWx1ZSk7XG4gICAgICAgICAgICAgIG5ld1ZhbHVlID0gbW9kdWxlLnJlbW92ZS5hcnJheVZhbHVlKHJlbW92ZWRWYWx1ZSwgdmFsdWVzKTtcbiAgICAgICAgICAgICAgbmV3VmFsdWUgPSBuZXdWYWx1ZS5qb2luKHNldHRpbmdzLmRlbGltaXRlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5maXJlT25Jbml0ID09PSBmYWxzZSAmJiBtb2R1bGUuaXMuaW5pdGlhbExvYWQoKSkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTm8gY2FsbGJhY2sgb24gaW5pdGlhbCBsb2FkJywgc2V0dGluZ3Mub25SZW1vdmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzLm9uUmVtb3ZlLmNhbGwoZWxlbWVudCwgcmVtb3ZlZFZhbHVlLCByZW1vdmVkVGV4dCwgJHJlbW92ZWRJdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5zZXQudmFsdWUobmV3VmFsdWUsIHJlbW92ZWRUZXh0LCAkcmVtb3ZlZEl0ZW0pO1xuICAgICAgICAgICAgbW9kdWxlLmNoZWNrLm1heFNlbGVjdGlvbnMoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFycmF5VmFsdWU6IGZ1bmN0aW9uKHJlbW92ZWRWYWx1ZSwgdmFsdWVzKSB7XG4gICAgICAgICAgICBpZiggISQuaXNBcnJheSh2YWx1ZXMpICkge1xuICAgICAgICAgICAgICB2YWx1ZXMgPSBbdmFsdWVzXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhbHVlcyA9ICQuZ3JlcCh2YWx1ZXMsIGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgICAgICAgICAgcmV0dXJuIChyZW1vdmVkVmFsdWUgIT0gdmFsdWUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3ZlZCB2YWx1ZSBmcm9tIGRlbGltaXRlZCBzdHJpbmcnLCByZW1vdmVkVmFsdWUsIHZhbHVlcyk7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWVzO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbGFiZWw6IGZ1bmN0aW9uKHZhbHVlLCBzaG91bGRBbmltYXRlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJGxhYmVscyAgICAgICA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5sYWJlbCksXG4gICAgICAgICAgICAgICRyZW1vdmVkTGFiZWwgPSAkbGFiZWxzLmZpbHRlcignW2RhdGEtJyArIG1ldGFkYXRhLnZhbHVlICsgJz1cIicgKyBtb2R1bGUuZXNjYXBlLnN0cmluZyh2YWx1ZSkgKydcIl0nKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlbW92aW5nIGxhYmVsJywgJHJlbW92ZWRMYWJlbCk7XG4gICAgICAgICAgICAkcmVtb3ZlZExhYmVsLnJlbW92ZSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYWN0aXZlTGFiZWxzOiBmdW5jdGlvbigkYWN0aXZlTGFiZWxzKSB7XG4gICAgICAgICAgICAkYWN0aXZlTGFiZWxzID0gJGFjdGl2ZUxhYmVscyB8fCAkbW9kdWxlLmZpbmQoc2VsZWN0b3IubGFiZWwpLmZpbHRlcignLicgKyBjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyBhY3RpdmUgbGFiZWwgc2VsZWN0aW9ucycsICRhY3RpdmVMYWJlbHMpO1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5sYWJlbHMoJGFjdGl2ZUxhYmVscyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsYWJlbHM6IGZ1bmN0aW9uKCRsYWJlbHMpIHtcbiAgICAgICAgICAgICRsYWJlbHMgPSAkbGFiZWxzIHx8ICRtb2R1bGUuZmluZChzZWxlY3Rvci5sYWJlbCk7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3ZpbmcgbGFiZWxzJywgJGxhYmVscyk7XG4gICAgICAgICAgICAkbGFiZWxzXG4gICAgICAgICAgICAgIC5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgICAkbGFiZWwgICAgICA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgICB2YWx1ZSAgICAgICA9ICRsYWJlbC5kYXRhKG1ldGFkYXRhLnZhbHVlKSxcbiAgICAgICAgICAgICAgICAgIHN0cmluZ1ZhbHVlID0gKHZhbHVlICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgID8gU3RyaW5nKHZhbHVlKVxuICAgICAgICAgICAgICAgICAgICA6IHZhbHVlLFxuICAgICAgICAgICAgICAgICAgaXNVc2VyVmFsdWUgPSBtb2R1bGUuaXMudXNlclZhbHVlKHN0cmluZ1ZhbHVlKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5vbkxhYmVsUmVtb3ZlLmNhbGwoJGxhYmVsLCB2YWx1ZSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0xhYmVsIHJlbW92ZSBjYWxsYmFjayBjYW5jZWxsZWQgcmVtb3ZhbCcpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLm1lc3NhZ2UoKTtcbiAgICAgICAgICAgICAgICBpZihpc1VzZXJWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS52YWx1ZShzdHJpbmdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmxhYmVsKHN0cmluZ1ZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAvLyBzZWxlY3RlZCB3aWxsIGFsc28gcmVtb3ZlIGxhYmVsXG4gICAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnNlbGVjdGVkKHN0cmluZ1ZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0YWJiYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiggbW9kdWxlLmlzLnNlYXJjaFNlbGVjdGlvbigpICkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NlYXJjaGFibGUgZHJvcGRvd24gaW5pdGlhbGl6ZWQnKTtcbiAgICAgICAgICAgICAgJHNlYXJjaFxuICAgICAgICAgICAgICAgIC5yZW1vdmVBdHRyKCd0YWJpbmRleCcpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgJG1lbnVcbiAgICAgICAgICAgICAgICAucmVtb3ZlQXR0cigndGFiaW5kZXgnKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaW1wbGUgc2VsZWN0aW9uIGRyb3Bkb3duIGluaXRpYWxpemVkJyk7XG4gICAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgICAucmVtb3ZlQXR0cigndGFiaW5kZXgnKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICRtZW51XG4gICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ3RhYmluZGV4JylcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgY2xlYXJhYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRpY29uLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5jbGVhcik7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGhhczoge1xuICAgICAgICAgIG1lbnVTZWFyY2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChtb2R1bGUuaGFzLnNlYXJjaCgpICYmICRzZWFyY2guY2xvc2VzdCgkbWVudSkubGVuZ3RoID4gMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWFyY2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICgkc2VhcmNoLmxlbmd0aCA+IDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2l6ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICgkc2l6ZXIubGVuZ3RoID4gMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWxlY3RJbnB1dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKCAkaW5wdXQuaXMoJ3NlbGVjdCcpICk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtaW5DaGFyYWN0ZXJzOiBmdW5jdGlvbihzZWFyY2hUZXJtKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5taW5DaGFyYWN0ZXJzKSB7XG4gICAgICAgICAgICAgIHNlYXJjaFRlcm0gPSAoc2VhcmNoVGVybSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgID8gU3RyaW5nKHNlYXJjaFRlcm0pXG4gICAgICAgICAgICAgICAgOiBTdHJpbmcobW9kdWxlLmdldC5xdWVyeSgpKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIHJldHVybiAoc2VhcmNoVGVybS5sZW5ndGggPj0gc2V0dGluZ3MubWluQ2hhcmFjdGVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZpcnN0TGV0dGVyOiBmdW5jdGlvbigkaXRlbSwgbGV0dGVyKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgICAgZmlyc3RMZXR0ZXJcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCEkaXRlbSB8fCAkaXRlbS5sZW5ndGggPT09IDAgfHwgdHlwZW9mIGxldHRlciAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGV4dCAgICAgICAgPSBtb2R1bGUuZ2V0LmNob2ljZVRleHQoJGl0ZW0sIGZhbHNlKTtcbiAgICAgICAgICAgIGxldHRlciAgICAgID0gbGV0dGVyLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICBmaXJzdExldHRlciA9IFN0cmluZyh0ZXh0KS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHJldHVybiAobGV0dGVyID09IGZpcnN0TGV0dGVyKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGlucHV0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoJGlucHV0Lmxlbmd0aCA+IDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaXRlbXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICgkaXRlbS5sZW5ndGggPiAwKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1lbnU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICgkbWVudS5sZW5ndGggPiAwKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1lc3NhZ2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICgkbWVudS5jaGlsZHJlbihzZWxlY3Rvci5tZXNzYWdlKS5sZW5ndGggIT09IDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbGFiZWw6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZXNjYXBlZFZhbHVlID0gbW9kdWxlLmVzY2FwZS52YWx1ZSh2YWx1ZSksXG4gICAgICAgICAgICAgICRsYWJlbHMgICAgICA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5sYWJlbClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgICAgZXNjYXBlZFZhbHVlID0gZXNjYXBlZFZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKCRsYWJlbHMuZmlsdGVyKCdbZGF0YS0nICsgbWV0YWRhdGEudmFsdWUgKyAnPVwiJyArIG1vZHVsZS5lc2NhcGUuc3RyaW5nKGVzY2FwZWRWYWx1ZSkgKydcIl0nKS5sZW5ndGggPiAwKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG1heFNlbGVjdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChzZXR0aW5ncy5tYXhTZWxlY3Rpb25zICYmIG1vZHVsZS5nZXQuc2VsZWN0aW9uQ291bnQoKSA+PSBzZXR0aW5ncy5tYXhTZWxlY3Rpb25zKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFsbFJlc3VsdHNGaWx0ZXJlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJG5vcm1hbFJlc3VsdHMgPSAkaXRlbS5ub3Qoc2VsZWN0b3IuYWRkaXRpb24pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICByZXR1cm4gKCRub3JtYWxSZXN1bHRzLmZpbHRlcihzZWxlY3Rvci51bnNlbGVjdGFibGUpLmxlbmd0aCA9PT0gJG5vcm1hbFJlc3VsdHMubGVuZ3RoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVzZXJTdWdnZXN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoJG1lbnUuY2hpbGRyZW4oc2VsZWN0b3IuYWRkaXRpb24pLmxlbmd0aCA+IDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcXVlcnk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChtb2R1bGUuZ2V0LnF1ZXJ5KCkgIT09ICcnKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIChzZXR0aW5ncy5pZ25vcmVDYXNlKVxuICAgICAgICAgICAgICA/IG1vZHVsZS5oYXMudmFsdWVJZ25vcmluZ0Nhc2UodmFsdWUpXG4gICAgICAgICAgICAgIDogbW9kdWxlLmhhcy52YWx1ZU1hdGNoaW5nQ2FzZSh2YWx1ZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlTWF0Y2hpbmdDYXNlOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHZhbHVlcyAgID0gbW9kdWxlLmdldC52YWx1ZXMoKSxcbiAgICAgICAgICAgICAgaGFzVmFsdWUgPSAkLmlzQXJyYXkodmFsdWVzKVxuICAgICAgICAgICAgICAgPyB2YWx1ZXMgJiYgKCQuaW5BcnJheSh2YWx1ZSwgdmFsdWVzKSAhPT0gLTEpXG4gICAgICAgICAgICAgICA6ICh2YWx1ZXMgPT0gdmFsdWUpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICByZXR1cm4gKGhhc1ZhbHVlKVxuICAgICAgICAgICAgICA/IHRydWVcbiAgICAgICAgICAgICAgOiBmYWxzZVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsdWVJZ25vcmluZ0Nhc2U6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdmFsdWVzICAgPSBtb2R1bGUuZ2V0LnZhbHVlcygpLFxuICAgICAgICAgICAgICBoYXNWYWx1ZSA9IGZhbHNlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZighJC5pc0FycmF5KHZhbHVlcykpIHtcbiAgICAgICAgICAgICAgdmFsdWVzID0gW3ZhbHVlc107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkLmVhY2godmFsdWVzLCBmdW5jdGlvbihpbmRleCwgZXhpc3RpbmdWYWx1ZSkge1xuICAgICAgICAgICAgICBpZihTdHJpbmcodmFsdWUpLnRvTG93ZXJDYXNlKCkgPT0gU3RyaW5nKGV4aXN0aW5nVmFsdWUpLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgICAgICAgICBoYXNWYWx1ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBoYXNWYWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXM6IHtcbiAgICAgICAgICBhY3RpdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhbmltYXRpbmdJbndhcmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRtZW51LnRyYW5zaXRpb24oJ2lzIGlud2FyZCcpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYW5pbWF0aW5nT3V0d2FyZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1lbnUudHJhbnNpdGlvbignaXMgb3V0d2FyZCcpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYnViYmxlZExhYmVsQ2xpY2s6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gJChldmVudC50YXJnZXQpLmlzKCdzZWxlY3QsIGlucHV0JykgJiYgJG1vZHVsZS5jbG9zZXN0KCdsYWJlbCcpLmxlbmd0aCA+IDA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBidWJibGVkSWNvbkNsaWNrOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgcmV0dXJuICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KCRpY29uKS5sZW5ndGggPiAwO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYWxyZWFkeVNldHVwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoJG1vZHVsZS5pcygnc2VsZWN0JykgJiYgJG1vZHVsZS5wYXJlbnQoc2VsZWN0b3IuZHJvcGRvd24pLmRhdGEobW9kdWxlTmFtZXNwYWNlKSAhPT0gdW5kZWZpbmVkICYmICRtb2R1bGUucHJldigpLmxlbmd0aCA9PT0gMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhbmltYXRpbmc6IGZ1bmN0aW9uKCRzdWJNZW51KSB7XG4gICAgICAgICAgICByZXR1cm4gKCRzdWJNZW51KVxuICAgICAgICAgICAgICA/ICRzdWJNZW51LnRyYW5zaXRpb24gJiYgJHN1Yk1lbnUudHJhbnNpdGlvbignaXMgYW5pbWF0aW5nJylcbiAgICAgICAgICAgICAgOiAkbWVudS50cmFuc2l0aW9uICAgICYmICRtZW51LnRyYW5zaXRpb24oJ2lzIGFuaW1hdGluZycpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsZWZ0d2FyZDogZnVuY3Rpb24oJHN1Yk1lbnUpIHtcbiAgICAgICAgICAgIHZhciAkc2VsZWN0ZWRNZW51ID0gJHN1Yk1lbnUgfHwgJG1lbnU7XG4gICAgICAgICAgICByZXR1cm4gJHNlbGVjdGVkTWVudS5oYXNDbGFzcyhjbGFzc05hbWUubGVmdHdhcmQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLmRpc2FibGVkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvY3VzZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChkb2N1bWVudC5hY3RpdmVFbGVtZW50ID09PSAkbW9kdWxlWzBdKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvY3VzZWRPblNlYXJjaDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09ICRzZWFyY2hbMF0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYWxsRmlsdGVyZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuKCAobW9kdWxlLmlzLm11bHRpcGxlKCkgfHwgbW9kdWxlLmhhcy5zZWFyY2goKSkgJiYgIShzZXR0aW5ncy5oaWRlQWRkaXRpb25zID09IGZhbHNlICYmIG1vZHVsZS5oYXMudXNlclN1Z2dlc3Rpb24oKSkgJiYgIW1vZHVsZS5oYXMubWVzc2FnZSgpICYmIG1vZHVsZS5oYXMuYWxsUmVzdWx0c0ZpbHRlcmVkKCkgKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhpZGRlbjogZnVuY3Rpb24oJHN1Yk1lbnUpIHtcbiAgICAgICAgICAgIHJldHVybiAhbW9kdWxlLmlzLnZpc2libGUoJHN1Yk1lbnUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5pdGlhbExvYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIGluaXRpYWxMb2FkO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5PYmplY3Q6IGZ1bmN0aW9uKG5lZWRsZSwgb2JqZWN0KSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZm91bmQgPSBmYWxzZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJC5lYWNoKG9iamVjdCwgZnVuY3Rpb24oaW5kZXgsIHByb3BlcnR5KSB7XG4gICAgICAgICAgICAgIGlmKHByb3BlcnR5ID09IG5lZWRsZSkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gZm91bmQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtdWx0aXBsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUubXVsdGlwbGUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVtb3RlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5hcGlTZXR0aW5ncyAmJiBtb2R1bGUuY2FuLnVzZUFQSSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2luZ2xlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAhbW9kdWxlLmlzLm11bHRpcGxlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZWxlY3RNdXRhdGlvbjogZnVuY3Rpb24obXV0YXRpb25zKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgc2VsZWN0Q2hhbmdlZCA9IGZhbHNlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkLmVhY2gobXV0YXRpb25zLCBmdW5jdGlvbihpbmRleCwgbXV0YXRpb24pIHtcbiAgICAgICAgICAgICAgaWYobXV0YXRpb24udGFyZ2V0ICYmICQobXV0YXRpb24udGFyZ2V0KS5pcygnc2VsZWN0JykpIHtcbiAgICAgICAgICAgICAgICBzZWxlY3RDaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gc2VsZWN0Q2hhbmdlZDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlYXJjaDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUuc2VhcmNoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlYXJjaFNlbGVjdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKCBtb2R1bGUuaGFzLnNlYXJjaCgpICYmICRzZWFyY2gucGFyZW50KHNlbGVjdG9yLmRyb3Bkb3duKS5sZW5ndGggPT09IDEgKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlbGVjdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUuc2VsZWN0aW9uKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVzZXJWYWx1ZTogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiAoJC5pbkFycmF5KHZhbHVlLCBtb2R1bGUuZ2V0LnVzZXJWYWx1ZXMoKSkgIT09IC0xKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVwd2FyZDogZnVuY3Rpb24oJG1lbnUpIHtcbiAgICAgICAgICAgIHZhciAkZWxlbWVudCA9ICRtZW51IHx8ICRtb2R1bGU7XG4gICAgICAgICAgICByZXR1cm4gJGVsZW1lbnQuaGFzQ2xhc3MoY2xhc3NOYW1lLnVwd2FyZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB2aXNpYmxlOiBmdW5jdGlvbigkc3ViTWVudSkge1xuICAgICAgICAgICAgcmV0dXJuICgkc3ViTWVudSlcbiAgICAgICAgICAgICAgPyAkc3ViTWVudS5oYXNDbGFzcyhjbGFzc05hbWUudmlzaWJsZSlcbiAgICAgICAgICAgICAgOiAkbWVudS5oYXNDbGFzcyhjbGFzc05hbWUudmlzaWJsZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZlcnRpY2FsbHlTY3JvbGxhYmxlQ29udGV4dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgb3ZlcmZsb3dZID0gKCRjb250ZXh0LmdldCgwKSAhPT0gd2luZG93KVxuICAgICAgICAgICAgICAgID8gJGNvbnRleHQuY3NzKCdvdmVyZmxvdy15JylcbiAgICAgICAgICAgICAgICA6IGZhbHNlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICByZXR1cm4gKG92ZXJmbG93WSA9PSAnYXV0bycgfHwgb3ZlcmZsb3dZID09ICdzY3JvbGwnKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhvcml6b250YWxseVNjcm9sbGFibGVDb250ZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBvdmVyZmxvd1ggPSAoJGNvbnRleHQuZ2V0KDApICE9PSB3aW5kb3cpXG4gICAgICAgICAgICAgICAgPyAkY29udGV4dC5jc3MoJ292ZXJmbG93LVgnKVxuICAgICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiAob3ZlcmZsb3dYID09ICdhdXRvJyB8fCBvdmVyZmxvd1ggPT0gJ3Njcm9sbCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjYW46IHtcbiAgICAgICAgICBhY3RpdmF0ZTogZnVuY3Rpb24oJGl0ZW0pIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnVzZUxhYmVscykge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCFtb2R1bGUuaGFzLm1heFNlbGVjdGlvbnMoKSkge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKG1vZHVsZS5oYXMubWF4U2VsZWN0aW9ucygpICYmICRpdGVtLmhhc0NsYXNzKGNsYXNzTmFtZS5hY3RpdmUpKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb3BlbkRvd253YXJkOiBmdW5jdGlvbigkc3ViTWVudSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICRjdXJyZW50TWVudSAgICA9ICRzdWJNZW51IHx8ICRtZW51LFxuICAgICAgICAgICAgICBjYW5PcGVuRG93bndhcmQgPSB0cnVlLFxuICAgICAgICAgICAgICBvblNjcmVlbiAgICAgICAgPSB7fSxcbiAgICAgICAgICAgICAgY2FsY3VsYXRpb25zXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkY3VycmVudE1lbnVcbiAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5sb2FkaW5nKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgY2FsY3VsYXRpb25zID0ge1xuICAgICAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0ICAgIDogKCRjb250ZXh0LmdldCgwKSA9PT0gd2luZG93KVxuICAgICAgICAgICAgICAgICAgPyB7IHRvcDogMCwgbGVmdDogMH1cbiAgICAgICAgICAgICAgICAgIDogJGNvbnRleHQub2Zmc2V0KCksXG4gICAgICAgICAgICAgICAgc2Nyb2xsVG9wIDogJGNvbnRleHQuc2Nyb2xsVG9wKCksXG4gICAgICAgICAgICAgICAgaGVpZ2h0ICAgIDogJGNvbnRleHQub3V0ZXJIZWlnaHQoKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBtZW51IDoge1xuICAgICAgICAgICAgICAgIG9mZnNldDogJGN1cnJlbnRNZW51Lm9mZnNldCgpLFxuICAgICAgICAgICAgICAgIGhlaWdodDogJGN1cnJlbnRNZW51Lm91dGVySGVpZ2h0KClcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5pcy52ZXJ0aWNhbGx5U2Nyb2xsYWJsZUNvbnRleHQoKSkge1xuICAgICAgICAgICAgICBjYWxjdWxhdGlvbnMubWVudS5vZmZzZXQudG9wICs9IGNhbGN1bGF0aW9ucy5jb250ZXh0LnNjcm9sbFRvcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG9uU2NyZWVuID0ge1xuICAgICAgICAgICAgICBhYm92ZSA6IChjYWxjdWxhdGlvbnMuY29udGV4dC5zY3JvbGxUb3ApIDw9IGNhbGN1bGF0aW9ucy5tZW51Lm9mZnNldC50b3AgLSBjYWxjdWxhdGlvbnMuY29udGV4dC5vZmZzZXQudG9wIC0gY2FsY3VsYXRpb25zLm1lbnUuaGVpZ2h0LFxuICAgICAgICAgICAgICBiZWxvdyA6IChjYWxjdWxhdGlvbnMuY29udGV4dC5zY3JvbGxUb3AgKyBjYWxjdWxhdGlvbnMuY29udGV4dC5oZWlnaHQpID49IGNhbGN1bGF0aW9ucy5tZW51Lm9mZnNldC50b3AgLSBjYWxjdWxhdGlvbnMuY29udGV4dC5vZmZzZXQudG9wICsgY2FsY3VsYXRpb25zLm1lbnUuaGVpZ2h0XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYob25TY3JlZW4uYmVsb3cpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0Ryb3Bkb3duIGNhbiBmaXQgaW4gY29udGV4dCBkb3dud2FyZCcsIG9uU2NyZWVuKTtcbiAgICAgICAgICAgICAgY2FuT3BlbkRvd253YXJkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoIW9uU2NyZWVuLmJlbG93ICYmICFvblNjcmVlbi5hYm92ZSkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRHJvcGRvd24gY2Fubm90IGZpdCBpbiBlaXRoZXIgZGlyZWN0aW9uLCBmYXZvcmluZyBkb3dud2FyZCcsIG9uU2NyZWVuKTtcbiAgICAgICAgICAgICAgY2FuT3BlbkRvd253YXJkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRHJvcGRvd24gY2Fubm90IGZpdCBiZWxvdywgb3BlbmluZyB1cHdhcmQnLCBvblNjcmVlbik7XG4gICAgICAgICAgICAgIGNhbk9wZW5Eb3dud2FyZCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGN1cnJlbnRNZW51LnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5sb2FkaW5nKTtcbiAgICAgICAgICAgIHJldHVybiBjYW5PcGVuRG93bndhcmQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvcGVuUmlnaHR3YXJkOiBmdW5jdGlvbigkc3ViTWVudSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICRjdXJyZW50TWVudSAgICAgPSAkc3ViTWVudSB8fCAkbWVudSxcbiAgICAgICAgICAgICAgY2FuT3BlblJpZ2h0d2FyZCA9IHRydWUsXG4gICAgICAgICAgICAgIGlzT2Zmc2NyZWVuUmlnaHQgPSBmYWxzZSxcbiAgICAgICAgICAgICAgY2FsY3VsYXRpb25zXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkY3VycmVudE1lbnVcbiAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5sb2FkaW5nKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgY2FsY3VsYXRpb25zID0ge1xuICAgICAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0ICAgICA6ICgkY29udGV4dC5nZXQoMCkgPT09IHdpbmRvdylcbiAgICAgICAgICAgICAgICAgID8geyB0b3A6IDAsIGxlZnQ6IDB9XG4gICAgICAgICAgICAgICAgICA6ICRjb250ZXh0Lm9mZnNldCgpLFxuICAgICAgICAgICAgICAgIHNjcm9sbExlZnQgOiAkY29udGV4dC5zY3JvbGxMZWZ0KCksXG4gICAgICAgICAgICAgICAgd2lkdGggICAgICA6ICRjb250ZXh0Lm91dGVyV2lkdGgoKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBtZW51OiB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0IDogJGN1cnJlbnRNZW51Lm9mZnNldCgpLFxuICAgICAgICAgICAgICAgIHdpZHRoICA6ICRjdXJyZW50TWVudS5vdXRlcldpZHRoKClcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5ob3Jpem9udGFsbHlTY3JvbGxhYmxlQ29udGV4dCgpKSB7XG4gICAgICAgICAgICAgIGNhbGN1bGF0aW9ucy5tZW51Lm9mZnNldC5sZWZ0ICs9IGNhbGN1bGF0aW9ucy5jb250ZXh0LnNjcm9sbExlZnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpc09mZnNjcmVlblJpZ2h0ID0gKGNhbGN1bGF0aW9ucy5tZW51Lm9mZnNldC5sZWZ0IC0gY2FsY3VsYXRpb25zLmNvbnRleHQub2Zmc2V0LmxlZnQgKyBjYWxjdWxhdGlvbnMubWVudS53aWR0aCA+PSBjYWxjdWxhdGlvbnMuY29udGV4dC5zY3JvbGxMZWZ0ICsgY2FsY3VsYXRpb25zLmNvbnRleHQud2lkdGgpO1xuICAgICAgICAgICAgaWYoaXNPZmZzY3JlZW5SaWdodCkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRHJvcGRvd24gY2Fubm90IGZpdCBpbiBjb250ZXh0IHJpZ2h0d2FyZCcsIGlzT2Zmc2NyZWVuUmlnaHQpO1xuICAgICAgICAgICAgICBjYW5PcGVuUmlnaHR3YXJkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkY3VycmVudE1lbnUucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmxvYWRpbmcpO1xuICAgICAgICAgICAgcmV0dXJuIGNhbk9wZW5SaWdodHdhcmQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjbGljazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKGhhc1RvdWNoIHx8IHNldHRpbmdzLm9uID09ICdjbGljaycpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZXh0ZW5kU2VsZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5hbGxvd0FkZGl0aW9ucyB8fCBzZXR0aW5ncy5hcGlTZXR0aW5ncztcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICFtb2R1bGUuaXMuZGlzYWJsZWQoKSAmJiAobW9kdWxlLmhhcy5pdGVtcygpIHx8IG1vZHVsZS5oYXMubWVzc2FnZSgpKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVzZUFQSTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJC5mbi5hcGkgIT09IHVuZGVmaW5lZDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgYW5pbWF0ZToge1xuICAgICAgICAgIHNob3c6IGZ1bmN0aW9uKGNhbGxiYWNrLCAkc3ViTWVudSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICRjdXJyZW50TWVudSA9ICRzdWJNZW51IHx8ICRtZW51LFxuICAgICAgICAgICAgICBzdGFydCA9ICgkc3ViTWVudSlcbiAgICAgICAgICAgICAgICA/IGZ1bmN0aW9uKCkge31cbiAgICAgICAgICAgICAgICA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmhpZGVTdWJNZW51cygpO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmhpZGVPdGhlcnMoKTtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5zZXQuYWN0aXZlKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdHJhbnNpdGlvblxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgY2FsbGJhY2sgPSAkLmlzRnVuY3Rpb24oY2FsbGJhY2spXG4gICAgICAgICAgICAgID8gY2FsbGJhY2tcbiAgICAgICAgICAgICAgOiBmdW5jdGlvbigpe31cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEb2luZyBtZW51IHNob3cgYW5pbWF0aW9uJywgJGN1cnJlbnRNZW51KTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQuZGlyZWN0aW9uKCRzdWJNZW51KTtcbiAgICAgICAgICAgIHRyYW5zaXRpb24gPSBtb2R1bGUuZ2V0LnRyYW5zaXRpb24oJHN1Yk1lbnUpO1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5zZWxlY3Rpb24oKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5zY3JvbGxQb3NpdGlvbihtb2R1bGUuZ2V0LnNlbGVjdGVkSXRlbSgpLCB0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCBtb2R1bGUuaXMuaGlkZGVuKCRjdXJyZW50TWVudSkgfHwgbW9kdWxlLmlzLmFuaW1hdGluZygkY3VycmVudE1lbnUpICkge1xuICAgICAgICAgICAgICBpZih0cmFuc2l0aW9uID09ICdub25lJykge1xuICAgICAgICAgICAgICAgIHN0YXJ0KCk7XG4gICAgICAgICAgICAgICAgJGN1cnJlbnRNZW51LnRyYW5zaXRpb24oJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKGVsZW1lbnQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoJC5mbi50cmFuc2l0aW9uICE9PSB1bmRlZmluZWQgJiYgJG1vZHVsZS50cmFuc2l0aW9uKCdpcyBzdXBwb3J0ZWQnKSkge1xuICAgICAgICAgICAgICAgICRjdXJyZW50TWVudVxuICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oe1xuICAgICAgICAgICAgICAgICAgICBhbmltYXRpb24gIDogdHJhbnNpdGlvbiArICcgaW4nLFxuICAgICAgICAgICAgICAgICAgICBkZWJ1ZyAgICAgIDogc2V0dGluZ3MuZGVidWcsXG4gICAgICAgICAgICAgICAgICAgIHZlcmJvc2UgICAgOiBzZXR0aW5ncy52ZXJib3NlLFxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiAgIDogc2V0dGluZ3MuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIHF1ZXVlICAgICAgOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBvblN0YXJ0ICAgIDogc3RhcnQsXG4gICAgICAgICAgICAgICAgICAgIG9uQ29tcGxldGUgOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3Iubm9UcmFuc2l0aW9uLCB0cmFuc2l0aW9uKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGlkZTogZnVuY3Rpb24oY2FsbGJhY2ssICRzdWJNZW51KSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJGN1cnJlbnRNZW51ID0gJHN1Yk1lbnUgfHwgJG1lbnUsXG4gICAgICAgICAgICAgIGR1cmF0aW9uID0gKCRzdWJNZW51KVxuICAgICAgICAgICAgICAgID8gKHNldHRpbmdzLmR1cmF0aW9uICogMC45KVxuICAgICAgICAgICAgICAgIDogc2V0dGluZ3MuZHVyYXRpb24sXG4gICAgICAgICAgICAgIHN0YXJ0ID0gKCRzdWJNZW51KVxuICAgICAgICAgICAgICAgID8gZnVuY3Rpb24oKSB7fVxuICAgICAgICAgICAgICAgIDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICBpZiggbW9kdWxlLmNhbi5jbGljaygpICkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUudW5iaW5kLmludGVudCgpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5hY3RpdmUoKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB0cmFuc2l0aW9uID0gbW9kdWxlLmdldC50cmFuc2l0aW9uKCRzdWJNZW51KVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgY2FsbGJhY2sgPSAkLmlzRnVuY3Rpb24oY2FsbGJhY2spXG4gICAgICAgICAgICAgID8gY2FsbGJhY2tcbiAgICAgICAgICAgICAgOiBmdW5jdGlvbigpe31cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCBtb2R1bGUuaXMudmlzaWJsZSgkY3VycmVudE1lbnUpIHx8IG1vZHVsZS5pcy5hbmltYXRpbmcoJGN1cnJlbnRNZW51KSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0RvaW5nIG1lbnUgaGlkZSBhbmltYXRpb24nLCAkY3VycmVudE1lbnUpO1xuXG4gICAgICAgICAgICAgIGlmKHRyYW5zaXRpb24gPT0gJ25vbmUnKSB7XG4gICAgICAgICAgICAgICAgc3RhcnQoKTtcbiAgICAgICAgICAgICAgICAkY3VycmVudE1lbnUudHJhbnNpdGlvbignaGlkZScpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwoZWxlbWVudCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZigkLmZuLnRyYW5zaXRpb24gIT09IHVuZGVmaW5lZCAmJiAkbW9kdWxlLnRyYW5zaXRpb24oJ2lzIHN1cHBvcnRlZCcpKSB7XG4gICAgICAgICAgICAgICAgJGN1cnJlbnRNZW51XG4gICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbih7XG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbiAgOiB0cmFuc2l0aW9uICsgJyBvdXQnLFxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiAgIDogc2V0dGluZ3MuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICAgIGRlYnVnICAgICAgOiBzZXR0aW5ncy5kZWJ1ZyxcbiAgICAgICAgICAgICAgICAgICAgdmVyYm9zZSAgICA6IHNldHRpbmdzLnZlcmJvc2UsXG4gICAgICAgICAgICAgICAgICAgIHF1ZXVlICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgb25TdGFydCAgICA6IHN0YXJ0LFxuICAgICAgICAgICAgICAgICAgICBvbkNvbXBsZXRlIDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLnRyYW5zaXRpb24pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGhpZGVBbmRDbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS5zZWFyY2hUZXJtKCk7XG4gICAgICAgICAgaWYoIG1vZHVsZS5oYXMubWF4U2VsZWN0aW9ucygpICkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihtb2R1bGUuaGFzLnNlYXJjaCgpKSB7XG4gICAgICAgICAgICBtb2R1bGUuaGlkZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5maWx0ZXJlZEl0ZW0oKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vZHVsZS5oaWRlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlbGF5OiB7XG4gICAgICAgICAgc2hvdzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRGVsYXlpbmcgc2hvdyBldmVudCB0byBlbnN1cmUgdXNlciBpbnRlbnQnKTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUudGltZXIpO1xuICAgICAgICAgICAgbW9kdWxlLnRpbWVyID0gc2V0VGltZW91dChtb2R1bGUuc2hvdywgc2V0dGluZ3MuZGVsYXkuc2hvdyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBoaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZWxheWluZyBoaWRlIGV2ZW50IHRvIGVuc3VyZSB1c2VyIGludGVudCcpO1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS50aW1lcik7XG4gICAgICAgICAgICBtb2R1bGUudGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5oaWRlLCBzZXR0aW5ncy5kZWxheS5oaWRlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXNjYXBlOiB7XG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgbXVsdGlwbGVWYWx1ZXMgPSAkLmlzQXJyYXkodmFsdWUpLFxuICAgICAgICAgICAgICBzdHJpbmdWYWx1ZSAgICA9ICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSxcbiAgICAgICAgICAgICAgaXNVbnBhcnNhYmxlICAgPSAoIXN0cmluZ1ZhbHVlICYmICFtdWx0aXBsZVZhbHVlcyksXG4gICAgICAgICAgICAgIGhhc1F1b3RlcyAgICAgID0gKHN0cmluZ1ZhbHVlICYmIHZhbHVlLnNlYXJjaChyZWdFeHAucXVvdGUpICE9PSAtMSksXG4gICAgICAgICAgICAgIHZhbHVlcyAgICAgICAgID0gW11cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKGlzVW5wYXJzYWJsZSB8fCAhaGFzUXVvdGVzKSB7XG4gICAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRW5jb2RpbmcgcXVvdGUgdmFsdWVzIGZvciB1c2UgaW4gc2VsZWN0JywgdmFsdWUpO1xuICAgICAgICAgICAgaWYobXVsdGlwbGVWYWx1ZXMpIHtcbiAgICAgICAgICAgICAgJC5lYWNoKHZhbHVlLCBmdW5jdGlvbihpbmRleCwgdmFsdWUpe1xuICAgICAgICAgICAgICAgIHZhbHVlcy5wdXNoKHZhbHVlLnJlcGxhY2UocmVnRXhwLnF1b3RlLCAnJnF1b3Q7JykpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5yZXBsYWNlKHJlZ0V4cC5xdW90ZSwgJyZxdW90OycpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc3RyaW5nOiBmdW5jdGlvbih0ZXh0KSB7XG4gICAgICAgICAgICB0ZXh0ID0gIFN0cmluZyh0ZXh0KTtcbiAgICAgICAgICAgIHJldHVybiB0ZXh0LnJlcGxhY2UocmVnRXhwLmVzY2FwZSwgJ1xcXFwkJicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXR0aW5nOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ2hhbmdpbmcgc2V0dGluZycsIG5hbWUsIHZhbHVlKTtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgc2V0dGluZ3MsIG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmKCQuaXNQbGFpbk9iamVjdChzZXR0aW5nc1tuYW1lXSkpIHtcbiAgICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgc2V0dGluZ3NbbmFtZV0sIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBzZXR0aW5nc1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5nc1tuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGludGVybmFsOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBtb2R1bGUsIG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG1vZHVsZVtuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGVbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBkZWJ1ZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZyA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5pbmZvLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB2ZXJib3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLnZlcmJvc2UgJiYgc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5pbmZvLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50KSB7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuZXJyb3IsIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBwZXJmb3JtYW5jZToge1xuICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGN1cnJlbnRUaW1lLFxuICAgICAgICAgICAgICBleGVjdXRpb25UaW1lLFxuICAgICAgICAgICAgICBwcmV2aW91c1RpbWVcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRUaW1lICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgcHJldmlvdXNUaW1lICA9IHRpbWUgfHwgY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUgPSBjdXJyZW50VGltZSAtIHByZXZpb3VzVGltZTtcbiAgICAgICAgICAgICAgdGltZSAgICAgICAgICA9IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICBwZXJmb3JtYW5jZS5wdXNoKHtcbiAgICAgICAgICAgICAgICAnTmFtZScgICAgICAgICAgIDogbWVzc2FnZVswXSxcbiAgICAgICAgICAgICAgICAnQXJndW1lbnRzJyAgICAgIDogW10uc2xpY2UuY2FsbChtZXNzYWdlLCAxKSB8fCAnJyxcbiAgICAgICAgICAgICAgICAnRWxlbWVudCcgICAgICAgIDogZWxlbWVudCxcbiAgICAgICAgICAgICAgICAnRXhlY3V0aW9uIFRpbWUnIDogZXhlY3V0aW9uVGltZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyID0gc2V0VGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UuZGlzcGxheSwgNTAwKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpc3BsYXk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHRpdGxlID0gc2V0dGluZ3MubmFtZSArICc6JyxcbiAgICAgICAgICAgICAgdG90YWxUaW1lID0gMFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgdGltZSA9IGZhbHNlO1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgIHRvdGFsVGltZSArPSBkYXRhWydFeGVjdXRpb24gVGltZSddO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aXRsZSArPSAnICcgKyB0b3RhbFRpbWUgKyAnbXMnO1xuICAgICAgICAgICAgaWYobW9kdWxlU2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgdGl0bGUgKz0gJyBcXCcnICsgbW9kdWxlU2VsZWN0b3IgKyAnXFwnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCAoY29uc29sZS5ncm91cCAhPT0gdW5kZWZpbmVkIHx8IGNvbnNvbGUudGFibGUgIT09IHVuZGVmaW5lZCkgJiYgcGVyZm9ybWFuY2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKHRpdGxlKTtcbiAgICAgICAgICAgICAgaWYoY29uc29sZS50YWJsZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUudGFibGUocGVyZm9ybWFuY2UpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQuZWFjaChwZXJmb3JtYW5jZSwgZnVuY3Rpb24oaW5kZXgsIGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGFbJ05hbWUnXSArICc6ICcgKyBkYXRhWydFeGVjdXRpb24gVGltZSddKydtcycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBFbmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBlcmZvcm1hbmNlID0gW107XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnZva2U6IGZ1bmN0aW9uKHF1ZXJ5LCBwYXNzZWRBcmd1bWVudHMsIGNvbnRleHQpIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIG9iamVjdCA9IGluc3RhbmNlLFxuICAgICAgICAgICAgbWF4RGVwdGgsXG4gICAgICAgICAgICBmb3VuZCxcbiAgICAgICAgICAgIHJlc3BvbnNlXG4gICAgICAgICAgO1xuICAgICAgICAgIHBhc3NlZEFyZ3VtZW50cyA9IHBhc3NlZEFyZ3VtZW50cyB8fCBxdWVyeUFyZ3VtZW50cztcbiAgICAgICAgICBjb250ZXh0ICAgICAgICAgPSBlbGVtZW50ICAgICAgICAgfHwgY29udGV4dDtcbiAgICAgICAgICBpZih0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycgJiYgb2JqZWN0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHF1ZXJ5ICAgID0gcXVlcnkuc3BsaXQoL1tcXC4gXS8pO1xuICAgICAgICAgICAgbWF4RGVwdGggPSBxdWVyeS5sZW5ndGggLSAxO1xuICAgICAgICAgICAgJC5lYWNoKHF1ZXJ5LCBmdW5jdGlvbihkZXB0aCwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgdmFyIGNhbWVsQ2FzZVZhbHVlID0gKGRlcHRoICE9IG1heERlcHRoKVxuICAgICAgICAgICAgICAgID8gdmFsdWUgKyBxdWVyeVtkZXB0aCArIDFdLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcXVlcnlbZGVwdGggKyAxXS5zbGljZSgxKVxuICAgICAgICAgICAgICAgIDogcXVlcnlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICkgJiYgKGRlcHRoICE9IG1heERlcHRoKSApIHtcbiAgICAgICAgICAgICAgICBvYmplY3QgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoIG9iamVjdFtjYW1lbENhc2VWYWx1ZV0gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IG9iamVjdFtjYW1lbENhc2VWYWx1ZV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W3ZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbdmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbdmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IubWV0aG9kLCBxdWVyeSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCAkLmlzRnVuY3Rpb24oIGZvdW5kICkgKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGZvdW5kLmFwcGx5KGNvbnRleHQsIHBhc3NlZEFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoZm91bmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoJC5pc0FycmF5KHJldHVybmVkVmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlLnB1c2gocmVzcG9uc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IFtyZXR1cm5lZFZhbHVlLCByZXNwb25zZV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYocmVzcG9uc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IHJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZm91bmQ7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGlmKG1ldGhvZEludm9rZWQpIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICAgIH1cbiAgICAgICAgbW9kdWxlLmludm9rZShxdWVyeSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGluc3RhbmNlLmludm9rZSgnZGVzdHJveScpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICB9XG4gICAgfSlcbiAgO1xuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6ICRhbGxNb2R1bGVzXG4gIDtcbn07XG5cbiQuZm4uZHJvcGRvd24uc2V0dGluZ3MgPSB7XG5cbiAgc2lsZW50ICAgICAgICAgICAgICAgICA6IGZhbHNlLFxuICBkZWJ1ZyAgICAgICAgICAgICAgICAgIDogZmFsc2UsXG4gIHZlcmJvc2UgICAgICAgICAgICAgICAgOiBmYWxzZSxcbiAgcGVyZm9ybWFuY2UgICAgICAgICAgICA6IHRydWUsXG5cbiAgb24gICAgICAgICAgICAgICAgICAgICA6ICdjbGljaycsICAgIC8vIHdoYXQgZXZlbnQgc2hvdWxkIHNob3cgbWVudSBhY3Rpb24gb24gaXRlbSBzZWxlY3Rpb25cbiAgYWN0aW9uICAgICAgICAgICAgICAgICA6ICdhY3RpdmF0ZScsIC8vIGFjdGlvbiBvbiBpdGVtIHNlbGVjdGlvbiAobm90aGluZywgYWN0aXZhdGUsIHNlbGVjdCwgY29tYm8sIGhpZGUsIGZ1bmN0aW9uKCl7fSlcblxuICB2YWx1ZXMgICAgICAgICAgICAgICAgIDogZmFsc2UsICAgICAgLy8gc3BlY2lmeSB2YWx1ZXMgdG8gdXNlIGZvciBkcm9wZG93blxuXG4gIGNsZWFyYWJsZSAgICAgICAgICAgICAgOiBmYWxzZSwgICAgICAvLyB3aGV0aGVyIHRoZSB2YWx1ZSBvZiB0aGUgZHJvcGRvd24gY2FuIGJlIGNsZWFyZWRcblxuICBhcGlTZXR0aW5ncyAgICAgICAgICAgIDogZmFsc2UsXG4gIHNlbGVjdE9uS2V5ZG93biAgICAgICAgOiB0cnVlLCAgICAgICAvLyBXaGV0aGVyIHNlbGVjdGlvbiBzaG91bGQgb2NjdXIgYXV0b21hdGljYWxseSB3aGVuIGtleWJvYXJkIHNob3J0Y3V0cyB1c2VkXG4gIG1pbkNoYXJhY3RlcnMgICAgICAgICAgOiAwLCAgICAgICAgICAvLyBNaW5pbXVtIGNoYXJhY3RlcnMgcmVxdWlyZWQgdG8gdHJpZ2dlciBBUEkgY2FsbFxuXG4gIGZpbHRlclJlbW90ZURhdGEgICAgICAgOiBmYWxzZSwgICAgICAvLyBXaGV0aGVyIEFQSSByZXN1bHRzIHNob3VsZCBiZSBmaWx0ZXJlZCBhZnRlciBiZWluZyByZXR1cm5lZCBmb3IgcXVlcnkgdGVybVxuICBzYXZlUmVtb3RlRGF0YSAgICAgICAgIDogdHJ1ZSwgICAgICAgLy8gV2hldGhlciByZW1vdGUgbmFtZS92YWx1ZSBwYWlycyBzaG91bGQgYmUgc3RvcmVkIGluIHNlc3Npb25TdG9yYWdlIHRvIGFsbG93IHJlbW90ZSBkYXRhIHRvIGJlIHJlc3RvcmVkIG9uIHBhZ2UgcmVmcmVzaFxuXG4gIHRocm90dGxlICAgICAgICAgICAgICAgOiAyMDAsICAgICAgICAvLyBIb3cgbG9uZyB0byB3YWl0IGFmdGVyIGxhc3QgdXNlciBpbnB1dCB0byBzZWFyY2ggcmVtb3RlbHlcblxuICBjb250ZXh0ICAgICAgICAgICAgICAgIDogd2luZG93LCAgICAgLy8gQ29udGV4dCB0byB1c2Ugd2hlbiBkZXRlcm1pbmluZyBpZiBvbiBzY3JlZW5cbiAgZGlyZWN0aW9uICAgICAgICAgICAgICA6ICdhdXRvJywgICAgIC8vIFdoZXRoZXIgZHJvcGRvd24gc2hvdWxkIGFsd2F5cyBvcGVuIGluIG9uZSBkaXJlY3Rpb25cbiAga2VlcE9uU2NyZWVuICAgICAgICAgICA6IHRydWUsICAgICAgIC8vIFdoZXRoZXIgZHJvcGRvd24gc2hvdWxkIGNoZWNrIHdoZXRoZXIgaXQgaXMgb24gc2NyZWVuIGJlZm9yZSBzaG93aW5nXG5cbiAgbWF0Y2ggICAgICAgICAgICAgICAgICA6ICdib3RoJywgICAgIC8vIHdoYXQgdG8gbWF0Y2ggYWdhaW5zdCB3aXRoIHNlYXJjaCBzZWxlY3Rpb24gKGJvdGgsIHRleHQsIG9yIGxhYmVsKVxuICBmdWxsVGV4dFNlYXJjaCAgICAgICAgIDogZmFsc2UsICAgICAgLy8gc2VhcmNoIGFueXdoZXJlIGluIHZhbHVlIChzZXQgdG8gJ2V4YWN0JyB0byByZXF1aXJlIGV4YWN0IG1hdGNoZXMpXG5cbiAgcGxhY2Vob2xkZXIgICAgICAgICAgICA6ICdhdXRvJywgICAgIC8vIHdoZXRoZXIgdG8gY29udmVydCBibGFuayA8c2VsZWN0PiB2YWx1ZXMgdG8gcGxhY2Vob2xkZXIgdGV4dFxuICBwcmVzZXJ2ZUhUTUwgICAgICAgICAgIDogdHJ1ZSwgICAgICAgLy8gcHJlc2VydmUgaHRtbCB3aGVuIHNlbGVjdGluZyB2YWx1ZVxuICBzb3J0U2VsZWN0ICAgICAgICAgICAgIDogZmFsc2UsICAgICAgLy8gc29ydCBzZWxlY3Rpb24gb24gaW5pdFxuXG4gIGZvcmNlU2VsZWN0aW9uICAgICAgICAgOiB0cnVlLCAgICAgICAvLyBmb3JjZSBhIGNob2ljZSBvbiBibHVyIHdpdGggc2VhcmNoIHNlbGVjdGlvblxuXG4gIGFsbG93QWRkaXRpb25zICAgICAgICAgOiBmYWxzZSwgICAgICAvLyB3aGV0aGVyIG11bHRpcGxlIHNlbGVjdCBzaG91bGQgYWxsb3cgdXNlciBhZGRlZCB2YWx1ZXNcbiAgaWdub3JlQ2FzZSAgICAgICAgICAgICA6IGZhbHNlLCAgICAgICAvLyB3aGV0aGVyIHRvIGNvbnNpZGVyIHZhbHVlcyBub3QgbWF0Y2hpbmcgaW4gY2FzZSB0byBiZSB0aGUgc2FtZVxuICBoaWRlQWRkaXRpb25zICAgICAgICAgIDogdHJ1ZSwgICAgICAgLy8gd2hldGhlciBvciBub3QgdG8gaGlkZSBzcGVjaWFsIG1lc3NhZ2UgcHJvbXB0aW5nIGEgdXNlciB0aGV5IGNhbiBlbnRlciBhIHZhbHVlXG5cbiAgbWF4U2VsZWN0aW9ucyAgICAgICAgICA6IGZhbHNlLCAgICAgIC8vIFdoZW4gc2V0IHRvIGEgbnVtYmVyIGxpbWl0cyB0aGUgbnVtYmVyIG9mIHNlbGVjdGlvbnMgdG8gdGhpcyBjb3VudFxuICB1c2VMYWJlbHMgICAgICAgICAgICAgIDogdHJ1ZSwgICAgICAgLy8gd2hldGhlciBtdWx0aXBsZSBzZWxlY3Qgc2hvdWxkIGZpbHRlciBjdXJyZW50bHkgYWN0aXZlIHNlbGVjdGlvbnMgZnJvbSBjaG9pY2VzXG4gIGRlbGltaXRlciAgICAgICAgICAgICAgOiAnLCcsICAgICAgICAvLyB3aGVuIG11bHRpc2VsZWN0IHVzZXMgbm9ybWFsIDxpbnB1dD4gdGhlIHZhbHVlcyB3aWxsIGJlIGRlbGltaXRlZCB3aXRoIHRoaXMgY2hhcmFjdGVyXG5cbiAgc2hvd09uRm9jdXMgICAgICAgICAgICA6IHRydWUsICAgICAgIC8vIHNob3cgbWVudSBvbiBmb2N1c1xuICBhbGxvd1Jlc2VsZWN0aW9uICAgICAgIDogZmFsc2UsICAgICAgLy8gd2hldGhlciBjdXJyZW50IHZhbHVlIHNob3VsZCB0cmlnZ2VyIGNhbGxiYWNrcyB3aGVuIHJlc2VsZWN0ZWRcbiAgYWxsb3dUYWIgICAgICAgICAgICAgICA6IHRydWUsICAgICAgIC8vIGFkZCB0YWJpbmRleCB0byBlbGVtZW50XG4gIGFsbG93Q2F0ZWdvcnlTZWxlY3Rpb24gOiBmYWxzZSwgICAgICAvLyBhbGxvdyBlbGVtZW50cyB3aXRoIHN1Yi1tZW51cyB0byBiZSBzZWxlY3RlZFxuXG4gIGZpcmVPbkluaXQgICAgICAgICAgICAgOiBmYWxzZSwgICAgICAvLyBXaGV0aGVyIGNhbGxiYWNrcyBzaG91bGQgZmlyZSB3aGVuIGluaXRpYWxpemluZyBkcm9wZG93biB2YWx1ZXNcblxuICB0cmFuc2l0aW9uICAgICAgICAgICAgIDogJ2F1dG8nLCAgICAgLy8gYXV0byB0cmFuc2l0aW9uIHdpbGwgc2xpZGUgZG93biBvciB1cCBiYXNlZCBvbiBkaXJlY3Rpb25cbiAgZHVyYXRpb24gICAgICAgICAgICAgICA6IDIwMCwgICAgICAgIC8vIGR1cmF0aW9uIG9mIHRyYW5zaXRpb25cblxuICBnbHlwaFdpZHRoICAgICAgICAgICAgIDogMS4wMzcsICAgICAgLy8gd2lkZXN0IGdseXBoIHdpZHRoIGluIGVtIChXIGlzIDEuMDM3IGVtKSB1c2VkIHRvIGNhbGN1bGF0ZSBtdWx0aXNlbGVjdCBpbnB1dCB3aWR0aFxuXG4gIC8vIGxhYmVsIHNldHRpbmdzIG9uIG11bHRpLXNlbGVjdFxuICBsYWJlbDoge1xuICAgIHRyYW5zaXRpb24gOiAnc2NhbGUnLFxuICAgIGR1cmF0aW9uICAgOiAyMDAsXG4gICAgdmFyaWF0aW9uICA6IGZhbHNlXG4gIH0sXG5cbiAgLy8gZGVsYXkgYmVmb3JlIGV2ZW50XG4gIGRlbGF5IDoge1xuICAgIGhpZGUgICA6IDMwMCxcbiAgICBzaG93ICAgOiAyMDAsXG4gICAgc2VhcmNoIDogMjAsXG4gICAgdG91Y2ggIDogNTBcbiAgfSxcblxuICAvKiBDYWxsYmFja3MgKi9cbiAgb25DaGFuZ2UgICAgICA6IGZ1bmN0aW9uKHZhbHVlLCB0ZXh0LCAkc2VsZWN0ZWQpe30sXG4gIG9uQWRkICAgICAgICAgOiBmdW5jdGlvbih2YWx1ZSwgdGV4dCwgJHNlbGVjdGVkKXt9LFxuICBvblJlbW92ZSAgICAgIDogZnVuY3Rpb24odmFsdWUsIHRleHQsICRzZWxlY3RlZCl7fSxcblxuICBvbkxhYmVsU2VsZWN0IDogZnVuY3Rpb24oJHNlbGVjdGVkTGFiZWxzKXt9LFxuICBvbkxhYmVsQ3JlYXRlIDogZnVuY3Rpb24odmFsdWUsIHRleHQpIHsgcmV0dXJuICQodGhpcyk7IH0sXG4gIG9uTGFiZWxSZW1vdmUgOiBmdW5jdGlvbih2YWx1ZSkgeyByZXR1cm4gdHJ1ZTsgfSxcbiAgb25Ob1Jlc3VsdHMgICA6IGZ1bmN0aW9uKHNlYXJjaFRlcm0pIHsgcmV0dXJuIHRydWU7IH0sXG4gIG9uU2hvdyAgICAgICAgOiBmdW5jdGlvbigpe30sXG4gIG9uSGlkZSAgICAgICAgOiBmdW5jdGlvbigpe30sXG5cbiAgLyogQ29tcG9uZW50ICovXG4gIG5hbWUgICAgICAgICAgIDogJ0Ryb3Bkb3duJyxcbiAgbmFtZXNwYWNlICAgICAgOiAnZHJvcGRvd24nLFxuXG4gIG1lc3NhZ2U6IHtcbiAgICBhZGRSZXN1bHQgICAgIDogJ0FkZCA8Yj57dGVybX08L2I+JyxcbiAgICBjb3VudCAgICAgICAgIDogJ3tjb3VudH0gc2VsZWN0ZWQnLFxuICAgIG1heFNlbGVjdGlvbnMgOiAnTWF4IHttYXhDb3VudH0gc2VsZWN0aW9ucycsXG4gICAgbm9SZXN1bHRzICAgICA6ICdObyByZXN1bHRzIGZvdW5kLicsXG4gICAgc2VydmVyRXJyb3IgICA6ICdUaGVyZSB3YXMgYW4gZXJyb3IgY29udGFjdGluZyB0aGUgc2VydmVyJ1xuICB9LFxuXG4gIGVycm9yIDoge1xuICAgIGFjdGlvbiAgICAgICAgICA6ICdZb3UgY2FsbGVkIGEgZHJvcGRvd24gYWN0aW9uIHRoYXQgd2FzIG5vdCBkZWZpbmVkJyxcbiAgICBhbHJlYWR5U2V0dXAgICAgOiAnT25jZSBhIHNlbGVjdCBoYXMgYmVlbiBpbml0aWFsaXplZCBiZWhhdmlvcnMgbXVzdCBiZSBjYWxsZWQgb24gdGhlIGNyZWF0ZWQgdWkgZHJvcGRvd24nLFxuICAgIGxhYmVscyAgICAgICAgICA6ICdBbGxvd2luZyB1c2VyIGFkZGl0aW9ucyBjdXJyZW50bHkgcmVxdWlyZXMgdGhlIHVzZSBvZiBsYWJlbHMuJyxcbiAgICBtaXNzaW5nTXVsdGlwbGUgOiAnPHNlbGVjdD4gcmVxdWlyZXMgbXVsdGlwbGUgcHJvcGVydHkgdG8gYmUgc2V0IHRvIGNvcnJlY3RseSBwcmVzZXJ2ZSBtdWx0aXBsZSB2YWx1ZXMnLFxuICAgIG1ldGhvZCAgICAgICAgICA6ICdUaGUgbWV0aG9kIHlvdSBjYWxsZWQgaXMgbm90IGRlZmluZWQuJyxcbiAgICBub0FQSSAgICAgICAgICAgOiAnVGhlIEFQSSBtb2R1bGUgaXMgcmVxdWlyZWQgdG8gbG9hZCByZXNvdXJjZXMgcmVtb3RlbHknLFxuICAgIG5vU3RvcmFnZSAgICAgICA6ICdTYXZpbmcgcmVtb3RlIGRhdGEgcmVxdWlyZXMgc2Vzc2lvbiBzdG9yYWdlJyxcbiAgICBub1RyYW5zaXRpb24gICAgOiAnVGhpcyBtb2R1bGUgcmVxdWlyZXMgdWkgdHJhbnNpdGlvbnMgPGh0dHBzOi8vZ2l0aHViLmNvbS9TZW1hbnRpYy1PcmcvVUktVHJhbnNpdGlvbj4nXG4gIH0sXG5cbiAgcmVnRXhwIDoge1xuICAgIGVzY2FwZSAgIDogL1stW1xcXXt9KCkqKz8uLFxcXFxeJHwjXFxzXS9nLFxuICAgIHF1b3RlICAgIDogL1wiL2dcbiAgfSxcblxuICBtZXRhZGF0YSA6IHtcbiAgICBkZWZhdWx0VGV4dCAgICAgOiAnZGVmYXVsdFRleHQnLFxuICAgIGRlZmF1bHRWYWx1ZSAgICA6ICdkZWZhdWx0VmFsdWUnLFxuICAgIHBsYWNlaG9sZGVyVGV4dCA6ICdwbGFjZWhvbGRlcicsXG4gICAgdGV4dCAgICAgICAgICAgIDogJ3RleHQnLFxuICAgIHZhbHVlICAgICAgICAgICA6ICd2YWx1ZSdcbiAgfSxcblxuICAvLyBwcm9wZXJ0eSBuYW1lcyBmb3IgcmVtb3RlIHF1ZXJ5XG4gIGZpZWxkczoge1xuICAgIHJlbW90ZVZhbHVlcyA6ICdyZXN1bHRzJywgIC8vIGdyb3VwaW5nIGZvciBhcGkgcmVzdWx0c1xuICAgIHZhbHVlcyAgICAgICA6ICd2YWx1ZXMnLCAgIC8vIGdyb3VwaW5nIGZvciBhbGwgZHJvcGRvd24gdmFsdWVzXG4gICAgZGlzYWJsZWQgICAgIDogJ2Rpc2FibGVkJywgLy8gd2hldGhlciB2YWx1ZSBzaG91bGQgYmUgZGlzYWJsZWRcbiAgICBuYW1lICAgICAgICAgOiAnbmFtZScsICAgICAvLyBkaXNwbGF5ZWQgZHJvcGRvd24gdGV4dFxuICAgIHZhbHVlICAgICAgICA6ICd2YWx1ZScsICAgIC8vIGFjdHVhbCBkcm9wZG93biB2YWx1ZVxuICAgIHRleHQgICAgICAgICA6ICd0ZXh0JyAgICAgIC8vIGRpc3BsYXllZCB0ZXh0IHdoZW4gc2VsZWN0ZWRcbiAgfSxcblxuICBrZXlzIDoge1xuICAgIGJhY2tzcGFjZSAgOiA4LFxuICAgIGRlbGltaXRlciAgOiAxODgsIC8vIGNvbW1hXG4gICAgZGVsZXRlS2V5ICA6IDQ2LFxuICAgIGVudGVyICAgICAgOiAxMyxcbiAgICBlc2NhcGUgICAgIDogMjcsXG4gICAgcGFnZVVwICAgICA6IDMzLFxuICAgIHBhZ2VEb3duICAgOiAzNCxcbiAgICBsZWZ0QXJyb3cgIDogMzcsXG4gICAgdXBBcnJvdyAgICA6IDM4LFxuICAgIHJpZ2h0QXJyb3cgOiAzOSxcbiAgICBkb3duQXJyb3cgIDogNDBcbiAgfSxcblxuICBzZWxlY3RvciA6IHtcbiAgICBhZGRpdGlvbiAgICAgOiAnLmFkZGl0aW9uJyxcbiAgICBkcm9wZG93biAgICAgOiAnLnVpLmRyb3Bkb3duJyxcbiAgICBoaWRkZW4gICAgICAgOiAnLmhpZGRlbicsXG4gICAgaWNvbiAgICAgICAgIDogJz4gLmRyb3Bkb3duLmljb24nLFxuICAgIGlucHV0ICAgICAgICA6ICc+IGlucHV0W3R5cGU9XCJoaWRkZW5cIl0sID4gc2VsZWN0JyxcbiAgICBpdGVtICAgICAgICAgOiAnLml0ZW0nLFxuICAgIGxhYmVsICAgICAgICA6ICc+IC5sYWJlbCcsXG4gICAgcmVtb3ZlICAgICAgIDogJz4gLmxhYmVsID4gLmRlbGV0ZS5pY29uJyxcbiAgICBzaWJsaW5nTGFiZWwgOiAnLmxhYmVsJyxcbiAgICBtZW51ICAgICAgICAgOiAnLm1lbnUnLFxuICAgIG1lc3NhZ2UgICAgICA6ICcubWVzc2FnZScsXG4gICAgbWVudUljb24gICAgIDogJy5kcm9wZG93bi5pY29uJyxcbiAgICBzZWFyY2ggICAgICAgOiAnaW5wdXQuc2VhcmNoLCAubWVudSA+IC5zZWFyY2ggPiBpbnB1dCwgLm1lbnUgaW5wdXQuc2VhcmNoJyxcbiAgICBzaXplciAgICAgICAgOiAnPiBpbnB1dC5zaXplcicsXG4gICAgdGV4dCAgICAgICAgIDogJz4gLnRleHQ6bm90KC5pY29uKScsXG4gICAgdW5zZWxlY3RhYmxlIDogJy5kaXNhYmxlZCwgLmZpbHRlcmVkJ1xuICB9LFxuXG4gIGNsYXNzTmFtZSA6IHtcbiAgICBhY3RpdmUgICAgICA6ICdhY3RpdmUnLFxuICAgIGFkZGl0aW9uICAgIDogJ2FkZGl0aW9uJyxcbiAgICBhbmltYXRpbmcgICA6ICdhbmltYXRpbmcnLFxuICAgIGNsZWFyICAgICAgIDogJ2NsZWFyJyxcbiAgICBkaXNhYmxlZCAgICA6ICdkaXNhYmxlZCcsXG4gICAgZW1wdHkgICAgICAgOiAnZW1wdHknLFxuICAgIGRyb3Bkb3duICAgIDogJ3VpIGRyb3Bkb3duJyxcbiAgICBmaWx0ZXJlZCAgICA6ICdmaWx0ZXJlZCcsXG4gICAgaGlkZGVuICAgICAgOiAnaGlkZGVuIHRyYW5zaXRpb24nLFxuICAgIGl0ZW0gICAgICAgIDogJ2l0ZW0nLFxuICAgIGxhYmVsICAgICAgIDogJ3VpIGxhYmVsJyxcbiAgICBsb2FkaW5nICAgICA6ICdsb2FkaW5nJyxcbiAgICBtZW51ICAgICAgICA6ICdtZW51JyxcbiAgICBtZXNzYWdlICAgICA6ICdtZXNzYWdlJyxcbiAgICBtdWx0aXBsZSAgICA6ICdtdWx0aXBsZScsXG4gICAgcGxhY2Vob2xkZXIgOiAnZGVmYXVsdCcsXG4gICAgc2l6ZXIgICAgICAgOiAnc2l6ZXInLFxuICAgIHNlYXJjaCAgICAgIDogJ3NlYXJjaCcsXG4gICAgc2VsZWN0ZWQgICAgOiAnc2VsZWN0ZWQnLFxuICAgIHNlbGVjdGlvbiAgIDogJ3NlbGVjdGlvbicsXG4gICAgdXB3YXJkICAgICAgOiAndXB3YXJkJyxcbiAgICBsZWZ0d2FyZCAgICA6ICdsZWZ0JyxcbiAgICB2aXNpYmxlICAgICA6ICd2aXNpYmxlJ1xuICB9XG5cbn07XG5cbi8qIFRlbXBsYXRlcyAqL1xuJC5mbi5kcm9wZG93bi5zZXR0aW5ncy50ZW1wbGF0ZXMgPSB7XG5cbiAgLy8gZ2VuZXJhdGVzIGRyb3Bkb3duIGZyb20gc2VsZWN0IHZhbHVlc1xuICBkcm9wZG93bjogZnVuY3Rpb24oc2VsZWN0KSB7XG4gICAgdmFyXG4gICAgICBwbGFjZWhvbGRlciA9IHNlbGVjdC5wbGFjZWhvbGRlciB8fCBmYWxzZSxcbiAgICAgIHZhbHVlcyAgICAgID0gc2VsZWN0LnZhbHVlcyB8fCB7fSxcbiAgICAgIGh0bWwgICAgICAgID0gJydcbiAgICA7XG4gICAgaHRtbCArPSAgJzxpIGNsYXNzPVwiZHJvcGRvd24gaWNvblwiPjwvaT4nO1xuICAgIGlmKHNlbGVjdC5wbGFjZWhvbGRlcikge1xuICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz1cImRlZmF1bHQgdGV4dFwiPicgKyBwbGFjZWhvbGRlciArICc8L2Rpdj4nO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9XCJ0ZXh0XCI+PC9kaXY+JztcbiAgICB9XG4gICAgaHRtbCArPSAnPGRpdiBjbGFzcz1cIm1lbnVcIj4nO1xuICAgICQuZWFjaChzZWxlY3QudmFsdWVzLCBmdW5jdGlvbihpbmRleCwgb3B0aW9uKSB7XG4gICAgICBodG1sICs9IChvcHRpb24uZGlzYWJsZWQpXG4gICAgICAgID8gJzxkaXYgY2xhc3M9XCJkaXNhYmxlZCBpdGVtXCIgZGF0YS12YWx1ZT1cIicgKyBvcHRpb24udmFsdWUgKyAnXCI+JyArIG9wdGlvbi5uYW1lICsgJzwvZGl2PidcbiAgICAgICAgOiAnPGRpdiBjbGFzcz1cIml0ZW1cIiBkYXRhLXZhbHVlPVwiJyArIG9wdGlvbi52YWx1ZSArICdcIj4nICsgb3B0aW9uLm5hbWUgKyAnPC9kaXY+J1xuICAgICAgO1xuICAgIH0pO1xuICAgIGh0bWwgKz0gJzwvZGl2Pic7XG4gICAgcmV0dXJuIGh0bWw7XG4gIH0sXG5cbiAgLy8gZ2VuZXJhdGVzIGp1c3QgbWVudSBmcm9tIHNlbGVjdFxuICBtZW51OiBmdW5jdGlvbihyZXNwb25zZSwgZmllbGRzKSB7XG4gICAgdmFyXG4gICAgICB2YWx1ZXMgPSByZXNwb25zZVtmaWVsZHMudmFsdWVzXSB8fCB7fSxcbiAgICAgIGh0bWwgICA9ICcnXG4gICAgO1xuICAgICQuZWFjaCh2YWx1ZXMsIGZ1bmN0aW9uKGluZGV4LCBvcHRpb24pIHtcbiAgICAgIHZhclxuICAgICAgICBtYXliZVRleHQgPSAob3B0aW9uW2ZpZWxkcy50ZXh0XSlcbiAgICAgICAgICA/ICdkYXRhLXRleHQ9XCInICsgb3B0aW9uW2ZpZWxkcy50ZXh0XSArICdcIidcbiAgICAgICAgICA6ICcnLFxuICAgICAgICBtYXliZURpc2FibGVkID0gKG9wdGlvbltmaWVsZHMuZGlzYWJsZWRdKVxuICAgICAgICAgID8gJ2Rpc2FibGVkICdcbiAgICAgICAgICA6ICcnXG4gICAgICA7XG4gICAgICBodG1sICs9ICc8ZGl2IGNsYXNzPVwiJysgbWF5YmVEaXNhYmxlZCArJ2l0ZW1cIiBkYXRhLXZhbHVlPVwiJyArIG9wdGlvbltmaWVsZHMudmFsdWVdICsgJ1wiJyArIG1heWJlVGV4dCArICc+JztcbiAgICAgIGh0bWwgKz0gICBvcHRpb25bZmllbGRzLm5hbWVdO1xuICAgICAgaHRtbCArPSAnPC9kaXY+JztcbiAgICB9KTtcbiAgICByZXR1cm4gaHRtbDtcbiAgfSxcblxuICAvLyBnZW5lcmF0ZXMgbGFiZWwgZm9yIG11bHRpc2VsZWN0XG4gIGxhYmVsOiBmdW5jdGlvbih2YWx1ZSwgdGV4dCkge1xuICAgIHJldHVybiB0ZXh0ICsgJzxpIGNsYXNzPVwiZGVsZXRlIGljb25cIj48L2k+JztcbiAgfSxcblxuXG4gIC8vIGdlbmVyYXRlcyBtZXNzYWdlcyBsaWtlIFwiTm8gcmVzdWx0c1wiXG4gIG1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICByZXR1cm4gbWVzc2FnZTtcbiAgfSxcblxuICAvLyBnZW5lcmF0ZXMgdXNlciBhZGRpdGlvbiB0byBzZWxlY3Rpb24gbWVudVxuICBhZGRpdGlvbjogZnVuY3Rpb24oY2hvaWNlKSB7XG4gICAgcmV0dXJuIGNob2ljZTtcbiAgfVxuXG59O1xuXG59KSggalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50ICk7XG5cbi8qIVxuICogIyBTZW1hbnRpYyBVSSAyLjQuMCAtIEVtYmVkXG4gKiBodHRwOi8vZ2l0aHViLmNvbS9zZW1hbnRpYy1vcmcvc2VtYW50aWMtdWkvXG4gKlxuICpcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuICpcbiAqL1xuXG47KGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHtcblxuJ3VzZSBzdHJpY3QnO1xuXG53aW5kb3cgPSAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoKVxuICA/IHdpbmRvd1xuICA6ICh0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aClcbiAgICA/IHNlbGZcbiAgICA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKClcbjtcblxuJC5mbi5lbWJlZCA9IGZ1bmN0aW9uKHBhcmFtZXRlcnMpIHtcblxuICB2YXJcbiAgICAkYWxsTW9kdWxlcyAgICAgPSAkKHRoaXMpLFxuXG4gICAgbW9kdWxlU2VsZWN0b3IgID0gJGFsbE1vZHVsZXMuc2VsZWN0b3IgfHwgJycsXG5cbiAgICB0aW1lICAgICAgICAgICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICBwZXJmb3JtYW5jZSAgICAgPSBbXSxcblxuICAgIHF1ZXJ5ICAgICAgICAgICA9IGFyZ3VtZW50c1swXSxcbiAgICBtZXRob2RJbnZva2VkICAgPSAodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnKSxcbiAgICBxdWVyeUFyZ3VtZW50cyAgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksXG5cbiAgICByZXR1cm5lZFZhbHVlXG4gIDtcblxuICAkYWxsTW9kdWxlc1xuICAgIC5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyXG4gICAgICAgIHNldHRpbmdzICAgICAgICA9ICggJC5pc1BsYWluT2JqZWN0KHBhcmFtZXRlcnMpIClcbiAgICAgICAgICA/ICQuZXh0ZW5kKHRydWUsIHt9LCAkLmZuLmVtYmVkLnNldHRpbmdzLCBwYXJhbWV0ZXJzKVxuICAgICAgICAgIDogJC5leHRlbmQoe30sICQuZm4uZW1iZWQuc2V0dGluZ3MpLFxuXG4gICAgICAgIHNlbGVjdG9yICAgICAgICA9IHNldHRpbmdzLnNlbGVjdG9yLFxuICAgICAgICBjbGFzc05hbWUgICAgICAgPSBzZXR0aW5ncy5jbGFzc05hbWUsXG4gICAgICAgIHNvdXJjZXMgICAgICAgICA9IHNldHRpbmdzLnNvdXJjZXMsXG4gICAgICAgIGVycm9yICAgICAgICAgICA9IHNldHRpbmdzLmVycm9yLFxuICAgICAgICBtZXRhZGF0YSAgICAgICAgPSBzZXR0aW5ncy5tZXRhZGF0YSxcbiAgICAgICAgbmFtZXNwYWNlICAgICAgID0gc2V0dGluZ3MubmFtZXNwYWNlLFxuICAgICAgICB0ZW1wbGF0ZXMgICAgICAgPSBzZXR0aW5ncy50ZW1wbGF0ZXMsXG5cbiAgICAgICAgZXZlbnROYW1lc3BhY2UgID0gJy4nICsgbmFtZXNwYWNlLFxuICAgICAgICBtb2R1bGVOYW1lc3BhY2UgPSAnbW9kdWxlLScgKyBuYW1lc3BhY2UsXG5cbiAgICAgICAgJHdpbmRvdyAgICAgICAgID0gJCh3aW5kb3cpLFxuICAgICAgICAkbW9kdWxlICAgICAgICAgPSAkKHRoaXMpLFxuICAgICAgICAkcGxhY2Vob2xkZXIgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IucGxhY2Vob2xkZXIpLFxuICAgICAgICAkaWNvbiAgICAgICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IuaWNvbiksXG4gICAgICAgICRlbWJlZCAgICAgICAgICA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5lbWJlZCksXG5cbiAgICAgICAgZWxlbWVudCAgICAgICAgID0gdGhpcyxcbiAgICAgICAgaW5zdGFuY2UgICAgICAgID0gJG1vZHVsZS5kYXRhKG1vZHVsZU5hbWVzcGFjZSksXG4gICAgICAgIG1vZHVsZVxuICAgICAgO1xuXG4gICAgICBtb2R1bGUgPSB7XG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdJbml0aWFsaXppbmcgZW1iZWQnKTtcbiAgICAgICAgICBtb2R1bGUuZGV0ZXJtaW5lLmF1dG9wbGF5KCk7XG4gICAgICAgICAgbW9kdWxlLmNyZWF0ZSgpO1xuICAgICAgICAgIG1vZHVsZS5iaW5kLmV2ZW50cygpO1xuICAgICAgICAgIG1vZHVsZS5pbnN0YW50aWF0ZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluc3RhbnRpYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU3RvcmluZyBpbnN0YW5jZSBvZiBtb2R1bGUnLCBtb2R1bGUpO1xuICAgICAgICAgIGluc3RhbmNlID0gbW9kdWxlO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5kYXRhKG1vZHVsZU5hbWVzcGFjZSwgbW9kdWxlKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRGVzdHJveWluZyBwcmV2aW91cyBpbnN0YW5jZSBvZiBlbWJlZCcpO1xuICAgICAgICAgIG1vZHVsZS5yZXNldCgpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5yZW1vdmVEYXRhKG1vZHVsZU5hbWVzcGFjZSlcbiAgICAgICAgICAgIC5vZmYoZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZWZyZXNoaW5nIHNlbGVjdG9yIGNhY2hlJyk7XG4gICAgICAgICAgJHBsYWNlaG9sZGVyID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLnBsYWNlaG9sZGVyKTtcbiAgICAgICAgICAkaWNvbiAgICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IuaWNvbik7XG4gICAgICAgICAgJGVtYmVkICAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLmVtYmVkKTtcbiAgICAgICAgfSxcblxuICAgICAgICBiaW5kOiB7XG4gICAgICAgICAgZXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCBtb2R1bGUuaGFzLnBsYWNlaG9sZGVyKCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIHBsYWNlaG9sZGVyIGV2ZW50cycpO1xuICAgICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgICAgLm9uKCdjbGljaycgKyBldmVudE5hbWVzcGFjZSwgc2VsZWN0b3IucGxhY2Vob2xkZXIsIG1vZHVsZS5jcmVhdGVBbmRTaG93KVxuICAgICAgICAgICAgICAgIC5vbignY2xpY2snICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLmljb24sIG1vZHVsZS5jcmVhdGVBbmRTaG93KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNyZWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBwbGFjZWhvbGRlciA9IG1vZHVsZS5nZXQucGxhY2Vob2xkZXIoKVxuICAgICAgICAgIDtcbiAgICAgICAgICBpZihwbGFjZWhvbGRlcikge1xuICAgICAgICAgICAgbW9kdWxlLmNyZWF0ZVBsYWNlaG9sZGVyKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbW9kdWxlLmNyZWF0ZUFuZFNob3coKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY3JlYXRlUGxhY2Vob2xkZXI6IGZ1bmN0aW9uKHBsYWNlaG9sZGVyKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBpY29uICA9IG1vZHVsZS5nZXQuaWNvbigpLFxuICAgICAgICAgICAgdXJsICAgPSBtb2R1bGUuZ2V0LnVybCgpLFxuICAgICAgICAgICAgZW1iZWQgPSBtb2R1bGUuZ2VuZXJhdGUuZW1iZWQodXJsKVxuICAgICAgICAgIDtcbiAgICAgICAgICBwbGFjZWhvbGRlciA9IHBsYWNlaG9sZGVyIHx8IG1vZHVsZS5nZXQucGxhY2Vob2xkZXIoKTtcbiAgICAgICAgICAkbW9kdWxlLmh0bWwoIHRlbXBsYXRlcy5wbGFjZWhvbGRlcihwbGFjZWhvbGRlciwgaWNvbikgKTtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NyZWF0aW5nIHBsYWNlaG9sZGVyIGZvciBlbWJlZCcsIHBsYWNlaG9sZGVyLCBpY29uKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGVFbWJlZDogZnVuY3Rpb24odXJsKSB7XG4gICAgICAgICAgbW9kdWxlLnJlZnJlc2goKTtcbiAgICAgICAgICB1cmwgPSB1cmwgfHwgbW9kdWxlLmdldC51cmwoKTtcbiAgICAgICAgICAkZW1iZWQgPSAkKCc8ZGl2Lz4nKVxuICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5lbWJlZClcbiAgICAgICAgICAgIC5odG1sKCBtb2R1bGUuZ2VuZXJhdGUuZW1iZWQodXJsKSApXG4gICAgICAgICAgICAuYXBwZW5kVG8oJG1vZHVsZSlcbiAgICAgICAgICA7XG4gICAgICAgICAgc2V0dGluZ3Mub25DcmVhdGUuY2FsbChlbGVtZW50LCB1cmwpO1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ3JlYXRpbmcgZW1iZWQgb2JqZWN0JywgJGVtYmVkKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjaGFuZ2VFbWJlZDogZnVuY3Rpb24odXJsKSB7XG4gICAgICAgICAgJGVtYmVkXG4gICAgICAgICAgICAuaHRtbCggbW9kdWxlLmdlbmVyYXRlLmVtYmVkKHVybCkgKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGVBbmRTaG93OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUuY3JlYXRlRW1iZWQoKTtcbiAgICAgICAgICBtb2R1bGUuc2hvdygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIHNldHMgbmV3IGVtYmVkXG4gICAgICAgIGNoYW5nZTogZnVuY3Rpb24oc291cmNlLCBpZCwgdXJsKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdDaGFuZ2luZyB2aWRlbyB0byAnLCBzb3VyY2UsIGlkLCB1cmwpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5kYXRhKG1ldGFkYXRhLnNvdXJjZSwgc291cmNlKVxuICAgICAgICAgICAgLmRhdGEobWV0YWRhdGEuaWQsIGlkKVxuICAgICAgICAgIDtcbiAgICAgICAgICBpZih1cmwpIHtcbiAgICAgICAgICAgICRtb2R1bGUuZGF0YShtZXRhZGF0YS51cmwsIHVybCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVEYXRhKG1ldGFkYXRhLnVybCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKG1vZHVsZS5oYXMuZW1iZWQoKSkge1xuICAgICAgICAgICAgbW9kdWxlLmNoYW5nZUVtYmVkKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbW9kdWxlLmNyZWF0ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvLyBjbGVhcnMgZW1iZWRcbiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ2xlYXJpbmcgZW1iZWQgYW5kIHNob3dpbmcgcGxhY2Vob2xkZXInKTtcbiAgICAgICAgICBtb2R1bGUucmVtb3ZlLmFjdGl2ZSgpO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUuZW1iZWQoKTtcbiAgICAgICAgICBtb2R1bGUuc2hvd1BsYWNlaG9sZGVyKCk7XG4gICAgICAgICAgc2V0dGluZ3Mub25SZXNldC5jYWxsKGVsZW1lbnQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vIHNob3dzIGN1cnJlbnQgZW1iZWRcbiAgICAgICAgc2hvdzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaG93aW5nIGVtYmVkJyk7XG4gICAgICAgICAgbW9kdWxlLnNldC5hY3RpdmUoKTtcbiAgICAgICAgICBzZXR0aW5ncy5vbkRpc3BsYXkuY2FsbChlbGVtZW50KTtcbiAgICAgICAgfSxcblxuICAgICAgICBoaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0hpZGluZyBlbWJlZCcpO1xuICAgICAgICAgIG1vZHVsZS5zaG93UGxhY2Vob2xkZXIoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzaG93UGxhY2Vob2xkZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2hvd2luZyBwbGFjZWhvbGRlciBpbWFnZScpO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUuYWN0aXZlKCk7XG4gICAgICAgICAgc2V0dGluZ3Mub25QbGFjZWhvbGRlckRpc3BsYXkuY2FsbChlbGVtZW50KTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXQ6IHtcbiAgICAgICAgICBpZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZ3MuaWQgfHwgJG1vZHVsZS5kYXRhKG1ldGFkYXRhLmlkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBsYWNlaG9sZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5wbGFjZWhvbGRlciB8fCAkbW9kdWxlLmRhdGEobWV0YWRhdGEucGxhY2Vob2xkZXIpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaWNvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKHNldHRpbmdzLmljb24pXG4gICAgICAgICAgICAgID8gc2V0dGluZ3MuaWNvblxuICAgICAgICAgICAgICA6ICgkbW9kdWxlLmRhdGEobWV0YWRhdGEuaWNvbikgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICA/ICRtb2R1bGUuZGF0YShtZXRhZGF0YS5pY29uKVxuICAgICAgICAgICAgICAgIDogbW9kdWxlLmRldGVybWluZS5pY29uKClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNvdXJjZTogZnVuY3Rpb24odXJsKSB7XG4gICAgICAgICAgICByZXR1cm4gKHNldHRpbmdzLnNvdXJjZSlcbiAgICAgICAgICAgICAgPyBzZXR0aW5ncy5zb3VyY2VcbiAgICAgICAgICAgICAgOiAoJG1vZHVsZS5kYXRhKG1ldGFkYXRhLnNvdXJjZSkgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICA/ICRtb2R1bGUuZGF0YShtZXRhZGF0YS5zb3VyY2UpXG4gICAgICAgICAgICAgICAgOiBtb2R1bGUuZGV0ZXJtaW5lLnNvdXJjZSgpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0eXBlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBzb3VyY2UgPSBtb2R1bGUuZ2V0LnNvdXJjZSgpO1xuICAgICAgICAgICAgcmV0dXJuIChzb3VyY2VzW3NvdXJjZV0gIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyBzb3VyY2VzW3NvdXJjZV0udHlwZVxuICAgICAgICAgICAgICA6IGZhbHNlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB1cmw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChzZXR0aW5ncy51cmwpXG4gICAgICAgICAgICAgID8gc2V0dGluZ3MudXJsXG4gICAgICAgICAgICAgIDogKCRtb2R1bGUuZGF0YShtZXRhZGF0YS51cmwpICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgPyAkbW9kdWxlLmRhdGEobWV0YWRhdGEudXJsKVxuICAgICAgICAgICAgICAgIDogbW9kdWxlLmRldGVybWluZS51cmwoKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXRlcm1pbmU6IHtcbiAgICAgICAgICBhdXRvcGxheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihtb2R1bGUuc2hvdWxkLmF1dG9wbGF5KCkpIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3MuYXV0b3BsYXkgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc291cmNlOiBmdW5jdGlvbih1cmwpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBtYXRjaGVkU291cmNlID0gZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHVybCA9IHVybCB8fCBtb2R1bGUuZ2V0LnVybCgpO1xuICAgICAgICAgICAgaWYodXJsKSB7XG4gICAgICAgICAgICAgICQuZWFjaChzb3VyY2VzLCBmdW5jdGlvbihuYW1lLCBzb3VyY2UpIHtcbiAgICAgICAgICAgICAgICBpZih1cmwuc2VhcmNoKHNvdXJjZS5kb21haW4pICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgbWF0Y2hlZFNvdXJjZSA9IG5hbWU7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVkU291cmNlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaWNvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgc291cmNlID0gbW9kdWxlLmdldC5zb3VyY2UoKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgcmV0dXJuIChzb3VyY2VzW3NvdXJjZV0gIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyBzb3VyY2VzW3NvdXJjZV0uaWNvblxuICAgICAgICAgICAgICA6IGZhbHNlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB1cmw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGlkICAgICA9IHNldHRpbmdzLmlkICAgICB8fCAkbW9kdWxlLmRhdGEobWV0YWRhdGEuaWQpLFxuICAgICAgICAgICAgICBzb3VyY2UgPSBzZXR0aW5ncy5zb3VyY2UgfHwgJG1vZHVsZS5kYXRhKG1ldGFkYXRhLnNvdXJjZSksXG4gICAgICAgICAgICAgIHVybFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgdXJsID0gKHNvdXJjZXNbc291cmNlXSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICA/IHNvdXJjZXNbc291cmNlXS51cmwucmVwbGFjZSgne2lkfScsIGlkKVxuICAgICAgICAgICAgICA6IGZhbHNlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZih1cmwpIHtcbiAgICAgICAgICAgICAgJG1vZHVsZS5kYXRhKG1ldGFkYXRhLnVybCwgdXJsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG5cbiAgICAgICAgc2V0OiB7XG4gICAgICAgICAgYWN0aXZlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUuYWRkQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZToge1xuICAgICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZW1iZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGVtYmVkLmVtcHR5KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGVuY29kZToge1xuICAgICAgICAgIHBhcmFtZXRlcnM6IGZ1bmN0aW9uKHBhcmFtZXRlcnMpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB1cmxTdHJpbmcgPSBbXSxcbiAgICAgICAgICAgICAgaW5kZXhcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGZvciAoaW5kZXggaW4gcGFyYW1ldGVycykge1xuICAgICAgICAgICAgICB1cmxTdHJpbmcucHVzaCggZW5jb2RlVVJJQ29tcG9uZW50KGluZGV4KSArICc9JyArIGVuY29kZVVSSUNvbXBvbmVudCggcGFyYW1ldGVyc1tpbmRleF0gKSApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVybFN0cmluZy5qb2luKCcmYW1wOycpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBnZW5lcmF0ZToge1xuICAgICAgICAgIGVtYmVkOiBmdW5jdGlvbih1cmwpIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnR2VuZXJhdGluZyBlbWJlZCBodG1sJyk7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgc291cmNlID0gbW9kdWxlLmdldC5zb3VyY2UoKSxcbiAgICAgICAgICAgICAgaHRtbCxcbiAgICAgICAgICAgICAgcGFyYW1ldGVyc1xuICAgICAgICAgICAgO1xuICAgICAgICAgICAgdXJsID0gbW9kdWxlLmdldC51cmwodXJsKTtcbiAgICAgICAgICAgIGlmKHVybCkge1xuICAgICAgICAgICAgICBwYXJhbWV0ZXJzID0gbW9kdWxlLmdlbmVyYXRlLnBhcmFtZXRlcnMoc291cmNlKTtcbiAgICAgICAgICAgICAgaHRtbCAgICAgICA9IHRlbXBsYXRlcy5pZnJhbWUodXJsLCBwYXJhbWV0ZXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3Iubm9VUkwsICRtb2R1bGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGh0bWw7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwYXJhbWV0ZXJzOiBmdW5jdGlvbihzb3VyY2UsIGV4dHJhUGFyYW1ldGVycykge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHBhcmFtZXRlcnMgPSAoc291cmNlc1tzb3VyY2VdICYmIHNvdXJjZXNbc291cmNlXS5wYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgPyBzb3VyY2VzW3NvdXJjZV0ucGFyYW1ldGVycyhzZXR0aW5ncylcbiAgICAgICAgICAgICAgICA6IHt9XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBleHRyYVBhcmFtZXRlcnMgPSBleHRyYVBhcmFtZXRlcnMgfHwgc2V0dGluZ3MucGFyYW1ldGVycztcbiAgICAgICAgICAgIGlmKGV4dHJhUGFyYW1ldGVycykge1xuICAgICAgICAgICAgICBwYXJhbWV0ZXJzID0gJC5leHRlbmQoe30sIHBhcmFtZXRlcnMsIGV4dHJhUGFyYW1ldGVycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwYXJhbWV0ZXJzID0gc2V0dGluZ3Mub25FbWJlZChwYXJhbWV0ZXJzKTtcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGUuZW5jb2RlLnBhcmFtZXRlcnMocGFyYW1ldGVycyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGhhczoge1xuICAgICAgICAgIGVtYmVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoJGVtYmVkLmxlbmd0aCA+IDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcGxhY2Vob2xkZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzLnBsYWNlaG9sZGVyIHx8ICRtb2R1bGUuZGF0YShtZXRhZGF0YS5wbGFjZWhvbGRlcik7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNob3VsZDoge1xuICAgICAgICAgIGF1dG9wbGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoc2V0dGluZ3MuYXV0b3BsYXkgPT09ICdhdXRvJylcbiAgICAgICAgICAgICAgPyAoc2V0dGluZ3MucGxhY2Vob2xkZXIgfHwgJG1vZHVsZS5kYXRhKG1ldGFkYXRhLnBsYWNlaG9sZGVyKSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICA6IHNldHRpbmdzLmF1dG9wbGF5XG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGlzOiB7XG4gICAgICAgICAgdmlkZW86IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS5nZXQudHlwZSgpID09ICd2aWRlbyc7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldHRpbmc6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdDaGFuZ2luZyBzZXR0aW5nJywgbmFtZSwgdmFsdWUpO1xuICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBzZXR0aW5ncywgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYoJC5pc1BsYWluT2JqZWN0KHNldHRpbmdzW25hbWVdKSkge1xuICAgICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBzZXR0aW5nc1tuYW1lXSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW50ZXJuYWw6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIG1vZHVsZSwgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbW9kdWxlW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVtuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlYnVnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHZlcmJvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MudmVyYm9zZSAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZS5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQpIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvciA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5lcnJvciwgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUsXG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICBwcmV2aW91c1RpbWUgID0gdGltZSB8fCBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSA9IGN1cnJlbnRUaW1lIC0gcHJldmlvdXNUaW1lO1xuICAgICAgICAgICAgICB0aW1lICAgICAgICAgID0gY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIHBlcmZvcm1hbmNlLnB1c2goe1xuICAgICAgICAgICAgICAgICdOYW1lJyAgICAgICAgICAgOiBtZXNzYWdlWzBdLFxuICAgICAgICAgICAgICAgICdBcmd1bWVudHMnICAgICAgOiBbXS5zbGljZS5jYWxsKG1lc3NhZ2UsIDEpIHx8ICcnLFxuICAgICAgICAgICAgICAgICdFbGVtZW50JyAgICAgICAgOiBlbGVtZW50LFxuICAgICAgICAgICAgICAgICdFeGVjdXRpb24gVGltZScgOiBleGVjdXRpb25UaW1lXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UudGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS5kaXNwbGF5LCA1MDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlzcGxheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdGl0bGUgPSBzZXR0aW5ncy5uYW1lICsgJzonLFxuICAgICAgICAgICAgICB0b3RhbFRpbWUgPSAwXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICB0aW1lID0gZmFsc2U7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgICQuZWFjaChwZXJmb3JtYW5jZSwgZnVuY3Rpb24oaW5kZXgsIGRhdGEpIHtcbiAgICAgICAgICAgICAgdG90YWxUaW1lICs9IGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRpdGxlICs9ICcgJyArIHRvdGFsVGltZSArICdtcyc7XG4gICAgICAgICAgICBpZihtb2R1bGVTZWxlY3Rvcikge1xuICAgICAgICAgICAgICB0aXRsZSArPSAnIFxcJycgKyBtb2R1bGVTZWxlY3RvciArICdcXCcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoJGFsbE1vZHVsZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICB0aXRsZSArPSAnICcgKyAnKCcgKyAkYWxsTW9kdWxlcy5sZW5ndGggKyAnKSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggKGNvbnNvbGUuZ3JvdXAgIT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLnRhYmxlICE9PSB1bmRlZmluZWQpICYmIHBlcmZvcm1hbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgICAgIGlmKGNvbnNvbGUudGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKHBlcmZvcm1hbmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZXJmb3JtYW5jZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm1ldGhvZCwgcXVlcnkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCBmb3VuZCApICkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZC5hcHBseShjb250ZXh0LCBwYXNzZWRBcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGZvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCQuaXNBcnJheShyZXR1cm5lZFZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZS5wdXNoKHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSBbcmV0dXJuZWRWYWx1ZSwgcmVzcG9uc2VdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSByZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgICAgIGlmKGluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbnZva2UocXVlcnkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmKGluc3RhbmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpbnN0YW5jZS5pbnZva2UoJ2Rlc3Ryb3knKTtcbiAgICAgICAgfVxuICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgfVxuICAgIH0pXG4gIDtcbiAgcmV0dXJuIChyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpXG4gICAgPyByZXR1cm5lZFZhbHVlXG4gICAgOiB0aGlzXG4gIDtcbn07XG5cbiQuZm4uZW1iZWQuc2V0dGluZ3MgPSB7XG5cbiAgbmFtZSAgICAgICAgOiAnRW1iZWQnLFxuICBuYW1lc3BhY2UgICA6ICdlbWJlZCcsXG5cbiAgc2lsZW50ICAgICAgOiBmYWxzZSxcbiAgZGVidWcgICAgICAgOiBmYWxzZSxcbiAgdmVyYm9zZSAgICAgOiBmYWxzZSxcbiAgcGVyZm9ybWFuY2UgOiB0cnVlLFxuXG4gIGljb24gICAgIDogZmFsc2UsXG4gIHNvdXJjZSAgIDogZmFsc2UsXG4gIHVybCAgICAgIDogZmFsc2UsXG4gIGlkICAgICAgIDogZmFsc2UsXG5cbiAgLy8gc3RhbmRhcmQgdmlkZW8gc2V0dGluZ3NcbiAgYXV0b3BsYXkgIDogJ2F1dG8nLFxuICBjb2xvciAgICAgOiAnIzQ0NDQ0NCcsXG4gIGhkICAgICAgICA6IHRydWUsXG4gIGJyYW5kZWRVSSA6IGZhbHNlLFxuXG4gIC8vIGFkZGl0aW9uYWwgcGFyYW1ldGVycyB0byBpbmNsdWRlIHdpdGggdGhlIGVtYmVkXG4gIHBhcmFtZXRlcnM6IGZhbHNlLFxuXG4gIG9uRGlzcGxheSAgICAgICAgICAgIDogZnVuY3Rpb24oKSB7fSxcbiAgb25QbGFjZWhvbGRlckRpc3BsYXkgOiBmdW5jdGlvbigpIHt9LFxuICBvblJlc2V0ICAgICAgICAgICAgICA6IGZ1bmN0aW9uKCkge30sXG4gIG9uQ3JlYXRlICAgICAgICAgICAgIDogZnVuY3Rpb24odXJsKSB7fSxcbiAgb25FbWJlZCAgICAgICAgICAgICAgOiBmdW5jdGlvbihwYXJhbWV0ZXJzKSB7XG4gICAgcmV0dXJuIHBhcmFtZXRlcnM7XG4gIH0sXG5cbiAgbWV0YWRhdGEgICAgOiB7XG4gICAgaWQgICAgICAgICAgOiAnaWQnLFxuICAgIGljb24gICAgICAgIDogJ2ljb24nLFxuICAgIHBsYWNlaG9sZGVyIDogJ3BsYWNlaG9sZGVyJyxcbiAgICBzb3VyY2UgICAgICA6ICdzb3VyY2UnLFxuICAgIHVybCAgICAgICAgIDogJ3VybCdcbiAgfSxcblxuICBlcnJvciA6IHtcbiAgICBub1VSTCAgOiAnTm8gVVJMIHNwZWNpZmllZCcsXG4gICAgbWV0aG9kIDogJ1RoZSBtZXRob2QgeW91IGNhbGxlZCBpcyBub3QgZGVmaW5lZCdcbiAgfSxcblxuICBjbGFzc05hbWUgOiB7XG4gICAgYWN0aXZlIDogJ2FjdGl2ZScsXG4gICAgZW1iZWQgIDogJ2VtYmVkJ1xuICB9LFxuXG4gIHNlbGVjdG9yIDoge1xuICAgIGVtYmVkICAgICAgIDogJy5lbWJlZCcsXG4gICAgcGxhY2Vob2xkZXIgOiAnLnBsYWNlaG9sZGVyJyxcbiAgICBpY29uICAgICAgICA6ICcuaWNvbidcbiAgfSxcblxuICBzb3VyY2VzOiB7XG4gICAgeW91dHViZToge1xuICAgICAgbmFtZSAgIDogJ3lvdXR1YmUnLFxuICAgICAgdHlwZSAgIDogJ3ZpZGVvJyxcbiAgICAgIGljb24gICA6ICd2aWRlbyBwbGF5JyxcbiAgICAgIGRvbWFpbiA6ICd5b3V0dWJlLmNvbScsXG4gICAgICB1cmwgICAgOiAnLy93d3cueW91dHViZS5jb20vZW1iZWQve2lkfScsXG4gICAgICBwYXJhbWV0ZXJzOiBmdW5jdGlvbihzZXR0aW5ncykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGF1dG9oaWRlICAgICAgIDogIXNldHRpbmdzLmJyYW5kZWRVSSxcbiAgICAgICAgICBhdXRvcGxheSAgICAgICA6IHNldHRpbmdzLmF1dG9wbGF5LFxuICAgICAgICAgIGNvbG9yICAgICAgICAgIDogc2V0dGluZ3MuY29sb3IgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgIGhxICAgICAgICAgICAgIDogc2V0dGluZ3MuaGQsXG4gICAgICAgICAganNhcGkgICAgICAgICAgOiBzZXR0aW5ncy5hcGksXG4gICAgICAgICAgbW9kZXN0YnJhbmRpbmcgOiAhc2V0dGluZ3MuYnJhbmRlZFVJXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSxcbiAgICB2aW1lbzoge1xuICAgICAgbmFtZSAgIDogJ3ZpbWVvJyxcbiAgICAgIHR5cGUgICA6ICd2aWRlbycsXG4gICAgICBpY29uICAgOiAndmlkZW8gcGxheScsXG4gICAgICBkb21haW4gOiAndmltZW8uY29tJyxcbiAgICAgIHVybCAgICA6ICcvL3BsYXllci52aW1lby5jb20vdmlkZW8ve2lkfScsXG4gICAgICBwYXJhbWV0ZXJzOiBmdW5jdGlvbihzZXR0aW5ncykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGFwaSAgICAgIDogc2V0dGluZ3MuYXBpLFxuICAgICAgICAgIGF1dG9wbGF5IDogc2V0dGluZ3MuYXV0b3BsYXksXG4gICAgICAgICAgYnlsaW5lICAgOiBzZXR0aW5ncy5icmFuZGVkVUksXG4gICAgICAgICAgY29sb3IgICAgOiBzZXR0aW5ncy5jb2xvciB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgcG9ydHJhaXQgOiBzZXR0aW5ncy5icmFuZGVkVUksXG4gICAgICAgICAgdGl0bGUgICAgOiBzZXR0aW5ncy5icmFuZGVkVUlcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgdGVtcGxhdGVzOiB7XG4gICAgaWZyYW1lIDogZnVuY3Rpb24odXJsLCBwYXJhbWV0ZXJzKSB7XG4gICAgICB2YXIgc3JjID0gdXJsO1xuICAgICAgaWYgKHBhcmFtZXRlcnMpIHtcbiAgICAgICAgICBzcmMgKz0gJz8nICsgcGFyYW1ldGVycztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnJ1xuICAgICAgICArICc8aWZyYW1lIHNyYz1cIicgKyBzcmMgKyAnXCInXG4gICAgICAgICsgJyB3aWR0aD1cIjEwMCVcIiBoZWlnaHQ9XCIxMDAlXCInXG4gICAgICAgICsgJyBmcmFtZWJvcmRlcj1cIjBcIiBzY3JvbGxpbmc9XCJub1wiIHdlYmtpdEFsbG93RnVsbFNjcmVlbiBtb3phbGxvd2Z1bGxzY3JlZW4gYWxsb3dGdWxsU2NyZWVuPjwvaWZyYW1lPidcbiAgICAgIDtcbiAgICB9LFxuICAgIHBsYWNlaG9sZGVyIDogZnVuY3Rpb24oaW1hZ2UsIGljb24pIHtcbiAgICAgIHZhclxuICAgICAgICBodG1sID0gJydcbiAgICAgIDtcbiAgICAgIGlmKGljb24pIHtcbiAgICAgICAgaHRtbCArPSAnPGkgY2xhc3M9XCInICsgaWNvbiArICcgaWNvblwiPjwvaT4nO1xuICAgICAgfVxuICAgICAgaWYoaW1hZ2UpIHtcbiAgICAgICAgaHRtbCArPSAnPGltZyBjbGFzcz1cInBsYWNlaG9sZGVyXCIgc3JjPVwiJyArIGltYWdlICsgJ1wiPic7XG4gICAgICB9XG4gICAgICByZXR1cm4gaHRtbDtcbiAgICB9XG4gIH0sXG5cbiAgLy8gTk9UIFlFVCBJTVBMRU1FTlRFRFxuICBhcGkgICAgIDogZmFsc2UsXG4gIG9uUGF1c2UgOiBmdW5jdGlvbigpIHt9LFxuICBvblBsYXkgIDogZnVuY3Rpb24oKSB7fSxcbiAgb25TdG9wICA6IGZ1bmN0aW9uKCkge31cblxufTtcblxuXG5cbn0pKCBqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQgKTtcblxuLyohXG4gKiAjIFNlbWFudGljIFVJIDIuNC4wIC0gTW9kYWxcbiAqIGh0dHA6Ly9naXRodWIuY29tL3NlbWFudGljLW9yZy9zZW1hbnRpYy11aS9cbiAqXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG5cbjsoZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG4ndXNlIHN0cmljdCc7XG5cbndpbmRvdyA9ICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGgpXG4gID8gd2luZG93XG4gIDogKHR5cGVvZiBzZWxmICE9ICd1bmRlZmluZWQnICYmIHNlbGYuTWF0aCA9PSBNYXRoKVxuICAgID8gc2VsZlxuICAgIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKVxuO1xuXG4kLmZuLm1vZGFsID0gZnVuY3Rpb24ocGFyYW1ldGVycykge1xuICB2YXJcbiAgICAkYWxsTW9kdWxlcyAgICA9ICQodGhpcyksXG4gICAgJHdpbmRvdyAgICAgICAgPSAkKHdpbmRvdyksXG4gICAgJGRvY3VtZW50ICAgICAgPSAkKGRvY3VtZW50KSxcbiAgICAkYm9keSAgICAgICAgICA9ICQoJ2JvZHknKSxcblxuICAgIG1vZHVsZVNlbGVjdG9yID0gJGFsbE1vZHVsZXMuc2VsZWN0b3IgfHwgJycsXG5cbiAgICB0aW1lICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgID0gW10sXG5cbiAgICBxdWVyeSAgICAgICAgICA9IGFyZ3VtZW50c1swXSxcbiAgICBtZXRob2RJbnZva2VkICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLFxuXG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAgfHwgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAgfHwgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAgfHwgd2luZG93Lm1zUmVxdWVzdEFuaW1hdGlvbkZyYW1lXG4gICAgICB8fCBmdW5jdGlvbihjYWxsYmFjaykgeyBzZXRUaW1lb3V0KGNhbGxiYWNrLCAwKTsgfSxcblxuICAgIHJldHVybmVkVmFsdWVcbiAgO1xuXG4gICRhbGxNb2R1bGVzXG4gICAgLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXJcbiAgICAgICAgc2V0dGluZ3MgICAgPSAoICQuaXNQbGFpbk9iamVjdChwYXJhbWV0ZXJzKSApXG4gICAgICAgICAgPyAkLmV4dGVuZCh0cnVlLCB7fSwgJC5mbi5tb2RhbC5zZXR0aW5ncywgcGFyYW1ldGVycylcbiAgICAgICAgICA6ICQuZXh0ZW5kKHt9LCAkLmZuLm1vZGFsLnNldHRpbmdzKSxcblxuICAgICAgICBzZWxlY3RvciAgICAgICAgPSBzZXR0aW5ncy5zZWxlY3RvcixcbiAgICAgICAgY2xhc3NOYW1lICAgICAgID0gc2V0dGluZ3MuY2xhc3NOYW1lLFxuICAgICAgICBuYW1lc3BhY2UgICAgICAgPSBzZXR0aW5ncy5uYW1lc3BhY2UsXG4gICAgICAgIGVycm9yICAgICAgICAgICA9IHNldHRpbmdzLmVycm9yLFxuXG4gICAgICAgIGV2ZW50TmFtZXNwYWNlICA9ICcuJyArIG5hbWVzcGFjZSxcbiAgICAgICAgbW9kdWxlTmFtZXNwYWNlID0gJ21vZHVsZS0nICsgbmFtZXNwYWNlLFxuXG4gICAgICAgICRtb2R1bGUgICAgICAgICA9ICQodGhpcyksXG4gICAgICAgICRjb250ZXh0ICAgICAgICA9ICQoc2V0dGluZ3MuY29udGV4dCksXG4gICAgICAgICRjbG9zZSAgICAgICAgICA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5jbG9zZSksXG5cbiAgICAgICAgJGFsbE1vZGFscyxcbiAgICAgICAgJG90aGVyTW9kYWxzLFxuICAgICAgICAkZm9jdXNlZEVsZW1lbnQsXG4gICAgICAgICRkaW1tYWJsZSxcbiAgICAgICAgJGRpbW1lcixcblxuICAgICAgICBlbGVtZW50ICAgICAgICAgPSB0aGlzLFxuICAgICAgICBpbnN0YW5jZSAgICAgICAgPSAkbW9kdWxlLmRhdGEobW9kdWxlTmFtZXNwYWNlKSxcblxuICAgICAgICBpZ25vcmVSZXBlYXRlZEV2ZW50cyA9IGZhbHNlLFxuXG4gICAgICAgIGVsZW1lbnRFdmVudE5hbWVzcGFjZSxcbiAgICAgICAgaWQsXG4gICAgICAgIG9ic2VydmVyLFxuICAgICAgICBtb2R1bGVcbiAgICAgIDtcbiAgICAgIG1vZHVsZSAgPSB7XG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0luaXRpYWxpemluZyBkaW1tZXInLCAkY29udGV4dCk7XG5cbiAgICAgICAgICBtb2R1bGUuY3JlYXRlLmlkKCk7XG4gICAgICAgICAgbW9kdWxlLmNyZWF0ZS5kaW1tZXIoKTtcbiAgICAgICAgICBtb2R1bGUucmVmcmVzaE1vZGFscygpO1xuXG4gICAgICAgICAgbW9kdWxlLmJpbmQuZXZlbnRzKCk7XG4gICAgICAgICAgaWYoc2V0dGluZ3Mub2JzZXJ2ZUNoYW5nZXMpIHtcbiAgICAgICAgICAgIG1vZHVsZS5vYnNlcnZlQ2hhbmdlcygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuaW5zdGFudGlhdGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbnN0YW50aWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1N0b3JpbmcgaW5zdGFuY2Ugb2YgbW9kYWwnKTtcbiAgICAgICAgICBpbnN0YW5jZSA9IG1vZHVsZTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAuZGF0YShtb2R1bGVOYW1lc3BhY2UsIGluc3RhbmNlKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICBkaW1tZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGRlZmF1bHRTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBkZWJ1ZyAgICAgIDogc2V0dGluZ3MuZGVidWcsXG4gICAgICAgICAgICAgICAgdmFyaWF0aW9uICA6IHNldHRpbmdzLmNlbnRlcmVkXG4gICAgICAgICAgICAgICAgICA/IGZhbHNlXG4gICAgICAgICAgICAgICAgICA6ICd0b3AgYWxpZ25lZCcsXG4gICAgICAgICAgICAgICAgZGltbWVyTmFtZSA6ICdtb2RhbHMnXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGRpbW1lclNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwgZGVmYXVsdFNldHRpbmdzLCBzZXR0aW5ncy5kaW1tZXJTZXR0aW5ncylcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCQuZm4uZGltbWVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLmRpbW1lcik7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ3JlYXRpbmcgZGltbWVyJyk7XG4gICAgICAgICAgICAkZGltbWFibGUgPSAkY29udGV4dC5kaW1tZXIoZGltbWVyU2V0dGluZ3MpO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuZGV0YWNoYWJsZSkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTW9kYWwgaXMgZGV0YWNoYWJsZSwgbW92aW5nIGNvbnRlbnQgaW50byBkaW1tZXInKTtcbiAgICAgICAgICAgICAgJGRpbW1hYmxlLmRpbW1lcignYWRkIGNvbnRlbnQnLCAkbW9kdWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnVuZGV0YWNoZWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRkaW1tZXIgPSAkZGltbWFibGUuZGltbWVyKCdnZXQgZGltbWVyJyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZCA9IChNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KSArICcwMDAwMDAwMDAnKS5zdWJzdHIoMiwgOCk7XG4gICAgICAgICAgICBlbGVtZW50RXZlbnROYW1lc3BhY2UgPSAnLicgKyBpZDtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdDcmVhdGluZyB1bmlxdWUgaWQgZm9yIGVsZW1lbnQnLCBpZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXN0cm95aW5nIHByZXZpb3VzIG1vZGFsJyk7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLnJlbW92ZURhdGEobW9kdWxlTmFtZXNwYWNlKVxuICAgICAgICAgICAgLm9mZihldmVudE5hbWVzcGFjZSlcbiAgICAgICAgICA7XG4gICAgICAgICAgJHdpbmRvdy5vZmYoZWxlbWVudEV2ZW50TmFtZXNwYWNlKTtcbiAgICAgICAgICAkZGltbWVyLm9mZihlbGVtZW50RXZlbnROYW1lc3BhY2UpO1xuICAgICAgICAgICRjbG9zZS5vZmYoZXZlbnROYW1lc3BhY2UpO1xuICAgICAgICAgICRjb250ZXh0LmRpbW1lcignZGVzdHJveScpO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9ic2VydmVDaGFuZ2VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZignTXV0YXRpb25PYnNlcnZlcicgaW4gd2luZG93KSB7XG4gICAgICAgICAgICBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uKG11dGF0aW9ucykge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0RPTSB0cmVlIG1vZGlmaWVkLCByZWZyZXNoaW5nJyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUoZWxlbWVudCwge1xuICAgICAgICAgICAgICBjaGlsZExpc3QgOiB0cnVlLFxuICAgICAgICAgICAgICBzdWJ0cmVlICAgOiB0cnVlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2V0dGluZyB1cCBtdXRhdGlvbiBvYnNlcnZlcicsIG9ic2VydmVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS5zY3JvbGxpbmcoKTtcbiAgICAgICAgICBtb2R1bGUuY2FjaGVTaXplcygpO1xuICAgICAgICAgIGlmKCFtb2R1bGUuY2FuLnVzZUZsZXgoKSkge1xuICAgICAgICAgICAgbW9kdWxlLnNldC5tb2RhbE9mZnNldCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuc2V0LnNjcmVlbkhlaWdodCgpO1xuICAgICAgICAgIG1vZHVsZS5zZXQudHlwZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZnJlc2hNb2RhbHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICRvdGhlck1vZGFscyA9ICRtb2R1bGUuc2libGluZ3Moc2VsZWN0b3IubW9kYWwpO1xuICAgICAgICAgICRhbGxNb2RhbHMgICA9ICRvdGhlck1vZGFscy5hZGQoJG1vZHVsZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXR0YWNoRXZlbnRzOiBmdW5jdGlvbihzZWxlY3RvciwgZXZlbnQpIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgICR0b2dnbGUgPSAkKHNlbGVjdG9yKVxuICAgICAgICAgIDtcbiAgICAgICAgICBldmVudCA9ICQuaXNGdW5jdGlvbihtb2R1bGVbZXZlbnRdKVxuICAgICAgICAgICAgPyBtb2R1bGVbZXZlbnRdXG4gICAgICAgICAgICA6IG1vZHVsZS50b2dnbGVcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYoJHRvZ2dsZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0F0dGFjaGluZyBtb2RhbCBldmVudHMgdG8gZWxlbWVudCcsIHNlbGVjdG9yLCBldmVudCk7XG4gICAgICAgICAgICAkdG9nZ2xlXG4gICAgICAgICAgICAgIC5vZmYoZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgICAgIC5vbignY2xpY2snICsgZXZlbnROYW1lc3BhY2UsIGV2ZW50KVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5ub3RGb3VuZCwgc2VsZWN0b3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBiaW5kOiB7XG4gICAgICAgICAgZXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBdHRhY2hpbmcgZXZlbnRzJyk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5vbignY2xpY2snICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLmNsb3NlLCBtb2R1bGUuZXZlbnQuY2xvc2UpXG4gICAgICAgICAgICAgIC5vbignY2xpY2snICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLmFwcHJvdmUsIG1vZHVsZS5ldmVudC5hcHByb3ZlKVxuICAgICAgICAgICAgICAub24oJ2NsaWNrJyArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5kZW55LCBtb2R1bGUuZXZlbnQuZGVueSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgICR3aW5kb3dcbiAgICAgICAgICAgICAgLm9uKCdyZXNpemUnICsgZWxlbWVudEV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQucmVzaXplKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2Nyb2xsTG9jazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyB0b3VjaCBldmVudHMgZGVmYXVsdCB0byBwYXNzaXZlLCBkdWUgdG8gY2hhbmdlcyBpbiBjaHJvbWUgdG8gb3B0aW1pemUgbW9iaWxlIHBlcmZcbiAgICAgICAgICAgICRkaW1tYWJsZS5nZXQoMCkuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgbW9kdWxlLmV2ZW50LnByZXZlbnRTY3JvbGwsIHsgcGFzc2l2ZTogZmFsc2UgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVuYmluZDoge1xuICAgICAgICAgIHNjcm9sbExvY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGRpbW1hYmxlLmdldCgwKS5yZW1vdmVFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBtb2R1bGUuZXZlbnQucHJldmVudFNjcm9sbCwgeyBwYXNzaXZlOiBmYWxzZSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0OiB7XG4gICAgICAgICAgaWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDE2KSArICcwMDAwMDAwMDAnKS5zdWJzdHIoMiwgOCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50OiB7XG4gICAgICAgICAgYXBwcm92ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihpZ25vcmVSZXBlYXRlZEV2ZW50cyB8fCBzZXR0aW5ncy5vbkFwcHJvdmUuY2FsbChlbGVtZW50LCAkKHRoaXMpKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FwcHJvdmUgY2FsbGJhY2sgcmV0dXJuZWQgZmFsc2UgY2FuY2VsbGluZyBoaWRlJyk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlnbm9yZVJlcGVhdGVkRXZlbnRzID0gdHJ1ZTtcbiAgICAgICAgICAgIG1vZHVsZS5oaWRlKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBpZ25vcmVSZXBlYXRlZEV2ZW50cyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwcmV2ZW50U2Nyb2xsOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRlbnk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoaWdub3JlUmVwZWF0ZWRFdmVudHMgfHwgc2V0dGluZ3Mub25EZW55LmNhbGwoZWxlbWVudCwgJCh0aGlzKSkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZW55IGNhbGxiYWNrIHJldHVybmVkIGZhbHNlIGNhbmNlbGxpbmcgaGlkZScpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZ25vcmVSZXBlYXRlZEV2ZW50cyA9IHRydWU7XG4gICAgICAgICAgICBtb2R1bGUuaGlkZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgaWdub3JlUmVwZWF0ZWRFdmVudHMgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLmhpZGUoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgaWYoIXNldHRpbmdzLmNsb3NhYmxlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEaW1tZXIgY2xpY2tlZCBidXQgY2xvc2FibGUgc2V0dGluZyBpcyBkaXNhYmxlZCcpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJHRhcmdldCAgID0gJChldmVudC50YXJnZXQpLFxuICAgICAgICAgICAgICBpc0luTW9kYWwgPSAoJHRhcmdldC5jbG9zZXN0KHNlbGVjdG9yLm1vZGFsKS5sZW5ndGggPiAwKSxcbiAgICAgICAgICAgICAgaXNJbkRPTSAgID0gJC5jb250YWlucyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGV2ZW50LnRhcmdldClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCFpc0luTW9kYWwgJiYgaXNJbkRPTSAmJiBtb2R1bGUuaXMuYWN0aXZlKCkpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdEaW1tZXIgY2xpY2tlZCwgaGlkaW5nIGFsbCBtb2RhbHMnKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5jbGlja2F3YXkoKTtcbiAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuYWxsb3dNdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5oaWRlKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmhpZGVBbGwoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZGVib3VuY2U6IGZ1bmN0aW9uKG1ldGhvZCwgZGVsYXkpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUudGltZXIpO1xuICAgICAgICAgICAgbW9kdWxlLnRpbWVyID0gc2V0VGltZW91dChtZXRob2QsIGRlbGF5KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGtleWJvYXJkOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGtleUNvZGUgICA9IGV2ZW50LndoaWNoLFxuICAgICAgICAgICAgICBlc2NhcGVLZXkgPSAyN1xuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoa2V5Q29kZSA9PSBlc2NhcGVLZXkpIHtcbiAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuY2xvc2FibGUpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0VzY2FwZSBrZXkgcHJlc3NlZCBoaWRpbmcgbW9kYWwnKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuaGlkZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRXNjYXBlIGtleSBwcmVzc2VkLCBidXQgY2xvc2FibGUgaXMgc2V0IHRvIGZhbHNlJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlc2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiggJGRpbW1hYmxlLmRpbW1lcignaXMgYWN0aXZlJykgJiYgKCBtb2R1bGUuaXMuYW5pbWF0aW5nKCkgfHwgbW9kdWxlLmlzLmFjdGl2ZSgpICkgKSB7XG4gICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShtb2R1bGUucmVmcmVzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIG1vZHVsZS5pcy5hY3RpdmUoKSB8fCBtb2R1bGUuaXMuYW5pbWF0aW5nKCkgKSB7XG4gICAgICAgICAgICBtb2R1bGUuaGlkZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vZHVsZS5zaG93KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgY2FsbGJhY2sgPSAkLmlzRnVuY3Rpb24oY2FsbGJhY2spXG4gICAgICAgICAgICA/IGNhbGxiYWNrXG4gICAgICAgICAgICA6IGZ1bmN0aW9uKCl7fVxuICAgICAgICAgIDtcbiAgICAgICAgICBtb2R1bGUucmVmcmVzaE1vZGFscygpO1xuICAgICAgICAgIG1vZHVsZS5zZXQuZGltbWVyU2V0dGluZ3MoKTtcbiAgICAgICAgICBtb2R1bGUuc2V0LmRpbW1lclN0eWxlcygpO1xuXG4gICAgICAgICAgbW9kdWxlLnNob3dNb2RhbChjYWxsYmFjayk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGlkZTogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICBjYWxsYmFjayA9ICQuaXNGdW5jdGlvbihjYWxsYmFjaylcbiAgICAgICAgICAgID8gY2FsbGJhY2tcbiAgICAgICAgICAgIDogZnVuY3Rpb24oKXt9XG4gICAgICAgICAgO1xuICAgICAgICAgIG1vZHVsZS5yZWZyZXNoTW9kYWxzKCk7XG4gICAgICAgICAgbW9kdWxlLmhpZGVNb2RhbChjYWxsYmFjayk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2hvd01vZGFsOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgIGNhbGxiYWNrID0gJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKVxuICAgICAgICAgICAgPyBjYWxsYmFja1xuICAgICAgICAgICAgOiBmdW5jdGlvbigpe31cbiAgICAgICAgICA7XG4gICAgICAgICAgaWYoIG1vZHVsZS5pcy5hbmltYXRpbmcoKSB8fCAhbW9kdWxlLmlzLmFjdGl2ZSgpICkge1xuICAgICAgICAgICAgbW9kdWxlLnNob3dEaW1tZXIoKTtcbiAgICAgICAgICAgIG1vZHVsZS5jYWNoZVNpemVzKCk7XG4gICAgICAgICAgICBpZihtb2R1bGUuY2FuLnVzZUZsZXgoKSkge1xuICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmxlZ2FjeSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQubGVnYWN5KCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQubW9kYWxPZmZzZXQoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdVc2luZyBub24tZmxleCBsZWdhY3kgbW9kYWwgcG9zaXRpb25pbmcuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuc2V0LnNjcmVlbkhlaWdodCgpO1xuICAgICAgICAgICAgbW9kdWxlLnNldC50eXBlKCk7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LmNsaWNrYXdheSgpO1xuXG4gICAgICAgICAgICBpZiggIXNldHRpbmdzLmFsbG93TXVsdGlwbGUgJiYgbW9kdWxlLm90aGVycy5hY3RpdmUoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmhpZGVPdGhlcnMobW9kdWxlLnNob3dNb2RhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuYWxsb3dNdWx0aXBsZSAmJiBzZXR0aW5ncy5kZXRhY2hhYmxlKSB7XG4gICAgICAgICAgICAgICAgJG1vZHVsZS5kZXRhY2goKS5hcHBlbmRUbygkZGltbWVyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzZXR0aW5ncy5vblNob3cuY2FsbChlbGVtZW50KTtcbiAgICAgICAgICAgICAgaWYoc2V0dGluZ3MudHJhbnNpdGlvbiAmJiAkLmZuLnRyYW5zaXRpb24gIT09IHVuZGVmaW5lZCAmJiAkbW9kdWxlLnRyYW5zaXRpb24oJ2lzIHN1cHBvcnRlZCcpKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaG93aW5nIG1vZGFsIHdpdGggY3NzIGFuaW1hdGlvbnMnKTtcbiAgICAgICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbih7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnICAgICAgIDogc2V0dGluZ3MuZGVidWcsXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbiAgIDogc2V0dGluZ3MudHJhbnNpdGlvbiArICcgaW4nLFxuICAgICAgICAgICAgICAgICAgICBxdWV1ZSAgICAgICA6IHNldHRpbmdzLnF1ZXVlLFxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbiAgICA6IHNldHRpbmdzLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgICB1c2VGYWlsU2FmZSA6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG9uQ29tcGxldGUgOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5vblZpc2libGUuYXBwbHkoZWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgaWYoc2V0dGluZ3Mua2V5Ym9hcmRTaG9ydGN1dHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS5hZGQua2V5Ym9hcmRTaG9ydGN1dHMoKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnNhdmUuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgICBtb2R1bGUuc2V0LmFjdGl2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLmF1dG9mb2N1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC5hdXRvZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm5vVHJhbnNpdGlvbik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ01vZGFsIGlzIGFscmVhZHkgdmlzaWJsZScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBoaWRlTW9kYWw6IGZ1bmN0aW9uKGNhbGxiYWNrLCBrZWVwRGltbWVkKSB7XG4gICAgICAgICAgY2FsbGJhY2sgPSAkLmlzRnVuY3Rpb24oY2FsbGJhY2spXG4gICAgICAgICAgICA/IGNhbGxiYWNrXG4gICAgICAgICAgICA6IGZ1bmN0aW9uKCl7fVxuICAgICAgICAgIDtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0hpZGluZyBtb2RhbCcpO1xuICAgICAgICAgIGlmKHNldHRpbmdzLm9uSGlkZS5jYWxsKGVsZW1lbnQsICQodGhpcykpID09PSBmYWxzZSkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0hpZGUgY2FsbGJhY2sgcmV0dXJuZWQgZmFsc2UgY2FuY2VsbGluZyBoaWRlJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYoIG1vZHVsZS5pcy5hbmltYXRpbmcoKSB8fCBtb2R1bGUuaXMuYWN0aXZlKCkgKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy50cmFuc2l0aW9uICYmICQuZm4udHJhbnNpdGlvbiAhPT0gdW5kZWZpbmVkICYmICRtb2R1bGUudHJhbnNpdGlvbignaXMgc3VwcG9ydGVkJykpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5hY3RpdmUoKTtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKHtcbiAgICAgICAgICAgICAgICAgIGRlYnVnICAgICAgIDogc2V0dGluZ3MuZGVidWcsXG4gICAgICAgICAgICAgICAgICBhbmltYXRpb24gICA6IHNldHRpbmdzLnRyYW5zaXRpb24gKyAnIG91dCcsXG4gICAgICAgICAgICAgICAgICBxdWV1ZSAgICAgICA6IHNldHRpbmdzLnF1ZXVlLFxuICAgICAgICAgICAgICAgICAgZHVyYXRpb24gICAgOiBzZXR0aW5ncy5kdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgIHVzZUZhaWxTYWZlIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgIG9uU3RhcnQgICAgIDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCFtb2R1bGUub3RoZXJzLmFjdGl2ZSgpICYmICFrZWVwRGltbWVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgbW9kdWxlLmhpZGVEaW1tZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5rZXlib2FyZFNob3J0Y3V0cykge1xuICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUua2V5Ym9hcmRTaG9ydGN1dHMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIG9uQ29tcGxldGUgOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25IaWRkZW4uY2FsbChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5kaW1tZXJTdHlsZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlc3RvcmUuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm5vVHJhbnNpdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNob3dEaW1tZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCRkaW1tYWJsZS5kaW1tZXIoJ2lzIGFuaW1hdGluZycpIHx8ICEkZGltbWFibGUuZGltbWVyKCdpcyBhY3RpdmUnKSApIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2hvd2luZyBkaW1tZXInKTtcbiAgICAgICAgICAgICRkaW1tYWJsZS5kaW1tZXIoJ3Nob3cnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0RpbW1lciBhbHJlYWR5IHZpc2libGUnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGlkZURpbW1lcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoICRkaW1tYWJsZS5kaW1tZXIoJ2lzIGFuaW1hdGluZycpIHx8ICgkZGltbWFibGUuZGltbWVyKCdpcyBhY3RpdmUnKSkgKSB7XG4gICAgICAgICAgICBtb2R1bGUudW5iaW5kLnNjcm9sbExvY2soKTtcbiAgICAgICAgICAgICRkaW1tYWJsZS5kaW1tZXIoJ2hpZGUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5jbGlja2F3YXkoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5zY3JlZW5IZWlnaHQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRGltbWVyIGlzIG5vdCB2aXNpYmxlIGNhbm5vdCBoaWRlJyk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGhpZGVBbGw6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAkdmlzaWJsZU1vZGFscyA9ICRhbGxNb2RhbHMuZmlsdGVyKCcuJyArIGNsYXNzTmFtZS5hY3RpdmUgKyAnLCAuJyArIGNsYXNzTmFtZS5hbmltYXRpbmcpXG4gICAgICAgICAgO1xuICAgICAgICAgIGNhbGxiYWNrID0gJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKVxuICAgICAgICAgICAgPyBjYWxsYmFja1xuICAgICAgICAgICAgOiBmdW5jdGlvbigpe31cbiAgICAgICAgICA7XG4gICAgICAgICAgaWYoICR2aXNpYmxlTW9kYWxzLmxlbmd0aCA+IDAgKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0hpZGluZyBhbGwgdmlzaWJsZSBtb2RhbHMnKTtcbiAgICAgICAgICAgIG1vZHVsZS5oaWRlRGltbWVyKCk7XG4gICAgICAgICAgICAkdmlzaWJsZU1vZGFsc1xuICAgICAgICAgICAgICAubW9kYWwoJ2hpZGUgbW9kYWwnLCBjYWxsYmFjaylcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGlkZU90aGVyczogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgICR2aXNpYmxlTW9kYWxzID0gJG90aGVyTW9kYWxzLmZpbHRlcignLicgKyBjbGFzc05hbWUuYWN0aXZlICsgJywgLicgKyBjbGFzc05hbWUuYW5pbWF0aW5nKVxuICAgICAgICAgIDtcbiAgICAgICAgICBjYWxsYmFjayA9ICQuaXNGdW5jdGlvbihjYWxsYmFjaylcbiAgICAgICAgICAgID8gY2FsbGJhY2tcbiAgICAgICAgICAgIDogZnVuY3Rpb24oKXt9XG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKCAkdmlzaWJsZU1vZGFscy5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdIaWRpbmcgb3RoZXIgbW9kYWxzJywgJG90aGVyTW9kYWxzKTtcbiAgICAgICAgICAgICR2aXNpYmxlTW9kYWxzXG4gICAgICAgICAgICAgIC5tb2RhbCgnaGlkZSBtb2RhbCcsIGNhbGxiYWNrLCB0cnVlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvdGhlcnM6IHtcbiAgICAgICAgICBhY3RpdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICgkb3RoZXJNb2RhbHMuZmlsdGVyKCcuJyArIGNsYXNzTmFtZS5hY3RpdmUpLmxlbmd0aCA+IDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYW5pbWF0aW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoJG90aGVyTW9kYWxzLmZpbHRlcignLicgKyBjbGFzc05hbWUuYW5pbWF0aW5nKS5sZW5ndGggPiAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cblxuICAgICAgICBhZGQ6IHtcbiAgICAgICAgICBrZXlib2FyZFNob3J0Y3V0czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQWRkaW5nIGtleWJvYXJkIHNob3J0Y3V0cycpO1xuICAgICAgICAgICAgJGRvY3VtZW50XG4gICAgICAgICAgICAgIC5vbigna2V5dXAnICsgZXZlbnROYW1lc3BhY2UsIG1vZHVsZS5ldmVudC5rZXlib2FyZClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2F2ZToge1xuICAgICAgICAgIGZvY3VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkYWN0aXZlRWxlbWVudCA9ICQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCksXG4gICAgICAgICAgICAgIGluQ3VycmVudE1vZGFsID0gJGFjdGl2ZUVsZW1lbnQuY2xvc2VzdCgkbW9kdWxlKS5sZW5ndGggPiAwXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZighaW5DdXJyZW50TW9kYWwpIHtcbiAgICAgICAgICAgICAgJGZvY3VzZWRFbGVtZW50ID0gJChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS5ibHVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlc3RvcmU6IHtcbiAgICAgICAgICBmb2N1czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZigkZm9jdXNlZEVsZW1lbnQgJiYgJGZvY3VzZWRFbGVtZW50Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgJGZvY3VzZWRFbGVtZW50LmZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZToge1xuICAgICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbGVnYWN5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmxlZ2FjeSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjbGlja2F3YXk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGRpbW1lclxuICAgICAgICAgICAgICAub2ZmKCdjbGljaycgKyBlbGVtZW50RXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaW1tZXJTdHlsZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGRpbW1lci5yZW1vdmVDbGFzcyhjbGFzc05hbWUuaW52ZXJ0ZWQpO1xuICAgICAgICAgICAgJGRpbW1hYmxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5ibHVycmluZyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5U3R5bGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoJGJvZHkuYXR0cignc3R5bGUnKSA9PT0gJycpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlbW92aW5nIHN0eWxlIGF0dHJpYnV0ZScpO1xuICAgICAgICAgICAgICAkYm9keS5yZW1vdmVBdHRyKCdzdHlsZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2NyZWVuSGVpZ2h0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUmVtb3ZpbmcgcGFnZSBoZWlnaHQnKTtcbiAgICAgICAgICAgICRib2R5XG4gICAgICAgICAgICAgIC5jc3MoJ2hlaWdodCcsICcnKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAga2V5Ym9hcmRTaG9ydGN1dHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlbW92aW5nIGtleWJvYXJkIHNob3J0Y3V0cycpO1xuICAgICAgICAgICAgJGRvY3VtZW50XG4gICAgICAgICAgICAgIC5vZmYoJ2tleXVwJyArIGV2ZW50TmFtZXNwYWNlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2Nyb2xsaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRkaW1tYWJsZS5yZW1vdmVDbGFzcyhjbGFzc05hbWUuc2Nyb2xsaW5nKTtcbiAgICAgICAgICAgICRtb2R1bGUucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLnNjcm9sbGluZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNhY2hlU2l6ZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICRtb2R1bGUuYWRkQ2xhc3MoY2xhc3NOYW1lLmxvYWRpbmcpO1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgc2Nyb2xsSGVpZ2h0ID0gJG1vZHVsZS5wcm9wKCdzY3JvbGxIZWlnaHQnKSxcbiAgICAgICAgICAgIG1vZGFsV2lkdGggICA9ICRtb2R1bGUub3V0ZXJXaWR0aCgpLFxuICAgICAgICAgICAgbW9kYWxIZWlnaHQgID0gJG1vZHVsZS5vdXRlckhlaWdodCgpXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKG1vZHVsZS5jYWNoZSA9PT0gdW5kZWZpbmVkIHx8IG1vZGFsSGVpZ2h0ICE9PSAwKSB7XG4gICAgICAgICAgICBtb2R1bGUuY2FjaGUgPSB7XG4gICAgICAgICAgICAgIHBhZ2VIZWlnaHQgICAgOiAkKGRvY3VtZW50KS5vdXRlckhlaWdodCgpLFxuICAgICAgICAgICAgICB3aWR0aCAgICAgICAgIDogbW9kYWxXaWR0aCxcbiAgICAgICAgICAgICAgaGVpZ2h0ICAgICAgICA6IG1vZGFsSGVpZ2h0ICsgc2V0dGluZ3Mub2Zmc2V0LFxuICAgICAgICAgICAgICBzY3JvbGxIZWlnaHQgIDogc2Nyb2xsSGVpZ2h0ICsgc2V0dGluZ3Mub2Zmc2V0LFxuICAgICAgICAgICAgICBjb250ZXh0SGVpZ2h0IDogKHNldHRpbmdzLmNvbnRleHQgPT0gJ2JvZHknKVxuICAgICAgICAgICAgICAgID8gJCh3aW5kb3cpLmhlaWdodCgpXG4gICAgICAgICAgICAgICAgOiAkZGltbWFibGUuaGVpZ2h0KCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgbW9kdWxlLmNhY2hlLnRvcE9mZnNldCA9IC0obW9kdWxlLmNhY2hlLmhlaWdodCAvIDIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5sb2FkaW5nKTtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NhY2hpbmcgbW9kYWwgYW5kIGNvbnRhaW5lciBzaXplcycsIG1vZHVsZS5jYWNoZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FuOiB7XG4gICAgICAgICAgdXNlRmxleDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKHNldHRpbmdzLnVzZUZsZXggPT0gJ2F1dG8nKVxuICAgICAgICAgICAgICA/IHNldHRpbmdzLmRldGFjaGFibGUgJiYgIW1vZHVsZS5pcy5pZSgpXG4gICAgICAgICAgICAgIDogc2V0dGluZ3MudXNlRmxleFxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjb250ZXh0SGVpZ2h0ICA9IG1vZHVsZS5jYWNoZS5jb250ZXh0SGVpZ2h0LFxuICAgICAgICAgICAgICB2ZXJ0aWNhbENlbnRlciA9IG1vZHVsZS5jYWNoZS5jb250ZXh0SGVpZ2h0IC8gMixcbiAgICAgICAgICAgICAgdG9wT2Zmc2V0ICAgICAgPSBtb2R1bGUuY2FjaGUudG9wT2Zmc2V0LFxuICAgICAgICAgICAgICBzY3JvbGxIZWlnaHQgICA9IG1vZHVsZS5jYWNoZS5zY3JvbGxIZWlnaHQsXG4gICAgICAgICAgICAgIGhlaWdodCAgICAgICAgID0gbW9kdWxlLmNhY2hlLmhlaWdodCxcbiAgICAgICAgICAgICAgcGFkZGluZ0hlaWdodCAgPSBzZXR0aW5ncy5wYWRkaW5nLFxuICAgICAgICAgICAgICBzdGFydFBvc2l0aW9uICA9ICh2ZXJ0aWNhbENlbnRlciArIHRvcE9mZnNldClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiAoc2Nyb2xsSGVpZ2h0ID4gaGVpZ2h0KVxuICAgICAgICAgICAgICA/IChzdGFydFBvc2l0aW9uICsgc2Nyb2xsSGVpZ2h0ICsgcGFkZGluZ0hlaWdodCA8IGNvbnRleHRIZWlnaHQpXG4gICAgICAgICAgICAgIDogKGhlaWdodCArIChwYWRkaW5nSGVpZ2h0ICogMikgPCBjb250ZXh0SGVpZ2h0KVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpczoge1xuICAgICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGllOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBpc0lFMTEgPSAoISh3aW5kb3cuQWN0aXZlWE9iamVjdCkgJiYgJ0FjdGl2ZVhPYmplY3QnIGluIHdpbmRvdyksXG4gICAgICAgICAgICAgIGlzSUUgICA9ICgnQWN0aXZlWE9iamVjdCcgaW4gd2luZG93KVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgcmV0dXJuIChpc0lFMTEgfHwgaXNJRSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhbmltYXRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUudHJhbnNpdGlvbignaXMgc3VwcG9ydGVkJylcbiAgICAgICAgICAgICAgPyAkbW9kdWxlLnRyYW5zaXRpb24oJ2lzIGFuaW1hdGluZycpXG4gICAgICAgICAgICAgIDogJG1vZHVsZS5pcygnOnZpc2libGUnKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2Nyb2xsaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkZGltbWFibGUuaGFzQ2xhc3MoY2xhc3NOYW1lLnNjcm9sbGluZyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtb2Rlcm5Ccm93c2VyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIGFwcE5hbWUgZm9yIElFMTEgcmVwb3J0cyAnTmV0c2NhcGUnIGNhbiBubyBsb25nZXIgdXNlXG4gICAgICAgICAgICByZXR1cm4gISh3aW5kb3cuQWN0aXZlWE9iamVjdCB8fCAnQWN0aXZlWE9iamVjdCcgaW4gd2luZG93KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiB7XG4gICAgICAgICAgYXV0b2ZvY3VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkaW5wdXRzICAgID0gJG1vZHVsZS5maW5kKCdbdGFiaW5kZXhdLCA6aW5wdXQnKS5maWx0ZXIoJzp2aXNpYmxlJyksXG4gICAgICAgICAgICAgICRhdXRvZm9jdXMgPSAkaW5wdXRzLmZpbHRlcignW2F1dG9mb2N1c10nKSxcbiAgICAgICAgICAgICAgJGlucHV0ICAgICA9ICgkYXV0b2ZvY3VzLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAgICAgPyAkYXV0b2ZvY3VzLmZpcnN0KClcbiAgICAgICAgICAgICAgICA6ICRpbnB1dHMuZmlyc3QoKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoJGlucHV0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgJGlucHV0LmZvY3VzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjbGlja2F3YXk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGRpbW1lclxuICAgICAgICAgICAgICAub24oJ2NsaWNrJyArIGVsZW1lbnRFdmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LmNsaWNrKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGltbWVyU2V0dGluZ3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoJC5mbi5kaW1tZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IuZGltbWVyKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGRlZmF1bHRTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICBkZWJ1ZyAgICAgIDogc2V0dGluZ3MuZGVidWcsXG4gICAgICAgICAgICAgICAgZGltbWVyTmFtZSA6ICdtb2RhbHMnLFxuICAgICAgICAgICAgICAgIGNsb3NhYmxlICAgOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgdXNlRmxleCAgICA6IG1vZHVsZS5jYW4udXNlRmxleCgpLFxuICAgICAgICAgICAgICAgIHZhcmlhdGlvbiAgOiBzZXR0aW5ncy5jZW50ZXJlZFxuICAgICAgICAgICAgICAgICAgPyBmYWxzZVxuICAgICAgICAgICAgICAgICAgOiAndG9wIGFsaWduZWQnLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uICAgOiB7XG4gICAgICAgICAgICAgICAgICBzaG93ICAgICA6IHNldHRpbmdzLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgaGlkZSAgICAgOiBzZXR0aW5ncy5kdXJhdGlvblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZGltbWVyU2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCBkZWZhdWx0U2V0dGluZ3MsIHNldHRpbmdzLmRpbW1lclNldHRpbmdzKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuaW52ZXJ0ZWQpIHtcbiAgICAgICAgICAgICAgZGltbWVyU2V0dGluZ3MudmFyaWF0aW9uID0gKGRpbW1lclNldHRpbmdzLnZhcmlhdGlvbiAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgID8gZGltbWVyU2V0dGluZ3MudmFyaWF0aW9uICsgJyBpbnZlcnRlZCdcbiAgICAgICAgICAgICAgICA6ICdpbnZlcnRlZCdcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJGNvbnRleHQuZGltbWVyKCdzZXR0aW5nJywgZGltbWVyU2V0dGluZ3MpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGltbWVyU3R5bGVzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmludmVydGVkKSB7XG4gICAgICAgICAgICAgICRkaW1tZXIuYWRkQ2xhc3MoY2xhc3NOYW1lLmludmVydGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAkZGltbWVyLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5pbnZlcnRlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5ibHVycmluZykge1xuICAgICAgICAgICAgICAkZGltbWFibGUuYWRkQ2xhc3MoY2xhc3NOYW1lLmJsdXJyaW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAkZGltbWFibGUucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmJsdXJyaW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG1vZGFsT2Zmc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB3aWR0aCA9IG1vZHVsZS5jYWNoZS53aWR0aCxcbiAgICAgICAgICAgICAgaGVpZ2h0ID0gbW9kdWxlLmNhY2hlLmhlaWdodFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICBtYXJnaW5Ub3A6IChzZXR0aW5ncy5jZW50ZXJlZCAmJiBtb2R1bGUuY2FuLmZpdCgpKVxuICAgICAgICAgICAgICAgICAgPyAtKGhlaWdodCAvIDIpXG4gICAgICAgICAgICAgICAgICA6IDAsXG4gICAgICAgICAgICAgICAgbWFyZ2luTGVmdDogLSh3aWR0aCAvIDIpXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2V0dGluZyBtb2RhbCBvZmZzZXQgZm9yIGxlZ2FjeSBtb2RlJyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzY3JlZW5IZWlnaHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5jYW4uZml0KCkgKSB7XG4gICAgICAgICAgICAgICRib2R5LmNzcygnaGVpZ2h0JywgJycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnTW9kYWwgaXMgdGFsbGVyIHRoYW4gcGFnZSBjb250ZW50LCByZXNpemluZyBwYWdlIGhlaWdodCcpO1xuICAgICAgICAgICAgICAkYm9keVxuICAgICAgICAgICAgICAgIC5jc3MoJ2hlaWdodCcsIG1vZHVsZS5jYWNoZS5oZWlnaHQgKyAoc2V0dGluZ3MucGFkZGluZyAqIDIpIClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgYWN0aXZlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUuYWRkQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzY3JvbGxpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGRpbW1hYmxlLmFkZENsYXNzKGNsYXNzTmFtZS5zY3JvbGxpbmcpO1xuICAgICAgICAgICAgJG1vZHVsZS5hZGRDbGFzcyhjbGFzc05hbWUuc2Nyb2xsaW5nKTtcbiAgICAgICAgICAgIG1vZHVsZS51bmJpbmQuc2Nyb2xsTG9jaygpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbGVnYWN5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUuYWRkQ2xhc3MoY2xhc3NOYW1lLmxlZ2FjeSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0eXBlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5jYW4uZml0KCkpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ01vZGFsIGZpdHMgb24gc2NyZWVuJyk7XG4gICAgICAgICAgICAgIGlmKCFtb2R1bGUub3RoZXJzLmFjdGl2ZSgpICYmICFtb2R1bGUub3RoZXJzLmFuaW1hdGluZygpKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5zY3JvbGxpbmcoKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuYmluZC5zY3JvbGxMb2NrKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTW9kYWwgY2Fubm90IGZpdCBvbiBzY3JlZW4gc2V0dGluZyB0byBzY3JvbGxpbmcnKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5zY3JvbGxpbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHVuZGV0YWNoZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGRpbW1hYmxlLmFkZENsYXNzKGNsYXNzTmFtZS51bmRldGFjaGVkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dGluZzogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NoYW5naW5nIHNldHRpbmcnLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZigkLmlzUGxhaW5PYmplY3Qoc2V0dGluZ3NbbmFtZV0pKSB7XG4gICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzW25hbWVdLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3NbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZ3NbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnRlcm5hbDogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgbW9kdWxlLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBtb2R1bGVbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZGVidWc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1Zy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdmVyYm9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCAmJiBzZXR0aW5ncy52ZXJib3NlICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCkge1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmVycm9yLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvci5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGVyZm9ybWFuY2U6IHtcbiAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjdXJyZW50VGltZSxcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSxcbiAgICAgICAgICAgICAgcHJldmlvdXNUaW1lXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBjdXJyZW50VGltZSAgID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZSAgPSB0aW1lIHx8IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICBleGVjdXRpb25UaW1lID0gY3VycmVudFRpbWUgLSBwcmV2aW91c1RpbWU7XG4gICAgICAgICAgICAgIHRpbWUgICAgICAgICAgPSBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgcGVyZm9ybWFuY2UucHVzaCh7XG4gICAgICAgICAgICAgICAgJ05hbWUnICAgICAgICAgICA6IG1lc3NhZ2VbMF0sXG4gICAgICAgICAgICAgICAgJ0FyZ3VtZW50cycgICAgICA6IFtdLnNsaWNlLmNhbGwobWVzc2FnZSwgMSkgfHwgJycsXG4gICAgICAgICAgICAgICAgJ0VsZW1lbnQnICAgICAgICA6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgJ0V4ZWN1dGlvbiBUaW1lJyA6IGV4ZWN1dGlvblRpbWVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lciA9IHNldFRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLmRpc3BsYXksIDUwMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNwbGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB0aXRsZSA9IHNldHRpbmdzLm5hbWUgKyAnOicsXG4gICAgICAgICAgICAgIHRvdGFsVGltZSA9IDBcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHRpbWUgPSBmYWxzZTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICB0b3RhbFRpbWUgKz0gZGF0YVsnRXhlY3V0aW9uIFRpbWUnXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGl0bGUgKz0gJyAnICsgdG90YWxUaW1lICsgJ21zJztcbiAgICAgICAgICAgIGlmKG1vZHVsZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgIHRpdGxlICs9ICcgXFwnJyArIG1vZHVsZVNlbGVjdG9yICsgJ1xcJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggKGNvbnNvbGUuZ3JvdXAgIT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLnRhYmxlICE9PSB1bmRlZmluZWQpICYmIHBlcmZvcm1hbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgICAgIGlmKGNvbnNvbGUudGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKHBlcmZvcm1hbmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZXJmb3JtYW5jZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCAkLmlzRnVuY3Rpb24oIGZvdW5kICkgKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGZvdW5kLmFwcGx5KGNvbnRleHQsIHBhc3NlZEFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoZm91bmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoJC5pc0FycmF5KHJldHVybmVkVmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlLnB1c2gocmVzcG9uc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IFtyZXR1cm5lZFZhbHVlLCByZXNwb25zZV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYocmVzcG9uc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IHJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZm91bmQ7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGlmKG1ldGhvZEludm9rZWQpIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICAgIH1cbiAgICAgICAgbW9kdWxlLmludm9rZShxdWVyeSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGluc3RhbmNlLmludm9rZSgnZGVzdHJveScpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICB9XG4gICAgfSlcbiAgO1xuXG4gIHJldHVybiAocmV0dXJuZWRWYWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgID8gcmV0dXJuZWRWYWx1ZVxuICAgIDogdGhpc1xuICA7XG59O1xuXG4kLmZuLm1vZGFsLnNldHRpbmdzID0ge1xuXG4gIG5hbWUgICAgICAgICAgIDogJ01vZGFsJyxcbiAgbmFtZXNwYWNlICAgICAgOiAnbW9kYWwnLFxuXG4gIHVzZUZsZXggICAgICAgIDogJ2F1dG8nLFxuICBvZmZzZXQgICAgICAgICA6IDAsXG5cbiAgc2lsZW50ICAgICAgICAgOiBmYWxzZSxcbiAgZGVidWcgICAgICAgICAgOiBmYWxzZSxcbiAgdmVyYm9zZSAgICAgICAgOiBmYWxzZSxcbiAgcGVyZm9ybWFuY2UgICAgOiB0cnVlLFxuXG4gIG9ic2VydmVDaGFuZ2VzIDogZmFsc2UsXG5cbiAgYWxsb3dNdWx0aXBsZSAgOiBmYWxzZSxcbiAgZGV0YWNoYWJsZSAgICAgOiB0cnVlLFxuICBjbG9zYWJsZSAgICAgICA6IHRydWUsXG4gIGF1dG9mb2N1cyAgICAgIDogdHJ1ZSxcblxuICBpbnZlcnRlZCAgICAgICA6IGZhbHNlLFxuICBibHVycmluZyAgICAgICA6IGZhbHNlLFxuXG4gIGNlbnRlcmVkICAgICAgIDogdHJ1ZSxcblxuICBkaW1tZXJTZXR0aW5ncyA6IHtcbiAgICBjbG9zYWJsZSA6IGZhbHNlLFxuICAgIHVzZUNTUyAgIDogdHJ1ZVxuICB9LFxuXG4gIC8vIHdoZXRoZXIgdG8gdXNlIGtleWJvYXJkIHNob3J0Y3V0c1xuICBrZXlib2FyZFNob3J0Y3V0czogdHJ1ZSxcblxuICBjb250ZXh0ICAgIDogJ2JvZHknLFxuXG4gIHF1ZXVlICAgICAgOiBmYWxzZSxcbiAgZHVyYXRpb24gICA6IDUwMCxcbiAgdHJhbnNpdGlvbiA6ICdzY2FsZScsXG5cbiAgLy8gcGFkZGluZyB3aXRoIGVkZ2Ugb2YgcGFnZVxuICBwYWRkaW5nICAgIDogNTAsXG5cbiAgLy8gY2FsbGVkIGJlZm9yZSBzaG93IGFuaW1hdGlvblxuICBvblNob3cgICAgIDogZnVuY3Rpb24oKXt9LFxuXG4gIC8vIGNhbGxlZCBhZnRlciBzaG93IGFuaW1hdGlvblxuICBvblZpc2libGUgIDogZnVuY3Rpb24oKXt9LFxuXG4gIC8vIGNhbGxlZCBiZWZvcmUgaGlkZSBhbmltYXRpb25cbiAgb25IaWRlICAgICA6IGZ1bmN0aW9uKCl7IHJldHVybiB0cnVlOyB9LFxuXG4gIC8vIGNhbGxlZCBhZnRlciBoaWRlIGFuaW1hdGlvblxuICBvbkhpZGRlbiAgIDogZnVuY3Rpb24oKXt9LFxuXG4gIC8vIGNhbGxlZCBhZnRlciBhcHByb3ZlIHNlbGVjdG9yIG1hdGNoXG4gIG9uQXBwcm92ZSAgOiBmdW5jdGlvbigpeyByZXR1cm4gdHJ1ZTsgfSxcblxuICAvLyBjYWxsZWQgYWZ0ZXIgZGVueSBzZWxlY3RvciBtYXRjaFxuICBvbkRlbnkgICAgIDogZnVuY3Rpb24oKXsgcmV0dXJuIHRydWU7IH0sXG5cbiAgc2VsZWN0b3IgICAgOiB7XG4gICAgY2xvc2UgICAgOiAnPiAuY2xvc2UnLFxuICAgIGFwcHJvdmUgIDogJy5hY3Rpb25zIC5wb3NpdGl2ZSwgLmFjdGlvbnMgLmFwcHJvdmUsIC5hY3Rpb25zIC5vaycsXG4gICAgZGVueSAgICAgOiAnLmFjdGlvbnMgLm5lZ2F0aXZlLCAuYWN0aW9ucyAuZGVueSwgLmFjdGlvbnMgLmNhbmNlbCcsXG4gICAgbW9kYWwgICAgOiAnLnVpLm1vZGFsJ1xuICB9LFxuICBlcnJvciA6IHtcbiAgICBkaW1tZXIgICAgOiAnVUkgRGltbWVyLCBhIHJlcXVpcmVkIGNvbXBvbmVudCBpcyBub3QgaW5jbHVkZWQgaW4gdGhpcyBwYWdlJyxcbiAgICBtZXRob2QgICAgOiAnVGhlIG1ldGhvZCB5b3UgY2FsbGVkIGlzIG5vdCBkZWZpbmVkLicsXG4gICAgbm90Rm91bmQgIDogJ1RoZSBlbGVtZW50IHlvdSBzcGVjaWZpZWQgY291bGQgbm90IGJlIGZvdW5kJ1xuICB9LFxuICBjbGFzc05hbWUgOiB7XG4gICAgYWN0aXZlICAgICA6ICdhY3RpdmUnLFxuICAgIGFuaW1hdGluZyAgOiAnYW5pbWF0aW5nJyxcbiAgICBibHVycmluZyAgIDogJ2JsdXJyaW5nJyxcbiAgICBpbnZlcnRlZCAgIDogJ2ludmVydGVkJyxcbiAgICBsZWdhY3kgICAgIDogJ2xlZ2FjeScsXG4gICAgbG9hZGluZyAgICA6ICdsb2FkaW5nJyxcbiAgICBzY3JvbGxpbmcgIDogJ3Njcm9sbGluZycsXG4gICAgdW5kZXRhY2hlZCA6ICd1bmRldGFjaGVkJ1xuICB9XG59O1xuXG5cbn0pKCBqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQgKTtcblxuLyohXG4gKiAjIFNlbWFudGljIFVJIDIuNC4wIC0gTmFnXG4gKiBodHRwOi8vZ2l0aHViLmNvbS9zZW1hbnRpYy1vcmcvc2VtYW50aWMtdWkvXG4gKlxuICpcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuICpcbiAqL1xuXG47KGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHtcblxuJ3VzZSBzdHJpY3QnO1xuXG53aW5kb3cgPSAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoKVxuICA/IHdpbmRvd1xuICA6ICh0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aClcbiAgICA/IHNlbGZcbiAgICA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKClcbjtcblxuJC5mbi5uYWcgPSBmdW5jdGlvbihwYXJhbWV0ZXJzKSB7XG4gIHZhclxuICAgICRhbGxNb2R1bGVzICAgID0gJCh0aGlzKSxcbiAgICBtb2R1bGVTZWxlY3RvciA9ICRhbGxNb2R1bGVzLnNlbGVjdG9yIHx8ICcnLFxuXG4gICAgdGltZSAgICAgICAgICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICBwZXJmb3JtYW5jZSAgICA9IFtdLFxuXG4gICAgcXVlcnkgICAgICAgICAgPSBhcmd1bWVudHNbMF0sXG4gICAgbWV0aG9kSW52b2tlZCAgPSAodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnKSxcbiAgICBxdWVyeUFyZ3VtZW50cyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcbiAgICByZXR1cm5lZFZhbHVlXG4gIDtcbiAgJGFsbE1vZHVsZXNcbiAgICAuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIHZhclxuICAgICAgICBzZXR0aW5ncyAgICAgICAgICA9ICggJC5pc1BsYWluT2JqZWN0KHBhcmFtZXRlcnMpIClcbiAgICAgICAgICA/ICQuZXh0ZW5kKHRydWUsIHt9LCAkLmZuLm5hZy5zZXR0aW5ncywgcGFyYW1ldGVycylcbiAgICAgICAgICA6ICQuZXh0ZW5kKHt9LCAkLmZuLm5hZy5zZXR0aW5ncyksXG5cbiAgICAgICAgY2xhc3NOYW1lICAgICAgID0gc2V0dGluZ3MuY2xhc3NOYW1lLFxuICAgICAgICBzZWxlY3RvciAgICAgICAgPSBzZXR0aW5ncy5zZWxlY3RvcixcbiAgICAgICAgZXJyb3IgICAgICAgICAgID0gc2V0dGluZ3MuZXJyb3IsXG4gICAgICAgIG5hbWVzcGFjZSAgICAgICA9IHNldHRpbmdzLm5hbWVzcGFjZSxcblxuICAgICAgICBldmVudE5hbWVzcGFjZSAgPSAnLicgKyBuYW1lc3BhY2UsXG4gICAgICAgIG1vZHVsZU5hbWVzcGFjZSA9IG5hbWVzcGFjZSArICctbW9kdWxlJyxcblxuICAgICAgICAkbW9kdWxlICAgICAgICAgPSAkKHRoaXMpLFxuXG4gICAgICAgICRjbG9zZSAgICAgICAgICA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5jbG9zZSksXG4gICAgICAgICRjb250ZXh0ICAgICAgICA9IChzZXR0aW5ncy5jb250ZXh0KVxuICAgICAgICAgID8gJChzZXR0aW5ncy5jb250ZXh0KVxuICAgICAgICAgIDogJCgnYm9keScpLFxuXG4gICAgICAgIGVsZW1lbnQgICAgICAgICA9IHRoaXMsXG4gICAgICAgIGluc3RhbmNlICAgICAgICA9ICRtb2R1bGUuZGF0YShtb2R1bGVOYW1lc3BhY2UpLFxuXG4gICAgICAgIG1vZHVsZU9mZnNldCxcbiAgICAgICAgbW9kdWxlSGVpZ2h0LFxuXG4gICAgICAgIGNvbnRleHRXaWR0aCxcbiAgICAgICAgY29udGV4dEhlaWdodCxcbiAgICAgICAgY29udGV4dE9mZnNldCxcblxuICAgICAgICB5T2Zmc2V0LFxuICAgICAgICB5UG9zaXRpb24sXG5cbiAgICAgICAgdGltZXIsXG4gICAgICAgIG1vZHVsZSxcblxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lXG4gICAgICAgICAgfHwgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAgICAgIHx8IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgICAgICB8fCB3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgICAgICB8fCBmdW5jdGlvbihjYWxsYmFjaykgeyBzZXRUaW1lb3V0KGNhbGxiYWNrLCAwKTsgfVxuICAgICAgO1xuICAgICAgbW9kdWxlID0ge1xuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdJbml0aWFsaXppbmcgZWxlbWVudCcpO1xuXG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLm9uKCdjbGljaycgKyBldmVudE5hbWVzcGFjZSwgc2VsZWN0b3IuY2xvc2UsIG1vZHVsZS5kaXNtaXNzKVxuICAgICAgICAgICAgLmRhdGEobW9kdWxlTmFtZXNwYWNlLCBtb2R1bGUpXG4gICAgICAgICAgO1xuXG4gICAgICAgICAgaWYoc2V0dGluZ3MuZGV0YWNoYWJsZSAmJiAkbW9kdWxlLnBhcmVudCgpWzBdICE9PSAkY29udGV4dFswXSkge1xuICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAuZGV0YWNoKClcbiAgICAgICAgICAgICAgLnByZXBlbmRUbygkY29udGV4dClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZihzZXR0aW5ncy5kaXNwbGF5VGltZSA+IDApIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQobW9kdWxlLmhpZGUsIHNldHRpbmdzLmRpc3BsYXlUaW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbW9kdWxlLnNob3coKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRGVzdHJveWluZyBpbnN0YW5jZScpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5yZW1vdmVEYXRhKG1vZHVsZU5hbWVzcGFjZSlcbiAgICAgICAgICAgIC5vZmYoZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCBtb2R1bGUuc2hvdWxkLnNob3coKSAmJiAhJG1vZHVsZS5pcygnOnZpc2libGUnKSApIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2hvd2luZyBuYWcnLCBzZXR0aW5ncy5hbmltYXRpb24uc2hvdyk7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5hbmltYXRpb24uc2hvdyA9PSAnZmFkZScpIHtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5mYWRlSW4oc2V0dGluZ3MuZHVyYXRpb24sIHNldHRpbmdzLmVhc2luZylcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgICAuc2xpZGVEb3duKHNldHRpbmdzLmR1cmF0aW9uLCBzZXR0aW5ncy5lYXNpbmcpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGlkZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaG93aW5nIG5hZycsIHNldHRpbmdzLmFuaW1hdGlvbi5oaWRlKTtcbiAgICAgICAgICBpZihzZXR0aW5ncy5hbmltYXRpb24uc2hvdyA9PSAnZmFkZScpIHtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLmZhZGVJbihzZXR0aW5ncy5kdXJhdGlvbiwgc2V0dGluZ3MuZWFzaW5nKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLnNsaWRlVXAoc2V0dGluZ3MuZHVyYXRpb24sIHNldHRpbmdzLmVhc2luZylcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgb25IaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JlbW92aW5nIG5hZycsIHNldHRpbmdzLmFuaW1hdGlvbi5oaWRlKTtcbiAgICAgICAgICAkbW9kdWxlLnJlbW92ZSgpO1xuICAgICAgICAgIGlmIChzZXR0aW5ncy5vbkhpZGUpIHtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uSGlkZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkaXNtaXNzOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIGlmKHNldHRpbmdzLnN0b3JhZ2VNZXRob2QpIHtcbiAgICAgICAgICAgIG1vZHVsZS5zdG9yYWdlLnNldChzZXR0aW5ncy5rZXksIHNldHRpbmdzLnZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbW9kdWxlLmhpZGUoKTtcbiAgICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3VsZDoge1xuICAgICAgICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyc2lzdCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1BlcnNpc3RlbnQgbmFnIGlzIHNldCwgY2FuIHNob3cgbmFnJyk7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIG1vZHVsZS5zdG9yYWdlLmdldChzZXR0aW5ncy5rZXkpICE9IHNldHRpbmdzLnZhbHVlLnRvU3RyaW5nKCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU3RvcmVkIHZhbHVlIGlzIG5vdCBzZXQsIGNhbiBzaG93IG5hZycsIG1vZHVsZS5zdG9yYWdlLmdldChzZXR0aW5ncy5rZXkpKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1N0b3JlZCB2YWx1ZSBpcyBzZXQsIGNhbm5vdCBzaG93IG5hZycsIG1vZHVsZS5zdG9yYWdlLmdldChzZXR0aW5ncy5rZXkpKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0OiB7XG4gICAgICAgICAgc3RvcmFnZU9wdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIG9wdGlvbnMgPSB7fVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuZXhwaXJlcykge1xuICAgICAgICAgICAgICBvcHRpb25zLmV4cGlyZXMgPSBzZXR0aW5ncy5leHBpcmVzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoc2V0dGluZ3MuZG9tYWluKSB7XG4gICAgICAgICAgICAgIG9wdGlvbnMuZG9tYWluID0gc2V0dGluZ3MuZG9tYWluO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGF0aCkge1xuICAgICAgICAgICAgICBvcHRpb25zLnBhdGggPSBzZXR0aW5ncy5wYXRoO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG9wdGlvbnM7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNsZWFyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUuc3RvcmFnZS5yZW1vdmUoc2V0dGluZ3Mua2V5KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzdG9yYWdlOiB7XG4gICAgICAgICAgc2V0OiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgb3B0aW9ucyA9IG1vZHVsZS5nZXQuc3RvcmFnZU9wdGlvbnMoKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3Muc3RvcmFnZU1ldGhvZCA9PSAnbG9jYWxzdG9yYWdlJyAmJiB3aW5kb3cubG9jYWxTdG9yYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1ZhbHVlIHN0b3JlZCB1c2luZyBsb2NhbCBzdG9yYWdlJywga2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKHNldHRpbmdzLnN0b3JhZ2VNZXRob2QgPT0gJ3Nlc3Npb25zdG9yYWdlJyAmJiB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShrZXksIHZhbHVlKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdWYWx1ZSBzdG9yZWQgdXNpbmcgc2Vzc2lvbiBzdG9yYWdlJywga2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKCQuY29va2llICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgJC5jb29raWUoa2V5LCB2YWx1ZSwgb3B0aW9ucyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVmFsdWUgc3RvcmVkIHVzaW5nIGNvb2tpZScsIGtleSwgdmFsdWUsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5ub0Nvb2tpZVN0b3JhZ2UpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBzdG9yZWRWYWx1ZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3Muc3RvcmFnZU1ldGhvZCA9PSAnbG9jYWxzdG9yYWdlJyAmJiB3aW5kb3cubG9jYWxTdG9yYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgc3RvcmVkVmFsdWUgPSB3aW5kb3cubG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoc2V0dGluZ3Muc3RvcmFnZU1ldGhvZCA9PSAnc2Vzc2lvbnN0b3JhZ2UnICYmIHdpbmRvdy5zZXNzaW9uU3RvcmFnZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIHN0b3JlZFZhbHVlID0gd2luZG93LnNlc3Npb25TdG9yYWdlLmdldEl0ZW0oa2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGdldCBieSBjb29raWVcbiAgICAgICAgICAgIGVsc2UgaWYoJC5jb29raWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBzdG9yZWRWYWx1ZSA9ICQuY29va2llKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm5vQ29va2llU3RvcmFnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzdG9yZWRWYWx1ZSA9PSAndW5kZWZpbmVkJyB8fCBzdG9yZWRWYWx1ZSA9PSAnbnVsbCcgfHwgc3RvcmVkVmFsdWUgPT09IHVuZGVmaW5lZCB8fCBzdG9yZWRWYWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICBzdG9yZWRWYWx1ZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzdG9yZWRWYWx1ZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlbW92ZTogZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgb3B0aW9ucyA9IG1vZHVsZS5nZXQuc3RvcmFnZU9wdGlvbnMoKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3Muc3RvcmFnZU1ldGhvZCA9PSAnbG9jYWxzdG9yYWdlJyAmJiB3aW5kb3cubG9jYWxTdG9yYWdlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgd2luZG93LmxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKHNldHRpbmdzLnN0b3JhZ2VNZXRob2QgPT0gJ3Nlc3Npb25zdG9yYWdlJyAmJiB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICB3aW5kb3cuc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gc3RvcmUgYnkgY29va2llXG4gICAgICAgICAgICBlbHNlIGlmKCQuY29va2llICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgJC5yZW1vdmVDb29raWUoa2V5LCBvcHRpb25zKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3Iubm9TdG9yYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dGluZzogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NoYW5naW5nIHNldHRpbmcnLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZigkLmlzUGxhaW5PYmplY3Qoc2V0dGluZ3NbbmFtZV0pKSB7XG4gICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzW25hbWVdLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3NbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZ3NbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnRlcm5hbDogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgbW9kdWxlLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBtb2R1bGVbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZGVidWc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1Zy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdmVyYm9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCAmJiBzZXR0aW5ncy52ZXJib3NlICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCkge1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmVycm9yLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvci5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGVyZm9ybWFuY2U6IHtcbiAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjdXJyZW50VGltZSxcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSxcbiAgICAgICAgICAgICAgcHJldmlvdXNUaW1lXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBjdXJyZW50VGltZSAgID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZSAgPSB0aW1lIHx8IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICBleGVjdXRpb25UaW1lID0gY3VycmVudFRpbWUgLSBwcmV2aW91c1RpbWU7XG4gICAgICAgICAgICAgIHRpbWUgICAgICAgICAgPSBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgcGVyZm9ybWFuY2UucHVzaCh7XG4gICAgICAgICAgICAgICAgJ05hbWUnICAgICAgICAgICA6IG1lc3NhZ2VbMF0sXG4gICAgICAgICAgICAgICAgJ0FyZ3VtZW50cycgICAgICA6IFtdLnNsaWNlLmNhbGwobWVzc2FnZSwgMSkgfHwgJycsXG4gICAgICAgICAgICAgICAgJ0VsZW1lbnQnICAgICAgICA6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgJ0V4ZWN1dGlvbiBUaW1lJyA6IGV4ZWN1dGlvblRpbWVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lciA9IHNldFRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLmRpc3BsYXksIDUwMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNwbGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB0aXRsZSA9IHNldHRpbmdzLm5hbWUgKyAnOicsXG4gICAgICAgICAgICAgIHRvdGFsVGltZSA9IDBcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHRpbWUgPSBmYWxzZTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICB0b3RhbFRpbWUgKz0gZGF0YVsnRXhlY3V0aW9uIFRpbWUnXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGl0bGUgKz0gJyAnICsgdG90YWxUaW1lICsgJ21zJztcbiAgICAgICAgICAgIGlmKG1vZHVsZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgIHRpdGxlICs9ICcgXFwnJyArIG1vZHVsZVNlbGVjdG9yICsgJ1xcJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggKGNvbnNvbGUuZ3JvdXAgIT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLnRhYmxlICE9PSB1bmRlZmluZWQpICYmIHBlcmZvcm1hbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgICAgIGlmKGNvbnNvbGUudGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKHBlcmZvcm1hbmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZXJmb3JtYW5jZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm1ldGhvZCwgcXVlcnkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCBmb3VuZCApICkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZC5hcHBseShjb250ZXh0LCBwYXNzZWRBcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGZvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCQuaXNBcnJheShyZXR1cm5lZFZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZS5wdXNoKHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSBbcmV0dXJuZWRWYWx1ZSwgcmVzcG9uc2VdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSByZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgICAgIGlmKGluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbnZva2UocXVlcnkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmKGluc3RhbmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpbnN0YW5jZS5pbnZva2UoJ2Rlc3Ryb3knKTtcbiAgICAgICAgfVxuICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgfVxuICAgIH0pXG4gIDtcblxuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xufTtcblxuJC5mbi5uYWcuc2V0dGluZ3MgPSB7XG5cbiAgbmFtZSAgICAgICAgOiAnTmFnJyxcblxuICBzaWxlbnQgICAgICA6IGZhbHNlLFxuICBkZWJ1ZyAgICAgICA6IGZhbHNlLFxuICB2ZXJib3NlICAgICA6IGZhbHNlLFxuICBwZXJmb3JtYW5jZSA6IHRydWUsXG5cbiAgbmFtZXNwYWNlICAgOiAnTmFnJyxcblxuICAvLyBhbGxvd3MgY29va2llIHRvIGJlIG92ZXJyaWRkZW5cbiAgcGVyc2lzdCAgICAgOiBmYWxzZSxcblxuICAvLyBzZXQgdG8gemVybyB0byByZXF1aXJlIG1hbnVhbGx5IGRpc21pc3NhbCwgb3RoZXJ3aXNlIGhpZGVzIG9uIGl0cyBvd25cbiAgZGlzcGxheVRpbWUgOiAwLFxuXG4gIGFuaW1hdGlvbiAgIDoge1xuICAgIHNob3cgOiAnc2xpZGUnLFxuICAgIGhpZGUgOiAnc2xpZGUnXG4gIH0sXG5cbiAgY29udGV4dCAgICAgICA6IGZhbHNlLFxuICBkZXRhY2hhYmxlICAgIDogZmFsc2UsXG5cbiAgZXhwaXJlcyAgICAgICA6IDMwLFxuICBkb21haW4gICAgICAgIDogZmFsc2UsXG4gIHBhdGggICAgICAgICAgOiAnLycsXG5cbiAgLy8gdHlwZSBvZiBzdG9yYWdlIHRvIHVzZVxuICBzdG9yYWdlTWV0aG9kIDogJ2Nvb2tpZScsXG5cbiAgLy8gdmFsdWUgdG8gc3RvcmUgaW4gZGlzbWlzc2VkIGxvY2Fsc3RvcmFnZS9jb29raWVcbiAga2V5ICAgICAgICAgICA6ICduYWcnLFxuICB2YWx1ZSAgICAgICAgIDogJ2Rpc21pc3MnLFxuXG4gIGVycm9yOiB7XG4gICAgbm9Db29raWVTdG9yYWdlIDogJyQuY29va2llIGlzIG5vdCBpbmNsdWRlZC4gQSBzdG9yYWdlIHNvbHV0aW9uIGlzIHJlcXVpcmVkLicsXG4gICAgbm9TdG9yYWdlICAgICAgIDogJ05laXRoZXIgJC5jb29raWUgb3Igc3RvcmUgaXMgZGVmaW5lZC4gQSBzdG9yYWdlIHNvbHV0aW9uIGlzIHJlcXVpcmVkIGZvciBzdG9yaW5nIHN0YXRlJyxcbiAgICBtZXRob2QgICAgICAgICAgOiAnVGhlIG1ldGhvZCB5b3UgY2FsbGVkIGlzIG5vdCBkZWZpbmVkLidcbiAgfSxcblxuICBjbGFzc05hbWUgICAgIDoge1xuICAgIGJvdHRvbSA6ICdib3R0b20nLFxuICAgIGZpeGVkICA6ICdmaXhlZCdcbiAgfSxcblxuICBzZWxlY3RvciAgICAgIDoge1xuICAgIGNsb3NlIDogJy5jbG9zZS5pY29uJ1xuICB9LFxuXG4gIHNwZWVkICAgICAgICAgOiA1MDAsXG4gIGVhc2luZyAgICAgICAgOiAnZWFzZU91dFF1YWQnLFxuXG4gIG9uSGlkZTogZnVuY3Rpb24oKSB7fVxuXG59O1xuXG4vLyBBZGRzIGVhc2luZ1xuJC5leHRlbmQoICQuZWFzaW5nLCB7XG4gIGVhc2VPdXRRdWFkOiBmdW5jdGlvbiAoeCwgdCwgYiwgYywgZCkge1xuICAgIHJldHVybiAtYyAqKHQvPWQpKih0LTIpICsgYjtcbiAgfVxufSk7XG5cbn0pKCBqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQgKTtcblxuLyohXG4gKiAjIFNlbWFudGljIFVJIDIuNC4wIC0gUG9wdXBcbiAqIGh0dHA6Ly9naXRodWIuY29tL3NlbWFudGljLW9yZy9zZW1hbnRpYy11aS9cbiAqXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG5cbjsoZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG4ndXNlIHN0cmljdCc7XG5cbndpbmRvdyA9ICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGgpXG4gID8gd2luZG93XG4gIDogKHR5cGVvZiBzZWxmICE9ICd1bmRlZmluZWQnICYmIHNlbGYuTWF0aCA9PSBNYXRoKVxuICAgID8gc2VsZlxuICAgIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKVxuO1xuXG4kLmZuLnBvcHVwID0gZnVuY3Rpb24ocGFyYW1ldGVycykge1xuICB2YXJcbiAgICAkYWxsTW9kdWxlcyAgICA9ICQodGhpcyksXG4gICAgJGRvY3VtZW50ICAgICAgPSAkKGRvY3VtZW50KSxcbiAgICAkd2luZG93ICAgICAgICA9ICQod2luZG93KSxcbiAgICAkYm9keSAgICAgICAgICA9ICQoJ2JvZHknKSxcblxuICAgIG1vZHVsZVNlbGVjdG9yID0gJGFsbE1vZHVsZXMuc2VsZWN0b3IgfHwgJycsXG5cbiAgICBoYXNUb3VjaCAgICAgICA9ICh0cnVlKSxcbiAgICB0aW1lICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgID0gW10sXG5cbiAgICBxdWVyeSAgICAgICAgICA9IGFyZ3VtZW50c1swXSxcbiAgICBtZXRob2RJbnZva2VkICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLFxuXG4gICAgcmV0dXJuZWRWYWx1ZVxuICA7XG4gICRhbGxNb2R1bGVzXG4gICAgLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXJcbiAgICAgICAgc2V0dGluZ3MgICAgICAgID0gKCAkLmlzUGxhaW5PYmplY3QocGFyYW1ldGVycykgKVxuICAgICAgICAgID8gJC5leHRlbmQodHJ1ZSwge30sICQuZm4ucG9wdXAuc2V0dGluZ3MsIHBhcmFtZXRlcnMpXG4gICAgICAgICAgOiAkLmV4dGVuZCh7fSwgJC5mbi5wb3B1cC5zZXR0aW5ncyksXG5cbiAgICAgICAgc2VsZWN0b3IgICAgICAgICAgID0gc2V0dGluZ3Muc2VsZWN0b3IsXG4gICAgICAgIGNsYXNzTmFtZSAgICAgICAgICA9IHNldHRpbmdzLmNsYXNzTmFtZSxcbiAgICAgICAgZXJyb3IgICAgICAgICAgICAgID0gc2V0dGluZ3MuZXJyb3IsXG4gICAgICAgIG1ldGFkYXRhICAgICAgICAgICA9IHNldHRpbmdzLm1ldGFkYXRhLFxuICAgICAgICBuYW1lc3BhY2UgICAgICAgICAgPSBzZXR0aW5ncy5uYW1lc3BhY2UsXG5cbiAgICAgICAgZXZlbnROYW1lc3BhY2UgICAgID0gJy4nICsgc2V0dGluZ3MubmFtZXNwYWNlLFxuICAgICAgICBtb2R1bGVOYW1lc3BhY2UgICAgPSAnbW9kdWxlLScgKyBuYW1lc3BhY2UsXG5cbiAgICAgICAgJG1vZHVsZSAgICAgICAgICAgID0gJCh0aGlzKSxcbiAgICAgICAgJGNvbnRleHQgICAgICAgICAgID0gJChzZXR0aW5ncy5jb250ZXh0KSxcbiAgICAgICAgJHNjcm9sbENvbnRleHQgICAgID0gJChzZXR0aW5ncy5zY3JvbGxDb250ZXh0KSxcbiAgICAgICAgJGJvdW5kYXJ5ICAgICAgICAgID0gJChzZXR0aW5ncy5ib3VuZGFyeSksXG4gICAgICAgICR0YXJnZXQgICAgICAgICAgICA9IChzZXR0aW5ncy50YXJnZXQpXG4gICAgICAgICAgPyAkKHNldHRpbmdzLnRhcmdldClcbiAgICAgICAgICA6ICRtb2R1bGUsXG5cbiAgICAgICAgJHBvcHVwLFxuICAgICAgICAkb2Zmc2V0UGFyZW50LFxuXG4gICAgICAgIHNlYXJjaERlcHRoICAgICAgICA9IDAsXG4gICAgICAgIHRyaWVkUG9zaXRpb25zICAgICA9IGZhbHNlLFxuICAgICAgICBvcGVuZWRXaXRoVG91Y2ggICAgPSBmYWxzZSxcblxuICAgICAgICBlbGVtZW50ICAgICAgICAgICAgPSB0aGlzLFxuICAgICAgICBpbnN0YW5jZSAgICAgICAgICAgPSAkbW9kdWxlLmRhdGEobW9kdWxlTmFtZXNwYWNlKSxcblxuICAgICAgICBkb2N1bWVudE9ic2VydmVyLFxuICAgICAgICBlbGVtZW50TmFtZXNwYWNlLFxuICAgICAgICBpZCxcbiAgICAgICAgbW9kdWxlXG4gICAgICA7XG5cbiAgICAgIG1vZHVsZSA9IHtcblxuICAgICAgICAvLyBiaW5kcyBldmVudHNcbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdJbml0aWFsaXppbmcnLCAkbW9kdWxlKTtcbiAgICAgICAgICBtb2R1bGUuY3JlYXRlSUQoKTtcbiAgICAgICAgICBtb2R1bGUuYmluZC5ldmVudHMoKTtcbiAgICAgICAgICBpZighbW9kdWxlLmV4aXN0cygpICYmIHNldHRpbmdzLnByZXNlcnZlKSB7XG4gICAgICAgICAgICBtb2R1bGUuY3JlYXRlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKHNldHRpbmdzLm9ic2VydmVDaGFuZ2VzKSB7XG4gICAgICAgICAgICBtb2R1bGUub2JzZXJ2ZUNoYW5nZXMoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbW9kdWxlLmluc3RhbnRpYXRlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5zdGFudGlhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTdG9yaW5nIGluc3RhbmNlJywgbW9kdWxlKTtcbiAgICAgICAgICBpbnN0YW5jZSA9IG1vZHVsZTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAuZGF0YShtb2R1bGVOYW1lc3BhY2UsIGluc3RhbmNlKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBvYnNlcnZlQ2hhbmdlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoJ011dGF0aW9uT2JzZXJ2ZXInIGluIHdpbmRvdykge1xuICAgICAgICAgICAgZG9jdW1lbnRPYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKG1vZHVsZS5ldmVudC5kb2N1bWVudENoYW5nZWQpO1xuICAgICAgICAgICAgZG9jdW1lbnRPYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LCB7XG4gICAgICAgICAgICAgIGNoaWxkTGlzdCA6IHRydWUsXG4gICAgICAgICAgICAgIHN1YnRyZWUgICA6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZXR0aW5nIHVwIG11dGF0aW9uIG9ic2VydmVyJywgZG9jdW1lbnRPYnNlcnZlcik7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKHNldHRpbmdzLnBvcHVwKSB7XG4gICAgICAgICAgICAkcG9wdXAgPSAkKHNldHRpbmdzLnBvcHVwKS5lcSgwKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5pbmxpbmUpIHtcbiAgICAgICAgICAgICAgJHBvcHVwID0gJHRhcmdldC5uZXh0QWxsKHNlbGVjdG9yLnBvcHVwKS5lcSgwKTtcbiAgICAgICAgICAgICAgc2V0dGluZ3MucG9wdXAgPSAkcG9wdXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKHNldHRpbmdzLnBvcHVwKSB7XG4gICAgICAgICAgICAkcG9wdXAuYWRkQ2xhc3MoY2xhc3NOYW1lLmxvYWRpbmcpO1xuICAgICAgICAgICAgJG9mZnNldFBhcmVudCA9IG1vZHVsZS5nZXQub2Zmc2V0UGFyZW50KCk7XG4gICAgICAgICAgICAkcG9wdXAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmxvYWRpbmcpO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MubW92ZVBvcHVwICYmIG1vZHVsZS5oYXMucG9wdXAoKSAmJiBtb2R1bGUuZ2V0Lm9mZnNldFBhcmVudCgkcG9wdXApWzBdICE9PSAkb2Zmc2V0UGFyZW50WzBdKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnTW92aW5nIHBvcHVwIHRvIHRoZSBzYW1lIG9mZnNldCBwYXJlbnQgYXMgdGFyZ2V0Jyk7XG4gICAgICAgICAgICAgICRwb3B1cFxuICAgICAgICAgICAgICAgIC5kZXRhY2goKVxuICAgICAgICAgICAgICAgIC5hcHBlbmRUbygkb2Zmc2V0UGFyZW50KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJG9mZnNldFBhcmVudCA9IChzZXR0aW5ncy5pbmxpbmUpXG4gICAgICAgICAgICAgID8gbW9kdWxlLmdldC5vZmZzZXRQYXJlbnQoJHRhcmdldClcbiAgICAgICAgICAgICAgOiBtb2R1bGUuaGFzLnBvcHVwKClcbiAgICAgICAgICAgICAgICA/IG1vZHVsZS5nZXQub2Zmc2V0UGFyZW50KCRwb3B1cClcbiAgICAgICAgICAgICAgICA6ICRib2R5XG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCAkb2Zmc2V0UGFyZW50LmlzKCdodG1sJykgJiYgJG9mZnNldFBhcmVudFswXSAhPT0gJGJvZHlbMF0gKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgcGFnZSBhcyBvZmZzZXQgcGFyZW50Jyk7XG4gICAgICAgICAgICAkb2Zmc2V0UGFyZW50ID0gJGJvZHk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCBtb2R1bGUuZ2V0LnZhcmlhdGlvbigpICkge1xuICAgICAgICAgICAgbW9kdWxlLnNldC52YXJpYXRpb24oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVwb3NpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnJlZnJlc2goKTtcbiAgICAgICAgICBtb2R1bGUuc2V0LnBvc2l0aW9uKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdEZXN0cm95aW5nIHByZXZpb3VzIG1vZHVsZScpO1xuICAgICAgICAgIGlmKGRvY3VtZW50T2JzZXJ2ZXIpIHtcbiAgICAgICAgICAgIGRvY3VtZW50T2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyByZW1vdmUgZWxlbWVudCBvbmx5IGlmIHdhcyBjcmVhdGVkIGR5bmFtaWNhbGx5XG4gICAgICAgICAgaWYoJHBvcHVwICYmICFzZXR0aW5ncy5wcmVzZXJ2ZSkge1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZVBvcHVwKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIGNsZWFyIGFsbCB0aW1lb3V0c1xuICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUuaGlkZVRpbWVyKTtcbiAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnNob3dUaW1lcik7XG4gICAgICAgICAgLy8gcmVtb3ZlIGV2ZW50c1xuICAgICAgICAgIG1vZHVsZS51bmJpbmQuY2xvc2UoKTtcbiAgICAgICAgICBtb2R1bGUudW5iaW5kLmV2ZW50cygpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5yZW1vdmVEYXRhKG1vZHVsZU5hbWVzcGFjZSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXZlbnQ6IHtcbiAgICAgICAgICBzdGFydDogIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZGVsYXkgPSAoJC5pc1BsYWluT2JqZWN0KHNldHRpbmdzLmRlbGF5KSlcbiAgICAgICAgICAgICAgICA/IHNldHRpbmdzLmRlbGF5LnNob3dcbiAgICAgICAgICAgICAgICA6IHNldHRpbmdzLmRlbGF5XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLmhpZGVUaW1lcik7XG4gICAgICAgICAgICBpZighb3BlbmVkV2l0aFRvdWNoKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zaG93VGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5zaG93LCBkZWxheSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlbmQ6ICBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBkZWxheSA9ICgkLmlzUGxhaW5PYmplY3Qoc2V0dGluZ3MuZGVsYXkpKVxuICAgICAgICAgICAgICAgID8gc2V0dGluZ3MuZGVsYXkuaGlkZVxuICAgICAgICAgICAgICAgIDogc2V0dGluZ3MuZGVsYXlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUuc2hvd1RpbWVyKTtcbiAgICAgICAgICAgIG1vZHVsZS5oaWRlVGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5oaWRlLCBkZWxheSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0b3VjaHN0YXJ0OiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgb3BlbmVkV2l0aFRvdWNoID0gdHJ1ZTtcbiAgICAgICAgICAgIG1vZHVsZS5zaG93KCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXNpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy52aXNpYmxlKCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQucG9zaXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGRvY3VtZW50Q2hhbmdlZDogZnVuY3Rpb24obXV0YXRpb25zKSB7XG4gICAgICAgICAgICBbXS5mb3JFYWNoLmNhbGwobXV0YXRpb25zLCBmdW5jdGlvbihtdXRhdGlvbikge1xuICAgICAgICAgICAgICBpZihtdXRhdGlvbi5yZW1vdmVkTm9kZXMpIHtcbiAgICAgICAgICAgICAgICBbXS5mb3JFYWNoLmNhbGwobXV0YXRpb24ucmVtb3ZlZE5vZGVzLCBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgICAgICAgICAgICBpZihub2RlID09IGVsZW1lbnQgfHwgJChub2RlKS5maW5kKGVsZW1lbnQpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdFbGVtZW50IHJlbW92ZWQgZnJvbSBET00sIHRlYXJpbmcgZG93biBldmVudHMnKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBoaWRlR3JhY2VmdWxseTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkdGFyZ2V0ID0gJChldmVudC50YXJnZXQpLFxuICAgICAgICAgICAgICBpc0luRE9NID0gJC5jb250YWlucyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGV2ZW50LnRhcmdldCksXG4gICAgICAgICAgICAgIGluUG9wdXAgPSAoJHRhcmdldC5jbG9zZXN0KHNlbGVjdG9yLnBvcHVwKS5sZW5ndGggPiAwKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgLy8gZG9uJ3QgY2xvc2Ugb24gY2xpY2tzIGluc2lkZSBwb3B1cFxuICAgICAgICAgICAgaWYoZXZlbnQgJiYgIWluUG9wdXAgJiYgaXNJbkRPTSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NsaWNrIG9jY3VycmVkIG91dHNpZGUgcG9wdXAgaGlkaW5nIHBvcHVwJyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5oaWRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDbGljayB3YXMgaW5zaWRlIHBvcHVwLCBrZWVwaW5nIHBvcHVwIG9wZW4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gZ2VuZXJhdGVzIHBvcHVwIGh0bWwgZnJvbSBtZXRhZGF0YVxuICAgICAgICBjcmVhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgaHRtbCAgICAgID0gbW9kdWxlLmdldC5odG1sKCksXG4gICAgICAgICAgICB0aXRsZSAgICAgPSBtb2R1bGUuZ2V0LnRpdGxlKCksXG4gICAgICAgICAgICBjb250ZW50ICAgPSBtb2R1bGUuZ2V0LmNvbnRlbnQoKVxuICAgICAgICAgIDtcblxuICAgICAgICAgIGlmKGh0bWwgfHwgY29udGVudCB8fCB0aXRsZSkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDcmVhdGluZyBwb3AtdXAgaHRtbCcpO1xuICAgICAgICAgICAgaWYoIWh0bWwpIHtcbiAgICAgICAgICAgICAgaHRtbCA9IHNldHRpbmdzLnRlbXBsYXRlcy5wb3B1cCh7XG4gICAgICAgICAgICAgICAgdGl0bGUgICA6IHRpdGxlLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQgOiBjb250ZW50XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHBvcHVwID0gJCgnPGRpdi8+JylcbiAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5wb3B1cClcbiAgICAgICAgICAgICAgLmRhdGEobWV0YWRhdGEuYWN0aXZhdG9yLCAkbW9kdWxlKVxuICAgICAgICAgICAgICAuaHRtbChodG1sKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuaW5saW5lKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdJbnNlcnRpbmcgcG9wdXAgZWxlbWVudCBpbmxpbmUnLCAkcG9wdXApO1xuICAgICAgICAgICAgICAkcG9wdXBcbiAgICAgICAgICAgICAgICAuaW5zZXJ0QWZ0ZXIoJG1vZHVsZSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBcHBlbmRpbmcgcG9wdXAgZWxlbWVudCB0byBib2R5JywgJHBvcHVwKTtcbiAgICAgICAgICAgICAgJHBvcHVwXG4gICAgICAgICAgICAgICAgLmFwcGVuZFRvKCAkY29udGV4dCApXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LnZhcmlhdGlvbigpO1xuXG4gICAgICAgICAgICBpZihzZXR0aW5ncy5ob3ZlcmFibGUpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmJpbmQucG9wdXAoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldHRpbmdzLm9uQ3JlYXRlLmNhbGwoJHBvcHVwLCBlbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZigkdGFyZ2V0Lm5leHQoc2VsZWN0b3IucG9wdXApLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1ByZS1leGlzdGluZyBwb3B1cCBmb3VuZCcpO1xuICAgICAgICAgICAgc2V0dGluZ3MuaW5saW5lID0gdHJ1ZTtcbiAgICAgICAgICAgIHNldHRpbmdzLnBvcHVwICA9ICR0YXJnZXQubmV4dChzZWxlY3Rvci5wb3B1cCkuZGF0YShtZXRhZGF0YS5hY3RpdmF0b3IsICRtb2R1bGUpO1xuICAgICAgICAgICAgbW9kdWxlLnJlZnJlc2goKTtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmhvdmVyYWJsZSkge1xuICAgICAgICAgICAgICBtb2R1bGUuYmluZC5wb3B1cCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHNldHRpbmdzLnBvcHVwKSB7XG4gICAgICAgICAgICAkKHNldHRpbmdzLnBvcHVwKS5kYXRhKG1ldGFkYXRhLmFjdGl2YXRvciwgJG1vZHVsZSk7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnVXNlZCBwb3B1cCBzcGVjaWZpZWQgaW4gc2V0dGluZ3MnKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5ob3ZlcmFibGUpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmJpbmQucG9wdXAoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ05vIGNvbnRlbnQgc3BlY2lmaWVkIHNraXBwaW5nIGRpc3BsYXknLCBlbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY3JlYXRlSUQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlkID0gKE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpICsgJzAwMDAwMDAwMCcpLnN1YnN0cigyLCA4KTtcbiAgICAgICAgICBlbGVtZW50TmFtZXNwYWNlID0gJy4nICsgaWQ7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0NyZWF0aW5nIHVuaXF1ZSBpZCBmb3IgZWxlbWVudCcsIGlkKTtcbiAgICAgICAgfSxcblxuICAgICAgICAvLyBkZXRlcm1pbmVzIHBvcHVwIHN0YXRlXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdUb2dnbGluZyBwb3AtdXAnKTtcbiAgICAgICAgICBpZiggbW9kdWxlLmlzLmhpZGRlbigpICkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdQb3B1cCBpcyBoaWRkZW4sIHNob3dpbmcgcG9wLXVwJyk7XG4gICAgICAgICAgICBtb2R1bGUudW5iaW5kLmNsb3NlKCk7XG4gICAgICAgICAgICBtb2R1bGUuc2hvdygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUG9wdXAgaXMgdmlzaWJsZSwgaGlkaW5nIHBvcC11cCcpO1xuICAgICAgICAgICAgbW9kdWxlLmhpZGUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2hvdzogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uKCl7fTtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Nob3dpbmcgcG9wLXVwJywgc2V0dGluZ3MudHJhbnNpdGlvbik7XG4gICAgICAgICAgaWYobW9kdWxlLmlzLmhpZGRlbigpICYmICEoIG1vZHVsZS5pcy5hY3RpdmUoKSAmJiBtb2R1bGUuaXMuZHJvcGRvd24oKSkgKSB7XG4gICAgICAgICAgICBpZiggIW1vZHVsZS5leGlzdHMoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmNyZWF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoc2V0dGluZ3Mub25TaG93LmNhbGwoJHBvcHVwLCBlbGVtZW50KSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdvblNob3cgY2FsbGJhY2sgcmV0dXJuZWQgZmFsc2UsIGNhbmNlbGxpbmcgcG9wdXAgYW5pbWF0aW9uJyk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoIXNldHRpbmdzLnByZXNlcnZlICYmICFzZXR0aW5ncy5wb3B1cCkge1xuICAgICAgICAgICAgICBtb2R1bGUucmVmcmVzaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoICRwb3B1cCAmJiBtb2R1bGUuc2V0LnBvc2l0aW9uKCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zYXZlLmNvbmRpdGlvbnMoKTtcbiAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuZXhjbHVzaXZlKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmhpZGVBbGwoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBtb2R1bGUuYW5pbWF0ZS5zaG93KGNhbGxiYWNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cblxuICAgICAgICBoaWRlOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgIGNhbGxiYWNrID0gY2FsbGJhY2sgfHwgZnVuY3Rpb24oKXt9O1xuICAgICAgICAgIGlmKCBtb2R1bGUuaXMudmlzaWJsZSgpIHx8IG1vZHVsZS5pcy5hbmltYXRpbmcoKSApIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLm9uSGlkZS5jYWxsKCRwb3B1cCwgZWxlbWVudCkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1Zygnb25IaWRlIGNhbGxiYWNrIHJldHVybmVkIGZhbHNlLCBjYW5jZWxsaW5nIHBvcHVwIGFuaW1hdGlvbicpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnZpc2libGUoKTtcbiAgICAgICAgICAgIG1vZHVsZS51bmJpbmQuY2xvc2UoKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZXN0b3JlLmNvbmRpdGlvbnMoKTtcbiAgICAgICAgICAgIG1vZHVsZS5hbmltYXRlLmhpZGUoY2FsbGJhY2spO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBoaWRlQWxsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAkKHNlbGVjdG9yLnBvcHVwKVxuICAgICAgICAgICAgLmZpbHRlcignLicgKyBjbGFzc05hbWUucG9wdXBWaXNpYmxlKVxuICAgICAgICAgICAgLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICQodGhpcylcbiAgICAgICAgICAgICAgICAuZGF0YShtZXRhZGF0YS5hY3RpdmF0b3IpXG4gICAgICAgICAgICAgICAgICAucG9wdXAoJ2hpZGUnKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcbiAgICAgICAgZXhpc3RzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighJHBvcHVwKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKHNldHRpbmdzLmlubGluZSB8fCBzZXR0aW5ncy5wb3B1cCkge1xuICAgICAgICAgICAgcmV0dXJuICggbW9kdWxlLmhhcy5wb3B1cCgpICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICggJHBvcHVwLmNsb3Nlc3QoJGNvbnRleHQpLmxlbmd0aCA+PSAxIClcbiAgICAgICAgICAgICAgPyB0cnVlXG4gICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVtb3ZlUG9wdXA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCBtb2R1bGUuaGFzLnBvcHVwKCkgJiYgIXNldHRpbmdzLnBvcHVwKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JlbW92aW5nIHBvcHVwJywgJHBvcHVwKTtcbiAgICAgICAgICAgICRwb3B1cC5yZW1vdmUoKTtcbiAgICAgICAgICAgICRwb3B1cCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uUmVtb3ZlLmNhbGwoJHBvcHVwLCBlbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2F2ZToge1xuICAgICAgICAgIGNvbmRpdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLmNhY2hlID0ge1xuICAgICAgICAgICAgICB0aXRsZTogJG1vZHVsZS5hdHRyKCd0aXRsZScpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKG1vZHVsZS5jYWNoZS50aXRsZSkge1xuICAgICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUF0dHIoJ3RpdGxlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2F2aW5nIG9yaWdpbmFsIGF0dHJpYnV0ZXMnLCBtb2R1bGUuY2FjaGUudGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmVzdG9yZToge1xuICAgICAgICAgIGNvbmRpdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmNhY2hlICYmIG1vZHVsZS5jYWNoZS50aXRsZSkge1xuICAgICAgICAgICAgICAkbW9kdWxlLmF0dHIoJ3RpdGxlJywgbW9kdWxlLmNhY2hlLnRpdGxlKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1Jlc3RvcmluZyBvcmlnaW5hbCBhdHRyaWJ1dGVzJywgbW9kdWxlLmNhY2hlLnRpdGxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc3VwcG9ydHM6IHtcbiAgICAgICAgICBzdmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICh0eXBlb2YgU1ZHR3JhcGhpY3NFbGVtZW50ID09PSAndW5kZWZpbmVkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBhbmltYXRlOiB7XG4gICAgICAgICAgc2hvdzogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGNhbGxiYWNrID0gJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKSA/IGNhbGxiYWNrIDogZnVuY3Rpb24oKXt9O1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MudHJhbnNpdGlvbiAmJiAkLmZuLnRyYW5zaXRpb24gIT09IHVuZGVmaW5lZCAmJiAkbW9kdWxlLnRyYW5zaXRpb24oJ2lzIHN1cHBvcnRlZCcpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQudmlzaWJsZSgpO1xuICAgICAgICAgICAgICAkcG9wdXBcbiAgICAgICAgICAgICAgICAudHJhbnNpdGlvbih7XG4gICAgICAgICAgICAgICAgICBhbmltYXRpb24gIDogc2V0dGluZ3MudHJhbnNpdGlvbiArICcgaW4nLFxuICAgICAgICAgICAgICAgICAgcXVldWUgICAgICA6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgZGVidWcgICAgICA6IHNldHRpbmdzLmRlYnVnLFxuICAgICAgICAgICAgICAgICAgdmVyYm9zZSAgICA6IHNldHRpbmdzLnZlcmJvc2UsXG4gICAgICAgICAgICAgICAgICBkdXJhdGlvbiAgIDogc2V0dGluZ3MuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICBvbkNvbXBsZXRlIDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5iaW5kLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwoJHBvcHVwLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25WaXNpYmxlLmNhbGwoJHBvcHVwLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm5vVHJhbnNpdGlvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBoaWRlOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2sgPSAkLmlzRnVuY3Rpb24oY2FsbGJhY2spID8gY2FsbGJhY2sgOiBmdW5jdGlvbigpe307XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0hpZGluZyBwb3AtdXAnKTtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLm9uSGlkZS5jYWxsKCRwb3B1cCwgZWxlbWVudCkgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1Zygnb25IaWRlIGNhbGxiYWNrIHJldHVybmVkIGZhbHNlLCBjYW5jZWxsaW5nIHBvcHVwIGFuaW1hdGlvbicpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzZXR0aW5ncy50cmFuc2l0aW9uICYmICQuZm4udHJhbnNpdGlvbiAhPT0gdW5kZWZpbmVkICYmICRtb2R1bGUudHJhbnNpdGlvbignaXMgc3VwcG9ydGVkJykpIHtcbiAgICAgICAgICAgICAgJHBvcHVwXG4gICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oe1xuICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uICA6IHNldHRpbmdzLnRyYW5zaXRpb24gKyAnIG91dCcsXG4gICAgICAgICAgICAgICAgICBxdWV1ZSAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICBkdXJhdGlvbiAgIDogc2V0dGluZ3MuZHVyYXRpb24sXG4gICAgICAgICAgICAgICAgICBkZWJ1ZyAgICAgIDogc2V0dGluZ3MuZGVidWcsXG4gICAgICAgICAgICAgICAgICB2ZXJib3NlICAgIDogc2V0dGluZ3MudmVyYm9zZSxcbiAgICAgICAgICAgICAgICAgIG9uQ29tcGxldGUgOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwoJHBvcHVwLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25IaWRkZW4uY2FsbCgkcG9wdXAsIGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3Iubm9UcmFuc2l0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2hhbmdlOiB7XG4gICAgICAgICAgY29udGVudDogZnVuY3Rpb24oaHRtbCkge1xuICAgICAgICAgICAgJHBvcHVwLmh0bWwoaHRtbCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGdldDoge1xuICAgICAgICAgIGh0bWw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVEYXRhKG1ldGFkYXRhLmh0bWwpO1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUuZGF0YShtZXRhZGF0YS5odG1sKSB8fCBzZXR0aW5ncy5odG1sO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdGl0bGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVEYXRhKG1ldGFkYXRhLnRpdGxlKTtcbiAgICAgICAgICAgIHJldHVybiAkbW9kdWxlLmRhdGEobWV0YWRhdGEudGl0bGUpIHx8IHNldHRpbmdzLnRpdGxlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY29udGVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZURhdGEobWV0YWRhdGEuY29udGVudCk7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5kYXRhKG1ldGFkYXRhLmNvbnRlbnQpIHx8IHNldHRpbmdzLmNvbnRlbnQgfHwgJG1vZHVsZS5hdHRyKCd0aXRsZScpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFyaWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUucmVtb3ZlRGF0YShtZXRhZGF0YS52YXJpYXRpb24pO1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUuZGF0YShtZXRhZGF0YS52YXJpYXRpb24pIHx8IHNldHRpbmdzLnZhcmlhdGlvbjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBvcHVwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkcG9wdXA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwb3B1cE9mZnNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJHBvcHVwLm9mZnNldCgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2FsY3VsYXRpb25zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkcG9wdXBPZmZzZXRQYXJlbnQgPSBtb2R1bGUuZ2V0Lm9mZnNldFBhcmVudCgkcG9wdXApLFxuICAgICAgICAgICAgICB0YXJnZXRFbGVtZW50ICAgICAgPSAkdGFyZ2V0WzBdLFxuICAgICAgICAgICAgICBpc1dpbmRvdyAgICAgICAgICAgPSAoJGJvdW5kYXJ5WzBdID09IHdpbmRvdyksXG4gICAgICAgICAgICAgIHRhcmdldFBvc2l0aW9uICAgICA9IChzZXR0aW5ncy5pbmxpbmUgfHwgKHNldHRpbmdzLnBvcHVwICYmIHNldHRpbmdzLm1vdmVQb3B1cCkpXG4gICAgICAgICAgICAgICAgPyAkdGFyZ2V0LnBvc2l0aW9uKClcbiAgICAgICAgICAgICAgICA6ICR0YXJnZXQub2Zmc2V0KCksXG4gICAgICAgICAgICAgIHNjcmVlblBvc2l0aW9uID0gKGlzV2luZG93KVxuICAgICAgICAgICAgICAgID8geyB0b3A6IDAsIGxlZnQ6IDAgfVxuICAgICAgICAgICAgICAgIDogJGJvdW5kYXJ5Lm9mZnNldCgpLFxuICAgICAgICAgICAgICBjYWxjdWxhdGlvbnMgICA9IHt9LFxuICAgICAgICAgICAgICBzY3JvbGwgPSAoaXNXaW5kb3cpXG4gICAgICAgICAgICAgICAgPyB7IHRvcDogJHdpbmRvdy5zY3JvbGxUb3AoKSwgbGVmdDogJHdpbmRvdy5zY3JvbGxMZWZ0KCkgfVxuICAgICAgICAgICAgICAgIDogeyB0b3A6IDAsIGxlZnQ6IDB9LFxuICAgICAgICAgICAgICBzY3JlZW5cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGNhbGN1bGF0aW9ucyA9IHtcbiAgICAgICAgICAgICAgLy8gZWxlbWVudCB3aGljaCBpcyBsYXVuY2hpbmcgcG9wdXBcbiAgICAgICAgICAgICAgdGFyZ2V0IDoge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQgOiAkdGFyZ2V0WzBdLFxuICAgICAgICAgICAgICAgIHdpZHRoICAgOiAkdGFyZ2V0Lm91dGVyV2lkdGgoKSxcbiAgICAgICAgICAgICAgICBoZWlnaHQgIDogJHRhcmdldC5vdXRlckhlaWdodCgpLFxuICAgICAgICAgICAgICAgIHRvcCAgICAgOiB0YXJnZXRQb3NpdGlvbi50b3AsXG4gICAgICAgICAgICAgICAgbGVmdCAgICA6IHRhcmdldFBvc2l0aW9uLmxlZnQsXG4gICAgICAgICAgICAgICAgbWFyZ2luICA6IHt9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIC8vIHBvcHVwIGl0c2VsZlxuICAgICAgICAgICAgICBwb3B1cCA6IHtcbiAgICAgICAgICAgICAgICB3aWR0aCAgOiAkcG9wdXAub3V0ZXJXaWR0aCgpLFxuICAgICAgICAgICAgICAgIGhlaWdodCA6ICRwb3B1cC5vdXRlckhlaWdodCgpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIC8vIG9mZnNldCBjb250YWluZXIgKG9yIDNkIGNvbnRleHQpXG4gICAgICAgICAgICAgIHBhcmVudCA6IHtcbiAgICAgICAgICAgICAgICB3aWR0aCAgOiAkb2Zmc2V0UGFyZW50Lm91dGVyV2lkdGgoKSxcbiAgICAgICAgICAgICAgICBoZWlnaHQgOiAkb2Zmc2V0UGFyZW50Lm91dGVySGVpZ2h0KClcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgLy8gc2NyZWVuIGJvdW5kYXJpZXNcbiAgICAgICAgICAgICAgc2NyZWVuIDoge1xuICAgICAgICAgICAgICAgIHRvcCAgOiBzY3JlZW5Qb3NpdGlvbi50b3AsXG4gICAgICAgICAgICAgICAgbGVmdCA6IHNjcmVlblBvc2l0aW9uLmxlZnQsXG4gICAgICAgICAgICAgICAgc2Nyb2xsOiB7XG4gICAgICAgICAgICAgICAgICB0b3AgIDogc2Nyb2xsLnRvcCxcbiAgICAgICAgICAgICAgICAgIGxlZnQgOiBzY3JvbGwubGVmdFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgd2lkdGggIDogJGJvdW5kYXJ5LndpZHRoKCksXG4gICAgICAgICAgICAgICAgaGVpZ2h0IDogJGJvdW5kYXJ5LmhlaWdodCgpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vIGlmIHBvcHVwIG9mZnNldCBjb250ZXh0IGlzIG5vdCBzYW1lIGFzIHRhcmdldCwgdGhlbiBhZGp1c3QgY2FsY3VsYXRpb25zXG4gICAgICAgICAgICBpZigkcG9wdXBPZmZzZXRQYXJlbnQuZ2V0KDApICE9PSAkb2Zmc2V0UGFyZW50LmdldCgwKSkge1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICBwb3B1cE9mZnNldCAgICAgICAgPSAkcG9wdXBPZmZzZXRQYXJlbnQub2Zmc2V0KClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBjYWxjdWxhdGlvbnMudGFyZ2V0LnRvcCAtPSBwb3B1cE9mZnNldC50b3A7XG4gICAgICAgICAgICAgIGNhbGN1bGF0aW9ucy50YXJnZXQubGVmdCAtPSBwb3B1cE9mZnNldC5sZWZ0O1xuICAgICAgICAgICAgICBjYWxjdWxhdGlvbnMucGFyZW50LndpZHRoID0gJHBvcHVwT2Zmc2V0UGFyZW50Lm91dGVyV2lkdGgoKTtcbiAgICAgICAgICAgICAgY2FsY3VsYXRpb25zLnBhcmVudC5oZWlnaHQgPSAkcG9wdXBPZmZzZXRQYXJlbnQub3V0ZXJIZWlnaHQoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYWRkIGluIGNvbnRhaW5lciBjYWxjcyBpZiBmbHVpZFxuICAgICAgICAgICAgaWYoIHNldHRpbmdzLnNldEZsdWlkV2lkdGggJiYgbW9kdWxlLmlzLmZsdWlkKCkgKSB7XG4gICAgICAgICAgICAgIGNhbGN1bGF0aW9ucy5jb250YWluZXIgPSB7XG4gICAgICAgICAgICAgICAgd2lkdGg6ICRwb3B1cC5wYXJlbnQoKS5vdXRlcldpZHRoKClcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgY2FsY3VsYXRpb25zLnBvcHVwLndpZHRoID0gY2FsY3VsYXRpb25zLmNvbnRhaW5lci53aWR0aDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gYWRkIGluIG1hcmdpbnMgaWYgaW5saW5lXG4gICAgICAgICAgICBjYWxjdWxhdGlvbnMudGFyZ2V0Lm1hcmdpbi50b3AgPSAoc2V0dGluZ3MuaW5saW5lKVxuICAgICAgICAgICAgICA/IHBhcnNlSW50KCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0YXJnZXRFbGVtZW50KS5nZXRQcm9wZXJ0eVZhbHVlKCdtYXJnaW4tdG9wJyksIDEwKVxuICAgICAgICAgICAgICA6IDBcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGNhbGN1bGF0aW9ucy50YXJnZXQubWFyZ2luLmxlZnQgPSAoc2V0dGluZ3MuaW5saW5lKVxuICAgICAgICAgICAgICA/IG1vZHVsZS5pcy5ydGwoKVxuICAgICAgICAgICAgICAgID8gcGFyc2VJbnQoIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHRhcmdldEVsZW1lbnQpLmdldFByb3BlcnR5VmFsdWUoJ21hcmdpbi1yaWdodCcpLCAxMClcbiAgICAgICAgICAgICAgICA6IHBhcnNlSW50KCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSh0YXJnZXRFbGVtZW50KS5nZXRQcm9wZXJ0eVZhbHVlKCdtYXJnaW4tbGVmdCcpLCAxMClcbiAgICAgICAgICAgICAgOiAwXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAvLyBjYWxjdWxhdGUgc2NyZWVuIGJvdW5kYXJpZXNcbiAgICAgICAgICAgIHNjcmVlbiA9IGNhbGN1bGF0aW9ucy5zY3JlZW47XG4gICAgICAgICAgICBjYWxjdWxhdGlvbnMuYm91bmRhcnkgPSB7XG4gICAgICAgICAgICAgIHRvcCAgICA6IHNjcmVlbi50b3AgKyBzY3JlZW4uc2Nyb2xsLnRvcCxcbiAgICAgICAgICAgICAgYm90dG9tIDogc2NyZWVuLnRvcCArIHNjcmVlbi5zY3JvbGwudG9wICsgc2NyZWVuLmhlaWdodCxcbiAgICAgICAgICAgICAgbGVmdCAgIDogc2NyZWVuLmxlZnQgKyBzY3JlZW4uc2Nyb2xsLmxlZnQsXG4gICAgICAgICAgICAgIHJpZ2h0ICA6IHNjcmVlbi5sZWZ0ICsgc2NyZWVuLnNjcm9sbC5sZWZ0ICsgc2NyZWVuLndpZHRoXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIGNhbGN1bGF0aW9ucztcbiAgICAgICAgICB9LFxuICAgICAgICAgIGlkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBpZDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN0YXJ0RXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3Mub24gPT0gJ2hvdmVyJykge1xuICAgICAgICAgICAgICByZXR1cm4gJ21vdXNlZW50ZXInO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihzZXR0aW5ncy5vbiA9PSAnZm9jdXMnKSB7XG4gICAgICAgICAgICAgIHJldHVybiAnZm9jdXMnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2Nyb2xsRXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICdzY3JvbGwnO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZW5kRXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3Mub24gPT0gJ2hvdmVyJykge1xuICAgICAgICAgICAgICByZXR1cm4gJ21vdXNlbGVhdmUnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihzZXR0aW5ncy5vbiA9PSAnZm9jdXMnKSB7XG4gICAgICAgICAgICAgIHJldHVybiAnYmx1cic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXN0YW5jZUZyb21Cb3VuZGFyeTogZnVuY3Rpb24ob2Zmc2V0LCBjYWxjdWxhdGlvbnMpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBkaXN0YW5jZUZyb21Cb3VuZGFyeSA9IHt9LFxuICAgICAgICAgICAgICBwb3B1cCxcbiAgICAgICAgICAgICAgYm91bmRhcnlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGNhbGN1bGF0aW9ucyA9IGNhbGN1bGF0aW9ucyB8fCBtb2R1bGUuZ2V0LmNhbGN1bGF0aW9ucygpO1xuXG4gICAgICAgICAgICAvLyBzaG9ydGhhbmRcbiAgICAgICAgICAgIHBvcHVwICAgICAgICA9IGNhbGN1bGF0aW9ucy5wb3B1cDtcbiAgICAgICAgICAgIGJvdW5kYXJ5ICAgICA9IGNhbGN1bGF0aW9ucy5ib3VuZGFyeTtcblxuICAgICAgICAgICAgaWYob2Zmc2V0KSB7XG4gICAgICAgICAgICAgIGRpc3RhbmNlRnJvbUJvdW5kYXJ5ID0ge1xuICAgICAgICAgICAgICAgIHRvcCAgICA6IChvZmZzZXQudG9wIC0gYm91bmRhcnkudG9wKSxcbiAgICAgICAgICAgICAgICBsZWZ0ICAgOiAob2Zmc2V0LmxlZnQgLSBib3VuZGFyeS5sZWZ0KSxcbiAgICAgICAgICAgICAgICByaWdodCAgOiAoYm91bmRhcnkucmlnaHQgLSAob2Zmc2V0LmxlZnQgKyBwb3B1cC53aWR0aCkgKSxcbiAgICAgICAgICAgICAgICBib3R0b20gOiAoYm91bmRhcnkuYm90dG9tIC0gKG9mZnNldC50b3AgKyBwb3B1cC5oZWlnaHQpIClcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0Rpc3RhbmNlIGZyb20gYm91bmRhcmllcyBkZXRlcm1pbmVkJywgb2Zmc2V0LCBkaXN0YW5jZUZyb21Cb3VuZGFyeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZGlzdGFuY2VGcm9tQm91bmRhcnk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvZmZzZXRQYXJlbnQ6IGZ1bmN0aW9uKCRlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZWxlbWVudCA9ICgkZWxlbWVudCAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgID8gJGVsZW1lbnRbMF1cbiAgICAgICAgICAgICAgICA6ICR0YXJnZXRbMF0sXG4gICAgICAgICAgICAgIHBhcmVudE5vZGUgPSBlbGVtZW50LnBhcmVudE5vZGUsXG4gICAgICAgICAgICAgICRub2RlICAgID0gJChwYXJlbnROb2RlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYocGFyZW50Tm9kZSkge1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICBpczJEICAgICA9ICgkbm9kZS5jc3MoJ3RyYW5zZm9ybScpID09PSAnbm9uZScpLFxuICAgICAgICAgICAgICAgIGlzU3RhdGljID0gKCRub2RlLmNzcygncG9zaXRpb24nKSA9PT0gJ3N0YXRpYycpLFxuICAgICAgICAgICAgICAgIGlzQm9keSAgID0gJG5vZGUuaXMoJ2JvZHknKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIHdoaWxlKHBhcmVudE5vZGUgJiYgIWlzQm9keSAmJiBpc1N0YXRpYyAmJiBpczJEKSB7XG4gICAgICAgICAgICAgICAgcGFyZW50Tm9kZSA9IHBhcmVudE5vZGUucGFyZW50Tm9kZTtcbiAgICAgICAgICAgICAgICAkbm9kZSAgICA9ICQocGFyZW50Tm9kZSk7XG4gICAgICAgICAgICAgICAgaXMyRCAgICAgPSAoJG5vZGUuY3NzKCd0cmFuc2Zvcm0nKSA9PT0gJ25vbmUnKTtcbiAgICAgICAgICAgICAgICBpc1N0YXRpYyA9ICgkbm9kZS5jc3MoJ3Bvc2l0aW9uJykgPT09ICdzdGF0aWMnKTtcbiAgICAgICAgICAgICAgICBpc0JvZHkgICA9ICRub2RlLmlzKCdib2R5Jyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAoJG5vZGUgJiYgJG5vZGUubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgPyAkbm9kZVxuICAgICAgICAgICAgICA6ICQoKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcG9zaXRpb25zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICd0b3AgbGVmdCcgICAgICA6IGZhbHNlLFxuICAgICAgICAgICAgICAndG9wIGNlbnRlcicgICAgOiBmYWxzZSxcbiAgICAgICAgICAgICAgJ3RvcCByaWdodCcgICAgIDogZmFsc2UsXG4gICAgICAgICAgICAgICdib3R0b20gbGVmdCcgICA6IGZhbHNlLFxuICAgICAgICAgICAgICAnYm90dG9tIGNlbnRlcicgOiBmYWxzZSxcbiAgICAgICAgICAgICAgJ2JvdHRvbSByaWdodCcgIDogZmFsc2UsXG4gICAgICAgICAgICAgICdsZWZ0IGNlbnRlcicgICA6IGZhbHNlLFxuICAgICAgICAgICAgICAncmlnaHQgY2VudGVyJyAgOiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG5leHRQb3NpdGlvbjogZnVuY3Rpb24ocG9zaXRpb24pIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBwb3NpdGlvbnMgICAgICAgICAgPSBwb3NpdGlvbi5zcGxpdCgnICcpLFxuICAgICAgICAgICAgICB2ZXJ0aWNhbFBvc2l0aW9uICAgPSBwb3NpdGlvbnNbMF0sXG4gICAgICAgICAgICAgIGhvcml6b250YWxQb3NpdGlvbiA9IHBvc2l0aW9uc1sxXSxcbiAgICAgICAgICAgICAgb3Bwb3NpdGUgPSB7XG4gICAgICAgICAgICAgICAgdG9wICAgIDogJ2JvdHRvbScsXG4gICAgICAgICAgICAgICAgYm90dG9tIDogJ3RvcCcsXG4gICAgICAgICAgICAgICAgbGVmdCAgIDogJ3JpZ2h0JyxcbiAgICAgICAgICAgICAgICByaWdodCAgOiAnbGVmdCdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgYWRqYWNlbnQgPSB7XG4gICAgICAgICAgICAgICAgbGVmdCAgIDogJ2NlbnRlcicsXG4gICAgICAgICAgICAgICAgY2VudGVyIDogJ3JpZ2h0JyxcbiAgICAgICAgICAgICAgICByaWdodCAgOiAnbGVmdCdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgYmFja3VwID0ge1xuICAgICAgICAgICAgICAgICd0b3AgbGVmdCcgICAgICA6ICd0b3AgY2VudGVyJyxcbiAgICAgICAgICAgICAgICAndG9wIGNlbnRlcicgICAgOiAndG9wIHJpZ2h0JyxcbiAgICAgICAgICAgICAgICAndG9wIHJpZ2h0JyAgICAgOiAncmlnaHQgY2VudGVyJyxcbiAgICAgICAgICAgICAgICAncmlnaHQgY2VudGVyJyAgOiAnYm90dG9tIHJpZ2h0JyxcbiAgICAgICAgICAgICAgICAnYm90dG9tIHJpZ2h0JyAgOiAnYm90dG9tIGNlbnRlcicsXG4gICAgICAgICAgICAgICAgJ2JvdHRvbSBjZW50ZXInIDogJ2JvdHRvbSBsZWZ0JyxcbiAgICAgICAgICAgICAgICAnYm90dG9tIGxlZnQnICAgOiAnbGVmdCBjZW50ZXInLFxuICAgICAgICAgICAgICAgICdsZWZ0IGNlbnRlcicgICA6ICd0b3AgbGVmdCdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgYWRqYWNlbnRzQXZhaWxhYmxlID0gKHZlcnRpY2FsUG9zaXRpb24gPT0gJ3RvcCcgfHwgdmVydGljYWxQb3NpdGlvbiA9PSAnYm90dG9tJyksXG4gICAgICAgICAgICAgIG9wcG9zaXRlVHJpZWQgPSBmYWxzZSxcbiAgICAgICAgICAgICAgYWRqYWNlbnRUcmllZCA9IGZhbHNlLFxuICAgICAgICAgICAgICBuZXh0UG9zaXRpb24gID0gZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCF0cmllZFBvc2l0aW9ucykge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQWxsIGF2YWlsYWJsZSBwb3NpdGlvbnMgYXZhaWxhYmxlJyk7XG4gICAgICAgICAgICAgIHRyaWVkUG9zaXRpb25zID0gbW9kdWxlLmdldC5wb3NpdGlvbnMoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZWNvcmRpbmcgbGFzdCBwb3NpdGlvbiB0cmllZCcsIHBvc2l0aW9uKTtcbiAgICAgICAgICAgIHRyaWVkUG9zaXRpb25zW3Bvc2l0aW9uXSA9IHRydWU7XG5cbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnByZWZlciA9PT0gJ29wcG9zaXRlJykge1xuICAgICAgICAgICAgICBuZXh0UG9zaXRpb24gID0gW29wcG9zaXRlW3ZlcnRpY2FsUG9zaXRpb25dLCBob3Jpem9udGFsUG9zaXRpb25dO1xuICAgICAgICAgICAgICBuZXh0UG9zaXRpb24gID0gbmV4dFBvc2l0aW9uLmpvaW4oJyAnKTtcbiAgICAgICAgICAgICAgb3Bwb3NpdGVUcmllZCA9ICh0cmllZFBvc2l0aW9uc1tuZXh0UG9zaXRpb25dID09PSB0cnVlKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdUcnlpbmcgb3Bwb3NpdGUgc3RyYXRlZ3knLCBuZXh0UG9zaXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoKHNldHRpbmdzLnByZWZlciA9PT0gJ2FkamFjZW50JykgJiYgYWRqYWNlbnRzQXZhaWxhYmxlICkge1xuICAgICAgICAgICAgICBuZXh0UG9zaXRpb24gID0gW3ZlcnRpY2FsUG9zaXRpb24sIGFkamFjZW50W2hvcml6b250YWxQb3NpdGlvbl1dO1xuICAgICAgICAgICAgICBuZXh0UG9zaXRpb24gID0gbmV4dFBvc2l0aW9uLmpvaW4oJyAnKTtcbiAgICAgICAgICAgICAgYWRqYWNlbnRUcmllZCA9ICh0cmllZFBvc2l0aW9uc1tuZXh0UG9zaXRpb25dID09PSB0cnVlKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdUcnlpbmcgYWRqYWNlbnQgc3RyYXRlZ3knLCBuZXh0UG9zaXRpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoYWRqYWNlbnRUcmllZCB8fCBvcHBvc2l0ZVRyaWVkKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVXNpbmcgYmFja3VwIHBvc2l0aW9uJywgbmV4dFBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgbmV4dFBvc2l0aW9uID0gYmFja3VwW3Bvc2l0aW9uXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXh0UG9zaXRpb247XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldDoge1xuICAgICAgICAgIHBvc2l0aW9uOiBmdW5jdGlvbihwb3NpdGlvbiwgY2FsY3VsYXRpb25zKSB7XG5cbiAgICAgICAgICAgIC8vIGV4aXQgY29uZGl0aW9uc1xuICAgICAgICAgICAgaWYoJHRhcmdldC5sZW5ndGggPT09IDAgfHwgJHBvcHVwLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3Iubm90Rm91bmQpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgb2Zmc2V0LFxuICAgICAgICAgICAgICBkaXN0YW5jZUF3YXksXG4gICAgICAgICAgICAgIHRhcmdldCxcbiAgICAgICAgICAgICAgcG9wdXAsXG4gICAgICAgICAgICAgIHBhcmVudCxcbiAgICAgICAgICAgICAgcG9zaXRpb25pbmcsXG4gICAgICAgICAgICAgIHBvcHVwT2Zmc2V0LFxuICAgICAgICAgICAgICBkaXN0YW5jZUZyb21Cb3VuZGFyeVxuICAgICAgICAgICAgO1xuXG4gICAgICAgICAgICBjYWxjdWxhdGlvbnMgPSBjYWxjdWxhdGlvbnMgfHwgbW9kdWxlLmdldC5jYWxjdWxhdGlvbnMoKTtcbiAgICAgICAgICAgIHBvc2l0aW9uICAgICA9IHBvc2l0aW9uICAgICB8fCAkbW9kdWxlLmRhdGEobWV0YWRhdGEucG9zaXRpb24pIHx8IHNldHRpbmdzLnBvc2l0aW9uO1xuXG4gICAgICAgICAgICBvZmZzZXQgICAgICAgPSAkbW9kdWxlLmRhdGEobWV0YWRhdGEub2Zmc2V0KSB8fCBzZXR0aW5ncy5vZmZzZXQ7XG4gICAgICAgICAgICBkaXN0YW5jZUF3YXkgPSBzZXR0aW5ncy5kaXN0YW5jZUF3YXk7XG5cbiAgICAgICAgICAgIC8vIHNob3J0aGFuZFxuICAgICAgICAgICAgdGFyZ2V0ID0gY2FsY3VsYXRpb25zLnRhcmdldDtcbiAgICAgICAgICAgIHBvcHVwICA9IGNhbGN1bGF0aW9ucy5wb3B1cDtcbiAgICAgICAgICAgIHBhcmVudCA9IGNhbGN1bGF0aW9ucy5wYXJlbnQ7XG5cbiAgICAgICAgICAgIGlmKG1vZHVsZS5zaG91bGQuY2VudGVyQXJyb3coY2FsY3VsYXRpb25zKSkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQWRqdXN0aW5nIG9mZnNldCB0byBjZW50ZXIgYXJyb3cgb24gc21hbGwgdGFyZ2V0IGVsZW1lbnQnKTtcbiAgICAgICAgICAgICAgaWYocG9zaXRpb24gPT0gJ3RvcCBsZWZ0JyB8fCBwb3NpdGlvbiA9PSAnYm90dG9tIGxlZnQnKSB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0ICs9ICh0YXJnZXQud2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIG9mZnNldCAtPSBzZXR0aW5ncy5hcnJvd1BpeGVsc0Zyb21FZGdlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKHBvc2l0aW9uID09ICd0b3AgcmlnaHQnIHx8IHBvc2l0aW9uID09ICdib3R0b20gcmlnaHQnKSB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0IC09ICh0YXJnZXQud2lkdGggLyAyKVxuICAgICAgICAgICAgICAgIG9mZnNldCArPSBzZXR0aW5ncy5hcnJvd1BpeGVsc0Zyb21FZGdlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHRhcmdldC53aWR0aCA9PT0gMCAmJiB0YXJnZXQuaGVpZ2h0ID09PSAwICYmICFtb2R1bGUuaXMuc3ZnKHRhcmdldC5lbGVtZW50KSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1BvcHVwIHRhcmdldCBpcyBoaWRkZW4sIG5vIGFjdGlvbiB0YWtlbicpO1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmlubGluZSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0FkZGluZyBtYXJnaW4gdG8gY2FsY3VsYXRpb24nLCB0YXJnZXQubWFyZ2luKTtcbiAgICAgICAgICAgICAgaWYocG9zaXRpb24gPT0gJ2xlZnQgY2VudGVyJyB8fCBwb3NpdGlvbiA9PSAncmlnaHQgY2VudGVyJykge1xuICAgICAgICAgICAgICAgIG9mZnNldCAgICAgICArPSAgdGFyZ2V0Lm1hcmdpbi50b3A7XG4gICAgICAgICAgICAgICAgZGlzdGFuY2VBd2F5ICs9IC10YXJnZXQubWFyZ2luLmxlZnQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiAocG9zaXRpb24gPT0gJ3RvcCBsZWZ0JyB8fCBwb3NpdGlvbiA9PSAndG9wIGNlbnRlcicgfHwgcG9zaXRpb24gPT0gJ3RvcCByaWdodCcpIHtcbiAgICAgICAgICAgICAgICBvZmZzZXQgICAgICAgKz0gdGFyZ2V0Lm1hcmdpbi5sZWZ0O1xuICAgICAgICAgICAgICAgIGRpc3RhbmNlQXdheSAtPSB0YXJnZXQubWFyZ2luLnRvcDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBvZmZzZXQgICAgICAgKz0gdGFyZ2V0Lm1hcmdpbi5sZWZ0O1xuICAgICAgICAgICAgICAgIGRpc3RhbmNlQXdheSArPSB0YXJnZXQubWFyZ2luLnRvcDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0RldGVybWluaW5nIHBvcHVwIHBvc2l0aW9uIGZyb20gY2FsY3VsYXRpb25zJywgcG9zaXRpb24sIGNhbGN1bGF0aW9ucyk7XG5cbiAgICAgICAgICAgIGlmIChtb2R1bGUuaXMucnRsKCkpIHtcbiAgICAgICAgICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbi5yZXBsYWNlKC9sZWZ0fHJpZ2h0L2csIGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAobWF0Y2ggPT0gJ2xlZnQnKVxuICAgICAgICAgICAgICAgICAgPyAncmlnaHQnXG4gICAgICAgICAgICAgICAgICA6ICdsZWZ0J1xuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUlRMOiBQb3B1cCBwb3NpdGlvbiB1cGRhdGVkJywgcG9zaXRpb24pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpZiBsYXN0IGF0dGVtcHQgdXNlIHNwZWNpZmllZCBsYXN0IHJlc29ydCBwb3NpdGlvblxuICAgICAgICAgICAgaWYoc2VhcmNoRGVwdGggPT0gc2V0dGluZ3MubWF4U2VhcmNoRGVwdGggJiYgdHlwZW9mIHNldHRpbmdzLmxhc3RSZXNvcnQgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgIHBvc2l0aW9uID0gc2V0dGluZ3MubGFzdFJlc29ydDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3dpdGNoIChwb3NpdGlvbikge1xuICAgICAgICAgICAgICBjYXNlICd0b3AgbGVmdCc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb25pbmcgPSB7XG4gICAgICAgICAgICAgICAgICB0b3AgICAgOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICBib3R0b20gOiBwYXJlbnQuaGVpZ2h0IC0gdGFyZ2V0LnRvcCArIGRpc3RhbmNlQXdheSxcbiAgICAgICAgICAgICAgICAgIGxlZnQgICA6IHRhcmdldC5sZWZ0ICsgb2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgcmlnaHQgIDogJ2F1dG8nXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ3RvcCBjZW50ZXInOlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uaW5nID0ge1xuICAgICAgICAgICAgICAgICAgYm90dG9tIDogcGFyZW50LmhlaWdodCAtIHRhcmdldC50b3AgKyBkaXN0YW5jZUF3YXksXG4gICAgICAgICAgICAgICAgICBsZWZ0ICAgOiB0YXJnZXQubGVmdCArICh0YXJnZXQud2lkdGggLyAyKSAtIChwb3B1cC53aWR0aCAvIDIpICsgb2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgdG9wICAgIDogJ2F1dG8nLFxuICAgICAgICAgICAgICAgICAgcmlnaHQgIDogJ2F1dG8nXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ3RvcCByaWdodCc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb25pbmcgPSB7XG4gICAgICAgICAgICAgICAgICBib3R0b20gOiAgcGFyZW50LmhlaWdodCAtIHRhcmdldC50b3AgKyBkaXN0YW5jZUF3YXksXG4gICAgICAgICAgICAgICAgICByaWdodCAgOiAgcGFyZW50LndpZHRoIC0gdGFyZ2V0LmxlZnQgLSB0YXJnZXQud2lkdGggLSBvZmZzZXQsXG4gICAgICAgICAgICAgICAgICB0b3AgICAgOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgICBsZWZ0ICAgOiAnYXV0bydcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSAnbGVmdCBjZW50ZXInOlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uaW5nID0ge1xuICAgICAgICAgICAgICAgICAgdG9wICAgIDogdGFyZ2V0LnRvcCArICh0YXJnZXQuaGVpZ2h0IC8gMikgLSAocG9wdXAuaGVpZ2h0IC8gMikgKyBvZmZzZXQsXG4gICAgICAgICAgICAgICAgICByaWdodCAgOiBwYXJlbnQud2lkdGggLSB0YXJnZXQubGVmdCArIGRpc3RhbmNlQXdheSxcbiAgICAgICAgICAgICAgICAgIGxlZnQgICA6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgIGJvdHRvbSA6ICdhdXRvJ1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdyaWdodCBjZW50ZXInOlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uaW5nID0ge1xuICAgICAgICAgICAgICAgICAgdG9wICAgIDogdGFyZ2V0LnRvcCArICh0YXJnZXQuaGVpZ2h0IC8gMikgLSAocG9wdXAuaGVpZ2h0IC8gMikgKyBvZmZzZXQsXG4gICAgICAgICAgICAgICAgICBsZWZ0ICAgOiB0YXJnZXQubGVmdCArIHRhcmdldC53aWR0aCArIGRpc3RhbmNlQXdheSxcbiAgICAgICAgICAgICAgICAgIGJvdHRvbSA6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgIHJpZ2h0ICA6ICdhdXRvJ1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICBjYXNlICdib3R0b20gbGVmdCc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb25pbmcgPSB7XG4gICAgICAgICAgICAgICAgICB0b3AgICAgOiB0YXJnZXQudG9wICsgdGFyZ2V0LmhlaWdodCArIGRpc3RhbmNlQXdheSxcbiAgICAgICAgICAgICAgICAgIGxlZnQgICA6IHRhcmdldC5sZWZ0ICsgb2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgYm90dG9tIDogJ2F1dG8nLFxuICAgICAgICAgICAgICAgICAgcmlnaHQgIDogJ2F1dG8nXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSBjZW50ZXInOlxuICAgICAgICAgICAgICAgIHBvc2l0aW9uaW5nID0ge1xuICAgICAgICAgICAgICAgICAgdG9wICAgIDogdGFyZ2V0LnRvcCArIHRhcmdldC5oZWlnaHQgKyBkaXN0YW5jZUF3YXksXG4gICAgICAgICAgICAgICAgICBsZWZ0ICAgOiB0YXJnZXQubGVmdCArICh0YXJnZXQud2lkdGggLyAyKSAtIChwb3B1cC53aWR0aCAvIDIpICsgb2Zmc2V0LFxuICAgICAgICAgICAgICAgICAgYm90dG9tIDogJ2F1dG8nLFxuICAgICAgICAgICAgICAgICAgcmlnaHQgIDogJ2F1dG8nXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIGNhc2UgJ2JvdHRvbSByaWdodCc6XG4gICAgICAgICAgICAgICAgcG9zaXRpb25pbmcgPSB7XG4gICAgICAgICAgICAgICAgICB0b3AgICAgOiB0YXJnZXQudG9wICsgdGFyZ2V0LmhlaWdodCArIGRpc3RhbmNlQXdheSxcbiAgICAgICAgICAgICAgICAgIHJpZ2h0ICA6IHBhcmVudC53aWR0aCAtIHRhcmdldC5sZWZ0ICAtIHRhcmdldC53aWR0aCAtIG9mZnNldCxcbiAgICAgICAgICAgICAgICAgIGxlZnQgICA6ICdhdXRvJyxcbiAgICAgICAgICAgICAgICAgIGJvdHRvbSA6ICdhdXRvJ1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYocG9zaXRpb25pbmcgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IuaW52YWxpZFBvc2l0aW9uLCBwb3NpdGlvbik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ2FsY3VsYXRlZCBwb3B1cCBwb3NpdGlvbmluZyB2YWx1ZXMnLCBwb3NpdGlvbmluZyk7XG5cbiAgICAgICAgICAgIC8vIHRlbnRhdGl2ZWx5IHBsYWNlIG9uIHN0YWdlXG4gICAgICAgICAgICAkcG9wdXBcbiAgICAgICAgICAgICAgLmNzcyhwb3NpdGlvbmluZylcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5wb3NpdGlvbilcbiAgICAgICAgICAgICAgLmFkZENsYXNzKHBvc2l0aW9uKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLmxvYWRpbmcpXG4gICAgICAgICAgICA7XG5cbiAgICAgICAgICAgIHBvcHVwT2Zmc2V0ID0gbW9kdWxlLmdldC5wb3B1cE9mZnNldCgpO1xuXG4gICAgICAgICAgICAvLyBzZWUgaWYgYW55IGJvdW5kYXJpZXMgYXJlIHN1cnBhc3NlZCB3aXRoIHRoaXMgdGVudGF0aXZlIHBvc2l0aW9uXG4gICAgICAgICAgICBkaXN0YW5jZUZyb21Cb3VuZGFyeSA9IG1vZHVsZS5nZXQuZGlzdGFuY2VGcm9tQm91bmRhcnkocG9wdXBPZmZzZXQsIGNhbGN1bGF0aW9ucyk7XG5cbiAgICAgICAgICAgIGlmKCBtb2R1bGUuaXMub2Zmc3RhZ2UoZGlzdGFuY2VGcm9tQm91bmRhcnksIHBvc2l0aW9uKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdQb3NpdGlvbiBpcyBvdXRzaWRlIHZpZXdwb3J0JywgcG9zaXRpb24pO1xuICAgICAgICAgICAgICBpZihzZWFyY2hEZXB0aCA8IHNldHRpbmdzLm1heFNlYXJjaERlcHRoKSB7XG4gICAgICAgICAgICAgICAgc2VhcmNoRGVwdGgrKztcbiAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IG1vZHVsZS5nZXQubmV4dFBvc2l0aW9uKHBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1RyeWluZyBuZXcgcG9zaXRpb24nLCBwb3NpdGlvbik7XG4gICAgICAgICAgICAgICAgcmV0dXJuICgkcG9wdXApXG4gICAgICAgICAgICAgICAgICA/IG1vZHVsZS5zZXQucG9zaXRpb24ocG9zaXRpb24sIGNhbGN1bGF0aW9ucylcbiAgICAgICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYoc2V0dGluZ3MubGFzdFJlc29ydCkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdObyBwb3NpdGlvbiBmb3VuZCwgc2hvd2luZyB3aXRoIGxhc3QgcG9zaXRpb24nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1BvcHVwIGNvdWxkIG5vdCBmaW5kIGEgcG9zaXRpb24gdG8gZGlzcGxheScsICRwb3B1cCk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IuY2Fubm90UGxhY2UsIGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5hdHRlbXB0cygpO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5sb2FkaW5nKCk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUucmVzZXQoKTtcbiAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uVW5wbGFjZWFibGUuY2FsbCgkcG9wdXAsIGVsZW1lbnQpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdQb3NpdGlvbiBpcyBvbiBzdGFnZScsIHBvc2l0aW9uKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuYXR0ZW1wdHMoKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUubG9hZGluZygpO1xuICAgICAgICAgICAgaWYoIHNldHRpbmdzLnNldEZsdWlkV2lkdGggJiYgbW9kdWxlLmlzLmZsdWlkKCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQuZmx1aWRXaWR0aChjYWxjdWxhdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGZsdWlkV2lkdGg6IGZ1bmN0aW9uKGNhbGN1bGF0aW9ucykge1xuICAgICAgICAgICAgY2FsY3VsYXRpb25zID0gY2FsY3VsYXRpb25zIHx8IG1vZHVsZS5nZXQuY2FsY3VsYXRpb25zKCk7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0F1dG9tYXRpY2FsbHkgc2V0dGluZyBlbGVtZW50IHdpZHRoIHRvIHBhcmVudCB3aWR0aCcsIGNhbGN1bGF0aW9ucy5wYXJlbnQud2lkdGgpO1xuICAgICAgICAgICAgJHBvcHVwLmNzcygnd2lkdGgnLCBjYWxjdWxhdGlvbnMuY29udGFpbmVyLndpZHRoKTtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgdmFyaWF0aW9uOiBmdW5jdGlvbih2YXJpYXRpb24pIHtcbiAgICAgICAgICAgIHZhcmlhdGlvbiA9IHZhcmlhdGlvbiB8fCBtb2R1bGUuZ2V0LnZhcmlhdGlvbigpO1xuICAgICAgICAgICAgaWYodmFyaWF0aW9uICYmIG1vZHVsZS5oYXMucG9wdXAoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FkZGluZyB2YXJpYXRpb24gdG8gcG9wdXAnLCB2YXJpYXRpb24pO1xuICAgICAgICAgICAgICAkcG9wdXAuYWRkQ2xhc3ModmFyaWF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgdmlzaWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLmFkZENsYXNzKGNsYXNzTmFtZS52aXNpYmxlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVtb3ZlOiB7XG4gICAgICAgICAgbG9hZGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkcG9wdXAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmxvYWRpbmcpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFyaWF0aW9uOiBmdW5jdGlvbih2YXJpYXRpb24pIHtcbiAgICAgICAgICAgIHZhcmlhdGlvbiA9IHZhcmlhdGlvbiB8fCBtb2R1bGUuZ2V0LnZhcmlhdGlvbigpO1xuICAgICAgICAgICAgaWYodmFyaWF0aW9uKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyB2YXJpYXRpb24nLCB2YXJpYXRpb24pO1xuICAgICAgICAgICAgICAkcG9wdXAucmVtb3ZlQ2xhc3ModmFyaWF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHZpc2libGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVDbGFzcyhjbGFzc05hbWUudmlzaWJsZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhdHRlbXB0czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVzZXR0aW5nIGFsbCBzZWFyY2hlZCBwb3NpdGlvbnMnKTtcbiAgICAgICAgICAgIHNlYXJjaERlcHRoICAgID0gMDtcbiAgICAgICAgICAgIHRyaWVkUG9zaXRpb25zID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGJpbmQ6IHtcbiAgICAgICAgICBldmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdCaW5kaW5nIHBvcHVwIGV2ZW50cyB0byBtb2R1bGUnKTtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLm9uID09ICdjbGljaycpIHtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5vbignY2xpY2snICsgZXZlbnROYW1lc3BhY2UsIG1vZHVsZS50b2dnbGUpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHNldHRpbmdzLm9uID09ICdob3ZlcicgJiYgaGFzVG91Y2gpIHtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5vbigndG91Y2hzdGFydCcgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LnRvdWNoc3RhcnQpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCBtb2R1bGUuZ2V0LnN0YXJ0RXZlbnQoKSApIHtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5vbihtb2R1bGUuZ2V0LnN0YXJ0RXZlbnQoKSArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuc3RhcnQpXG4gICAgICAgICAgICAgICAgLm9uKG1vZHVsZS5nZXQuZW5kRXZlbnQoKSArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuZW5kKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzZXR0aW5ncy50YXJnZXQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdUYXJnZXQgc2V0IHRvIGVsZW1lbnQnLCAkdGFyZ2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICR3aW5kb3cub24oJ3Jlc2l6ZScgKyBlbGVtZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQucmVzaXplKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBvcHVwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBbGxvd2luZyBob3ZlciBldmVudHMgb24gcG9wdXAgdG8gcHJldmVudCBjbG9zaW5nJyk7XG4gICAgICAgICAgICBpZiggJHBvcHVwICYmIG1vZHVsZS5oYXMucG9wdXAoKSApIHtcbiAgICAgICAgICAgICAgJHBvcHVwXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZWVudGVyJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuc3RhcnQpXG4gICAgICAgICAgICAgICAgLm9uKCdtb3VzZWxlYXZlJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuZW5kKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5oaWRlT25TY3JvbGwgPT09IHRydWUgfHwgKHNldHRpbmdzLmhpZGVPblNjcm9sbCA9PSAnYXV0bycgJiYgc2V0dGluZ3Mub24gIT0gJ2NsaWNrJykpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmJpbmQuY2xvc2VPblNjcm9sbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYobW9kdWxlLmlzLmNsb3NhYmxlKCkpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmJpbmQuY2xpY2thd2F5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKHNldHRpbmdzLm9uID09ICdob3ZlcicgJiYgb3BlbmVkV2l0aFRvdWNoKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5iaW5kLnRvdWNoQ2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGNsb3NlT25TY3JvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0JpbmRpbmcgc2Nyb2xsIGNsb3NlIGV2ZW50IHRvIGRvY3VtZW50Jyk7XG4gICAgICAgICAgICAkc2Nyb2xsQ29udGV4dFxuICAgICAgICAgICAgICAub25lKG1vZHVsZS5nZXQuc2Nyb2xsRXZlbnQoKSArIGVsZW1lbnROYW1lc3BhY2UsIG1vZHVsZS5ldmVudC5oaWRlR3JhY2VmdWxseSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRvdWNoQ2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0JpbmRpbmcgcG9wdXAgdG91Y2hjbG9zZSBldmVudCB0byBkb2N1bWVudCcpO1xuICAgICAgICAgICAgJGRvY3VtZW50XG4gICAgICAgICAgICAgIC5vbigndG91Y2hzdGFydCcgKyBlbGVtZW50TmFtZXNwYWNlLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdUb3VjaGVkIGF3YXkgZnJvbSBwb3B1cCcpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5ldmVudC5oaWRlR3JhY2VmdWxseS5jYWxsKGVsZW1lbnQsIGV2ZW50KTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNsaWNrYXdheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQmluZGluZyBwb3B1cCBjbG9zZSBldmVudCB0byBkb2N1bWVudCcpO1xuICAgICAgICAgICAgJGRvY3VtZW50XG4gICAgICAgICAgICAgIC5vbignY2xpY2snICsgZWxlbWVudE5hbWVzcGFjZSwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQ2xpY2tlZCBhd2F5IGZyb20gcG9wdXAnKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZXZlbnQuaGlkZUdyYWNlZnVsbHkuY2FsbChlbGVtZW50LCBldmVudCk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVuYmluZDoge1xuICAgICAgICAgIGV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkd2luZG93XG4gICAgICAgICAgICAgIC5vZmYoZWxlbWVudE5hbWVzcGFjZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLm9mZihldmVudE5hbWVzcGFjZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNsb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRkb2N1bWVudFxuICAgICAgICAgICAgICAub2ZmKGVsZW1lbnROYW1lc3BhY2UpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkc2Nyb2xsQ29udGV4dFxuICAgICAgICAgICAgICAub2ZmKGVsZW1lbnROYW1lc3BhY2UpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcblxuICAgICAgICBoYXM6IHtcbiAgICAgICAgICBwb3B1cDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKCRwb3B1cCAmJiAkcG9wdXAubGVuZ3RoID4gMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNob3VsZDoge1xuICAgICAgICAgIGNlbnRlckFycm93OiBmdW5jdGlvbihjYWxjdWxhdGlvbnMpIHtcbiAgICAgICAgICAgIHJldHVybiAhbW9kdWxlLmlzLmJhc2ljKCkgJiYgY2FsY3VsYXRpb25zLnRhcmdldC53aWR0aCA8PSAoc2V0dGluZ3MuYXJyb3dQaXhlbHNGcm9tRWRnZSAqIDIpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG5cbiAgICAgICAgaXM6IHtcbiAgICAgICAgICBjbG9zYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5jbG9zYWJsZSA9PSAnYXV0bycpIHtcbiAgICAgICAgICAgICAgaWYoc2V0dGluZ3Mub24gPT0gJ2hvdmVyJykge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5jbG9zYWJsZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9mZnN0YWdlOiBmdW5jdGlvbihkaXN0YW5jZUZyb21Cb3VuZGFyeSwgcG9zaXRpb24pIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBvZmZzdGFnZSA9IFtdXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAvLyByZXR1cm4gYm91bmRhcmllcyB0aGF0IGhhdmUgYmVlbiBzdXJwYXNzZWRcbiAgICAgICAgICAgICQuZWFjaChkaXN0YW5jZUZyb21Cb3VuZGFyeSwgZnVuY3Rpb24oZGlyZWN0aW9uLCBkaXN0YW5jZSkge1xuICAgICAgICAgICAgICBpZihkaXN0YW5jZSA8IC1zZXR0aW5ncy5qaXR0ZXIpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Bvc2l0aW9uIGV4Y2VlZHMgYWxsb3dhYmxlIGRpc3RhbmNlIGZyb20gZWRnZScsIGRpcmVjdGlvbiwgZGlzdGFuY2UsIHBvc2l0aW9uKTtcbiAgICAgICAgICAgICAgICBvZmZzdGFnZS5wdXNoKGRpcmVjdGlvbik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYob2Zmc3RhZ2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdmc6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGUuc3VwcG9ydHMuc3ZnKCkgJiYgKGVsZW1lbnQgaW5zdGFuY2VvZiBTVkdHcmFwaGljc0VsZW1lbnQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYmFzaWM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLmJhc2ljKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFuaW1hdGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKCRwb3B1cCAhPT0gdW5kZWZpbmVkICYmICRwb3B1cC5oYXNDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKSApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZmx1aWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICgkcG9wdXAgIT09IHVuZGVmaW5lZCAmJiAkcG9wdXAuaGFzQ2xhc3MoY2xhc3NOYW1lLmZsdWlkKSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB2aXNpYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoJHBvcHVwICE9PSB1bmRlZmluZWQgJiYgJHBvcHVwLmhhc0NsYXNzKGNsYXNzTmFtZS5wb3B1cFZpc2libGUpKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRyb3Bkb3duOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkbW9kdWxlLmhhc0NsYXNzKGNsYXNzTmFtZS5kcm9wZG93bik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBoaWRkZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICFtb2R1bGUuaXMudmlzaWJsZSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcnRsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5jc3MoJ2RpcmVjdGlvbicpID09ICdydGwnO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS52aXNpYmxlKCk7XG4gICAgICAgICAgaWYoc2V0dGluZ3MucHJlc2VydmUpIHtcbiAgICAgICAgICAgIGlmKCQuZm4udHJhbnNpdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICRwb3B1cFxuICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCdyZW1vdmUgdHJhbnNpdGlvbicpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlUG9wdXAoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dGluZzogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgc2V0dGluZ3MsIG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHNldHRpbmdzW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW50ZXJuYWw6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIG1vZHVsZSwgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbW9kdWxlW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVtuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlYnVnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHZlcmJvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MudmVyYm9zZSAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZS5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQpIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvciA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5lcnJvciwgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUsXG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICBwcmV2aW91c1RpbWUgID0gdGltZSB8fCBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSA9IGN1cnJlbnRUaW1lIC0gcHJldmlvdXNUaW1lO1xuICAgICAgICAgICAgICB0aW1lICAgICAgICAgID0gY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIHBlcmZvcm1hbmNlLnB1c2goe1xuICAgICAgICAgICAgICAgICdOYW1lJyAgICAgICAgICAgOiBtZXNzYWdlWzBdLFxuICAgICAgICAgICAgICAgICdBcmd1bWVudHMnICAgICAgOiBbXS5zbGljZS5jYWxsKG1lc3NhZ2UsIDEpIHx8ICcnLFxuICAgICAgICAgICAgICAgICdFbGVtZW50JyAgICAgICAgOiBlbGVtZW50LFxuICAgICAgICAgICAgICAgICdFeGVjdXRpb24gVGltZScgOiBleGVjdXRpb25UaW1lXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UudGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS5kaXNwbGF5LCA1MDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlzcGxheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdGl0bGUgPSBzZXR0aW5ncy5uYW1lICsgJzonLFxuICAgICAgICAgICAgICB0b3RhbFRpbWUgPSAwXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICB0aW1lID0gZmFsc2U7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgICQuZWFjaChwZXJmb3JtYW5jZSwgZnVuY3Rpb24oaW5kZXgsIGRhdGEpIHtcbiAgICAgICAgICAgICAgdG90YWxUaW1lICs9IGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRpdGxlICs9ICcgJyArIHRvdGFsVGltZSArICdtcyc7XG4gICAgICAgICAgICBpZihtb2R1bGVTZWxlY3Rvcikge1xuICAgICAgICAgICAgICB0aXRsZSArPSAnIFxcJycgKyBtb2R1bGVTZWxlY3RvciArICdcXCcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIChjb25zb2xlLmdyb3VwICE9PSB1bmRlZmluZWQgfHwgY29uc29sZS50YWJsZSAhPT0gdW5kZWZpbmVkKSAmJiBwZXJmb3JtYW5jZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQodGl0bGUpO1xuICAgICAgICAgICAgICBpZihjb25zb2xlLnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS50YWJsZShwZXJmb3JtYW5jZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YVsnTmFtZSddICsgJzogJyArIGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ10rJ21zJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGVyZm9ybWFuY2UgPSBbXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGludm9rZTogZnVuY3Rpb24ocXVlcnksIHBhc3NlZEFyZ3VtZW50cywgY29udGV4dCkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgb2JqZWN0ID0gaW5zdGFuY2UsXG4gICAgICAgICAgICBtYXhEZXB0aCxcbiAgICAgICAgICAgIGZvdW5kLFxuICAgICAgICAgICAgcmVzcG9uc2VcbiAgICAgICAgICA7XG4gICAgICAgICAgcGFzc2VkQXJndW1lbnRzID0gcGFzc2VkQXJndW1lbnRzIHx8IHF1ZXJ5QXJndW1lbnRzO1xuICAgICAgICAgIGNvbnRleHQgICAgICAgICA9IGVsZW1lbnQgICAgICAgICB8fCBjb250ZXh0O1xuICAgICAgICAgIGlmKHR5cGVvZiBxdWVyeSA9PSAnc3RyaW5nJyAmJiBvYmplY3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcXVlcnkgICAgPSBxdWVyeS5zcGxpdCgvW1xcLiBdLyk7XG4gICAgICAgICAgICBtYXhEZXB0aCA9IHF1ZXJ5Lmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAkLmVhY2gocXVlcnksIGZ1bmN0aW9uKGRlcHRoLCB2YWx1ZSkge1xuICAgICAgICAgICAgICB2YXIgY2FtZWxDYXNlVmFsdWUgPSAoZGVwdGggIT0gbWF4RGVwdGgpXG4gICAgICAgICAgICAgICAgPyB2YWx1ZSArIHF1ZXJ5W2RlcHRoICsgMV0uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBxdWVyeVtkZXB0aCArIDFdLnNsaWNlKDEpXG4gICAgICAgICAgICAgICAgOiBxdWVyeVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFtjYW1lbENhc2VWYWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFtjYW1lbENhc2VWYWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggJC5pc1BsYWluT2JqZWN0KCBvYmplY3RbdmFsdWVdICkgJiYgKGRlcHRoICE9IG1heERlcHRoKSApIHtcbiAgICAgICAgICAgICAgICBvYmplY3QgPSBvYmplY3RbdmFsdWVdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoIG9iamVjdFt2YWx1ZV0gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCBmb3VuZCApICkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZC5hcHBseShjb250ZXh0LCBwYXNzZWRBcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGZvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCQuaXNBcnJheShyZXR1cm5lZFZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZS5wdXNoKHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSBbcmV0dXJuZWRWYWx1ZSwgcmVzcG9uc2VdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSByZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgICAgIGlmKGluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbnZva2UocXVlcnkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmKGluc3RhbmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpbnN0YW5jZS5pbnZva2UoJ2Rlc3Ryb3knKTtcbiAgICAgICAgfVxuICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgfVxuICAgIH0pXG4gIDtcblxuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xufTtcblxuJC5mbi5wb3B1cC5zZXR0aW5ncyA9IHtcblxuICBuYW1lICAgICAgICAgICA6ICdQb3B1cCcsXG5cbiAgLy8gbW9kdWxlIHNldHRpbmdzXG4gIHNpbGVudCAgICAgICAgIDogZmFsc2UsXG4gIGRlYnVnICAgICAgICAgIDogZmFsc2UsXG4gIHZlcmJvc2UgICAgICAgIDogZmFsc2UsXG4gIHBlcmZvcm1hbmNlICAgIDogdHJ1ZSxcbiAgbmFtZXNwYWNlICAgICAgOiAncG9wdXAnLFxuXG4gIC8vIHdoZXRoZXIgaXQgc2hvdWxkIHVzZSBkb20gbXV0YXRpb24gb2JzZXJ2ZXJzXG4gIG9ic2VydmVDaGFuZ2VzIDogdHJ1ZSxcblxuICAvLyBjYWxsYmFjayBvbmx5IHdoZW4gZWxlbWVudCBhZGRlZCB0byBkb21cbiAgb25DcmVhdGUgICAgICAgOiBmdW5jdGlvbigpe30sXG5cbiAgLy8gY2FsbGJhY2sgYmVmb3JlIGVsZW1lbnQgcmVtb3ZlZCBmcm9tIGRvbVxuICBvblJlbW92ZSAgICAgICA6IGZ1bmN0aW9uKCl7fSxcblxuICAvLyBjYWxsYmFjayBiZWZvcmUgc2hvdyBhbmltYXRpb25cbiAgb25TaG93ICAgICAgICAgOiBmdW5jdGlvbigpe30sXG5cbiAgLy8gY2FsbGJhY2sgYWZ0ZXIgc2hvdyBhbmltYXRpb25cbiAgb25WaXNpYmxlICAgICAgOiBmdW5jdGlvbigpe30sXG5cbiAgLy8gY2FsbGJhY2sgYmVmb3JlIGhpZGUgYW5pbWF0aW9uXG4gIG9uSGlkZSAgICAgICAgIDogZnVuY3Rpb24oKXt9LFxuXG4gIC8vIGNhbGxiYWNrIHdoZW4gcG9wdXAgY2Fubm90IGJlIHBvc2l0aW9uZWQgaW4gdmlzaWJsZSBzY3JlZW5cbiAgb25VbnBsYWNlYWJsZSAgOiBmdW5jdGlvbigpe30sXG5cbiAgLy8gY2FsbGJhY2sgYWZ0ZXIgaGlkZSBhbmltYXRpb25cbiAgb25IaWRkZW4gICAgICAgOiBmdW5jdGlvbigpe30sXG5cbiAgLy8gd2hlbiB0byBzaG93IHBvcHVwXG4gIG9uICAgICAgICAgICAgIDogJ2hvdmVyJyxcblxuICAvLyBlbGVtZW50IHRvIHVzZSB0byBkZXRlcm1pbmUgaWYgcG9wdXAgaXMgb3V0IG9mIGJvdW5kYXJ5XG4gIGJvdW5kYXJ5ICAgICAgIDogd2luZG93LFxuXG4gIC8vIHdoZXRoZXIgdG8gYWRkIHRvdWNoc3RhcnQgZXZlbnRzIHdoZW4gdXNpbmcgaG92ZXJcbiAgYWRkVG91Y2hFdmVudHMgOiB0cnVlLFxuXG4gIC8vIGRlZmF1bHQgcG9zaXRpb24gcmVsYXRpdmUgdG8gZWxlbWVudFxuICBwb3NpdGlvbiAgICAgICA6ICd0b3AgbGVmdCcsXG5cbiAgLy8gbmFtZSBvZiB2YXJpYXRpb24gdG8gdXNlXG4gIHZhcmlhdGlvbiAgICAgIDogJycsXG5cbiAgLy8gd2hldGhlciBwb3B1cCBzaG91bGQgYmUgbW92ZWQgdG8gY29udGV4dFxuICBtb3ZlUG9wdXAgICAgICA6IHRydWUsXG5cbiAgLy8gZWxlbWVudCB3aGljaCBwb3B1cCBzaG91bGQgYmUgcmVsYXRpdmUgdG9cbiAgdGFyZ2V0ICAgICAgICAgOiBmYWxzZSxcblxuICAvLyBqcSBzZWxlY3RvciBvciBlbGVtZW50IHRoYXQgc2hvdWxkIGJlIHVzZWQgYXMgcG9wdXBcbiAgcG9wdXAgICAgICAgICAgOiBmYWxzZSxcblxuICAvLyBwb3B1cCBzaG91bGQgcmVtYWluIGlubGluZSBuZXh0IHRvIGFjdGl2YXRvclxuICBpbmxpbmUgICAgICAgICA6IGZhbHNlLFxuXG4gIC8vIHBvcHVwIHNob3VsZCBiZSByZW1vdmVkIGZyb20gcGFnZSBvbiBoaWRlXG4gIHByZXNlcnZlICAgICAgIDogZmFsc2UsXG5cbiAgLy8gcG9wdXAgc2hvdWxkIG5vdCBjbG9zZSB3aGVuIGJlaW5nIGhvdmVyZWQgb25cbiAgaG92ZXJhYmxlICAgICAgOiBmYWxzZSxcblxuICAvLyBleHBsaWNpdGx5IHNldCBjb250ZW50XG4gIGNvbnRlbnQgICAgICAgIDogZmFsc2UsXG5cbiAgLy8gZXhwbGljaXRseSBzZXQgaHRtbFxuICBodG1sICAgICAgICAgICA6IGZhbHNlLFxuXG4gIC8vIGV4cGxpY2l0bHkgc2V0IHRpdGxlXG4gIHRpdGxlICAgICAgICAgIDogZmFsc2UsXG5cbiAgLy8gd2hldGhlciBhdXRvbWF0aWNhbGx5IGNsb3NlIG9uIGNsaWNrYXdheSB3aGVuIG9uIGNsaWNrXG4gIGNsb3NhYmxlICAgICAgIDogdHJ1ZSxcblxuICAvLyBhdXRvbWF0aWNhbGx5IGhpZGUgb24gc2Nyb2xsXG4gIGhpZGVPblNjcm9sbCAgIDogJ2F1dG8nLFxuXG4gIC8vIGhpZGUgb3RoZXIgcG9wdXBzIG9uIHNob3dcbiAgZXhjbHVzaXZlICAgICAgOiBmYWxzZSxcblxuICAvLyBjb250ZXh0IHRvIGF0dGFjaCBwb3B1cHNcbiAgY29udGV4dCAgICAgICAgOiAnYm9keScsXG5cbiAgLy8gY29udGV4dCBmb3IgYmluZGluZyBzY3JvbGwgZXZlbnRzXG4gIHNjcm9sbENvbnRleHQgIDogd2luZG93LFxuXG4gIC8vIHBvc2l0aW9uIHRvIHByZWZlciB3aGVuIGNhbGN1bGF0aW5nIG5ldyBwb3NpdGlvblxuICBwcmVmZXIgICAgICAgICA6ICdvcHBvc2l0ZScsXG5cbiAgLy8gc3BlY2lmeSBwb3NpdGlvbiB0byBhcHBlYXIgZXZlbiBpZiBpdCBkb2Vzbid0IGZpdFxuICBsYXN0UmVzb3J0ICAgICA6IGZhbHNlLFxuXG4gIC8vIG51bWJlciBvZiBwaXhlbHMgZnJvbSBlZGdlIG9mIHBvcHVwIHRvIHBvaW50aW5nIGFycm93IGNlbnRlciAodXNlZCBmcm9tIGNlbnRlcmluZylcbiAgYXJyb3dQaXhlbHNGcm9tRWRnZTogMjAsXG5cbiAgLy8gZGVsYXkgdXNlZCB0byBwcmV2ZW50IGFjY2lkZW50YWwgcmVmaXJpbmcgb2YgYW5pbWF0aW9ucyBkdWUgdG8gdXNlciBlcnJvclxuICBkZWxheSA6IHtcbiAgICBzaG93IDogNTAsXG4gICAgaGlkZSA6IDcwXG4gIH0sXG5cbiAgLy8gd2hldGhlciBmbHVpZCB2YXJpYXRpb24gc2hvdWxkIGFzc2lnbiB3aWR0aCBleHBsaWNpdGx5XG4gIHNldEZsdWlkV2lkdGggIDogdHJ1ZSxcblxuICAvLyB0cmFuc2l0aW9uIHNldHRpbmdzXG4gIGR1cmF0aW9uICAgICAgIDogMjAwLFxuICB0cmFuc2l0aW9uICAgICA6ICdzY2FsZScsXG5cbiAgLy8gZGlzdGFuY2UgYXdheSBmcm9tIGFjdGl2YXRpbmcgZWxlbWVudCBpbiBweFxuICBkaXN0YW5jZUF3YXkgICA6IDAsXG5cbiAgLy8gbnVtYmVyIG9mIHBpeGVscyBhbiBlbGVtZW50IGlzIGFsbG93ZWQgdG8gYmUgXCJvZmZzdGFnZVwiIGZvciBhIHBvc2l0aW9uIHRvIGJlIGNob3NlbiAoYWxsb3dzIGZvciByb3VuZGluZylcbiAgaml0dGVyICAgICAgICAgOiAyLFxuXG4gIC8vIG9mZnNldCBvbiBhbGlnbmluZyBheGlzIGZyb20gY2FsY3VsYXRlZCBwb3NpdGlvblxuICBvZmZzZXQgICAgICAgICA6IDAsXG5cbiAgLy8gbWF4aW11bSB0aW1lcyB0byBsb29rIGZvciBhIHBvc2l0aW9uIGJlZm9yZSBmYWlsaW5nICg5IHBvc2l0aW9ucyB0b3RhbClcbiAgbWF4U2VhcmNoRGVwdGggOiAxNSxcblxuICBlcnJvcjoge1xuICAgIGludmFsaWRQb3NpdGlvbiA6ICdUaGUgcG9zaXRpb24geW91IHNwZWNpZmllZCBpcyBub3QgYSB2YWxpZCBwb3NpdGlvbicsXG4gICAgY2Fubm90UGxhY2UgICAgIDogJ1BvcHVwIGRvZXMgbm90IGZpdCB3aXRoaW4gdGhlIGJvdW5kYXJpZXMgb2YgdGhlIHZpZXdwb3J0JyxcbiAgICBtZXRob2QgICAgICAgICAgOiAnVGhlIG1ldGhvZCB5b3UgY2FsbGVkIGlzIG5vdCBkZWZpbmVkLicsXG4gICAgbm9UcmFuc2l0aW9uICAgIDogJ1RoaXMgbW9kdWxlIHJlcXVpcmVzIHVpIHRyYW5zaXRpb25zIDxodHRwczovL2dpdGh1Yi5jb20vU2VtYW50aWMtT3JnL1VJLVRyYW5zaXRpb24+JyxcbiAgICBub3RGb3VuZCAgICAgICAgOiAnVGhlIHRhcmdldCBvciBwb3B1cCB5b3Ugc3BlY2lmaWVkIGRvZXMgbm90IGV4aXN0IG9uIHRoZSBwYWdlJ1xuICB9LFxuXG4gIG1ldGFkYXRhOiB7XG4gICAgYWN0aXZhdG9yIDogJ2FjdGl2YXRvcicsXG4gICAgY29udGVudCAgIDogJ2NvbnRlbnQnLFxuICAgIGh0bWwgICAgICA6ICdodG1sJyxcbiAgICBvZmZzZXQgICAgOiAnb2Zmc2V0JyxcbiAgICBwb3NpdGlvbiAgOiAncG9zaXRpb24nLFxuICAgIHRpdGxlICAgICA6ICd0aXRsZScsXG4gICAgdmFyaWF0aW9uIDogJ3ZhcmlhdGlvbidcbiAgfSxcblxuICBjbGFzc05hbWUgICA6IHtcbiAgICBhY3RpdmUgICAgICAgOiAnYWN0aXZlJyxcbiAgICBiYXNpYyAgICAgICAgOiAnYmFzaWMnLFxuICAgIGFuaW1hdGluZyAgICA6ICdhbmltYXRpbmcnLFxuICAgIGRyb3Bkb3duICAgICA6ICdkcm9wZG93bicsXG4gICAgZmx1aWQgICAgICAgIDogJ2ZsdWlkJyxcbiAgICBsb2FkaW5nICAgICAgOiAnbG9hZGluZycsXG4gICAgcG9wdXAgICAgICAgIDogJ3VpIHBvcHVwJyxcbiAgICBwb3NpdGlvbiAgICAgOiAndG9wIGxlZnQgY2VudGVyIGJvdHRvbSByaWdodCcsXG4gICAgdmlzaWJsZSAgICAgIDogJ3Zpc2libGUnLFxuICAgIHBvcHVwVmlzaWJsZSA6ICd2aXNpYmxlJ1xuICB9LFxuXG4gIHNlbGVjdG9yICAgIDoge1xuICAgIHBvcHVwICAgIDogJy51aS5wb3B1cCdcbiAgfSxcblxuICB0ZW1wbGF0ZXM6IHtcbiAgICBlc2NhcGU6IGZ1bmN0aW9uKHN0cmluZykge1xuICAgICAgdmFyXG4gICAgICAgIGJhZENoYXJzICAgICA9IC9bJjw+XCInYF0vZyxcbiAgICAgICAgc2hvdWxkRXNjYXBlID0gL1smPD5cIidgXS8sXG4gICAgICAgIGVzY2FwZSAgICAgICA9IHtcbiAgICAgICAgICBcIiZcIjogXCImYW1wO1wiLFxuICAgICAgICAgIFwiPFwiOiBcIiZsdDtcIixcbiAgICAgICAgICBcIj5cIjogXCImZ3Q7XCIsXG4gICAgICAgICAgJ1wiJzogXCImcXVvdDtcIixcbiAgICAgICAgICBcIidcIjogXCImI3gyNztcIixcbiAgICAgICAgICBcImBcIjogXCImI3g2MDtcIlxuICAgICAgICB9LFxuICAgICAgICBlc2NhcGVkQ2hhciAgPSBmdW5jdGlvbihjaHIpIHtcbiAgICAgICAgICByZXR1cm4gZXNjYXBlW2Nocl07XG4gICAgICAgIH1cbiAgICAgIDtcbiAgICAgIGlmKHNob3VsZEVzY2FwZS50ZXN0KHN0cmluZykpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZy5yZXBsYWNlKGJhZENoYXJzLCBlc2NhcGVkQ2hhcik7XG4gICAgICB9XG4gICAgICByZXR1cm4gc3RyaW5nO1xuICAgIH0sXG4gICAgcG9wdXA6IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgIHZhclxuICAgICAgICBodG1sICAgPSAnJyxcbiAgICAgICAgZXNjYXBlID0gJC5mbi5wb3B1cC5zZXR0aW5ncy50ZW1wbGF0ZXMuZXNjYXBlXG4gICAgICA7XG4gICAgICBpZih0eXBlb2YgdGV4dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmKHR5cGVvZiB0ZXh0LnRpdGxlICE9PSB1bmRlZmluZWQgJiYgdGV4dC50aXRsZSkge1xuICAgICAgICAgIHRleHQudGl0bGUgPSBlc2NhcGUodGV4dC50aXRsZSk7XG4gICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz1cImhlYWRlclwiPicgKyB0ZXh0LnRpdGxlICsgJzwvZGl2Pic7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHRleHQuY29udGVudCAhPT0gdW5kZWZpbmVkICYmIHRleHQuY29udGVudCkge1xuICAgICAgICAgIHRleHQuY29udGVudCA9IGVzY2FwZSh0ZXh0LmNvbnRlbnQpO1xuICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9XCJjb250ZW50XCI+JyArIHRleHQuY29udGVudCArICc8L2Rpdj4nO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gaHRtbDtcbiAgICB9XG4gIH1cblxufTtcblxuXG59KSggalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50ICk7XG5cbi8qIVxuICogIyBTZW1hbnRpYyBVSSAyLjQuMCAtIFByb2dyZXNzXG4gKiBodHRwOi8vZ2l0aHViLmNvbS9zZW1hbnRpYy1vcmcvc2VtYW50aWMtdWkvXG4gKlxuICpcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuICpcbiAqL1xuXG47KGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHtcblxuJ3VzZSBzdHJpY3QnO1xuXG53aW5kb3cgPSAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoKVxuICA/IHdpbmRvd1xuICA6ICh0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aClcbiAgICA/IHNlbGZcbiAgICA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKClcbjtcblxudmFyXG4gIGdsb2JhbCA9ICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGgpXG4gICAgPyB3aW5kb3dcbiAgICA6ICh0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aClcbiAgICAgID8gc2VsZlxuICAgICAgOiBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpXG47XG5cbiQuZm4ucHJvZ3Jlc3MgPSBmdW5jdGlvbihwYXJhbWV0ZXJzKSB7XG4gIHZhclxuICAgICRhbGxNb2R1bGVzICAgID0gJCh0aGlzKSxcblxuICAgIG1vZHVsZVNlbGVjdG9yID0gJGFsbE1vZHVsZXMuc2VsZWN0b3IgfHwgJycsXG5cbiAgICB0aW1lICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgID0gW10sXG5cbiAgICBxdWVyeSAgICAgICAgICA9IGFyZ3VtZW50c1swXSxcbiAgICBtZXRob2RJbnZva2VkICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLFxuXG4gICAgcmV0dXJuZWRWYWx1ZVxuICA7XG5cbiAgJGFsbE1vZHVsZXNcbiAgICAuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIHZhclxuICAgICAgICBzZXR0aW5ncyAgICAgICAgICA9ICggJC5pc1BsYWluT2JqZWN0KHBhcmFtZXRlcnMpIClcbiAgICAgICAgICA/ICQuZXh0ZW5kKHRydWUsIHt9LCAkLmZuLnByb2dyZXNzLnNldHRpbmdzLCBwYXJhbWV0ZXJzKVxuICAgICAgICAgIDogJC5leHRlbmQoe30sICQuZm4ucHJvZ3Jlc3Muc2V0dGluZ3MpLFxuXG4gICAgICAgIGNsYXNzTmFtZSAgICAgICA9IHNldHRpbmdzLmNsYXNzTmFtZSxcbiAgICAgICAgbWV0YWRhdGEgICAgICAgID0gc2V0dGluZ3MubWV0YWRhdGEsXG4gICAgICAgIG5hbWVzcGFjZSAgICAgICA9IHNldHRpbmdzLm5hbWVzcGFjZSxcbiAgICAgICAgc2VsZWN0b3IgICAgICAgID0gc2V0dGluZ3Muc2VsZWN0b3IsXG4gICAgICAgIGVycm9yICAgICAgICAgICA9IHNldHRpbmdzLmVycm9yLFxuXG4gICAgICAgIGV2ZW50TmFtZXNwYWNlICA9ICcuJyArIG5hbWVzcGFjZSxcbiAgICAgICAgbW9kdWxlTmFtZXNwYWNlID0gJ21vZHVsZS0nICsgbmFtZXNwYWNlLFxuXG4gICAgICAgICRtb2R1bGUgICAgICAgICA9ICQodGhpcyksXG4gICAgICAgICRiYXIgICAgICAgICAgICA9ICQodGhpcykuZmluZChzZWxlY3Rvci5iYXIpLFxuICAgICAgICAkcHJvZ3Jlc3MgICAgICAgPSAkKHRoaXMpLmZpbmQoc2VsZWN0b3IucHJvZ3Jlc3MpLFxuICAgICAgICAkbGFiZWwgICAgICAgICAgPSAkKHRoaXMpLmZpbmQoc2VsZWN0b3IubGFiZWwpLFxuXG4gICAgICAgIGVsZW1lbnQgICAgICAgICA9IHRoaXMsXG4gICAgICAgIGluc3RhbmNlICAgICAgICA9ICRtb2R1bGUuZGF0YShtb2R1bGVOYW1lc3BhY2UpLFxuXG4gICAgICAgIGFuaW1hdGluZyA9IGZhbHNlLFxuICAgICAgICB0cmFuc2l0aW9uRW5kLFxuICAgICAgICBtb2R1bGVcbiAgICAgIDtcblxuICAgICAgbW9kdWxlID0ge1xuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW5pdGlhbGl6aW5nIHByb2dyZXNzIGJhcicsIHNldHRpbmdzKTtcblxuICAgICAgICAgIG1vZHVsZS5zZXQuZHVyYXRpb24oKTtcbiAgICAgICAgICBtb2R1bGUuc2V0LnRyYW5zaXRpb25FdmVudCgpO1xuXG4gICAgICAgICAgbW9kdWxlLnJlYWQubWV0YWRhdGEoKTtcbiAgICAgICAgICBtb2R1bGUucmVhZC5zZXR0aW5ncygpO1xuXG4gICAgICAgICAgbW9kdWxlLmluc3RhbnRpYXRlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5zdGFudGlhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTdG9yaW5nIGluc3RhbmNlIG9mIHByb2dyZXNzJywgbW9kdWxlKTtcbiAgICAgICAgICBpbnN0YW5jZSA9IG1vZHVsZTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAuZGF0YShtb2R1bGVOYW1lc3BhY2UsIG1vZHVsZSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXN0cm95aW5nIHByZXZpb3VzIHByb2dyZXNzIGZvcicsICRtb2R1bGUpO1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW5zdGFuY2UuaW50ZXJ2YWwpO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUuc3RhdGUoKTtcbiAgICAgICAgICAkbW9kdWxlLnJlbW92ZURhdGEobW9kdWxlTmFtZXNwYWNlKTtcbiAgICAgICAgICBpbnN0YW5jZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgfSxcblxuICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS5uZXh0VmFsdWUoKTtcbiAgICAgICAgICBtb2R1bGUudXBkYXRlLnByb2dyZXNzKDApO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZihtb2R1bGUucGVyY2VudCA9PT0gdW5kZWZpbmVkIHx8IG1vZHVsZS5wZXJjZW50IDwgMTAwKSB7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnByb2dyZXNzUG9sbCgpO1xuICAgICAgICAgICAgbW9kdWxlLnNldC5wZXJjZW50KDEwMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlYWQ6IHtcbiAgICAgICAgICBtZXRhZGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICBwZXJjZW50IDogJG1vZHVsZS5kYXRhKG1ldGFkYXRhLnBlcmNlbnQpLFxuICAgICAgICAgICAgICAgIHRvdGFsICAgOiAkbW9kdWxlLmRhdGEobWV0YWRhdGEudG90YWwpLFxuICAgICAgICAgICAgICAgIHZhbHVlICAgOiAkbW9kdWxlLmRhdGEobWV0YWRhdGEudmFsdWUpXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKGRhdGEucGVyY2VudCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0N1cnJlbnQgcGVyY2VudCB2YWx1ZSBzZXQgZnJvbSBtZXRhZGF0YScsIGRhdGEucGVyY2VudCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQucGVyY2VudChkYXRhLnBlcmNlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoZGF0YS50b3RhbCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1RvdGFsIHZhbHVlIHNldCBmcm9tIG1ldGFkYXRhJywgZGF0YS50b3RhbCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQudG90YWwoZGF0YS50b3RhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihkYXRhLnZhbHVlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ3VycmVudCB2YWx1ZSBzZXQgZnJvbSBtZXRhZGF0YScsIGRhdGEudmFsdWUpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnZhbHVlKGRhdGEudmFsdWUpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnByb2dyZXNzKGRhdGEudmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2V0dGluZ3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MudG90YWwgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ3VycmVudCB0b3RhbCBzZXQgaW4gc2V0dGluZ3MnLCBzZXR0aW5ncy50b3RhbCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQudG90YWwoc2V0dGluZ3MudG90YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoc2V0dGluZ3MudmFsdWUgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ3VycmVudCB2YWx1ZSBzZXQgaW4gc2V0dGluZ3MnLCBzZXR0aW5ncy52YWx1ZSk7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQudmFsdWUoc2V0dGluZ3MudmFsdWUpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnByb2dyZXNzKG1vZHVsZS52YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJjZW50ICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0N1cnJlbnQgcGVyY2VudCBzZXQgaW4gc2V0dGluZ3MnLCBzZXR0aW5ncy5wZXJjZW50KTtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5wZXJjZW50KHNldHRpbmdzLnBlcmNlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBiaW5kOiB7XG4gICAgICAgICAgdHJhbnNpdGlvbkVuZDogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB0cmFuc2l0aW9uRW5kID0gbW9kdWxlLmdldC50cmFuc2l0aW9uRW5kKClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgICRiYXJcbiAgICAgICAgICAgICAgLm9uZSh0cmFuc2l0aW9uRW5kICsgZXZlbnROYW1lc3BhY2UsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5mYWlsU2FmZVRpbWVyKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMsIGV2ZW50KTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS5mYWlsU2FmZVRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgJGJhci50cmlnZ2VySGFuZGxlcih0cmFuc2l0aW9uRW5kKTtcbiAgICAgICAgICAgIH0sIHNldHRpbmdzLmR1cmF0aW9uICsgc2V0dGluZ3MuZmFpbFNhZmVEZWxheSk7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQWRkaW5nIGZhaWwgc2FmZSB0aW1lcicsIG1vZHVsZS50aW1lcik7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGluY3JlbWVudDogZnVuY3Rpb24oaW5jcmVtZW50VmFsdWUpIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIG1heFZhbHVlLFxuICAgICAgICAgICAgc3RhcnRWYWx1ZSxcbiAgICAgICAgICAgIG5ld1ZhbHVlXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKCBtb2R1bGUuaGFzLnRvdGFsKCkgKSB7XG4gICAgICAgICAgICBzdGFydFZhbHVlICAgICA9IG1vZHVsZS5nZXQudmFsdWUoKTtcbiAgICAgICAgICAgIGluY3JlbWVudFZhbHVlID0gaW5jcmVtZW50VmFsdWUgfHwgMTtcbiAgICAgICAgICAgIG5ld1ZhbHVlICAgICAgID0gc3RhcnRWYWx1ZSArIGluY3JlbWVudFZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0YXJ0VmFsdWUgICAgID0gbW9kdWxlLmdldC5wZXJjZW50KCk7XG4gICAgICAgICAgICBpbmNyZW1lbnRWYWx1ZSA9IGluY3JlbWVudFZhbHVlIHx8IG1vZHVsZS5nZXQucmFuZG9tVmFsdWUoKTtcblxuICAgICAgICAgICAgbmV3VmFsdWUgICAgICAgPSBzdGFydFZhbHVlICsgaW5jcmVtZW50VmFsdWU7XG4gICAgICAgICAgICBtYXhWYWx1ZSAgICAgICA9IDEwMDtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW5jcmVtZW50aW5nIHBlcmNlbnRhZ2UgYnknLCBzdGFydFZhbHVlLCBuZXdWYWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG5ld1ZhbHVlID0gbW9kdWxlLmdldC5ub3JtYWxpemVkVmFsdWUobmV3VmFsdWUpO1xuICAgICAgICAgIG1vZHVsZS5zZXQucHJvZ3Jlc3MobmV3VmFsdWUpO1xuICAgICAgICB9LFxuICAgICAgICBkZWNyZW1lbnQ6IGZ1bmN0aW9uKGRlY3JlbWVudFZhbHVlKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICB0b3RhbCAgICAgPSBtb2R1bGUuZ2V0LnRvdGFsKCksXG4gICAgICAgICAgICBzdGFydFZhbHVlLFxuICAgICAgICAgICAgbmV3VmFsdWVcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYodG90YWwpIHtcbiAgICAgICAgICAgIHN0YXJ0VmFsdWUgICAgID0gIG1vZHVsZS5nZXQudmFsdWUoKTtcbiAgICAgICAgICAgIGRlY3JlbWVudFZhbHVlID0gIGRlY3JlbWVudFZhbHVlIHx8IDE7XG4gICAgICAgICAgICBuZXdWYWx1ZSAgICAgICA9ICBzdGFydFZhbHVlIC0gZGVjcmVtZW50VmFsdWU7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0RlY3JlbWVudGluZyB2YWx1ZSBieScsIGRlY3JlbWVudFZhbHVlLCBzdGFydFZhbHVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzdGFydFZhbHVlICAgICA9ICBtb2R1bGUuZ2V0LnBlcmNlbnQoKTtcbiAgICAgICAgICAgIGRlY3JlbWVudFZhbHVlID0gIGRlY3JlbWVudFZhbHVlIHx8IG1vZHVsZS5nZXQucmFuZG9tVmFsdWUoKTtcbiAgICAgICAgICAgIG5ld1ZhbHVlICAgICAgID0gIHN0YXJ0VmFsdWUgLSBkZWNyZW1lbnRWYWx1ZTtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRGVjcmVtZW50aW5nIHBlcmNlbnRhZ2UgYnknLCBkZWNyZW1lbnRWYWx1ZSwgc3RhcnRWYWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG5ld1ZhbHVlID0gbW9kdWxlLmdldC5ub3JtYWxpemVkVmFsdWUobmV3VmFsdWUpO1xuICAgICAgICAgIG1vZHVsZS5zZXQucHJvZ3Jlc3MobmV3VmFsdWUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGhhczoge1xuICAgICAgICAgIHByb2dyZXNzUG9sbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLnByb2dyZXNzUG9sbDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRvdGFsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAobW9kdWxlLmdldC50b3RhbCgpICE9PSBmYWxzZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGdldDoge1xuICAgICAgICAgIHRleHQ6IGZ1bmN0aW9uKHRlbXBsYXRlVGV4dCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHZhbHVlICAgPSBtb2R1bGUudmFsdWUgICAgICAgICAgICAgICAgfHwgMCxcbiAgICAgICAgICAgICAgdG90YWwgICA9IG1vZHVsZS50b3RhbCAgICAgICAgICAgICAgICB8fCAwLFxuICAgICAgICAgICAgICBwZXJjZW50ID0gKGFuaW1hdGluZylcbiAgICAgICAgICAgICAgICA/IG1vZHVsZS5nZXQuZGlzcGxheVBlcmNlbnQoKVxuICAgICAgICAgICAgICAgIDogbW9kdWxlLnBlcmNlbnQgfHwgMCxcbiAgICAgICAgICAgICAgbGVmdCA9IChtb2R1bGUudG90YWwgPiAwKVxuICAgICAgICAgICAgICAgID8gKHRvdGFsIC0gdmFsdWUpXG4gICAgICAgICAgICAgICAgOiAoMTAwIC0gcGVyY2VudClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHRlbXBsYXRlVGV4dCA9IHRlbXBsYXRlVGV4dCB8fCAnJztcbiAgICAgICAgICAgIHRlbXBsYXRlVGV4dCA9IHRlbXBsYXRlVGV4dFxuICAgICAgICAgICAgICAucmVwbGFjZSgne3ZhbHVlfScsIHZhbHVlKVxuICAgICAgICAgICAgICAucmVwbGFjZSgne3RvdGFsfScsIHRvdGFsKVxuICAgICAgICAgICAgICAucmVwbGFjZSgne2xlZnR9JywgbGVmdClcbiAgICAgICAgICAgICAgLnJlcGxhY2UoJ3twZXJjZW50fScsIHBlcmNlbnQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQWRkaW5nIHZhcmlhYmxlcyB0byBwcm9ncmVzcyBiYXIgdGV4dCcsIHRlbXBsYXRlVGV4dCk7XG4gICAgICAgICAgICByZXR1cm4gdGVtcGxhdGVUZXh0O1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBub3JtYWxpemVkVmFsdWU6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICBpZih2YWx1ZSA8IDApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdWYWx1ZSBjYW5ub3QgZGVjcmVtZW50IGJlbG93IDAnKTtcbiAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihtb2R1bGUuaGFzLnRvdGFsKCkpIHtcbiAgICAgICAgICAgICAgaWYodmFsdWUgPiBtb2R1bGUudG90YWwpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1ZhbHVlIGNhbm5vdCBpbmNyZW1lbnQgYWJvdmUgdG90YWwnLCBtb2R1bGUudG90YWwpO1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2R1bGUudG90YWw7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYodmFsdWUgPiAxMDAgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVmFsdWUgY2Fubm90IGluY3JlbWVudCBhYm92ZSAxMDAgcGVyY2VudCcpO1xuICAgICAgICAgICAgICByZXR1cm4gMTAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICB1cGRhdGVJbnRlcnZhbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy51cGRhdGVJbnRlcnZhbCA9PSAnYXV0bycpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzLmR1cmF0aW9uO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzLnVwZGF0ZUludGVydmFsO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICByYW5kb21WYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0dlbmVyYXRpbmcgcmFuZG9tIGluY3JlbWVudCBwZXJjZW50YWdlJyk7XG4gICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcigoTWF0aC5yYW5kb20oKSAqIHNldHRpbmdzLnJhbmRvbS5tYXgpICsgc2V0dGluZ3MucmFuZG9tLm1pbik7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIG51bWVyaWNWYWx1ZTogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJylcbiAgICAgICAgICAgICAgPyAodmFsdWUucmVwbGFjZSgvW15cXGQuXS9nLCAnJykgIT09ICcnKVxuICAgICAgICAgICAgICAgID8gKyh2YWx1ZS5yZXBsYWNlKC9bXlxcZC5dL2csICcnKSlcbiAgICAgICAgICAgICAgICA6IGZhbHNlXG4gICAgICAgICAgICAgIDogdmFsdWVcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgdHJhbnNpdGlvbkVuZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZWxlbWVudCAgICAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdlbGVtZW50JyksXG4gICAgICAgICAgICAgIHRyYW5zaXRpb25zID0ge1xuICAgICAgICAgICAgICAgICd0cmFuc2l0aW9uJyAgICAgICA6J3RyYW5zaXRpb25lbmQnLFxuICAgICAgICAgICAgICAgICdPVHJhbnNpdGlvbicgICAgICA6J29UcmFuc2l0aW9uRW5kJyxcbiAgICAgICAgICAgICAgICAnTW96VHJhbnNpdGlvbicgICAgOid0cmFuc2l0aW9uZW5kJyxcbiAgICAgICAgICAgICAgICAnV2Via2l0VHJhbnNpdGlvbicgOid3ZWJraXRUcmFuc2l0aW9uRW5kJ1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB0cmFuc2l0aW9uXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBmb3IodHJhbnNpdGlvbiBpbiB0cmFuc2l0aW9ucyl7XG4gICAgICAgICAgICAgIGlmKCBlbGVtZW50LnN0eWxlW3RyYW5zaXRpb25dICE9PSB1bmRlZmluZWQgKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJhbnNpdGlvbnNbdHJhbnNpdGlvbl07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgLy8gZ2V0cyBjdXJyZW50IGRpc3BsYXllZCBwZXJjZW50YWdlIChpZiBhbmltYXRpbmcgdmFsdWVzIHRoaXMgaXMgdGhlIGludGVybWVkaWFyeSB2YWx1ZSlcbiAgICAgICAgICBkaXNwbGF5UGVyY2VudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgYmFyV2lkdGggICAgICAgPSAkYmFyLndpZHRoKCksXG4gICAgICAgICAgICAgIHRvdGFsV2lkdGggICAgID0gJG1vZHVsZS53aWR0aCgpLFxuICAgICAgICAgICAgICBtaW5EaXNwbGF5ICAgICA9IHBhcnNlSW50KCRiYXIuY3NzKCdtaW4td2lkdGgnKSwgMTApLFxuICAgICAgICAgICAgICBkaXNwbGF5UGVyY2VudCA9IChiYXJXaWR0aCA+IG1pbkRpc3BsYXkpXG4gICAgICAgICAgICAgICAgPyAoYmFyV2lkdGggLyB0b3RhbFdpZHRoICogMTAwKVxuICAgICAgICAgICAgICAgIDogbW9kdWxlLnBlcmNlbnRcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiAoc2V0dGluZ3MucHJlY2lzaW9uID4gMClcbiAgICAgICAgICAgICAgPyBNYXRoLnJvdW5kKGRpc3BsYXlQZXJjZW50ICogKDEwICogc2V0dGluZ3MucHJlY2lzaW9uKSkgLyAoMTAgKiBzZXR0aW5ncy5wcmVjaXNpb24pXG4gICAgICAgICAgICAgIDogTWF0aC5yb3VuZChkaXNwbGF5UGVyY2VudClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgcGVyY2VudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLnBlcmNlbnQgfHwgMDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGUubmV4dFZhbHVlIHx8IG1vZHVsZS52YWx1ZSB8fCAwO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdG90YWw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS50b3RhbCB8fCBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY3JlYXRlOiB7XG4gICAgICAgICAgcHJvZ3Jlc3NQb2xsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS5wcm9ncmVzc1BvbGwgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBtb2R1bGUudXBkYXRlLnRvTmV4dFZhbHVlKCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUucHJvZ3Jlc3NQb2xsKCk7XG4gICAgICAgICAgICB9LCBtb2R1bGUuZ2V0LnVwZGF0ZUludGVydmFsKCkpO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG5cbiAgICAgICAgaXM6IHtcbiAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLmlzLnN1Y2Nlc3MoKSB8fCBtb2R1bGUuaXMud2FybmluZygpIHx8IG1vZHVsZS5pcy5lcnJvcigpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUuc3VjY2Vzcyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB3YXJuaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkbW9kdWxlLmhhc0NsYXNzKGNsYXNzTmFtZS53YXJuaW5nKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkbW9kdWxlLmhhc0NsYXNzKGNsYXNzTmFtZS5lcnJvcik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhY3RpdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB2aXNpYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkbW9kdWxlLmlzKCc6dmlzaWJsZScpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmU6IHtcbiAgICAgICAgICBwcm9ncmVzc1BvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlbW92aW5nIHByb2dyZXNzIHBvbGwgdGltZXInKTtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5wcm9ncmVzc1BvbGwpIHtcbiAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wcm9ncmVzc1BvbGwpO1xuICAgICAgICAgICAgICBkZWxldGUgbW9kdWxlLnByb2dyZXNzUG9sbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG5leHRWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3ZpbmcgcHJvZ3Jlc3MgdmFsdWUgc3RvcmVkIGZvciBuZXh0IHVwZGF0ZScpO1xuICAgICAgICAgICAgZGVsZXRlIG1vZHVsZS5uZXh0VmFsdWU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3Zpbmcgc3RvcmVkIHN0YXRlJyk7XG4gICAgICAgICAgICBkZWxldGUgbW9kdWxlLnRvdGFsO1xuICAgICAgICAgICAgZGVsZXRlIG1vZHVsZS5wZXJjZW50O1xuICAgICAgICAgICAgZGVsZXRlIG1vZHVsZS52YWx1ZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3ZpbmcgYWN0aXZlIHN0YXRlJyk7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3Zpbmcgc3VjY2VzcyBzdGF0ZScpO1xuICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVDbGFzcyhjbGFzc05hbWUuc3VjY2Vzcyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB3YXJuaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyB3YXJuaW5nIHN0YXRlJyk7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS53YXJuaW5nKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyBlcnJvciBzdGF0ZScpO1xuICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVDbGFzcyhjbGFzc05hbWUuZXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXQ6IHtcbiAgICAgICAgICBiYXJXaWR0aDogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGlmKHZhbHVlID4gMTAwKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci50b29IaWdoLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSA8IDApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLnRvb0xvdywgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICRiYXJcbiAgICAgICAgICAgICAgICAuY3NzKCd3aWR0aCcsIHZhbHVlICsgJyUnKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgICAuYXR0cignZGF0YS1wZXJjZW50JywgcGFyc2VJbnQodmFsdWUsIDEwKSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgZHVyYXRpb246IGZ1bmN0aW9uKGR1cmF0aW9uKSB7XG4gICAgICAgICAgICBkdXJhdGlvbiA9IGR1cmF0aW9uIHx8IHNldHRpbmdzLmR1cmF0aW9uO1xuICAgICAgICAgICAgZHVyYXRpb24gPSAodHlwZW9mIGR1cmF0aW9uID09ICdudW1iZXInKVxuICAgICAgICAgICAgICA/IGR1cmF0aW9uICsgJ21zJ1xuICAgICAgICAgICAgICA6IGR1cmF0aW9uXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2V0dGluZyBwcm9ncmVzcyBiYXIgdHJhbnNpdGlvbiBkdXJhdGlvbicsIGR1cmF0aW9uKTtcbiAgICAgICAgICAgICRiYXJcbiAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgJ3RyYW5zaXRpb24tZHVyYXRpb24nOiAgZHVyYXRpb25cbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBlcmNlbnQ6IGZ1bmN0aW9uKHBlcmNlbnQpIHtcbiAgICAgICAgICAgIHBlcmNlbnQgPSAodHlwZW9mIHBlcmNlbnQgPT0gJ3N0cmluZycpXG4gICAgICAgICAgICAgID8gKyhwZXJjZW50LnJlcGxhY2UoJyUnLCAnJykpXG4gICAgICAgICAgICAgIDogcGVyY2VudFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgLy8gcm91bmQgZGlzcGxheSBwZXJjZW50YWdlXG4gICAgICAgICAgICBwZXJjZW50ID0gKHNldHRpbmdzLnByZWNpc2lvbiA+IDApXG4gICAgICAgICAgICAgID8gTWF0aC5yb3VuZChwZXJjZW50ICogKDEwICogc2V0dGluZ3MucHJlY2lzaW9uKSkgLyAoMTAgKiBzZXR0aW5ncy5wcmVjaXNpb24pXG4gICAgICAgICAgICAgIDogTWF0aC5yb3VuZChwZXJjZW50KVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnBlcmNlbnQgPSBwZXJjZW50O1xuICAgICAgICAgICAgaWYoICFtb2R1bGUuaGFzLnRvdGFsKCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52YWx1ZSA9IChzZXR0aW5ncy5wcmVjaXNpb24gPiAwKVxuICAgICAgICAgICAgICAgID8gTWF0aC5yb3VuZCggKHBlcmNlbnQgLyAxMDApICogbW9kdWxlLnRvdGFsICogKDEwICogc2V0dGluZ3MucHJlY2lzaW9uKSkgLyAoMTAgKiBzZXR0aW5ncy5wcmVjaXNpb24pXG4gICAgICAgICAgICAgICAgOiBNYXRoLnJvdW5kKCAocGVyY2VudCAvIDEwMCkgKiBtb2R1bGUudG90YWwgKiAxMCkgLyAxMFxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKHNldHRpbmdzLmxpbWl0VmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnZhbHVlID0gKG1vZHVsZS52YWx1ZSA+IDEwMClcbiAgICAgICAgICAgICAgICAgID8gMTAwXG4gICAgICAgICAgICAgICAgICA6IChtb2R1bGUudmFsdWUgPCAwKVxuICAgICAgICAgICAgICAgICAgICA/IDBcbiAgICAgICAgICAgICAgICAgICAgOiBtb2R1bGUudmFsdWVcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5zZXQuYmFyV2lkdGgocGVyY2VudCk7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LmxhYmVsSW50ZXJ2YWwoKTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQubGFiZWxzKCk7XG4gICAgICAgICAgICBzZXR0aW5ncy5vbkNoYW5nZS5jYWxsKGVsZW1lbnQsIHBlcmNlbnQsIG1vZHVsZS52YWx1ZSwgbW9kdWxlLnRvdGFsKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGxhYmVsSW50ZXJ2YWw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGFuaW1hdGlvbkNhbGxiYWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0JhciBmaW5pc2hlZCBhbmltYXRpbmcsIHJlbW92aW5nIGNvbnRpbnVvdXMgbGFiZWwgdXBkYXRlcycpO1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwobW9kdWxlLmludGVydmFsKTtcbiAgICAgICAgICAgICAgICBhbmltYXRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuc2V0LmxhYmVscygpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKG1vZHVsZS5pbnRlcnZhbCk7XG4gICAgICAgICAgICBtb2R1bGUuYmluZC50cmFuc2l0aW9uRW5kKGFuaW1hdGlvbkNhbGxiYWNrKTtcbiAgICAgICAgICAgIGFuaW1hdGluZyA9IHRydWU7XG4gICAgICAgICAgICBtb2R1bGUuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgaXNJbkRPTSA9ICQuY29udGFpbnMoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBlbGVtZW50KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCFpc0luRE9NKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChtb2R1bGUuaW50ZXJ2YWwpO1xuICAgICAgICAgICAgICAgIGFuaW1hdGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQubGFiZWxzKCk7XG4gICAgICAgICAgICB9LCBzZXR0aW5ncy5mcmFtZXJhdGUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbGFiZWxzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTZXR0aW5nIGJvdGggYmFyIHByb2dyZXNzIGFuZCBvdXRlciBsYWJlbCB0ZXh0Jyk7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LmJhckxhYmVsKCk7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LnN0YXRlKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsYWJlbDogZnVuY3Rpb24odGV4dCkge1xuICAgICAgICAgICAgdGV4dCA9IHRleHQgfHwgJyc7XG4gICAgICAgICAgICBpZih0ZXh0KSB7XG4gICAgICAgICAgICAgIHRleHQgPSBtb2R1bGUuZ2V0LnRleHQodGV4dCk7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTZXR0aW5nIGxhYmVsIHRvIHRleHQnLCB0ZXh0KTtcbiAgICAgICAgICAgICAgJGxhYmVsLnRleHQodGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdGF0ZTogZnVuY3Rpb24ocGVyY2VudCkge1xuICAgICAgICAgICAgcGVyY2VudCA9IChwZXJjZW50ICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gcGVyY2VudFxuICAgICAgICAgICAgICA6IG1vZHVsZS5wZXJjZW50XG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihwZXJjZW50ID09PSAxMDApIHtcbiAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuYXV0b1N1Y2Nlc3MgJiYgIShtb2R1bGUuaXMud2FybmluZygpIHx8IG1vZHVsZS5pcy5lcnJvcigpIHx8IG1vZHVsZS5pcy5zdWNjZXNzKCkpKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zdWNjZXNzKCk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBdXRvbWF0aWNhbGx5IHRyaWdnZXJpbmcgc3VjY2VzcyBhdCAxMDAlJyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlYWNoZWQgMTAwJSByZW1vdmluZyBhY3RpdmUgc3RhdGUnKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmFjdGl2ZSgpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUucHJvZ3Jlc3NQb2xsKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYocGVyY2VudCA+IDApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FkanVzdGluZyBhY3RpdmUgcHJvZ3Jlc3MgYmFyIGxhYmVsJywgcGVyY2VudCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQuYWN0aXZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5hY3RpdmUoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5sYWJlbChzZXR0aW5ncy50ZXh0LmFjdGl2ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBiYXJMYWJlbDogZnVuY3Rpb24odGV4dCkge1xuICAgICAgICAgICAgaWYodGV4dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICRwcm9ncmVzcy50ZXh0KCBtb2R1bGUuZ2V0LnRleHQodGV4dCkgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoc2V0dGluZ3MubGFiZWwgPT0gJ3JhdGlvJyAmJiBtb2R1bGUudG90YWwpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FkZGluZyByYXRpbyB0byBiYXIgbGFiZWwnKTtcbiAgICAgICAgICAgICAgJHByb2dyZXNzLnRleHQoIG1vZHVsZS5nZXQudGV4dChzZXR0aW5ncy50ZXh0LnJhdGlvKSApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihzZXR0aW5ncy5sYWJlbCA9PSAncGVyY2VudCcpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FkZGluZyBwZXJjZW50YWdlIHRvIGJhciBsYWJlbCcpO1xuICAgICAgICAgICAgICAkcHJvZ3Jlc3MudGV4dCggbW9kdWxlLmdldC50ZXh0KHNldHRpbmdzLnRleHQucGVyY2VudCkgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGFjdGl2ZTogZnVuY3Rpb24odGV4dCkge1xuICAgICAgICAgICAgdGV4dCA9IHRleHQgfHwgc2V0dGluZ3MudGV4dC5hY3RpdmU7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgYWN0aXZlIHN0YXRlJyk7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5zaG93QWN0aXZpdHkgJiYgIW1vZHVsZS5pcy5hY3RpdmUoKSApIHtcbiAgICAgICAgICAgICAgJG1vZHVsZS5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUud2FybmluZygpO1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5lcnJvcigpO1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5zdWNjZXNzKCk7XG4gICAgICAgICAgICB0ZXh0ID0gc2V0dGluZ3Mub25MYWJlbFVwZGF0ZSgnYWN0aXZlJywgdGV4dCwgbW9kdWxlLnZhbHVlLCBtb2R1bGUudG90YWwpO1xuICAgICAgICAgICAgaWYodGV4dCkge1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LmxhYmVsKHRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLmJpbmQudHJhbnNpdGlvbkVuZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3Mub25BY3RpdmUuY2FsbChlbGVtZW50LCBtb2R1bGUudmFsdWUsIG1vZHVsZS50b3RhbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHN1Y2Nlc3MgOiBmdW5jdGlvbih0ZXh0KSB7XG4gICAgICAgICAgICB0ZXh0ID0gdGV4dCB8fCBzZXR0aW5ncy50ZXh0LnN1Y2Nlc3MgfHwgc2V0dGluZ3MudGV4dC5hY3RpdmU7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgc3VjY2VzcyBzdGF0ZScpO1xuICAgICAgICAgICAgJG1vZHVsZS5hZGRDbGFzcyhjbGFzc05hbWUuc3VjY2Vzcyk7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmFjdGl2ZSgpO1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS53YXJuaW5nKCk7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmVycm9yKCk7XG4gICAgICAgICAgICBtb2R1bGUuY29tcGxldGUoKTtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnRleHQuc3VjY2Vzcykge1xuICAgICAgICAgICAgICB0ZXh0ID0gc2V0dGluZ3Mub25MYWJlbFVwZGF0ZSgnc3VjY2VzcycsIHRleHQsIG1vZHVsZS52YWx1ZSwgbW9kdWxlLnRvdGFsKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5sYWJlbCh0ZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICB0ZXh0ID0gc2V0dGluZ3Mub25MYWJlbFVwZGF0ZSgnYWN0aXZlJywgdGV4dCwgbW9kdWxlLnZhbHVlLCBtb2R1bGUudG90YWwpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LmxhYmVsKHRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLmJpbmQudHJhbnNpdGlvbkVuZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3Mub25TdWNjZXNzLmNhbGwoZWxlbWVudCwgbW9kdWxlLnRvdGFsKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgd2FybmluZyA6IGZ1bmN0aW9uKHRleHQpIHtcbiAgICAgICAgICAgIHRleHQgPSB0ZXh0IHx8IHNldHRpbmdzLnRleHQud2FybmluZztcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2V0dGluZyB3YXJuaW5nIHN0YXRlJyk7XG4gICAgICAgICAgICAkbW9kdWxlLmFkZENsYXNzKGNsYXNzTmFtZS53YXJuaW5nKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuYWN0aXZlKCk7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnN1Y2Nlc3MoKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuZXJyb3IoKTtcbiAgICAgICAgICAgIG1vZHVsZS5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgdGV4dCA9IHNldHRpbmdzLm9uTGFiZWxVcGRhdGUoJ3dhcm5pbmcnLCB0ZXh0LCBtb2R1bGUudmFsdWUsIG1vZHVsZS50b3RhbCk7XG4gICAgICAgICAgICBpZih0ZXh0KSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQubGFiZWwodGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuYmluZC50cmFuc2l0aW9uRW5kKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBzZXR0aW5ncy5vbldhcm5pbmcuY2FsbChlbGVtZW50LCBtb2R1bGUudmFsdWUsIG1vZHVsZS50b3RhbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yIDogZnVuY3Rpb24odGV4dCkge1xuICAgICAgICAgICAgdGV4dCA9IHRleHQgfHwgc2V0dGluZ3MudGV4dC5lcnJvcjtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2V0dGluZyBlcnJvciBzdGF0ZScpO1xuICAgICAgICAgICAgJG1vZHVsZS5hZGRDbGFzcyhjbGFzc05hbWUuZXJyb3IpO1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5hY3RpdmUoKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuc3VjY2VzcygpO1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS53YXJuaW5nKCk7XG4gICAgICAgICAgICBtb2R1bGUuY29tcGxldGUoKTtcbiAgICAgICAgICAgIHRleHQgPSBzZXR0aW5ncy5vbkxhYmVsVXBkYXRlKCdlcnJvcicsIHRleHQsIG1vZHVsZS52YWx1ZSwgbW9kdWxlLnRvdGFsKTtcbiAgICAgICAgICAgIGlmKHRleHQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5sYWJlbCh0ZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5iaW5kLnRyYW5zaXRpb25FbmQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzLm9uRXJyb3IuY2FsbChlbGVtZW50LCBtb2R1bGUudmFsdWUsIG1vZHVsZS50b3RhbCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRyYW5zaXRpb25FdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0cmFuc2l0aW9uRW5kID0gbW9kdWxlLmdldC50cmFuc2l0aW9uRW5kKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0b3RhbDogZnVuY3Rpb24odG90YWxWYWx1ZSkge1xuICAgICAgICAgICAgbW9kdWxlLnRvdGFsID0gdG90YWxWYWx1ZTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgbW9kdWxlLnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwcm9ncmVzczogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIGlmKCFtb2R1bGUuaGFzLnByb2dyZXNzUG9sbCgpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRmlyc3QgdXBkYXRlIGluIHByb2dyZXNzIHVwZGF0ZSBpbnRlcnZhbCwgaW1tZWRpYXRlbHkgdXBkYXRpbmcnLCB2YWx1ZSk7XG4gICAgICAgICAgICAgIG1vZHVsZS51cGRhdGUucHJvZ3Jlc3ModmFsdWUpO1xuICAgICAgICAgICAgICBtb2R1bGUuY3JlYXRlLnByb2dyZXNzUG9sbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVXBkYXRlZCB3aXRoaW4gaW50ZXJ2YWwsIHNldHRpbmcgbmV4dCB1cGRhdGUgdG8gdXNlIG5ldyB2YWx1ZScsIHZhbHVlKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5uZXh0VmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbmV4dFZhbHVlOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgbW9kdWxlLm5leHRWYWx1ZSA9IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB1cGRhdGU6IHtcbiAgICAgICAgICB0b05leHRWYWx1ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgbmV4dFZhbHVlID0gbW9kdWxlLm5leHRWYWx1ZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYobmV4dFZhbHVlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVXBkYXRlIGludGVydmFsIGNvbXBsZXRlIHVzaW5nIGxhc3QgdXBkYXRlZCB2YWx1ZScsIG5leHRWYWx1ZSk7XG4gICAgICAgICAgICAgIG1vZHVsZS51cGRhdGUucHJvZ3Jlc3MobmV4dFZhbHVlKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5uZXh0VmFsdWUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHByb2dyZXNzOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHBlcmNlbnRDb21wbGV0ZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgdmFsdWUgPSBtb2R1bGUuZ2V0Lm51bWVyaWNWYWx1ZSh2YWx1ZSk7XG4gICAgICAgICAgICBpZih2YWx1ZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm5vbk51bWVyaWMsIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhbHVlID0gbW9kdWxlLmdldC5ub3JtYWxpemVkVmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5oYXMudG90YWwoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC52YWx1ZSh2YWx1ZSk7XG4gICAgICAgICAgICAgIHBlcmNlbnRDb21wbGV0ZSA9ICh2YWx1ZSAvIG1vZHVsZS50b3RhbCkgKiAxMDA7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ2FsY3VsYXRpbmcgcGVyY2VudCBjb21wbGV0ZSBmcm9tIHRvdGFsJywgcGVyY2VudENvbXBsZXRlKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5wZXJjZW50KCBwZXJjZW50Q29tcGxldGUgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBwZXJjZW50Q29tcGxldGUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZXR0aW5nIHZhbHVlIHRvIGV4YWN0IHBlcmNlbnRhZ2UgdmFsdWUnLCBwZXJjZW50Q29tcGxldGUpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnBlcmNlbnQoIHBlcmNlbnRDb21wbGV0ZSApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXR0aW5nOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ2hhbmdpbmcgc2V0dGluZycsIG5hbWUsIHZhbHVlKTtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgc2V0dGluZ3MsIG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmKCQuaXNQbGFpbk9iamVjdChzZXR0aW5nc1tuYW1lXSkpIHtcbiAgICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgc2V0dGluZ3NbbmFtZV0sIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBzZXR0aW5nc1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5nc1tuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGludGVybmFsOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBtb2R1bGUsIG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG1vZHVsZVtuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGVbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBkZWJ1ZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZyA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5pbmZvLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB2ZXJib3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLnZlcmJvc2UgJiYgc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5pbmZvLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50KSB7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuZXJyb3IsIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBwZXJmb3JtYW5jZToge1xuICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGN1cnJlbnRUaW1lLFxuICAgICAgICAgICAgICBleGVjdXRpb25UaW1lLFxuICAgICAgICAgICAgICBwcmV2aW91c1RpbWVcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRUaW1lICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgcHJldmlvdXNUaW1lICA9IHRpbWUgfHwgY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUgPSBjdXJyZW50VGltZSAtIHByZXZpb3VzVGltZTtcbiAgICAgICAgICAgICAgdGltZSAgICAgICAgICA9IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICBwZXJmb3JtYW5jZS5wdXNoKHtcbiAgICAgICAgICAgICAgICAnTmFtZScgICAgICAgICAgIDogbWVzc2FnZVswXSxcbiAgICAgICAgICAgICAgICAnQXJndW1lbnRzJyAgICAgIDogW10uc2xpY2UuY2FsbChtZXNzYWdlLCAxKSB8fCAnJyxcbiAgICAgICAgICAgICAgICAnRWxlbWVudCcgICAgICAgIDogZWxlbWVudCxcbiAgICAgICAgICAgICAgICAnRXhlY3V0aW9uIFRpbWUnIDogZXhlY3V0aW9uVGltZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyID0gc2V0VGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UuZGlzcGxheSwgNTAwKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpc3BsYXk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHRpdGxlID0gc2V0dGluZ3MubmFtZSArICc6JyxcbiAgICAgICAgICAgICAgdG90YWxUaW1lID0gMFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgdGltZSA9IGZhbHNlO1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgIHRvdGFsVGltZSArPSBkYXRhWydFeGVjdXRpb24gVGltZSddO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aXRsZSArPSAnICcgKyB0b3RhbFRpbWUgKyAnbXMnO1xuICAgICAgICAgICAgaWYobW9kdWxlU2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgdGl0bGUgKz0gJyBcXCcnICsgbW9kdWxlU2VsZWN0b3IgKyAnXFwnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCAoY29uc29sZS5ncm91cCAhPT0gdW5kZWZpbmVkIHx8IGNvbnNvbGUudGFibGUgIT09IHVuZGVmaW5lZCkgJiYgcGVyZm9ybWFuY2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKHRpdGxlKTtcbiAgICAgICAgICAgICAgaWYoY29uc29sZS50YWJsZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUudGFibGUocGVyZm9ybWFuY2UpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQuZWFjaChwZXJmb3JtYW5jZSwgZnVuY3Rpb24oaW5kZXgsIGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGFbJ05hbWUnXSArICc6ICcgKyBkYXRhWydFeGVjdXRpb24gVGltZSddKydtcycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBFbmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBlcmZvcm1hbmNlID0gW107XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnZva2U6IGZ1bmN0aW9uKHF1ZXJ5LCBwYXNzZWRBcmd1bWVudHMsIGNvbnRleHQpIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIG9iamVjdCA9IGluc3RhbmNlLFxuICAgICAgICAgICAgbWF4RGVwdGgsXG4gICAgICAgICAgICBmb3VuZCxcbiAgICAgICAgICAgIHJlc3BvbnNlXG4gICAgICAgICAgO1xuICAgICAgICAgIHBhc3NlZEFyZ3VtZW50cyA9IHBhc3NlZEFyZ3VtZW50cyB8fCBxdWVyeUFyZ3VtZW50cztcbiAgICAgICAgICBjb250ZXh0ICAgICAgICAgPSBlbGVtZW50ICAgICAgICAgfHwgY29udGV4dDtcbiAgICAgICAgICBpZih0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycgJiYgb2JqZWN0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHF1ZXJ5ICAgID0gcXVlcnkuc3BsaXQoL1tcXC4gXS8pO1xuICAgICAgICAgICAgbWF4RGVwdGggPSBxdWVyeS5sZW5ndGggLSAxO1xuICAgICAgICAgICAgJC5lYWNoKHF1ZXJ5LCBmdW5jdGlvbihkZXB0aCwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgdmFyIGNhbWVsQ2FzZVZhbHVlID0gKGRlcHRoICE9IG1heERlcHRoKVxuICAgICAgICAgICAgICAgID8gdmFsdWUgKyBxdWVyeVtkZXB0aCArIDFdLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgcXVlcnlbZGVwdGggKyAxXS5zbGljZSgxKVxuICAgICAgICAgICAgICAgIDogcXVlcnlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICkgJiYgKGRlcHRoICE9IG1heERlcHRoKSApIHtcbiAgICAgICAgICAgICAgICBvYmplY3QgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoIG9iamVjdFtjYW1lbENhc2VWYWx1ZV0gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IG9iamVjdFtjYW1lbENhc2VWYWx1ZV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W3ZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbdmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbdmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IubWV0aG9kLCBxdWVyeSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCAkLmlzRnVuY3Rpb24oIGZvdW5kICkgKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGZvdW5kLmFwcGx5KGNvbnRleHQsIHBhc3NlZEFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoZm91bmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoJC5pc0FycmF5KHJldHVybmVkVmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlLnB1c2gocmVzcG9uc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IFtyZXR1cm5lZFZhbHVlLCByZXNwb25zZV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYocmVzcG9uc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IHJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZm91bmQ7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGlmKG1ldGhvZEludm9rZWQpIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICAgIH1cbiAgICAgICAgbW9kdWxlLmludm9rZShxdWVyeSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGluc3RhbmNlLmludm9rZSgnZGVzdHJveScpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICB9XG4gICAgfSlcbiAgO1xuXG4gIHJldHVybiAocmV0dXJuZWRWYWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgID8gcmV0dXJuZWRWYWx1ZVxuICAgIDogdGhpc1xuICA7XG59O1xuXG4kLmZuLnByb2dyZXNzLnNldHRpbmdzID0ge1xuXG4gIG5hbWUgICAgICAgICA6ICdQcm9ncmVzcycsXG4gIG5hbWVzcGFjZSAgICA6ICdwcm9ncmVzcycsXG5cbiAgc2lsZW50ICAgICAgIDogZmFsc2UsXG4gIGRlYnVnICAgICAgICA6IGZhbHNlLFxuICB2ZXJib3NlICAgICAgOiBmYWxzZSxcbiAgcGVyZm9ybWFuY2UgIDogdHJ1ZSxcblxuICByYW5kb20gICAgICAgOiB7XG4gICAgbWluIDogMixcbiAgICBtYXggOiA1XG4gIH0sXG5cbiAgZHVyYXRpb24gICAgICAgOiAzMDAsXG5cbiAgdXBkYXRlSW50ZXJ2YWwgOiAnYXV0bycsXG5cbiAgYXV0b1N1Y2Nlc3MgICAgOiB0cnVlLFxuICBzaG93QWN0aXZpdHkgICA6IHRydWUsXG4gIGxpbWl0VmFsdWVzICAgIDogdHJ1ZSxcblxuICBsYWJlbCAgICAgICAgICA6ICdwZXJjZW50JyxcbiAgcHJlY2lzaW9uICAgICAgOiAwLFxuICBmcmFtZXJhdGUgICAgICA6ICgxMDAwIC8gMzApLCAvLy8gMzAgZnBzXG5cbiAgcGVyY2VudCAgICAgICAgOiBmYWxzZSxcbiAgdG90YWwgICAgICAgICAgOiBmYWxzZSxcbiAgdmFsdWUgICAgICAgICAgOiBmYWxzZSxcblxuICAvLyBkZWxheSBpbiBtcyBmb3IgZmFpbCBzYWZlIGFuaW1hdGlvbiBjYWxsYmFja1xuICBmYWlsU2FmZURlbGF5IDogMTAwLFxuXG4gIG9uTGFiZWxVcGRhdGUgOiBmdW5jdGlvbihzdGF0ZSwgdGV4dCwgdmFsdWUsIHRvdGFsKXtcbiAgICByZXR1cm4gdGV4dDtcbiAgfSxcbiAgb25DaGFuZ2UgICAgICA6IGZ1bmN0aW9uKHBlcmNlbnQsIHZhbHVlLCB0b3RhbCl7fSxcbiAgb25TdWNjZXNzICAgICA6IGZ1bmN0aW9uKHRvdGFsKXt9LFxuICBvbkFjdGl2ZSAgICAgIDogZnVuY3Rpb24odmFsdWUsIHRvdGFsKXt9LFxuICBvbkVycm9yICAgICAgIDogZnVuY3Rpb24odmFsdWUsIHRvdGFsKXt9LFxuICBvbldhcm5pbmcgICAgIDogZnVuY3Rpb24odmFsdWUsIHRvdGFsKXt9LFxuXG4gIGVycm9yICAgIDoge1xuICAgIG1ldGhvZCAgICAgOiAnVGhlIG1ldGhvZCB5b3UgY2FsbGVkIGlzIG5vdCBkZWZpbmVkLicsXG4gICAgbm9uTnVtZXJpYyA6ICdQcm9ncmVzcyB2YWx1ZSBpcyBub24gbnVtZXJpYycsXG4gICAgdG9vSGlnaCAgICA6ICdWYWx1ZSBzcGVjaWZpZWQgaXMgYWJvdmUgMTAwJScsXG4gICAgdG9vTG93ICAgICA6ICdWYWx1ZSBzcGVjaWZpZWQgaXMgYmVsb3cgMCUnXG4gIH0sXG5cbiAgcmVnRXhwOiB7XG4gICAgdmFyaWFibGU6IC9cXHtcXCQqW0EtejAtOV0rXFx9L2dcbiAgfSxcblxuICBtZXRhZGF0YToge1xuICAgIHBlcmNlbnQgOiAncGVyY2VudCcsXG4gICAgdG90YWwgICA6ICd0b3RhbCcsXG4gICAgdmFsdWUgICA6ICd2YWx1ZSdcbiAgfSxcblxuICBzZWxlY3RvciA6IHtcbiAgICBiYXIgICAgICA6ICc+IC5iYXInLFxuICAgIGxhYmVsICAgIDogJz4gLmxhYmVsJyxcbiAgICBwcm9ncmVzcyA6ICcuYmFyID4gLnByb2dyZXNzJ1xuICB9LFxuXG4gIHRleHQgOiB7XG4gICAgYWN0aXZlICA6IGZhbHNlLFxuICAgIGVycm9yICAgOiBmYWxzZSxcbiAgICBzdWNjZXNzIDogZmFsc2UsXG4gICAgd2FybmluZyA6IGZhbHNlLFxuICAgIHBlcmNlbnQgOiAne3BlcmNlbnR9JScsXG4gICAgcmF0aW8gICA6ICd7dmFsdWV9IG9mIHt0b3RhbH0nXG4gIH0sXG5cbiAgY2xhc3NOYW1lIDoge1xuICAgIGFjdGl2ZSAgOiAnYWN0aXZlJyxcbiAgICBlcnJvciAgIDogJ2Vycm9yJyxcbiAgICBzdWNjZXNzIDogJ3N1Y2Nlc3MnLFxuICAgIHdhcm5pbmcgOiAnd2FybmluZydcbiAgfVxuXG59O1xuXG5cbn0pKCBqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQgKTtcblxuLyohXG4gKiAjIFNlbWFudGljIFVJIDIuNC4wIC0gUmF0aW5nXG4gKiBodHRwOi8vZ2l0aHViLmNvbS9zZW1hbnRpYy1vcmcvc2VtYW50aWMtdWkvXG4gKlxuICpcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuICpcbiAqL1xuXG47KGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHtcblxuJ3VzZSBzdHJpY3QnO1xuXG53aW5kb3cgPSAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoKVxuICA/IHdpbmRvd1xuICA6ICh0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aClcbiAgICA/IHNlbGZcbiAgICA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKClcbjtcblxuJC5mbi5yYXRpbmcgPSBmdW5jdGlvbihwYXJhbWV0ZXJzKSB7XG4gIHZhclxuICAgICRhbGxNb2R1bGVzICAgICA9ICQodGhpcyksXG4gICAgbW9kdWxlU2VsZWN0b3IgID0gJGFsbE1vZHVsZXMuc2VsZWN0b3IgfHwgJycsXG5cbiAgICB0aW1lICAgICAgICAgICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICBwZXJmb3JtYW5jZSAgICAgPSBbXSxcblxuICAgIHF1ZXJ5ICAgICAgICAgICA9IGFyZ3VtZW50c1swXSxcbiAgICBtZXRob2RJbnZva2VkICAgPSAodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnKSxcbiAgICBxdWVyeUFyZ3VtZW50cyAgPSBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSksXG4gICAgcmV0dXJuZWRWYWx1ZVxuICA7XG4gICRhbGxNb2R1bGVzXG4gICAgLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXJcbiAgICAgICAgc2V0dGluZ3MgICAgICAgID0gKCAkLmlzUGxhaW5PYmplY3QocGFyYW1ldGVycykgKVxuICAgICAgICAgID8gJC5leHRlbmQodHJ1ZSwge30sICQuZm4ucmF0aW5nLnNldHRpbmdzLCBwYXJhbWV0ZXJzKVxuICAgICAgICAgIDogJC5leHRlbmQoe30sICQuZm4ucmF0aW5nLnNldHRpbmdzKSxcblxuICAgICAgICBuYW1lc3BhY2UgICAgICAgPSBzZXR0aW5ncy5uYW1lc3BhY2UsXG4gICAgICAgIGNsYXNzTmFtZSAgICAgICA9IHNldHRpbmdzLmNsYXNzTmFtZSxcbiAgICAgICAgbWV0YWRhdGEgICAgICAgID0gc2V0dGluZ3MubWV0YWRhdGEsXG4gICAgICAgIHNlbGVjdG9yICAgICAgICA9IHNldHRpbmdzLnNlbGVjdG9yLFxuICAgICAgICBlcnJvciAgICAgICAgICAgPSBzZXR0aW5ncy5lcnJvcixcblxuICAgICAgICBldmVudE5hbWVzcGFjZSAgPSAnLicgKyBuYW1lc3BhY2UsXG4gICAgICAgIG1vZHVsZU5hbWVzcGFjZSA9ICdtb2R1bGUtJyArIG5hbWVzcGFjZSxcblxuICAgICAgICBlbGVtZW50ICAgICAgICAgPSB0aGlzLFxuICAgICAgICBpbnN0YW5jZSAgICAgICAgPSAkKHRoaXMpLmRhdGEobW9kdWxlTmFtZXNwYWNlKSxcblxuICAgICAgICAkbW9kdWxlICAgICAgICAgPSAkKHRoaXMpLFxuICAgICAgICAkaWNvbiAgICAgICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IuaWNvbiksXG5cbiAgICAgICAgaW5pdGlhbExvYWQsXG4gICAgICAgIG1vZHVsZVxuICAgICAgO1xuXG4gICAgICBtb2R1bGUgPSB7XG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0luaXRpYWxpemluZyByYXRpbmcgbW9kdWxlJywgc2V0dGluZ3MpO1xuXG4gICAgICAgICAgaWYoJGljb24ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBtb2R1bGUuc2V0dXAubGF5b3V0KCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYoc2V0dGluZ3MuaW50ZXJhY3RpdmUpIHtcbiAgICAgICAgICAgIG1vZHVsZS5lbmFibGUoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUuZGlzYWJsZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuc2V0LmluaXRpYWxMb2FkKCk7XG4gICAgICAgICAgbW9kdWxlLnNldC5yYXRpbmcoIG1vZHVsZS5nZXQuaW5pdGlhbFJhdGluZygpICk7XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS5pbml0aWFsTG9hZCgpO1xuICAgICAgICAgIG1vZHVsZS5pbnN0YW50aWF0ZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluc3RhbnRpYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnSW5zdGFudGlhdGluZyBtb2R1bGUnLCBzZXR0aW5ncyk7XG4gICAgICAgICAgaW5zdGFuY2UgPSBtb2R1bGU7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLmRhdGEobW9kdWxlTmFtZXNwYWNlLCBtb2R1bGUpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXN0cm95aW5nIHByZXZpb3VzIGluc3RhbmNlJywgaW5zdGFuY2UpO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUuZXZlbnRzKCk7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLnJlbW92ZURhdGEobW9kdWxlTmFtZXNwYWNlKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICByZWZyZXNoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAkaWNvbiAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLmljb24pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldHVwOiB7XG4gICAgICAgICAgbGF5b3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBtYXhSYXRpbmcgPSBtb2R1bGUuZ2V0Lm1heFJhdGluZygpLFxuICAgICAgICAgICAgICBodG1sICAgICAgPSAkLmZuLnJhdGluZy5zZXR0aW5ncy50ZW1wbGF0ZXMuaWNvbihtYXhSYXRpbmcpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0dlbmVyYXRpbmcgaWNvbiBodG1sIGR5bmFtaWNhbGx5Jyk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5odG1sKGh0bWwpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUucmVmcmVzaCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBldmVudDoge1xuICAgICAgICAgIG1vdXNlZW50ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICRhY3RpdmVJY29uID0gJCh0aGlzKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJGFjdGl2ZUljb25cbiAgICAgICAgICAgICAgLm5leHRBbGwoKVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkYWN0aXZlSWNvblxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKVxuICAgICAgICAgICAgICAgIC5wcmV2QWxsKClcbiAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbW91c2VsZWF2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkaWNvblxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICRhY3RpdmVJY29uICAgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICBjdXJyZW50UmF0aW5nID0gbW9kdWxlLmdldC5yYXRpbmcoKSxcbiAgICAgICAgICAgICAgcmF0aW5nICAgICAgICA9ICRpY29uLmluZGV4KCRhY3RpdmVJY29uKSArIDEsXG4gICAgICAgICAgICAgIGNhbkNsZWFyICAgICAgPSAoc2V0dGluZ3MuY2xlYXJhYmxlID09ICdhdXRvJylcbiAgICAgICAgICAgICAgID8gKCRpY29uLmxlbmd0aCA9PT0gMSlcbiAgICAgICAgICAgICAgIDogc2V0dGluZ3MuY2xlYXJhYmxlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihjYW5DbGVhciAmJiBjdXJyZW50UmF0aW5nID09IHJhdGluZykge1xuICAgICAgICAgICAgICBtb2R1bGUuY2xlYXJSYXRpbmcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnJhdGluZyggcmF0aW5nICk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNsZWFyUmF0aW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NsZWFyaW5nIGN1cnJlbnQgcmF0aW5nJyk7XG4gICAgICAgICAgbW9kdWxlLnNldC5yYXRpbmcoMCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYmluZDoge1xuICAgICAgICAgIGV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQmluZGluZyBldmVudHMnKTtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLm9uKCdtb3VzZWVudGVyJyArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5pY29uLCBtb2R1bGUuZXZlbnQubW91c2VlbnRlcilcbiAgICAgICAgICAgICAgLm9uKCdtb3VzZWxlYXZlJyArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5pY29uLCBtb2R1bGUuZXZlbnQubW91c2VsZWF2ZSlcbiAgICAgICAgICAgICAgLm9uKCdjbGljaycgICAgICArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5pY29uLCBtb2R1bGUuZXZlbnQuY2xpY2spXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZToge1xuICAgICAgICAgIGV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3ZpbmcgZXZlbnRzJyk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5vZmYoZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbml0aWFsTG9hZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpbml0aWFsTG9hZCA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2V0dGluZyByYXRpbmcgdG8gaW50ZXJhY3RpdmUgbW9kZScpO1xuICAgICAgICAgIG1vZHVsZS5iaW5kLmV2ZW50cygpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuZGlzYWJsZWQpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRpc2FibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2V0dGluZyByYXRpbmcgdG8gcmVhZC1vbmx5IG1vZGUnKTtcbiAgICAgICAgICBtb2R1bGUucmVtb3ZlLmV2ZW50cygpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuZGlzYWJsZWQpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGlzOiB7XG4gICAgICAgICAgaW5pdGlhbExvYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIGluaXRpYWxMb2FkO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBnZXQ6IHtcbiAgICAgICAgICBpbml0aWFsUmF0aW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCRtb2R1bGUuZGF0YShtZXRhZGF0YS5yYXRpbmcpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVEYXRhKG1ldGFkYXRhLnJhdGluZyk7XG4gICAgICAgICAgICAgIHJldHVybiAkbW9kdWxlLmRhdGEobWV0YWRhdGEucmF0aW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5pbml0aWFsUmF0aW5nO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbWF4UmF0aW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCRtb2R1bGUuZGF0YShtZXRhZGF0YS5tYXhSYXRpbmcpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVEYXRhKG1ldGFkYXRhLm1heFJhdGluZyk7XG4gICAgICAgICAgICAgIHJldHVybiAkbW9kdWxlLmRhdGEobWV0YWRhdGEubWF4UmF0aW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5tYXhSYXRpbmc7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByYXRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGN1cnJlbnRSYXRpbmcgPSAkaWNvbi5maWx0ZXIoJy4nICsgY2xhc3NOYW1lLmFjdGl2ZSkubGVuZ3RoXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQ3VycmVudCByYXRpbmcgcmV0cmlldmVkJywgY3VycmVudFJhdGluZyk7XG4gICAgICAgICAgICByZXR1cm4gY3VycmVudFJhdGluZztcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiB7XG4gICAgICAgICAgcmF0aW5nOiBmdW5jdGlvbihyYXRpbmcpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICByYXRpbmdJbmRleCA9IChyYXRpbmcgLSAxID49IDApXG4gICAgICAgICAgICAgICAgPyAocmF0aW5nIC0gMSlcbiAgICAgICAgICAgICAgICA6IDAsXG4gICAgICAgICAgICAgICRhY3RpdmVJY29uID0gJGljb24uZXEocmF0aW5nSW5kZXgpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuc2VsZWN0ZWQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkaWNvblxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLnNlbGVjdGVkKVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHJhdGluZyA+IDApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NldHRpbmcgY3VycmVudCByYXRpbmcgdG8nLCByYXRpbmcpO1xuICAgICAgICAgICAgICAkYWN0aXZlSWNvblxuICAgICAgICAgICAgICAgIC5wcmV2QWxsKClcbiAgICAgICAgICAgICAgICAuYWRkQmFjaygpXG4gICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIW1vZHVsZS5pcy5pbml0aWFsTG9hZCgpKSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzLm9uUmF0ZS5jYWxsKGVsZW1lbnQsIHJhdGluZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbml0aWFsTG9hZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpbml0aWFsTG9hZCA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldHRpbmc6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdDaGFuZ2luZyBzZXR0aW5nJywgbmFtZSwgdmFsdWUpO1xuICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBzZXR0aW5ncywgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYoJC5pc1BsYWluT2JqZWN0KHNldHRpbmdzW25hbWVdKSkge1xuICAgICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBzZXR0aW5nc1tuYW1lXSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW50ZXJuYWw6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIG1vZHVsZSwgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbW9kdWxlW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVtuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlYnVnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHZlcmJvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MudmVyYm9zZSAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZS5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQpIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvciA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5lcnJvciwgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUsXG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICBwcmV2aW91c1RpbWUgID0gdGltZSB8fCBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSA9IGN1cnJlbnRUaW1lIC0gcHJldmlvdXNUaW1lO1xuICAgICAgICAgICAgICB0aW1lICAgICAgICAgID0gY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIHBlcmZvcm1hbmNlLnB1c2goe1xuICAgICAgICAgICAgICAgICdOYW1lJyAgICAgICAgICAgOiBtZXNzYWdlWzBdLFxuICAgICAgICAgICAgICAgICdBcmd1bWVudHMnICAgICAgOiBbXS5zbGljZS5jYWxsKG1lc3NhZ2UsIDEpIHx8ICcnLFxuICAgICAgICAgICAgICAgICdFbGVtZW50JyAgICAgICAgOiBlbGVtZW50LFxuICAgICAgICAgICAgICAgICdFeGVjdXRpb24gVGltZScgOiBleGVjdXRpb25UaW1lXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UudGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS5kaXNwbGF5LCA1MDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlzcGxheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdGl0bGUgPSBzZXR0aW5ncy5uYW1lICsgJzonLFxuICAgICAgICAgICAgICB0b3RhbFRpbWUgPSAwXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICB0aW1lID0gZmFsc2U7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgICQuZWFjaChwZXJmb3JtYW5jZSwgZnVuY3Rpb24oaW5kZXgsIGRhdGEpIHtcbiAgICAgICAgICAgICAgdG90YWxUaW1lICs9IGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRpdGxlICs9ICcgJyArIHRvdGFsVGltZSArICdtcyc7XG4gICAgICAgICAgICBpZihtb2R1bGVTZWxlY3Rvcikge1xuICAgICAgICAgICAgICB0aXRsZSArPSAnIFxcJycgKyBtb2R1bGVTZWxlY3RvciArICdcXCcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoJGFsbE1vZHVsZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICB0aXRsZSArPSAnICcgKyAnKCcgKyAkYWxsTW9kdWxlcy5sZW5ndGggKyAnKSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggKGNvbnNvbGUuZ3JvdXAgIT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLnRhYmxlICE9PSB1bmRlZmluZWQpICYmIHBlcmZvcm1hbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgICAgIGlmKGNvbnNvbGUudGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKHBlcmZvcm1hbmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZXJmb3JtYW5jZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCAkLmlzRnVuY3Rpb24oIGZvdW5kICkgKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGZvdW5kLmFwcGx5KGNvbnRleHQsIHBhc3NlZEFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoZm91bmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoJC5pc0FycmF5KHJldHVybmVkVmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlLnB1c2gocmVzcG9uc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IFtyZXR1cm5lZFZhbHVlLCByZXNwb25zZV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYocmVzcG9uc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IHJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZm91bmQ7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgICAgIGlmKGluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbnZva2UocXVlcnkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmKGluc3RhbmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpbnN0YW5jZS5pbnZva2UoJ2Rlc3Ryb3knKTtcbiAgICAgICAgfVxuICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgfVxuICAgIH0pXG4gIDtcblxuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xufTtcblxuJC5mbi5yYXRpbmcuc2V0dGluZ3MgPSB7XG5cbiAgbmFtZSAgICAgICAgICA6ICdSYXRpbmcnLFxuICBuYW1lc3BhY2UgICAgIDogJ3JhdGluZycsXG5cbiAgc2xlbnQgICAgICAgICA6IGZhbHNlLFxuICBkZWJ1ZyAgICAgICAgIDogZmFsc2UsXG4gIHZlcmJvc2UgICAgICAgOiBmYWxzZSxcbiAgcGVyZm9ybWFuY2UgICA6IHRydWUsXG5cbiAgaW5pdGlhbFJhdGluZyA6IDAsXG4gIGludGVyYWN0aXZlICAgOiB0cnVlLFxuICBtYXhSYXRpbmcgICAgIDogNCxcbiAgY2xlYXJhYmxlICAgICA6ICdhdXRvJyxcblxuICBmaXJlT25Jbml0ICAgIDogZmFsc2UsXG5cbiAgb25SYXRlICAgICAgICA6IGZ1bmN0aW9uKHJhdGluZyl7fSxcblxuICBlcnJvciAgICAgICAgIDoge1xuICAgIG1ldGhvZCAgICA6ICdUaGUgbWV0aG9kIHlvdSBjYWxsZWQgaXMgbm90IGRlZmluZWQnLFxuICAgIG5vTWF4aW11bSA6ICdObyBtYXhpbXVtIHJhdGluZyBzcGVjaWZpZWQuIENhbm5vdCBnZW5lcmF0ZSBIVE1MIGF1dG9tYXRpY2FsbHknXG4gIH0sXG5cblxuICBtZXRhZGF0YToge1xuICAgIHJhdGluZyAgICA6ICdyYXRpbmcnLFxuICAgIG1heFJhdGluZyA6ICdtYXhSYXRpbmcnXG4gIH0sXG5cbiAgY2xhc3NOYW1lIDoge1xuICAgIGFjdGl2ZSAgIDogJ2FjdGl2ZScsXG4gICAgZGlzYWJsZWQgOiAnZGlzYWJsZWQnLFxuICAgIHNlbGVjdGVkIDogJ3NlbGVjdGVkJyxcbiAgICBsb2FkaW5nICA6ICdsb2FkaW5nJ1xuICB9LFxuXG4gIHNlbGVjdG9yICA6IHtcbiAgICBpY29uIDogJy5pY29uJ1xuICB9LFxuXG4gIHRlbXBsYXRlczoge1xuICAgIGljb246IGZ1bmN0aW9uKG1heFJhdGluZykge1xuICAgICAgdmFyXG4gICAgICAgIGljb24gPSAxLFxuICAgICAgICBodG1sID0gJydcbiAgICAgIDtcbiAgICAgIHdoaWxlKGljb24gPD0gbWF4UmF0aW5nKSB7XG4gICAgICAgIGh0bWwgKz0gJzxpIGNsYXNzPVwiaWNvblwiPjwvaT4nO1xuICAgICAgICBpY29uKys7XG4gICAgICB9XG4gICAgICByZXR1cm4gaHRtbDtcbiAgICB9XG4gIH1cblxufTtcblxufSkoIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCApO1xuXG4vKiFcbiAqICMgU2VtYW50aWMgVUkgMi40LjAgLSBTZWFyY2hcbiAqIGh0dHA6Ly9naXRodWIuY29tL3NlbWFudGljLW9yZy9zZW1hbnRpYy11aS9cbiAqXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG5cbjsoZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG4ndXNlIHN0cmljdCc7XG5cbndpbmRvdyA9ICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGgpXG4gID8gd2luZG93XG4gIDogKHR5cGVvZiBzZWxmICE9ICd1bmRlZmluZWQnICYmIHNlbGYuTWF0aCA9PSBNYXRoKVxuICAgID8gc2VsZlxuICAgIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKVxuO1xuXG4kLmZuLnNlYXJjaCA9IGZ1bmN0aW9uKHBhcmFtZXRlcnMpIHtcbiAgdmFyXG4gICAgJGFsbE1vZHVsZXMgICAgID0gJCh0aGlzKSxcbiAgICBtb2R1bGVTZWxlY3RvciAgPSAkYWxsTW9kdWxlcy5zZWxlY3RvciB8fCAnJyxcblxuICAgIHRpbWUgICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgICA9IFtdLFxuXG4gICAgcXVlcnkgICAgICAgICAgID0gYXJndW1lbnRzWzBdLFxuICAgIG1ldGhvZEludm9rZWQgICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzICA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcbiAgICByZXR1cm5lZFZhbHVlXG4gIDtcbiAgJCh0aGlzKVxuICAgIC5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyXG4gICAgICAgIHNldHRpbmdzICAgICAgICAgID0gKCAkLmlzUGxhaW5PYmplY3QocGFyYW1ldGVycykgKVxuICAgICAgICAgID8gJC5leHRlbmQodHJ1ZSwge30sICQuZm4uc2VhcmNoLnNldHRpbmdzLCBwYXJhbWV0ZXJzKVxuICAgICAgICAgIDogJC5leHRlbmQoe30sICQuZm4uc2VhcmNoLnNldHRpbmdzKSxcblxuICAgICAgICBjbGFzc05hbWUgICAgICAgID0gc2V0dGluZ3MuY2xhc3NOYW1lLFxuICAgICAgICBtZXRhZGF0YSAgICAgICAgID0gc2V0dGluZ3MubWV0YWRhdGEsXG4gICAgICAgIHJlZ0V4cCAgICAgICAgICAgPSBzZXR0aW5ncy5yZWdFeHAsXG4gICAgICAgIGZpZWxkcyAgICAgICAgICAgPSBzZXR0aW5ncy5maWVsZHMsXG4gICAgICAgIHNlbGVjdG9yICAgICAgICAgPSBzZXR0aW5ncy5zZWxlY3RvcixcbiAgICAgICAgZXJyb3IgICAgICAgICAgICA9IHNldHRpbmdzLmVycm9yLFxuICAgICAgICBuYW1lc3BhY2UgICAgICAgID0gc2V0dGluZ3MubmFtZXNwYWNlLFxuXG4gICAgICAgIGV2ZW50TmFtZXNwYWNlICAgPSAnLicgKyBuYW1lc3BhY2UsXG4gICAgICAgIG1vZHVsZU5hbWVzcGFjZSAgPSBuYW1lc3BhY2UgKyAnLW1vZHVsZScsXG5cbiAgICAgICAgJG1vZHVsZSAgICAgICAgICA9ICQodGhpcyksXG4gICAgICAgICRwcm9tcHQgICAgICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IucHJvbXB0KSxcbiAgICAgICAgJHNlYXJjaEJ1dHRvbiAgICA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5zZWFyY2hCdXR0b24pLFxuICAgICAgICAkcmVzdWx0cyAgICAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLnJlc3VsdHMpLFxuICAgICAgICAkcmVzdWx0ICAgICAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLnJlc3VsdCksXG4gICAgICAgICRjYXRlZ29yeSAgICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IuY2F0ZWdvcnkpLFxuXG4gICAgICAgIGVsZW1lbnQgICAgICAgICAgPSB0aGlzLFxuICAgICAgICBpbnN0YW5jZSAgICAgICAgID0gJG1vZHVsZS5kYXRhKG1vZHVsZU5hbWVzcGFjZSksXG5cbiAgICAgICAgZGlzYWJsZWRCdWJibGVkICA9IGZhbHNlLFxuICAgICAgICByZXN1bHRzRGlzbWlzc2VkID0gZmFsc2UsXG5cbiAgICAgICAgbW9kdWxlXG4gICAgICA7XG5cbiAgICAgIG1vZHVsZSA9IHtcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnSW5pdGlhbGl6aW5nIG1vZHVsZScpO1xuICAgICAgICAgIG1vZHVsZS5nZXQuc2V0dGluZ3MoKTtcbiAgICAgICAgICBtb2R1bGUuZGV0ZXJtaW5lLnNlYXJjaEZpZWxkcygpO1xuICAgICAgICAgIG1vZHVsZS5iaW5kLmV2ZW50cygpO1xuICAgICAgICAgIG1vZHVsZS5zZXQudHlwZSgpO1xuICAgICAgICAgIG1vZHVsZS5jcmVhdGUucmVzdWx0cygpO1xuICAgICAgICAgIG1vZHVsZS5pbnN0YW50aWF0ZSgpO1xuICAgICAgICB9LFxuICAgICAgICBpbnN0YW50aWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1N0b3JpbmcgaW5zdGFuY2Ugb2YgbW9kdWxlJywgbW9kdWxlKTtcbiAgICAgICAgICBpbnN0YW5jZSA9IG1vZHVsZTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAuZGF0YShtb2R1bGVOYW1lc3BhY2UsIG1vZHVsZSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXN0cm95aW5nIGluc3RhbmNlJyk7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLm9mZihldmVudE5hbWVzcGFjZSlcbiAgICAgICAgICAgIC5yZW1vdmVEYXRhKG1vZHVsZU5hbWVzcGFjZSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZWZyZXNoaW5nIHNlbGVjdG9yIGNhY2hlJyk7XG4gICAgICAgICAgJHByb21wdCAgICAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLnByb21wdCk7XG4gICAgICAgICAgJHNlYXJjaEJ1dHRvbiAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLnNlYXJjaEJ1dHRvbik7XG4gICAgICAgICAgJGNhdGVnb3J5ICAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLmNhdGVnb3J5KTtcbiAgICAgICAgICAkcmVzdWx0cyAgICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IucmVzdWx0cyk7XG4gICAgICAgICAgJHJlc3VsdCAgICAgICAgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLnJlc3VsdCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVmcmVzaFJlc3VsdHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICRyZXN1bHRzID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLnJlc3VsdHMpO1xuICAgICAgICAgICRyZXN1bHQgID0gJG1vZHVsZS5maW5kKHNlbGVjdG9yLnJlc3VsdCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYmluZDoge1xuICAgICAgICAgIGV2ZW50czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQmluZGluZyBldmVudHMgdG8gc2VhcmNoJyk7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5hdXRvbWF0aWMpIHtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5vbihtb2R1bGUuZ2V0LmlucHV0RXZlbnQoKSArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5wcm9tcHQsIG1vZHVsZS5ldmVudC5pbnB1dClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAkcHJvbXB0XG4gICAgICAgICAgICAgICAgLmF0dHIoJ2F1dG9jb21wbGV0ZScsICdvZmYnKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC8vIHByb21wdFxuICAgICAgICAgICAgICAub24oJ2ZvY3VzJyAgICAgKyBldmVudE5hbWVzcGFjZSwgc2VsZWN0b3IucHJvbXB0LCBtb2R1bGUuZXZlbnQuZm9jdXMpXG4gICAgICAgICAgICAgIC5vbignYmx1cicgICAgICArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5wcm9tcHQsIG1vZHVsZS5ldmVudC5ibHVyKVxuICAgICAgICAgICAgICAub24oJ2tleWRvd24nICAgKyBldmVudE5hbWVzcGFjZSwgc2VsZWN0b3IucHJvbXB0LCBtb2R1bGUuaGFuZGxlS2V5Ym9hcmQpXG4gICAgICAgICAgICAgIC8vIHNlYXJjaCBidXR0b25cbiAgICAgICAgICAgICAgLm9uKCdjbGljaycgICAgICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLnNlYXJjaEJ1dHRvbiwgbW9kdWxlLnF1ZXJ5KVxuICAgICAgICAgICAgICAvLyByZXN1bHRzXG4gICAgICAgICAgICAgIC5vbignbW91c2Vkb3duJyArIGV2ZW50TmFtZXNwYWNlLCBzZWxlY3Rvci5yZXN1bHRzLCBtb2R1bGUuZXZlbnQucmVzdWx0Lm1vdXNlZG93bilcbiAgICAgICAgICAgICAgLm9uKCdtb3VzZXVwJyAgICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLnJlc3VsdHMsIG1vZHVsZS5ldmVudC5yZXN1bHQubW91c2V1cClcbiAgICAgICAgICAgICAgLm9uKCdjbGljaycgICAgICsgZXZlbnROYW1lc3BhY2UsIHNlbGVjdG9yLnJlc3VsdCwgIG1vZHVsZS5ldmVudC5yZXN1bHQuY2xpY2spXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRldGVybWluZToge1xuICAgICAgICAgIHNlYXJjaEZpZWxkczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyB0aGlzIG1ha2VzIHN1cmUgJC5leHRlbmQgZG9lcyBub3QgYWRkIHNwZWNpZmllZCBzZWFyY2ggZmllbGRzIHRvIGRlZmF1bHQgZmllbGRzXG4gICAgICAgICAgICAvLyB0aGlzIGlzIHRoZSBvbmx5IHNldHRpbmcgd2hpY2ggc2hvdWxkIG5vdCBleHRlbmQgZGVmYXVsdHNcbiAgICAgICAgICAgIGlmKHBhcmFtZXRlcnMgJiYgcGFyYW1ldGVycy5zZWFyY2hGaWVsZHMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBzZXR0aW5ncy5zZWFyY2hGaWVsZHMgPSBwYXJhbWV0ZXJzLnNlYXJjaEZpZWxkcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXZlbnQ6IHtcbiAgICAgICAgICBpbnB1dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5zZWFyY2hEZWxheSkge1xuICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnRpbWVyKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZihtb2R1bGUuaXMuZm9jdXNlZCgpKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUucXVlcnkoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sIHNldHRpbmdzLnNlYXJjaERlbGF5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUucXVlcnkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvY3VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQuZm9jdXMoKTtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnNlYXJjaE9uRm9jdXMgJiYgbW9kdWxlLmhhcy5taW5pbXVtQ2hhcmFjdGVycygpICkge1xuICAgICAgICAgICAgICBtb2R1bGUucXVlcnkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYobW9kdWxlLmNhbi5zaG93KCkgKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuc2hvd1Jlc3VsdHMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgYmx1cjogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBwYWdlTG9zdEZvY3VzID0gKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT09IHRoaXMpLFxuICAgICAgICAgICAgICBjYWxsYmFjayAgICAgID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmNhbmNlbC5xdWVyeSgpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuZm9jdXMoKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUudGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5oaWRlUmVzdWx0cywgc2V0dGluZ3MuaGlkZURlbGF5KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYocGFnZUxvc3RGb2N1cykge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHRzRGlzbWlzc2VkID0gZmFsc2U7XG4gICAgICAgICAgICBpZihtb2R1bGUucmVzdWx0c0NsaWNrZWQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdEZXRlcm1pbmluZyBpZiB1c2VyIGFjdGlvbiBjYXVzZWQgc2VhcmNoIHRvIGNsb3NlJyk7XG4gICAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgICAub25lKCdjbGljay5jbG9zZScgKyBldmVudE5hbWVzcGFjZSwgc2VsZWN0b3IucmVzdWx0cywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5pbk1lc3NhZ2UoZXZlbnQpIHx8IGRpc2FibGVkQnViYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAkcHJvbXB0LmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGRpc2FibGVkQnViYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgaWYoICFtb2R1bGUuaXMuYW5pbWF0aW5nKCkgJiYgIW1vZHVsZS5pcy5oaWRkZW4oKSkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0lucHV0IGJsdXJyZWQgd2l0aG91dCB1c2VyIGFjdGlvbiwgY2xvc2luZyByZXN1bHRzJyk7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXN1bHQ6IHtcbiAgICAgICAgICAgIG1vdXNlZG93bjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZXN1bHRzQ2xpY2tlZCA9IHRydWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgbW91c2V1cDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZXN1bHRzQ2xpY2tlZCA9IGZhbHNlO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNsaWNrOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NlYXJjaCByZXN1bHQgc2VsZWN0ZWQnKTtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgJHJlc3VsdCA9ICQodGhpcyksXG4gICAgICAgICAgICAgICAgJHRpdGxlICA9ICRyZXN1bHQuZmluZChzZWxlY3Rvci50aXRsZSkuZXEoMCksXG4gICAgICAgICAgICAgICAgJGxpbmsgICA9ICRyZXN1bHQuaXMoJ2FbaHJlZl0nKVxuICAgICAgICAgICAgICAgICAgPyAkcmVzdWx0XG4gICAgICAgICAgICAgICAgICA6ICRyZXN1bHQuZmluZCgnYVtocmVmXScpLmVxKDApLFxuICAgICAgICAgICAgICAgIGhyZWYgICAgPSAkbGluay5hdHRyKCdocmVmJykgICB8fCBmYWxzZSxcbiAgICAgICAgICAgICAgICB0YXJnZXQgID0gJGxpbmsuYXR0cigndGFyZ2V0JykgfHwgZmFsc2UsXG4gICAgICAgICAgICAgICAgdGl0bGUgICA9ICR0aXRsZS5odG1sKCksXG4gICAgICAgICAgICAgICAgLy8gdGl0bGUgaXMgdXNlZCBmb3IgcmVzdWx0IGxvb2t1cFxuICAgICAgICAgICAgICAgIHZhbHVlICAgPSAoJHRpdGxlLmxlbmd0aCA+IDApXG4gICAgICAgICAgICAgICAgICA/ICR0aXRsZS50ZXh0KClcbiAgICAgICAgICAgICAgICAgIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVzdWx0cyA9IG1vZHVsZS5nZXQucmVzdWx0cygpLFxuICAgICAgICAgICAgICAgIHJlc3VsdCAgPSAkcmVzdWx0LmRhdGEobWV0YWRhdGEucmVzdWx0KSB8fCBtb2R1bGUuZ2V0LnJlc3VsdCh2YWx1ZSwgcmVzdWx0cyksXG4gICAgICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCAkLmlzRnVuY3Rpb24oc2V0dGluZ3Mub25TZWxlY3QpICkge1xuICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLm9uU2VsZWN0LmNhbGwoZWxlbWVudCwgcmVzdWx0LCByZXN1bHRzKSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ3VzdG9tIG9uU2VsZWN0IGNhbGxiYWNrIGNhbmNlbGxlZCBkZWZhdWx0IHNlbGVjdCBhY3Rpb24nKTtcbiAgICAgICAgICAgICAgICAgIGRpc2FibGVkQnViYmxlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIG1vZHVsZS5oaWRlUmVzdWx0cygpO1xuICAgICAgICAgICAgICBpZih2YWx1ZSkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5zZXQudmFsdWUodmFsdWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKGhyZWYpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnT3BlbmluZyBzZWFyY2ggbGluayBmb3VuZCBpbiByZXN1bHQnLCAkbGluayk7XG4gICAgICAgICAgICAgICAgaWYodGFyZ2V0ID09ICdfYmxhbmsnIHx8IGV2ZW50LmN0cmxLZXkpIHtcbiAgICAgICAgICAgICAgICAgIHdpbmRvdy5vcGVuKGhyZWYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gKGhyZWYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaGFuZGxlS2V5Ym9hcmQ6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAvLyBmb3JjZSBzZWxlY3RvciByZWZyZXNoXG4gICAgICAgICAgICAkcmVzdWx0ICAgICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3IucmVzdWx0KSxcbiAgICAgICAgICAgICRjYXRlZ29yeSAgICAgICA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5jYXRlZ29yeSksXG4gICAgICAgICAgICAkYWN0aXZlUmVzdWx0ICAgPSAkcmVzdWx0LmZpbHRlcignLicgKyBjbGFzc05hbWUuYWN0aXZlKSxcbiAgICAgICAgICAgIGN1cnJlbnRJbmRleCAgICA9ICRyZXN1bHQuaW5kZXgoICRhY3RpdmVSZXN1bHQgKSxcbiAgICAgICAgICAgIHJlc3VsdFNpemUgICAgICA9ICRyZXN1bHQubGVuZ3RoLFxuICAgICAgICAgICAgaGFzQWN0aXZlUmVzdWx0ID0gJGFjdGl2ZVJlc3VsdC5sZW5ndGggPiAwLFxuXG4gICAgICAgICAgICBrZXlDb2RlICAgICAgICAgPSBldmVudC53aGljaCxcbiAgICAgICAgICAgIGtleXMgICAgICAgICAgICA9IHtcbiAgICAgICAgICAgICAgYmFja3NwYWNlIDogOCxcbiAgICAgICAgICAgICAgZW50ZXIgICAgIDogMTMsXG4gICAgICAgICAgICAgIGVzY2FwZSAgICA6IDI3LFxuICAgICAgICAgICAgICB1cEFycm93ICAgOiAzOCxcbiAgICAgICAgICAgICAgZG93bkFycm93IDogNDBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBuZXdJbmRleFxuICAgICAgICAgIDtcbiAgICAgICAgICAvLyBzZWFyY2ggc2hvcnRjdXRzXG4gICAgICAgICAgaWYoa2V5Q29kZSA9PSBrZXlzLmVzY2FwZSkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0VzY2FwZSBrZXkgcHJlc3NlZCwgYmx1cnJpbmcgc2VhcmNoIGZpZWxkJyk7XG4gICAgICAgICAgICBtb2R1bGUuaGlkZVJlc3VsdHMoKTtcbiAgICAgICAgICAgIHJlc3VsdHNEaXNtaXNzZWQgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiggbW9kdWxlLmlzLnZpc2libGUoKSApIHtcbiAgICAgICAgICAgIGlmKGtleUNvZGUgPT0ga2V5cy5lbnRlcikge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRW50ZXIga2V5IHByZXNzZWQsIHNlbGVjdGluZyBhY3RpdmUgcmVzdWx0Jyk7XG4gICAgICAgICAgICAgIGlmKCAkcmVzdWx0LmZpbHRlcignLicgKyBjbGFzc05hbWUuYWN0aXZlKS5sZW5ndGggPiAwICkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5ldmVudC5yZXN1bHQuY2xpY2suY2FsbCgkcmVzdWx0LmZpbHRlcignLicgKyBjbGFzc05hbWUuYWN0aXZlKSwgZXZlbnQpO1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGtleUNvZGUgPT0ga2V5cy51cEFycm93ICYmIGhhc0FjdGl2ZVJlc3VsdCkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnVXAga2V5IHByZXNzZWQsIGNoYW5naW5nIGFjdGl2ZSByZXN1bHQnKTtcbiAgICAgICAgICAgICAgbmV3SW5kZXggPSAoY3VycmVudEluZGV4IC0gMSA8IDApXG4gICAgICAgICAgICAgICAgPyBjdXJyZW50SW5kZXhcbiAgICAgICAgICAgICAgICA6IGN1cnJlbnRJbmRleCAtIDFcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAkY2F0ZWdvcnlcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAkcmVzdWx0XG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hY3RpdmUpXG4gICAgICAgICAgICAgICAgLmVxKG5ld0luZGV4KVxuICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5hY3RpdmUpXG4gICAgICAgICAgICAgICAgICAuY2xvc2VzdCgkY2F0ZWdvcnkpXG4gICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGtleUNvZGUgPT0ga2V5cy5kb3duQXJyb3cpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0Rvd24ga2V5IHByZXNzZWQsIGNoYW5naW5nIGFjdGl2ZSByZXN1bHQnKTtcbiAgICAgICAgICAgICAgbmV3SW5kZXggPSAoY3VycmVudEluZGV4ICsgMSA+PSByZXN1bHRTaXplKVxuICAgICAgICAgICAgICAgID8gY3VycmVudEluZGV4XG4gICAgICAgICAgICAgICAgOiBjdXJyZW50SW5kZXggKyAxXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgJGNhdGVnb3J5XG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hY3RpdmUpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgJHJlc3VsdFxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgICAgIC5lcShuZXdJbmRleClcbiAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgICAgICAgLmNsb3Nlc3QoJGNhdGVnb3J5KVxuICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIHF1ZXJ5IHNob3J0Y3V0c1xuICAgICAgICAgICAgaWYoa2V5Q29kZSA9PSBrZXlzLmVudGVyKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdFbnRlciBrZXkgcHJlc3NlZCwgZXhlY3V0aW5nIHF1ZXJ5Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5xdWVyeSgpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LmJ1dHRvblByZXNzZWQoKTtcbiAgICAgICAgICAgICAgJHByb21wdC5vbmUoJ2tleXVwJywgbW9kdWxlLnJlbW92ZS5idXR0b25Gb2N1cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldHVwOiB7XG4gICAgICAgICAgYXBpOiBmdW5jdGlvbihzZWFyY2hUZXJtLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGFwaVNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIGRlYnVnICAgICAgICAgICAgIDogc2V0dGluZ3MuZGVidWcsXG4gICAgICAgICAgICAgICAgb24gICAgICAgICAgICAgICAgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBjYWNoZSAgICAgICAgICAgICA6IHNldHRpbmdzLmNhY2hlLFxuICAgICAgICAgICAgICAgIGFjdGlvbiAgICAgICAgICAgIDogJ3NlYXJjaCcsXG4gICAgICAgICAgICAgICAgdXJsRGF0YSAgICAgICAgICAgOiB7XG4gICAgICAgICAgICAgICAgICBxdWVyeSA6IHNlYXJjaFRlcm1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uU3VjY2VzcyAgICAgICAgIDogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5wYXJzZS5yZXNwb25zZS5jYWxsKGVsZW1lbnQsIHJlc3BvbnNlLCBzZWFyY2hUZXJtKTtcbiAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbkZhaWx1cmUgICAgICAgICA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmRpc3BsYXlNZXNzYWdlKGVycm9yLnNlcnZlckVycm9yKTtcbiAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBvbkFib3J0IDogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9uRXJyb3IgICAgICAgICAgIDogbW9kdWxlLmVycm9yXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHNlYXJjaEhUTUxcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIGFwaVNldHRpbmdzLCBzZXR0aW5ncy5hcGlTZXR0aW5ncyk7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2V0dGluZyB1cCBBUEkgcmVxdWVzdCcsIGFwaVNldHRpbmdzKTtcbiAgICAgICAgICAgICRtb2R1bGUuYXBpKGFwaVNldHRpbmdzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FuOiB7XG4gICAgICAgICAgdXNlQVBJOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkLmZuLmFwaSAhPT0gdW5kZWZpbmVkO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2hvdzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLmlzLmZvY3VzZWQoKSAmJiAhbW9kdWxlLmlzLnZpc2libGUoKSAmJiAhbW9kdWxlLmlzLmVtcHR5KCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0cmFuc2l0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy50cmFuc2l0aW9uICYmICQuZm4udHJhbnNpdGlvbiAhPT0gdW5kZWZpbmVkICYmICRtb2R1bGUudHJhbnNpdGlvbignaXMgc3VwcG9ydGVkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGlzOiB7XG4gICAgICAgICAgYW5pbWF0aW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkcmVzdWx0cy5oYXNDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhpZGRlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJHJlc3VsdHMuaGFzQ2xhc3MoY2xhc3NOYW1lLmhpZGRlbik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbk1lc3NhZ2U6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBpZighZXZlbnQudGFyZ2V0KSB7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkdGFyZ2V0ID0gJChldmVudC50YXJnZXQpLFxuICAgICAgICAgICAgICBpc0luRE9NID0gJC5jb250YWlucyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGV2ZW50LnRhcmdldClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiAoaXNJbkRPTSAmJiAkdGFyZ2V0LmNsb3Nlc3Qoc2VsZWN0b3IubWVzc2FnZSkubGVuZ3RoID4gMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlbXB0eTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKCRyZXN1bHRzLmh0bWwoKSA9PT0gJycpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmlzaWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKCRyZXN1bHRzLmZpbHRlcignOnZpc2libGUnKS5sZW5ndGggPiAwKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvY3VzZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICgkcHJvbXB0LmZpbHRlcignOmZvY3VzJykubGVuZ3RoID4gMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGdldDoge1xuICAgICAgICAgIHNldHRpbmdzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCQuaXNQbGFpbk9iamVjdChwYXJhbWV0ZXJzKSAmJiBwYXJhbWV0ZXJzLnNlYXJjaEZ1bGxUZXh0KSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzLmZ1bGxUZXh0U2VhcmNoID0gcGFyYW1ldGVycy5zZWFyY2hGdWxsVGV4dDtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKHNldHRpbmdzLmVycm9yLm9sZFNlYXJjaFN5bnRheCwgZWxlbWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbnB1dEV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBwcm9tcHQgPSAkcHJvbXB0WzBdLFxuICAgICAgICAgICAgICBpbnB1dEV2ZW50ICAgPSAocHJvbXB0ICE9PSB1bmRlZmluZWQgJiYgcHJvbXB0Lm9uaW5wdXQgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICA/ICdpbnB1dCdcbiAgICAgICAgICAgICAgICA6IChwcm9tcHQgIT09IHVuZGVmaW5lZCAmJiBwcm9tcHQub25wcm9wZXJ0eWNoYW5nZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgPyAncHJvcGVydHljaGFuZ2UnXG4gICAgICAgICAgICAgICAgICA6ICdrZXl1cCdcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dEV2ZW50O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRwcm9tcHQudmFsKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXN1bHRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICByZXN1bHRzID0gJG1vZHVsZS5kYXRhKG1ldGFkYXRhLnJlc3VsdHMpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlc3VsdDogZnVuY3Rpb24odmFsdWUsIHJlc3VsdHMpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBsb29rdXBGaWVsZHMgPSBbJ3RpdGxlJywgJ2lkJ10sXG4gICAgICAgICAgICAgIHJlc3VsdCAgICAgICA9IGZhbHNlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICB2YWx1ZSA9ICh2YWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICA/IHZhbHVlXG4gICAgICAgICAgICAgIDogbW9kdWxlLmdldC52YWx1ZSgpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICByZXN1bHRzID0gKHJlc3VsdHMgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyByZXN1bHRzXG4gICAgICAgICAgICAgIDogbW9kdWxlLmdldC5yZXN1bHRzKClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnR5cGUgPT09ICdjYXRlZ29yeScpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdGaW5kaW5nIHJlc3VsdCB0aGF0IG1hdGNoZXMnLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICQuZWFjaChyZXN1bHRzLCBmdW5jdGlvbihpbmRleCwgY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgICAgICBpZigkLmlzQXJyYXkoY2F0ZWdvcnkucmVzdWx0cykpIHtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IG1vZHVsZS5zZWFyY2gub2JqZWN0KHZhbHVlLCBjYXRlZ29yeS5yZXN1bHRzLCBsb29rdXBGaWVsZHMpWzBdO1xuICAgICAgICAgICAgICAgICAgLy8gZG9uJ3QgY29udGludWUgc2VhcmNoaW5nIGlmIGEgcmVzdWx0IGlzIGZvdW5kXG4gICAgICAgICAgICAgICAgICBpZihyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdGaW5kaW5nIHJlc3VsdCBpbiByZXN1bHRzIG9iamVjdCcsIHZhbHVlKTtcbiAgICAgICAgICAgICAgcmVzdWx0ID0gbW9kdWxlLnNlYXJjaC5vYmplY3QodmFsdWUsIHJlc3VsdHMsIGxvb2t1cEZpZWxkcylbMF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0IHx8IGZhbHNlO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG5cbiAgICAgICAgc2VsZWN0OiB7XG4gICAgICAgICAgZmlyc3RSZXN1bHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NlbGVjdGluZyBmaXJzdCByZXN1bHQnKTtcbiAgICAgICAgICAgICRyZXN1bHQuZmlyc3QoKS5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiB7XG4gICAgICAgICAgZm9jdXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5hZGRDbGFzcyhjbGFzc05hbWUuZm9jdXMpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbG9hZGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLmFkZENsYXNzKGNsYXNzTmFtZS5sb2FkaW5nKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NldHRpbmcgc2VhcmNoIGlucHV0IHZhbHVlJywgdmFsdWUpO1xuICAgICAgICAgICAgJHByb21wdFxuICAgICAgICAgICAgICAudmFsKHZhbHVlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdHlwZTogZnVuY3Rpb24odHlwZSkge1xuICAgICAgICAgICAgdHlwZSA9IHR5cGUgfHwgc2V0dGluZ3MudHlwZTtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnR5cGUgPT0gJ2NhdGVnb3J5Jykge1xuICAgICAgICAgICAgICAkbW9kdWxlLmFkZENsYXNzKHNldHRpbmdzLnR5cGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgYnV0dG9uUHJlc3NlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkc2VhcmNoQnV0dG9uLmFkZENsYXNzKGNsYXNzTmFtZS5wcmVzc2VkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVtb3ZlOiB7XG4gICAgICAgICAgbG9hZGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5sb2FkaW5nKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGZvY3VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmZvY3VzKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJ1dHRvblByZXNzZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHNlYXJjaEJ1dHRvbi5yZW1vdmVDbGFzcyhjbGFzc05hbWUucHJlc3NlZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHF1ZXJ5OiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgIGNhbGxiYWNrID0gJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKVxuICAgICAgICAgICAgPyBjYWxsYmFja1xuICAgICAgICAgICAgOiBmdW5jdGlvbigpe31cbiAgICAgICAgICA7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBzZWFyY2hUZXJtID0gbW9kdWxlLmdldC52YWx1ZSgpLFxuICAgICAgICAgICAgY2FjaGUgPSBtb2R1bGUucmVhZC5jYWNoZShzZWFyY2hUZXJtKVxuICAgICAgICAgIDtcbiAgICAgICAgICBjYWxsYmFjayA9IGNhbGxiYWNrIHx8IGZ1bmN0aW9uKCkge307XG4gICAgICAgICAgaWYoIG1vZHVsZS5oYXMubWluaW11bUNoYXJhY3RlcnMoKSApICB7XG4gICAgICAgICAgICBpZihjYWNoZSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JlYWRpbmcgcmVzdWx0IGZyb20gY2FjaGUnLCBzZWFyY2hUZXJtKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnNhdmUucmVzdWx0cyhjYWNoZS5yZXN1bHRzKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmFkZFJlc3VsdHMoY2FjaGUuaHRtbCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5pbmplY3QuaWQoY2FjaGUucmVzdWx0cyk7XG4gICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdRdWVyeWluZyBmb3InLCBzZWFyY2hUZXJtKTtcbiAgICAgICAgICAgICAgaWYoJC5pc1BsYWluT2JqZWN0KHNldHRpbmdzLnNvdXJjZSkgfHwgJC5pc0FycmF5KHNldHRpbmdzLnNvdXJjZSkpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuc2VhcmNoLmxvY2FsKHNlYXJjaFRlcm0pO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggbW9kdWxlLmNhbi51c2VBUEkoKSApIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuc2VhcmNoLnJlbW90ZShzZWFyY2hUZXJtLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLnNvdXJjZSk7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0dGluZ3Mub25TZWFyY2hRdWVyeS5jYWxsKGVsZW1lbnQsIHNlYXJjaFRlcm0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vZHVsZS5oaWRlUmVzdWx0cygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZWFyY2g6IHtcbiAgICAgICAgICBsb2NhbDogZnVuY3Rpb24oc2VhcmNoVGVybSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHJlc3VsdHMgPSBtb2R1bGUuc2VhcmNoLm9iamVjdChzZWFyY2hUZXJtLCBzZXR0aW5ncy5jb250ZW50KSxcbiAgICAgICAgICAgICAgc2VhcmNoSFRNTFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnNldC5sb2FkaW5nKCk7XG4gICAgICAgICAgICBtb2R1bGUuc2F2ZS5yZXN1bHRzKHJlc3VsdHMpO1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZXR1cm5lZCBmdWxsIGxvY2FsIHNlYXJjaCByZXN1bHRzJywgcmVzdWx0cyk7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5tYXhSZXN1bHRzID4gMCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1VzaW5nIHNwZWNpZmllZCBtYXggcmVzdWx0cycsIHJlc3VsdHMpO1xuICAgICAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5zbGljZSgwLCBzZXR0aW5ncy5tYXhSZXN1bHRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnR5cGUgPT0gJ2NhdGVnb3J5Jykge1xuICAgICAgICAgICAgICByZXN1bHRzID0gbW9kdWxlLmNyZWF0ZS5jYXRlZ29yeVJlc3VsdHMocmVzdWx0cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWFyY2hIVE1MID0gbW9kdWxlLmdlbmVyYXRlUmVzdWx0cyh7XG4gICAgICAgICAgICAgIHJlc3VsdHM6IHJlc3VsdHNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5sb2FkaW5nKCk7XG4gICAgICAgICAgICBtb2R1bGUuYWRkUmVzdWx0cyhzZWFyY2hIVE1MKTtcbiAgICAgICAgICAgIG1vZHVsZS5pbmplY3QuaWQocmVzdWx0cyk7XG4gICAgICAgICAgICBtb2R1bGUud3JpdGUuY2FjaGUoc2VhcmNoVGVybSwge1xuICAgICAgICAgICAgICBodG1sICAgIDogc2VhcmNoSFRNTCxcbiAgICAgICAgICAgICAgcmVzdWx0cyA6IHJlc3VsdHNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVtb3RlOiBmdW5jdGlvbihzZWFyY2hUZXJtLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2sgPSAkLmlzRnVuY3Rpb24oY2FsbGJhY2spXG4gICAgICAgICAgICAgID8gY2FsbGJhY2tcbiAgICAgICAgICAgICAgOiBmdW5jdGlvbigpe31cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCRtb2R1bGUuYXBpKCdpcyBsb2FkaW5nJykpIHtcbiAgICAgICAgICAgICAgJG1vZHVsZS5hcGkoJ2Fib3J0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuc2V0dXAuYXBpKHNlYXJjaFRlcm0sIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLmFwaSgncXVlcnknKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb2JqZWN0OiBmdW5jdGlvbihzZWFyY2hUZXJtLCBzb3VyY2UsIHNlYXJjaEZpZWxkcykge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHJlc3VsdHMgICAgICA9IFtdLFxuICAgICAgICAgICAgICBleGFjdFJlc3VsdHMgPSBbXSxcbiAgICAgICAgICAgICAgZnV6enlSZXN1bHRzID0gW10sXG4gICAgICAgICAgICAgIHNlYXJjaEV4cCAgICA9IHNlYXJjaFRlcm0udG9TdHJpbmcoKS5yZXBsYWNlKHJlZ0V4cC5lc2NhcGUsICdcXFxcJCYnKSxcbiAgICAgICAgICAgICAgbWF0Y2hSZWdFeHAgID0gbmV3IFJlZ0V4cChyZWdFeHAuYmVnaW5zV2l0aCArIHNlYXJjaEV4cCwgJ2knKSxcblxuICAgICAgICAgICAgICAvLyBhdm9pZCBkdXBsaWNhdGVzIHdoZW4gcHVzaGluZyByZXN1bHRzXG4gICAgICAgICAgICAgIGFkZFJlc3VsdCA9IGZ1bmN0aW9uKGFycmF5LCByZXN1bHQpIHtcbiAgICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAgIG5vdFJlc3VsdCAgICAgID0gKCQuaW5BcnJheShyZXN1bHQsIHJlc3VsdHMpID09IC0xKSxcbiAgICAgICAgICAgICAgICAgIG5vdEZ1enp5UmVzdWx0ID0gKCQuaW5BcnJheShyZXN1bHQsIGZ1enp5UmVzdWx0cykgPT0gLTEpLFxuICAgICAgICAgICAgICAgICAgbm90RXhhY3RSZXN1bHRzID0gKCQuaW5BcnJheShyZXN1bHQsIGV4YWN0UmVzdWx0cykgPT0gLTEpXG4gICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgIGlmKG5vdFJlc3VsdCAmJiBub3RGdXp6eVJlc3VsdCAmJiBub3RFeGFjdFJlc3VsdHMpIHtcbiAgICAgICAgICAgICAgICAgIGFycmF5LnB1c2gocmVzdWx0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHNvdXJjZSA9IHNvdXJjZSB8fCBzZXR0aW5ncy5zb3VyY2U7XG4gICAgICAgICAgICBzZWFyY2hGaWVsZHMgPSAoc2VhcmNoRmllbGRzICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gc2VhcmNoRmllbGRzXG4gICAgICAgICAgICAgIDogc2V0dGluZ3Muc2VhcmNoRmllbGRzXG4gICAgICAgICAgICA7XG5cbiAgICAgICAgICAgIC8vIHNlYXJjaCBmaWVsZHMgc2hvdWxkIGJlIGFycmF5IHRvIGxvb3AgY29ycmVjdGx5XG4gICAgICAgICAgICBpZighJC5pc0FycmF5KHNlYXJjaEZpZWxkcykpIHtcbiAgICAgICAgICAgICAgc2VhcmNoRmllbGRzID0gW3NlYXJjaEZpZWxkc107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGV4aXQgY29uZGl0aW9ucyBpZiBubyBzb3VyY2VcbiAgICAgICAgICAgIGlmKHNvdXJjZSA9PT0gdW5kZWZpbmVkIHx8IHNvdXJjZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLnNvdXJjZSk7XG4gICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGl0ZXJhdGUgdGhyb3VnaCBzZWFyY2ggZmllbGRzIGxvb2tpbmcgZm9yIG1hdGNoZXNcbiAgICAgICAgICAgICQuZWFjaChzZWFyY2hGaWVsZHMsIGZ1bmN0aW9uKGluZGV4LCBmaWVsZCkge1xuICAgICAgICAgICAgICAkLmVhY2goc291cmNlLCBmdW5jdGlvbihsYWJlbCwgY29udGVudCkge1xuICAgICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICAgZmllbGRFeGlzdHMgPSAodHlwZW9mIGNvbnRlbnRbZmllbGRdID09ICdzdHJpbmcnKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICBpZihmaWVsZEV4aXN0cykge1xuICAgICAgICAgICAgICAgICAgaWYoIGNvbnRlbnRbZmllbGRdLnNlYXJjaChtYXRjaFJlZ0V4cCkgIT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnRlbnQgc3RhcnRzIHdpdGggdmFsdWUgKGZpcnN0IGluIHJlc3VsdHMpXG4gICAgICAgICAgICAgICAgICAgIGFkZFJlc3VsdChyZXN1bHRzLCBjb250ZW50KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGVsc2UgaWYoc2V0dGluZ3MuZnVsbFRleHRTZWFyY2ggPT09ICdleGFjdCcgJiYgbW9kdWxlLmV4YWN0U2VhcmNoKHNlYXJjaFRlcm0sIGNvbnRlbnRbZmllbGRdKSApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29udGVudCBmdXp6eSBtYXRjaGVzIChsYXN0IGluIHJlc3VsdHMpXG4gICAgICAgICAgICAgICAgICAgIGFkZFJlc3VsdChleGFjdFJlc3VsdHMsIGNvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSBpZihzZXR0aW5ncy5mdWxsVGV4dFNlYXJjaCA9PSB0cnVlICYmIG1vZHVsZS5mdXp6eVNlYXJjaChzZWFyY2hUZXJtLCBjb250ZW50W2ZpZWxkXSkgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnRlbnQgZnV6enkgbWF0Y2hlcyAobGFzdCBpbiByZXN1bHRzKVxuICAgICAgICAgICAgICAgICAgICBhZGRSZXN1bHQoZnV6enlSZXN1bHRzLCBjb250ZW50KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAkLm1lcmdlKGV4YWN0UmVzdWx0cywgZnV6enlSZXN1bHRzKVxuICAgICAgICAgICAgJC5tZXJnZShyZXN1bHRzLCBleGFjdFJlc3VsdHMpO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBleGFjdFNlYXJjaDogZnVuY3Rpb24gKHF1ZXJ5LCB0ZXJtKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIHRlcm0gID0gdGVybS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIGlmKHRlcm0uaW5kZXhPZihxdWVyeSkgPiAtMSkge1xuICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1enp5U2VhcmNoOiBmdW5jdGlvbihxdWVyeSwgdGVybSkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgdGVybUxlbmd0aCAgPSB0ZXJtLmxlbmd0aCxcbiAgICAgICAgICAgIHF1ZXJ5TGVuZ3RoID0gcXVlcnkubGVuZ3RoXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKHR5cGVvZiBxdWVyeSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIHRlcm0gID0gdGVybS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIGlmKHF1ZXJ5TGVuZ3RoID4gdGVybUxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihxdWVyeUxlbmd0aCA9PT0gdGVybUxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIChxdWVyeSA9PT0gdGVybSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNlYXJjaDogZm9yICh2YXIgY2hhcmFjdGVySW5kZXggPSAwLCBuZXh0Q2hhcmFjdGVySW5kZXggPSAwOyBjaGFyYWN0ZXJJbmRleCA8IHF1ZXJ5TGVuZ3RoOyBjaGFyYWN0ZXJJbmRleCsrKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgcXVlcnlDaGFyYWN0ZXIgPSBxdWVyeS5jaGFyQ29kZUF0KGNoYXJhY3RlckluZGV4KVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgd2hpbGUobmV4dENoYXJhY3RlckluZGV4IDwgdGVybUxlbmd0aCkge1xuICAgICAgICAgICAgICBpZih0ZXJtLmNoYXJDb2RlQXQobmV4dENoYXJhY3RlckluZGV4KyspID09PSBxdWVyeUNoYXJhY3Rlcikge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlIHNlYXJjaDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSxcblxuICAgICAgICBwYXJzZToge1xuICAgICAgICAgIHJlc3BvbnNlOiBmdW5jdGlvbihyZXNwb25zZSwgc2VhcmNoVGVybSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHNlYXJjaEhUTUwgPSBtb2R1bGUuZ2VuZXJhdGVSZXN1bHRzKHJlc3BvbnNlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1BhcnNpbmcgc2VydmVyIHJlc3BvbnNlJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgaWYocmVzcG9uc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBpZihzZWFyY2hUZXJtICE9PSB1bmRlZmluZWQgJiYgcmVzcG9uc2VbZmllbGRzLnJlc3VsdHNdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuYWRkUmVzdWx0cyhzZWFyY2hIVE1MKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuaW5qZWN0LmlkKHJlc3BvbnNlW2ZpZWxkcy5yZXN1bHRzXSk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLndyaXRlLmNhY2hlKHNlYXJjaFRlcm0sIHtcbiAgICAgICAgICAgICAgICAgIGh0bWwgICAgOiBzZWFyY2hIVE1MLFxuICAgICAgICAgICAgICAgICAgcmVzdWx0cyA6IHJlc3BvbnNlW2ZpZWxkcy5yZXN1bHRzXVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5zYXZlLnJlc3VsdHMocmVzcG9uc2VbZmllbGRzLnJlc3VsdHNdKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjYW5jZWw6IHtcbiAgICAgICAgICBxdWVyeTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiggbW9kdWxlLmNhbi51c2VBUEkoKSApIHtcbiAgICAgICAgICAgICAgJG1vZHVsZS5hcGkoJ2Fib3J0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGhhczoge1xuICAgICAgICAgIG1pbmltdW1DaGFyYWN0ZXJzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBzZWFyY2hUZXJtICAgID0gbW9kdWxlLmdldC52YWx1ZSgpLFxuICAgICAgICAgICAgICBudW1DaGFyYWN0ZXJzID0gc2VhcmNoVGVybS5sZW5ndGhcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiAobnVtQ2hhcmFjdGVycyA+PSBzZXR0aW5ncy5taW5DaGFyYWN0ZXJzKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlc3VsdHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoJHJlc3VsdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBodG1sID0gJHJlc3VsdHMuaHRtbCgpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICByZXR1cm4gaHRtbCAhPSAnJztcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xlYXI6IHtcbiAgICAgICAgICBjYWNoZTogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjYWNoZSA9ICRtb2R1bGUuZGF0YShtZXRhZGF0YS5jYWNoZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCF2YWx1ZSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NsZWFyaW5nIGNhY2hlJywgdmFsdWUpO1xuICAgICAgICAgICAgICAkbW9kdWxlLnJlbW92ZURhdGEobWV0YWRhdGEuY2FjaGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZih2YWx1ZSAmJiBjYWNoZSAmJiBjYWNoZVt2YWx1ZV0pIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZW1vdmluZyB2YWx1ZSBmcm9tIGNhY2hlJywgdmFsdWUpO1xuICAgICAgICAgICAgICBkZWxldGUgY2FjaGVbdmFsdWVdO1xuICAgICAgICAgICAgICAkbW9kdWxlLmRhdGEobWV0YWRhdGEuY2FjaGUsIGNhY2hlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVhZDoge1xuICAgICAgICAgIGNhY2hlOiBmdW5jdGlvbihuYW1lKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgY2FjaGUgPSAkbW9kdWxlLmRhdGEobWV0YWRhdGEuY2FjaGUpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5jYWNoZSkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQ2hlY2tpbmcgY2FjaGUgZm9yIGdlbmVyYXRlZCBodG1sIGZvciBxdWVyeScsIG5hbWUpO1xuICAgICAgICAgICAgICByZXR1cm4gKHR5cGVvZiBjYWNoZSA9PSAnb2JqZWN0JykgJiYgKGNhY2hlW25hbWVdICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgPyBjYWNoZVtuYW1lXVxuICAgICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICBjYXRlZ29yeVJlc3VsdHM6IGZ1bmN0aW9uKHJlc3VsdHMpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjYXRlZ29yeVJlc3VsdHMgPSB7fVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJC5lYWNoKHJlc3VsdHMsIGZ1bmN0aW9uKGluZGV4LCByZXN1bHQpIHtcbiAgICAgICAgICAgICAgaWYoIXJlc3VsdC5jYXRlZ29yeSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZihjYXRlZ29yeVJlc3VsdHNbcmVzdWx0LmNhdGVnb3J5XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0NyZWF0aW5nIG5ldyBjYXRlZ29yeSBvZiByZXN1bHRzJywgcmVzdWx0LmNhdGVnb3J5KTtcbiAgICAgICAgICAgICAgICBjYXRlZ29yeVJlc3VsdHNbcmVzdWx0LmNhdGVnb3J5XSA9IHtcbiAgICAgICAgICAgICAgICAgIG5hbWUgICAgOiByZXN1bHQuY2F0ZWdvcnksXG4gICAgICAgICAgICAgICAgICByZXN1bHRzIDogW3Jlc3VsdF1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY2F0ZWdvcnlSZXN1bHRzW3Jlc3VsdC5jYXRlZ29yeV0ucmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuIGNhdGVnb3J5UmVzdWx0cztcbiAgICAgICAgICB9LFxuICAgICAgICAgIGlkOiBmdW5jdGlvbihyZXN1bHRJbmRleCwgY2F0ZWdvcnlJbmRleCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHJlc3VsdElEICAgICAgPSAocmVzdWx0SW5kZXggKyAxKSwgLy8gbm90IHplcm8gaW5kZXhlZFxuICAgICAgICAgICAgICBjYXRlZ29yeUlEICAgID0gKGNhdGVnb3J5SW5kZXggKyAxKSxcbiAgICAgICAgICAgICAgZmlyc3RDaGFyQ29kZSxcbiAgICAgICAgICAgICAgbGV0dGVySUQsXG4gICAgICAgICAgICAgIGlkXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihjYXRlZ29yeUluZGV4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgLy8gc3RhcnQgY2hhciBjb2RlIGZvciBcIkFcIlxuICAgICAgICAgICAgICBsZXR0ZXJJRCA9IFN0cmluZy5mcm9tQ2hhckNvZGUoOTcgKyBjYXRlZ29yeUluZGV4KTtcbiAgICAgICAgICAgICAgaWQgICAgICAgICAgPSBsZXR0ZXJJRCArIHJlc3VsdElEO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQ3JlYXRpbmcgY2F0ZWdvcnkgcmVzdWx0IGlkJywgaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIGlkID0gcmVzdWx0SUQ7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdDcmVhdGluZyByZXN1bHQgaWQnLCBpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaWQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXN1bHRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCRyZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAkcmVzdWx0cyA9ICQoJzxkaXYgLz4nKVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUucmVzdWx0cylcbiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oJG1vZHVsZSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpbmplY3Q6IHtcbiAgICAgICAgICByZXN1bHQ6IGZ1bmN0aW9uKHJlc3VsdCwgcmVzdWx0SW5kZXgsIGNhdGVnb3J5SW5kZXgpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdJbmplY3RpbmcgcmVzdWx0IGludG8gcmVzdWx0cycpO1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICRzZWxlY3RlZFJlc3VsdCA9IChjYXRlZ29yeUluZGV4ICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgPyAkcmVzdWx0c1xuICAgICAgICAgICAgICAgICAgICAuY2hpbGRyZW4oKS5lcShjYXRlZ29yeUluZGV4KVxuICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZHJlbihzZWxlY3Rvci5yZXN1bHRzKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpcnN0KClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZHJlbihzZWxlY3Rvci5yZXN1bHQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgIC5lcShyZXN1bHRJbmRleClcbiAgICAgICAgICAgICAgICA6ICRyZXN1bHRzXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZHJlbihzZWxlY3Rvci5yZXN1bHQpLmVxKHJlc3VsdEluZGV4KVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0luamVjdGluZyByZXN1bHRzIG1ldGFkYXRhJywgJHNlbGVjdGVkUmVzdWx0KTtcbiAgICAgICAgICAgICRzZWxlY3RlZFJlc3VsdFxuICAgICAgICAgICAgICAuZGF0YShtZXRhZGF0YS5yZXN1bHQsIHJlc3VsdClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGlkOiBmdW5jdGlvbihyZXN1bHRzKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0luamVjdGluZyB1bmlxdWUgaWRzIGludG8gcmVzdWx0cycpO1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIC8vIHNpbmNlIHJlc3VsdHMgbWF5IGJlIG9iamVjdCwgd2UgbXVzdCB1c2UgY291bnRlcnNcbiAgICAgICAgICAgICAgY2F0ZWdvcnlJbmRleCA9IDAsXG4gICAgICAgICAgICAgIHJlc3VsdEluZGV4ICAgPSAwXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy50eXBlID09PSAnY2F0ZWdvcnknKSB7XG4gICAgICAgICAgICAgIC8vIGl0ZXJhdGUgdGhyb3VnaCBlYWNoIGNhdGVnb3J5IHJlc3VsdFxuICAgICAgICAgICAgICAkLmVhY2gocmVzdWx0cywgZnVuY3Rpb24oaW5kZXgsIGNhdGVnb3J5KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0SW5kZXggPSAwO1xuICAgICAgICAgICAgICAgICQuZWFjaChjYXRlZ29yeS5yZXN1bHRzLCBmdW5jdGlvbihpbmRleCwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBjYXRlZ29yeS5yZXN1bHRzW2luZGV4XVxuICAgICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgICAgaWYocmVzdWx0LmlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmlkID0gbW9kdWxlLmNyZWF0ZS5pZChyZXN1bHRJbmRleCwgY2F0ZWdvcnlJbmRleCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuaW5qZWN0LnJlc3VsdChyZXN1bHQsIHJlc3VsdEluZGV4LCBjYXRlZ29yeUluZGV4KTtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdEluZGV4Kys7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY2F0ZWdvcnlJbmRleCsrO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAvLyB0b3AgbGV2ZWxcbiAgICAgICAgICAgICAgJC5lYWNoKHJlc3VsdHMsIGZ1bmN0aW9uKGluZGV4LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0c1tpbmRleF1cbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgaWYocmVzdWx0LmlkID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdC5pZCA9IG1vZHVsZS5jcmVhdGUuaWQocmVzdWx0SW5kZXgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBtb2R1bGUuaW5qZWN0LnJlc3VsdChyZXN1bHQsIHJlc3VsdEluZGV4KTtcbiAgICAgICAgICAgICAgICByZXN1bHRJbmRleCsrO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzYXZlOiB7XG4gICAgICAgICAgcmVzdWx0czogZnVuY3Rpb24ocmVzdWx0cykge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NhdmluZyBjdXJyZW50IHNlYXJjaCByZXN1bHRzIHRvIG1ldGFkYXRhJywgcmVzdWx0cyk7XG4gICAgICAgICAgICAkbW9kdWxlLmRhdGEobWV0YWRhdGEucmVzdWx0cywgcmVzdWx0cyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHdyaXRlOiB7XG4gICAgICAgICAgY2FjaGU6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgY2FjaGUgPSAoJG1vZHVsZS5kYXRhKG1ldGFkYXRhLmNhY2hlKSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgID8gJG1vZHVsZS5kYXRhKG1ldGFkYXRhLmNhY2hlKVxuICAgICAgICAgICAgICAgIDoge31cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmNhY2hlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdXcml0aW5nIGdlbmVyYXRlZCBodG1sIHRvIGNhY2hlJywgbmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgICBjYWNoZVtuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgICAgLmRhdGEobWV0YWRhdGEuY2FjaGUsIGNhY2hlKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGFkZFJlc3VsdHM6IGZ1bmN0aW9uKGh0bWwpIHtcbiAgICAgICAgICBpZiggJC5pc0Z1bmN0aW9uKHNldHRpbmdzLm9uUmVzdWx0c0FkZCkgKSB7XG4gICAgICAgICAgICBpZiggc2V0dGluZ3Mub25SZXN1bHRzQWRkLmNhbGwoJHJlc3VsdHMsIGh0bWwpID09PSBmYWxzZSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdvblJlc3VsdHNBZGQgY2FsbGJhY2sgY2FuY2VsbGVkIGRlZmF1bHQgYWN0aW9uJyk7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoaHRtbCkge1xuICAgICAgICAgICAgJHJlc3VsdHNcbiAgICAgICAgICAgICAgLmh0bWwoaHRtbClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS5yZWZyZXNoUmVzdWx0cygpO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3Muc2VsZWN0Rmlyc3RSZXN1bHQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnNlbGVjdC5maXJzdFJlc3VsdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLnNob3dSZXN1bHRzKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbW9kdWxlLmhpZGVSZXN1bHRzKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAkcmVzdWx0cy5lbXB0eSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNob3dSZXN1bHRzOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgIGNhbGxiYWNrID0gJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKVxuICAgICAgICAgICAgPyBjYWxsYmFja1xuICAgICAgICAgICAgOiBmdW5jdGlvbigpe31cbiAgICAgICAgICA7XG4gICAgICAgICAgaWYocmVzdWx0c0Rpc21pc3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZighbW9kdWxlLmlzLnZpc2libGUoKSAmJiBtb2R1bGUuaGFzLnJlc3VsdHMoKSkge1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5jYW4udHJhbnNpdGlvbigpICkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Nob3dpbmcgcmVzdWx0cyB3aXRoIGNzcyBhbmltYXRpb25zJyk7XG4gICAgICAgICAgICAgICRyZXN1bHRzXG4gICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oe1xuICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uICA6IHNldHRpbmdzLnRyYW5zaXRpb24gKyAnIGluJyxcbiAgICAgICAgICAgICAgICAgIGRlYnVnICAgICAgOiBzZXR0aW5ncy5kZWJ1ZyxcbiAgICAgICAgICAgICAgICAgIHZlcmJvc2UgICAgOiBzZXR0aW5ncy52ZXJib3NlLFxuICAgICAgICAgICAgICAgICAgZHVyYXRpb24gICA6IHNldHRpbmdzLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZSA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHF1ZXVlICAgICAgOiB0cnVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2hvd2luZyByZXN1bHRzIHdpdGggamF2YXNjcmlwdCcpO1xuICAgICAgICAgICAgICAkcmVzdWx0c1xuICAgICAgICAgICAgICAgIC5zdG9wKClcbiAgICAgICAgICAgICAgICAuZmFkZUluKHNldHRpbmdzLmR1cmF0aW9uLCBzZXR0aW5ncy5lYXNpbmcpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldHRpbmdzLm9uUmVzdWx0c09wZW4uY2FsbCgkcmVzdWx0cyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBoaWRlUmVzdWx0czogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICBjYWxsYmFjayA9ICQuaXNGdW5jdGlvbihjYWxsYmFjaylcbiAgICAgICAgICAgID8gY2FsbGJhY2tcbiAgICAgICAgICAgIDogZnVuY3Rpb24oKXt9XG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKCBtb2R1bGUuaXMudmlzaWJsZSgpICkge1xuICAgICAgICAgICAgaWYoIG1vZHVsZS5jYW4udHJhbnNpdGlvbigpICkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0hpZGluZyByZXN1bHRzIHdpdGggY3NzIGFuaW1hdGlvbnMnKTtcbiAgICAgICAgICAgICAgJHJlc3VsdHNcbiAgICAgICAgICAgICAgICAudHJhbnNpdGlvbih7XG4gICAgICAgICAgICAgICAgICBhbmltYXRpb24gIDogc2V0dGluZ3MudHJhbnNpdGlvbiArICcgb3V0JyxcbiAgICAgICAgICAgICAgICAgIGRlYnVnICAgICAgOiBzZXR0aW5ncy5kZWJ1ZyxcbiAgICAgICAgICAgICAgICAgIHZlcmJvc2UgICAgOiBzZXR0aW5ncy52ZXJib3NlLFxuICAgICAgICAgICAgICAgICAgZHVyYXRpb24gICA6IHNldHRpbmdzLmR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgb25Db21wbGV0ZSA6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHF1ZXVlICAgICAgOiB0cnVlXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSGlkaW5nIHJlc3VsdHMgd2l0aCBqYXZhc2NyaXB0Jyk7XG4gICAgICAgICAgICAgICRyZXN1bHRzXG4gICAgICAgICAgICAgICAgLnN0b3AoKVxuICAgICAgICAgICAgICAgIC5mYWRlT3V0KHNldHRpbmdzLmR1cmF0aW9uLCBzZXR0aW5ncy5lYXNpbmcpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldHRpbmdzLm9uUmVzdWx0c0Nsb3NlLmNhbGwoJHJlc3VsdHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBnZW5lcmF0ZVJlc3VsdHM6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdHZW5lcmF0aW5nIGh0bWwgZnJvbSByZXNwb25zZScsIHJlc3BvbnNlKTtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIHRlbXBsYXRlICAgICAgID0gc2V0dGluZ3MudGVtcGxhdGVzW3NldHRpbmdzLnR5cGVdLFxuICAgICAgICAgICAgaXNQcm9wZXJPYmplY3QgPSAoJC5pc1BsYWluT2JqZWN0KHJlc3BvbnNlW2ZpZWxkcy5yZXN1bHRzXSkgJiYgISQuaXNFbXB0eU9iamVjdChyZXNwb25zZVtmaWVsZHMucmVzdWx0c10pKSxcbiAgICAgICAgICAgIGlzUHJvcGVyQXJyYXkgID0gKCQuaXNBcnJheShyZXNwb25zZVtmaWVsZHMucmVzdWx0c10pICYmIHJlc3BvbnNlW2ZpZWxkcy5yZXN1bHRzXS5sZW5ndGggPiAwKSxcbiAgICAgICAgICAgIGh0bWwgICAgICAgICAgID0gJydcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYoaXNQcm9wZXJPYmplY3QgfHwgaXNQcm9wZXJBcnJheSApIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLm1heFJlc3VsdHMgPiAwKSB7XG4gICAgICAgICAgICAgIGlmKGlzUHJvcGVyT2JqZWN0KSB7XG4gICAgICAgICAgICAgICAgaWYoc2V0dGluZ3MudHlwZSA9PSAnc3RhbmRhcmQnKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IubWF4UmVzdWx0cyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlW2ZpZWxkcy5yZXN1bHRzXSA9IHJlc3BvbnNlW2ZpZWxkcy5yZXN1bHRzXS5zbGljZSgwLCBzZXR0aW5ncy5tYXhSZXN1bHRzKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoJC5pc0Z1bmN0aW9uKHRlbXBsYXRlKSkge1xuICAgICAgICAgICAgICBodG1sID0gdGVtcGxhdGUocmVzcG9uc2UsIGZpZWxkcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm5vVGVtcGxhdGUsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihzZXR0aW5ncy5zaG93Tm9SZXN1bHRzKSB7XG4gICAgICAgICAgICBodG1sID0gbW9kdWxlLmRpc3BsYXlNZXNzYWdlKGVycm9yLm5vUmVzdWx0cywgJ2VtcHR5Jyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNldHRpbmdzLm9uUmVzdWx0cy5jYWxsKGVsZW1lbnQsIHJlc3BvbnNlKTtcbiAgICAgICAgICByZXR1cm4gaHRtbDtcbiAgICAgICAgfSxcblxuICAgICAgICBkaXNwbGF5TWVzc2FnZTogZnVuY3Rpb24odGV4dCwgdHlwZSkge1xuICAgICAgICAgIHR5cGUgPSB0eXBlIHx8ICdzdGFuZGFyZCc7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdEaXNwbGF5aW5nIG1lc3NhZ2UnLCB0ZXh0LCB0eXBlKTtcbiAgICAgICAgICBtb2R1bGUuYWRkUmVzdWx0cyggc2V0dGluZ3MudGVtcGxhdGVzLm1lc3NhZ2UodGV4dCwgdHlwZSkgKTtcbiAgICAgICAgICByZXR1cm4gc2V0dGluZ3MudGVtcGxhdGVzLm1lc3NhZ2UodGV4dCwgdHlwZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dGluZzogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgc2V0dGluZ3MsIG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHNldHRpbmdzW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW50ZXJuYWw6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIG1vZHVsZSwgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbW9kdWxlW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVtuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlYnVnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHZlcmJvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MudmVyYm9zZSAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZS5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQpIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvciA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5lcnJvciwgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUsXG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICBwcmV2aW91c1RpbWUgID0gdGltZSB8fCBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSA9IGN1cnJlbnRUaW1lIC0gcHJldmlvdXNUaW1lO1xuICAgICAgICAgICAgICB0aW1lICAgICAgICAgID0gY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIHBlcmZvcm1hbmNlLnB1c2goe1xuICAgICAgICAgICAgICAgICdOYW1lJyAgICAgICAgICAgOiBtZXNzYWdlWzBdLFxuICAgICAgICAgICAgICAgICdBcmd1bWVudHMnICAgICAgOiBbXS5zbGljZS5jYWxsKG1lc3NhZ2UsIDEpIHx8ICcnLFxuICAgICAgICAgICAgICAgICdFbGVtZW50JyAgICAgICAgOiBlbGVtZW50LFxuICAgICAgICAgICAgICAgICdFeGVjdXRpb24gVGltZScgOiBleGVjdXRpb25UaW1lXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UudGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS5kaXNwbGF5LCA1MDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlzcGxheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdGl0bGUgPSBzZXR0aW5ncy5uYW1lICsgJzonLFxuICAgICAgICAgICAgICB0b3RhbFRpbWUgPSAwXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICB0aW1lID0gZmFsc2U7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgICQuZWFjaChwZXJmb3JtYW5jZSwgZnVuY3Rpb24oaW5kZXgsIGRhdGEpIHtcbiAgICAgICAgICAgICAgdG90YWxUaW1lICs9IGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRpdGxlICs9ICcgJyArIHRvdGFsVGltZSArICdtcyc7XG4gICAgICAgICAgICBpZihtb2R1bGVTZWxlY3Rvcikge1xuICAgICAgICAgICAgICB0aXRsZSArPSAnIFxcJycgKyBtb2R1bGVTZWxlY3RvciArICdcXCcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoJGFsbE1vZHVsZXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICB0aXRsZSArPSAnICcgKyAnKCcgKyAkYWxsTW9kdWxlcy5sZW5ndGggKyAnKSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggKGNvbnNvbGUuZ3JvdXAgIT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLnRhYmxlICE9PSB1bmRlZmluZWQpICYmIHBlcmZvcm1hbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgICAgIGlmKGNvbnNvbGUudGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKHBlcmZvcm1hbmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZXJmb3JtYW5jZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoICQuaXNGdW5jdGlvbiggZm91bmQgKSApIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQuYXBwbHkoY29udGV4dCwgcGFzc2VkQXJndW1lbnRzKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihmb3VuZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGZvdW5kO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZigkLmlzQXJyYXkocmV0dXJuZWRWYWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUucHVzaChyZXNwb25zZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYocmV0dXJuZWRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlID0gW3JldHVybmVkVmFsdWUsIHJlc3BvbnNlXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlID0gcmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmb3VuZDtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGlmKG1ldGhvZEludm9rZWQpIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICAgIH1cbiAgICAgICAgbW9kdWxlLmludm9rZShxdWVyeSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGluc3RhbmNlLmludm9rZSgnZGVzdHJveScpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICB9XG5cbiAgICB9KVxuICA7XG5cbiAgcmV0dXJuIChyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpXG4gICAgPyByZXR1cm5lZFZhbHVlXG4gICAgOiB0aGlzXG4gIDtcbn07XG5cbiQuZm4uc2VhcmNoLnNldHRpbmdzID0ge1xuXG4gIG5hbWUgICAgICAgICAgICAgIDogJ1NlYXJjaCcsXG4gIG5hbWVzcGFjZSAgICAgICAgIDogJ3NlYXJjaCcsXG5cbiAgc2lsZW50ICAgICAgICAgICAgOiBmYWxzZSxcbiAgZGVidWcgICAgICAgICAgICAgOiBmYWxzZSxcbiAgdmVyYm9zZSAgICAgICAgICAgOiBmYWxzZSxcbiAgcGVyZm9ybWFuY2UgICAgICAgOiB0cnVlLFxuXG4gIC8vIHRlbXBsYXRlIHRvIHVzZSAoc3BlY2lmaWVkIGluIHNldHRpbmdzLnRlbXBsYXRlcylcbiAgdHlwZSAgICAgICAgICAgICAgOiAnc3RhbmRhcmQnLFxuXG4gIC8vIG1pbmltdW0gY2hhcmFjdGVycyByZXF1aXJlZCB0byBzZWFyY2hcbiAgbWluQ2hhcmFjdGVycyAgICAgOiAxLFxuXG4gIC8vIHdoZXRoZXIgdG8gc2VsZWN0IGZpcnN0IHJlc3VsdCBhZnRlciBzZWFyY2hpbmcgYXV0b21hdGljYWxseVxuICBzZWxlY3RGaXJzdFJlc3VsdCA6IGZhbHNlLFxuXG4gIC8vIEFQSSBjb25maWdcbiAgYXBpU2V0dGluZ3MgICAgICAgOiBmYWxzZSxcblxuICAvLyBvYmplY3QgdG8gc2VhcmNoXG4gIHNvdXJjZSAgICAgICAgICAgIDogZmFsc2UsXG5cbiAgLy8gV2hldGhlciBzZWFyY2ggc2hvdWxkIHF1ZXJ5IGN1cnJlbnQgdGVybSBvbiBmb2N1c1xuICBzZWFyY2hPbkZvY3VzICAgICA6IHRydWUsXG5cbiAgLy8gZmllbGRzIHRvIHNlYXJjaFxuICBzZWFyY2hGaWVsZHMgICA6IFtcbiAgICAndGl0bGUnLFxuICAgICdkZXNjcmlwdGlvbidcbiAgXSxcblxuICAvLyBmaWVsZCB0byBkaXNwbGF5IGluIHN0YW5kYXJkIHJlc3VsdHMgdGVtcGxhdGVcbiAgZGlzcGxheUZpZWxkICAgOiAnJyxcblxuICAvLyBzZWFyY2ggYW55d2hlcmUgaW4gdmFsdWUgKHNldCB0byAnZXhhY3QnIHRvIHJlcXVpcmUgZXhhY3QgbWF0Y2hlc1xuICBmdWxsVGV4dFNlYXJjaCA6ICdleGFjdCcsXG5cbiAgLy8gd2hldGhlciB0byBhZGQgZXZlbnRzIHRvIHByb21wdCBhdXRvbWF0aWNhbGx5XG4gIGF1dG9tYXRpYyAgICAgIDogdHJ1ZSxcblxuICAvLyBkZWxheSBiZWZvcmUgaGlkaW5nIG1lbnUgYWZ0ZXIgYmx1clxuICBoaWRlRGVsYXkgICAgICA6IDAsXG5cbiAgLy8gZGVsYXkgYmVmb3JlIHNlYXJjaGluZ1xuICBzZWFyY2hEZWxheSAgICA6IDIwMCxcblxuICAvLyBtYXhpbXVtIHJlc3VsdHMgcmV0dXJuZWQgZnJvbSBzZWFyY2hcbiAgbWF4UmVzdWx0cyAgICAgOiA3LFxuXG4gIC8vIHdoZXRoZXIgdG8gc3RvcmUgbG9va3VwcyBpbiBsb2NhbCBjYWNoZVxuICBjYWNoZSAgICAgICAgICA6IHRydWUsXG5cbiAgLy8gd2hldGhlciBubyByZXN1bHRzIGVycm9ycyBzaG91bGQgYmUgc2hvd25cbiAgc2hvd05vUmVzdWx0cyAgOiB0cnVlLFxuXG4gIC8vIHRyYW5zaXRpb24gc2V0dGluZ3NcbiAgdHJhbnNpdGlvbiAgICAgOiAnc2NhbGUnLFxuICBkdXJhdGlvbiAgICAgICA6IDIwMCxcbiAgZWFzaW5nICAgICAgICAgOiAnZWFzZU91dEV4cG8nLFxuXG4gIC8vIGNhbGxiYWNrc1xuICBvblNlbGVjdCAgICAgICA6IGZhbHNlLFxuICBvblJlc3VsdHNBZGQgICA6IGZhbHNlLFxuXG4gIG9uU2VhcmNoUXVlcnkgIDogZnVuY3Rpb24ocXVlcnkpe30sXG4gIG9uUmVzdWx0cyAgICAgIDogZnVuY3Rpb24ocmVzcG9uc2Upe30sXG5cbiAgb25SZXN1bHRzT3BlbiAgOiBmdW5jdGlvbigpe30sXG4gIG9uUmVzdWx0c0Nsb3NlIDogZnVuY3Rpb24oKXt9LFxuXG4gIGNsYXNzTmFtZToge1xuICAgIGFuaW1hdGluZyA6ICdhbmltYXRpbmcnLFxuICAgIGFjdGl2ZSAgICA6ICdhY3RpdmUnLFxuICAgIGVtcHR5ICAgICA6ICdlbXB0eScsXG4gICAgZm9jdXMgICAgIDogJ2ZvY3VzJyxcbiAgICBoaWRkZW4gICAgOiAnaGlkZGVuJyxcbiAgICBsb2FkaW5nICAgOiAnbG9hZGluZycsXG4gICAgcmVzdWx0cyAgIDogJ3Jlc3VsdHMnLFxuICAgIHByZXNzZWQgICA6ICdkb3duJ1xuICB9LFxuXG4gIGVycm9yIDoge1xuICAgIHNvdXJjZSAgICAgICAgICA6ICdDYW5ub3Qgc2VhcmNoLiBObyBzb3VyY2UgdXNlZCwgYW5kIFNlbWFudGljIEFQSSBtb2R1bGUgd2FzIG5vdCBpbmNsdWRlZCcsXG4gICAgbm9SZXN1bHRzICAgICAgIDogJ1lvdXIgc2VhcmNoIHJldHVybmVkIG5vIHJlc3VsdHMnLFxuICAgIGxvZ2dpbmcgICAgICAgICA6ICdFcnJvciBpbiBkZWJ1ZyBsb2dnaW5nLCBleGl0aW5nLicsXG4gICAgbm9FbmRwb2ludCAgICAgIDogJ05vIHNlYXJjaCBlbmRwb2ludCB3YXMgc3BlY2lmaWVkJyxcbiAgICBub1RlbXBsYXRlICAgICAgOiAnQSB2YWxpZCB0ZW1wbGF0ZSBuYW1lIHdhcyBub3Qgc3BlY2lmaWVkLicsXG4gICAgb2xkU2VhcmNoU3ludGF4IDogJ3NlYXJjaEZ1bGxUZXh0IHNldHRpbmcgaGFzIGJlZW4gcmVuYW1lZCBmdWxsVGV4dFNlYXJjaCBmb3IgY29uc2lzdGVuY3ksIHBsZWFzZSBhZGp1c3QgeW91ciBzZXR0aW5ncy4nLFxuICAgIHNlcnZlckVycm9yICAgICA6ICdUaGVyZSB3YXMgYW4gaXNzdWUgcXVlcnlpbmcgdGhlIHNlcnZlci4nLFxuICAgIG1heFJlc3VsdHMgICAgICA6ICdSZXN1bHRzIG11c3QgYmUgYW4gYXJyYXkgdG8gdXNlIG1heFJlc3VsdHMgc2V0dGluZycsXG4gICAgbWV0aG9kICAgICAgICAgIDogJ1RoZSBtZXRob2QgeW91IGNhbGxlZCBpcyBub3QgZGVmaW5lZC4nXG4gIH0sXG5cbiAgbWV0YWRhdGE6IHtcbiAgICBjYWNoZSAgIDogJ2NhY2hlJyxcbiAgICByZXN1bHRzIDogJ3Jlc3VsdHMnLFxuICAgIHJlc3VsdCAgOiAncmVzdWx0J1xuICB9LFxuXG4gIHJlZ0V4cDoge1xuICAgIGVzY2FwZSAgICAgOiAvW1xcLVxcW1xcXVxcL1xce1xcfVxcKFxcKVxcKlxcK1xcP1xcLlxcXFxcXF5cXCRcXHxdL2csXG4gICAgYmVnaW5zV2l0aCA6ICcoPzpcXHN8XiknXG4gIH0sXG5cbiAgLy8gbWFwcyBhcGkgcmVzcG9uc2UgYXR0cmlidXRlcyB0byBpbnRlcm5hbCByZXByZXNlbnRhdGlvblxuICBmaWVsZHM6IHtcbiAgICBjYXRlZ29yaWVzICAgICAgOiAncmVzdWx0cycsICAgICAvLyBhcnJheSBvZiBjYXRlZ29yaWVzIChjYXRlZ29yeSB2aWV3KVxuICAgIGNhdGVnb3J5TmFtZSAgICA6ICduYW1lJywgICAgICAgIC8vIG5hbWUgb2YgY2F0ZWdvcnkgKGNhdGVnb3J5IHZpZXcpXG4gICAgY2F0ZWdvcnlSZXN1bHRzIDogJ3Jlc3VsdHMnLCAgICAgLy8gYXJyYXkgb2YgcmVzdWx0cyAoY2F0ZWdvcnkgdmlldylcbiAgICBkZXNjcmlwdGlvbiAgICAgOiAnZGVzY3JpcHRpb24nLCAvLyByZXN1bHQgZGVzY3JpcHRpb25cbiAgICBpbWFnZSAgICAgICAgICAgOiAnaW1hZ2UnLCAgICAgICAvLyByZXN1bHQgaW1hZ2VcbiAgICBwcmljZSAgICAgICAgICAgOiAncHJpY2UnLCAgICAgICAvLyByZXN1bHQgcHJpY2VcbiAgICByZXN1bHRzICAgICAgICAgOiAncmVzdWx0cycsICAgICAvLyBhcnJheSBvZiByZXN1bHRzIChzdGFuZGFyZClcbiAgICB0aXRsZSAgICAgICAgICAgOiAndGl0bGUnLCAgICAgICAvLyByZXN1bHQgdGl0bGVcbiAgICB1cmwgICAgICAgICAgICAgOiAndXJsJywgICAgICAgICAvLyByZXN1bHQgdXJsXG4gICAgYWN0aW9uICAgICAgICAgIDogJ2FjdGlvbicsICAgICAgLy8gXCJ2aWV3IG1vcmVcIiBvYmplY3QgbmFtZVxuICAgIGFjdGlvblRleHQgICAgICA6ICd0ZXh0JywgICAgICAgIC8vIFwidmlldyBtb3JlXCIgdGV4dFxuICAgIGFjdGlvblVSTCAgICAgICA6ICd1cmwnICAgICAgICAgIC8vIFwidmlldyBtb3JlXCIgdXJsXG4gIH0sXG5cbiAgc2VsZWN0b3IgOiB7XG4gICAgcHJvbXB0ICAgICAgIDogJy5wcm9tcHQnLFxuICAgIHNlYXJjaEJ1dHRvbiA6ICcuc2VhcmNoLmJ1dHRvbicsXG4gICAgcmVzdWx0cyAgICAgIDogJy5yZXN1bHRzJyxcbiAgICBtZXNzYWdlICAgICAgOiAnLnJlc3VsdHMgPiAubWVzc2FnZScsXG4gICAgY2F0ZWdvcnkgICAgIDogJy5jYXRlZ29yeScsXG4gICAgcmVzdWx0ICAgICAgIDogJy5yZXN1bHQnLFxuICAgIHRpdGxlICAgICAgICA6ICcudGl0bGUsIC5uYW1lJ1xuICB9LFxuXG4gIHRlbXBsYXRlczoge1xuICAgIGVzY2FwZTogZnVuY3Rpb24oc3RyaW5nKSB7XG4gICAgICB2YXJcbiAgICAgICAgYmFkQ2hhcnMgICAgID0gL1smPD5cIidgXS9nLFxuICAgICAgICBzaG91bGRFc2NhcGUgPSAvWyY8PlwiJ2BdLyxcbiAgICAgICAgZXNjYXBlICAgICAgID0ge1xuICAgICAgICAgIFwiJlwiOiBcIiZhbXA7XCIsXG4gICAgICAgICAgXCI8XCI6IFwiJmx0O1wiLFxuICAgICAgICAgIFwiPlwiOiBcIiZndDtcIixcbiAgICAgICAgICAnXCInOiBcIiZxdW90O1wiLFxuICAgICAgICAgIFwiJ1wiOiBcIiYjeDI3O1wiLFxuICAgICAgICAgIFwiYFwiOiBcIiYjeDYwO1wiXG4gICAgICAgIH0sXG4gICAgICAgIGVzY2FwZWRDaGFyICA9IGZ1bmN0aW9uKGNocikge1xuICAgICAgICAgIHJldHVybiBlc2NhcGVbY2hyXTtcbiAgICAgICAgfVxuICAgICAgO1xuICAgICAgaWYoc2hvdWxkRXNjYXBlLnRlc3Qoc3RyaW5nKSkge1xuICAgICAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoYmFkQ2hhcnMsIGVzY2FwZWRDaGFyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdHJpbmc7XG4gICAgfSxcbiAgICBtZXNzYWdlOiBmdW5jdGlvbihtZXNzYWdlLCB0eXBlKSB7XG4gICAgICB2YXJcbiAgICAgICAgaHRtbCA9ICcnXG4gICAgICA7XG4gICAgICBpZihtZXNzYWdlICE9PSB1bmRlZmluZWQgJiYgdHlwZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGh0bWwgKz0gICcnXG4gICAgICAgICAgKyAnPGRpdiBjbGFzcz1cIm1lc3NhZ2UgJyArIHR5cGUgKyAnXCI+J1xuICAgICAgICA7XG4gICAgICAgIC8vIG1lc3NhZ2UgdHlwZVxuICAgICAgICBpZih0eXBlID09ICdlbXB0eScpIHtcbiAgICAgICAgICBodG1sICs9ICcnXG4gICAgICAgICAgICArICc8ZGl2IGNsYXNzPVwiaGVhZGVyXCI+Tm8gUmVzdWx0czwvZGl2IGNsYXNzPVwiaGVhZGVyXCI+J1xuICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImRlc2NyaXB0aW9uXCI+JyArIG1lc3NhZ2UgKyAnPC9kaXYgY2xhc3M9XCJkZXNjcmlwdGlvblwiPidcbiAgICAgICAgICA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgaHRtbCArPSAnIDxkaXYgY2xhc3M9XCJkZXNjcmlwdGlvblwiPicgKyBtZXNzYWdlICsgJzwvZGl2Pic7XG4gICAgICAgIH1cbiAgICAgICAgaHRtbCArPSAnPC9kaXY+JztcbiAgICAgIH1cbiAgICAgIHJldHVybiBodG1sO1xuICAgIH0sXG4gICAgY2F0ZWdvcnk6IGZ1bmN0aW9uKHJlc3BvbnNlLCBmaWVsZHMpIHtcbiAgICAgIHZhclxuICAgICAgICBodG1sID0gJycsXG4gICAgICAgIGVzY2FwZSA9ICQuZm4uc2VhcmNoLnNldHRpbmdzLnRlbXBsYXRlcy5lc2NhcGVcbiAgICAgIDtcbiAgICAgIGlmKHJlc3BvbnNlW2ZpZWxkcy5jYXRlZ29yeVJlc3VsdHNdICE9PSB1bmRlZmluZWQpIHtcblxuICAgICAgICAvLyBlYWNoIGNhdGVnb3J5XG4gICAgICAgICQuZWFjaChyZXNwb25zZVtmaWVsZHMuY2F0ZWdvcnlSZXN1bHRzXSwgZnVuY3Rpb24oaW5kZXgsIGNhdGVnb3J5KSB7XG4gICAgICAgICAgaWYoY2F0ZWdvcnlbZmllbGRzLnJlc3VsdHNdICE9PSB1bmRlZmluZWQgJiYgY2F0ZWdvcnkucmVzdWx0cy5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgIGh0bWwgICs9ICc8ZGl2IGNsYXNzPVwiY2F0ZWdvcnlcIj4nO1xuXG4gICAgICAgICAgICBpZihjYXRlZ29yeVtmaWVsZHMuY2F0ZWdvcnlOYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9XCJuYW1lXCI+JyArIGNhdGVnb3J5W2ZpZWxkcy5jYXRlZ29yeU5hbWVdICsgJzwvZGl2Pic7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGVhY2ggaXRlbSBpbnNpZGUgY2F0ZWdvcnlcbiAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9XCJyZXN1bHRzXCI+JztcbiAgICAgICAgICAgICQuZWFjaChjYXRlZ29yeS5yZXN1bHRzLCBmdW5jdGlvbihpbmRleCwgcmVzdWx0KSB7XG4gICAgICAgICAgICAgIGlmKHJlc3VsdFtmaWVsZHMudXJsXSkge1xuICAgICAgICAgICAgICAgIGh0bWwgICs9ICc8YSBjbGFzcz1cInJlc3VsdFwiIGhyZWY9XCInICsgcmVzdWx0W2ZpZWxkcy51cmxdICsgJ1wiPic7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaHRtbCAgKz0gJzxhIGNsYXNzPVwicmVzdWx0XCI+JztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZihyZXN1bHRbZmllbGRzLmltYWdlXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaHRtbCArPSAnJ1xuICAgICAgICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImltYWdlXCI+J1xuICAgICAgICAgICAgICAgICAgKyAnIDxpbWcgc3JjPVwiJyArIHJlc3VsdFtmaWVsZHMuaW1hZ2VdICsgJ1wiPidcbiAgICAgICAgICAgICAgICAgICsgJzwvZGl2PidcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz1cImNvbnRlbnRcIj4nO1xuICAgICAgICAgICAgICBpZihyZXN1bHRbZmllbGRzLnByaWNlXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz1cInByaWNlXCI+JyArIHJlc3VsdFtmaWVsZHMucHJpY2VdICsgJzwvZGl2Pic7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYocmVzdWx0W2ZpZWxkcy50aXRsZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9XCJ0aXRsZVwiPicgKyByZXN1bHRbZmllbGRzLnRpdGxlXSArICc8L2Rpdj4nO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKHJlc3VsdFtmaWVsZHMuZGVzY3JpcHRpb25dICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBodG1sICs9ICc8ZGl2IGNsYXNzPVwiZGVzY3JpcHRpb25cIj4nICsgcmVzdWx0W2ZpZWxkcy5kZXNjcmlwdGlvbl0gKyAnPC9kaXY+JztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBodG1sICArPSAnJ1xuICAgICAgICAgICAgICAgICsgJzwvZGl2PidcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBodG1sICs9ICc8L2E+JztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaHRtbCArPSAnPC9kaXY+JztcbiAgICAgICAgICAgIGh0bWwgICs9ICcnXG4gICAgICAgICAgICAgICsgJzwvZGl2PidcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZihyZXNwb25zZVtmaWVsZHMuYWN0aW9uXSkge1xuICAgICAgICAgIGh0bWwgKz0gJydcbiAgICAgICAgICArICc8YSBocmVmPVwiJyArIHJlc3BvbnNlW2ZpZWxkcy5hY3Rpb25dW2ZpZWxkcy5hY3Rpb25VUkxdICsgJ1wiIGNsYXNzPVwiYWN0aW9uXCI+J1xuICAgICAgICAgICsgICByZXNwb25zZVtmaWVsZHMuYWN0aW9uXVtmaWVsZHMuYWN0aW9uVGV4dF1cbiAgICAgICAgICArICc8L2E+JztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaHRtbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuICAgIHN0YW5kYXJkOiBmdW5jdGlvbihyZXNwb25zZSwgZmllbGRzKSB7XG4gICAgICB2YXJcbiAgICAgICAgaHRtbCA9ICcnXG4gICAgICA7XG4gICAgICBpZihyZXNwb25zZVtmaWVsZHMucmVzdWx0c10gIT09IHVuZGVmaW5lZCkge1xuXG4gICAgICAgIC8vIGVhY2ggcmVzdWx0XG4gICAgICAgICQuZWFjaChyZXNwb25zZVtmaWVsZHMucmVzdWx0c10sIGZ1bmN0aW9uKGluZGV4LCByZXN1bHQpIHtcbiAgICAgICAgICBpZihyZXN1bHRbZmllbGRzLnVybF0pIHtcbiAgICAgICAgICAgIGh0bWwgICs9ICc8YSBjbGFzcz1cInJlc3VsdFwiIGhyZWY9XCInICsgcmVzdWx0W2ZpZWxkcy51cmxdICsgJ1wiPic7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaHRtbCAgKz0gJzxhIGNsYXNzPVwicmVzdWx0XCI+JztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYocmVzdWx0W2ZpZWxkcy5pbWFnZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaHRtbCArPSAnJ1xuICAgICAgICAgICAgICArICc8ZGl2IGNsYXNzPVwiaW1hZ2VcIj4nXG4gICAgICAgICAgICAgICsgJyA8aW1nIHNyYz1cIicgKyByZXN1bHRbZmllbGRzLmltYWdlXSArICdcIj4nXG4gICAgICAgICAgICAgICsgJzwvZGl2PidcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz1cImNvbnRlbnRcIj4nO1xuICAgICAgICAgIGlmKHJlc3VsdFtmaWVsZHMucHJpY2VdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGh0bWwgKz0gJzxkaXYgY2xhc3M9XCJwcmljZVwiPicgKyByZXN1bHRbZmllbGRzLnByaWNlXSArICc8L2Rpdj4nO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihyZXN1bHRbZmllbGRzLnRpdGxlXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBodG1sICs9ICc8ZGl2IGNsYXNzPVwidGl0bGVcIj4nICsgcmVzdWx0W2ZpZWxkcy50aXRsZV0gKyAnPC9kaXY+JztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYocmVzdWx0W2ZpZWxkcy5kZXNjcmlwdGlvbl0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFzcz1cImRlc2NyaXB0aW9uXCI+JyArIHJlc3VsdFtmaWVsZHMuZGVzY3JpcHRpb25dICsgJzwvZGl2Pic7XG4gICAgICAgICAgfVxuICAgICAgICAgIGh0bWwgICs9ICcnXG4gICAgICAgICAgICArICc8L2Rpdj4nXG4gICAgICAgICAgO1xuICAgICAgICAgIGh0bWwgKz0gJzwvYT4nO1xuICAgICAgICB9KTtcblxuICAgICAgICBpZihyZXNwb25zZVtmaWVsZHMuYWN0aW9uXSkge1xuICAgICAgICAgIGh0bWwgKz0gJydcbiAgICAgICAgICArICc8YSBocmVmPVwiJyArIHJlc3BvbnNlW2ZpZWxkcy5hY3Rpb25dW2ZpZWxkcy5hY3Rpb25VUkxdICsgJ1wiIGNsYXNzPVwiYWN0aW9uXCI+J1xuICAgICAgICAgICsgICByZXNwb25zZVtmaWVsZHMuYWN0aW9uXVtmaWVsZHMuYWN0aW9uVGV4dF1cbiAgICAgICAgICArICc8L2E+JztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaHRtbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbn07XG5cbn0pKCBqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQgKTtcblxuLyohXG4gKiAjIFNlbWFudGljIFVJIDIuNC4wIC0gU2hhcGVcbiAqIGh0dHA6Ly9naXRodWIuY29tL3NlbWFudGljLW9yZy9zZW1hbnRpYy11aS9cbiAqXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG5cbjsoZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG4ndXNlIHN0cmljdCc7XG5cbndpbmRvdyA9ICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGgpXG4gID8gd2luZG93XG4gIDogKHR5cGVvZiBzZWxmICE9ICd1bmRlZmluZWQnICYmIHNlbGYuTWF0aCA9PSBNYXRoKVxuICAgID8gc2VsZlxuICAgIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKVxuO1xuXG4kLmZuLnNoYXBlID0gZnVuY3Rpb24ocGFyYW1ldGVycykge1xuICB2YXJcbiAgICAkYWxsTW9kdWxlcyAgICAgPSAkKHRoaXMpLFxuICAgICRib2R5ICAgICAgICAgICA9ICQoJ2JvZHknKSxcblxuICAgIHRpbWUgICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgICA9IFtdLFxuXG4gICAgcXVlcnkgICAgICAgICAgID0gYXJndW1lbnRzWzBdLFxuICAgIG1ldGhvZEludm9rZWQgICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzICA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAgfHwgZnVuY3Rpb24oY2FsbGJhY2spIHsgc2V0VGltZW91dChjYWxsYmFjaywgMCk7IH0sXG5cbiAgICByZXR1cm5lZFZhbHVlXG4gIDtcblxuICAkYWxsTW9kdWxlc1xuICAgIC5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyXG4gICAgICAgIG1vZHVsZVNlbGVjdG9yID0gJGFsbE1vZHVsZXMuc2VsZWN0b3IgfHwgJycsXG4gICAgICAgIHNldHRpbmdzICAgICAgID0gKCAkLmlzUGxhaW5PYmplY3QocGFyYW1ldGVycykgKVxuICAgICAgICAgID8gJC5leHRlbmQodHJ1ZSwge30sICQuZm4uc2hhcGUuc2V0dGluZ3MsIHBhcmFtZXRlcnMpXG4gICAgICAgICAgOiAkLmV4dGVuZCh7fSwgJC5mbi5zaGFwZS5zZXR0aW5ncyksXG5cbiAgICAgICAgLy8gaW50ZXJuYWwgYWxpYXNlc1xuICAgICAgICBuYW1lc3BhY2UgICAgID0gc2V0dGluZ3MubmFtZXNwYWNlLFxuICAgICAgICBzZWxlY3RvciAgICAgID0gc2V0dGluZ3Muc2VsZWN0b3IsXG4gICAgICAgIGVycm9yICAgICAgICAgPSBzZXR0aW5ncy5lcnJvcixcbiAgICAgICAgY2xhc3NOYW1lICAgICA9IHNldHRpbmdzLmNsYXNzTmFtZSxcblxuICAgICAgICAvLyBkZWZpbmUgbmFtZXNwYWNlcyBmb3IgbW9kdWxlc1xuICAgICAgICBldmVudE5hbWVzcGFjZSAgPSAnLicgKyBuYW1lc3BhY2UsXG4gICAgICAgIG1vZHVsZU5hbWVzcGFjZSA9ICdtb2R1bGUtJyArIG5hbWVzcGFjZSxcblxuICAgICAgICAvLyBzZWxlY3RvciBjYWNoZVxuICAgICAgICAkbW9kdWxlICAgICAgID0gJCh0aGlzKSxcbiAgICAgICAgJHNpZGVzICAgICAgICA9ICRtb2R1bGUuZmluZChzZWxlY3Rvci5zaWRlcyksXG4gICAgICAgICRzaWRlICAgICAgICAgPSAkbW9kdWxlLmZpbmQoc2VsZWN0b3Iuc2lkZSksXG5cbiAgICAgICAgLy8gcHJpdmF0ZSB2YXJpYWJsZXNcbiAgICAgICAgbmV4dEluZGV4ID0gZmFsc2UsXG4gICAgICAgICRhY3RpdmVTaWRlLFxuICAgICAgICAkbmV4dFNpZGUsXG5cbiAgICAgICAgLy8gc3RhbmRhcmQgbW9kdWxlXG4gICAgICAgIGVsZW1lbnQgICAgICAgPSB0aGlzLFxuICAgICAgICBpbnN0YW5jZSAgICAgID0gJG1vZHVsZS5kYXRhKG1vZHVsZU5hbWVzcGFjZSksXG4gICAgICAgIG1vZHVsZVxuICAgICAgO1xuXG4gICAgICBtb2R1bGUgPSB7XG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0luaXRpYWxpemluZyBtb2R1bGUgZm9yJywgZWxlbWVudCk7XG4gICAgICAgICAgbW9kdWxlLnNldC5kZWZhdWx0U2lkZSgpO1xuICAgICAgICAgIG1vZHVsZS5pbnN0YW50aWF0ZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluc3RhbnRpYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU3RvcmluZyBpbnN0YW5jZSBvZiBtb2R1bGUnLCBtb2R1bGUpO1xuICAgICAgICAgIGluc3RhbmNlID0gbW9kdWxlO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5kYXRhKG1vZHVsZU5hbWVzcGFjZSwgaW5zdGFuY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXN0cm95aW5nIHByZXZpb3VzIG1vZHVsZSBmb3InLCBlbGVtZW50KTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAucmVtb3ZlRGF0YShtb2R1bGVOYW1lc3BhY2UpXG4gICAgICAgICAgICAub2ZmKGV2ZW50TmFtZXNwYWNlKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICByZWZyZXNoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVmcmVzaGluZyBzZWxlY3RvciBjYWNoZSBmb3InLCBlbGVtZW50KTtcbiAgICAgICAgICAkbW9kdWxlID0gJChlbGVtZW50KTtcbiAgICAgICAgICAkc2lkZXMgID0gJCh0aGlzKS5maW5kKHNlbGVjdG9yLnNoYXBlKTtcbiAgICAgICAgICAkc2lkZSAgID0gJCh0aGlzKS5maW5kKHNlbGVjdG9yLnNpZGUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlcGFpbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdGb3JjaW5nIHJlcGFpbnQgZXZlbnQnKTtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIHNoYXBlICAgICAgICAgID0gJHNpZGVzWzBdIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLFxuICAgICAgICAgICAgZmFrZUFzc2lnbm1lbnQgPSBzaGFwZS5vZmZzZXRXaWR0aFxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBhbmltYXRlOiBmdW5jdGlvbihwcm9wZXJ0eU9iamVjdCwgY2FsbGJhY2spIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQW5pbWF0aW5nIGJveCB3aXRoIHByb3BlcnRpZXMnLCBwcm9wZXJ0eU9iamVjdCk7XG4gICAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0V4ZWN1dGluZyBhbmltYXRpb24gY2FsbGJhY2snKTtcbiAgICAgICAgICAgIGlmKGV2ZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUucmVzZXQoKTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQuYWN0aXZlKCk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBzZXR0aW5ncy5iZWZvcmVDaGFuZ2UuY2FsbCgkbmV4dFNpZGVbMF0pO1xuICAgICAgICAgIGlmKG1vZHVsZS5nZXQudHJhbnNpdGlvbkV2ZW50KCkpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTdGFydGluZyBDU1MgYW5pbWF0aW9uJyk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJHNpZGVzXG4gICAgICAgICAgICAgIC5jc3MocHJvcGVydHlPYmplY3QpXG4gICAgICAgICAgICAgIC5vbmUobW9kdWxlLmdldC50cmFuc2l0aW9uRXZlbnQoKSwgY2FsbGJhY2spXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LmR1cmF0aW9uKHNldHRpbmdzLmR1cmF0aW9uKTtcbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICRhY3RpdmVTaWRlXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5oaWRkZW4pXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHF1ZXVlOiBmdW5jdGlvbihtZXRob2QpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ1F1ZXVlaW5nIGFuaW1hdGlvbiBvZicsIG1ldGhvZCk7XG4gICAgICAgICAgJHNpZGVzXG4gICAgICAgICAgICAub25lKG1vZHVsZS5nZXQudHJhbnNpdGlvbkV2ZW50KCksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0V4ZWN1dGluZyBxdWV1ZWQgYW5pbWF0aW9uJyk7XG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAkbW9kdWxlLnNoYXBlKG1ldGhvZCk7XG4gICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBbmltYXRpbmcgc3RhdGVzIHJlc2V0Jyk7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hbmltYXRpbmcpXG4gICAgICAgICAgICAuYXR0cignc3R5bGUnLCAnJylcbiAgICAgICAgICAgIC5yZW1vdmVBdHRyKCdzdHlsZScpXG4gICAgICAgICAgO1xuICAgICAgICAgIC8vIHJlbW92ZUF0dHIgc3R5bGUgZG9lcyBub3QgY29uc2lzdGVudGx5IHdvcmsgaW4gc2FmYXJpXG4gICAgICAgICAgJHNpZGVzXG4gICAgICAgICAgICAuYXR0cignc3R5bGUnLCAnJylcbiAgICAgICAgICAgIC5yZW1vdmVBdHRyKCdzdHlsZScpXG4gICAgICAgICAgO1xuICAgICAgICAgICRzaWRlXG4gICAgICAgICAgICAuYXR0cignc3R5bGUnLCAnJylcbiAgICAgICAgICAgIC5yZW1vdmVBdHRyKCdzdHlsZScpXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmhpZGRlbilcbiAgICAgICAgICA7XG4gICAgICAgICAgJG5leHRTaWRlXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFuaW1hdGluZylcbiAgICAgICAgICAgIC5hdHRyKCdzdHlsZScsICcnKVxuICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ3N0eWxlJylcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaXM6IHtcbiAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKCRzaWRlLmZpbHRlcignLicgKyBjbGFzc05hbWUuYWN0aXZlKVswXSA9PSAkbmV4dFNpZGVbMF0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYW5pbWF0aW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkbW9kdWxlLmhhc0NsYXNzKGNsYXNzTmFtZS5hbmltYXRpbmcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXQ6IHtcblxuICAgICAgICAgIGRlZmF1bHRTaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRhY3RpdmVTaWRlID0gJG1vZHVsZS5maW5kKCcuJyArIHNldHRpbmdzLmNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgICAgJG5leHRTaWRlICAgPSAoICRhY3RpdmVTaWRlLm5leHQoc2VsZWN0b3Iuc2lkZSkubGVuZ3RoID4gMCApXG4gICAgICAgICAgICAgID8gJGFjdGl2ZVNpZGUubmV4dChzZWxlY3Rvci5zaWRlKVxuICAgICAgICAgICAgICA6ICRtb2R1bGUuZmluZChzZWxlY3Rvci5zaWRlKS5maXJzdCgpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBuZXh0SW5kZXggPSBmYWxzZTtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBY3RpdmUgc2lkZSBzZXQgdG8nLCAkYWN0aXZlU2lkZSk7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTmV4dCBzaWRlIHNldCB0bycsICRuZXh0U2lkZSk7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGR1cmF0aW9uOiBmdW5jdGlvbihkdXJhdGlvbikge1xuICAgICAgICAgICAgZHVyYXRpb24gPSBkdXJhdGlvbiB8fCBzZXR0aW5ncy5kdXJhdGlvbjtcbiAgICAgICAgICAgIGR1cmF0aW9uID0gKHR5cGVvZiBkdXJhdGlvbiA9PSAnbnVtYmVyJylcbiAgICAgICAgICAgICAgPyBkdXJhdGlvbiArICdtcydcbiAgICAgICAgICAgICAgOiBkdXJhdGlvblxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NldHRpbmcgYW5pbWF0aW9uIGR1cmF0aW9uJywgZHVyYXRpb24pO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuZHVyYXRpb24gfHwgc2V0dGluZ3MuZHVyYXRpb24gPT09IDApIHtcbiAgICAgICAgICAgICAgJHNpZGVzLmFkZCgkc2lkZSlcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICctd2Via2l0LXRyYW5zaXRpb24tZHVyYXRpb24nOiBkdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICctbW96LXRyYW5zaXRpb24tZHVyYXRpb24nOiBkdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICctbXMtdHJhbnNpdGlvbi1kdXJhdGlvbic6IGR1cmF0aW9uLFxuICAgICAgICAgICAgICAgICAgJy1vLXRyYW5zaXRpb24tZHVyYXRpb24nOiBkdXJhdGlvbixcbiAgICAgICAgICAgICAgICAgICd0cmFuc2l0aW9uLWR1cmF0aW9uJzogZHVyYXRpb25cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGN1cnJlbnRTdGFnZVNpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICRhY3RpdmVTaWRlID0gJG1vZHVsZS5maW5kKCcuJyArIHNldHRpbmdzLmNsYXNzTmFtZS5hY3RpdmUpLFxuICAgICAgICAgICAgICB3aWR0aCAgICAgICA9ICRhY3RpdmVTaWRlLm91dGVyV2lkdGgodHJ1ZSksXG4gICAgICAgICAgICAgIGhlaWdodCAgICAgID0gJGFjdGl2ZVNpZGUub3V0ZXJIZWlnaHQodHJ1ZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgd2lkdGg6IHdpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIHN0YWdlU2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJGNsb25lICAgICAgPSAkbW9kdWxlLmNsb25lKCkuYWRkQ2xhc3MoY2xhc3NOYW1lLmxvYWRpbmcpLFxuICAgICAgICAgICAgICAkYWN0aXZlU2lkZSA9ICRjbG9uZS5maW5kKCcuJyArIHNldHRpbmdzLmNsYXNzTmFtZS5hY3RpdmUpLFxuICAgICAgICAgICAgICAkbmV4dFNpZGUgICA9IChuZXh0SW5kZXgpXG4gICAgICAgICAgICAgICAgPyAkY2xvbmUuZmluZChzZWxlY3Rvci5zaWRlKS5lcShuZXh0SW5kZXgpXG4gICAgICAgICAgICAgICAgOiAoICRhY3RpdmVTaWRlLm5leHQoc2VsZWN0b3Iuc2lkZSkubGVuZ3RoID4gMCApXG4gICAgICAgICAgICAgICAgICA/ICRhY3RpdmVTaWRlLm5leHQoc2VsZWN0b3Iuc2lkZSlcbiAgICAgICAgICAgICAgICAgIDogJGNsb25lLmZpbmQoc2VsZWN0b3Iuc2lkZSkuZmlyc3QoKSxcbiAgICAgICAgICAgICAgbmV3V2lkdGggICAgPSAoc2V0dGluZ3Mud2lkdGggPT0gJ25leHQnKVxuICAgICAgICAgICAgICAgID8gJG5leHRTaWRlLm91dGVyV2lkdGgodHJ1ZSlcbiAgICAgICAgICAgICAgICA6IChzZXR0aW5ncy53aWR0aCA9PSAnaW5pdGlhbCcpXG4gICAgICAgICAgICAgICAgICA/ICRtb2R1bGUud2lkdGgoKVxuICAgICAgICAgICAgICAgICAgOiBzZXR0aW5ncy53aWR0aCxcbiAgICAgICAgICAgICAgbmV3SGVpZ2h0ICAgID0gKHNldHRpbmdzLmhlaWdodCA9PSAnbmV4dCcpXG4gICAgICAgICAgICAgICAgPyAkbmV4dFNpZGUub3V0ZXJIZWlnaHQodHJ1ZSlcbiAgICAgICAgICAgICAgICA6IChzZXR0aW5ncy5oZWlnaHQgPT0gJ2luaXRpYWwnKVxuICAgICAgICAgICAgICAgICAgPyAkbW9kdWxlLmhlaWdodCgpXG4gICAgICAgICAgICAgICAgICA6IHNldHRpbmdzLmhlaWdodFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJGFjdGl2ZVNpZGUucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgICAkbmV4dFNpZGUuYWRkQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSk7XG4gICAgICAgICAgICAkY2xvbmUuaW5zZXJ0QWZ0ZXIoJG1vZHVsZSk7XG4gICAgICAgICAgICAkY2xvbmUucmVtb3ZlKCk7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy53aWR0aCAhPSAnYXV0bycpIHtcbiAgICAgICAgICAgICAgJG1vZHVsZS5jc3MoJ3dpZHRoJywgbmV3V2lkdGggKyBzZXR0aW5ncy5qaXR0ZXIpO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU3BlY2lmeWluZyB3aWR0aCBkdXJpbmcgYW5pbWF0aW9uJywgbmV3V2lkdGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoc2V0dGluZ3MuaGVpZ2h0ICE9ICdhdXRvJykge1xuICAgICAgICAgICAgICAkbW9kdWxlLmNzcygnaGVpZ2h0JywgbmV3SGVpZ2h0ICsgc2V0dGluZ3Muaml0dGVyKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NwZWNpZnlpbmcgaGVpZ2h0IGR1cmluZyBhbmltYXRpb24nLCBuZXdIZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBuZXh0U2lkZTogZnVuY3Rpb24oc2VsZWN0b3IpIHtcbiAgICAgICAgICAgIG5leHRJbmRleCA9IHNlbGVjdG9yO1xuICAgICAgICAgICAgJG5leHRTaWRlID0gJHNpZGUuZmlsdGVyKHNlbGVjdG9yKTtcbiAgICAgICAgICAgIG5leHRJbmRleCA9ICRzaWRlLmluZGV4KCRuZXh0U2lkZSk7XG4gICAgICAgICAgICBpZigkbmV4dFNpZGUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQuZGVmYXVsdFNpZGUoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLnNpZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ05leHQgc2lkZSBtYW51YWxseSBzZXQgdG8nLCAkbmV4dFNpZGUpO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBhY3RpdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NldHRpbmcgbmV3IHNpZGUgdG8gYWN0aXZlJywgJG5leHRTaWRlKTtcbiAgICAgICAgICAgICRzaWRlXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJG5leHRTaWRlXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgc2V0dGluZ3Mub25DaGFuZ2UuY2FsbCgkbmV4dFNpZGVbMF0pO1xuICAgICAgICAgICAgbW9kdWxlLnNldC5kZWZhdWx0U2lkZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBmbGlwOiB7XG5cbiAgICAgICAgICB1cDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMuY29tcGxldGUoKSAmJiAhbW9kdWxlLmlzLmFuaW1hdGluZygpICYmICFzZXR0aW5ncy5hbGxvd1JlcGVhdHMpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaWRlIGFscmVhZHkgdmlzaWJsZScsICRuZXh0U2lkZSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCAhbW9kdWxlLmlzLmFuaW1hdGluZygpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRmxpcHBpbmcgdXAnLCAkbmV4dFNpZGUpO1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm0gPSBtb2R1bGUuZ2V0LnRyYW5zZm9ybS51cCgpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5zdGFnZVNpemUoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnN0YWdlLmFib3ZlKCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5hbmltYXRlKHRyYW5zZm9ybSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnF1ZXVlKCdmbGlwIHVwJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGRvd246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmlzLmNvbXBsZXRlKCkgJiYgIW1vZHVsZS5pcy5hbmltYXRpbmcoKSAmJiAhc2V0dGluZ3MuYWxsb3dSZXBlYXRzKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2lkZSBhbHJlYWR5IHZpc2libGUnLCAkbmV4dFNpZGUpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggIW1vZHVsZS5pcy5hbmltYXRpbmcoKSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0ZsaXBwaW5nIGRvd24nLCAkbmV4dFNpZGUpO1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm0gPSBtb2R1bGUuZ2V0LnRyYW5zZm9ybS5kb3duKClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnN0YWdlU2l6ZSgpO1xuICAgICAgICAgICAgICBtb2R1bGUuc3RhZ2UuYmVsb3coKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmFuaW1hdGUodHJhbnNmb3JtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUucXVldWUoJ2ZsaXAgZG93bicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBsZWZ0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5jb21wbGV0ZSgpICYmICFtb2R1bGUuaXMuYW5pbWF0aW5nKCkgJiYgIXNldHRpbmdzLmFsbG93UmVwZWF0cykge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NpZGUgYWxyZWFkeSB2aXNpYmxlJywgJG5leHRTaWRlKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoICFtb2R1bGUuaXMuYW5pbWF0aW5nKCkpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdGbGlwcGluZyBsZWZ0JywgJG5leHRTaWRlKTtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtID0gbW9kdWxlLmdldC50cmFuc2Zvcm0ubGVmdCgpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5zdGFnZVNpemUoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnN0YWdlLmxlZnQoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmFuaW1hdGUodHJhbnNmb3JtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUucXVldWUoJ2ZsaXAgbGVmdCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICByaWdodDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMuY29tcGxldGUoKSAmJiAhbW9kdWxlLmlzLmFuaW1hdGluZygpICYmICFzZXR0aW5ncy5hbGxvd1JlcGVhdHMpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTaWRlIGFscmVhZHkgdmlzaWJsZScsICRuZXh0U2lkZSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCAhbW9kdWxlLmlzLmFuaW1hdGluZygpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRmxpcHBpbmcgcmlnaHQnLCAkbmV4dFNpZGUpO1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm0gPSBtb2R1bGUuZ2V0LnRyYW5zZm9ybS5yaWdodCgpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgbW9kdWxlLnNldC5zdGFnZVNpemUoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnN0YWdlLnJpZ2h0KCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5hbmltYXRlKHRyYW5zZm9ybSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnF1ZXVlKCdmbGlwIHJpZ2h0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIG92ZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmlzLmNvbXBsZXRlKCkgJiYgIW1vZHVsZS5pcy5hbmltYXRpbmcoKSAmJiAhc2V0dGluZ3MuYWxsb3dSZXBlYXRzKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2lkZSBhbHJlYWR5IHZpc2libGUnLCAkbmV4dFNpZGUpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggIW1vZHVsZS5pcy5hbmltYXRpbmcoKSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0ZsaXBwaW5nIG92ZXInLCAkbmV4dFNpZGUpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnN0YWdlU2l6ZSgpO1xuICAgICAgICAgICAgICBtb2R1bGUuc3RhZ2UuYmVoaW5kKCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5hbmltYXRlKG1vZHVsZS5nZXQudHJhbnNmb3JtLm92ZXIoKSApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5xdWV1ZSgnZmxpcCBvdmVyJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGJhY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmlzLmNvbXBsZXRlKCkgJiYgIW1vZHVsZS5pcy5hbmltYXRpbmcoKSAmJiAhc2V0dGluZ3MuYWxsb3dSZXBlYXRzKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2lkZSBhbHJlYWR5IHZpc2libGUnLCAkbmV4dFNpZGUpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggIW1vZHVsZS5pcy5hbmltYXRpbmcoKSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0ZsaXBwaW5nIGJhY2snLCAkbmV4dFNpZGUpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LnN0YWdlU2l6ZSgpO1xuICAgICAgICAgICAgICBtb2R1bGUuc3RhZ2UuYmVoaW5kKCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5hbmltYXRlKG1vZHVsZS5nZXQudHJhbnNmb3JtLmJhY2soKSApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5xdWV1ZSgnZmxpcCBiYWNrJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0OiB7XG5cbiAgICAgICAgICB0cmFuc2Zvcm06IHtcbiAgICAgICAgICAgIHVwOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgdHJhbnNsYXRlID0ge1xuICAgICAgICAgICAgICAgICAgeTogLSgoJGFjdGl2ZVNpZGUub3V0ZXJIZWlnaHQodHJ1ZSkgLSAkbmV4dFNpZGUub3V0ZXJIZWlnaHQodHJ1ZSkpIC8gMiksXG4gICAgICAgICAgICAgICAgICB6OiAtKCRhY3RpdmVTaWRlLm91dGVySGVpZ2h0KHRydWUpIC8gMilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKCcgKyB0cmFuc2xhdGUueSArICdweCkgdHJhbnNsYXRlWignKyB0cmFuc2xhdGUueiArICdweCkgcm90YXRlWCgtOTBkZWcpJ1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgZG93bjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgIHRyYW5zbGF0ZSA9IHtcbiAgICAgICAgICAgICAgICAgIHk6IC0oKCRhY3RpdmVTaWRlLm91dGVySGVpZ2h0KHRydWUpIC0gJG5leHRTaWRlLm91dGVySGVpZ2h0KHRydWUpKSAvIDIpLFxuICAgICAgICAgICAgICAgICAgejogLSgkYWN0aXZlU2lkZS5vdXRlckhlaWdodCh0cnVlKSAvIDIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgnICsgdHJhbnNsYXRlLnkgKyAncHgpIHRyYW5zbGF0ZVooJysgdHJhbnNsYXRlLnogKyAncHgpIHJvdGF0ZVgoOTBkZWcpJ1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgbGVmdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgIHRyYW5zbGF0ZSA9IHtcbiAgICAgICAgICAgICAgICAgIHggOiAtKCgkYWN0aXZlU2lkZS5vdXRlcldpZHRoKHRydWUpIC0gJG5leHRTaWRlLm91dGVyV2lkdGgodHJ1ZSkpIC8gMiksXG4gICAgICAgICAgICAgICAgICB6IDogLSgkYWN0aXZlU2lkZS5vdXRlcldpZHRoKHRydWUpIC8gMilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGVYKCcgKyB0cmFuc2xhdGUueCArICdweCkgdHJhbnNsYXRlWignICsgdHJhbnNsYXRlLnogKyAncHgpIHJvdGF0ZVkoOTBkZWcpJ1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgcmlnaHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICB0cmFuc2xhdGUgPSB7XG4gICAgICAgICAgICAgICAgICB4IDogLSgoJGFjdGl2ZVNpZGUub3V0ZXJXaWR0aCh0cnVlKSAtICRuZXh0U2lkZS5vdXRlcldpZHRoKHRydWUpKSAvIDIpLFxuICAgICAgICAgICAgICAgICAgeiA6IC0oJGFjdGl2ZVNpZGUub3V0ZXJXaWR0aCh0cnVlKSAvIDIpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlWCgnICsgdHJhbnNsYXRlLnggKyAncHgpIHRyYW5zbGF0ZVooJyArIHRyYW5zbGF0ZS56ICsgJ3B4KSByb3RhdGVZKC05MGRlZyknXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBvdmVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgdHJhbnNsYXRlID0ge1xuICAgICAgICAgICAgICAgICAgeCA6IC0oKCRhY3RpdmVTaWRlLm91dGVyV2lkdGgodHJ1ZSkgLSAkbmV4dFNpZGUub3V0ZXJXaWR0aCh0cnVlKSkgLyAyKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoJyArIHRyYW5zbGF0ZS54ICsgJ3B4KSByb3RhdGVZKDE4MGRlZyknXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICBiYWNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgdHJhbnNsYXRlID0ge1xuICAgICAgICAgICAgICAgICAgeCA6IC0oKCRhY3RpdmVTaWRlLm91dGVyV2lkdGgodHJ1ZSkgLSAkbmV4dFNpZGUub3V0ZXJXaWR0aCh0cnVlKSkgLyAyKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoJyArIHRyYW5zbGF0ZS54ICsgJ3B4KSByb3RhdGVZKC0xODBkZWcpJ1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICB0cmFuc2l0aW9uRXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGVsZW1lbnQgICAgID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZWxlbWVudCcpLFxuICAgICAgICAgICAgICB0cmFuc2l0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAndHJhbnNpdGlvbicgICAgICAgOid0cmFuc2l0aW9uZW5kJyxcbiAgICAgICAgICAgICAgICAnT1RyYW5zaXRpb24nICAgICAgOidvVHJhbnNpdGlvbkVuZCcsXG4gICAgICAgICAgICAgICAgJ01velRyYW5zaXRpb24nICAgIDondHJhbnNpdGlvbmVuZCcsXG4gICAgICAgICAgICAgICAgJ1dlYmtpdFRyYW5zaXRpb24nIDond2Via2l0VHJhbnNpdGlvbkVuZCdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdHJhbnNpdGlvblxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgZm9yKHRyYW5zaXRpb24gaW4gdHJhbnNpdGlvbnMpe1xuICAgICAgICAgICAgICBpZiggZWxlbWVudC5zdHlsZVt0cmFuc2l0aW9uXSAhPT0gdW5kZWZpbmVkICl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zaXRpb25zW3RyYW5zaXRpb25dO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIG5leHRTaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoICRhY3RpdmVTaWRlLm5leHQoc2VsZWN0b3Iuc2lkZSkubGVuZ3RoID4gMCApXG4gICAgICAgICAgICAgID8gJGFjdGl2ZVNpZGUubmV4dChzZWxlY3Rvci5zaWRlKVxuICAgICAgICAgICAgICA6ICRtb2R1bGUuZmluZChzZWxlY3Rvci5zaWRlKS5maXJzdCgpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuXG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RhZ2U6IHtcblxuICAgICAgICAgIGFib3ZlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBib3ggPSB7XG4gICAgICAgICAgICAgICAgb3JpZ2luIDogKCgkYWN0aXZlU2lkZS5vdXRlckhlaWdodCh0cnVlKSAtICRuZXh0U2lkZS5vdXRlckhlaWdodCh0cnVlKSkgLyAyKSxcbiAgICAgICAgICAgICAgICBkZXB0aCAgOiB7XG4gICAgICAgICAgICAgICAgICBhY3RpdmUgOiAoJG5leHRTaWRlLm91dGVySGVpZ2h0KHRydWUpIC8gMiksXG4gICAgICAgICAgICAgICAgICBuZXh0ICAgOiAoJGFjdGl2ZVNpZGUub3V0ZXJIZWlnaHQodHJ1ZSkgLyAyKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NldHRpbmcgdGhlIGluaXRpYWwgYW5pbWF0aW9uIHBvc2l0aW9uIGFzIGFib3ZlJywgJG5leHRTaWRlLCBib3gpO1xuICAgICAgICAgICAgJHNpZGVzXG4gICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nIDogJ3RyYW5zbGF0ZVooLScgKyBib3guZGVwdGguYWN0aXZlICsgJ3B4KSdcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgICRhY3RpdmVTaWRlXG4gICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nIDogJ3JvdGF0ZVkoMGRlZykgdHJhbnNsYXRlWignICsgYm94LmRlcHRoLmFjdGl2ZSArICdweCknXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkbmV4dFNpZGVcbiAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5hbmltYXRpbmcpXG4gICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICd0b3AnICAgICAgIDogYm94Lm9yaWdpbiArICdweCcsXG4gICAgICAgICAgICAgICAgJ3RyYW5zZm9ybScgOiAncm90YXRlWCg5MGRlZykgdHJhbnNsYXRlWignICsgYm94LmRlcHRoLm5leHQgKyAncHgpJ1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBiZWxvdzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgYm94ID0ge1xuICAgICAgICAgICAgICAgIG9yaWdpbiA6ICgoJGFjdGl2ZVNpZGUub3V0ZXJIZWlnaHQodHJ1ZSkgLSAkbmV4dFNpZGUub3V0ZXJIZWlnaHQodHJ1ZSkpIC8gMiksXG4gICAgICAgICAgICAgICAgZGVwdGggIDoge1xuICAgICAgICAgICAgICAgICAgYWN0aXZlIDogKCRuZXh0U2lkZS5vdXRlckhlaWdodCh0cnVlKSAvIDIpLFxuICAgICAgICAgICAgICAgICAgbmV4dCAgIDogKCRhY3RpdmVTaWRlLm91dGVySGVpZ2h0KHRydWUpIC8gMilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTZXR0aW5nIHRoZSBpbml0aWFsIGFuaW1hdGlvbiBwb3NpdGlvbiBhcyBiZWxvdycsICRuZXh0U2lkZSwgYm94KTtcbiAgICAgICAgICAgICRzaWRlc1xuICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJyA6ICd0cmFuc2xhdGVaKC0nICsgYm94LmRlcHRoLmFjdGl2ZSArICdweCknXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkYWN0aXZlU2lkZVxuICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJyA6ICdyb3RhdGVZKDBkZWcpIHRyYW5zbGF0ZVooJyArIGJveC5kZXB0aC5hY3RpdmUgKyAncHgpJ1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJG5leHRTaWRlXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKVxuICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAndG9wJyAgICAgICA6IGJveC5vcmlnaW4gKyAncHgnLFxuICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nIDogJ3JvdGF0ZVgoLTkwZGVnKSB0cmFuc2xhdGVaKCcgKyBib3guZGVwdGgubmV4dCArICdweCknXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGxlZnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGhlaWdodCA9IHtcbiAgICAgICAgICAgICAgICBhY3RpdmUgOiAkYWN0aXZlU2lkZS5vdXRlcldpZHRoKHRydWUpLFxuICAgICAgICAgICAgICAgIG5leHQgICA6ICRuZXh0U2lkZS5vdXRlcldpZHRoKHRydWUpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGJveCA9IHtcbiAgICAgICAgICAgICAgICBvcmlnaW4gOiAoICggaGVpZ2h0LmFjdGl2ZSAtIGhlaWdodC5uZXh0ICkgLyAyKSxcbiAgICAgICAgICAgICAgICBkZXB0aCAgOiB7XG4gICAgICAgICAgICAgICAgICBhY3RpdmUgOiAoaGVpZ2h0Lm5leHQgLyAyKSxcbiAgICAgICAgICAgICAgICAgIG5leHQgICA6IChoZWlnaHQuYWN0aXZlIC8gMilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTZXR0aW5nIHRoZSBpbml0aWFsIGFuaW1hdGlvbiBwb3NpdGlvbiBhcyBsZWZ0JywgJG5leHRTaWRlLCBib3gpO1xuICAgICAgICAgICAgJHNpZGVzXG4gICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nIDogJ3RyYW5zbGF0ZVooLScgKyBib3guZGVwdGguYWN0aXZlICsgJ3B4KSdcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgICRhY3RpdmVTaWRlXG4gICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nIDogJ3JvdGF0ZVkoMGRlZykgdHJhbnNsYXRlWignICsgYm94LmRlcHRoLmFjdGl2ZSArICdweCknXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkbmV4dFNpZGVcbiAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5hbmltYXRpbmcpXG4gICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICdsZWZ0JyAgICAgIDogYm94Lm9yaWdpbiArICdweCcsXG4gICAgICAgICAgICAgICAgJ3RyYW5zZm9ybScgOiAncm90YXRlWSgtOTBkZWcpIHRyYW5zbGF0ZVooJyArIGJveC5kZXB0aC5uZXh0ICsgJ3B4KSdcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgcmlnaHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGhlaWdodCA9IHtcbiAgICAgICAgICAgICAgICBhY3RpdmUgOiAkYWN0aXZlU2lkZS5vdXRlcldpZHRoKHRydWUpLFxuICAgICAgICAgICAgICAgIG5leHQgICA6ICRuZXh0U2lkZS5vdXRlcldpZHRoKHRydWUpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGJveCA9IHtcbiAgICAgICAgICAgICAgICBvcmlnaW4gOiAoICggaGVpZ2h0LmFjdGl2ZSAtIGhlaWdodC5uZXh0ICkgLyAyKSxcbiAgICAgICAgICAgICAgICBkZXB0aCAgOiB7XG4gICAgICAgICAgICAgICAgICBhY3RpdmUgOiAoaGVpZ2h0Lm5leHQgLyAyKSxcbiAgICAgICAgICAgICAgICAgIG5leHQgICA6IChoZWlnaHQuYWN0aXZlIC8gMilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTZXR0aW5nIHRoZSBpbml0aWFsIGFuaW1hdGlvbiBwb3NpdGlvbiBhcyBsZWZ0JywgJG5leHRTaWRlLCBib3gpO1xuICAgICAgICAgICAgJHNpZGVzXG4gICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nIDogJ3RyYW5zbGF0ZVooLScgKyBib3guZGVwdGguYWN0aXZlICsgJ3B4KSdcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgICRhY3RpdmVTaWRlXG4gICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nIDogJ3JvdGF0ZVkoMGRlZykgdHJhbnNsYXRlWignICsgYm94LmRlcHRoLmFjdGl2ZSArICdweCknXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkbmV4dFNpZGVcbiAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5hbmltYXRpbmcpXG4gICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgICdsZWZ0JyAgICAgIDogYm94Lm9yaWdpbiArICdweCcsXG4gICAgICAgICAgICAgICAgJ3RyYW5zZm9ybScgOiAncm90YXRlWSg5MGRlZykgdHJhbnNsYXRlWignICsgYm94LmRlcHRoLm5leHQgKyAncHgpJ1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBiZWhpbmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGhlaWdodCA9IHtcbiAgICAgICAgICAgICAgICBhY3RpdmUgOiAkYWN0aXZlU2lkZS5vdXRlcldpZHRoKHRydWUpLFxuICAgICAgICAgICAgICAgIG5leHQgICA6ICRuZXh0U2lkZS5vdXRlcldpZHRoKHRydWUpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGJveCA9IHtcbiAgICAgICAgICAgICAgICBvcmlnaW4gOiAoICggaGVpZ2h0LmFjdGl2ZSAtIGhlaWdodC5uZXh0ICkgLyAyKSxcbiAgICAgICAgICAgICAgICBkZXB0aCAgOiB7XG4gICAgICAgICAgICAgICAgICBhY3RpdmUgOiAoaGVpZ2h0Lm5leHQgLyAyKSxcbiAgICAgICAgICAgICAgICAgIG5leHQgICA6IChoZWlnaHQuYWN0aXZlIC8gMilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTZXR0aW5nIHRoZSBpbml0aWFsIGFuaW1hdGlvbiBwb3NpdGlvbiBhcyBiZWhpbmQnLCAkbmV4dFNpZGUsIGJveCk7XG4gICAgICAgICAgICAkYWN0aXZlU2lkZVxuICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJyA6ICdyb3RhdGVZKDBkZWcpJ1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJG5leHRTaWRlXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKVxuICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAnbGVmdCcgICAgICA6IGJveC5vcmlnaW4gKyAncHgnLFxuICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nIDogJ3JvdGF0ZVkoLTE4MGRlZyknXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzZXR0aW5nOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ2hhbmdpbmcgc2V0dGluZycsIG5hbWUsIHZhbHVlKTtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgc2V0dGluZ3MsIG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmKCQuaXNQbGFpbk9iamVjdChzZXR0aW5nc1tuYW1lXSkpIHtcbiAgICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgc2V0dGluZ3NbbmFtZV0sIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBzZXR0aW5nc1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5nc1tuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGludGVybmFsOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBtb2R1bGUsIG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG1vZHVsZVtuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGVbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBkZWJ1ZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZyA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5pbmZvLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB2ZXJib3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLnZlcmJvc2UgJiYgc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5pbmZvLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50KSB7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuZXJyb3IsIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBwZXJmb3JtYW5jZToge1xuICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGN1cnJlbnRUaW1lLFxuICAgICAgICAgICAgICBleGVjdXRpb25UaW1lLFxuICAgICAgICAgICAgICBwcmV2aW91c1RpbWVcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRUaW1lICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgcHJldmlvdXNUaW1lICA9IHRpbWUgfHwgY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUgPSBjdXJyZW50VGltZSAtIHByZXZpb3VzVGltZTtcbiAgICAgICAgICAgICAgdGltZSAgICAgICAgICA9IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICBwZXJmb3JtYW5jZS5wdXNoKHtcbiAgICAgICAgICAgICAgICAnTmFtZScgICAgICAgICAgIDogbWVzc2FnZVswXSxcbiAgICAgICAgICAgICAgICAnQXJndW1lbnRzJyAgICAgIDogW10uc2xpY2UuY2FsbChtZXNzYWdlLCAxKSB8fCAnJyxcbiAgICAgICAgICAgICAgICAnRWxlbWVudCcgICAgICAgIDogZWxlbWVudCxcbiAgICAgICAgICAgICAgICAnRXhlY3V0aW9uIFRpbWUnIDogZXhlY3V0aW9uVGltZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyID0gc2V0VGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UuZGlzcGxheSwgNTAwKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpc3BsYXk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHRpdGxlID0gc2V0dGluZ3MubmFtZSArICc6JyxcbiAgICAgICAgICAgICAgdG90YWxUaW1lID0gMFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgdGltZSA9IGZhbHNlO1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgIHRvdGFsVGltZSArPSBkYXRhWydFeGVjdXRpb24gVGltZSddO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aXRsZSArPSAnICcgKyB0b3RhbFRpbWUgKyAnbXMnO1xuICAgICAgICAgICAgaWYobW9kdWxlU2VsZWN0b3IpIHtcbiAgICAgICAgICAgICAgdGl0bGUgKz0gJyBcXCcnICsgbW9kdWxlU2VsZWN0b3IgKyAnXFwnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCRhbGxNb2R1bGVzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgdGl0bGUgKz0gJyAnICsgJygnICsgJGFsbE1vZHVsZXMubGVuZ3RoICsgJyknO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIChjb25zb2xlLmdyb3VwICE9PSB1bmRlZmluZWQgfHwgY29uc29sZS50YWJsZSAhPT0gdW5kZWZpbmVkKSAmJiBwZXJmb3JtYW5jZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQodGl0bGUpO1xuICAgICAgICAgICAgICBpZihjb25zb2xlLnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS50YWJsZShwZXJmb3JtYW5jZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YVsnTmFtZSddICsgJzogJyArIGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ10rJ21zJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGVyZm9ybWFuY2UgPSBbXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGludm9rZTogZnVuY3Rpb24ocXVlcnksIHBhc3NlZEFyZ3VtZW50cywgY29udGV4dCkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgb2JqZWN0ID0gaW5zdGFuY2UsXG4gICAgICAgICAgICBtYXhEZXB0aCxcbiAgICAgICAgICAgIGZvdW5kLFxuICAgICAgICAgICAgcmVzcG9uc2VcbiAgICAgICAgICA7XG4gICAgICAgICAgcGFzc2VkQXJndW1lbnRzID0gcGFzc2VkQXJndW1lbnRzIHx8IHF1ZXJ5QXJndW1lbnRzO1xuICAgICAgICAgIGNvbnRleHQgICAgICAgICA9IGVsZW1lbnQgICAgICAgICB8fCBjb250ZXh0O1xuICAgICAgICAgIGlmKHR5cGVvZiBxdWVyeSA9PSAnc3RyaW5nJyAmJiBvYmplY3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcXVlcnkgICAgPSBxdWVyeS5zcGxpdCgvW1xcLiBdLyk7XG4gICAgICAgICAgICBtYXhEZXB0aCA9IHF1ZXJ5Lmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAkLmVhY2gocXVlcnksIGZ1bmN0aW9uKGRlcHRoLCB2YWx1ZSkge1xuICAgICAgICAgICAgICB2YXIgY2FtZWxDYXNlVmFsdWUgPSAoZGVwdGggIT0gbWF4RGVwdGgpXG4gICAgICAgICAgICAgICAgPyB2YWx1ZSArIHF1ZXJ5W2RlcHRoICsgMV0uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBxdWVyeVtkZXB0aCArIDFdLnNsaWNlKDEpXG4gICAgICAgICAgICAgICAgOiBxdWVyeVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFtjYW1lbENhc2VWYWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFtjYW1lbENhc2VWYWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggJC5pc1BsYWluT2JqZWN0KCBvYmplY3RbdmFsdWVdICkgJiYgKGRlcHRoICE9IG1heERlcHRoKSApIHtcbiAgICAgICAgICAgICAgICBvYmplY3QgPSBvYmplY3RbdmFsdWVdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoIG9iamVjdFt2YWx1ZV0gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCBmb3VuZCApICkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZC5hcHBseShjb250ZXh0LCBwYXNzZWRBcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGZvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCQuaXNBcnJheShyZXR1cm5lZFZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZS5wdXNoKHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSBbcmV0dXJuZWRWYWx1ZSwgcmVzcG9uc2VdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSByZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgICAgIGlmKGluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbnZva2UocXVlcnkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmKGluc3RhbmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpbnN0YW5jZS5pbnZva2UoJ2Rlc3Ryb3knKTtcbiAgICAgICAgfVxuICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgfVxuICAgIH0pXG4gIDtcblxuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xufTtcblxuJC5mbi5zaGFwZS5zZXR0aW5ncyA9IHtcblxuICAvLyBtb2R1bGUgaW5mb1xuICBuYW1lIDogJ1NoYXBlJyxcblxuICAvLyBoaWRlIGFsbCBkZWJ1ZyBjb250ZW50XG4gIHNpbGVudCAgICAgOiBmYWxzZSxcblxuICAvLyBkZWJ1ZyBjb250ZW50IG91dHB1dHRlZCB0byBjb25zb2xlXG4gIGRlYnVnICAgICAgOiBmYWxzZSxcblxuICAvLyB2ZXJib3NlIGRlYnVnIG91dHB1dFxuICB2ZXJib3NlICAgIDogZmFsc2UsXG5cbiAgLy8gZnVkZ2UgZmFjdG9yIGluIHBpeGVscyB3aGVuIHN3YXBwaW5nIGZyb20gMmQgdG8gM2QgKGNhbiBiZSB1c2VmdWwgdG8gY29ycmVjdCByb3VuZGluZyBlcnJvcnMpXG4gIGppdHRlciAgICAgOiAwLFxuXG4gIC8vIHBlcmZvcm1hbmNlIGRhdGEgb3V0cHV0XG4gIHBlcmZvcm1hbmNlOiB0cnVlLFxuXG4gIC8vIGV2ZW50IG5hbWVzcGFjZVxuICBuYW1lc3BhY2UgIDogJ3NoYXBlJyxcblxuICAvLyB3aWR0aCBkdXJpbmcgYW5pbWF0aW9uLCBjYW4gYmUgc2V0IHRvICdhdXRvJywgaW5pdGlhbCcsICduZXh0JyBvciBwaXhlbCBhbW91bnRcbiAgd2lkdGg6ICdpbml0aWFsJyxcblxuICAvLyBoZWlnaHQgZHVyaW5nIGFuaW1hdGlvbiwgY2FuIGJlIHNldCB0byAnYXV0bycsICdpbml0aWFsJywgJ25leHQnIG9yIHBpeGVsIGFtb3VudFxuICBoZWlnaHQ6ICdpbml0aWFsJyxcblxuICAvLyBjYWxsYmFjayBvY2N1cnMgb24gc2lkZSBjaGFuZ2VcbiAgYmVmb3JlQ2hhbmdlIDogZnVuY3Rpb24oKSB7fSxcbiAgb25DaGFuZ2UgICAgIDogZnVuY3Rpb24oKSB7fSxcblxuICAvLyBhbGxvdyBhbmltYXRpb24gdG8gc2FtZSBzaWRlXG4gIGFsbG93UmVwZWF0czogZmFsc2UsXG5cbiAgLy8gYW5pbWF0aW9uIGR1cmF0aW9uXG4gIGR1cmF0aW9uICAgOiBmYWxzZSxcblxuICAvLyBwb3NzaWJsZSBlcnJvcnNcbiAgZXJyb3I6IHtcbiAgICBzaWRlICAgOiAnWW91IHRyaWVkIHRvIHN3aXRjaCB0byBhIHNpZGUgdGhhdCBkb2VzIG5vdCBleGlzdC4nLFxuICAgIG1ldGhvZCA6ICdUaGUgbWV0aG9kIHlvdSBjYWxsZWQgaXMgbm90IGRlZmluZWQnXG4gIH0sXG5cbiAgLy8gY2xhc3NuYW1lcyB1c2VkXG4gIGNsYXNzTmFtZSAgIDoge1xuICAgIGFuaW1hdGluZyA6ICdhbmltYXRpbmcnLFxuICAgIGhpZGRlbiAgICA6ICdoaWRkZW4nLFxuICAgIGxvYWRpbmcgICA6ICdsb2FkaW5nJyxcbiAgICBhY3RpdmUgICAgOiAnYWN0aXZlJ1xuICB9LFxuXG4gIC8vIHNlbGVjdG9ycyB1c2VkXG4gIHNlbGVjdG9yICAgIDoge1xuICAgIHNpZGVzIDogJy5zaWRlcycsXG4gICAgc2lkZSAgOiAnLnNpZGUnXG4gIH1cblxufTtcblxuXG59KSggalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50ICk7XG5cbi8qIVxuICogIyBTZW1hbnRpYyBVSSAyLjQuMCAtIFNpZGViYXJcbiAqIGh0dHA6Ly9naXRodWIuY29tL3NlbWFudGljLW9yZy9zZW1hbnRpYy11aS9cbiAqXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG5cbjsoZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG4ndXNlIHN0cmljdCc7XG5cbndpbmRvdyA9ICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGgpXG4gID8gd2luZG93XG4gIDogKHR5cGVvZiBzZWxmICE9ICd1bmRlZmluZWQnICYmIHNlbGYuTWF0aCA9PSBNYXRoKVxuICAgID8gc2VsZlxuICAgIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKVxuO1xuXG4kLmZuLnNpZGViYXIgPSBmdW5jdGlvbihwYXJhbWV0ZXJzKSB7XG4gIHZhclxuICAgICRhbGxNb2R1bGVzICAgICA9ICQodGhpcyksXG4gICAgJHdpbmRvdyAgICAgICAgID0gJCh3aW5kb3cpLFxuICAgICRkb2N1bWVudCAgICAgICA9ICQoZG9jdW1lbnQpLFxuICAgICRodG1sICAgICAgICAgICA9ICQoJ2h0bWwnKSxcbiAgICAkaGVhZCAgICAgICAgICAgPSAkKCdoZWFkJyksXG5cbiAgICBtb2R1bGVTZWxlY3RvciAgPSAkYWxsTW9kdWxlcy5zZWxlY3RvciB8fCAnJyxcblxuICAgIHRpbWUgICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgICA9IFtdLFxuXG4gICAgcXVlcnkgICAgICAgICAgID0gYXJndW1lbnRzWzBdLFxuICAgIG1ldGhvZEludm9rZWQgICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzICA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAgfHwgZnVuY3Rpb24oY2FsbGJhY2spIHsgc2V0VGltZW91dChjYWxsYmFjaywgMCk7IH0sXG5cbiAgICByZXR1cm5lZFZhbHVlXG4gIDtcblxuICAkYWxsTW9kdWxlc1xuICAgIC5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyXG4gICAgICAgIHNldHRpbmdzICAgICAgICA9ICggJC5pc1BsYWluT2JqZWN0KHBhcmFtZXRlcnMpIClcbiAgICAgICAgICA/ICQuZXh0ZW5kKHRydWUsIHt9LCAkLmZuLnNpZGViYXIuc2V0dGluZ3MsIHBhcmFtZXRlcnMpXG4gICAgICAgICAgOiAkLmV4dGVuZCh7fSwgJC5mbi5zaWRlYmFyLnNldHRpbmdzKSxcblxuICAgICAgICBzZWxlY3RvciAgICAgICAgPSBzZXR0aW5ncy5zZWxlY3RvcixcbiAgICAgICAgY2xhc3NOYW1lICAgICAgID0gc2V0dGluZ3MuY2xhc3NOYW1lLFxuICAgICAgICBuYW1lc3BhY2UgICAgICAgPSBzZXR0aW5ncy5uYW1lc3BhY2UsXG4gICAgICAgIHJlZ0V4cCAgICAgICAgICA9IHNldHRpbmdzLnJlZ0V4cCxcbiAgICAgICAgZXJyb3IgICAgICAgICAgID0gc2V0dGluZ3MuZXJyb3IsXG5cbiAgICAgICAgZXZlbnROYW1lc3BhY2UgID0gJy4nICsgbmFtZXNwYWNlLFxuICAgICAgICBtb2R1bGVOYW1lc3BhY2UgPSAnbW9kdWxlLScgKyBuYW1lc3BhY2UsXG5cbiAgICAgICAgJG1vZHVsZSAgICAgICAgID0gJCh0aGlzKSxcbiAgICAgICAgJGNvbnRleHQgICAgICAgID0gJChzZXR0aW5ncy5jb250ZXh0KSxcblxuICAgICAgICAkc2lkZWJhcnMgICAgICAgPSAkbW9kdWxlLmNoaWxkcmVuKHNlbGVjdG9yLnNpZGViYXIpLFxuICAgICAgICAkZml4ZWQgICAgICAgICAgPSAkY29udGV4dC5jaGlsZHJlbihzZWxlY3Rvci5maXhlZCksXG4gICAgICAgICRwdXNoZXIgICAgICAgICA9ICRjb250ZXh0LmNoaWxkcmVuKHNlbGVjdG9yLnB1c2hlciksXG4gICAgICAgICRzdHlsZSxcblxuICAgICAgICBlbGVtZW50ICAgICAgICAgPSB0aGlzLFxuICAgICAgICBpbnN0YW5jZSAgICAgICAgPSAkbW9kdWxlLmRhdGEobW9kdWxlTmFtZXNwYWNlKSxcblxuICAgICAgICBlbGVtZW50TmFtZXNwYWNlLFxuICAgICAgICBpZCxcbiAgICAgICAgY3VycmVudFNjcm9sbCxcbiAgICAgICAgdHJhbnNpdGlvbkV2ZW50LFxuXG4gICAgICAgIG1vZHVsZVxuICAgICAgO1xuXG4gICAgICBtb2R1bGUgICAgICA9IHtcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0luaXRpYWxpemluZyBzaWRlYmFyJywgcGFyYW1ldGVycyk7XG5cbiAgICAgICAgICBtb2R1bGUuY3JlYXRlLmlkKCk7XG5cbiAgICAgICAgICB0cmFuc2l0aW9uRXZlbnQgPSBtb2R1bGUuZ2V0LnRyYW5zaXRpb25FdmVudCgpO1xuXG4gICAgICAgICAgLy8gYXZvaWRzIGxvY2tpbmcgcmVuZGVyaW5nIGlmIGluaXRpYWxpemVkIGluIG9uUmVhZHlcbiAgICAgICAgICBpZihzZXR0aW5ncy5kZWxheVNldHVwKSB7XG4gICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobW9kdWxlLnNldHVwLmxheW91dCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbW9kdWxlLnNldHVwLmxheW91dCgpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS5zZXR1cC5jYWNoZSgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgbW9kdWxlLmluc3RhbnRpYXRlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5zdGFudGlhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTdG9yaW5nIGluc3RhbmNlIG9mIG1vZHVsZScsIG1vZHVsZSk7XG4gICAgICAgICAgaW5zdGFuY2UgPSBtb2R1bGU7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLmRhdGEobW9kdWxlTmFtZXNwYWNlLCBtb2R1bGUpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNyZWF0ZToge1xuICAgICAgICAgIGlkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlkID0gKE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpICsgJzAwMDAwMDAwMCcpLnN1YnN0cigyLDgpO1xuICAgICAgICAgICAgZWxlbWVudE5hbWVzcGFjZSA9ICcuJyArIGlkO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0NyZWF0aW5nIHVuaXF1ZSBpZCBmb3IgZWxlbWVudCcsIGlkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0Rlc3Ryb3lpbmcgcHJldmlvdXMgbW9kdWxlIGZvcicsICRtb2R1bGUpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5vZmYoZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgICAucmVtb3ZlRGF0YShtb2R1bGVOYW1lc3BhY2UpXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKG1vZHVsZS5pcy5pb3MoKSkge1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5pb3MoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gYm91bmQgYnkgdXVpZFxuICAgICAgICAgICRjb250ZXh0Lm9mZihlbGVtZW50TmFtZXNwYWNlKTtcbiAgICAgICAgICAkd2luZG93Lm9mZihlbGVtZW50TmFtZXNwYWNlKTtcbiAgICAgICAgICAkZG9jdW1lbnQub2ZmKGVsZW1lbnROYW1lc3BhY2UpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50OiB7XG4gICAgICAgICAgY2xpY2thd2F5OiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGNsaWNrZWRJblB1c2hlciA9ICgkcHVzaGVyLmZpbmQoZXZlbnQudGFyZ2V0KS5sZW5ndGggPiAwIHx8ICRwdXNoZXIuaXMoZXZlbnQudGFyZ2V0KSksXG4gICAgICAgICAgICAgIGNsaWNrZWRDb250ZXh0ICA9ICgkY29udGV4dC5pcyhldmVudC50YXJnZXQpKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoY2xpY2tlZEluUHVzaGVyKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdVc2VyIGNsaWNrZWQgb24gZGltbWVkIHBhZ2UnKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGNsaWNrZWRDb250ZXh0KSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdVc2VyIGNsaWNrZWQgb24gZGltbWFibGUgY29udGV4dCAoc2NhbGVkIG91dCBwYWdlKScpO1xuICAgICAgICAgICAgICBtb2R1bGUuaGlkZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdG91Y2g6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAvL2V2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY29udGFpblNjcm9sbDogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgIGlmKGVsZW1lbnQuc2Nyb2xsVG9wIDw9IDApICB7XG4gICAgICAgICAgICAgIGVsZW1lbnQuc2Nyb2xsVG9wID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKChlbGVtZW50LnNjcm9sbFRvcCArIGVsZW1lbnQub2Zmc2V0SGVpZ2h0KSA+PSBlbGVtZW50LnNjcm9sbEhlaWdodCkge1xuICAgICAgICAgICAgICBlbGVtZW50LnNjcm9sbFRvcCA9IGVsZW1lbnQuc2Nyb2xsSGVpZ2h0IC0gZWxlbWVudC5vZmZzZXRIZWlnaHQgLSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2Nyb2xsOiBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgaWYoICQoZXZlbnQudGFyZ2V0KS5jbG9zZXN0KHNlbGVjdG9yLnNpZGViYXIpLmxlbmd0aCA9PT0gMCApIHtcbiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgYmluZDoge1xuICAgICAgICAgIGNsaWNrYXdheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQWRkaW5nIGNsaWNrYXdheSBldmVudHMgdG8gY29udGV4dCcsICRjb250ZXh0KTtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmNsb3NhYmxlKSB7XG4gICAgICAgICAgICAgICRjb250ZXh0XG4gICAgICAgICAgICAgICAgLm9uKCdjbGljaycgICAgKyBlbGVtZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuY2xpY2thd2F5KVxuICAgICAgICAgICAgICAgIC5vbigndG91Y2hlbmQnICsgZWxlbWVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LmNsaWNrYXdheSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2Nyb2xsTG9jazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5zY3JvbGxMb2NrKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRGlzYWJsaW5nIHBhZ2Ugc2Nyb2xsJyk7XG4gICAgICAgICAgICAgICR3aW5kb3dcbiAgICAgICAgICAgICAgICAub24oJ0RPTU1vdXNlU2Nyb2xsJyArIGVsZW1lbnROYW1lc3BhY2UsIG1vZHVsZS5ldmVudC5zY3JvbGwpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBZGRpbmcgZXZlbnRzIHRvIGNvbnRhaW4gc2lkZWJhciBzY3JvbGwnKTtcbiAgICAgICAgICAgICRkb2N1bWVudFxuICAgICAgICAgICAgICAub24oJ3RvdWNobW92ZScgKyBlbGVtZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQudG91Y2gpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5vbignc2Nyb2xsJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuY29udGFpblNjcm9sbClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHVuYmluZDoge1xuICAgICAgICAgIGNsaWNrYXdheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3ZpbmcgY2xpY2thd2F5IGV2ZW50cyBmcm9tIGNvbnRleHQnLCAkY29udGV4dCk7XG4gICAgICAgICAgICAkY29udGV4dC5vZmYoZWxlbWVudE5hbWVzcGFjZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzY3JvbGxMb2NrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyBzY3JvbGwgbG9jayBmcm9tIHBhZ2UnKTtcbiAgICAgICAgICAgICRkb2N1bWVudC5vZmYoZWxlbWVudE5hbWVzcGFjZSk7XG4gICAgICAgICAgICAkd2luZG93Lm9mZihlbGVtZW50TmFtZXNwYWNlKTtcbiAgICAgICAgICAgICRtb2R1bGUub2ZmKCdzY3JvbGwnICsgZXZlbnROYW1lc3BhY2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBhZGQ6IHtcbiAgICAgICAgICBpbmxpbmVDU1M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHdpZHRoICAgICA9IG1vZHVsZS5jYWNoZS53aWR0aCAgfHwgJG1vZHVsZS5vdXRlcldpZHRoKCksXG4gICAgICAgICAgICAgIGhlaWdodCAgICA9IG1vZHVsZS5jYWNoZS5oZWlnaHQgfHwgJG1vZHVsZS5vdXRlckhlaWdodCgpLFxuICAgICAgICAgICAgICBpc1JUTCAgICAgPSBtb2R1bGUuaXMucnRsKCksXG4gICAgICAgICAgICAgIGRpcmVjdGlvbiA9IG1vZHVsZS5nZXQuZGlyZWN0aW9uKCksXG4gICAgICAgICAgICAgIGRpc3RhbmNlICA9IHtcbiAgICAgICAgICAgICAgICBsZWZ0ICAgOiB3aWR0aCxcbiAgICAgICAgICAgICAgICByaWdodCAgOiAtd2lkdGgsXG4gICAgICAgICAgICAgICAgdG9wICAgIDogaGVpZ2h0LFxuICAgICAgICAgICAgICAgIGJvdHRvbSA6IC1oZWlnaHRcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgc3R5bGVcbiAgICAgICAgICAgIDtcblxuICAgICAgICAgICAgaWYoaXNSVEwpe1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUlRMIGRldGVjdGVkLCBmbGlwcGluZyB3aWR0aHMnKTtcbiAgICAgICAgICAgICAgZGlzdGFuY2UubGVmdCA9IC13aWR0aDtcbiAgICAgICAgICAgICAgZGlzdGFuY2UucmlnaHQgPSB3aWR0aDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc3R5bGUgID0gJzxzdHlsZT4nO1xuXG4gICAgICAgICAgICBpZihkaXJlY3Rpb24gPT09ICdsZWZ0JyB8fCBkaXJlY3Rpb24gPT09ICdyaWdodCcpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgQ1NTIHJ1bGVzIGZvciBhbmltYXRpb24gZGlzdGFuY2UnLCB3aWR0aCk7XG4gICAgICAgICAgICAgIHN0eWxlICArPSAnJ1xuICAgICAgICAgICAgICAgICsgJyAudWkudmlzaWJsZS4nICsgZGlyZWN0aW9uICsgJy5zaWRlYmFyIH4gLmZpeGVkLCdcbiAgICAgICAgICAgICAgICArICcgLnVpLnZpc2libGUuJyArIGRpcmVjdGlvbiArICcuc2lkZWJhciB+IC5wdXNoZXIgeydcbiAgICAgICAgICAgICAgICArICcgICAtd2Via2l0LXRyYW5zZm9ybTogdHJhbnNsYXRlM2QoJysgZGlzdGFuY2VbZGlyZWN0aW9uXSArICdweCwgMCwgMCk7J1xuICAgICAgICAgICAgICAgICsgJyAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgnKyBkaXN0YW5jZVtkaXJlY3Rpb25dICsgJ3B4LCAwLCAwKTsnXG4gICAgICAgICAgICAgICAgKyAnIH0nXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoZGlyZWN0aW9uID09PSAndG9wJyB8fCBkaXJlY3Rpb24gPT0gJ2JvdHRvbScpIHtcbiAgICAgICAgICAgICAgc3R5bGUgICs9ICcnXG4gICAgICAgICAgICAgICAgKyAnIC51aS52aXNpYmxlLicgKyBkaXJlY3Rpb24gKyAnLnNpZGViYXIgfiAuZml4ZWQsJ1xuICAgICAgICAgICAgICAgICsgJyAudWkudmlzaWJsZS4nICsgZGlyZWN0aW9uICsgJy5zaWRlYmFyIH4gLnB1c2hlciB7J1xuICAgICAgICAgICAgICAgICsgJyAgIC13ZWJraXQtdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAnICsgZGlzdGFuY2VbZGlyZWN0aW9uXSArICdweCwgMCk7J1xuICAgICAgICAgICAgICAgICsgJyAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwLCAnICsgZGlzdGFuY2VbZGlyZWN0aW9uXSArICdweCwgMCk7J1xuICAgICAgICAgICAgICAgICsgJyB9J1xuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qIElFIGlzIG9ubHkgYnJvd3NlciBub3QgdG8gY3JlYXRlIGNvbnRleHQgd2l0aCB0cmFuc2Zvcm1zICovXG4gICAgICAgICAgICAvKiBodHRwczovL3d3dy53My5vcmcvQnVncy9QdWJsaWMvc2hvd19idWcuY2dpP2lkPTE2MzI4ICovXG4gICAgICAgICAgICBpZiggbW9kdWxlLmlzLmllKCkgKSB7XG4gICAgICAgICAgICAgIGlmKGRpcmVjdGlvbiA9PT0gJ2xlZnQnIHx8IGRpcmVjdGlvbiA9PT0gJ3JpZ2h0Jykge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIENTUyBydWxlcyBmb3IgYW5pbWF0aW9uIGRpc3RhbmNlJywgd2lkdGgpO1xuICAgICAgICAgICAgICAgIHN0eWxlICArPSAnJ1xuICAgICAgICAgICAgICAgICAgKyAnIGJvZHkucHVzaGFibGUgPiAudWkudmlzaWJsZS4nICsgZGlyZWN0aW9uICsgJy5zaWRlYmFyIH4gLnB1c2hlcjphZnRlciB7J1xuICAgICAgICAgICAgICAgICAgKyAnICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKCcrIGRpc3RhbmNlW2RpcmVjdGlvbl0gKyAncHgsIDAsIDApOydcbiAgICAgICAgICAgICAgICAgICsgJyAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgnKyBkaXN0YW5jZVtkaXJlY3Rpb25dICsgJ3B4LCAwLCAwKTsnXG4gICAgICAgICAgICAgICAgICArICcgfSdcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZihkaXJlY3Rpb24gPT09ICd0b3AnIHx8IGRpcmVjdGlvbiA9PSAnYm90dG9tJykge1xuICAgICAgICAgICAgICAgIHN0eWxlICArPSAnJ1xuICAgICAgICAgICAgICAgICAgKyAnIGJvZHkucHVzaGFibGUgPiAudWkudmlzaWJsZS4nICsgZGlyZWN0aW9uICsgJy5zaWRlYmFyIH4gLnB1c2hlcjphZnRlciB7J1xuICAgICAgICAgICAgICAgICAgKyAnICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDAsICcgKyBkaXN0YW5jZVtkaXJlY3Rpb25dICsgJ3B4LCAwKTsnXG4gICAgICAgICAgICAgICAgICArICcgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoMCwgJyArIGRpc3RhbmNlW2RpcmVjdGlvbl0gKyAncHgsIDApOydcbiAgICAgICAgICAgICAgICAgICsgJyB9J1xuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvKiBvcHBvc2l0ZSBzaWRlcyB2aXNpYmxlIGZvcmNlcyBjb250ZW50IG92ZXJsYXkgKi9cbiAgICAgICAgICAgICAgc3R5bGUgKz0gJydcbiAgICAgICAgICAgICAgICArICcgYm9keS5wdXNoYWJsZSA+IC51aS52aXNpYmxlLmxlZnQuc2lkZWJhciB+IC51aS52aXNpYmxlLnJpZ2h0LnNpZGViYXIgfiAucHVzaGVyOmFmdGVyLCdcbiAgICAgICAgICAgICAgICArICcgYm9keS5wdXNoYWJsZSA+IC51aS52aXNpYmxlLnJpZ2h0LnNpZGViYXIgfiAudWkudmlzaWJsZS5sZWZ0LnNpZGViYXIgfiAucHVzaGVyOmFmdGVyIHsnXG4gICAgICAgICAgICAgICAgKyAnICAgLXdlYmtpdC10cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKDBweCwgMCwgMCk7J1xuICAgICAgICAgICAgICAgICsgJyAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgwcHgsIDAsIDApOydcbiAgICAgICAgICAgICAgICArICcgfSdcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3R5bGUgKz0gJzwvc3R5bGU+JztcbiAgICAgICAgICAgICRzdHlsZSA9ICQoc3R5bGUpXG4gICAgICAgICAgICAgIC5hcHBlbmRUbygkaGVhZClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIHNpemluZyBjc3MgdG8gaGVhZCcsICRzdHlsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZWZyZXNoaW5nIHNlbGVjdG9yIGNhY2hlJyk7XG4gICAgICAgICAgJGNvbnRleHQgID0gJChzZXR0aW5ncy5jb250ZXh0KTtcbiAgICAgICAgICAkc2lkZWJhcnMgPSAkY29udGV4dC5jaGlsZHJlbihzZWxlY3Rvci5zaWRlYmFyKTtcbiAgICAgICAgICAkcHVzaGVyICAgPSAkY29udGV4dC5jaGlsZHJlbihzZWxlY3Rvci5wdXNoZXIpO1xuICAgICAgICAgICRmaXhlZCAgICA9ICRjb250ZXh0LmNoaWxkcmVuKHNlbGVjdG9yLmZpeGVkKTtcbiAgICAgICAgICBtb2R1bGUuY2xlYXIuY2FjaGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZWZyZXNoU2lkZWJhcnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZWZyZXNoaW5nIG90aGVyIHNpZGViYXJzJyk7XG4gICAgICAgICAgJHNpZGViYXJzID0gJGNvbnRleHQuY2hpbGRyZW4oc2VsZWN0b3Iuc2lkZWJhcik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVwYWludDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0ZvcmNpbmcgcmVwYWludCBldmVudCcpO1xuICAgICAgICAgIGVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICB2YXIgaWdub3JlZCA9IGVsZW1lbnQub2Zmc2V0SGVpZ2h0O1xuICAgICAgICAgIGVsZW1lbnQuc2Nyb2xsVG9wID0gZWxlbWVudC5zY3JvbGxUb3A7XG4gICAgICAgICAgZWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gJyc7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dXA6IHtcbiAgICAgICAgICBjYWNoZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuY2FjaGUgPSB7XG4gICAgICAgICAgICAgIHdpZHRoICA6ICRtb2R1bGUub3V0ZXJXaWR0aCgpLFxuICAgICAgICAgICAgICBoZWlnaHQgOiAkbW9kdWxlLm91dGVySGVpZ2h0KCksXG4gICAgICAgICAgICAgIHJ0bCAgICA6ICgkbW9kdWxlLmNzcygnZGlyZWN0aW9uJykgPT0gJ3J0bCcpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbGF5b3V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCAkY29udGV4dC5jaGlsZHJlbihzZWxlY3Rvci5wdXNoZXIpLmxlbmd0aCA9PT0gMCApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgd3JhcHBlciBlbGVtZW50IGZvciBzaWRlYmFyJyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5wdXNoZXIpO1xuICAgICAgICAgICAgICAkcHVzaGVyID0gJCgnPGRpdiBjbGFzcz1cInB1c2hlclwiIC8+Jyk7XG4gICAgICAgICAgICAgICRjb250ZXh0XG4gICAgICAgICAgICAgICAgLmNoaWxkcmVuKClcbiAgICAgICAgICAgICAgICAgIC5ub3Qoc2VsZWN0b3Iub21pdHRlZClcbiAgICAgICAgICAgICAgICAgIC5ub3QoJHNpZGViYXJzKVxuICAgICAgICAgICAgICAgICAgLndyYXBBbGwoJHB1c2hlcilcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBtb2R1bGUucmVmcmVzaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoJG1vZHVsZS5uZXh0QWxsKHNlbGVjdG9yLnB1c2hlcikubGVuZ3RoID09PSAwIHx8ICRtb2R1bGUubmV4dEFsbChzZWxlY3Rvci5wdXNoZXIpWzBdICE9PSAkcHVzaGVyWzBdKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnTW92ZWQgc2lkZWJhciB0byBjb3JyZWN0IHBhcmVudCBlbGVtZW50Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5tb3ZlZFNpZGViYXIsIGVsZW1lbnQpO1xuICAgICAgICAgICAgICAkbW9kdWxlLmRldGFjaCgpLnByZXBlbmRUbygkY29udGV4dCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuY2xlYXIuY2FjaGUoKTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQucHVzaGFibGUoKTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQuZGlyZWN0aW9uKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGF0dGFjaEV2ZW50czogZnVuY3Rpb24oc2VsZWN0b3IsIGV2ZW50KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAkdG9nZ2xlID0gJChzZWxlY3RvcilcbiAgICAgICAgICA7XG4gICAgICAgICAgZXZlbnQgPSAkLmlzRnVuY3Rpb24obW9kdWxlW2V2ZW50XSlcbiAgICAgICAgICAgID8gbW9kdWxlW2V2ZW50XVxuICAgICAgICAgICAgOiBtb2R1bGUudG9nZ2xlXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKCR0b2dnbGUubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBdHRhY2hpbmcgc2lkZWJhciBldmVudHMgdG8gZWxlbWVudCcsIHNlbGVjdG9yLCBldmVudCk7XG4gICAgICAgICAgICAkdG9nZ2xlXG4gICAgICAgICAgICAgIC5vbignY2xpY2snICsgZXZlbnROYW1lc3BhY2UsIGV2ZW50KVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5ub3RGb3VuZCwgc2VsZWN0b3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzaG93OiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgIGNhbGxiYWNrID0gJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKVxuICAgICAgICAgICAgPyBjYWxsYmFja1xuICAgICAgICAgICAgOiBmdW5jdGlvbigpe31cbiAgICAgICAgICA7XG4gICAgICAgICAgaWYobW9kdWxlLmlzLmhpZGRlbigpKSB7XG4gICAgICAgICAgICBtb2R1bGUucmVmcmVzaFNpZGViYXJzKCk7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5vdmVybGF5KSAge1xuICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3Iub3ZlcmxheSk7XG4gICAgICAgICAgICAgIHNldHRpbmdzLnRyYW5zaXRpb24gPSAnb3ZlcmxheSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUucmVmcmVzaCgpO1xuICAgICAgICAgICAgaWYobW9kdWxlLm90aGVyc0FjdGl2ZSgpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnT3RoZXIgc2lkZWJhcnMgY3VycmVudGx5IHZpc2libGUnKTtcbiAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuZXhjbHVzaXZlKSB7XG4gICAgICAgICAgICAgICAgLy8gaWYgbm90IG92ZXJsYXkgcXVldWUgYW5pbWF0aW9uIGFmdGVyIGhpZGVcbiAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy50cmFuc2l0aW9uICE9ICdvdmVybGF5Jykge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmhpZGVPdGhlcnMobW9kdWxlLnNob3cpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5oaWRlT3RoZXJzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLnRyYW5zaXRpb24gPSAnb3ZlcmxheSc7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5wdXNoUGFnZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbChlbGVtZW50KTtcbiAgICAgICAgICAgICAgc2V0dGluZ3Mub25TaG93LmNhbGwoZWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uQ2hhbmdlLmNhbGwoZWxlbWVudCk7XG4gICAgICAgICAgICBzZXR0aW5ncy5vblZpc2libGUuY2FsbChlbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NpZGViYXIgaXMgYWxyZWFkeSB2aXNpYmxlJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGhpZGU6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgY2FsbGJhY2sgPSAkLmlzRnVuY3Rpb24oY2FsbGJhY2spXG4gICAgICAgICAgICA/IGNhbGxiYWNrXG4gICAgICAgICAgICA6IGZ1bmN0aW9uKCl7fVxuICAgICAgICAgIDtcbiAgICAgICAgICBpZihtb2R1bGUuaXMudmlzaWJsZSgpIHx8IG1vZHVsZS5pcy5hbmltYXRpbmcoKSkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdIaWRpbmcgc2lkZWJhcicsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZWZyZXNoU2lkZWJhcnMoKTtcbiAgICAgICAgICAgIG1vZHVsZS5wdWxsUGFnZShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbChlbGVtZW50KTtcbiAgICAgICAgICAgICAgc2V0dGluZ3Mub25IaWRkZW4uY2FsbChlbGVtZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2V0dGluZ3Mub25DaGFuZ2UuY2FsbChlbGVtZW50KTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uSGlkZS5jYWxsKGVsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvdGhlcnNBbmltYXRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiAoJHNpZGViYXJzLm5vdCgkbW9kdWxlKS5maWx0ZXIoJy4nICsgY2xhc3NOYW1lLmFuaW1hdGluZykubGVuZ3RoID4gMCk7XG4gICAgICAgIH0sXG4gICAgICAgIG90aGVyc1Zpc2libGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiAoJHNpZGViYXJzLm5vdCgkbW9kdWxlKS5maWx0ZXIoJy4nICsgY2xhc3NOYW1lLnZpc2libGUpLmxlbmd0aCA+IDApO1xuICAgICAgICB9LFxuICAgICAgICBvdGhlcnNBY3RpdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybihtb2R1bGUub3RoZXJzVmlzaWJsZSgpIHx8IG1vZHVsZS5vdGhlcnNBbmltYXRpbmcoKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaGlkZU90aGVyczogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgICRvdGhlclNpZGViYXJzID0gJHNpZGViYXJzLm5vdCgkbW9kdWxlKS5maWx0ZXIoJy4nICsgY2xhc3NOYW1lLnZpc2libGUpLFxuICAgICAgICAgICAgc2lkZWJhckNvdW50ICAgPSAkb3RoZXJTaWRlYmFycy5sZW5ndGgsXG4gICAgICAgICAgICBjYWxsYmFja0NvdW50ICA9IDBcbiAgICAgICAgICA7XG4gICAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBmdW5jdGlvbigpe307XG4gICAgICAgICAgJG90aGVyU2lkZWJhcnNcbiAgICAgICAgICAgIC5zaWRlYmFyKCdoaWRlJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGNhbGxiYWNrQ291bnQrKztcbiAgICAgICAgICAgICAgaWYoY2FsbGJhY2tDb3VudCA9PSBzaWRlYmFyQ291bnQpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICB0b2dnbGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXRlcm1pbmluZyB0b2dnbGVkIGRpcmVjdGlvbicpO1xuICAgICAgICAgIGlmKG1vZHVsZS5pcy5oaWRkZW4oKSkge1xuICAgICAgICAgICAgbW9kdWxlLnNob3coKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUuaGlkZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBwdXNoUGFnZTogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIHRyYW5zaXRpb24gPSBtb2R1bGUuZ2V0LnRyYW5zaXRpb24oKSxcbiAgICAgICAgICAgICR0cmFuc2l0aW9uID0gKHRyYW5zaXRpb24gPT09ICdvdmVybGF5JyB8fCBtb2R1bGUub3RoZXJzQWN0aXZlKCkpXG4gICAgICAgICAgICAgID8gJG1vZHVsZVxuICAgICAgICAgICAgICA6ICRwdXNoZXIsXG4gICAgICAgICAgICBhbmltYXRlLFxuICAgICAgICAgICAgZGltLFxuICAgICAgICAgICAgdHJhbnNpdGlvbkVuZFxuICAgICAgICAgIDtcbiAgICAgICAgICBjYWxsYmFjayA9ICQuaXNGdW5jdGlvbihjYWxsYmFjaylcbiAgICAgICAgICAgID8gY2FsbGJhY2tcbiAgICAgICAgICAgIDogZnVuY3Rpb24oKXt9XG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKHNldHRpbmdzLnRyYW5zaXRpb24gPT0gJ3NjYWxlIGRvd24nKSB7XG4gICAgICAgICAgICBtb2R1bGUuc2Nyb2xsVG9Ub3AoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbW9kdWxlLnNldC50cmFuc2l0aW9uKHRyYW5zaXRpb24pO1xuICAgICAgICAgIG1vZHVsZS5yZXBhaW50KCk7XG4gICAgICAgICAgYW5pbWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLmJpbmQuY2xpY2thd2F5KCk7XG4gICAgICAgICAgICBtb2R1bGUuYWRkLmlubGluZUNTUygpO1xuICAgICAgICAgICAgbW9kdWxlLnNldC5hbmltYXRpbmcoKTtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQudmlzaWJsZSgpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgZGltID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LmRpbW1lZCgpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgdHJhbnNpdGlvbkVuZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiggZXZlbnQudGFyZ2V0ID09ICR0cmFuc2l0aW9uWzBdICkge1xuICAgICAgICAgICAgICAkdHJhbnNpdGlvbi5vZmYodHJhbnNpdGlvbkV2ZW50ICsgZWxlbWVudE5hbWVzcGFjZSwgdHJhbnNpdGlvbkVuZCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuYW5pbWF0aW5nKCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5iaW5kLnNjcm9sbExvY2soKTtcbiAgICAgICAgICAgICAgY2FsbGJhY2suY2FsbChlbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICAgICR0cmFuc2l0aW9uLm9mZih0cmFuc2l0aW9uRXZlbnQgKyBlbGVtZW50TmFtZXNwYWNlKTtcbiAgICAgICAgICAkdHJhbnNpdGlvbi5vbih0cmFuc2l0aW9uRXZlbnQgKyBlbGVtZW50TmFtZXNwYWNlLCB0cmFuc2l0aW9uRW5kKTtcbiAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoYW5pbWF0ZSk7XG4gICAgICAgICAgaWYoc2V0dGluZ3MuZGltUGFnZSAmJiAhbW9kdWxlLm90aGVyc1Zpc2libGUoKSkge1xuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGRpbSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHB1bGxQYWdlOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgdHJhbnNpdGlvbiA9IG1vZHVsZS5nZXQudHJhbnNpdGlvbigpLFxuICAgICAgICAgICAgJHRyYW5zaXRpb24gPSAodHJhbnNpdGlvbiA9PSAnb3ZlcmxheScgfHwgbW9kdWxlLm90aGVyc0FjdGl2ZSgpKVxuICAgICAgICAgICAgICA/ICRtb2R1bGVcbiAgICAgICAgICAgICAgOiAkcHVzaGVyLFxuICAgICAgICAgICAgYW5pbWF0ZSxcbiAgICAgICAgICAgIHRyYW5zaXRpb25FbmRcbiAgICAgICAgICA7XG4gICAgICAgICAgY2FsbGJhY2sgPSAkLmlzRnVuY3Rpb24oY2FsbGJhY2spXG4gICAgICAgICAgICA/IGNhbGxiYWNrXG4gICAgICAgICAgICA6IGZ1bmN0aW9uKCl7fVxuICAgICAgICAgIDtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3ZpbmcgY29udGV4dCBwdXNoIHN0YXRlJywgbW9kdWxlLmdldC5kaXJlY3Rpb24oKSk7XG5cbiAgICAgICAgICBtb2R1bGUudW5iaW5kLmNsaWNrYXdheSgpO1xuICAgICAgICAgIG1vZHVsZS51bmJpbmQuc2Nyb2xsTG9jaygpO1xuXG4gICAgICAgICAgYW5pbWF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnNldC50cmFuc2l0aW9uKHRyYW5zaXRpb24pO1xuICAgICAgICAgICAgbW9kdWxlLnNldC5hbmltYXRpbmcoKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUudmlzaWJsZSgpO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuZGltUGFnZSAmJiAhbW9kdWxlLm90aGVyc1Zpc2libGUoKSkge1xuICAgICAgICAgICAgICAkcHVzaGVyLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5kaW1tZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgdHJhbnNpdGlvbkVuZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBpZiggZXZlbnQudGFyZ2V0ID09ICR0cmFuc2l0aW9uWzBdICkge1xuICAgICAgICAgICAgICAkdHJhbnNpdGlvbi5vZmYodHJhbnNpdGlvbkV2ZW50ICsgZWxlbWVudE5hbWVzcGFjZSwgdHJhbnNpdGlvbkVuZCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuYW5pbWF0aW5nKCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUudHJhbnNpdGlvbigpO1xuICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmlubGluZUNTUygpO1xuICAgICAgICAgICAgICBpZih0cmFuc2l0aW9uID09ICdzY2FsZSBkb3duJyB8fCAoc2V0dGluZ3MucmV0dXJuU2Nyb2xsICYmIG1vZHVsZS5pcy5tb2JpbGUoKSkgKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNjcm9sbEJhY2soKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgICAgJHRyYW5zaXRpb24ub2ZmKHRyYW5zaXRpb25FdmVudCArIGVsZW1lbnROYW1lc3BhY2UpO1xuICAgICAgICAgICR0cmFuc2l0aW9uLm9uKHRyYW5zaXRpb25FdmVudCArIGVsZW1lbnROYW1lc3BhY2UsIHRyYW5zaXRpb25FbmQpO1xuICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzY3JvbGxUb1RvcDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1Njcm9sbGluZyB0byB0b3Agb2YgcGFnZSB0byBhdm9pZCBhbmltYXRpb24gaXNzdWVzJyk7XG4gICAgICAgICAgY3VycmVudFNjcm9sbCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTtcbiAgICAgICAgICAkbW9kdWxlLnNjcm9sbFRvcCgwKTtcbiAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2Nyb2xsQmFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1Njcm9sbGluZyBiYWNrIHRvIG9yaWdpbmFsIHBhZ2UgcG9zaXRpb24nKTtcbiAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgY3VycmVudFNjcm9sbCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2xlYXI6IHtcbiAgICAgICAgICBjYWNoZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQ2xlYXJpbmcgY2FjaGVkIGRpbWVuc2lvbnMnKTtcbiAgICAgICAgICAgIG1vZHVsZS5jYWNoZSA9IHt9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXQ6IHtcblxuICAgICAgICAgIC8vIGlvcyBvbmx5IChzY3JvbGwgb24gaHRtbCBub3QgZG9jdW1lbnQpLiBUaGlzIHByZXZlbnQgYXV0by1yZXNpemUgY2FudmFzL3Njcm9sbCBpbiBpb3NcbiAgICAgICAgICAvLyAoVGhpcyBpcyBubyBsb25nZXIgbmVjZXNzYXJ5IGluIGxhdGVzdCBpT1MpXG4gICAgICAgICAgaW9zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRodG1sLmFkZENsYXNzKGNsYXNzTmFtZS5pb3MpO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICAvLyBjb250YWluZXJcbiAgICAgICAgICBwdXNoZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGNvbnRleHQuYWRkQ2xhc3MoY2xhc3NOYW1lLnB1c2hlZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwdXNoYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkY29udGV4dC5hZGRDbGFzcyhjbGFzc05hbWUucHVzaGFibGUpO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICAvLyBwdXNoZXJcbiAgICAgICAgICBkaW1tZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHB1c2hlci5hZGRDbGFzcyhjbGFzc05hbWUuZGltbWVkKTtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgLy8gc2lkZWJhclxuICAgICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLmFkZENsYXNzKGNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYW5pbWF0aW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUuYWRkQ2xhc3MoY2xhc3NOYW1lLmFuaW1hdGluZyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0cmFuc2l0aW9uOiBmdW5jdGlvbih0cmFuc2l0aW9uKSB7XG4gICAgICAgICAgICB0cmFuc2l0aW9uID0gdHJhbnNpdGlvbiB8fCBtb2R1bGUuZ2V0LnRyYW5zaXRpb24oKTtcbiAgICAgICAgICAgICRtb2R1bGUuYWRkQ2xhc3ModHJhbnNpdGlvbik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXJlY3Rpb246IGZ1bmN0aW9uKGRpcmVjdGlvbikge1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gZGlyZWN0aW9uIHx8IG1vZHVsZS5nZXQuZGlyZWN0aW9uKCk7XG4gICAgICAgICAgICAkbW9kdWxlLmFkZENsYXNzKGNsYXNzTmFtZVtkaXJlY3Rpb25dKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZpc2libGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5hZGRDbGFzcyhjbGFzc05hbWUudmlzaWJsZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvdmVybGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUuYWRkQ2xhc3MoY2xhc3NOYW1lLm92ZXJsYXkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcmVtb3ZlOiB7XG5cbiAgICAgICAgICBpbmxpbmVDU1M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZW1vdmluZyBpbmxpbmUgY3NzIHN0eWxlcycsICRzdHlsZSk7XG4gICAgICAgICAgICBpZigkc3R5bGUgJiYgJHN0eWxlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgJHN0eWxlLnJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG5cbiAgICAgICAgICAvLyBpb3Mgc2Nyb2xsIG9uIGh0bWwgbm90IGRvY3VtZW50XG4gICAgICAgICAgaW9zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRodG1sLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5pb3MpO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICAvLyBjb250ZXh0XG4gICAgICAgICAgcHVzaGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRjb250ZXh0LnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5wdXNoZWQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcHVzaGFibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJGNvbnRleHQucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLnB1c2hhYmxlKTtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgLy8gc2lkZWJhclxuICAgICAgICAgIGFjdGl2ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5hY3RpdmUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYW5pbWF0aW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFuaW1hdGluZyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0cmFuc2l0aW9uOiBmdW5jdGlvbih0cmFuc2l0aW9uKSB7XG4gICAgICAgICAgICB0cmFuc2l0aW9uID0gdHJhbnNpdGlvbiB8fCBtb2R1bGUuZ2V0LnRyYW5zaXRpb24oKTtcbiAgICAgICAgICAgICRtb2R1bGUucmVtb3ZlQ2xhc3ModHJhbnNpdGlvbik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXJlY3Rpb246IGZ1bmN0aW9uKGRpcmVjdGlvbikge1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gZGlyZWN0aW9uIHx8IG1vZHVsZS5nZXQuZGlyZWN0aW9uKCk7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZVtkaXJlY3Rpb25dKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZpc2libGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVDbGFzcyhjbGFzc05hbWUudmlzaWJsZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvdmVybGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLm92ZXJsYXkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBnZXQ6IHtcbiAgICAgICAgICBkaXJlY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUudG9wKSkge1xuICAgICAgICAgICAgICByZXR1cm4gY2xhc3NOYW1lLnRvcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUucmlnaHQpKSB7XG4gICAgICAgICAgICAgIHJldHVybiBjbGFzc05hbWUucmlnaHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKCRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLmJvdHRvbSkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGNsYXNzTmFtZS5ib3R0b207XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY2xhc3NOYW1lLmxlZnQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0cmFuc2l0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBtb2R1bGUuZ2V0LmRpcmVjdGlvbigpLFxuICAgICAgICAgICAgICB0cmFuc2l0aW9uXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICB0cmFuc2l0aW9uID0gKCBtb2R1bGUuaXMubW9iaWxlKCkgKVxuICAgICAgICAgICAgICA/IChzZXR0aW5ncy5tb2JpbGVUcmFuc2l0aW9uID09ICdhdXRvJylcbiAgICAgICAgICAgICAgICA/IHNldHRpbmdzLmRlZmF1bHRUcmFuc2l0aW9uLm1vYmlsZVtkaXJlY3Rpb25dXG4gICAgICAgICAgICAgICAgOiBzZXR0aW5ncy5tb2JpbGVUcmFuc2l0aW9uXG4gICAgICAgICAgICAgIDogKHNldHRpbmdzLnRyYW5zaXRpb24gPT0gJ2F1dG8nKVxuICAgICAgICAgICAgICAgID8gc2V0dGluZ3MuZGVmYXVsdFRyYW5zaXRpb24uY29tcHV0ZXJbZGlyZWN0aW9uXVxuICAgICAgICAgICAgICAgIDogc2V0dGluZ3MudHJhbnNpdGlvblxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0RldGVybWluZWQgdHJhbnNpdGlvbicsIHRyYW5zaXRpb24pO1xuICAgICAgICAgICAgcmV0dXJuIHRyYW5zaXRpb247XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0cmFuc2l0aW9uRXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGVsZW1lbnQgICAgID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZWxlbWVudCcpLFxuICAgICAgICAgICAgICB0cmFuc2l0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAndHJhbnNpdGlvbicgICAgICAgOid0cmFuc2l0aW9uZW5kJyxcbiAgICAgICAgICAgICAgICAnT1RyYW5zaXRpb24nICAgICAgOidvVHJhbnNpdGlvbkVuZCcsXG4gICAgICAgICAgICAgICAgJ01velRyYW5zaXRpb24nICAgIDondHJhbnNpdGlvbmVuZCcsXG4gICAgICAgICAgICAgICAgJ1dlYmtpdFRyYW5zaXRpb24nIDond2Via2l0VHJhbnNpdGlvbkVuZCdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdHJhbnNpdGlvblxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgZm9yKHRyYW5zaXRpb24gaW4gdHJhbnNpdGlvbnMpe1xuICAgICAgICAgICAgICBpZiggZWxlbWVudC5zdHlsZVt0cmFuc2l0aW9uXSAhPT0gdW5kZWZpbmVkICl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zaXRpb25zW3RyYW5zaXRpb25dO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGlzOiB7XG5cbiAgICAgICAgICBpZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgaXNJRTExID0gKCEod2luZG93LkFjdGl2ZVhPYmplY3QpICYmICdBY3RpdmVYT2JqZWN0JyBpbiB3aW5kb3cpLFxuICAgICAgICAgICAgICBpc0lFICAgPSAoJ0FjdGl2ZVhPYmplY3QnIGluIHdpbmRvdylcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiAoaXNJRTExIHx8IGlzSUUpO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICBpb3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHVzZXJBZ2VudCAgICAgID0gbmF2aWdhdG9yLnVzZXJBZ2VudCxcbiAgICAgICAgICAgICAgaXNJT1MgICAgICAgICAgPSB1c2VyQWdlbnQubWF0Y2gocmVnRXhwLmlvcyksXG4gICAgICAgICAgICAgIGlzTW9iaWxlQ2hyb21lID0gdXNlckFnZW50Lm1hdGNoKHJlZ0V4cC5tb2JpbGVDaHJvbWUpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihpc0lPUyAmJiAhaXNNb2JpbGVDaHJvbWUpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0Jyb3dzZXIgd2FzIGZvdW5kIHRvIGJlIGlPUycsIHVzZXJBZ2VudCk7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG1vYmlsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdXNlckFnZW50ICAgID0gbmF2aWdhdG9yLnVzZXJBZ2VudCxcbiAgICAgICAgICAgICAgaXNNb2JpbGUgICAgID0gdXNlckFnZW50Lm1hdGNoKHJlZ0V4cC5tb2JpbGUpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihpc01vYmlsZSkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQnJvd3NlciB3YXMgZm91bmQgdG8gYmUgbW9iaWxlJywgdXNlckFnZW50KTtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0Jyb3dzZXIgaXMgbm90IG1vYmlsZSwgdXNpbmcgcmVndWxhciB0cmFuc2l0aW9uJywgdXNlckFnZW50KTtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgaGlkZGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAhbW9kdWxlLmlzLnZpc2libGUoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZpc2libGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLnZpc2libGUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8gYWxpYXNcbiAgICAgICAgICBvcGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGUuaXMudmlzaWJsZSgpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY2xvc2VkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGUuaXMuaGlkZGVuKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB2ZXJ0aWNhbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUudG9wKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFuaW1hdGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJGNvbnRleHQuaGFzQ2xhc3MoY2xhc3NOYW1lLmFuaW1hdGluZyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBydGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5jYWNoZS5ydGwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBtb2R1bGUuY2FjaGUucnRsID0gKCRtb2R1bGUuY3NzKCdkaXJlY3Rpb24nKSA9PSAncnRsJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLmNhY2hlLnJ0bDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dGluZzogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NoYW5naW5nIHNldHRpbmcnLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZigkLmlzUGxhaW5PYmplY3Qoc2V0dGluZ3NbbmFtZV0pKSB7XG4gICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzW25hbWVdLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3NbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZ3NbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnRlcm5hbDogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgbW9kdWxlLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBtb2R1bGVbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZGVidWc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1Zy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdmVyYm9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCAmJiBzZXR0aW5ncy52ZXJib3NlICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCkge1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmVycm9yLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvci5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGVyZm9ybWFuY2U6IHtcbiAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjdXJyZW50VGltZSxcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSxcbiAgICAgICAgICAgICAgcHJldmlvdXNUaW1lXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBjdXJyZW50VGltZSAgID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZSAgPSB0aW1lIHx8IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICBleGVjdXRpb25UaW1lID0gY3VycmVudFRpbWUgLSBwcmV2aW91c1RpbWU7XG4gICAgICAgICAgICAgIHRpbWUgICAgICAgICAgPSBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgcGVyZm9ybWFuY2UucHVzaCh7XG4gICAgICAgICAgICAgICAgJ05hbWUnICAgICAgICAgICA6IG1lc3NhZ2VbMF0sXG4gICAgICAgICAgICAgICAgJ0FyZ3VtZW50cycgICAgICA6IFtdLnNsaWNlLmNhbGwobWVzc2FnZSwgMSkgfHwgJycsXG4gICAgICAgICAgICAgICAgJ0VsZW1lbnQnICAgICAgICA6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgJ0V4ZWN1dGlvbiBUaW1lJyA6IGV4ZWN1dGlvblRpbWVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lciA9IHNldFRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLmRpc3BsYXksIDUwMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNwbGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB0aXRsZSA9IHNldHRpbmdzLm5hbWUgKyAnOicsXG4gICAgICAgICAgICAgIHRvdGFsVGltZSA9IDBcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHRpbWUgPSBmYWxzZTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICB0b3RhbFRpbWUgKz0gZGF0YVsnRXhlY3V0aW9uIFRpbWUnXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGl0bGUgKz0gJyAnICsgdG90YWxUaW1lICsgJ21zJztcbiAgICAgICAgICAgIGlmKG1vZHVsZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgIHRpdGxlICs9ICcgXFwnJyArIG1vZHVsZVNlbGVjdG9yICsgJ1xcJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggKGNvbnNvbGUuZ3JvdXAgIT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLnRhYmxlICE9PSB1bmRlZmluZWQpICYmIHBlcmZvcm1hbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgICAgIGlmKGNvbnNvbGUudGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKHBlcmZvcm1hbmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZXJmb3JtYW5jZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm1ldGhvZCwgcXVlcnkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCBmb3VuZCApICkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZC5hcHBseShjb250ZXh0LCBwYXNzZWRBcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGZvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCQuaXNBcnJheShyZXR1cm5lZFZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZS5wdXNoKHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSBbcmV0dXJuZWRWYWx1ZSwgcmVzcG9uc2VdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSByZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgO1xuXG4gICAgaWYobWV0aG9kSW52b2tlZCkge1xuICAgICAgaWYoaW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgfVxuICAgICAgbW9kdWxlLmludm9rZShxdWVyeSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYoaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBtb2R1bGUuaW52b2tlKCdkZXN0cm95Jyk7XG4gICAgICB9XG4gICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIChyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpXG4gICAgPyByZXR1cm5lZFZhbHVlXG4gICAgOiB0aGlzXG4gIDtcbn07XG5cbiQuZm4uc2lkZWJhci5zZXR0aW5ncyA9IHtcblxuICBuYW1lICAgICAgICAgICAgICA6ICdTaWRlYmFyJyxcbiAgbmFtZXNwYWNlICAgICAgICAgOiAnc2lkZWJhcicsXG5cbiAgc2lsZW50ICAgICAgICAgICAgOiBmYWxzZSxcbiAgZGVidWcgICAgICAgICAgICAgOiBmYWxzZSxcbiAgdmVyYm9zZSAgICAgICAgICAgOiBmYWxzZSxcbiAgcGVyZm9ybWFuY2UgICAgICAgOiB0cnVlLFxuXG4gIHRyYW5zaXRpb24gICAgICAgIDogJ2F1dG8nLFxuICBtb2JpbGVUcmFuc2l0aW9uICA6ICdhdXRvJyxcblxuICBkZWZhdWx0VHJhbnNpdGlvbiA6IHtcbiAgICBjb21wdXRlcjoge1xuICAgICAgbGVmdCAgIDogJ3VuY292ZXInLFxuICAgICAgcmlnaHQgIDogJ3VuY292ZXInLFxuICAgICAgdG9wICAgIDogJ292ZXJsYXknLFxuICAgICAgYm90dG9tIDogJ292ZXJsYXknXG4gICAgfSxcbiAgICBtb2JpbGU6IHtcbiAgICAgIGxlZnQgICA6ICd1bmNvdmVyJyxcbiAgICAgIHJpZ2h0ICA6ICd1bmNvdmVyJyxcbiAgICAgIHRvcCAgICA6ICdvdmVybGF5JyxcbiAgICAgIGJvdHRvbSA6ICdvdmVybGF5J1xuICAgIH1cbiAgfSxcblxuICBjb250ZXh0ICAgICAgICAgICA6ICdib2R5JyxcbiAgZXhjbHVzaXZlICAgICAgICAgOiBmYWxzZSxcbiAgY2xvc2FibGUgICAgICAgICAgOiB0cnVlLFxuICBkaW1QYWdlICAgICAgICAgICA6IHRydWUsXG4gIHNjcm9sbExvY2sgICAgICAgIDogZmFsc2UsXG4gIHJldHVyblNjcm9sbCAgICAgIDogZmFsc2UsXG4gIGRlbGF5U2V0dXAgICAgICAgIDogZmFsc2UsXG5cbiAgZHVyYXRpb24gICAgICAgICAgOiA1MDAsXG5cbiAgb25DaGFuZ2UgICAgICAgICAgOiBmdW5jdGlvbigpe30sXG4gIG9uU2hvdyAgICAgICAgICAgIDogZnVuY3Rpb24oKXt9LFxuICBvbkhpZGUgICAgICAgICAgICA6IGZ1bmN0aW9uKCl7fSxcblxuICBvbkhpZGRlbiAgICAgICAgICA6IGZ1bmN0aW9uKCl7fSxcbiAgb25WaXNpYmxlICAgICAgICAgOiBmdW5jdGlvbigpe30sXG5cbiAgY2xhc3NOYW1lICAgICAgICAgOiB7XG4gICAgYWN0aXZlICAgIDogJ2FjdGl2ZScsXG4gICAgYW5pbWF0aW5nIDogJ2FuaW1hdGluZycsXG4gICAgZGltbWVkICAgIDogJ2RpbW1lZCcsXG4gICAgaW9zICAgICAgIDogJ2lvcycsXG4gICAgcHVzaGFibGUgIDogJ3B1c2hhYmxlJyxcbiAgICBwdXNoZWQgICAgOiAncHVzaGVkJyxcbiAgICByaWdodCAgICAgOiAncmlnaHQnLFxuICAgIHRvcCAgICAgICA6ICd0b3AnLFxuICAgIGxlZnQgICAgICA6ICdsZWZ0JyxcbiAgICBib3R0b20gICAgOiAnYm90dG9tJyxcbiAgICB2aXNpYmxlICAgOiAndmlzaWJsZSdcbiAgfSxcblxuICBzZWxlY3Rvcjoge1xuICAgIGZpeGVkICAgOiAnLmZpeGVkJyxcbiAgICBvbWl0dGVkIDogJ3NjcmlwdCwgbGluaywgc3R5bGUsIC51aS5tb2RhbCwgLnVpLmRpbW1lciwgLnVpLm5hZywgLnVpLmZpeGVkJyxcbiAgICBwdXNoZXIgIDogJy5wdXNoZXInLFxuICAgIHNpZGViYXIgOiAnLnVpLnNpZGViYXInXG4gIH0sXG5cbiAgcmVnRXhwOiB7XG4gICAgaW9zICAgICAgICAgIDogLyhpUGFkfGlQaG9uZXxpUG9kKS9nLFxuICAgIG1vYmlsZUNocm9tZSA6IC8oQ3JpT1MpL2csXG4gICAgbW9iaWxlICAgICAgIDogL01vYmlsZXxpUChob25lfG9kfGFkKXxBbmRyb2lkfEJsYWNrQmVycnl8SUVNb2JpbGV8S2luZGxlfE5ldEZyb250fFNpbGstQWNjZWxlcmF0ZWR8KGhwd3x3ZWIpT1N8RmVubmVjfE1pbmltb3xPcGVyYSBNKG9iaXxpbmkpfEJsYXplcnxEb2xmaW58RG9scGhpbnxTa3lmaXJlfFp1bmUvZ1xuICB9LFxuXG4gIGVycm9yICAgOiB7XG4gICAgbWV0aG9kICAgICAgIDogJ1RoZSBtZXRob2QgeW91IGNhbGxlZCBpcyBub3QgZGVmaW5lZC4nLFxuICAgIHB1c2hlciAgICAgICA6ICdIYWQgdG8gYWRkIHB1c2hlciBlbGVtZW50LiBGb3Igb3B0aW1hbCBwZXJmb3JtYW5jZSBtYWtlIHN1cmUgYm9keSBjb250ZW50IGlzIGluc2lkZSBhIHB1c2hlciBlbGVtZW50JyxcbiAgICBtb3ZlZFNpZGViYXIgOiAnSGFkIHRvIG1vdmUgc2lkZWJhci4gRm9yIG9wdGltYWwgcGVyZm9ybWFuY2UgbWFrZSBzdXJlIHNpZGViYXIgYW5kIHB1c2hlciBhcmUgZGlyZWN0IGNoaWxkcmVuIG9mIHlvdXIgYm9keSB0YWcnLFxuICAgIG92ZXJsYXkgICAgICA6ICdUaGUgb3ZlcmxheSBzZXR0aW5nIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQsIHVzZSBhbmltYXRpb246IG92ZXJsYXknLFxuICAgIG5vdEZvdW5kICAgICA6ICdUaGVyZSB3ZXJlIG5vIGVsZW1lbnRzIHRoYXQgbWF0Y2hlZCB0aGUgc3BlY2lmaWVkIHNlbGVjdG9yJ1xuICB9XG5cbn07XG5cblxufSkoIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCApO1xuXG4vKiFcbiAqICMgU2VtYW50aWMgVUkgMi40LjAgLSBTdGlja3lcbiAqIGh0dHA6Ly9naXRodWIuY29tL3NlbWFudGljLW9yZy9zZW1hbnRpYy11aS9cbiAqXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG5cbjsoZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG4ndXNlIHN0cmljdCc7XG5cbndpbmRvdyA9ICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGgpXG4gID8gd2luZG93XG4gIDogKHR5cGVvZiBzZWxmICE9ICd1bmRlZmluZWQnICYmIHNlbGYuTWF0aCA9PSBNYXRoKVxuICAgID8gc2VsZlxuICAgIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKVxuO1xuXG4kLmZuLnN0aWNreSA9IGZ1bmN0aW9uKHBhcmFtZXRlcnMpIHtcbiAgdmFyXG4gICAgJGFsbE1vZHVsZXMgICAgPSAkKHRoaXMpLFxuICAgIG1vZHVsZVNlbGVjdG9yID0gJGFsbE1vZHVsZXMuc2VsZWN0b3IgfHwgJycsXG5cbiAgICB0aW1lICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgID0gW10sXG5cbiAgICBxdWVyeSAgICAgICAgICA9IGFyZ3VtZW50c1swXSxcbiAgICBtZXRob2RJbnZva2VkICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLFxuICAgIHJldHVybmVkVmFsdWVcbiAgO1xuXG4gICRhbGxNb2R1bGVzXG4gICAgLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXJcbiAgICAgICAgc2V0dGluZ3MgICAgICAgICAgICAgID0gKCAkLmlzUGxhaW5PYmplY3QocGFyYW1ldGVycykgKVxuICAgICAgICAgID8gJC5leHRlbmQodHJ1ZSwge30sICQuZm4uc3RpY2t5LnNldHRpbmdzLCBwYXJhbWV0ZXJzKVxuICAgICAgICAgIDogJC5leHRlbmQoe30sICQuZm4uc3RpY2t5LnNldHRpbmdzKSxcblxuICAgICAgICBjbGFzc05hbWUgICAgICAgICAgICAgPSBzZXR0aW5ncy5jbGFzc05hbWUsXG4gICAgICAgIG5hbWVzcGFjZSAgICAgICAgICAgICA9IHNldHRpbmdzLm5hbWVzcGFjZSxcbiAgICAgICAgZXJyb3IgICAgICAgICAgICAgICAgID0gc2V0dGluZ3MuZXJyb3IsXG5cbiAgICAgICAgZXZlbnROYW1lc3BhY2UgICAgICAgID0gJy4nICsgbmFtZXNwYWNlLFxuICAgICAgICBtb2R1bGVOYW1lc3BhY2UgICAgICAgPSAnbW9kdWxlLScgKyBuYW1lc3BhY2UsXG5cbiAgICAgICAgJG1vZHVsZSAgICAgICAgICAgICAgID0gJCh0aGlzKSxcbiAgICAgICAgJHdpbmRvdyAgICAgICAgICAgICAgID0gJCh3aW5kb3cpLFxuICAgICAgICAkc2Nyb2xsICAgICAgICAgICAgICAgPSAkKHNldHRpbmdzLnNjcm9sbENvbnRleHQpLFxuICAgICAgICAkY29udGFpbmVyLFxuICAgICAgICAkY29udGV4dCxcblxuICAgICAgICBzZWxlY3RvciAgICAgICAgICAgICAgPSAkbW9kdWxlLnNlbGVjdG9yIHx8ICcnLFxuICAgICAgICBpbnN0YW5jZSAgICAgICAgICAgICAgPSAkbW9kdWxlLmRhdGEobW9kdWxlTmFtZXNwYWNlKSxcblxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lXG4gICAgICAgICAgfHwgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAgICAgIHx8IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgICAgICB8fCB3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgICAgICB8fCBmdW5jdGlvbihjYWxsYmFjaykgeyBzZXRUaW1lb3V0KGNhbGxiYWNrLCAwKTsgfSxcblxuICAgICAgICBlbGVtZW50ICAgICAgICAgPSB0aGlzLFxuXG4gICAgICAgIGRvY3VtZW50T2JzZXJ2ZXIsXG4gICAgICAgIG9ic2VydmVyLFxuICAgICAgICBtb2R1bGVcbiAgICAgIDtcblxuICAgICAgbW9kdWxlICAgICAgPSB7XG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICBtb2R1bGUuZGV0ZXJtaW5lQ29udGFpbmVyKCk7XG4gICAgICAgICAgbW9kdWxlLmRldGVybWluZUNvbnRleHQoKTtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnSW5pdGlhbGl6aW5nIHN0aWNreScsIHNldHRpbmdzLCAkY29udGFpbmVyKTtcblxuICAgICAgICAgIG1vZHVsZS5zYXZlLnBvc2l0aW9ucygpO1xuICAgICAgICAgIG1vZHVsZS5jaGVja0Vycm9ycygpO1xuICAgICAgICAgIG1vZHVsZS5iaW5kLmV2ZW50cygpO1xuXG4gICAgICAgICAgaWYoc2V0dGluZ3Mub2JzZXJ2ZUNoYW5nZXMpIHtcbiAgICAgICAgICAgIG1vZHVsZS5vYnNlcnZlQ2hhbmdlcygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuaW5zdGFudGlhdGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbnN0YW50aWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1N0b3JpbmcgaW5zdGFuY2Ugb2YgbW9kdWxlJywgbW9kdWxlKTtcbiAgICAgICAgICBpbnN0YW5jZSA9IG1vZHVsZTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAuZGF0YShtb2R1bGVOYW1lc3BhY2UsIG1vZHVsZSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0Rlc3Ryb3lpbmcgcHJldmlvdXMgaW5zdGFuY2UnKTtcbiAgICAgICAgICBtb2R1bGUucmVzZXQoKTtcbiAgICAgICAgICBpZihkb2N1bWVudE9ic2VydmVyKSB7XG4gICAgICAgICAgICBkb2N1bWVudE9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYob2JzZXJ2ZXIpIHtcbiAgICAgICAgICAgIG9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgJHdpbmRvd1xuICAgICAgICAgICAgLm9mZignbG9hZCcgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LmxvYWQpXG4gICAgICAgICAgICAub2ZmKCdyZXNpemUnICsgZXZlbnROYW1lc3BhY2UsIG1vZHVsZS5ldmVudC5yZXNpemUpXG4gICAgICAgICAgO1xuICAgICAgICAgICRzY3JvbGxcbiAgICAgICAgICAgIC5vZmYoJ3Njcm9sbGNoYW5nZScgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LnNjcm9sbGNoYW5nZSlcbiAgICAgICAgICA7XG4gICAgICAgICAgJG1vZHVsZS5yZW1vdmVEYXRhKG1vZHVsZU5hbWVzcGFjZSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgb2JzZXJ2ZUNoYW5nZXM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCdNdXRhdGlvbk9ic2VydmVyJyBpbiB3aW5kb3cpIHtcbiAgICAgICAgICAgIGRvY3VtZW50T2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihtb2R1bGUuZXZlbnQuZG9jdW1lbnRDaGFuZ2VkKTtcbiAgICAgICAgICAgIG9ic2VydmVyICAgICAgICAgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihtb2R1bGUuZXZlbnQuY2hhbmdlZCk7XG4gICAgICAgICAgICBkb2N1bWVudE9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQsIHtcbiAgICAgICAgICAgICAgY2hpbGRMaXN0IDogdHJ1ZSxcbiAgICAgICAgICAgICAgc3VidHJlZSAgIDogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGVsZW1lbnQsIHtcbiAgICAgICAgICAgICAgY2hpbGRMaXN0IDogdHJ1ZSxcbiAgICAgICAgICAgICAgc3VidHJlZSAgIDogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKCRjb250ZXh0WzBdLCB7XG4gICAgICAgICAgICAgIGNoaWxkTGlzdCA6IHRydWUsXG4gICAgICAgICAgICAgIHN1YnRyZWUgICA6IHRydWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZXR0aW5nIHVwIG11dGF0aW9uIG9ic2VydmVyJywgb2JzZXJ2ZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBkZXRlcm1pbmVDb250YWluZXI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKHNldHRpbmdzLmNvbnRhaW5lcikge1xuICAgICAgICAgICAgJGNvbnRhaW5lciA9ICQoc2V0dGluZ3MuY29udGFpbmVyKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkY29udGFpbmVyID0gJG1vZHVsZS5vZmZzZXRQYXJlbnQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGV0ZXJtaW5lQ29udGV4dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoc2V0dGluZ3MuY29udGV4dCkge1xuICAgICAgICAgICAgJGNvbnRleHQgPSAkKHNldHRpbmdzLmNvbnRleHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICRjb250ZXh0ID0gJGNvbnRhaW5lcjtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoJGNvbnRleHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IuaW52YWxpZENvbnRleHQsIHNldHRpbmdzLmNvbnRleHQsICRtb2R1bGUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjaGVja0Vycm9yczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIG1vZHVsZS5pcy5oaWRkZW4oKSApIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci52aXNpYmxlLCAkbW9kdWxlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYobW9kdWxlLmNhY2hlLmVsZW1lbnQuaGVpZ2h0ID4gbW9kdWxlLmNhY2hlLmNvbnRleHQuaGVpZ2h0KSB7XG4gICAgICAgICAgICBtb2R1bGUucmVzZXQoKTtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5lbGVtZW50U2l6ZSwgJG1vZHVsZSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGJpbmQ6IHtcbiAgICAgICAgICBldmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHdpbmRvd1xuICAgICAgICAgICAgICAub24oJ2xvYWQnICsgZXZlbnROYW1lc3BhY2UsIG1vZHVsZS5ldmVudC5sb2FkKVxuICAgICAgICAgICAgICAub24oJ3Jlc2l6ZScgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LnJlc2l6ZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIC8vIHB1Yi9zdWIgcGF0dGVyblxuICAgICAgICAgICAgJHNjcm9sbFxuICAgICAgICAgICAgICAub2ZmKCdzY3JvbGwnICsgZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgICAgIC5vbignc2Nyb2xsJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuc2Nyb2xsKVxuICAgICAgICAgICAgICAub24oJ3Njcm9sbGNoYW5nZScgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LnNjcm9sbGNoYW5nZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXZlbnQ6IHtcbiAgICAgICAgICBjaGFuZ2VkOiBmdW5jdGlvbihtdXRhdGlvbnMpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUudGltZXIpO1xuICAgICAgICAgICAgbW9kdWxlLnRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0RPTSB0cmVlIG1vZGlmaWVkLCB1cGRhdGluZyBzdGlja3kgbWVudScsIG11dGF0aW9ucyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZWZyZXNoKCk7XG4gICAgICAgICAgICB9LCAxMDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZG9jdW1lbnRDaGFuZ2VkOiBmdW5jdGlvbihtdXRhdGlvbnMpIHtcbiAgICAgICAgICAgIFtdLmZvckVhY2guY2FsbChtdXRhdGlvbnMsIGZ1bmN0aW9uKG11dGF0aW9uKSB7XG4gICAgICAgICAgICAgIGlmKG11dGF0aW9uLnJlbW92ZWROb2Rlcykge1xuICAgICAgICAgICAgICAgIFtdLmZvckVhY2guY2FsbChtdXRhdGlvbi5yZW1vdmVkTm9kZXMsIGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgICAgICAgICAgIGlmKG5vZGUgPT0gZWxlbWVudCB8fCAkKG5vZGUpLmZpbmQoZWxlbWVudCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0VsZW1lbnQgcmVtb3ZlZCBmcm9tIERPTSwgdGVhcmluZyBkb3duIGV2ZW50cycpO1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuZGVzdHJveSgpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGxvYWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1BhZ2UgY29udGVudHMgZmluaXNoZWQgbG9hZGluZycpO1xuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKG1vZHVsZS5yZWZyZXNoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlc2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnV2luZG93IHJlc2l6ZWQnKTtcbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShtb2R1bGUucmVmcmVzaCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzY3JvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAkc2Nyb2xsLnRyaWdnZXJIYW5kbGVyKCdzY3JvbGxjaGFuZ2UnICsgZXZlbnROYW1lc3BhY2UsICRzY3JvbGwuc2Nyb2xsVG9wKCkgKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2Nyb2xsY2hhbmdlOiBmdW5jdGlvbihldmVudCwgc2Nyb2xsUG9zaXRpb24pIHtcbiAgICAgICAgICAgIG1vZHVsZS5zdGljayhzY3JvbGxQb3NpdGlvbik7XG4gICAgICAgICAgICBzZXR0aW5ncy5vblNjcm9sbC5jYWxsKGVsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZWZyZXNoOiBmdW5jdGlvbihoYXJkUmVmcmVzaCkge1xuICAgICAgICAgIG1vZHVsZS5yZXNldCgpO1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5jb250ZXh0KSB7XG4gICAgICAgICAgICBtb2R1bGUuZGV0ZXJtaW5lQ29udGV4dCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihoYXJkUmVmcmVzaCkge1xuICAgICAgICAgICAgbW9kdWxlLmRldGVybWluZUNvbnRhaW5lcigpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuc2F2ZS5wb3NpdGlvbnMoKTtcbiAgICAgICAgICBtb2R1bGUuc3RpY2soKTtcbiAgICAgICAgICBzZXR0aW5ncy5vblJlcG9zaXRpb24uY2FsbChlbGVtZW50KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzdXBwb3J0czoge1xuICAgICAgICAgIHN0aWNreTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJGVsZW1lbnQgPSAkKCc8ZGl2Lz4nKSxcbiAgICAgICAgICAgICAgZWxlbWVudCA9ICRlbGVtZW50WzBdXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAkZWxlbWVudC5hZGRDbGFzcyhjbGFzc05hbWUuc3VwcG9ydGVkKTtcbiAgICAgICAgICAgIHJldHVybigkZWxlbWVudC5jc3MoJ3Bvc2l0aW9uJykubWF0Y2goJ3N0aWNreScpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2F2ZToge1xuICAgICAgICAgIGxhc3RTY3JvbGw6IGZ1bmN0aW9uKHNjcm9sbCkge1xuICAgICAgICAgICAgbW9kdWxlLmxhc3RTY3JvbGwgPSBzY3JvbGw7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlbGVtZW50U2Nyb2xsOiBmdW5jdGlvbihzY3JvbGwpIHtcbiAgICAgICAgICAgIG1vZHVsZS5lbGVtZW50U2Nyb2xsID0gc2Nyb2xsO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcG9zaXRpb25zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBzY3JvbGxDb250ZXh0ID0ge1xuICAgICAgICAgICAgICAgIGhlaWdodCA6ICRzY3JvbGwuaGVpZ2h0KClcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZWxlbWVudCA9IHtcbiAgICAgICAgICAgICAgICBtYXJnaW46IHtcbiAgICAgICAgICAgICAgICAgIHRvcCAgICA6IHBhcnNlSW50KCRtb2R1bGUuY3NzKCdtYXJnaW4tdG9wJyksIDEwKSxcbiAgICAgICAgICAgICAgICAgIGJvdHRvbSA6IHBhcnNlSW50KCRtb2R1bGUuY3NzKCdtYXJnaW4tYm90dG9tJyksIDEwKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIG9mZnNldCA6ICRtb2R1bGUub2Zmc2V0KCksXG4gICAgICAgICAgICAgICAgd2lkdGggIDogJG1vZHVsZS5vdXRlcldpZHRoKCksXG4gICAgICAgICAgICAgICAgaGVpZ2h0IDogJG1vZHVsZS5vdXRlckhlaWdodCgpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGNvbnRleHQgPSB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0IDogJGNvbnRleHQub2Zmc2V0KCksXG4gICAgICAgICAgICAgICAgaGVpZ2h0IDogJGNvbnRleHQub3V0ZXJIZWlnaHQoKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBjb250YWluZXIgPSB7XG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAkY29udGFpbmVyLm91dGVySGVpZ2h0KClcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoICFtb2R1bGUuaXMuc3RhbmRhcmRTY3JvbGwoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdOb24tc3RhbmRhcmQgc2Nyb2xsLiBSZW1vdmluZyBzY3JvbGwgb2Zmc2V0IGZyb20gZWxlbWVudCBvZmZzZXQnKTtcblxuICAgICAgICAgICAgICBzY3JvbGxDb250ZXh0LnRvcCAgPSAkc2Nyb2xsLnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgICBzY3JvbGxDb250ZXh0LmxlZnQgPSAkc2Nyb2xsLnNjcm9sbExlZnQoKTtcblxuICAgICAgICAgICAgICBlbGVtZW50Lm9mZnNldC50b3AgICs9IHNjcm9sbENvbnRleHQudG9wO1xuICAgICAgICAgICAgICBjb250ZXh0Lm9mZnNldC50b3AgICs9IHNjcm9sbENvbnRleHQudG9wO1xuICAgICAgICAgICAgICBlbGVtZW50Lm9mZnNldC5sZWZ0ICs9IHNjcm9sbENvbnRleHQubGVmdDtcbiAgICAgICAgICAgICAgY29udGV4dC5vZmZzZXQubGVmdCArPSBzY3JvbGxDb250ZXh0LmxlZnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuY2FjaGUgPSB7XG4gICAgICAgICAgICAgIGZpdHMgICAgICAgICAgOiAoIChlbGVtZW50LmhlaWdodCArIHNldHRpbmdzLm9mZnNldCkgPD0gc2Nyb2xsQ29udGV4dC5oZWlnaHQpLFxuICAgICAgICAgICAgICBzYW1lSGVpZ2h0ICAgIDogKGVsZW1lbnQuaGVpZ2h0ID09IGNvbnRleHQuaGVpZ2h0KSxcbiAgICAgICAgICAgICAgc2Nyb2xsQ29udGV4dCA6IHtcbiAgICAgICAgICAgICAgICBoZWlnaHQgOiBzY3JvbGxDb250ZXh0LmhlaWdodFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBlbGVtZW50OiB7XG4gICAgICAgICAgICAgICAgbWFyZ2luIDogZWxlbWVudC5tYXJnaW4sXG4gICAgICAgICAgICAgICAgdG9wICAgIDogZWxlbWVudC5vZmZzZXQudG9wIC0gZWxlbWVudC5tYXJnaW4udG9wLFxuICAgICAgICAgICAgICAgIGxlZnQgICA6IGVsZW1lbnQub2Zmc2V0LmxlZnQsXG4gICAgICAgICAgICAgICAgd2lkdGggIDogZWxlbWVudC53aWR0aCxcbiAgICAgICAgICAgICAgICBoZWlnaHQgOiBlbGVtZW50LmhlaWdodCxcbiAgICAgICAgICAgICAgICBib3R0b20gOiBlbGVtZW50Lm9mZnNldC50b3AgKyBlbGVtZW50LmhlaWdodFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICAgICAgdG9wICAgICAgICAgICA6IGNvbnRleHQub2Zmc2V0LnRvcCxcbiAgICAgICAgICAgICAgICBoZWlnaHQgICAgICAgIDogY29udGV4dC5oZWlnaHQsXG4gICAgICAgICAgICAgICAgYm90dG9tICAgICAgICA6IGNvbnRleHQub2Zmc2V0LnRvcCArIGNvbnRleHQuaGVpZ2h0XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBtb2R1bGUuc2V0LmNvbnRhaW5lclNpemUoKTtcblxuICAgICAgICAgICAgbW9kdWxlLnN0aWNrKCk7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NhY2hpbmcgZWxlbWVudCBwb3NpdGlvbnMnLCBtb2R1bGUuY2FjaGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBnZXQ6IHtcbiAgICAgICAgICBkaXJlY3Rpb246IGZ1bmN0aW9uKHNjcm9sbCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGRpcmVjdGlvbiA9ICdkb3duJ1xuICAgICAgICAgICAgO1xuICAgICAgICAgICAgc2Nyb2xsID0gc2Nyb2xsIHx8ICRzY3JvbGwuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICBpZihtb2R1bGUubGFzdFNjcm9sbCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIGlmKG1vZHVsZS5sYXN0U2Nyb2xsIDwgc2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uID0gJ2Rvd24nO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYobW9kdWxlLmxhc3RTY3JvbGwgPiBzY3JvbGwpIHtcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSAndXAnO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZGlyZWN0aW9uO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2Nyb2xsQ2hhbmdlOiBmdW5jdGlvbihzY3JvbGwpIHtcbiAgICAgICAgICAgIHNjcm9sbCA9IHNjcm9sbCB8fCAkc2Nyb2xsLnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgcmV0dXJuIChtb2R1bGUubGFzdFNjcm9sbClcbiAgICAgICAgICAgICAgPyAoc2Nyb2xsIC0gbW9kdWxlLmxhc3RTY3JvbGwpXG4gICAgICAgICAgICAgIDogMFxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgY3VycmVudEVsZW1lbnRTY3JvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmVsZW1lbnRTY3JvbGwpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS5lbGVtZW50U2Nyb2xsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICggbW9kdWxlLmlzLnRvcCgpIClcbiAgICAgICAgICAgICAgPyBNYXRoLmFicyhwYXJzZUludCgkbW9kdWxlLmNzcygndG9wJyksIDEwKSkgICAgfHwgMFxuICAgICAgICAgICAgICA6IE1hdGguYWJzKHBhcnNlSW50KCRtb2R1bGUuY3NzKCdib3R0b20nKSwgMTApKSB8fCAwXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcblxuICAgICAgICAgIGVsZW1lbnRTY3JvbGw6IGZ1bmN0aW9uKHNjcm9sbCkge1xuICAgICAgICAgICAgc2Nyb2xsID0gc2Nyb2xsIHx8ICRzY3JvbGwuc2Nyb2xsVG9wKCk7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZWxlbWVudCAgICAgICAgPSBtb2R1bGUuY2FjaGUuZWxlbWVudCxcbiAgICAgICAgICAgICAgc2Nyb2xsQ29udGV4dCAgPSBtb2R1bGUuY2FjaGUuc2Nyb2xsQ29udGV4dCxcbiAgICAgICAgICAgICAgZGVsdGEgICAgICAgICAgPSBtb2R1bGUuZ2V0LnNjcm9sbENoYW5nZShzY3JvbGwpLFxuICAgICAgICAgICAgICBtYXhTY3JvbGwgICAgICA9IChlbGVtZW50LmhlaWdodCAtIHNjcm9sbENvbnRleHQuaGVpZ2h0ICsgc2V0dGluZ3Mub2Zmc2V0KSxcbiAgICAgICAgICAgICAgZWxlbWVudFNjcm9sbCAgPSBtb2R1bGUuZ2V0LmN1cnJlbnRFbGVtZW50U2Nyb2xsKCksXG4gICAgICAgICAgICAgIHBvc3NpYmxlU2Nyb2xsID0gKGVsZW1lbnRTY3JvbGwgKyBkZWx0YSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5jYWNoZS5maXRzIHx8IHBvc3NpYmxlU2Nyb2xsIDwgMCkge1xuICAgICAgICAgICAgICBlbGVtZW50U2Nyb2xsID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYocG9zc2libGVTY3JvbGwgPiBtYXhTY3JvbGwgKSB7XG4gICAgICAgICAgICAgIGVsZW1lbnRTY3JvbGwgPSBtYXhTY3JvbGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgZWxlbWVudFNjcm9sbCA9IHBvc3NpYmxlU2Nyb2xsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRTY3JvbGw7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZToge1xuICAgICAgICAgIGxhc3RTY3JvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZGVsZXRlIG1vZHVsZS5sYXN0U2Nyb2xsO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZWxlbWVudFNjcm9sbDogZnVuY3Rpb24oc2Nyb2xsKSB7XG4gICAgICAgICAgICBkZWxldGUgbW9kdWxlLmVsZW1lbnRTY3JvbGw7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtaW5pbXVtU2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkY29udGFpbmVyXG4gICAgICAgICAgICAgIC5jc3MoJ21pbi1oZWlnaHQnLCAnJylcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9mZnNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLmNzcygnbWFyZ2luLXRvcCcsICcnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiB7XG4gICAgICAgICAgb2Zmc2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTZXR0aW5nIG9mZnNldCBvbiBlbGVtZW50Jywgc2V0dGluZ3Mub2Zmc2V0KTtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLmNzcygnbWFyZ2luLXRvcCcsIHNldHRpbmdzLm9mZnNldClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbnRhaW5lclNpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHRhZ05hbWUgPSAkY29udGFpbmVyLmdldCgwKS50YWdOYW1lXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZih0YWdOYW1lID09PSAnSFRNTCcgfHwgdGFnTmFtZSA9PSAnYm9keScpIHtcbiAgICAgICAgICAgICAgLy8gdGhpcyBjYW4gdHJpZ2dlciBmb3IgdG9vIG1hbnkgcmVhc29uc1xuICAgICAgICAgICAgICAvL21vZHVsZS5lcnJvcihlcnJvci5jb250YWluZXIsIHRhZ05hbWUsICRtb2R1bGUpO1xuICAgICAgICAgICAgICBtb2R1bGUuZGV0ZXJtaW5lQ29udGFpbmVyKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgaWYoIE1hdGguYWJzKCRjb250YWluZXIub3V0ZXJIZWlnaHQoKSAtIG1vZHVsZS5jYWNoZS5jb250ZXh0LmhlaWdodCkgPiBzZXR0aW5ncy5qaXR0ZXIpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NvbnRleHQgaGFzIHBhZGRpbmcsIHNwZWNpZnlpbmcgZXhhY3QgaGVpZ2h0IGZvciBjb250YWluZXInLCBtb2R1bGUuY2FjaGUuY29udGV4dC5oZWlnaHQpO1xuICAgICAgICAgICAgICAgICRjb250YWluZXIuY3NzKHtcbiAgICAgICAgICAgICAgICAgIGhlaWdodDogbW9kdWxlLmNhY2hlLmNvbnRleHQuaGVpZ2h0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG1pbmltdW1TaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBlbGVtZW50ICAgPSBtb2R1bGUuY2FjaGUuZWxlbWVudFxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgJGNvbnRhaW5lclxuICAgICAgICAgICAgICAuY3NzKCdtaW4taGVpZ2h0JywgZWxlbWVudC5oZWlnaHQpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzY3JvbGw6IGZ1bmN0aW9uKHNjcm9sbCkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZXR0aW5nIHNjcm9sbCBvbiBlbGVtZW50Jywgc2Nyb2xsKTtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5lbGVtZW50U2Nyb2xsID09IHNjcm9sbCkge1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggbW9kdWxlLmlzLnRvcCgpICkge1xuICAgICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgICAgLmNzcygnYm90dG9tJywgJycpXG4gICAgICAgICAgICAgICAgLmNzcygndG9wJywgLXNjcm9sbClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5ib3R0b20oKSApIHtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5jc3MoJ3RvcCcsICcnKVxuICAgICAgICAgICAgICAgIC5jc3MoJ2JvdHRvbScsIHNjcm9sbClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihtb2R1bGUuY2FjaGUuZWxlbWVudC5oZWlnaHQgIT09IDAgJiYgbW9kdWxlLmNhY2hlLmVsZW1lbnQud2lkdGggIT09IDApIHtcbiAgICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnd2lkdGgnLCAgbW9kdWxlLmNhY2hlLmVsZW1lbnQud2lkdGggICsgJ3B4JywgJ2ltcG9ydGFudCcpO1xuICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KCdoZWlnaHQnLCBtb2R1bGUuY2FjaGUuZWxlbWVudC5oZWlnaHQgKyAncHgnLCAnaW1wb3J0YW50Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGlzOiB7XG4gICAgICAgICAgc3RhbmRhcmRTY3JvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICgkc2Nyb2xsWzBdID09IHdpbmRvdyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0b3A6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLnRvcCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBib3R0b206IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLmJvdHRvbSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbml0aWFsUG9zaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICghbW9kdWxlLmlzLmZpeGVkKCkgJiYgIW1vZHVsZS5pcy5ib3VuZCgpKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhpZGRlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKCEkbW9kdWxlLmlzKCc6dmlzaWJsZScpKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJvdW5kOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkbW9kdWxlLmhhc0NsYXNzKGNsYXNzTmFtZS5ib3VuZCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmaXhlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUuZml4ZWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzdGljazogZnVuY3Rpb24oc2Nyb2xsKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBjYWNoZWRQb3NpdGlvbiA9IHNjcm9sbCB8fCAkc2Nyb2xsLnNjcm9sbFRvcCgpLFxuICAgICAgICAgICAgY2FjaGUgICAgICAgICAgPSBtb2R1bGUuY2FjaGUsXG4gICAgICAgICAgICBmaXRzICAgICAgICAgICA9IGNhY2hlLmZpdHMsXG4gICAgICAgICAgICBzYW1lSGVpZ2h0ICAgICA9IGNhY2hlLnNhbWVIZWlnaHQsXG4gICAgICAgICAgICBlbGVtZW50ICAgICAgICA9IGNhY2hlLmVsZW1lbnQsXG4gICAgICAgICAgICBzY3JvbGxDb250ZXh0ICA9IGNhY2hlLnNjcm9sbENvbnRleHQsXG4gICAgICAgICAgICBjb250ZXh0ICAgICAgICA9IGNhY2hlLmNvbnRleHQsXG4gICAgICAgICAgICBvZmZzZXQgICAgICAgICA9IChtb2R1bGUuaXMuYm90dG9tKCkgJiYgc2V0dGluZ3MucHVzaGluZylcbiAgICAgICAgICAgICAgPyBzZXR0aW5ncy5ib3R0b21PZmZzZXRcbiAgICAgICAgICAgICAgOiBzZXR0aW5ncy5vZmZzZXQsXG4gICAgICAgICAgICBzY3JvbGwgICAgICAgICA9IHtcbiAgICAgICAgICAgICAgdG9wICAgIDogY2FjaGVkUG9zaXRpb24gKyBvZmZzZXQsXG4gICAgICAgICAgICAgIGJvdHRvbSA6IGNhY2hlZFBvc2l0aW9uICsgb2Zmc2V0ICsgc2Nyb2xsQ29udGV4dC5oZWlnaHRcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkaXJlY3Rpb24gICAgICA9IG1vZHVsZS5nZXQuZGlyZWN0aW9uKHNjcm9sbC50b3ApLFxuICAgICAgICAgICAgZWxlbWVudFNjcm9sbCAgPSAoZml0cylcbiAgICAgICAgICAgICAgPyAwXG4gICAgICAgICAgICAgIDogbW9kdWxlLmdldC5lbGVtZW50U2Nyb2xsKHNjcm9sbC50b3ApLFxuXG4gICAgICAgICAgICAvLyBzaG9ydGhhbmRcbiAgICAgICAgICAgIGRvZXNudEZpdCAgICAgID0gIWZpdHMsXG4gICAgICAgICAgICBlbGVtZW50VmlzaWJsZSA9IChlbGVtZW50LmhlaWdodCAhPT0gMClcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYoZWxlbWVudFZpc2libGUgJiYgIXNhbWVIZWlnaHQpIHtcblxuICAgICAgICAgICAgaWYoIG1vZHVsZS5pcy5pbml0aWFsUG9zaXRpb24oKSApIHtcbiAgICAgICAgICAgICAgaWYoc2Nyb2xsLnRvcCA+PSBjb250ZXh0LmJvdHRvbSkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW5pdGlhbCBlbGVtZW50IHBvc2l0aW9uIGlzIGJvdHRvbSBvZiBjb250YWluZXInKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuYmluZEJvdHRvbSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoc2Nyb2xsLnRvcCA+IGVsZW1lbnQudG9wKSB7XG4gICAgICAgICAgICAgICAgaWYoIChlbGVtZW50LmhlaWdodCArIHNjcm9sbC50b3AgLSBlbGVtZW50U2Nyb2xsKSA+PSBjb250ZXh0LmJvdHRvbSApIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW5pdGlhbCBlbGVtZW50IHBvc2l0aW9uIGlzIGJvdHRvbSBvZiBjb250YWluZXInKTtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5iaW5kQm90dG9tKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdJbml0aWFsIGVsZW1lbnQgcG9zaXRpb24gaXMgZml4ZWQnKTtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5maXhUb3AoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiggbW9kdWxlLmlzLmZpeGVkKCkgKSB7XG5cbiAgICAgICAgICAgICAgLy8gY3VycmVudGx5IGZpeGVkIHRvcFxuICAgICAgICAgICAgICBpZiggbW9kdWxlLmlzLnRvcCgpICkge1xuICAgICAgICAgICAgICAgIGlmKCBzY3JvbGwudG9wIDw9IGVsZW1lbnQudG9wICkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdGaXhlZCBlbGVtZW50IHJlYWNoZWQgdG9wIG9mIGNvbnRhaW5lcicpO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldEluaXRpYWxQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmKCAoZWxlbWVudC5oZWlnaHQgKyBzY3JvbGwudG9wIC0gZWxlbWVudFNjcm9sbCkgPj0gY29udGV4dC5ib3R0b20gKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0ZpeGVkIGVsZW1lbnQgcmVhY2hlZCBib3R0b20gb2YgY29udGFpbmVyJyk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuYmluZEJvdHRvbSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBzY3JvbGwgZWxlbWVudCBpZiBsYXJnZXIgdGhhbiBzY3JlZW5cbiAgICAgICAgICAgICAgICBlbHNlIGlmKGRvZXNudEZpdCkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zY3JvbGwoZWxlbWVudFNjcm9sbCk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuc2F2ZS5sYXN0U2Nyb2xsKHNjcm9sbC50b3ApO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnNhdmUuZWxlbWVudFNjcm9sbChlbGVtZW50U2Nyb2xsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAvLyBjdXJyZW50bHkgZml4ZWQgYm90dG9tXG4gICAgICAgICAgICAgIGVsc2UgaWYobW9kdWxlLmlzLmJvdHRvbSgpICkge1xuXG4gICAgICAgICAgICAgICAgLy8gdG9wIGVkZ2VcbiAgICAgICAgICAgICAgICBpZiggKHNjcm9sbC5ib3R0b20gLSBlbGVtZW50LmhlaWdodCkgPD0gZWxlbWVudC50b3ApIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQm90dG9tIGZpeGVkIHJhaWwgaGFzIHJlYWNoZWQgdG9wIG9mIGNvbnRhaW5lcicpO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldEluaXRpYWxQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBib3R0b20gZWRnZVxuICAgICAgICAgICAgICAgIGVsc2UgaWYoc2Nyb2xsLmJvdHRvbSA+PSBjb250ZXh0LmJvdHRvbSkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdCb3R0b20gZml4ZWQgcmFpbCBoYXMgcmVhY2hlZCBib3R0b20gb2YgY29udGFpbmVyJyk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuYmluZEJvdHRvbSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBzY3JvbGwgZWxlbWVudCBpZiBsYXJnZXIgdGhhbiBzY3JlZW5cbiAgICAgICAgICAgICAgICBlbHNlIGlmKGRvZXNudEZpdCkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnNldC5zY3JvbGwoZWxlbWVudFNjcm9sbCk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuc2F2ZS5sYXN0U2Nyb2xsKHNjcm9sbC50b3ApO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnNhdmUuZWxlbWVudFNjcm9sbChlbGVtZW50U2Nyb2xsKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiggbW9kdWxlLmlzLmJvdHRvbSgpICkge1xuICAgICAgICAgICAgICBpZiggc2Nyb2xsLnRvcCA8PSBlbGVtZW50LnRvcCApIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0p1bXBlZCBmcm9tIGJvdHRvbSBmaXhlZCB0byB0b3AgZml4ZWQsIG1vc3QgbGlrZWx5IHVzZWQgaG9tZS9lbmQgYnV0dG9uJyk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnNldEluaXRpYWxQb3NpdGlvbigpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLnB1c2hpbmcpIHtcbiAgICAgICAgICAgICAgICAgIGlmKG1vZHVsZS5pcy5ib3VuZCgpICYmIHNjcm9sbC5ib3R0b20gPD0gY29udGV4dC5ib3R0b20gKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRml4aW5nIGJvdHRvbSBhdHRhY2hlZCBlbGVtZW50IHRvIGJvdHRvbSBvZiBicm93c2VyLicpO1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuZml4Qm90dG9tKCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgaWYobW9kdWxlLmlzLmJvdW5kKCkgJiYgKHNjcm9sbC50b3AgPD0gY29udGV4dC5ib3R0b20gLSBlbGVtZW50LmhlaWdodCkgKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRml4aW5nIGJvdHRvbSBhdHRhY2hlZCBlbGVtZW50IHRvIHRvcCBvZiBicm93c2VyLicpO1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuZml4VG9wKCk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGJpbmRUb3A6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQmluZGluZyBlbGVtZW50IHRvIHRvcCBvZiBwYXJlbnQgY29udGFpbmVyJyk7XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS5vZmZzZXQoKTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgbGVmdCAgICAgICAgIDogJycsXG4gICAgICAgICAgICAgIHRvcCAgICAgICAgICA6ICcnLFxuICAgICAgICAgICAgICBtYXJnaW5Cb3R0b20gOiAnJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuZml4ZWQpXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmJvdHRvbSlcbiAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYm91bmQpXG4gICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLnRvcClcbiAgICAgICAgICA7XG4gICAgICAgICAgc2V0dGluZ3Mub25Ub3AuY2FsbChlbGVtZW50KTtcbiAgICAgICAgICBzZXR0aW5ncy5vblVuc3RpY2suY2FsbChlbGVtZW50KTtcbiAgICAgICAgfSxcbiAgICAgICAgYmluZEJvdHRvbTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdCaW5kaW5nIGVsZW1lbnQgdG8gYm90dG9tIG9mIHBhcmVudCBjb250YWluZXInKTtcbiAgICAgICAgICBtb2R1bGUucmVtb3ZlLm9mZnNldCgpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICBsZWZ0ICAgICAgICAgOiAnJyxcbiAgICAgICAgICAgICAgdG9wICAgICAgICAgIDogJydcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmZpeGVkKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS50b3ApXG4gICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLmJvdW5kKVxuICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5ib3R0b20pXG4gICAgICAgICAgO1xuICAgICAgICAgIHNldHRpbmdzLm9uQm90dG9tLmNhbGwoZWxlbWVudCk7XG4gICAgICAgICAgc2V0dGluZ3Mub25VbnN0aWNrLmNhbGwoZWxlbWVudCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0SW5pdGlhbFBvc2l0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JldHVybmluZyB0byBpbml0aWFsIHBvc2l0aW9uJyk7XG4gICAgICAgICAgbW9kdWxlLnVuZml4KCk7XG4gICAgICAgICAgbW9kdWxlLnVuYmluZCgpO1xuICAgICAgICB9LFxuXG5cbiAgICAgICAgZml4VG9wOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0ZpeGluZyBlbGVtZW50IHRvIHRvcCBvZiBwYWdlJyk7XG4gICAgICAgICAgaWYoc2V0dGluZ3Muc2V0U2l6ZSkge1xuICAgICAgICAgICAgbW9kdWxlLnNldC5zaXplKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG1vZHVsZS5zZXQubWluaW11bVNpemUoKTtcbiAgICAgICAgICBtb2R1bGUuc2V0Lm9mZnNldCgpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICBsZWZ0ICAgICAgICAgOiBtb2R1bGUuY2FjaGUuZWxlbWVudC5sZWZ0LFxuICAgICAgICAgICAgICBib3R0b20gICAgICAgOiAnJyxcbiAgICAgICAgICAgICAgbWFyZ2luQm90dG9tIDogJydcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmJvdW5kKVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5ib3R0b20pXG4gICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLmZpeGVkKVxuICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS50b3ApXG4gICAgICAgICAgO1xuICAgICAgICAgIHNldHRpbmdzLm9uU3RpY2suY2FsbChlbGVtZW50KTtcbiAgICAgICAgfSxcblxuICAgICAgICBmaXhCb3R0b206IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU3RpY2tpbmcgZWxlbWVudCB0byBib3R0b20gb2YgcGFnZScpO1xuICAgICAgICAgIGlmKHNldHRpbmdzLnNldFNpemUpIHtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQuc2l6ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuc2V0Lm1pbmltdW1TaXplKCk7XG4gICAgICAgICAgbW9kdWxlLnNldC5vZmZzZXQoKTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgbGVmdCAgICAgICAgIDogbW9kdWxlLmNhY2hlLmVsZW1lbnQubGVmdCxcbiAgICAgICAgICAgICAgYm90dG9tICAgICAgIDogJycsXG4gICAgICAgICAgICAgIG1hcmdpbkJvdHRvbSA6ICcnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5ib3VuZClcbiAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUudG9wKVxuICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5maXhlZClcbiAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuYm90dG9tKVxuICAgICAgICAgIDtcbiAgICAgICAgICBzZXR0aW5ncy5vblN0aWNrLmNhbGwoZWxlbWVudCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdW5iaW5kOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiggbW9kdWxlLmlzLmJvdW5kKCkgKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JlbW92aW5nIGNvbnRhaW5lciBib3VuZCBwb3NpdGlvbiBvbiBlbGVtZW50Jyk7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLm9mZnNldCgpO1xuICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmJvdW5kKVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLnRvcClcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5ib3R0b20pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVuZml4OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiggbW9kdWxlLmlzLmZpeGVkKCkgKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JlbW92aW5nIGZpeGVkIHBvc2l0aW9uIG9uIGVsZW1lbnQnKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUubWluaW11bVNpemUoKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUub2Zmc2V0KCk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuZml4ZWQpXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUudG9wKVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmJvdHRvbSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uVW5zdGljay5jYWxsKGVsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZXNldHRpbmcgZWxlbWVudHMgcG9zaXRpb24nKTtcbiAgICAgICAgICBtb2R1bGUudW5iaW5kKCk7XG4gICAgICAgICAgbW9kdWxlLnVuZml4KCk7XG4gICAgICAgICAgbW9kdWxlLnJlc2V0Q1NTKCk7XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS5vZmZzZXQoKTtcbiAgICAgICAgICBtb2R1bGUucmVtb3ZlLmxhc3RTY3JvbGwoKTtcbiAgICAgICAgfSxcblxuICAgICAgICByZXNldENTUzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgIHdpZHRoICA6ICcnLFxuICAgICAgICAgICAgICBoZWlnaHQgOiAnJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICA7XG4gICAgICAgICAgJGNvbnRhaW5lclxuICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgIGhlaWdodDogJydcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldHRpbmc6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBzZXR0aW5nc1tuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5nc1tuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGludGVybmFsOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBtb2R1bGUsIG5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG1vZHVsZVtuYW1lXSA9IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGVbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBkZWJ1ZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZyA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5pbmZvLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB2ZXJib3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLnZlcmJvc2UgJiYgc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5pbmZvLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50KSB7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuZXJyb3IsIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBwZXJmb3JtYW5jZToge1xuICAgICAgICAgIGxvZzogZnVuY3Rpb24obWVzc2FnZSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGN1cnJlbnRUaW1lLFxuICAgICAgICAgICAgICBleGVjdXRpb25UaW1lLFxuICAgICAgICAgICAgICBwcmV2aW91c1RpbWVcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRUaW1lICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgcHJldmlvdXNUaW1lICA9IHRpbWUgfHwgY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUgPSBjdXJyZW50VGltZSAtIHByZXZpb3VzVGltZTtcbiAgICAgICAgICAgICAgdGltZSAgICAgICAgICA9IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICBwZXJmb3JtYW5jZS5wdXNoKHtcbiAgICAgICAgICAgICAgICAnTmFtZScgICAgICAgICAgIDogbWVzc2FnZVswXSxcbiAgICAgICAgICAgICAgICAnQXJndW1lbnRzJyAgICAgIDogW10uc2xpY2UuY2FsbChtZXNzYWdlLCAxKSB8fCAnJyxcbiAgICAgICAgICAgICAgICAnRWxlbWVudCcgICAgICAgIDogZWxlbWVudCxcbiAgICAgICAgICAgICAgICAnRXhlY3V0aW9uIFRpbWUnIDogZXhlY3V0aW9uVGltZVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyID0gc2V0VGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UuZGlzcGxheSwgMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNwbGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB0aXRsZSA9IHNldHRpbmdzLm5hbWUgKyAnOicsXG4gICAgICAgICAgICAgIHRvdGFsVGltZSA9IDBcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHRpbWUgPSBmYWxzZTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICB0b3RhbFRpbWUgKz0gZGF0YVsnRXhlY3V0aW9uIFRpbWUnXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGl0bGUgKz0gJyAnICsgdG90YWxUaW1lICsgJ21zJztcbiAgICAgICAgICAgIGlmKG1vZHVsZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgIHRpdGxlICs9ICcgXFwnJyArIG1vZHVsZVNlbGVjdG9yICsgJ1xcJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggKGNvbnNvbGUuZ3JvdXAgIT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLnRhYmxlICE9PSB1bmRlZmluZWQpICYmIHBlcmZvcm1hbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgICAgIGlmKGNvbnNvbGUudGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKHBlcmZvcm1hbmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZXJmb3JtYW5jZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCAkLmlzRnVuY3Rpb24oIGZvdW5kICkgKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGZvdW5kLmFwcGx5KGNvbnRleHQsIHBhc3NlZEFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoZm91bmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoJC5pc0FycmF5KHJldHVybmVkVmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlLnB1c2gocmVzcG9uc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IFtyZXR1cm5lZFZhbHVlLCByZXNwb25zZV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYocmVzcG9uc2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZSA9IHJlc3BvbnNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZm91bmQ7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGlmKG1ldGhvZEludm9rZWQpIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICAgIH1cbiAgICAgICAgbW9kdWxlLmludm9rZShxdWVyeSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGluc3RhbmNlLmludm9rZSgnZGVzdHJveScpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICB9XG4gICAgfSlcbiAgO1xuXG4gIHJldHVybiAocmV0dXJuZWRWYWx1ZSAhPT0gdW5kZWZpbmVkKVxuICAgID8gcmV0dXJuZWRWYWx1ZVxuICAgIDogdGhpc1xuICA7XG59O1xuXG4kLmZuLnN0aWNreS5zZXR0aW5ncyA9IHtcblxuICBuYW1lICAgICAgICAgICA6ICdTdGlja3knLFxuICBuYW1lc3BhY2UgICAgICA6ICdzdGlja3knLFxuXG4gIHNpbGVudCAgICAgICAgIDogZmFsc2UsXG4gIGRlYnVnICAgICAgICAgIDogZmFsc2UsXG4gIHZlcmJvc2UgICAgICAgIDogdHJ1ZSxcbiAgcGVyZm9ybWFuY2UgICAgOiB0cnVlLFxuXG4gIC8vIHdoZXRoZXIgdG8gc3RpY2sgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiBvbiBzY3JvbGwgdXBcbiAgcHVzaGluZyAgICAgICAgOiBmYWxzZSxcblxuICBjb250ZXh0ICAgICAgICA6IGZhbHNlLFxuICBjb250YWluZXIgICAgICA6IGZhbHNlLFxuXG4gIC8vIENvbnRleHQgdG8gd2F0Y2ggc2Nyb2xsIGV2ZW50c1xuICBzY3JvbGxDb250ZXh0ICA6IHdpbmRvdyxcblxuICAvLyBPZmZzZXQgdG8gYWRqdXN0IHNjcm9sbFxuICBvZmZzZXQgICAgICAgICA6IDAsXG5cbiAgLy8gT2Zmc2V0IHRvIGFkanVzdCBzY3JvbGwgd2hlbiBhdHRhY2hlZCB0byBib3R0b20gb2Ygc2NyZWVuXG4gIGJvdHRvbU9mZnNldCAgIDogMCxcblxuICAvLyB3aWxsIG9ubHkgc2V0IGNvbnRhaW5lciBoZWlnaHQgaWYgZGlmZmVyZW5jZSBiZXR3ZWVuIGNvbnRleHQgYW5kIGNvbnRhaW5lciBpcyBsYXJnZXIgdGhhbiB0aGlzIG51bWJlclxuICBqaXR0ZXIgICAgICAgICA6IDUsXG5cbiAgLy8gc2V0IHdpZHRoIG9mIHN0aWNreSBlbGVtZW50IHdoZW4gaXQgaXMgZml4ZWQgdG8gcGFnZSAodXNlZCB0byBtYWtlIHN1cmUgMTAwJSB3aWR0aCBpcyBtYWludGFpbmVkIGlmIG5vIGZpeGVkIHNpemUgc2V0KVxuICBzZXRTaXplICAgICAgICA6IHRydWUsXG5cbiAgLy8gV2hldGhlciB0byBhdXRvbWF0aWNhbGx5IG9ic2VydmUgY2hhbmdlcyB3aXRoIE11dGF0aW9uIE9ic2VydmVyc1xuICBvYnNlcnZlQ2hhbmdlcyA6IGZhbHNlLFxuXG4gIC8vIENhbGxlZCB3aGVuIHBvc2l0aW9uIGlzIHJlY2FsY3VsYXRlZFxuICBvblJlcG9zaXRpb24gICA6IGZ1bmN0aW9uKCl7fSxcblxuICAvLyBDYWxsZWQgb24gZWFjaCBzY3JvbGxcbiAgb25TY3JvbGwgICAgICAgOiBmdW5jdGlvbigpe30sXG5cbiAgLy8gQ2FsbGVkIHdoZW4gZWxlbWVudCBpcyBzdHVjayB0byB2aWV3cG9ydFxuICBvblN0aWNrICAgICAgICA6IGZ1bmN0aW9uKCl7fSxcblxuICAvLyBDYWxsZWQgd2hlbiBlbGVtZW50IGlzIHVuc3R1Y2sgZnJvbSB2aWV3cG9ydFxuICBvblVuc3RpY2sgICAgICA6IGZ1bmN0aW9uKCl7fSxcblxuICAvLyBDYWxsZWQgd2hlbiBlbGVtZW50IHJlYWNoZXMgdG9wIG9mIGNvbnRleHRcbiAgb25Ub3AgICAgICAgICAgOiBmdW5jdGlvbigpe30sXG5cbiAgLy8gQ2FsbGVkIHdoZW4gZWxlbWVudCByZWFjaGVzIGJvdHRvbSBvZiBjb250ZXh0XG4gIG9uQm90dG9tICAgICAgIDogZnVuY3Rpb24oKXt9LFxuXG4gIGVycm9yICAgICAgICAgOiB7XG4gICAgY29udGFpbmVyICAgICAgOiAnU3RpY2t5IGVsZW1lbnQgbXVzdCBiZSBpbnNpZGUgYSByZWxhdGl2ZSBjb250YWluZXInLFxuICAgIHZpc2libGUgICAgICAgIDogJ0VsZW1lbnQgaXMgaGlkZGVuLCB5b3UgbXVzdCBjYWxsIHJlZnJlc2ggYWZ0ZXIgZWxlbWVudCBiZWNvbWVzIHZpc2libGUuIFVzZSBzaWxlbnQgc2V0dGluZyB0byBzdXJwcmVzcyB0aGlzIHdhcm5pbmcgaW4gcHJvZHVjdGlvbi4nLFxuICAgIG1ldGhvZCAgICAgICAgIDogJ1RoZSBtZXRob2QgeW91IGNhbGxlZCBpcyBub3QgZGVmaW5lZC4nLFxuICAgIGludmFsaWRDb250ZXh0IDogJ0NvbnRleHQgc3BlY2lmaWVkIGRvZXMgbm90IGV4aXN0JyxcbiAgICBlbGVtZW50U2l6ZSAgICA6ICdTdGlja3kgZWxlbWVudCBpcyBsYXJnZXIgdGhhbiBpdHMgY29udGFpbmVyLCBjYW5ub3QgY3JlYXRlIHN0aWNreS4nXG4gIH0sXG5cbiAgY2xhc3NOYW1lIDoge1xuICAgIGJvdW5kICAgICA6ICdib3VuZCcsXG4gICAgZml4ZWQgICAgIDogJ2ZpeGVkJyxcbiAgICBzdXBwb3J0ZWQgOiAnbmF0aXZlJyxcbiAgICB0b3AgICAgICAgOiAndG9wJyxcbiAgICBib3R0b20gICAgOiAnYm90dG9tJ1xuICB9XG5cbn07XG5cbn0pKCBqUXVlcnksIHdpbmRvdywgZG9jdW1lbnQgKTtcblxuLyohXG4gKiAjIFNlbWFudGljIFVJIDIuNC4wIC0gVGFiXG4gKiBodHRwOi8vZ2l0aHViLmNvbS9zZW1hbnRpYy1vcmcvc2VtYW50aWMtdWkvXG4gKlxuICpcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuICpcbiAqL1xuXG47KGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHtcblxuJ3VzZSBzdHJpY3QnO1xuXG53aW5kb3cgPSAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoKVxuICA/IHdpbmRvd1xuICA6ICh0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aClcbiAgICA/IHNlbGZcbiAgICA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKClcbjtcblxuJC5mbi50YWIgPSBmdW5jdGlvbihwYXJhbWV0ZXJzKSB7XG5cbiAgdmFyXG4gICAgLy8gdXNlIHdpbmRvdyBjb250ZXh0IGlmIG5vbmUgc3BlY2lmaWVkXG4gICAgJGFsbE1vZHVsZXMgICAgID0gJC5pc0Z1bmN0aW9uKHRoaXMpXG4gICAgICAgID8gJCh3aW5kb3cpXG4gICAgICAgIDogJCh0aGlzKSxcblxuICAgIG1vZHVsZVNlbGVjdG9yICA9ICRhbGxNb2R1bGVzLnNlbGVjdG9yIHx8ICcnLFxuICAgIHRpbWUgICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgICA9IFtdLFxuXG4gICAgcXVlcnkgICAgICAgICAgID0gYXJndW1lbnRzWzBdLFxuICAgIG1ldGhvZEludm9rZWQgICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzICA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcblxuICAgIGluaXRpYWxpemVkSGlzdG9yeSA9IGZhbHNlLFxuICAgIHJldHVybmVkVmFsdWVcbiAgO1xuXG4gICRhbGxNb2R1bGVzXG4gICAgLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICB2YXJcblxuICAgICAgICBzZXR0aW5ncyAgICAgICAgPSAoICQuaXNQbGFpbk9iamVjdChwYXJhbWV0ZXJzKSApXG4gICAgICAgICAgPyAkLmV4dGVuZCh0cnVlLCB7fSwgJC5mbi50YWIuc2V0dGluZ3MsIHBhcmFtZXRlcnMpXG4gICAgICAgICAgOiAkLmV4dGVuZCh7fSwgJC5mbi50YWIuc2V0dGluZ3MpLFxuXG4gICAgICAgIGNsYXNzTmFtZSAgICAgICA9IHNldHRpbmdzLmNsYXNzTmFtZSxcbiAgICAgICAgbWV0YWRhdGEgICAgICAgID0gc2V0dGluZ3MubWV0YWRhdGEsXG4gICAgICAgIHNlbGVjdG9yICAgICAgICA9IHNldHRpbmdzLnNlbGVjdG9yLFxuICAgICAgICBlcnJvciAgICAgICAgICAgPSBzZXR0aW5ncy5lcnJvcixcblxuICAgICAgICBldmVudE5hbWVzcGFjZSAgPSAnLicgKyBzZXR0aW5ncy5uYW1lc3BhY2UsXG4gICAgICAgIG1vZHVsZU5hbWVzcGFjZSA9ICdtb2R1bGUtJyArIHNldHRpbmdzLm5hbWVzcGFjZSxcblxuICAgICAgICAkbW9kdWxlICAgICAgICAgPSAkKHRoaXMpLFxuICAgICAgICAkY29udGV4dCxcbiAgICAgICAgJHRhYnMsXG5cbiAgICAgICAgY2FjaGUgICAgICAgICAgID0ge30sXG4gICAgICAgIGZpcnN0TG9hZCAgICAgICA9IHRydWUsXG4gICAgICAgIHJlY3Vyc2lvbkRlcHRoICA9IDAsXG4gICAgICAgIGVsZW1lbnQgICAgICAgICA9IHRoaXMsXG4gICAgICAgIGluc3RhbmNlICAgICAgICA9ICRtb2R1bGUuZGF0YShtb2R1bGVOYW1lc3BhY2UpLFxuXG4gICAgICAgIGFjdGl2ZVRhYlBhdGgsXG4gICAgICAgIHBhcmFtZXRlckFycmF5LFxuICAgICAgICBtb2R1bGUsXG5cbiAgICAgICAgaGlzdG9yeUV2ZW50XG5cbiAgICAgIDtcblxuICAgICAgbW9kdWxlID0ge1xuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW5pdGlhbGl6aW5nIHRhYiBtZW51IGl0ZW0nLCAkbW9kdWxlKTtcbiAgICAgICAgICBtb2R1bGUuZml4LmNhbGxiYWNrcygpO1xuICAgICAgICAgIG1vZHVsZS5kZXRlcm1pbmVUYWJzKCk7XG5cbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0RldGVybWluaW5nIHRhYnMnLCBzZXR0aW5ncy5jb250ZXh0LCAkdGFicyk7XG4gICAgICAgICAgLy8gc2V0IHVwIGF1dG9tYXRpYyByb3V0aW5nXG4gICAgICAgICAgaWYoc2V0dGluZ3MuYXV0bykge1xuICAgICAgICAgICAgbW9kdWxlLnNldC5hdXRvKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG1vZHVsZS5iaW5kLmV2ZW50cygpO1xuXG4gICAgICAgICAgaWYoc2V0dGluZ3MuaGlzdG9yeSAmJiAhaW5pdGlhbGl6ZWRIaXN0b3J5KSB7XG4gICAgICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZUhpc3RvcnkoKTtcbiAgICAgICAgICAgIGluaXRpYWxpemVkSGlzdG9yeSA9IHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbW9kdWxlLmluc3RhbnRpYXRlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5zdGFudGlhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU3RvcmluZyBpbnN0YW5jZSBvZiBtb2R1bGUnLCBtb2R1bGUpO1xuICAgICAgICAgIGluc3RhbmNlID0gbW9kdWxlO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5kYXRhKG1vZHVsZU5hbWVzcGFjZSwgbW9kdWxlKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0Rlc3Ryb3lpbmcgdGFicycsICRtb2R1bGUpO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5yZW1vdmVEYXRhKG1vZHVsZU5hbWVzcGFjZSlcbiAgICAgICAgICAgIC5vZmYoZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGJpbmQ6IHtcbiAgICAgICAgICBldmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gaWYgdXNpbmcgJC50YWIgZG9uJ3QgYWRkIGV2ZW50c1xuICAgICAgICAgICAgaWYoICEkLmlzV2luZG93KCBlbGVtZW50ICkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQXR0YWNoaW5nIHRhYiBhY3RpdmF0aW9uIGV2ZW50cyB0byBlbGVtZW50JywgJG1vZHVsZSk7XG4gICAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgICAub24oJ2NsaWNrJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuY2xpY2spXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGV0ZXJtaW5lVGFiczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICAkcmVmZXJlbmNlXG4gICAgICAgICAgO1xuXG4gICAgICAgICAgLy8gZGV0ZXJtaW5lIHRhYiBjb250ZXh0XG4gICAgICAgICAgaWYoc2V0dGluZ3MuY29udGV4dCA9PT0gJ3BhcmVudCcpIHtcbiAgICAgICAgICAgIGlmKCRtb2R1bGUuY2xvc2VzdChzZWxlY3Rvci51aSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAkcmVmZXJlbmNlID0gJG1vZHVsZS5jbG9zZXN0KHNlbGVjdG9yLnVpKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1VzaW5nIGNsb3Nlc3QgVUkgZWxlbWVudCBhcyBwYXJlbnQnLCAkcmVmZXJlbmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAkcmVmZXJlbmNlID0gJG1vZHVsZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRjb250ZXh0ID0gJHJlZmVyZW5jZS5wYXJlbnQoKTtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXRlcm1pbmVkIHBhcmVudCBlbGVtZW50IGZvciBjcmVhdGluZyBjb250ZXh0JywgJGNvbnRleHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHNldHRpbmdzLmNvbnRleHQpIHtcbiAgICAgICAgICAgICRjb250ZXh0ID0gJChzZXR0aW5ncy5jb250ZXh0KTtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdVc2luZyBzZWxlY3RvciBmb3IgdGFiIGNvbnRleHQnLCBzZXR0aW5ncy5jb250ZXh0LCAkY29udGV4dCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJGNvbnRleHQgPSAkKCdib2R5Jyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIGZpbmQgdGFic1xuICAgICAgICAgIGlmKHNldHRpbmdzLmNoaWxkcmVuT25seSkge1xuICAgICAgICAgICAgJHRhYnMgPSAkY29udGV4dC5jaGlsZHJlbihzZWxlY3Rvci50YWJzKTtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2VhcmNoaW5nIHRhYiBjb250ZXh0IGNoaWxkcmVuIGZvciB0YWJzJywgJGNvbnRleHQsICR0YWJzKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkdGFicyA9ICRjb250ZXh0LmZpbmQoc2VsZWN0b3IudGFicyk7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NlYXJjaGluZyB0YWIgY29udGV4dCBmb3IgdGFicycsICRjb250ZXh0LCAkdGFicyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGZpeDoge1xuICAgICAgICAgIGNhbGxiYWNrczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KHBhcmFtZXRlcnMpICYmIChwYXJhbWV0ZXJzLm9uVGFiTG9hZCB8fCBwYXJhbWV0ZXJzLm9uVGFiSW5pdCkgKSB7XG4gICAgICAgICAgICAgIGlmKHBhcmFtZXRlcnMub25UYWJMb2FkKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1ldGVycy5vbkxvYWQgPSBwYXJhbWV0ZXJzLm9uVGFiTG9hZDtcbiAgICAgICAgICAgICAgICBkZWxldGUgcGFyYW1ldGVycy5vblRhYkxvYWQ7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLmxlZ2FjeUxvYWQsIHBhcmFtZXRlcnMub25Mb2FkKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZihwYXJhbWV0ZXJzLm9uVGFiSW5pdCkge1xuICAgICAgICAgICAgICAgIHBhcmFtZXRlcnMub25GaXJzdExvYWQgPSBwYXJhbWV0ZXJzLm9uVGFiSW5pdDtcbiAgICAgICAgICAgICAgICBkZWxldGUgcGFyYW1ldGVycy5vblRhYkluaXQ7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLmxlZ2FjeUluaXQsIHBhcmFtZXRlcnMub25GaXJzdExvYWQpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sICQuZm4udGFiLnNldHRpbmdzLCBwYXJhbWV0ZXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgaW5pdGlhbGl6ZUhpc3Rvcnk6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW5pdGlhbGl6aW5nIHBhZ2Ugc3RhdGUnKTtcbiAgICAgICAgICBpZiggJC5hZGRyZXNzID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3Iuc3RhdGUpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmhpc3RvcnlUeXBlID09ICdzdGF0ZScpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdVc2luZyBIVE1MNSB0byBtYW5hZ2Ugc3RhdGUnKTtcbiAgICAgICAgICAgICAgaWYoc2V0dGluZ3MucGF0aCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAkLmFkZHJlc3NcbiAgICAgICAgICAgICAgICAgIC5oaXN0b3J5KHRydWUpXG4gICAgICAgICAgICAgICAgICAuc3RhdGUoc2V0dGluZ3MucGF0aClcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLnBhdGgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJC5hZGRyZXNzXG4gICAgICAgICAgICAgIC5iaW5kKCdjaGFuZ2UnLCBtb2R1bGUuZXZlbnQuaGlzdG9yeS5jaGFuZ2UpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGV2ZW50OiB7XG4gICAgICAgICAgY2xpY2s6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdGFiUGF0aCA9ICQodGhpcykuZGF0YShtZXRhZGF0YS50YWIpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZih0YWJQYXRoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgaWYoc2V0dGluZ3MuaGlzdG9yeSkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdVcGRhdGluZyBwYWdlIHN0YXRlJywgZXZlbnQpO1xuICAgICAgICAgICAgICAgICQuYWRkcmVzcy52YWx1ZSh0YWJQYXRoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQ2hhbmdpbmcgdGFiJywgZXZlbnQpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5jaGFuZ2VUYWIodGFiUGF0aCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ05vIHRhYiBzcGVjaWZpZWQnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGhpc3Rvcnk6IHtcbiAgICAgICAgICAgIGNoYW5nZTogZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgdGFiUGF0aCAgID0gZXZlbnQucGF0aE5hbWVzLmpvaW4oJy8nKSB8fCBtb2R1bGUuZ2V0LmluaXRpYWxQYXRoKCksXG4gICAgICAgICAgICAgICAgcGFnZVRpdGxlID0gc2V0dGluZ3MudGVtcGxhdGVzLmRldGVybWluZVRpdGxlKHRhYlBhdGgpIHx8IGZhbHNlXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmRpc3BsYXkoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdIaXN0b3J5IGNoYW5nZSBldmVudCcsIHRhYlBhdGgsIGV2ZW50KTtcbiAgICAgICAgICAgICAgaGlzdG9yeUV2ZW50ID0gZXZlbnQ7XG4gICAgICAgICAgICAgIGlmKHRhYlBhdGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5jaGFuZ2VUYWIodGFiUGF0aCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYocGFnZVRpdGxlKSB7XG4gICAgICAgICAgICAgICAgJC5hZGRyZXNzLnRpdGxlKHBhZ2VUaXRsZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVmcmVzaDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoYWN0aXZlVGFiUGF0aCkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZWZyZXNoaW5nIHRhYicsIGFjdGl2ZVRhYlBhdGgpO1xuICAgICAgICAgICAgbW9kdWxlLmNoYW5nZVRhYihhY3RpdmVUYWJQYXRoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY2FjaGU6IHtcblxuICAgICAgICAgIHJlYWQ6IGZ1bmN0aW9uKGNhY2hlS2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gKGNhY2hlS2V5ICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gY2FjaGVbY2FjaGVLZXldXG4gICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFkZDogZnVuY3Rpb24oY2FjaGVLZXksIGNvbnRlbnQpIHtcbiAgICAgICAgICAgIGNhY2hlS2V5ID0gY2FjaGVLZXkgfHwgYWN0aXZlVGFiUGF0aDtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIGNhY2hlZCBjb250ZW50IGZvcicsIGNhY2hlS2V5KTtcbiAgICAgICAgICAgIGNhY2hlW2NhY2hlS2V5XSA9IGNvbnRlbnQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZW1vdmU6IGZ1bmN0aW9uKGNhY2hlS2V5KSB7XG4gICAgICAgICAgICBjYWNoZUtleSA9IGNhY2hlS2V5IHx8IGFjdGl2ZVRhYlBhdGg7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JlbW92aW5nIGNhY2hlZCBjb250ZW50IGZvcicsIGNhY2hlS2V5KTtcbiAgICAgICAgICAgIGRlbGV0ZSBjYWNoZVtjYWNoZUtleV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldDoge1xuICAgICAgICAgIGF1dG86IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHVybCA9ICh0eXBlb2Ygc2V0dGluZ3MucGF0aCA9PSAnc3RyaW5nJylcbiAgICAgICAgICAgICAgICA/IHNldHRpbmdzLnBhdGgucmVwbGFjZSgvXFwvJC8sICcnKSArICcveyR0YWJ9J1xuICAgICAgICAgICAgICAgIDogJy97JHRhYn0nXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2V0dGluZyB1cCBhdXRvbWF0aWMgdGFiIHJldHJpZXZhbCBmcm9tIHNlcnZlcicsIHVybCk7XG4gICAgICAgICAgICBpZigkLmlzUGxhaW5PYmplY3Qoc2V0dGluZ3MuYXBpU2V0dGluZ3MpKSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzLmFwaVNldHRpbmdzLnVybCA9IHVybDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBzZXR0aW5ncy5hcGlTZXR0aW5ncyA9IHtcbiAgICAgICAgICAgICAgICB1cmw6IHVybFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbG9hZGluZzogZnVuY3Rpb24odGFiUGF0aCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICR0YWIgICAgICA9IG1vZHVsZS5nZXQudGFiRWxlbWVudCh0YWJQYXRoKSxcbiAgICAgICAgICAgICAgaXNMb2FkaW5nID0gJHRhYi5oYXNDbGFzcyhjbGFzc05hbWUubG9hZGluZylcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCFpc0xvYWRpbmcpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NldHRpbmcgbG9hZGluZyBzdGF0ZSBmb3InLCAkdGFiKTtcbiAgICAgICAgICAgICAgJHRhYlxuICAgICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUubG9hZGluZylcbiAgICAgICAgICAgICAgICAuc2libGluZ3MoJHRhYnMpXG4gICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSArICcgJyArIGNsYXNzTmFtZS5sb2FkaW5nKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCR0YWIubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uUmVxdWVzdC5jYWxsKCR0YWJbMF0sIHRhYlBhdGgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdGF0ZTogZnVuY3Rpb24oc3RhdGUpIHtcbiAgICAgICAgICAgICQuYWRkcmVzcy52YWx1ZShzdGF0ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGNoYW5nZVRhYjogZnVuY3Rpb24odGFiUGF0aCkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgcHVzaFN0YXRlQXZhaWxhYmxlID0gKHdpbmRvdy5oaXN0b3J5ICYmIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSksXG4gICAgICAgICAgICBzaG91bGRJZ25vcmVMb2FkICAgPSAocHVzaFN0YXRlQXZhaWxhYmxlICYmIHNldHRpbmdzLmlnbm9yZUZpcnN0TG9hZCAmJiBmaXJzdExvYWQpLFxuICAgICAgICAgICAgcmVtb3RlQ29udGVudCAgICAgID0gKHNldHRpbmdzLmF1dG8gfHwgJC5pc1BsYWluT2JqZWN0KHNldHRpbmdzLmFwaVNldHRpbmdzKSApLFxuICAgICAgICAgICAgLy8gb25seSBhZGQgZGVmYXVsdCBwYXRoIGlmIG5vdCByZW1vdGUgY29udGVudFxuICAgICAgICAgICAgcGF0aEFycmF5ID0gKHJlbW90ZUNvbnRlbnQgJiYgIXNob3VsZElnbm9yZUxvYWQpXG4gICAgICAgICAgICAgID8gbW9kdWxlLnV0aWxpdGllcy5wYXRoVG9BcnJheSh0YWJQYXRoKVxuICAgICAgICAgICAgICA6IG1vZHVsZS5nZXQuZGVmYXVsdFBhdGhBcnJheSh0YWJQYXRoKVxuICAgICAgICAgIDtcbiAgICAgICAgICB0YWJQYXRoID0gbW9kdWxlLnV0aWxpdGllcy5hcnJheVRvUGF0aChwYXRoQXJyYXkpO1xuICAgICAgICAgICQuZWFjaChwYXRoQXJyYXksIGZ1bmN0aW9uKGluZGV4LCB0YWIpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjdXJyZW50UGF0aEFycmF5ICAgPSBwYXRoQXJyYXkuc2xpY2UoMCwgaW5kZXggKyAxKSxcbiAgICAgICAgICAgICAgY3VycmVudFBhdGggICAgICAgID0gbW9kdWxlLnV0aWxpdGllcy5hcnJheVRvUGF0aChjdXJyZW50UGF0aEFycmF5KSxcblxuICAgICAgICAgICAgICBpc1RhYiAgICAgICAgICAgICAgPSBtb2R1bGUuaXMudGFiKGN1cnJlbnRQYXRoKSxcbiAgICAgICAgICAgICAgaXNMYXN0SW5kZXggICAgICAgID0gKGluZGV4ICsgMSA9PSBwYXRoQXJyYXkubGVuZ3RoKSxcblxuICAgICAgICAgICAgICAkdGFiICAgICAgICAgICAgICAgPSBtb2R1bGUuZ2V0LnRhYkVsZW1lbnQoY3VycmVudFBhdGgpLFxuICAgICAgICAgICAgICAkYW5jaG9yLFxuICAgICAgICAgICAgICBuZXh0UGF0aEFycmF5LFxuICAgICAgICAgICAgICBuZXh0UGF0aCxcbiAgICAgICAgICAgICAgaXNMYXN0VGFiXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTG9va2luZyBmb3IgdGFiJywgdGFiKTtcbiAgICAgICAgICAgIGlmKGlzVGFiKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdUYWIgd2FzIGZvdW5kJywgdGFiKTtcbiAgICAgICAgICAgICAgLy8gc2NvcGUgdXBcbiAgICAgICAgICAgICAgYWN0aXZlVGFiUGF0aCAgPSBjdXJyZW50UGF0aDtcbiAgICAgICAgICAgICAgcGFyYW1ldGVyQXJyYXkgPSBtb2R1bGUudXRpbGl0aWVzLmZpbHRlckFycmF5KHBhdGhBcnJheSwgY3VycmVudFBhdGhBcnJheSk7XG5cbiAgICAgICAgICAgICAgaWYoaXNMYXN0SW5kZXgpIHtcbiAgICAgICAgICAgICAgICBpc0xhc3RUYWIgPSB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5leHRQYXRoQXJyYXkgPSBwYXRoQXJyYXkuc2xpY2UoMCwgaW5kZXggKyAyKTtcbiAgICAgICAgICAgICAgICBuZXh0UGF0aCAgICAgID0gbW9kdWxlLnV0aWxpdGllcy5hcnJheVRvUGF0aChuZXh0UGF0aEFycmF5KTtcbiAgICAgICAgICAgICAgICBpc0xhc3RUYWIgICAgID0gKCAhbW9kdWxlLmlzLnRhYihuZXh0UGF0aCkgKTtcbiAgICAgICAgICAgICAgICBpZihpc0xhc3RUYWIpIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdUYWIgcGFyYW1ldGVycyBmb3VuZCcsIG5leHRQYXRoQXJyYXkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZihpc0xhc3RUYWIgJiYgcmVtb3RlQ29udGVudCkge1xuICAgICAgICAgICAgICAgIGlmKCFzaG91bGRJZ25vcmVMb2FkKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuYWN0aXZhdGUubmF2aWdhdGlvbihjdXJyZW50UGF0aCk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuZmV0Y2guY29udGVudChjdXJyZW50UGF0aCwgdGFiUGF0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdJZ25vcmluZyByZW1vdGUgY29udGVudCBvbiBmaXJzdCB0YWIgbG9hZCcsIGN1cnJlbnRQYXRoKTtcbiAgICAgICAgICAgICAgICAgIGZpcnN0TG9hZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmNhY2hlLmFkZCh0YWJQYXRoLCAkdGFiLmh0bWwoKSk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuYWN0aXZhdGUuYWxsKGN1cnJlbnRQYXRoKTtcbiAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uRmlyc3RMb2FkLmNhbGwoJHRhYlswXSwgY3VycmVudFBhdGgsIHBhcmFtZXRlckFycmF5LCBoaXN0b3J5RXZlbnQpO1xuICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25Mb2FkLmNhbGwoJHRhYlswXSwgY3VycmVudFBhdGgsIHBhcmFtZXRlckFycmF5LCBoaXN0b3J5RXZlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdPcGVuZWQgbG9jYWwgdGFiJywgY3VycmVudFBhdGgpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5hY3RpdmF0ZS5hbGwoY3VycmVudFBhdGgpO1xuICAgICAgICAgICAgICAgIGlmKCAhbW9kdWxlLmNhY2hlLnJlYWQoY3VycmVudFBhdGgpICkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmNhY2hlLmFkZChjdXJyZW50UGF0aCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0ZpcnN0IHRpbWUgdGFiIGxvYWRlZCBjYWxsaW5nIHRhYiBpbml0Jyk7XG4gICAgICAgICAgICAgICAgICBzZXR0aW5ncy5vbkZpcnN0TG9hZC5jYWxsKCR0YWJbMF0sIGN1cnJlbnRQYXRoLCBwYXJhbWV0ZXJBcnJheSwgaGlzdG9yeUV2ZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2V0dGluZ3Mub25Mb2FkLmNhbGwoJHRhYlswXSwgY3VycmVudFBhdGgsIHBhcmFtZXRlckFycmF5LCBoaXN0b3J5RXZlbnQpO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYodGFiUGF0aC5zZWFyY2goJy8nKSA9PSAtMSAmJiB0YWJQYXRoICE9PSAnJykge1xuICAgICAgICAgICAgICAvLyBsb29rIGZvciBpbiBwYWdlIGFuY2hvclxuICAgICAgICAgICAgICAkYW5jaG9yICAgICA9ICQoJyMnICsgdGFiUGF0aCArICcsIGFbbmFtZT1cIicgKyB0YWJQYXRoICsgJ1wiXScpO1xuICAgICAgICAgICAgICBjdXJyZW50UGF0aCA9ICRhbmNob3IuY2xvc2VzdCgnW2RhdGEtdGFiXScpLmRhdGEobWV0YWRhdGEudGFiKTtcbiAgICAgICAgICAgICAgJHRhYiAgICAgICAgPSBtb2R1bGUuZ2V0LnRhYkVsZW1lbnQoY3VycmVudFBhdGgpO1xuICAgICAgICAgICAgICAvLyBpZiBhbmNob3IgZXhpc3RzIHVzZSBwYXJlbnQgdGFiXG4gICAgICAgICAgICAgIGlmKCRhbmNob3IgJiYgJGFuY2hvci5sZW5ndGggPiAwICYmIGN1cnJlbnRQYXRoKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBbmNob3IgbGluayB1c2VkLCBvcGVuaW5nIHBhcmVudCB0YWInLCAkdGFiLCAkYW5jaG9yKTtcbiAgICAgICAgICAgICAgICBpZiggISR0YWIuaGFzQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSkgKSB7XG4gICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuc2Nyb2xsVG8oJGFuY2hvcik7XG4gICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbW9kdWxlLmFjdGl2YXRlLmFsbChjdXJyZW50UGF0aCk7XG4gICAgICAgICAgICAgICAgaWYoICFtb2R1bGUuY2FjaGUucmVhZChjdXJyZW50UGF0aCkgKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuY2FjaGUuYWRkKGN1cnJlbnRQYXRoLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRmlyc3QgdGltZSB0YWIgbG9hZGVkIGNhbGxpbmcgdGFiIGluaXQnKTtcbiAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uRmlyc3RMb2FkLmNhbGwoJHRhYlswXSwgY3VycmVudFBhdGgsIHBhcmFtZXRlckFycmF5LCBoaXN0b3J5RXZlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXR0aW5ncy5vbkxvYWQuY2FsbCgkdGFiWzBdLCBjdXJyZW50UGF0aCwgcGFyYW1ldGVyQXJyYXksIGhpc3RvcnlFdmVudCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm1pc3NpbmdUYWIsICRtb2R1bGUsICRjb250ZXh0LCBjdXJyZW50UGF0aCk7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBzY3JvbGxUbzogZnVuY3Rpb24oJGVsZW1lbnQpIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIHNjcm9sbE9mZnNldCA9ICgkZWxlbWVudCAmJiAkZWxlbWVudC5sZW5ndGggPiAwKVxuICAgICAgICAgICAgICA/ICRlbGVtZW50Lm9mZnNldCgpLnRvcFxuICAgICAgICAgICAgICA6IGZhbHNlXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKHNjcm9sbE9mZnNldCAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRm9yY2luZyBzY3JvbGwgdG8gYW4gaW4tcGFnZSBsaW5rIGluIGEgaGlkZGVuIHRhYicsIHNjcm9sbE9mZnNldCwgJGVsZW1lbnQpO1xuICAgICAgICAgICAgJChkb2N1bWVudCkuc2Nyb2xsVG9wKHNjcm9sbE9mZnNldCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHVwZGF0ZToge1xuICAgICAgICAgIGNvbnRlbnQ6IGZ1bmN0aW9uKHRhYlBhdGgsIGh0bWwsIGV2YWx1YXRlU2NyaXB0cykge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICR0YWIgPSBtb2R1bGUuZ2V0LnRhYkVsZW1lbnQodGFiUGF0aCksXG4gICAgICAgICAgICAgIHRhYiAgPSAkdGFiWzBdXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBldmFsdWF0ZVNjcmlwdHMgPSAoZXZhbHVhdGVTY3JpcHRzICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gZXZhbHVhdGVTY3JpcHRzXG4gICAgICAgICAgICAgIDogc2V0dGluZ3MuZXZhbHVhdGVTY3JpcHRzXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZih0eXBlb2Ygc2V0dGluZ3MuY2FjaGVUeXBlID09ICdzdHJpbmcnICYmIHNldHRpbmdzLmNhY2hlVHlwZS50b0xvd2VyQ2FzZSgpID09ICdkb20nICYmIHR5cGVvZiBodG1sICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAkdGFiXG4gICAgICAgICAgICAgICAgLmVtcHR5KClcbiAgICAgICAgICAgICAgICAuYXBwZW5kKCQoaHRtbCkuY2xvbmUodHJ1ZSkpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBpZihldmFsdWF0ZVNjcmlwdHMpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1VwZGF0aW5nIEhUTUwgYW5kIGV2YWx1YXRpbmcgaW5saW5lIHNjcmlwdHMnLCB0YWJQYXRoLCBodG1sKTtcbiAgICAgICAgICAgICAgICAkdGFiLmh0bWwoaHRtbCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdVcGRhdGluZyBIVE1MJywgdGFiUGF0aCwgaHRtbCk7XG4gICAgICAgICAgICAgICAgdGFiLmlubmVySFRNTCA9IGh0bWw7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZmV0Y2g6IHtcblxuICAgICAgICAgIGNvbnRlbnQ6IGZ1bmN0aW9uKHRhYlBhdGgsIGZ1bGxUYWJQYXRoKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJHRhYiAgICAgICAgPSBtb2R1bGUuZ2V0LnRhYkVsZW1lbnQodGFiUGF0aCksXG4gICAgICAgICAgICAgIGFwaVNldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIGRhdGFUeXBlICAgICAgICAgOiAnaHRtbCcsXG4gICAgICAgICAgICAgICAgZW5jb2RlUGFyYW1ldGVycyA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIG9uICAgICAgICAgICAgICAgOiAnbm93JyxcbiAgICAgICAgICAgICAgICBjYWNoZSAgICAgICAgICAgIDogc2V0dGluZ3MuYWx3YXlzUmVmcmVzaCxcbiAgICAgICAgICAgICAgICBoZWFkZXJzICAgICAgICAgIDoge1xuICAgICAgICAgICAgICAgICAgJ1gtUmVtb3RlJzogdHJ1ZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgb25TdWNjZXNzIDogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgIGlmKHNldHRpbmdzLmNhY2hlVHlwZSA9PSAncmVzcG9uc2UnKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5jYWNoZS5hZGQoZnVsbFRhYlBhdGgsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIG1vZHVsZS51cGRhdGUuY29udGVudCh0YWJQYXRoLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICBpZih0YWJQYXRoID09IGFjdGl2ZVRhYlBhdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDb250ZW50IGxvYWRlZCcsIHRhYlBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuYWN0aXZhdGUudGFiKHRhYlBhdGgpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ29udGVudCBsb2FkZWQgaW4gYmFja2dyb3VuZCcsIHRhYlBhdGgpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25GaXJzdExvYWQuY2FsbCgkdGFiWzBdLCB0YWJQYXRoLCBwYXJhbWV0ZXJBcnJheSwgaGlzdG9yeUV2ZW50KTtcbiAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uTG9hZC5jYWxsKCR0YWJbMF0sIHRhYlBhdGgsIHBhcmFtZXRlckFycmF5LCBoaXN0b3J5RXZlbnQpO1xuXG4gICAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5sb2FkT25jZSkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuY2FjaGUuYWRkKGZ1bGxUYWJQYXRoLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGVsc2UgaWYodHlwZW9mIHNldHRpbmdzLmNhY2hlVHlwZSA9PSAnc3RyaW5nJyAmJiBzZXR0aW5ncy5jYWNoZVR5cGUudG9Mb3dlckNhc2UoKSA9PSAnZG9tJyAmJiAkdGFiLmNoaWxkcmVuKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICAgICAgICAgJGNsb25lID0gJHRhYi5jaGlsZHJlbigpLmNsb25lKHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgICAgICAgICRjbG9uZSA9ICRjbG9uZS5ub3QoJ3NjcmlwdCcpO1xuICAgICAgICAgICAgICAgICAgICAgIG1vZHVsZS5jYWNoZS5hZGQoZnVsbFRhYlBhdGgsICRjbG9uZSk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5jYWNoZS5hZGQoZnVsbFRhYlBhdGgsICR0YWIuaHRtbCgpKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHVybERhdGE6IHtcbiAgICAgICAgICAgICAgICAgIHRhYjogZnVsbFRhYlBhdGhcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHJlcXVlc3QgICAgICAgICA9ICR0YWIuYXBpKCdnZXQgcmVxdWVzdCcpIHx8IGZhbHNlLFxuICAgICAgICAgICAgICBleGlzdGluZ1JlcXVlc3QgPSAoIHJlcXVlc3QgJiYgcmVxdWVzdC5zdGF0ZSgpID09PSAncGVuZGluZycgKSxcbiAgICAgICAgICAgICAgcmVxdWVzdFNldHRpbmdzLFxuICAgICAgICAgICAgICBjYWNoZWRDb250ZW50XG4gICAgICAgICAgICA7XG5cbiAgICAgICAgICAgIGZ1bGxUYWJQYXRoICAgPSBmdWxsVGFiUGF0aCB8fCB0YWJQYXRoO1xuICAgICAgICAgICAgY2FjaGVkQ29udGVudCA9IG1vZHVsZS5jYWNoZS5yZWFkKGZ1bGxUYWJQYXRoKTtcblxuXG4gICAgICAgICAgICBpZihzZXR0aW5ncy5jYWNoZSAmJiBjYWNoZWRDb250ZW50KSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5hY3RpdmF0ZS50YWIodGFiUGF0aCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIGNhY2hlZCBjb250ZW50JywgZnVsbFRhYlBhdGgpO1xuICAgICAgICAgICAgICBpZighc2V0dGluZ3MubG9hZE9uY2UpIHtcbiAgICAgICAgICAgICAgICBpZihzZXR0aW5ncy5ldmFsdWF0ZVNjcmlwdHMgPT0gJ29uY2UnKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUudXBkYXRlLmNvbnRlbnQodGFiUGF0aCwgY2FjaGVkQ29udGVudCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS51cGRhdGUuY29udGVudCh0YWJQYXRoLCBjYWNoZWRDb250ZW50KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgc2V0dGluZ3Mub25Mb2FkLmNhbGwoJHRhYlswXSwgdGFiUGF0aCwgcGFyYW1ldGVyQXJyYXksIGhpc3RvcnlFdmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGV4aXN0aW5nUmVxdWVzdCkge1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LmxvYWRpbmcodGFiUGF0aCk7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ29udGVudCBpcyBhbHJlYWR5IGxvYWRpbmcnLCBmdWxsVGFiUGF0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKCQuYXBpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgcmVxdWVzdFNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIHNldHRpbmdzLmFwaVNldHRpbmdzLCBhcGlTZXR0aW5ncyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUmV0cmlldmluZyByZW1vdGUgY29udGVudCcsIGZ1bGxUYWJQYXRoLCByZXF1ZXN0U2V0dGluZ3MpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LmxvYWRpbmcodGFiUGF0aCk7XG4gICAgICAgICAgICAgICR0YWIuYXBpKHJlcXVlc3RTZXR0aW5ncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLmFwaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGFjdGl2YXRlOiB7XG4gICAgICAgICAgYWxsOiBmdW5jdGlvbih0YWJQYXRoKSB7XG4gICAgICAgICAgICBtb2R1bGUuYWN0aXZhdGUudGFiKHRhYlBhdGgpO1xuICAgICAgICAgICAgbW9kdWxlLmFjdGl2YXRlLm5hdmlnYXRpb24odGFiUGF0aCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0YWI6IGZ1bmN0aW9uKHRhYlBhdGgpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkdGFiICAgICAgICAgID0gbW9kdWxlLmdldC50YWJFbGVtZW50KHRhYlBhdGgpLFxuICAgICAgICAgICAgICAkZGVhY3RpdmVUYWJzID0gKHNldHRpbmdzLmRlYWN0aXZhdGUgPT0gJ3NpYmxpbmdzJylcbiAgICAgICAgICAgICAgICA/ICR0YWIuc2libGluZ3MoJHRhYnMpXG4gICAgICAgICAgICAgICAgOiAkdGFicy5ub3QoJHRhYiksXG4gICAgICAgICAgICAgIGlzQWN0aXZlICAgICAgPSAkdGFiLmhhc0NsYXNzKGNsYXNzTmFtZS5hY3RpdmUpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2hvd2luZyB0YWIgY29udGVudCBmb3InLCAkdGFiKTtcbiAgICAgICAgICAgIGlmKCFpc0FjdGl2ZSkge1xuICAgICAgICAgICAgICAkdGFiXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5hY3RpdmUpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgJGRlYWN0aXZlVGFic1xuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYWN0aXZlICsgJyAnICsgY2xhc3NOYW1lLmxvYWRpbmcpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoJHRhYi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgc2V0dGluZ3Mub25WaXNpYmxlLmNhbGwoJHRhYlswXSwgdGFiUGF0aCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG5hdmlnYXRpb246IGZ1bmN0aW9uKHRhYlBhdGgpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAkbmF2aWdhdGlvbiAgICAgICAgID0gbW9kdWxlLmdldC5uYXZFbGVtZW50KHRhYlBhdGgpLFxuICAgICAgICAgICAgICAkZGVhY3RpdmVOYXZpZ2F0aW9uID0gKHNldHRpbmdzLmRlYWN0aXZhdGUgPT0gJ3NpYmxpbmdzJylcbiAgICAgICAgICAgICAgICA/ICRuYXZpZ2F0aW9uLnNpYmxpbmdzKCRhbGxNb2R1bGVzKVxuICAgICAgICAgICAgICAgIDogJGFsbE1vZHVsZXMubm90KCRuYXZpZ2F0aW9uKSxcbiAgICAgICAgICAgICAgaXNBY3RpdmUgICAgPSAkbmF2aWdhdGlvbi5oYXNDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FjdGl2YXRpbmcgdGFiIG5hdmlnYXRpb24gZm9yJywgJG5hdmlnYXRpb24sIHRhYlBhdGgpO1xuICAgICAgICAgICAgaWYoIWlzQWN0aXZlKSB7XG4gICAgICAgICAgICAgICRuYXZpZ2F0aW9uXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5hY3RpdmUpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgJGRlYWN0aXZlTmF2aWdhdGlvblxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYWN0aXZlICsgJyAnICsgY2xhc3NOYW1lLmxvYWRpbmcpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVhY3RpdmF0ZToge1xuICAgICAgICAgIGFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVhY3RpdmF0ZS5uYXZpZ2F0aW9uKCk7XG4gICAgICAgICAgICBtb2R1bGUuZGVhY3RpdmF0ZS50YWJzKCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBuYXZpZ2F0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRhbGxNb2R1bGVzXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYWN0aXZlKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdGFiczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkdGFic1xuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmFjdGl2ZSArICcgJyArIGNsYXNzTmFtZS5sb2FkaW5nKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpczoge1xuICAgICAgICAgIHRhYjogZnVuY3Rpb24odGFiTmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuICh0YWJOYW1lICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gKCBtb2R1bGUuZ2V0LnRhYkVsZW1lbnQodGFiTmFtZSkubGVuZ3RoID4gMCApXG4gICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0OiB7XG4gICAgICAgICAgaW5pdGlhbFBhdGg6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRhbGxNb2R1bGVzLmVxKDApLmRhdGEobWV0YWRhdGEudGFiKSB8fCAkdGFicy5lcSgwKS5kYXRhKG1ldGFkYXRhLnRhYik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwYXRoOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAkLmFkZHJlc3MudmFsdWUoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8vIGFkZHMgZGVmYXVsdCB0YWJzIHRvIHRhYiBwYXRoXG4gICAgICAgICAgZGVmYXVsdFBhdGhBcnJheTogZnVuY3Rpb24odGFiUGF0aCkge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS51dGlsaXRpZXMucGF0aFRvQXJyYXkoIG1vZHVsZS5nZXQuZGVmYXVsdFBhdGgodGFiUGF0aCkgKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRlZmF1bHRQYXRoOiBmdW5jdGlvbih0YWJQYXRoKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJGRlZmF1bHROYXYgPSAkYWxsTW9kdWxlcy5maWx0ZXIoJ1tkYXRhLScgKyBtZXRhZGF0YS50YWIgKyAnXj1cIicgKyB0YWJQYXRoICsgJy9cIl0nKS5lcSgwKSxcbiAgICAgICAgICAgICAgZGVmYXVsdFRhYiAgPSAkZGVmYXVsdE5hdi5kYXRhKG1ldGFkYXRhLnRhYikgfHwgZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCBkZWZhdWx0VGFiICkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0ZvdW5kIGRlZmF1bHQgdGFiJywgZGVmYXVsdFRhYik7XG4gICAgICAgICAgICAgIGlmKHJlY3Vyc2lvbkRlcHRoIDwgc2V0dGluZ3MubWF4RGVwdGgpIHtcbiAgICAgICAgICAgICAgICByZWN1cnNpb25EZXB0aCsrO1xuICAgICAgICAgICAgICAgIHJldHVybiBtb2R1bGUuZ2V0LmRlZmF1bHRQYXRoKGRlZmF1bHRUYWIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5yZWN1cnNpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnTm8gZGVmYXVsdCB0YWJzIGZvdW5kIGZvcicsIHRhYlBhdGgsICR0YWJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlY3Vyc2lvbkRlcHRoID0gMDtcbiAgICAgICAgICAgIHJldHVybiB0YWJQYXRoO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbmF2RWxlbWVudDogZnVuY3Rpb24odGFiUGF0aCkge1xuICAgICAgICAgICAgdGFiUGF0aCA9IHRhYlBhdGggfHwgYWN0aXZlVGFiUGF0aDtcbiAgICAgICAgICAgIHJldHVybiAkYWxsTW9kdWxlcy5maWx0ZXIoJ1tkYXRhLScgKyBtZXRhZGF0YS50YWIgKyAnPVwiJyArIHRhYlBhdGggKyAnXCJdJyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0YWJFbGVtZW50OiBmdW5jdGlvbih0YWJQYXRoKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgJGZ1bGxQYXRoVGFiLFxuICAgICAgICAgICAgICAkc2ltcGxlUGF0aFRhYixcbiAgICAgICAgICAgICAgdGFiUGF0aEFycmF5LFxuICAgICAgICAgICAgICBsYXN0VGFiXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICB0YWJQYXRoICAgICAgICA9IHRhYlBhdGggfHwgYWN0aXZlVGFiUGF0aDtcbiAgICAgICAgICAgIHRhYlBhdGhBcnJheSAgID0gbW9kdWxlLnV0aWxpdGllcy5wYXRoVG9BcnJheSh0YWJQYXRoKTtcbiAgICAgICAgICAgIGxhc3RUYWIgICAgICAgID0gbW9kdWxlLnV0aWxpdGllcy5sYXN0KHRhYlBhdGhBcnJheSk7XG4gICAgICAgICAgICAkZnVsbFBhdGhUYWIgICA9ICR0YWJzLmZpbHRlcignW2RhdGEtJyArIG1ldGFkYXRhLnRhYiArICc9XCInICsgdGFiUGF0aCArICdcIl0nKTtcbiAgICAgICAgICAgICRzaW1wbGVQYXRoVGFiID0gJHRhYnMuZmlsdGVyKCdbZGF0YS0nICsgbWV0YWRhdGEudGFiICsgJz1cIicgKyBsYXN0VGFiICsgJ1wiXScpO1xuICAgICAgICAgICAgcmV0dXJuICgkZnVsbFBhdGhUYWIubGVuZ3RoID4gMClcbiAgICAgICAgICAgICAgPyAkZnVsbFBhdGhUYWJcbiAgICAgICAgICAgICAgOiAkc2ltcGxlUGF0aFRhYlxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdGFiOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBhY3RpdmVUYWJQYXRoO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB1dGlsaXRpZXM6IHtcbiAgICAgICAgICBmaWx0ZXJBcnJheTogZnVuY3Rpb24oa2VlcEFycmF5LCByZW1vdmVBcnJheSkge1xuICAgICAgICAgICAgcmV0dXJuICQuZ3JlcChrZWVwQXJyYXksIGZ1bmN0aW9uKGtlZXBWYWx1ZSkge1xuICAgICAgICAgICAgICByZXR1cm4gKCAkLmluQXJyYXkoa2VlcFZhbHVlLCByZW1vdmVBcnJheSkgPT0gLTEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsYXN0OiBmdW5jdGlvbihhcnJheSkge1xuICAgICAgICAgICAgcmV0dXJuICQuaXNBcnJheShhcnJheSlcbiAgICAgICAgICAgICAgPyBhcnJheVsgYXJyYXkubGVuZ3RoIC0gMV1cbiAgICAgICAgICAgICAgOiBmYWxzZVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcGF0aFRvQXJyYXk6IGZ1bmN0aW9uKHBhdGhOYW1lKSB7XG4gICAgICAgICAgICBpZihwYXRoTmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIHBhdGhOYW1lID0gYWN0aXZlVGFiUGF0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0eXBlb2YgcGF0aE5hbWUgPT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgPyBwYXRoTmFtZS5zcGxpdCgnLycpXG4gICAgICAgICAgICAgIDogW3BhdGhOYW1lXVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYXJyYXlUb1BhdGg6IGZ1bmN0aW9uKHBhdGhBcnJheSkge1xuICAgICAgICAgICAgcmV0dXJuICQuaXNBcnJheShwYXRoQXJyYXkpXG4gICAgICAgICAgICAgID8gcGF0aEFycmF5LmpvaW4oJy8nKVxuICAgICAgICAgICAgICA6IGZhbHNlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNldHRpbmc6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdDaGFuZ2luZyBzZXR0aW5nJywgbmFtZSwgdmFsdWUpO1xuICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBzZXR0aW5ncywgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYoJC5pc1BsYWluT2JqZWN0KHNldHRpbmdzW25hbWVdKSkge1xuICAgICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBzZXR0aW5nc1tuYW1lXSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW50ZXJuYWw6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIG1vZHVsZSwgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbW9kdWxlW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVtuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlYnVnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHZlcmJvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MudmVyYm9zZSAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZS5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQpIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvciA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5lcnJvciwgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUsXG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICBwcmV2aW91c1RpbWUgID0gdGltZSB8fCBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSA9IGN1cnJlbnRUaW1lIC0gcHJldmlvdXNUaW1lO1xuICAgICAgICAgICAgICB0aW1lICAgICAgICAgID0gY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIHBlcmZvcm1hbmNlLnB1c2goe1xuICAgICAgICAgICAgICAgICdOYW1lJyAgICAgICAgICAgOiBtZXNzYWdlWzBdLFxuICAgICAgICAgICAgICAgICdBcmd1bWVudHMnICAgICAgOiBbXS5zbGljZS5jYWxsKG1lc3NhZ2UsIDEpIHx8ICcnLFxuICAgICAgICAgICAgICAgICdFbGVtZW50JyAgICAgICAgOiBlbGVtZW50LFxuICAgICAgICAgICAgICAgICdFeGVjdXRpb24gVGltZScgOiBleGVjdXRpb25UaW1lXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lcik7XG4gICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UudGltZXIgPSBzZXRUaW1lb3V0KG1vZHVsZS5wZXJmb3JtYW5jZS5kaXNwbGF5LCA1MDApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlzcGxheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgdGl0bGUgPSBzZXR0aW5ncy5uYW1lICsgJzonLFxuICAgICAgICAgICAgICB0b3RhbFRpbWUgPSAwXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICB0aW1lID0gZmFsc2U7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgICQuZWFjaChwZXJmb3JtYW5jZSwgZnVuY3Rpb24oaW5kZXgsIGRhdGEpIHtcbiAgICAgICAgICAgICAgdG90YWxUaW1lICs9IGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ107XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRpdGxlICs9ICcgJyArIHRvdGFsVGltZSArICdtcyc7XG4gICAgICAgICAgICBpZihtb2R1bGVTZWxlY3Rvcikge1xuICAgICAgICAgICAgICB0aXRsZSArPSAnIFxcJycgKyBtb2R1bGVTZWxlY3RvciArICdcXCcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIChjb25zb2xlLmdyb3VwICE9PSB1bmRlZmluZWQgfHwgY29uc29sZS50YWJsZSAhPT0gdW5kZWZpbmVkKSAmJiBwZXJmb3JtYW5jZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQodGl0bGUpO1xuICAgICAgICAgICAgICBpZihjb25zb2xlLnRhYmxlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS50YWJsZShwZXJmb3JtYW5jZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YVsnTmFtZSddICsgJzogJyArIGRhdGFbJ0V4ZWN1dGlvbiBUaW1lJ10rJ21zJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcGVyZm9ybWFuY2UgPSBbXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGludm9rZTogZnVuY3Rpb24ocXVlcnksIHBhc3NlZEFyZ3VtZW50cywgY29udGV4dCkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgb2JqZWN0ID0gaW5zdGFuY2UsXG4gICAgICAgICAgICBtYXhEZXB0aCxcbiAgICAgICAgICAgIGZvdW5kLFxuICAgICAgICAgICAgcmVzcG9uc2VcbiAgICAgICAgICA7XG4gICAgICAgICAgcGFzc2VkQXJndW1lbnRzID0gcGFzc2VkQXJndW1lbnRzIHx8IHF1ZXJ5QXJndW1lbnRzO1xuICAgICAgICAgIGNvbnRleHQgICAgICAgICA9IGVsZW1lbnQgICAgICAgICB8fCBjb250ZXh0O1xuICAgICAgICAgIGlmKHR5cGVvZiBxdWVyeSA9PSAnc3RyaW5nJyAmJiBvYmplY3QgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcXVlcnkgICAgPSBxdWVyeS5zcGxpdCgvW1xcLiBdLyk7XG4gICAgICAgICAgICBtYXhEZXB0aCA9IHF1ZXJ5Lmxlbmd0aCAtIDE7XG4gICAgICAgICAgICAkLmVhY2gocXVlcnksIGZ1bmN0aW9uKGRlcHRoLCB2YWx1ZSkge1xuICAgICAgICAgICAgICB2YXIgY2FtZWxDYXNlVmFsdWUgPSAoZGVwdGggIT0gbWF4RGVwdGgpXG4gICAgICAgICAgICAgICAgPyB2YWx1ZSArIHF1ZXJ5W2RlcHRoICsgMV0uY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBxdWVyeVtkZXB0aCArIDFdLnNsaWNlKDEpXG4gICAgICAgICAgICAgICAgOiBxdWVyeVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFtjYW1lbENhc2VWYWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFtjYW1lbENhc2VWYWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggJC5pc1BsYWluT2JqZWN0KCBvYmplY3RbdmFsdWVdICkgJiYgKGRlcHRoICE9IG1heERlcHRoKSApIHtcbiAgICAgICAgICAgICAgICBvYmplY3QgPSBvYmplY3RbdmFsdWVdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoIG9iamVjdFt2YWx1ZV0gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgICBmb3VuZCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5tZXRob2QsIHF1ZXJ5KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoICQuaXNGdW5jdGlvbiggZm91bmQgKSApIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQuYXBwbHkoY29udGV4dCwgcGFzc2VkQXJndW1lbnRzKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihmb3VuZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGZvdW5kO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZigkLmlzQXJyYXkocmV0dXJuZWRWYWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUucHVzaChyZXNwb25zZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYocmV0dXJuZWRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlID0gW3JldHVybmVkVmFsdWUsIHJlc3BvbnNlXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlID0gcmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmb3VuZDtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGlmKG1ldGhvZEludm9rZWQpIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICAgIH1cbiAgICAgICAgbW9kdWxlLmludm9rZShxdWVyeSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYoaW5zdGFuY2UgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGluc3RhbmNlLmludm9rZSgnZGVzdHJveScpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbml0aWFsaXplKCk7XG4gICAgICB9XG4gICAgfSlcbiAgO1xuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xuXG59O1xuXG4vLyBzaG9ydGN1dCBmb3IgdGFiYmVkIGNvbnRlbnQgd2l0aCBubyBkZWZpbmVkIG5hdmlnYXRpb25cbiQudGFiID0gZnVuY3Rpb24oKSB7XG4gICQod2luZG93KS50YWIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbn07XG5cbiQuZm4udGFiLnNldHRpbmdzID0ge1xuXG4gIG5hbWUgICAgICAgICAgICA6ICdUYWInLFxuICBuYW1lc3BhY2UgICAgICAgOiAndGFiJyxcblxuICBzaWxlbnQgICAgICAgICAgOiBmYWxzZSxcbiAgZGVidWcgICAgICAgICAgIDogZmFsc2UsXG4gIHZlcmJvc2UgICAgICAgICA6IGZhbHNlLFxuICBwZXJmb3JtYW5jZSAgICAgOiB0cnVlLFxuXG4gIGF1dG8gICAgICAgICAgICA6IGZhbHNlLCAgICAgIC8vIHVzZXMgcGpheCBzdHlsZSBlbmRwb2ludHMgZmV0Y2hpbmcgY29udGVudCBmcm9tIHNhbWUgdXJsIHdpdGggcmVtb3RlLWNvbnRlbnQgaGVhZGVyc1xuICBoaXN0b3J5ICAgICAgICAgOiBmYWxzZSwgICAgICAvLyB1c2UgYnJvd3NlciBoaXN0b3J5XG4gIGhpc3RvcnlUeXBlICAgICA6ICdoYXNoJywgICAgIC8vICMvIG9yIGh0bWw1IHN0YXRlXG4gIHBhdGggICAgICAgICAgICA6IGZhbHNlLCAgICAgIC8vIGJhc2UgcGF0aCBvZiB1cmxcblxuICBjb250ZXh0ICAgICAgICAgOiBmYWxzZSwgICAgICAvLyBzcGVjaWZ5IGEgY29udGV4dCB0aGF0IHRhYnMgbXVzdCBhcHBlYXIgaW5zaWRlXG4gIGNoaWxkcmVuT25seSAgICA6IGZhbHNlLCAgICAgIC8vIHVzZSBvbmx5IHRhYnMgdGhhdCBhcmUgY2hpbGRyZW4gb2YgY29udGV4dFxuICBtYXhEZXB0aCAgICAgICAgOiAyNSwgICAgICAgICAvLyBtYXggZGVwdGggYSB0YWIgY2FuIGJlIG5lc3RlZFxuXG4gIGRlYWN0aXZhdGUgICAgICA6ICdzaWJsaW5ncycsIC8vIHdoZXRoZXIgdGFicyBzaG91bGQgZGVhY3RpdmF0ZSBzaWJsaW5nIG1lbnUgZWxlbWVudHMgb3IgYWxsIGVsZW1lbnRzIGluaXRpYWxpemVkIHRvZ2V0aGVyXG5cbiAgYWx3YXlzUmVmcmVzaCAgIDogZmFsc2UsICAgICAgLy8gbG9hZCB0YWIgY29udGVudCBuZXcgZXZlcnkgdGFiIGNsaWNrXG4gIGNhY2hlICAgICAgICAgICA6IHRydWUsICAgICAgIC8vIGNhY2hlIHRoZSBjb250ZW50IHJlcXVlc3RzIHRvIHB1bGwgbG9jYWxseVxuICBsb2FkT25jZSAgICAgICAgOiBmYWxzZSwgICAgICAvLyBXaGV0aGVyIHRhYiBkYXRhIHNob3VsZCBvbmx5IGJlIGxvYWRlZCBvbmNlIHdoZW4gdXNpbmcgcmVtb3RlIGNvbnRlbnRcbiAgY2FjaGVUeXBlICAgICAgIDogJ3Jlc3BvbnNlJywgLy8gV2hldGhlciB0byBjYWNoZSBleGFjdCByZXNwb25zZSwgb3IgdG8gaHRtbCBjYWNoZSBjb250ZW50cyBhZnRlciBzY3JpcHRzIGV4ZWN1dGVcbiAgaWdub3JlRmlyc3RMb2FkIDogZmFsc2UsICAgICAgLy8gZG9uJ3QgbG9hZCByZW1vdGUgY29udGVudCBvbiBmaXJzdCBsb2FkXG5cbiAgYXBpU2V0dGluZ3MgICAgIDogZmFsc2UsICAgICAgLy8gc2V0dGluZ3MgZm9yIGFwaSBjYWxsXG4gIGV2YWx1YXRlU2NyaXB0cyA6ICdvbmNlJywgICAgIC8vIHdoZXRoZXIgaW5saW5lIHNjcmlwdHMgc2hvdWxkIGJlIHBhcnNlZCAodHJ1ZS9mYWxzZS9vbmNlKS4gT25jZSB3aWxsIG5vdCByZS1ldmFsdWF0ZSBvbiBjYWNoZWQgY29udGVudFxuXG4gIG9uRmlyc3RMb2FkIDogZnVuY3Rpb24odGFiUGF0aCwgcGFyYW1ldGVyQXJyYXksIGhpc3RvcnlFdmVudCkge30sIC8vIGNhbGxlZCBmaXJzdCB0aW1lIGxvYWRlZFxuICBvbkxvYWQgICAgICA6IGZ1bmN0aW9uKHRhYlBhdGgsIHBhcmFtZXRlckFycmF5LCBoaXN0b3J5RXZlbnQpIHt9LCAvLyBjYWxsZWQgb24gZXZlcnkgbG9hZFxuICBvblZpc2libGUgICA6IGZ1bmN0aW9uKHRhYlBhdGgsIHBhcmFtZXRlckFycmF5LCBoaXN0b3J5RXZlbnQpIHt9LCAvLyBjYWxsZWQgZXZlcnkgdGltZSB0YWIgdmlzaWJsZVxuICBvblJlcXVlc3QgICA6IGZ1bmN0aW9uKHRhYlBhdGgsIHBhcmFtZXRlckFycmF5LCBoaXN0b3J5RXZlbnQpIHt9LCAvLyBjYWxsZWQgZXZlciB0aW1lIGEgdGFiIGJlaW5ncyBsb2FkaW5nIHJlbW90ZSBjb250ZW50XG5cbiAgdGVtcGxhdGVzIDoge1xuICAgIGRldGVybWluZVRpdGxlOiBmdW5jdGlvbih0YWJBcnJheSkge30gLy8gcmV0dXJucyBwYWdlIHRpdGxlIGZvciBwYXRoXG4gIH0sXG5cbiAgZXJyb3I6IHtcbiAgICBhcGkgICAgICAgIDogJ1lvdSBhdHRlbXB0ZWQgdG8gbG9hZCBjb250ZW50IHdpdGhvdXQgQVBJIG1vZHVsZScsXG4gICAgbWV0aG9kICAgICA6ICdUaGUgbWV0aG9kIHlvdSBjYWxsZWQgaXMgbm90IGRlZmluZWQnLFxuICAgIG1pc3NpbmdUYWIgOiAnQWN0aXZhdGVkIHRhYiBjYW5ub3QgYmUgZm91bmQuIFRhYnMgYXJlIGNhc2Utc2Vuc2l0aXZlLicsXG4gICAgbm9Db250ZW50ICA6ICdUaGUgdGFiIHlvdSBzcGVjaWZpZWQgaXMgbWlzc2luZyBhIGNvbnRlbnQgdXJsLicsXG4gICAgcGF0aCAgICAgICA6ICdIaXN0b3J5IGVuYWJsZWQsIGJ1dCBubyBwYXRoIHdhcyBzcGVjaWZpZWQnLFxuICAgIHJlY3Vyc2lvbiAgOiAnTWF4IHJlY3Vyc2l2ZSBkZXB0aCByZWFjaGVkJyxcbiAgICBsZWdhY3lJbml0IDogJ29uVGFiSW5pdCBoYXMgYmVlbiByZW5hbWVkIHRvIG9uRmlyc3RMb2FkIGluIDIuMCwgcGxlYXNlIGFkanVzdCB5b3VyIGNvZGUuJyxcbiAgICBsZWdhY3lMb2FkIDogJ29uVGFiTG9hZCBoYXMgYmVlbiByZW5hbWVkIHRvIG9uTG9hZCBpbiAyLjAuIFBsZWFzZSBhZGp1c3QgeW91ciBjb2RlJyxcbiAgICBzdGF0ZSAgICAgIDogJ0hpc3RvcnkgcmVxdWlyZXMgQXN1YWxcXCdzIEFkZHJlc3MgbGlicmFyeSA8aHR0cHM6Ly9naXRodWIuY29tL2FzdWFsL2pxdWVyeS1hZGRyZXNzPidcbiAgfSxcblxuICBtZXRhZGF0YSA6IHtcbiAgICB0YWIgICAgOiAndGFiJyxcbiAgICBsb2FkZWQgOiAnbG9hZGVkJyxcbiAgICBwcm9taXNlOiAncHJvbWlzZSdcbiAgfSxcblxuICBjbGFzc05hbWUgICA6IHtcbiAgICBsb2FkaW5nIDogJ2xvYWRpbmcnLFxuICAgIGFjdGl2ZSAgOiAnYWN0aXZlJ1xuICB9LFxuXG4gIHNlbGVjdG9yICAgIDoge1xuICAgIHRhYnMgOiAnLnVpLnRhYicsXG4gICAgdWkgICA6ICcudWknXG4gIH1cblxufTtcblxufSkoIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCApO1xuXG4vKiFcbiAqICMgU2VtYW50aWMgVUkgMi40LjAgLSBUcmFuc2l0aW9uXG4gKiBodHRwOi8vZ2l0aHViLmNvbS9zZW1hbnRpYy1vcmcvc2VtYW50aWMtdWkvXG4gKlxuICpcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZVxuICogaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxuICpcbiAqL1xuXG47KGZ1bmN0aW9uICgkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHtcblxuJ3VzZSBzdHJpY3QnO1xuXG53aW5kb3cgPSAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoKVxuICA/IHdpbmRvd1xuICA6ICh0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aClcbiAgICA/IHNlbGZcbiAgICA6IEZ1bmN0aW9uKCdyZXR1cm4gdGhpcycpKClcbjtcblxuJC5mbi50cmFuc2l0aW9uID0gZnVuY3Rpb24oKSB7XG4gIHZhclxuICAgICRhbGxNb2R1bGVzICAgICA9ICQodGhpcyksXG4gICAgbW9kdWxlU2VsZWN0b3IgID0gJGFsbE1vZHVsZXMuc2VsZWN0b3IgfHwgJycsXG5cbiAgICB0aW1lICAgICAgICAgICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICBwZXJmb3JtYW5jZSAgICAgPSBbXSxcblxuICAgIG1vZHVsZUFyZ3VtZW50cyA9IGFyZ3VtZW50cyxcbiAgICBxdWVyeSAgICAgICAgICAgPSBtb2R1bGVBcmd1bWVudHNbMF0sXG4gICAgcXVlcnlBcmd1bWVudHMgID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLFxuICAgIG1ldGhvZEludm9rZWQgICA9ICh0eXBlb2YgcXVlcnkgPT09ICdzdHJpbmcnKSxcblxuICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgIHx8IHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAgfHwgZnVuY3Rpb24oY2FsbGJhY2spIHsgc2V0VGltZW91dChjYWxsYmFjaywgMCk7IH0sXG5cbiAgICByZXR1cm5lZFZhbHVlXG4gIDtcbiAgJGFsbE1vZHVsZXNcbiAgICAuZWFjaChmdW5jdGlvbihpbmRleCkge1xuICAgICAgdmFyXG4gICAgICAgICRtb2R1bGUgID0gJCh0aGlzKSxcbiAgICAgICAgZWxlbWVudCAgPSB0aGlzLFxuXG4gICAgICAgIC8vIHNldCBhdCBydW4gdGltZVxuICAgICAgICBzZXR0aW5ncyxcbiAgICAgICAgaW5zdGFuY2UsXG5cbiAgICAgICAgZXJyb3IsXG4gICAgICAgIGNsYXNzTmFtZSxcbiAgICAgICAgbWV0YWRhdGEsXG4gICAgICAgIGFuaW1hdGlvbkVuZCxcbiAgICAgICAgYW5pbWF0aW9uTmFtZSxcblxuICAgICAgICBuYW1lc3BhY2UsXG4gICAgICAgIG1vZHVsZU5hbWVzcGFjZSxcbiAgICAgICAgZXZlbnROYW1lc3BhY2UsXG4gICAgICAgIG1vZHVsZVxuICAgICAgO1xuXG4gICAgICBtb2R1bGUgPSB7XG5cbiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAvLyBnZXQgZnVsbCBzZXR0aW5nc1xuICAgICAgICAgIHNldHRpbmdzICAgICAgICA9IG1vZHVsZS5nZXQuc2V0dGluZ3MuYXBwbHkoZWxlbWVudCwgbW9kdWxlQXJndW1lbnRzKTtcblxuICAgICAgICAgIC8vIHNob3J0aGFuZFxuICAgICAgICAgIGNsYXNzTmFtZSAgICAgICA9IHNldHRpbmdzLmNsYXNzTmFtZTtcbiAgICAgICAgICBlcnJvciAgICAgICAgICAgPSBzZXR0aW5ncy5lcnJvcjtcbiAgICAgICAgICBtZXRhZGF0YSAgICAgICAgPSBzZXR0aW5ncy5tZXRhZGF0YTtcblxuICAgICAgICAgIC8vIGRlZmluZSBuYW1lc3BhY2VcbiAgICAgICAgICBldmVudE5hbWVzcGFjZSAgPSAnLicgKyBzZXR0aW5ncy5uYW1lc3BhY2U7XG4gICAgICAgICAgbW9kdWxlTmFtZXNwYWNlID0gJ21vZHVsZS0nICsgc2V0dGluZ3MubmFtZXNwYWNlO1xuICAgICAgICAgIGluc3RhbmNlICAgICAgICA9ICRtb2R1bGUuZGF0YShtb2R1bGVOYW1lc3BhY2UpIHx8IG1vZHVsZTtcblxuICAgICAgICAgIC8vIGdldCB2ZW5kb3Igc3BlY2lmaWMgZXZlbnRzXG4gICAgICAgICAgYW5pbWF0aW9uRW5kICAgID0gbW9kdWxlLmdldC5hbmltYXRpb25FbmRFdmVudCgpO1xuXG4gICAgICAgICAgaWYobWV0aG9kSW52b2tlZCkge1xuICAgICAgICAgICAgbWV0aG9kSW52b2tlZCA9IG1vZHVsZS5pbnZva2UocXVlcnkpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIG1ldGhvZCBub3QgaW52b2tlZCwgbGV0cyBydW4gYW4gYW5pbWF0aW9uXG4gICAgICAgICAgaWYobWV0aG9kSW52b2tlZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdDb252ZXJ0ZWQgYXJndW1lbnRzIGludG8gc2V0dGluZ3Mgb2JqZWN0Jywgc2V0dGluZ3MpO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuaW50ZXJ2YWwpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlbGF5KHNldHRpbmdzLmFuaW1hdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSAge1xuICAgICAgICAgICAgICBtb2R1bGUuYW5pbWF0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLmluc3RhbnRpYXRlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGluc3RhbnRpYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU3RvcmluZyBpbnN0YW5jZSBvZiBtb2R1bGUnLCBtb2R1bGUpO1xuICAgICAgICAgIGluc3RhbmNlID0gbW9kdWxlO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5kYXRhKG1vZHVsZU5hbWVzcGFjZSwgaW5zdGFuY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXN0cm95aW5nIHByZXZpb3VzIG1vZHVsZSBmb3InLCBlbGVtZW50KTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAucmVtb3ZlRGF0YShtb2R1bGVOYW1lc3BhY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZWZyZXNoaW5nIGRpc3BsYXkgdHlwZSBvbiBuZXh0IGFuaW1hdGlvbicpO1xuICAgICAgICAgIGRlbGV0ZSBtb2R1bGUuZGlzcGxheVR5cGU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZm9yY2VSZXBhaW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRm9yY2luZyBlbGVtZW50IHJlcGFpbnQnKTtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgICRwYXJlbnRFbGVtZW50ID0gJG1vZHVsZS5wYXJlbnQoKSxcbiAgICAgICAgICAgICRuZXh0RWxlbWVudCA9ICRtb2R1bGUubmV4dCgpXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKCRuZXh0RWxlbWVudC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICRtb2R1bGUuZGV0YWNoKCkuYXBwZW5kVG8oJHBhcmVudEVsZW1lbnQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICRtb2R1bGUuZGV0YWNoKCkuaW5zZXJ0QmVmb3JlKCRuZXh0RWxlbWVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlcGFpbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZXBhaW50aW5nIGVsZW1lbnQnKTtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIGZha2VBc3NpZ25tZW50ID0gZWxlbWVudC5vZmZzZXRXaWR0aFxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBkZWxheTogZnVuY3Rpb24oaW50ZXJ2YWwpIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIGRpcmVjdGlvbiA9IG1vZHVsZS5nZXQuYW5pbWF0aW9uRGlyZWN0aW9uKCksXG4gICAgICAgICAgICBzaG91bGRSZXZlcnNlLFxuICAgICAgICAgICAgZGVsYXlcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYoIWRpcmVjdGlvbikge1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gbW9kdWxlLmNhbi50cmFuc2l0aW9uKClcbiAgICAgICAgICAgICAgPyBtb2R1bGUuZ2V0LmRpcmVjdGlvbigpXG4gICAgICAgICAgICAgIDogJ3N0YXRpYydcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaW50ZXJ2YWwgPSAoaW50ZXJ2YWwgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgID8gaW50ZXJ2YWxcbiAgICAgICAgICAgIDogc2V0dGluZ3MuaW50ZXJ2YWxcbiAgICAgICAgICA7XG4gICAgICAgICAgc2hvdWxkUmV2ZXJzZSA9IChzZXR0aW5ncy5yZXZlcnNlID09ICdhdXRvJyAmJiBkaXJlY3Rpb24gPT0gY2xhc3NOYW1lLm91dHdhcmQpO1xuICAgICAgICAgIGRlbGF5ID0gKHNob3VsZFJldmVyc2UgfHwgc2V0dGluZ3MucmV2ZXJzZSA9PSB0cnVlKVxuICAgICAgICAgICAgPyAoJGFsbE1vZHVsZXMubGVuZ3RoIC0gaW5kZXgpICogc2V0dGluZ3MuaW50ZXJ2YWxcbiAgICAgICAgICAgIDogaW5kZXggKiBzZXR0aW5ncy5pbnRlcnZhbFxuICAgICAgICAgIDtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0RlbGF5aW5nIGFuaW1hdGlvbiBieScsIGRlbGF5KTtcbiAgICAgICAgICBzZXRUaW1lb3V0KG1vZHVsZS5hbmltYXRlLCBkZWxheSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYW5pbWF0ZTogZnVuY3Rpb24ob3ZlcnJpZGVTZXR0aW5ncykge1xuICAgICAgICAgIHNldHRpbmdzID0gb3ZlcnJpZGVTZXR0aW5ncyB8fCBzZXR0aW5ncztcbiAgICAgICAgICBpZighbW9kdWxlLmlzLnN1cHBvcnRlZCgpKSB7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3Iuc3VwcG9ydCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUHJlcGFyaW5nIGFuaW1hdGlvbicsIHNldHRpbmdzLmFuaW1hdGlvbik7XG4gICAgICAgICAgaWYobW9kdWxlLmlzLmFuaW1hdGluZygpKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5xdWV1ZSkge1xuICAgICAgICAgICAgICBpZighc2V0dGluZ3MuYWxsb3dSZXBlYXRzICYmIG1vZHVsZS5oYXMuZGlyZWN0aW9uKCkgJiYgbW9kdWxlLmlzLm9jY3VycmluZygpICYmIG1vZHVsZS5xdWV1aW5nICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBbmltYXRpb24gaXMgY3VycmVudGx5IG9jY3VycmluZywgcHJldmVudGluZyBxdWV1ZWluZyBzYW1lIGFuaW1hdGlvbicsIHNldHRpbmdzLmFuaW1hdGlvbik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnF1ZXVlKHNldHRpbmdzLmFuaW1hdGlvbik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZighc2V0dGluZ3MuYWxsb3dSZXBlYXRzICYmIG1vZHVsZS5pcy5vY2N1cnJpbmcoKSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0FuaW1hdGlvbiBpcyBhbHJlYWR5IG9jY3VycmluZywgd2lsbCBub3QgZXhlY3V0ZSByZXBlYXRlZCBhbmltYXRpb24nLCBzZXR0aW5ncy5hbmltYXRpb24pO1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdOZXcgYW5pbWF0aW9uIHN0YXJ0ZWQsIGNvbXBsZXRpbmcgcHJldmlvdXMgZWFybHknLCBzZXR0aW5ncy5hbmltYXRpb24pO1xuICAgICAgICAgICAgICBpbnN0YW5jZS5jb21wbGV0ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiggbW9kdWxlLmNhbi5hbmltYXRlKCkgKSB7XG4gICAgICAgICAgICBtb2R1bGUuc2V0LmFuaW1hdGluZyhzZXR0aW5ncy5hbmltYXRpb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5ub0FuaW1hdGlvbiwgc2V0dGluZ3MuYW5pbWF0aW9uLCBlbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUmVzZXR0aW5nIGFuaW1hdGlvbiB0byBiZWdpbm5pbmcgY29uZGl0aW9ucycpO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUuYW5pbWF0aW9uQ2FsbGJhY2tzKCk7XG4gICAgICAgICAgbW9kdWxlLnJlc3RvcmUuY29uZGl0aW9ucygpO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUuYW5pbWF0aW5nKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcXVldWU6IGZ1bmN0aW9uKGFuaW1hdGlvbikge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUXVldWVpbmcgYW5pbWF0aW9uIG9mJywgYW5pbWF0aW9uKTtcbiAgICAgICAgICBtb2R1bGUucXVldWluZyA9IHRydWU7XG4gICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgLm9uZShhbmltYXRpb25FbmQgKyAnLnF1ZXVlJyArIGV2ZW50TmFtZXNwYWNlLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnF1ZXVpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlcGFpbnQoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmFuaW1hdGUuYXBwbHkodGhpcywgc2V0dGluZ3MpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICA7XG4gICAgICAgIH0sXG5cbiAgICAgICAgY29tcGxldGU6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQW5pbWF0aW9uIGNvbXBsZXRlJywgc2V0dGluZ3MuYW5pbWF0aW9uKTtcbiAgICAgICAgICBtb2R1bGUucmVtb3ZlLmNvbXBsZXRlQ2FsbGJhY2soKTtcbiAgICAgICAgICBtb2R1bGUucmVtb3ZlLmZhaWxTYWZlKCk7XG4gICAgICAgICAgaWYoIW1vZHVsZS5pcy5sb29waW5nKCkpIHtcbiAgICAgICAgICAgIGlmKCBtb2R1bGUuaXMub3V0d2FyZCgpICkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQW5pbWF0aW9uIGlzIG91dHdhcmQsIGhpZGluZyBlbGVtZW50Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5yZXN0b3JlLmNvbmRpdGlvbnMoKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmhpZGUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoIG1vZHVsZS5pcy5pbndhcmQoKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FuaW1hdGlvbiBpcyBvdXR3YXJkLCBzaG93aW5nIGVsZW1lbnQnKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlc3RvcmUuY29uZGl0aW9ucygpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2hvdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTdGF0aWMgYW5pbWF0aW9uIGNvbXBsZXRlZCcpO1xuICAgICAgICAgICAgICBtb2R1bGUucmVzdG9yZS5jb25kaXRpb25zKCk7XG4gICAgICAgICAgICAgIHNldHRpbmdzLm9uQ29tcGxldGUuY2FsbChlbGVtZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZm9yY2U6IHtcbiAgICAgICAgICB2aXNpYmxlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBzdHlsZSAgICAgICAgICA9ICRtb2R1bGUuYXR0cignc3R5bGUnKSxcbiAgICAgICAgICAgICAgdXNlclN0eWxlICAgICAgPSBtb2R1bGUuZ2V0LnVzZXJTdHlsZSgpLFxuICAgICAgICAgICAgICBkaXNwbGF5VHlwZSAgICA9IG1vZHVsZS5nZXQuZGlzcGxheVR5cGUoKSxcbiAgICAgICAgICAgICAgb3ZlcnJpZGVTdHlsZSAgPSB1c2VyU3R5bGUgKyAnZGlzcGxheTogJyArIGRpc3BsYXlUeXBlICsgJyAhaW1wb3J0YW50OycsXG4gICAgICAgICAgICAgIGN1cnJlbnREaXNwbGF5ID0gJG1vZHVsZS5jc3MoJ2Rpc3BsYXknKSxcbiAgICAgICAgICAgICAgZW1wdHlTdHlsZSAgICAgPSAoc3R5bGUgPT09IHVuZGVmaW5lZCB8fCBzdHlsZSA9PT0gJycpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihjdXJyZW50RGlzcGxheSAhPT0gZGlzcGxheVR5cGUpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ092ZXJyaWRpbmcgZGVmYXVsdCBkaXNwbGF5IHRvIHNob3cgZWxlbWVudCcsIGRpc3BsYXlUeXBlKTtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5hdHRyKCdzdHlsZScsIG92ZXJyaWRlU3R5bGUpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoZW1wdHlTdHlsZSkge1xuICAgICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUF0dHIoJ3N0eWxlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBoaWRkZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHN0eWxlICAgICAgICAgID0gJG1vZHVsZS5hdHRyKCdzdHlsZScpLFxuICAgICAgICAgICAgICBjdXJyZW50RGlzcGxheSA9ICRtb2R1bGUuY3NzKCdkaXNwbGF5JyksXG4gICAgICAgICAgICAgIGVtcHR5U3R5bGUgICAgID0gKHN0eWxlID09PSB1bmRlZmluZWQgfHwgc3R5bGUgPT09ICcnKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoY3VycmVudERpc3BsYXkgIT09ICdub25lJyAmJiAhbW9kdWxlLmlzLmhpZGRlbigpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdPdmVycmlkaW5nIGRlZmF1bHQgZGlzcGxheSB0byBoaWRlIGVsZW1lbnQnKTtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5jc3MoJ2Rpc3BsYXknLCAnbm9uZScpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoZW1wdHlTdHlsZSkge1xuICAgICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgICAgLnJlbW92ZUF0dHIoJ3N0eWxlJylcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBoYXM6IHtcbiAgICAgICAgICBkaXJlY3Rpb246IGZ1bmN0aW9uKGFuaW1hdGlvbikge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGhhc0RpcmVjdGlvbiA9IGZhbHNlXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBhbmltYXRpb24gPSBhbmltYXRpb24gfHwgc2V0dGluZ3MuYW5pbWF0aW9uO1xuICAgICAgICAgICAgaWYodHlwZW9mIGFuaW1hdGlvbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgYW5pbWF0aW9uID0gYW5pbWF0aW9uLnNwbGl0KCcgJyk7XG4gICAgICAgICAgICAgICQuZWFjaChhbmltYXRpb24sIGZ1bmN0aW9uKGluZGV4LCB3b3JkKXtcbiAgICAgICAgICAgICAgICBpZih3b3JkID09PSBjbGFzc05hbWUuaW53YXJkIHx8IHdvcmQgPT09IGNsYXNzTmFtZS5vdXR3YXJkKSB7XG4gICAgICAgICAgICAgICAgICBoYXNEaXJlY3Rpb24gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaGFzRGlyZWN0aW9uO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaW5saW5lRGlzcGxheTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgc3R5bGUgPSAkbW9kdWxlLmF0dHIoJ3N0eWxlJykgfHwgJydcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiAkLmlzQXJyYXkoc3R5bGUubWF0Y2goL2Rpc3BsYXkuKj87LywgJycpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0OiB7XG4gICAgICAgICAgYW5pbWF0aW5nOiBmdW5jdGlvbihhbmltYXRpb24pIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBhbmltYXRpb25DbGFzcyxcbiAgICAgICAgICAgICAgZGlyZWN0aW9uXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAvLyByZW1vdmUgcHJldmlvdXMgY2FsbGJhY2tzXG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmNvbXBsZXRlQ2FsbGJhY2soKTtcblxuICAgICAgICAgICAgLy8gZGV0ZXJtaW5lIGV4YWN0IGFuaW1hdGlvblxuICAgICAgICAgICAgYW5pbWF0aW9uICAgICAgPSBhbmltYXRpb24gfHwgc2V0dGluZ3MuYW5pbWF0aW9uO1xuICAgICAgICAgICAgYW5pbWF0aW9uQ2xhc3MgPSBtb2R1bGUuZ2V0LmFuaW1hdGlvbkNsYXNzKGFuaW1hdGlvbik7XG5cbiAgICAgICAgICAgIC8vIHNhdmUgYW5pbWF0aW9uIGNsYXNzIGluIGNhY2hlIHRvIHJlc3RvcmUgY2xhc3MgbmFtZXNcbiAgICAgICAgICAgIG1vZHVsZS5zYXZlLmFuaW1hdGlvbihhbmltYXRpb25DbGFzcyk7XG5cbiAgICAgICAgICAgIC8vIG92ZXJyaWRlIGRpc3BsYXkgaWYgbmVjZXNzYXJ5IHNvIGFuaW1hdGlvbiBhcHBlYXJzIHZpc2libHlcbiAgICAgICAgICAgIG1vZHVsZS5mb3JjZS52aXNpYmxlKCk7XG5cbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuaGlkZGVuKCk7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmRpcmVjdGlvbigpO1xuXG4gICAgICAgICAgICBtb2R1bGUuc3RhcnQuYW5pbWF0aW9uKGFuaW1hdGlvbkNsYXNzKTtcblxuICAgICAgICAgIH0sXG4gICAgICAgICAgZHVyYXRpb246IGZ1bmN0aW9uKGFuaW1hdGlvbk5hbWUsIGR1cmF0aW9uKSB7XG4gICAgICAgICAgICBkdXJhdGlvbiA9IGR1cmF0aW9uIHx8IHNldHRpbmdzLmR1cmF0aW9uO1xuICAgICAgICAgICAgZHVyYXRpb24gPSAodHlwZW9mIGR1cmF0aW9uID09ICdudW1iZXInKVxuICAgICAgICAgICAgICA/IGR1cmF0aW9uICsgJ21zJ1xuICAgICAgICAgICAgICA6IGR1cmF0aW9uXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihkdXJhdGlvbiB8fCBkdXJhdGlvbiA9PT0gMCkge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2V0dGluZyBhbmltYXRpb24gZHVyYXRpb24nLCBkdXJhdGlvbik7XG4gICAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgICAgICdhbmltYXRpb24tZHVyYXRpb24nOiAgZHVyYXRpb25cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXJlY3Rpb246IGZ1bmN0aW9uKGRpcmVjdGlvbikge1xuICAgICAgICAgICAgZGlyZWN0aW9uID0gZGlyZWN0aW9uIHx8IG1vZHVsZS5nZXQuZGlyZWN0aW9uKCk7XG4gICAgICAgICAgICBpZihkaXJlY3Rpb24gPT0gY2xhc3NOYW1lLmlud2FyZCkge1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0Lmlud2FyZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXQub3V0d2FyZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbG9vcGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1RyYW5zaXRpb24gc2V0IHRvIGxvb3AnKTtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5sb29waW5nKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaGlkZGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS50cmFuc2l0aW9uKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLmhpZGRlbilcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGlud2FyZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgZGlyZWN0aW9uIHRvIGlud2FyZCcpO1xuICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLm91dHdhcmQpXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuaW53YXJkKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb3V0d2FyZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgZGlyZWN0aW9uIHRvIG91dHdhcmQnKTtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5pbndhcmQpXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUub3V0d2FyZClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZpc2libGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLnRyYW5zaXRpb24pXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUudmlzaWJsZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RhcnQ6IHtcbiAgICAgICAgICBhbmltYXRpb246IGZ1bmN0aW9uKGFuaW1hdGlvbkNsYXNzKSB7XG4gICAgICAgICAgICBhbmltYXRpb25DbGFzcyA9IGFuaW1hdGlvbkNsYXNzIHx8IG1vZHVsZS5nZXQuYW5pbWF0aW9uQ2xhc3MoKTtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU3RhcnRpbmcgdHdlZW4nLCBhbmltYXRpb25DbGFzcyk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhhbmltYXRpb25DbGFzcylcbiAgICAgICAgICAgICAgLm9uZShhbmltYXRpb25FbmQgKyAnLmNvbXBsZXRlJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuY29tcGxldGUpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy51c2VGYWlsU2FmZSkge1xuICAgICAgICAgICAgICBtb2R1bGUuYWRkLmZhaWxTYWZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuc2V0LmR1cmF0aW9uKHNldHRpbmdzLmR1cmF0aW9uKTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uU3RhcnQuY2FsbChlbGVtZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2F2ZToge1xuICAgICAgICAgIGFuaW1hdGlvbjogZnVuY3Rpb24oYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICBpZighbW9kdWxlLmNhY2hlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5jYWNoZSA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLmNhY2hlLmFuaW1hdGlvbiA9IGFuaW1hdGlvbjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpc3BsYXlUeXBlOiBmdW5jdGlvbihkaXNwbGF5VHlwZSkge1xuICAgICAgICAgICAgaWYoZGlzcGxheVR5cGUgIT09ICdub25lJykge1xuICAgICAgICAgICAgICAkbW9kdWxlLmRhdGEobWV0YWRhdGEuZGlzcGxheVR5cGUsIGRpc3BsYXlUeXBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRyYW5zaXRpb25FeGlzdHM6IGZ1bmN0aW9uKGFuaW1hdGlvbiwgZXhpc3RzKSB7XG4gICAgICAgICAgICAkLmZuLnRyYW5zaXRpb24uZXhpc3RzW2FuaW1hdGlvbl0gPSBleGlzdHM7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2F2aW5nIGV4aXN0ZW5jZSBvZiB0cmFuc2l0aW9uJywgYW5pbWF0aW9uLCBleGlzdHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZXN0b3JlOiB7XG4gICAgICAgICAgY29uZGl0aW9uczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgYW5pbWF0aW9uID0gbW9kdWxlLmdldC5jdXJyZW50QW5pbWF0aW9uKClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKGFuaW1hdGlvbikge1xuICAgICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGFuaW1hdGlvbilcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3ZpbmcgYW5pbWF0aW9uIGNsYXNzJywgbW9kdWxlLmNhY2hlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuZHVyYXRpb24oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWRkOiB7XG4gICAgICAgICAgZmFpbFNhZmU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGR1cmF0aW9uID0gbW9kdWxlLmdldC5kdXJhdGlvbigpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBtb2R1bGUudGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAkbW9kdWxlLnRyaWdnZXJIYW5kbGVyKGFuaW1hdGlvbkVuZCk7XG4gICAgICAgICAgICB9LCBkdXJhdGlvbiArIHNldHRpbmdzLmZhaWxTYWZlRGVsYXkpO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0FkZGluZyBmYWlsIHNhZmUgdGltZXInLCBtb2R1bGUudGltZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICByZW1vdmU6IHtcbiAgICAgICAgICBhbmltYXRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5yZW1vdmVDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFuaW1hdGlvbkNhbGxiYWNrczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnF1ZXVlQ2FsbGJhY2soKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUuY29tcGxldGVDYWxsYmFjaygpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcXVldWVDYWxsYmFjazogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLm9mZignLnF1ZXVlJyArIGV2ZW50TmFtZXNwYWNlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGNvbXBsZXRlQ2FsbGJhY2s6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJG1vZHVsZS5vZmYoJy5jb21wbGV0ZScgKyBldmVudE5hbWVzcGFjZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNwbGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGUuY3NzKCdkaXNwbGF5JywgJycpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlyZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5pbndhcmQpXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUub3V0d2FyZClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGR1cmF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJywgJycpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmYWlsU2FmZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnUmVtb3ZpbmcgZmFpbCBzYWZlIHRpbWVyJywgbW9kdWxlLnRpbWVyKTtcbiAgICAgICAgICAgIGlmKG1vZHVsZS50aW1lcikge1xuICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnRpbWVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGhpZGRlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5oaWRkZW4pO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmlzaWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS52aXNpYmxlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGxvb3Bpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdUcmFuc2l0aW9ucyBhcmUgbm8gbG9uZ2VyIGxvb3BpbmcnKTtcbiAgICAgICAgICAgIGlmKCBtb2R1bGUuaXMubG9vcGluZygpICkge1xuICAgICAgICAgICAgICBtb2R1bGUucmVzZXQoKTtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUubG9vcGluZylcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdHJhbnNpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUudmlzaWJsZSlcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5oaWRkZW4pXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBnZXQ6IHtcbiAgICAgICAgICBzZXR0aW5nczogZnVuY3Rpb24oYW5pbWF0aW9uLCBkdXJhdGlvbiwgb25Db21wbGV0ZSkge1xuICAgICAgICAgICAgLy8gc2luZ2xlIHNldHRpbmdzIG9iamVjdFxuICAgICAgICAgICAgaWYodHlwZW9mIGFuaW1hdGlvbiA9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICByZXR1cm4gJC5leHRlbmQodHJ1ZSwge30sICQuZm4udHJhbnNpdGlvbi5zZXR0aW5ncywgYW5pbWF0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGFsbCBhcmd1bWVudHMgcHJvdmlkZWRcbiAgICAgICAgICAgIGVsc2UgaWYodHlwZW9mIG9uQ29tcGxldGUgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICByZXR1cm4gJC5leHRlbmQoe30sICQuZm4udHJhbnNpdGlvbi5zZXR0aW5ncywge1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbiAgOiBhbmltYXRpb24sXG4gICAgICAgICAgICAgICAgb25Db21wbGV0ZSA6IG9uQ29tcGxldGUsXG4gICAgICAgICAgICAgICAgZHVyYXRpb24gICA6IGR1cmF0aW9uXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gb25seSBkdXJhdGlvbiBwcm92aWRlZFxuICAgICAgICAgICAgZWxzZSBpZih0eXBlb2YgZHVyYXRpb24gPT0gJ3N0cmluZycgfHwgdHlwZW9mIGR1cmF0aW9uID09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgIHJldHVybiAkLmV4dGVuZCh7fSwgJC5mbi50cmFuc2l0aW9uLnNldHRpbmdzLCB7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uIDogYW5pbWF0aW9uLFxuICAgICAgICAgICAgICAgIGR1cmF0aW9uICA6IGR1cmF0aW9uXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZHVyYXRpb24gaXMgYWN0dWFsbHkgc2V0dGluZ3Mgb2JqZWN0XG4gICAgICAgICAgICBlbHNlIGlmKHR5cGVvZiBkdXJhdGlvbiA9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICByZXR1cm4gJC5leHRlbmQoe30sICQuZm4udHJhbnNpdGlvbi5zZXR0aW5ncywgZHVyYXRpb24sIHtcbiAgICAgICAgICAgICAgICBhbmltYXRpb24gOiBhbmltYXRpb25cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBkdXJhdGlvbiBpcyBhY3R1YWxseSBjYWxsYmFja1xuICAgICAgICAgICAgZWxzZSBpZih0eXBlb2YgZHVyYXRpb24gPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICByZXR1cm4gJC5leHRlbmQoe30sICQuZm4udHJhbnNpdGlvbi5zZXR0aW5ncywge1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbiAgOiBhbmltYXRpb24sXG4gICAgICAgICAgICAgICAgb25Db21wbGV0ZSA6IGR1cmF0aW9uXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gb25seSBhbmltYXRpb24gcHJvdmlkZWRcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gJC5leHRlbmQoe30sICQuZm4udHJhbnNpdGlvbi5zZXR0aW5ncywge1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbiA6IGFuaW1hdGlvblxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGFuaW1hdGlvbkNsYXNzOiBmdW5jdGlvbihhbmltYXRpb24pIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBhbmltYXRpb25DbGFzcyA9IGFuaW1hdGlvbiB8fCBzZXR0aW5ncy5hbmltYXRpb24sXG4gICAgICAgICAgICAgIGRpcmVjdGlvbkNsYXNzID0gKG1vZHVsZS5jYW4udHJhbnNpdGlvbigpICYmICFtb2R1bGUuaGFzLmRpcmVjdGlvbigpKVxuICAgICAgICAgICAgICAgID8gbW9kdWxlLmdldC5kaXJlY3Rpb24oKSArICcgJ1xuICAgICAgICAgICAgICAgIDogJydcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiBjbGFzc05hbWUuYW5pbWF0aW5nICsgJyAnXG4gICAgICAgICAgICAgICsgY2xhc3NOYW1lLnRyYW5zaXRpb24gKyAnICdcbiAgICAgICAgICAgICAgKyBkaXJlY3Rpb25DbGFzc1xuICAgICAgICAgICAgICArIGFuaW1hdGlvbkNsYXNzXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjdXJyZW50QW5pbWF0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAobW9kdWxlLmNhY2hlICYmIG1vZHVsZS5jYWNoZS5hbmltYXRpb24gIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyBtb2R1bGUuY2FjaGUuYW5pbWF0aW9uXG4gICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGN1cnJlbnREaXJlY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS5pcy5pbndhcmQoKVxuICAgICAgICAgICAgICA/IGNsYXNzTmFtZS5pbndhcmRcbiAgICAgICAgICAgICAgOiBjbGFzc05hbWUub3V0d2FyZFxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlyZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBtb2R1bGUuaXMuaGlkZGVuKCkgfHwgIW1vZHVsZS5pcy52aXNpYmxlKClcbiAgICAgICAgICAgICAgPyBjbGFzc05hbWUuaW53YXJkXG4gICAgICAgICAgICAgIDogY2xhc3NOYW1lLm91dHdhcmRcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFuaW1hdGlvbkRpcmVjdGlvbjogZnVuY3Rpb24oYW5pbWF0aW9uKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZGlyZWN0aW9uXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBhbmltYXRpb24gPSBhbmltYXRpb24gfHwgc2V0dGluZ3MuYW5pbWF0aW9uO1xuICAgICAgICAgICAgaWYodHlwZW9mIGFuaW1hdGlvbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgYW5pbWF0aW9uID0gYW5pbWF0aW9uLnNwbGl0KCcgJyk7XG4gICAgICAgICAgICAgIC8vIHNlYXJjaCBhbmltYXRpb24gbmFtZSBmb3Igb3V0L2luIGNsYXNzXG4gICAgICAgICAgICAgICQuZWFjaChhbmltYXRpb24sIGZ1bmN0aW9uKGluZGV4LCB3b3JkKXtcbiAgICAgICAgICAgICAgICBpZih3b3JkID09PSBjbGFzc05hbWUuaW53YXJkKSB7XG4gICAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBjbGFzc05hbWUuaW53YXJkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmKHdvcmQgPT09IGNsYXNzTmFtZS5vdXR3YXJkKSB7XG4gICAgICAgICAgICAgICAgICBkaXJlY3Rpb24gPSBjbGFzc05hbWUub3V0d2FyZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gcmV0dXJuIGZvdW5kIGRpcmVjdGlvblxuICAgICAgICAgICAgaWYoZGlyZWN0aW9uKSB7XG4gICAgICAgICAgICAgIHJldHVybiBkaXJlY3Rpb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkdXJhdGlvbjogZnVuY3Rpb24oZHVyYXRpb24pIHtcbiAgICAgICAgICAgIGR1cmF0aW9uID0gZHVyYXRpb24gfHwgc2V0dGluZ3MuZHVyYXRpb247XG4gICAgICAgICAgICBpZihkdXJhdGlvbiA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgZHVyYXRpb24gPSAkbW9kdWxlLmNzcygnYW5pbWF0aW9uLWR1cmF0aW9uJykgfHwgMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAodHlwZW9mIGR1cmF0aW9uID09PSAnc3RyaW5nJylcbiAgICAgICAgICAgICAgPyAoZHVyYXRpb24uaW5kZXhPZignbXMnKSA+IC0xKVxuICAgICAgICAgICAgICAgID8gcGFyc2VGbG9hdChkdXJhdGlvbilcbiAgICAgICAgICAgICAgICA6IHBhcnNlRmxvYXQoZHVyYXRpb24pICogMTAwMFxuICAgICAgICAgICAgICA6IGR1cmF0aW9uXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNwbGF5VHlwZTogZnVuY3Rpb24oc2hvdWxkRGV0ZXJtaW5lKSB7XG4gICAgICAgICAgICBzaG91bGREZXRlcm1pbmUgPSAoc2hvdWxkRGV0ZXJtaW5lICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgID8gc2hvdWxkRGV0ZXJtaW5lXG4gICAgICAgICAgICAgIDogdHJ1ZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuZGlzcGxheVR5cGUpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzLmRpc3BsYXlUeXBlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoc2hvdWxkRGV0ZXJtaW5lICYmICRtb2R1bGUuZGF0YShtZXRhZGF0YS5kaXNwbGF5VHlwZSkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAvLyBjcmVhdGUgZmFrZSBlbGVtZW50IHRvIGRldGVybWluZSBkaXNwbGF5IHN0YXRlXG4gICAgICAgICAgICAgIG1vZHVsZS5jYW4udHJhbnNpdGlvbih0cnVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkbW9kdWxlLmRhdGEobWV0YWRhdGEuZGlzcGxheVR5cGUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdXNlclN0eWxlOiBmdW5jdGlvbihzdHlsZSkge1xuICAgICAgICAgICAgc3R5bGUgPSBzdHlsZSB8fCAkbW9kdWxlLmF0dHIoJ3N0eWxlJykgfHwgJyc7XG4gICAgICAgICAgICByZXR1cm4gc3R5bGUucmVwbGFjZSgvZGlzcGxheS4qPzsvLCAnJyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0cmFuc2l0aW9uRXhpc3RzOiBmdW5jdGlvbihhbmltYXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiAkLmZuLnRyYW5zaXRpb24uZXhpc3RzW2FuaW1hdGlvbl07XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhbmltYXRpb25TdGFydEV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBlbGVtZW50ICAgICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLFxuICAgICAgICAgICAgICBhbmltYXRpb25zICA9IHtcbiAgICAgICAgICAgICAgICAnYW5pbWF0aW9uJyAgICAgICA6J2FuaW1hdGlvbnN0YXJ0JyxcbiAgICAgICAgICAgICAgICAnT0FuaW1hdGlvbicgICAgICA6J29BbmltYXRpb25TdGFydCcsXG4gICAgICAgICAgICAgICAgJ01vekFuaW1hdGlvbicgICAgOidtb3pBbmltYXRpb25TdGFydCcsXG4gICAgICAgICAgICAgICAgJ1dlYmtpdEFuaW1hdGlvbicgOid3ZWJraXRBbmltYXRpb25TdGFydCdcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgYW5pbWF0aW9uXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBmb3IoYW5pbWF0aW9uIGluIGFuaW1hdGlvbnMpe1xuICAgICAgICAgICAgICBpZiggZWxlbWVudC5zdHlsZVthbmltYXRpb25dICE9PSB1bmRlZmluZWQgKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gYW5pbWF0aW9uc1thbmltYXRpb25dO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBhbmltYXRpb25FbmRFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZWxlbWVudCAgICAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcbiAgICAgICAgICAgICAgYW5pbWF0aW9ucyAgPSB7XG4gICAgICAgICAgICAgICAgJ2FuaW1hdGlvbicgICAgICAgOidhbmltYXRpb25lbmQnLFxuICAgICAgICAgICAgICAgICdPQW5pbWF0aW9uJyAgICAgIDonb0FuaW1hdGlvbkVuZCcsXG4gICAgICAgICAgICAgICAgJ01vekFuaW1hdGlvbicgICAgOidtb3pBbmltYXRpb25FbmQnLFxuICAgICAgICAgICAgICAgICdXZWJraXRBbmltYXRpb24nIDond2Via2l0QW5pbWF0aW9uRW5kJ1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBhbmltYXRpb25cbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGZvcihhbmltYXRpb24gaW4gYW5pbWF0aW9ucyl7XG4gICAgICAgICAgICAgIGlmKCBlbGVtZW50LnN0eWxlW2FuaW1hdGlvbl0gIT09IHVuZGVmaW5lZCApe1xuICAgICAgICAgICAgICAgIHJldHVybiBhbmltYXRpb25zW2FuaW1hdGlvbl07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICBjYW46IHtcbiAgICAgICAgICB0cmFuc2l0aW9uOiBmdW5jdGlvbihmb3JjZWQpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBhbmltYXRpb24gICAgICAgICA9IHNldHRpbmdzLmFuaW1hdGlvbixcbiAgICAgICAgICAgICAgdHJhbnNpdGlvbkV4aXN0cyAgPSBtb2R1bGUuZ2V0LnRyYW5zaXRpb25FeGlzdHMoYW5pbWF0aW9uKSxcbiAgICAgICAgICAgICAgZGlzcGxheVR5cGUgICAgICAgPSBtb2R1bGUuZ2V0LmRpc3BsYXlUeXBlKGZhbHNlKSxcbiAgICAgICAgICAgICAgZWxlbWVudENsYXNzLFxuICAgICAgICAgICAgICB0YWdOYW1lLFxuICAgICAgICAgICAgICAkY2xvbmUsXG4gICAgICAgICAgICAgIGN1cnJlbnRBbmltYXRpb24sXG4gICAgICAgICAgICAgIGluQW5pbWF0aW9uLFxuICAgICAgICAgICAgICBkaXJlY3Rpb25FeGlzdHNcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCB0cmFuc2l0aW9uRXhpc3RzID09PSB1bmRlZmluZWQgfHwgZm9yY2VkKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXRlcm1pbmluZyB3aGV0aGVyIGFuaW1hdGlvbiBleGlzdHMnKTtcbiAgICAgICAgICAgICAgZWxlbWVudENsYXNzID0gJG1vZHVsZS5hdHRyKCdjbGFzcycpO1xuICAgICAgICAgICAgICB0YWdOYW1lICAgICAgPSAkbW9kdWxlLnByb3AoJ3RhZ05hbWUnKTtcblxuICAgICAgICAgICAgICAkY2xvbmUgPSAkKCc8JyArIHRhZ05hbWUgKyAnIC8+JykuYWRkQ2xhc3MoIGVsZW1lbnRDbGFzcyApLmluc2VydEFmdGVyKCRtb2R1bGUpO1xuICAgICAgICAgICAgICBjdXJyZW50QW5pbWF0aW9uID0gJGNsb25lXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKGFuaW1hdGlvbilcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmlud2FyZClcbiAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLm91dHdhcmQpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5hbmltYXRpbmcpXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS50cmFuc2l0aW9uKVxuICAgICAgICAgICAgICAgIC5jc3MoJ2FuaW1hdGlvbk5hbWUnKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGluQW5pbWF0aW9uID0gJGNsb25lXG4gICAgICAgICAgICAgICAgLmFkZENsYXNzKGNsYXNzTmFtZS5pbndhcmQpXG4gICAgICAgICAgICAgICAgLmNzcygnYW5pbWF0aW9uTmFtZScpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoIWRpc3BsYXlUeXBlKSB7XG4gICAgICAgICAgICAgICAgZGlzcGxheVR5cGUgPSAkY2xvbmVcbiAgICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsIGVsZW1lbnRDbGFzcylcbiAgICAgICAgICAgICAgICAgIC5yZW1vdmVBdHRyKCdzdHlsZScpXG4gICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoY2xhc3NOYW1lLmhpZGRlbilcbiAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcyhjbGFzc05hbWUudmlzaWJsZSlcbiAgICAgICAgICAgICAgICAgIC5zaG93KClcbiAgICAgICAgICAgICAgICAgIC5jc3MoJ2Rpc3BsYXknKVxuICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRGV0ZXJtaW5pbmcgZmluYWwgZGlzcGxheSBzdGF0ZScsIGRpc3BsYXlUeXBlKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuc2F2ZS5kaXNwbGF5VHlwZShkaXNwbGF5VHlwZSk7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAkY2xvbmUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgIGlmKGN1cnJlbnRBbmltYXRpb24gIT0gaW5BbmltYXRpb24pIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0RpcmVjdGlvbiBleGlzdHMgZm9yIGFuaW1hdGlvbicsIGFuaW1hdGlvbik7XG4gICAgICAgICAgICAgICAgZGlyZWN0aW9uRXhpc3RzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKGN1cnJlbnRBbmltYXRpb24gPT0gJ25vbmUnIHx8ICFjdXJyZW50QW5pbWF0aW9uKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdObyBhbmltYXRpb24gZGVmaW5lZCBpbiBjc3MnLCBhbmltYXRpb24pO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1N0YXRpYyBhbmltYXRpb24gZm91bmQnLCBhbmltYXRpb24sIGRpc3BsYXlUeXBlKTtcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb25FeGlzdHMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBtb2R1bGUuc2F2ZS50cmFuc2l0aW9uRXhpc3RzKGFuaW1hdGlvbiwgZGlyZWN0aW9uRXhpc3RzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAodHJhbnNpdGlvbkV4aXN0cyAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICA/IHRyYW5zaXRpb25FeGlzdHNcbiAgICAgICAgICAgICAgOiBkaXJlY3Rpb25FeGlzdHNcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFuaW1hdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgLy8gY2FuIHRyYW5zaXRpb24gZG9lcyBub3QgcmV0dXJuIGEgdmFsdWUgaWYgYW5pbWF0aW9uIGRvZXMgbm90IGV4aXN0XG4gICAgICAgICAgICByZXR1cm4gKG1vZHVsZS5jYW4udHJhbnNpdGlvbigpICE9PSB1bmRlZmluZWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpczoge1xuICAgICAgICAgIGFuaW1hdGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUuYW5pbWF0aW5nKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGlud2FyZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUuaW53YXJkKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG91dHdhcmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLm91dHdhcmQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbG9vcGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5oYXNDbGFzcyhjbGFzc05hbWUubG9vcGluZyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvY2N1cnJpbmc6IGZ1bmN0aW9uKGFuaW1hdGlvbikge1xuICAgICAgICAgICAgYW5pbWF0aW9uID0gYW5pbWF0aW9uIHx8IHNldHRpbmdzLmFuaW1hdGlvbjtcbiAgICAgICAgICAgIGFuaW1hdGlvbiA9ICcuJyArIGFuaW1hdGlvbi5yZXBsYWNlKCcgJywgJy4nKTtcbiAgICAgICAgICAgIHJldHVybiAoICRtb2R1bGUuZmlsdGVyKGFuaW1hdGlvbikubGVuZ3RoID4gMCApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmlzaWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5pcygnOnZpc2libGUnKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGhpZGRlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5jc3MoJ3Zpc2liaWxpdHknKSA9PT0gJ2hpZGRlbic7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdXBwb3J0ZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuKGFuaW1hdGlvbkVuZCAhPT0gZmFsc2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBoaWRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnSGlkaW5nIGVsZW1lbnQnKTtcbiAgICAgICAgICBpZiggbW9kdWxlLmlzLmFuaW1hdGluZygpICkge1xuICAgICAgICAgICAgbW9kdWxlLnJlc2V0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsZW1lbnQuYmx1cigpOyAvLyBJRSB3aWxsIHRyaWdnZXIgZm9jdXMgY2hhbmdlIGlmIGVsZW1lbnQgaXMgbm90IGJsdXJyZWQgYmVmb3JlIGhpZGluZ1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUuZGlzcGxheSgpO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUudmlzaWJsZSgpO1xuICAgICAgICAgIG1vZHVsZS5zZXQuaGlkZGVuKCk7XG4gICAgICAgICAgbW9kdWxlLmZvcmNlLmhpZGRlbigpO1xuICAgICAgICAgIHNldHRpbmdzLm9uSGlkZS5jYWxsKGVsZW1lbnQpO1xuICAgICAgICAgIHNldHRpbmdzLm9uQ29tcGxldGUuY2FsbChlbGVtZW50KTtcbiAgICAgICAgICAvLyBtb2R1bGUucmVwYWludCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3c6IGZ1bmN0aW9uKGRpc3BsYXkpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2hvd2luZyBlbGVtZW50JywgZGlzcGxheSk7XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS5oaWRkZW4oKTtcbiAgICAgICAgICBtb2R1bGUuc2V0LnZpc2libGUoKTtcbiAgICAgICAgICBtb2R1bGUuZm9yY2UudmlzaWJsZSgpO1xuICAgICAgICAgIHNldHRpbmdzLm9uU2hvdy5jYWxsKGVsZW1lbnQpO1xuICAgICAgICAgIHNldHRpbmdzLm9uQ29tcGxldGUuY2FsbChlbGVtZW50KTtcbiAgICAgICAgICAvLyBtb2R1bGUucmVwYWludCgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHRvZ2dsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIG1vZHVsZS5pcy52aXNpYmxlKCkgKSB7XG4gICAgICAgICAgICBtb2R1bGUuaGlkZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1vZHVsZS5zaG93KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHN0b3A6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU3RvcHBpbmcgY3VycmVudCBhbmltYXRpb24nKTtcbiAgICAgICAgICAkbW9kdWxlLnRyaWdnZXJIYW5kbGVyKGFuaW1hdGlvbkVuZCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3RvcEFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdTdG9wcGluZyBhbGwgYW5pbWF0aW9uJyk7XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS5xdWV1ZUNhbGxiYWNrKCk7XG4gICAgICAgICAgJG1vZHVsZS50cmlnZ2VySGFuZGxlcihhbmltYXRpb25FbmQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsZWFyOiB7XG4gICAgICAgICAgcXVldWU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDbGVhcmluZyBhbmltYXRpb24gcXVldWUnKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUucXVldWVDYWxsYmFjaygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTdGFydGluZyBhbmltYXRpb24nKTtcbiAgICAgICAgICAkbW9kdWxlLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5kaXNhYmxlZCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGlzYWJsZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdTdG9wcGluZyBhbmltYXRpb24nKTtcbiAgICAgICAgICAkbW9kdWxlLmFkZENsYXNzKGNsYXNzTmFtZS5kaXNhYmxlZCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0dGluZzogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NoYW5naW5nIHNldHRpbmcnLCBuYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZigkLmlzUGxhaW5PYmplY3Qoc2V0dGluZ3NbbmFtZV0pKSB7XG4gICAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzW25hbWVdLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3NbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZ3NbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnRlcm5hbDogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgbW9kdWxlLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBtb2R1bGVbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZGVidWc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1Zy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdmVyYm9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCAmJiBzZXR0aW5ncy52ZXJib3NlICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCkge1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmVycm9yLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvci5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGVyZm9ybWFuY2U6IHtcbiAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjdXJyZW50VGltZSxcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSxcbiAgICAgICAgICAgICAgcHJldmlvdXNUaW1lXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBjdXJyZW50VGltZSAgID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZSAgPSB0aW1lIHx8IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICBleGVjdXRpb25UaW1lID0gY3VycmVudFRpbWUgLSBwcmV2aW91c1RpbWU7XG4gICAgICAgICAgICAgIHRpbWUgICAgICAgICAgPSBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgcGVyZm9ybWFuY2UucHVzaCh7XG4gICAgICAgICAgICAgICAgJ05hbWUnICAgICAgICAgICA6IG1lc3NhZ2VbMF0sXG4gICAgICAgICAgICAgICAgJ0FyZ3VtZW50cycgICAgICA6IFtdLnNsaWNlLmNhbGwobWVzc2FnZSwgMSkgfHwgJycsXG4gICAgICAgICAgICAgICAgJ0VsZW1lbnQnICAgICAgICA6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgJ0V4ZWN1dGlvbiBUaW1lJyA6IGV4ZWN1dGlvblRpbWVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lciA9IHNldFRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLmRpc3BsYXksIDUwMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNwbGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB0aXRsZSA9IHNldHRpbmdzLm5hbWUgKyAnOicsXG4gICAgICAgICAgICAgIHRvdGFsVGltZSA9IDBcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHRpbWUgPSBmYWxzZTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICB0b3RhbFRpbWUgKz0gZGF0YVsnRXhlY3V0aW9uIFRpbWUnXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGl0bGUgKz0gJyAnICsgdG90YWxUaW1lICsgJ21zJztcbiAgICAgICAgICAgIGlmKG1vZHVsZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgIHRpdGxlICs9ICcgXFwnJyArIG1vZHVsZVNlbGVjdG9yICsgJ1xcJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZigkYWxsTW9kdWxlcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgIHRpdGxlICs9ICcgJyArICcoJyArICRhbGxNb2R1bGVzLmxlbmd0aCArICcpJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKCAoY29uc29sZS5ncm91cCAhPT0gdW5kZWZpbmVkIHx8IGNvbnNvbGUudGFibGUgIT09IHVuZGVmaW5lZCkgJiYgcGVyZm9ybWFuY2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKHRpdGxlKTtcbiAgICAgICAgICAgICAgaWYoY29uc29sZS50YWJsZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUudGFibGUocGVyZm9ybWFuY2UpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICQuZWFjaChwZXJmb3JtYW5jZSwgZnVuY3Rpb24oaW5kZXgsIGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGRhdGFbJ05hbWUnXSArICc6ICcgKyBkYXRhWydFeGVjdXRpb24gVGltZSddKydtcycpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBFbmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHBlcmZvcm1hbmNlID0gW107XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICAvLyBtb2RpZmllZCBmb3IgdHJhbnNpdGlvbiB0byByZXR1cm4gaW52b2tlIHN1Y2Nlc3NcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCAkLmlzRnVuY3Rpb24oIGZvdW5kICkgKSB7XG4gICAgICAgICAgICByZXNwb25zZSA9IGZvdW5kLmFwcGx5KGNvbnRleHQsIHBhc3NlZEFyZ3VtZW50cyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoZm91bmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZigkLmlzQXJyYXkocmV0dXJuZWRWYWx1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUucHVzaChyZXNwb25zZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYocmV0dXJuZWRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlID0gW3JldHVybmVkVmFsdWUsIHJlc3BvbnNlXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm5lZFZhbHVlID0gcmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiAoZm91bmQgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgID8gZm91bmRcbiAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICA7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgIH0pXG4gIDtcbiAgcmV0dXJuIChyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpXG4gICAgPyByZXR1cm5lZFZhbHVlXG4gICAgOiB0aGlzXG4gIDtcbn07XG5cbi8vIFJlY29yZHMgaWYgQ1NTIHRyYW5zaXRpb24gaXMgYXZhaWxhYmxlXG4kLmZuLnRyYW5zaXRpb24uZXhpc3RzID0ge307XG5cbiQuZm4udHJhbnNpdGlvbi5zZXR0aW5ncyA9IHtcblxuICAvLyBtb2R1bGUgaW5mb1xuICBuYW1lICAgICAgICAgIDogJ1RyYW5zaXRpb24nLFxuXG4gIC8vIGhpZGUgYWxsIG91dHB1dCBmcm9tIHRoaXMgY29tcG9uZW50IHJlZ2FyZGxlc3Mgb2Ygb3RoZXIgc2V0dGluZ3NcbiAgc2lsZW50ICAgICAgICA6IGZhbHNlLFxuXG4gIC8vIGRlYnVnIGNvbnRlbnQgb3V0cHV0dGVkIHRvIGNvbnNvbGVcbiAgZGVidWcgICAgICAgICA6IGZhbHNlLFxuXG4gIC8vIHZlcmJvc2UgZGVidWcgb3V0cHV0XG4gIHZlcmJvc2UgICAgICAgOiBmYWxzZSxcblxuICAvLyBwZXJmb3JtYW5jZSBkYXRhIG91dHB1dFxuICBwZXJmb3JtYW5jZSAgIDogdHJ1ZSxcblxuICAvLyBldmVudCBuYW1lc3BhY2VcbiAgbmFtZXNwYWNlICAgICA6ICd0cmFuc2l0aW9uJyxcblxuICAvLyBkZWxheSBiZXR3ZWVuIGFuaW1hdGlvbnMgaW4gZ3JvdXBcbiAgaW50ZXJ2YWwgICAgICA6IDAsXG5cbiAgLy8gd2hldGhlciBncm91cCBhbmltYXRpb25zIHNob3VsZCBiZSByZXZlcnNlZFxuICByZXZlcnNlICAgICAgIDogJ2F1dG8nLFxuXG4gIC8vIGFuaW1hdGlvbiBjYWxsYmFjayBldmVudFxuICBvblN0YXJ0ICAgICAgIDogZnVuY3Rpb24oKSB7fSxcbiAgb25Db21wbGV0ZSAgICA6IGZ1bmN0aW9uKCkge30sXG4gIG9uU2hvdyAgICAgICAgOiBmdW5jdGlvbigpIHt9LFxuICBvbkhpZGUgICAgICAgIDogZnVuY3Rpb24oKSB7fSxcblxuICAvLyB3aGV0aGVyIHRpbWVvdXQgc2hvdWxkIGJlIHVzZWQgdG8gZW5zdXJlIGNhbGxiYWNrIGZpcmVzIGluIGNhc2VzIGFuaW1hdGlvbmVuZCBkb2VzIG5vdFxuICB1c2VGYWlsU2FmZSAgIDogdHJ1ZSxcblxuICAvLyBkZWxheSBpbiBtcyBmb3IgZmFpbCBzYWZlXG4gIGZhaWxTYWZlRGVsYXkgOiAxMDAsXG5cbiAgLy8gd2hldGhlciBFWEFDVCBhbmltYXRpb24gY2FuIG9jY3VyIHR3aWNlIGluIGEgcm93XG4gIGFsbG93UmVwZWF0cyAgOiBmYWxzZSxcblxuICAvLyBPdmVycmlkZSBmaW5hbCBkaXNwbGF5IHR5cGUgb24gdmlzaWJsZVxuICBkaXNwbGF5VHlwZSAgIDogZmFsc2UsXG5cbiAgLy8gYW5pbWF0aW9uIGR1cmF0aW9uXG4gIGFuaW1hdGlvbiAgICAgOiAnZmFkZScsXG4gIGR1cmF0aW9uICAgICAgOiBmYWxzZSxcblxuICAvLyBuZXcgYW5pbWF0aW9ucyB3aWxsIG9jY3VyIGFmdGVyIHByZXZpb3VzIG9uZXNcbiAgcXVldWUgICAgICAgICA6IHRydWUsXG5cbiAgbWV0YWRhdGEgOiB7XG4gICAgZGlzcGxheVR5cGU6ICdkaXNwbGF5J1xuICB9LFxuXG4gIGNsYXNzTmFtZSAgIDoge1xuICAgIGFuaW1hdGluZyAgOiAnYW5pbWF0aW5nJyxcbiAgICBkaXNhYmxlZCAgIDogJ2Rpc2FibGVkJyxcbiAgICBoaWRkZW4gICAgIDogJ2hpZGRlbicsXG4gICAgaW53YXJkICAgICA6ICdpbicsXG4gICAgbG9hZGluZyAgICA6ICdsb2FkaW5nJyxcbiAgICBsb29waW5nICAgIDogJ2xvb3BpbmcnLFxuICAgIG91dHdhcmQgICAgOiAnb3V0JyxcbiAgICB0cmFuc2l0aW9uIDogJ3RyYW5zaXRpb24nLFxuICAgIHZpc2libGUgICAgOiAndmlzaWJsZSdcbiAgfSxcblxuICAvLyBwb3NzaWJsZSBlcnJvcnNcbiAgZXJyb3I6IHtcbiAgICBub0FuaW1hdGlvbiA6ICdFbGVtZW50IGlzIG5vIGxvbmdlciBhdHRhY2hlZCB0byBET00uIFVuYWJsZSB0byBhbmltYXRlLiAgVXNlIHNpbGVudCBzZXR0aW5nIHRvIHN1cnByZXNzIHRoaXMgd2FybmluZyBpbiBwcm9kdWN0aW9uLicsXG4gICAgcmVwZWF0ZWQgICAgOiAnVGhhdCBhbmltYXRpb24gaXMgYWxyZWFkeSBvY2N1cnJpbmcsIGNhbmNlbGxpbmcgcmVwZWF0ZWQgYW5pbWF0aW9uJyxcbiAgICBtZXRob2QgICAgICA6ICdUaGUgbWV0aG9kIHlvdSBjYWxsZWQgaXMgbm90IGRlZmluZWQnLFxuICAgIHN1cHBvcnQgICAgIDogJ1RoaXMgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IENTUyBhbmltYXRpb25zJ1xuICB9XG5cbn07XG5cblxufSkoIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCApO1xuXG4vKiFcbiAqICMgU2VtYW50aWMgVUkgMi40LjAgLSBBUElcbiAqIGh0dHA6Ly9naXRodWIuY29tL3NlbWFudGljLW9yZy9zZW1hbnRpYy11aS9cbiAqXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG5cbjsoZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG4ndXNlIHN0cmljdCc7XG5cbnZhclxuICB3aW5kb3cgPSAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoKVxuICAgID8gd2luZG93XG4gICAgOiAodHlwZW9mIHNlbGYgIT0gJ3VuZGVmaW5lZCcgJiYgc2VsZi5NYXRoID09IE1hdGgpXG4gICAgICA/IHNlbGZcbiAgICAgIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKVxuO1xuXG4kLmFwaSA9ICQuZm4uYXBpID0gZnVuY3Rpb24ocGFyYW1ldGVycykge1xuXG4gIHZhclxuICAgIC8vIHVzZSB3aW5kb3cgY29udGV4dCBpZiBub25lIHNwZWNpZmllZFxuICAgICRhbGxNb2R1bGVzICAgICA9ICQuaXNGdW5jdGlvbih0aGlzKVxuICAgICAgICA/ICQod2luZG93KVxuICAgICAgICA6ICQodGhpcyksXG4gICAgbW9kdWxlU2VsZWN0b3IgPSAkYWxsTW9kdWxlcy5zZWxlY3RvciB8fCAnJyxcbiAgICB0aW1lICAgICAgICAgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxuICAgIHBlcmZvcm1hbmNlICAgID0gW10sXG5cbiAgICBxdWVyeSAgICAgICAgICA9IGFyZ3VtZW50c1swXSxcbiAgICBtZXRob2RJbnZva2VkICA9ICh0eXBlb2YgcXVlcnkgPT0gJ3N0cmluZycpLFxuICAgIHF1ZXJ5QXJndW1lbnRzID0gW10uc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpLFxuXG4gICAgcmV0dXJuZWRWYWx1ZVxuICA7XG5cbiAgJGFsbE1vZHVsZXNcbiAgICAuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgIHZhclxuICAgICAgICBzZXR0aW5ncyAgICAgICAgICA9ICggJC5pc1BsYWluT2JqZWN0KHBhcmFtZXRlcnMpIClcbiAgICAgICAgICA/ICQuZXh0ZW5kKHRydWUsIHt9LCAkLmZuLmFwaS5zZXR0aW5ncywgcGFyYW1ldGVycylcbiAgICAgICAgICA6ICQuZXh0ZW5kKHt9LCAkLmZuLmFwaS5zZXR0aW5ncyksXG5cbiAgICAgICAgLy8gaW50ZXJuYWwgYWxpYXNlc1xuICAgICAgICBuYW1lc3BhY2UgICAgICAgPSBzZXR0aW5ncy5uYW1lc3BhY2UsXG4gICAgICAgIG1ldGFkYXRhICAgICAgICA9IHNldHRpbmdzLm1ldGFkYXRhLFxuICAgICAgICBzZWxlY3RvciAgICAgICAgPSBzZXR0aW5ncy5zZWxlY3RvcixcbiAgICAgICAgZXJyb3IgICAgICAgICAgID0gc2V0dGluZ3MuZXJyb3IsXG4gICAgICAgIGNsYXNzTmFtZSAgICAgICA9IHNldHRpbmdzLmNsYXNzTmFtZSxcblxuICAgICAgICAvLyBkZWZpbmUgbmFtZXNwYWNlcyBmb3IgbW9kdWxlc1xuICAgICAgICBldmVudE5hbWVzcGFjZSAgPSAnLicgKyBuYW1lc3BhY2UsXG4gICAgICAgIG1vZHVsZU5hbWVzcGFjZSA9ICdtb2R1bGUtJyArIG5hbWVzcGFjZSxcblxuICAgICAgICAvLyBlbGVtZW50IHRoYXQgY3JlYXRlcyByZXF1ZXN0XG4gICAgICAgICRtb2R1bGUgICAgICAgICA9ICQodGhpcyksXG4gICAgICAgICRmb3JtICAgICAgICAgICA9ICRtb2R1bGUuY2xvc2VzdChzZWxlY3Rvci5mb3JtKSxcblxuICAgICAgICAvLyBjb250ZXh0IHVzZWQgZm9yIHN0YXRlXG4gICAgICAgICRjb250ZXh0ICAgICAgICA9IChzZXR0aW5ncy5zdGF0ZUNvbnRleHQpXG4gICAgICAgICAgPyAkKHNldHRpbmdzLnN0YXRlQ29udGV4dClcbiAgICAgICAgICA6ICRtb2R1bGUsXG5cbiAgICAgICAgLy8gcmVxdWVzdCBkZXRhaWxzXG4gICAgICAgIGFqYXhTZXR0aW5ncyxcbiAgICAgICAgcmVxdWVzdFNldHRpbmdzLFxuICAgICAgICB1cmwsXG4gICAgICAgIGRhdGEsXG4gICAgICAgIHJlcXVlc3RTdGFydFRpbWUsXG5cbiAgICAgICAgLy8gc3RhbmRhcmQgbW9kdWxlXG4gICAgICAgIGVsZW1lbnQgICAgICAgICA9IHRoaXMsXG4gICAgICAgIGNvbnRleHQgICAgICAgICA9ICRjb250ZXh0WzBdLFxuICAgICAgICBpbnN0YW5jZSAgICAgICAgPSAkbW9kdWxlLmRhdGEobW9kdWxlTmFtZXNwYWNlKSxcbiAgICAgICAgbW9kdWxlXG4gICAgICA7XG5cbiAgICAgIG1vZHVsZSA9IHtcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighbWV0aG9kSW52b2tlZCkge1xuICAgICAgICAgICAgbW9kdWxlLmJpbmQuZXZlbnRzKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG1vZHVsZS5pbnN0YW50aWF0ZSgpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluc3RhbnRpYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU3RvcmluZyBpbnN0YW5jZSBvZiBtb2R1bGUnLCBtb2R1bGUpO1xuICAgICAgICAgIGluc3RhbmNlID0gbW9kdWxlO1xuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5kYXRhKG1vZHVsZU5hbWVzcGFjZSwgaW5zdGFuY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIGRlc3Ryb3k6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdEZXN0cm95aW5nIHByZXZpb3VzIG1vZHVsZSBmb3InLCBlbGVtZW50KTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAucmVtb3ZlRGF0YShtb2R1bGVOYW1lc3BhY2UpXG4gICAgICAgICAgICAub2ZmKGV2ZW50TmFtZXNwYWNlKVxuICAgICAgICAgIDtcbiAgICAgICAgfSxcblxuICAgICAgICBiaW5kOiB7XG4gICAgICAgICAgZXZlbnRzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB0cmlnZ2VyRXZlbnQgPSBtb2R1bGUuZ2V0LmV2ZW50KClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKCB0cmlnZ2VyRXZlbnQgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdBdHRhY2hpbmcgQVBJIGV2ZW50cyB0byBlbGVtZW50JywgdHJpZ2dlckV2ZW50KTtcbiAgICAgICAgICAgICAgJG1vZHVsZVxuICAgICAgICAgICAgICAgIC5vbih0cmlnZ2VyRXZlbnQgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LnRyaWdnZXIpXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoc2V0dGluZ3Mub24gPT0gJ25vdycpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdRdWVyeWluZyBBUEkgZW5kcG9pbnQgaW1tZWRpYXRlbHknKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnF1ZXJ5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGRlY29kZToge1xuICAgICAgICAgIGpzb246IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZihyZXNwb25zZSAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiByZXNwb25zZSA9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjYXRjaChlKSB7XG4gICAgICAgICAgICAgICAgLy8gaXNudCBqc29uIHN0cmluZ1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlYWQ6IHtcbiAgICAgICAgICBjYWNoZWRSZXNwb25zZTogZnVuY3Rpb24odXJsKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgcmVzcG9uc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHdpbmRvdy5TdG9yYWdlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm5vU3RvcmFnZSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3BvbnNlID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbSh1cmwpO1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdVc2luZyBjYWNoZWQgcmVzcG9uc2UnLCB1cmwsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gbW9kdWxlLmRlY29kZS5qc29uKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHdyaXRlOiB7XG4gICAgICAgICAgY2FjaGVkUmVzcG9uc2U6IGZ1bmN0aW9uKHVybCwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmKHJlc3BvbnNlICYmIHJlc3BvbnNlID09PSAnJykge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Jlc3BvbnNlIGVtcHR5LCBub3QgY2FjaGluZycsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYod2luZG93LlN0b3JhZ2UgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3Iubm9TdG9yYWdlKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChyZXNwb25zZSkgKSB7XG4gICAgICAgICAgICAgIHJlc3BvbnNlID0gSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbSh1cmwsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTdG9yaW5nIGNhY2hlZCByZXNwb25zZSBmb3IgdXJsJywgdXJsLCByZXNwb25zZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHF1ZXJ5OiBmdW5jdGlvbigpIHtcblxuICAgICAgICAgIGlmKG1vZHVsZS5pcy5kaXNhYmxlZCgpKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0VsZW1lbnQgaXMgZGlzYWJsZWQgQVBJIHJlcXVlc3QgYWJvcnRlZCcpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmKG1vZHVsZS5pcy5sb2FkaW5nKCkpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmludGVycnVwdFJlcXVlc3RzKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW50ZXJydXB0aW5nIHByZXZpb3VzIHJlcXVlc3QnKTtcbiAgICAgICAgICAgICAgbW9kdWxlLmFib3J0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDYW5jZWxsaW5nIHJlcXVlc3QsIHByZXZpb3VzIHJlcXVlc3QgaXMgc3RpbGwgcGVuZGluZycpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gcGFzcyBlbGVtZW50IG1ldGFkYXRhIHRvIHVybCAodmFsdWUsIHRleHQpXG4gICAgICAgICAgaWYoc2V0dGluZ3MuZGVmYXVsdERhdGEpIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLnVybERhdGEsIG1vZHVsZS5nZXQuZGVmYXVsdERhdGEoKSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQWRkIGZvcm0gY29udGVudFxuICAgICAgICAgIGlmKHNldHRpbmdzLnNlcmlhbGl6ZUZvcm0pIHtcbiAgICAgICAgICAgIHNldHRpbmdzLmRhdGEgPSBtb2R1bGUuYWRkLmZvcm1EYXRhKHNldHRpbmdzLmRhdGEpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIGNhbGwgYmVmb3Jlc2VuZCBhbmQgZ2V0IGFueSBzZXR0aW5ncyBjaGFuZ2VzXG4gICAgICAgICAgcmVxdWVzdFNldHRpbmdzID0gbW9kdWxlLmdldC5zZXR0aW5ncygpO1xuXG4gICAgICAgICAgLy8gY2hlY2sgaWYgYmVmb3JlIHNlbmQgY2FuY2VsbGVkIHJlcXVlc3RcbiAgICAgICAgICBpZihyZXF1ZXN0U2V0dGluZ3MgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBtb2R1bGUuY2FuY2VsbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5iZWZvcmVTZW5kKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtb2R1bGUuY2FuY2VsbGVkID0gZmFsc2U7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gZ2V0IHVybFxuICAgICAgICAgIHVybCA9IG1vZHVsZS5nZXQudGVtcGxhdGVkVVJMKCk7XG5cbiAgICAgICAgICBpZighdXJsICYmICFtb2R1bGUuaXMubW9ja2VkKCkpIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5taXNzaW5nVVJMKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyByZXBsYWNlIHZhcmlhYmxlc1xuICAgICAgICAgIHVybCA9IG1vZHVsZS5hZGQudXJsRGF0YSggdXJsICk7XG4gICAgICAgICAgLy8gbWlzc2luZyB1cmwgcGFyYW1ldGVyc1xuICAgICAgICAgIGlmKCAhdXJsICYmICFtb2R1bGUuaXMubW9ja2VkKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXF1ZXN0U2V0dGluZ3MudXJsID0gc2V0dGluZ3MuYmFzZSArIHVybDtcblxuICAgICAgICAgIC8vIGxvb2sgZm9yIGpRdWVyeSBhamF4IHBhcmFtZXRlcnMgaW4gc2V0dGluZ3NcbiAgICAgICAgICBhamF4U2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgc2V0dGluZ3MsIHtcbiAgICAgICAgICAgIHR5cGUgICAgICAgOiBzZXR0aW5ncy5tZXRob2QgfHwgc2V0dGluZ3MudHlwZSxcbiAgICAgICAgICAgIGRhdGEgICAgICAgOiBkYXRhLFxuICAgICAgICAgICAgdXJsICAgICAgICA6IHNldHRpbmdzLmJhc2UgKyB1cmwsXG4gICAgICAgICAgICBiZWZvcmVTZW5kIDogc2V0dGluZ3MuYmVmb3JlWEhSLFxuICAgICAgICAgICAgc3VjY2VzcyAgICA6IGZ1bmN0aW9uKCkge30sXG4gICAgICAgICAgICBmYWlsdXJlICAgIDogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgICAgIGNvbXBsZXRlICAgOiBmdW5jdGlvbigpIHt9XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ1F1ZXJ5aW5nIFVSTCcsIGFqYXhTZXR0aW5ncy51cmwpO1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdVc2luZyBBSkFYIHNldHRpbmdzJywgYWpheFNldHRpbmdzKTtcbiAgICAgICAgICBpZihzZXR0aW5ncy5jYWNoZSA9PT0gJ2xvY2FsJyAmJiBtb2R1bGUucmVhZC5jYWNoZWRSZXNwb25zZSh1cmwpKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Jlc3BvbnNlIHJldHVybmVkIGZyb20gbG9jYWwgY2FjaGUnKTtcbiAgICAgICAgICAgIG1vZHVsZS5yZXF1ZXN0ID0gbW9kdWxlLmNyZWF0ZS5yZXF1ZXN0KCk7XG4gICAgICAgICAgICBtb2R1bGUucmVxdWVzdC5yZXNvbHZlV2l0aChjb250ZXh0LCBbIG1vZHVsZS5yZWFkLmNhY2hlZFJlc3BvbnNlKHVybCkgXSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYoICFzZXR0aW5ncy50aHJvdHRsZSApIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2VuZGluZyByZXF1ZXN0JywgZGF0YSwgYWpheFNldHRpbmdzLm1ldGhvZCk7XG4gICAgICAgICAgICBtb2R1bGUuc2VuZC5yZXF1ZXN0KCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYoIXNldHRpbmdzLnRocm90dGxlRmlyc3RSZXF1ZXN0ICYmICFtb2R1bGUudGltZXIpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTZW5kaW5nIHJlcXVlc3QnLCBkYXRhLCBhamF4U2V0dGluZ3MubWV0aG9kKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnNlbmQucmVxdWVzdCgpO1xuICAgICAgICAgICAgICBtb2R1bGUudGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7fSwgc2V0dGluZ3MudGhyb3R0bGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVGhyb3R0bGluZyByZXF1ZXN0Jywgc2V0dGluZ3MudGhyb3R0bGUpO1xuICAgICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnRpbWVyKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZihtb2R1bGUudGltZXIpIHtcbiAgICAgICAgICAgICAgICAgIGRlbGV0ZSBtb2R1bGUudGltZXI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnU2VuZGluZyB0aHJvdHRsZWQgcmVxdWVzdCcsIGRhdGEsIGFqYXhTZXR0aW5ncy5tZXRob2QpO1xuICAgICAgICAgICAgICAgIG1vZHVsZS5zZW5kLnJlcXVlc3QoKTtcbiAgICAgICAgICAgICAgfSwgc2V0dGluZ3MudGhyb3R0bGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICB9LFxuXG4gICAgICAgIHNob3VsZDoge1xuICAgICAgICAgIHJlbW92ZUVycm9yOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAoIHNldHRpbmdzLmhpZGVFcnJvciA9PT0gdHJ1ZSB8fCAoc2V0dGluZ3MuaGlkZUVycm9yID09PSAnYXV0bycgJiYgIW1vZHVsZS5pcy5mb3JtKCkpICk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGlzOiB7XG4gICAgICAgICAgZGlzYWJsZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuICgkbW9kdWxlLmZpbHRlcihzZWxlY3Rvci5kaXNhYmxlZCkubGVuZ3RoID4gMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBleHBlY3RpbmdKU09OOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5kYXRhVHlwZSA9PT0gJ2pzb24nIHx8IHNldHRpbmdzLmRhdGFUeXBlID09PSAnanNvbnAnO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZm9ybTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5pcygnZm9ybScpIHx8ICRjb250ZXh0LmlzKCdmb3JtJyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtb2NrZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChzZXR0aW5ncy5tb2NrUmVzcG9uc2UgfHwgc2V0dGluZ3MubW9ja1Jlc3BvbnNlQXN5bmMgfHwgc2V0dGluZ3MucmVzcG9uc2UgfHwgc2V0dGluZ3MucmVzcG9uc2VBc3luYyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbnB1dDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gJG1vZHVsZS5pcygnaW5wdXQnKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGxvYWRpbmc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChtb2R1bGUucmVxdWVzdClcbiAgICAgICAgICAgICAgPyAobW9kdWxlLnJlcXVlc3Quc3RhdGUoKSA9PSAncGVuZGluZycpXG4gICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFib3J0ZWRSZXF1ZXN0OiBmdW5jdGlvbih4aHIpIHtcbiAgICAgICAgICAgIGlmKHhociAmJiB4aHIucmVhZHlTdGF0ZSAhPT0gdW5kZWZpbmVkICYmIHhoci5yZWFkeVN0YXRlID09PSAwKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdYSFIgcmVxdWVzdCBkZXRlcm1pbmVkIHRvIGJlIGFib3J0ZWQnKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1hIUiByZXF1ZXN0IHdhcyBub3QgYWJvcnRlZCcpO1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB2YWxpZFJlc3BvbnNlOiBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYoICghbW9kdWxlLmlzLmV4cGVjdGluZ0pTT04oKSkgfHwgISQuaXNGdW5jdGlvbihzZXR0aW5ncy5zdWNjZXNzVGVzdCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZXNwb25zZSBpcyBub3QgSlNPTiwgc2tpcHBpbmcgdmFsaWRhdGlvbicsIHNldHRpbmdzLnN1Y2Nlc3NUZXN0LCByZXNwb25zZSk7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDaGVja2luZyBKU09OIHJldHVybmVkIHN1Y2Nlc3MnLCBzZXR0aW5ncy5zdWNjZXNzVGVzdCwgcmVzcG9uc2UpO1xuICAgICAgICAgICAgaWYoIHNldHRpbmdzLnN1Y2Nlc3NUZXN0KHJlc3BvbnNlKSApIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdSZXNwb25zZSBwYXNzZWQgc3VjY2VzcyB0ZXN0JywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Jlc3BvbnNlIGZhaWxlZCBzdWNjZXNzIHRlc3QnLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgd2FzOiB7XG4gICAgICAgICAgY2FuY2VsbGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiAobW9kdWxlLmNhbmNlbGxlZCB8fCBmYWxzZSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzdWNjZXNmdWw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIChtb2R1bGUucmVxdWVzdCAmJiBtb2R1bGUucmVxdWVzdC5zdGF0ZSgpID09ICdyZXNvbHZlZCcpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZmFpbHVyZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKG1vZHVsZS5yZXF1ZXN0ICYmIG1vZHVsZS5yZXF1ZXN0LnN0YXRlKCkgPT0gJ3JlamVjdGVkJyk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gKG1vZHVsZS5yZXF1ZXN0ICYmIChtb2R1bGUucmVxdWVzdC5zdGF0ZSgpID09ICdyZXNvbHZlZCcgfHwgbW9kdWxlLnJlcXVlc3Quc3RhdGUoKSA9PSAncmVqZWN0ZWQnKSApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBhZGQ6IHtcbiAgICAgICAgICB1cmxEYXRhOiBmdW5jdGlvbih1cmwsIHVybERhdGEpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICByZXF1aXJlZFZhcmlhYmxlcyxcbiAgICAgICAgICAgICAgb3B0aW9uYWxWYXJpYWJsZXNcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHVybCkge1xuICAgICAgICAgICAgICByZXF1aXJlZFZhcmlhYmxlcyA9IHVybC5tYXRjaChzZXR0aW5ncy5yZWdFeHAucmVxdWlyZWQpO1xuICAgICAgICAgICAgICBvcHRpb25hbFZhcmlhYmxlcyA9IHVybC5tYXRjaChzZXR0aW5ncy5yZWdFeHAub3B0aW9uYWwpO1xuICAgICAgICAgICAgICB1cmxEYXRhICAgICAgICAgICA9IHVybERhdGEgfHwgc2V0dGluZ3MudXJsRGF0YTtcbiAgICAgICAgICAgICAgaWYocmVxdWlyZWRWYXJpYWJsZXMpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0xvb2tpbmcgZm9yIHJlcXVpcmVkIFVSTCB2YXJpYWJsZXMnLCByZXF1aXJlZFZhcmlhYmxlcyk7XG4gICAgICAgICAgICAgICAgJC5lYWNoKHJlcXVpcmVkVmFyaWFibGVzLCBmdW5jdGlvbihpbmRleCwgdGVtcGxhdGVkU3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWxsb3cgbGVnYWN5IHskdmFyfSBzdHlsZVxuICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZSA9ICh0ZW1wbGF0ZWRTdHJpbmcuaW5kZXhPZignJCcpICE9PSAtMSlcbiAgICAgICAgICAgICAgICAgICAgICA/IHRlbXBsYXRlZFN0cmluZy5zdWJzdHIoMiwgdGVtcGxhdGVkU3RyaW5nLmxlbmd0aCAtIDMpXG4gICAgICAgICAgICAgICAgICAgICAgOiB0ZW1wbGF0ZWRTdHJpbmcuc3Vic3RyKDEsIHRlbXBsYXRlZFN0cmluZy5sZW5ndGggLSAyKSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgICA9ICgkLmlzUGxhaW5PYmplY3QodXJsRGF0YSkgJiYgdXJsRGF0YVt2YXJpYWJsZV0gIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgICA/IHVybERhdGFbdmFyaWFibGVdXG4gICAgICAgICAgICAgICAgICAgICAgOiAoJG1vZHVsZS5kYXRhKHZhcmlhYmxlKSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgPyAkbW9kdWxlLmRhdGEodmFyaWFibGUpXG4gICAgICAgICAgICAgICAgICAgICAgICA6ICgkY29udGV4dC5kYXRhKHZhcmlhYmxlKSAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICAgICAgICAgICAgICA/ICRjb250ZXh0LmRhdGEodmFyaWFibGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDogdXJsRGF0YVt2YXJpYWJsZV1cbiAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAgIC8vIHJlbW92ZSB2YWx1ZVxuICAgICAgICAgICAgICAgICAgaWYodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IucmVxdWlyZWRQYXJhbWV0ZXIsIHZhcmlhYmxlLCB1cmwpO1xuICAgICAgICAgICAgICAgICAgICB1cmwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdGb3VuZCByZXF1aXJlZCB2YXJpYWJsZScsIHZhcmlhYmxlLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhbHVlID0gKHNldHRpbmdzLmVuY29kZVBhcmFtZXRlcnMpXG4gICAgICAgICAgICAgICAgICAgICAgPyBtb2R1bGUuZ2V0LnVybEVuY29kZWRWYWx1ZSh2YWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgICA6IHZhbHVlXG4gICAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICAgICAgdXJsID0gdXJsLnJlcGxhY2UodGVtcGxhdGVkU3RyaW5nLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYob3B0aW9uYWxWYXJpYWJsZXMpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0xvb2tpbmcgZm9yIG9wdGlvbmFsIFVSTCB2YXJpYWJsZXMnLCByZXF1aXJlZFZhcmlhYmxlcyk7XG4gICAgICAgICAgICAgICAgJC5lYWNoKG9wdGlvbmFsVmFyaWFibGVzLCBmdW5jdGlvbihpbmRleCwgdGVtcGxhdGVkU3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAgICAgLy8gYWxsb3cgbGVnYWN5IHsvJHZhcn0gc3R5bGVcbiAgICAgICAgICAgICAgICAgICAgdmFyaWFibGUgPSAodGVtcGxhdGVkU3RyaW5nLmluZGV4T2YoJyQnKSAhPT0gLTEpXG4gICAgICAgICAgICAgICAgICAgICAgPyB0ZW1wbGF0ZWRTdHJpbmcuc3Vic3RyKDMsIHRlbXBsYXRlZFN0cmluZy5sZW5ndGggLSA0KVxuICAgICAgICAgICAgICAgICAgICAgIDogdGVtcGxhdGVkU3RyaW5nLnN1YnN0cigyLCB0ZW1wbGF0ZWRTdHJpbmcubGVuZ3RoIC0gMyksXG4gICAgICAgICAgICAgICAgICAgIHZhbHVlICAgPSAoJC5pc1BsYWluT2JqZWN0KHVybERhdGEpICYmIHVybERhdGFbdmFyaWFibGVdICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgICAgPyB1cmxEYXRhW3ZhcmlhYmxlXVxuICAgICAgICAgICAgICAgICAgICAgIDogKCRtb2R1bGUuZGF0YSh2YXJpYWJsZSkgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgICAgID8gJG1vZHVsZS5kYXRhKHZhcmlhYmxlKVxuICAgICAgICAgICAgICAgICAgICAgICAgOiAoJGNvbnRleHQuZGF0YSh2YXJpYWJsZSkgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPyAkY29udGV4dC5kYXRhKHZhcmlhYmxlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICA6IHVybERhdGFbdmFyaWFibGVdXG4gICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgICAvLyBvcHRpb25hbCByZXBsYWNlbWVudFxuICAgICAgICAgICAgICAgICAgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnT3B0aW9uYWwgdmFyaWFibGUgRm91bmQnLCB2YXJpYWJsZSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB1cmwgPSB1cmwucmVwbGFjZSh0ZW1wbGF0ZWRTdHJpbmcsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnT3B0aW9uYWwgdmFyaWFibGUgbm90IGZvdW5kJywgdmFyaWFibGUpO1xuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgcHJlY2VkaW5nIHNsYXNoIGlmIHNldFxuICAgICAgICAgICAgICAgICAgICBpZih1cmwuaW5kZXhPZignLycgKyB0ZW1wbGF0ZWRTdHJpbmcpICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCcvJyArIHRlbXBsYXRlZFN0cmluZywgJycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKHRlbXBsYXRlZFN0cmluZywgJycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmb3JtRGF0YTogZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGNhblNlcmlhbGl6ZSA9ICgkLmZuLnNlcmlhbGl6ZU9iamVjdCAhPT0gdW5kZWZpbmVkKSxcbiAgICAgICAgICAgICAgZm9ybURhdGEgICAgID0gKGNhblNlcmlhbGl6ZSlcbiAgICAgICAgICAgICAgICA/ICRmb3JtLnNlcmlhbGl6ZU9iamVjdCgpXG4gICAgICAgICAgICAgICAgOiAkZm9ybS5zZXJpYWxpemUoKSxcbiAgICAgICAgICAgICAgaGFzT3RoZXJEYXRhXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBkYXRhICAgICAgICAgPSBkYXRhIHx8IHNldHRpbmdzLmRhdGE7XG4gICAgICAgICAgICBoYXNPdGhlckRhdGEgPSAkLmlzUGxhaW5PYmplY3QoZGF0YSk7XG5cbiAgICAgICAgICAgIGlmKGhhc090aGVyRGF0YSkge1xuICAgICAgICAgICAgICBpZihjYW5TZXJpYWxpemUpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0V4dGVuZGluZyBleGlzdGluZyBkYXRhIHdpdGggZm9ybSBkYXRhJywgZGF0YSwgZm9ybURhdGEpO1xuICAgICAgICAgICAgICAgIGRhdGEgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGF0YSwgZm9ybURhdGEpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5taXNzaW5nU2VyaWFsaXplKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NhbnQgZXh0ZW5kIGRhdGEuIFJlcGxhY2luZyBkYXRhIHdpdGggZm9ybSBkYXRhJywgZGF0YSwgZm9ybURhdGEpO1xuICAgICAgICAgICAgICAgIGRhdGEgPSBmb3JtRGF0YTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIGZvcm0gZGF0YScsIGZvcm1EYXRhKTtcbiAgICAgICAgICAgICAgZGF0YSA9IGZvcm1EYXRhO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHNlbmQ6IHtcbiAgICAgICAgICByZXF1ZXN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS5zZXQubG9hZGluZygpO1xuICAgICAgICAgICAgbW9kdWxlLnJlcXVlc3QgPSBtb2R1bGUuY3JlYXRlLnJlcXVlc3QoKTtcbiAgICAgICAgICAgIGlmKCBtb2R1bGUuaXMubW9ja2VkKCkgKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5tb2NrZWRYSFIgPSBtb2R1bGUuY3JlYXRlLm1vY2tlZFhIUigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS54aHIgPSBtb2R1bGUuY3JlYXRlLnhocigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0dGluZ3Mub25SZXF1ZXN0LmNhbGwoY29udGV4dCwgbW9kdWxlLnJlcXVlc3QsIG1vZHVsZS54aHIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBldmVudDoge1xuICAgICAgICAgIHRyaWdnZXI6IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICBtb2R1bGUucXVlcnkoKTtcbiAgICAgICAgICAgIGlmKGV2ZW50LnR5cGUgPT0gJ3N1Ym1pdCcgfHwgZXZlbnQudHlwZSA9PSAnY2xpY2snKSB7XG4gICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB4aHI6IHtcbiAgICAgICAgICAgIGFsd2F5czogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIC8vIG5vdGhpbmcgc3BlY2lhbFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGRvbmU6IGZ1bmN0aW9uKHJlc3BvbnNlLCB0ZXh0U3RhdHVzLCB4aHIpIHtcbiAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgY29udGV4dCAgICAgICAgICAgID0gdGhpcyxcbiAgICAgICAgICAgICAgICBlbGFwc2VkVGltZSAgICAgICAgPSAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSByZXF1ZXN0U3RhcnRUaW1lKSxcbiAgICAgICAgICAgICAgICB0aW1lTGVmdCAgICAgICAgICAgPSAoc2V0dGluZ3MubG9hZGluZ0R1cmF0aW9uIC0gZWxhcHNlZFRpbWUpLFxuICAgICAgICAgICAgICAgIHRyYW5zbGF0ZWRSZXNwb25zZSA9ICggJC5pc0Z1bmN0aW9uKHNldHRpbmdzLm9uUmVzcG9uc2UpIClcbiAgICAgICAgICAgICAgICAgID8gbW9kdWxlLmlzLmV4cGVjdGluZ0pTT04oKVxuICAgICAgICAgICAgICAgICAgICA/IHNldHRpbmdzLm9uUmVzcG9uc2UuY2FsbChjb250ZXh0LCAkLmV4dGVuZCh0cnVlLCB7fSwgcmVzcG9uc2UpKVxuICAgICAgICAgICAgICAgICAgICA6IHNldHRpbmdzLm9uUmVzcG9uc2UuY2FsbChjb250ZXh0LCByZXNwb25zZSlcbiAgICAgICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICB0aW1lTGVmdCA9ICh0aW1lTGVmdCA+IDApXG4gICAgICAgICAgICAgICAgPyB0aW1lTGVmdFxuICAgICAgICAgICAgICAgIDogMFxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKHRyYW5zbGF0ZWRSZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnTW9kaWZpZWQgQVBJIHJlc3BvbnNlIGluIG9uUmVzcG9uc2UgY2FsbGJhY2snLCBzZXR0aW5ncy5vblJlc3BvbnNlLCB0cmFuc2xhdGVkUmVzcG9uc2UsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHRyYW5zbGF0ZWRSZXNwb25zZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZih0aW1lTGVmdCA+IDApIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1Jlc3BvbnNlIGNvbXBsZXRlZCBlYXJseSBkZWxheWluZyBzdGF0ZSBjaGFuZ2UgYnknLCB0aW1lTGVmdCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBpZiggbW9kdWxlLmlzLnZhbGlkUmVzcG9uc2UocmVzcG9uc2UpICkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLnJlcXVlc3QucmVzb2x2ZVdpdGgoY29udGV4dCwgW3Jlc3BvbnNlLCB4aHJdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUucmVxdWVzdC5yZWplY3RXaXRoKGNvbnRleHQsIFt4aHIsICdpbnZhbGlkJ10pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSwgdGltZUxlZnQpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uKHhociwgc3RhdHVzLCBodHRwTWVzc2FnZSkge1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICBjb250ZXh0ICAgICA9IHRoaXMsXG4gICAgICAgICAgICAgICAgZWxhcHNlZFRpbWUgPSAobmV3IERhdGUoKS5nZXRUaW1lKCkgLSByZXF1ZXN0U3RhcnRUaW1lKSxcbiAgICAgICAgICAgICAgICB0aW1lTGVmdCAgICA9IChzZXR0aW5ncy5sb2FkaW5nRHVyYXRpb24gLSBlbGFwc2VkVGltZSlcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICB0aW1lTGVmdCA9ICh0aW1lTGVmdCA+IDApXG4gICAgICAgICAgICAgICAgPyB0aW1lTGVmdFxuICAgICAgICAgICAgICAgIDogMFxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKHRpbWVMZWZ0ID4gMCkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUmVzcG9uc2UgY29tcGxldGVkIGVhcmx5IGRlbGF5aW5nIHN0YXRlIGNoYW5nZSBieScsIHRpbWVMZWZ0KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmKCBtb2R1bGUuaXMuYWJvcnRlZFJlcXVlc3QoeGhyKSApIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5yZXF1ZXN0LnJlamVjdFdpdGgoY29udGV4dCwgW3hociwgJ2Fib3J0ZWQnLCBodHRwTWVzc2FnZV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5yZXF1ZXN0LnJlamVjdFdpdGgoY29udGV4dCwgW3hociwgJ2Vycm9yJywgc3RhdHVzLCBodHRwTWVzc2FnZV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSwgdGltZUxlZnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVxdWVzdDoge1xuICAgICAgICAgICAgZG9uZTogZnVuY3Rpb24ocmVzcG9uc2UsIHhocikge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1N1Y2Nlc3NmdWwgQVBJIFJlc3BvbnNlJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICBpZihzZXR0aW5ncy5jYWNoZSA9PT0gJ2xvY2FsJyAmJiB1cmwpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUud3JpdGUuY2FjaGVkUmVzcG9uc2UodXJsLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdTYXZpbmcgc2VydmVyIHJlc3BvbnNlIGxvY2FsbHknLCBtb2R1bGUuY2FjaGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHNldHRpbmdzLm9uU3VjY2Vzcy5jYWxsKGNvbnRleHQsIHJlc3BvbnNlLCAkbW9kdWxlLCB4aHIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbihmaXJzdFBhcmFtZXRlciwgc2Vjb25kUGFyYW1ldGVyKSB7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgIHhocixcbiAgICAgICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIC8vIGhhdmUgdG8gZ3Vlc3MgY2FsbGJhY2sgcGFyYW1ldGVycyBiYXNlZCBvbiByZXF1ZXN0IHN1Y2Nlc3NcbiAgICAgICAgICAgICAgaWYoIG1vZHVsZS53YXMuc3VjY2VzZnVsKCkgKSB7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBmaXJzdFBhcmFtZXRlcjtcbiAgICAgICAgICAgICAgICB4aHIgICAgICA9IHNlY29uZFBhcmFtZXRlcjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB4aHIgICAgICA9IGZpcnN0UGFyYW1ldGVyO1xuICAgICAgICAgICAgICAgIHJlc3BvbnNlID0gbW9kdWxlLmdldC5yZXNwb25zZUZyb21YSFIoeGhyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmxvYWRpbmcoKTtcbiAgICAgICAgICAgICAgc2V0dGluZ3Mub25Db21wbGV0ZS5jYWxsKGNvbnRleHQsIHJlc3BvbnNlLCAkbW9kdWxlLCB4aHIpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGZhaWw6IGZ1bmN0aW9uKHhociwgc3RhdHVzLCBodHRwTWVzc2FnZSkge1xuICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAvLyBwdWxsIHJlc3BvbnNlIGZyb20geGhyIGlmIGF2YWlsYWJsZVxuICAgICAgICAgICAgICAgIHJlc3BvbnNlICAgICA9IG1vZHVsZS5nZXQucmVzcG9uc2VGcm9tWEhSKHhociksXG4gICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gbW9kdWxlLmdldC5lcnJvckZyb21SZXF1ZXN0KHJlc3BvbnNlLCBzdGF0dXMsIGh0dHBNZXNzYWdlKVxuICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIGlmKHN0YXR1cyA9PSAnYWJvcnRlZCcpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1hIUiBBYm9ydGVkIChNb3N0IGxpa2VseSBjYXVzZWQgYnkgcGFnZSBuYXZpZ2F0aW9uIG9yIENPUlMgUG9saWN5KScsIHN0YXR1cywgaHR0cE1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uQWJvcnQuY2FsbChjb250ZXh0LCBzdGF0dXMsICRtb2R1bGUsIHhocik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZihzdGF0dXMgPT0gJ2ludmFsaWQnKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdKU09OIGRpZCBub3QgcGFzcyBzdWNjZXNzIHRlc3QuIEEgc2VydmVyLXNpZGUgZXJyb3IgaGFzIG1vc3QgbGlrZWx5IG9jY3VycmVkJywgcmVzcG9uc2UpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2UgaWYoc3RhdHVzID09ICdlcnJvcicpIHtcbiAgICAgICAgICAgICAgICBpZih4aHIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdYSFIgcHJvZHVjZWQgYSBzZXJ2ZXIgZXJyb3InLCBzdGF0dXMsIGh0dHBNZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBoYXZlIGFuIGVycm9yIHRvIGRpc3BsYXkgdG8gY29uc29sZVxuICAgICAgICAgICAgICAgICAgaWYoIHhoci5zdGF0dXMgIT0gMjAwICYmIGh0dHBNZXNzYWdlICE9PSB1bmRlZmluZWQgJiYgaHR0cE1lc3NhZ2UgIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZS5lcnJvcihlcnJvci5zdGF0dXNNZXNzYWdlICsgaHR0cE1lc3NhZ2UsIGFqYXhTZXR0aW5ncy51cmwpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgc2V0dGluZ3Mub25FcnJvci5jYWxsKGNvbnRleHQsIGVycm9yTWVzc2FnZSwgJG1vZHVsZSwgeGhyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZihzZXR0aW5ncy5lcnJvckR1cmF0aW9uICYmIHN0YXR1cyAhPT0gJ2Fib3J0ZWQnKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgZXJyb3Igc3RhdGUnKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuc2V0LmVycm9yKCk7XG4gICAgICAgICAgICAgICAgaWYoIG1vZHVsZS5zaG91bGQucmVtb3ZlRXJyb3IoKSApIHtcbiAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQobW9kdWxlLnJlbW92ZS5lcnJvciwgc2V0dGluZ3MuZXJyb3JEdXJhdGlvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQVBJIFJlcXVlc3QgZmFpbGVkJywgZXJyb3JNZXNzYWdlLCB4aHIpO1xuICAgICAgICAgICAgICBzZXR0aW5ncy5vbkZhaWx1cmUuY2FsbChjb250ZXh0LCByZXNwb25zZSwgJG1vZHVsZSwgeGhyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgY3JlYXRlOiB7XG5cbiAgICAgICAgICByZXF1ZXN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vIGFwaSByZXF1ZXN0IHByb21pc2VcbiAgICAgICAgICAgIHJldHVybiAkLkRlZmVycmVkKClcbiAgICAgICAgICAgICAgLmFsd2F5cyhtb2R1bGUuZXZlbnQucmVxdWVzdC5jb21wbGV0ZSlcbiAgICAgICAgICAgICAgLmRvbmUobW9kdWxlLmV2ZW50LnJlcXVlc3QuZG9uZSlcbiAgICAgICAgICAgICAgLmZhaWwobW9kdWxlLmV2ZW50LnJlcXVlc3QuZmFpbClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuXG4gICAgICAgICAgbW9ja2VkWEhSOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgLy8geGhyIGRvZXMgbm90IHNpbXVsYXRlIHRoZXNlIHByb3BlcnRpZXMgb2YgeGhyIGJ1dCBtdXN0IHJldHVybiB0aGVtXG4gICAgICAgICAgICAgIHRleHRTdGF0dXMgICAgID0gZmFsc2UsXG4gICAgICAgICAgICAgIHN0YXR1cyAgICAgICAgID0gZmFsc2UsXG4gICAgICAgICAgICAgIGh0dHBNZXNzYWdlICAgID0gZmFsc2UsXG4gICAgICAgICAgICAgIHJlc3BvbmRlciAgICAgID0gc2V0dGluZ3MubW9ja1Jlc3BvbnNlICAgICAgfHwgc2V0dGluZ3MucmVzcG9uc2UsXG4gICAgICAgICAgICAgIGFzeW5jUmVzcG9uZGVyID0gc2V0dGluZ3MubW9ja1Jlc3BvbnNlQXN5bmMgfHwgc2V0dGluZ3MucmVzcG9uc2VBc3luYyxcbiAgICAgICAgICAgICAgYXN5bmNDYWxsYmFjayxcbiAgICAgICAgICAgICAgcmVzcG9uc2UsXG4gICAgICAgICAgICAgIG1vY2tlZFhIUlxuICAgICAgICAgICAgO1xuXG4gICAgICAgICAgICBtb2NrZWRYSFIgPSAkLkRlZmVycmVkKClcbiAgICAgICAgICAgICAgLmFsd2F5cyhtb2R1bGUuZXZlbnQueGhyLmNvbXBsZXRlKVxuICAgICAgICAgICAgICAuZG9uZShtb2R1bGUuZXZlbnQueGhyLmRvbmUpXG4gICAgICAgICAgICAgIC5mYWlsKG1vZHVsZS5ldmVudC54aHIuZmFpbClcbiAgICAgICAgICAgIDtcblxuICAgICAgICAgICAgaWYocmVzcG9uZGVyKSB7XG4gICAgICAgICAgICAgIGlmKCAkLmlzRnVuY3Rpb24ocmVzcG9uZGVyKSApIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1VzaW5nIHNwZWNpZmllZCBzeW5jaHJvbm91cyBjYWxsYmFjaycsIHJlc3BvbmRlcik7XG4gICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXNwb25kZXIuY2FsbChjb250ZXh0LCByZXF1ZXN0U2V0dGluZ3MpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVXNpbmcgc2V0dGluZ3Mgc3BlY2lmaWVkIHJlc3BvbnNlJywgcmVzcG9uZGVyKTtcbiAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlc3BvbmRlcjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvLyBzaW11bGF0aW5nIHJlc3BvbnNlXG4gICAgICAgICAgICAgIG1vY2tlZFhIUi5yZXNvbHZlV2l0aChjb250ZXh0LCBbIHJlc3BvbnNlLCB0ZXh0U3RhdHVzLCB7IHJlc3BvbnNlVGV4dDogcmVzcG9uc2UgfV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiggJC5pc0Z1bmN0aW9uKGFzeW5jUmVzcG9uZGVyKSApIHtcbiAgICAgICAgICAgICAgYXN5bmNDYWxsYmFjayA9IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBc3luYyBjYWxsYmFjayByZXR1cm5lZCByZXNwb25zZScsIHJlc3BvbnNlKTtcblxuICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICBtb2NrZWRYSFIucmVzb2x2ZVdpdGgoY29udGV4dCwgWyByZXNwb25zZSwgdGV4dFN0YXR1cywgeyByZXNwb25zZVRleHQ6IHJlc3BvbnNlIH1dKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICBtb2NrZWRYSFIucmVqZWN0V2l0aChjb250ZXh0LCBbeyByZXNwb25zZVRleHQ6IHJlc3BvbnNlIH0sIHN0YXR1cywgaHR0cE1lc3NhZ2VdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVXNpbmcgc3BlY2lmaWVkIGFzeW5jIHJlc3BvbnNlIGNhbGxiYWNrJywgYXN5bmNSZXNwb25kZXIpO1xuICAgICAgICAgICAgICBhc3luY1Jlc3BvbmRlci5jYWxsKGNvbnRleHQsIHJlcXVlc3RTZXR0aW5ncywgYXN5bmNDYWxsYmFjayk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbW9ja2VkWEhSO1xuICAgICAgICAgIH0sXG5cbiAgICAgICAgICB4aHI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIHhoclxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgLy8gYWpheCByZXF1ZXN0IHByb21pc2VcbiAgICAgICAgICAgIHhociA9ICQuYWpheChhamF4U2V0dGluZ3MpXG4gICAgICAgICAgICAgIC5hbHdheXMobW9kdWxlLmV2ZW50Lnhoci5hbHdheXMpXG4gICAgICAgICAgICAgIC5kb25lKG1vZHVsZS5ldmVudC54aHIuZG9uZSlcbiAgICAgICAgICAgICAgLmZhaWwobW9kdWxlLmV2ZW50Lnhoci5mYWlsKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0NyZWF0ZWQgc2VydmVyIHJlcXVlc3QnLCB4aHIsIGFqYXhTZXR0aW5ncyk7XG4gICAgICAgICAgICByZXR1cm4geGhyO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXQ6IHtcbiAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQWRkaW5nIGVycm9yIHN0YXRlIHRvIGVsZW1lbnQnLCAkY29udGV4dCk7XG4gICAgICAgICAgICAkY29udGV4dC5hZGRDbGFzcyhjbGFzc05hbWUuZXJyb3IpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgbG9hZGluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQWRkaW5nIGxvYWRpbmcgc3RhdGUgdG8gZWxlbWVudCcsICRjb250ZXh0KTtcbiAgICAgICAgICAgICRjb250ZXh0LmFkZENsYXNzKGNsYXNzTmFtZS5sb2FkaW5nKTtcbiAgICAgICAgICAgIHJlcXVlc3RTdGFydFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVtb3ZlOiB7XG4gICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1JlbW92aW5nIGVycm9yIHN0YXRlIGZyb20gZWxlbWVudCcsICRjb250ZXh0KTtcbiAgICAgICAgICAgICRjb250ZXh0LnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5lcnJvcik7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsb2FkaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZW1vdmluZyBsb2FkaW5nIHN0YXRlIGZyb20gZWxlbWVudCcsICRjb250ZXh0KTtcbiAgICAgICAgICAgICRjb250ZXh0LnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5sb2FkaW5nKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0OiB7XG4gICAgICAgICAgcmVzcG9uc2VGcm9tWEhSOiBmdW5jdGlvbih4aHIpIHtcbiAgICAgICAgICAgIHJldHVybiAkLmlzUGxhaW5PYmplY3QoeGhyKVxuICAgICAgICAgICAgICA/IChtb2R1bGUuaXMuZXhwZWN0aW5nSlNPTigpKVxuICAgICAgICAgICAgICAgID8gbW9kdWxlLmRlY29kZS5qc29uKHhoci5yZXNwb25zZVRleHQpXG4gICAgICAgICAgICAgICAgOiB4aHIucmVzcG9uc2VUZXh0XG4gICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yRnJvbVJlcXVlc3Q6IGZ1bmN0aW9uKHJlc3BvbnNlLCBzdGF0dXMsIGh0dHBNZXNzYWdlKSB7XG4gICAgICAgICAgICByZXR1cm4gKCQuaXNQbGFpbk9iamVjdChyZXNwb25zZSkgJiYgcmVzcG9uc2UuZXJyb3IgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgPyByZXNwb25zZS5lcnJvciAvLyB1c2UganNvbiBlcnJvciBtZXNzYWdlXG4gICAgICAgICAgICAgIDogKHNldHRpbmdzLmVycm9yW3N0YXR1c10gIT09IHVuZGVmaW5lZCkgLy8gdXNlIHNlcnZlciBlcnJvciBtZXNzYWdlXG4gICAgICAgICAgICAgICAgPyBzZXR0aW5ncy5lcnJvcltzdGF0dXNdXG4gICAgICAgICAgICAgICAgOiBodHRwTWVzc2FnZVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgcmVxdWVzdDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLnJlcXVlc3QgfHwgZmFsc2U7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB4aHI6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS54aHIgfHwgZmFsc2U7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzZXR0aW5nczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgcnVuU2V0dGluZ3NcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJ1blNldHRpbmdzID0gc2V0dGluZ3MuYmVmb3JlU2VuZC5jYWxsKGNvbnRleHQsIHNldHRpbmdzKTtcbiAgICAgICAgICAgIGlmKHJ1blNldHRpbmdzKSB7XG4gICAgICAgICAgICAgIGlmKHJ1blNldHRpbmdzLnN1Y2Nlc3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnTGVnYWN5IHN1Y2Nlc3MgY2FsbGJhY2sgZGV0ZWN0ZWQnLCBydW5TZXR0aW5ncyk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLmxlZ2FjeVBhcmFtZXRlcnMsIHJ1blNldHRpbmdzLnN1Y2Nlc3MpO1xuICAgICAgICAgICAgICAgIHJ1blNldHRpbmdzLm9uU3VjY2VzcyA9IHJ1blNldHRpbmdzLnN1Y2Nlc3M7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYocnVuU2V0dGluZ3MuZmFpbHVyZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdMZWdhY3kgZmFpbHVyZSBjYWxsYmFjayBkZXRlY3RlZCcsIHJ1blNldHRpbmdzKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IubGVnYWN5UGFyYW1ldGVycywgcnVuU2V0dGluZ3MuZmFpbHVyZSk7XG4gICAgICAgICAgICAgICAgcnVuU2V0dGluZ3Mub25GYWlsdXJlID0gcnVuU2V0dGluZ3MuZmFpbHVyZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZihydW5TZXR0aW5ncy5jb21wbGV0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdMZWdhY3kgY29tcGxldGUgY2FsbGJhY2sgZGV0ZWN0ZWQnLCBydW5TZXR0aW5ncyk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLmxlZ2FjeVBhcmFtZXRlcnMsIHJ1blNldHRpbmdzLmNvbXBsZXRlKTtcbiAgICAgICAgICAgICAgICBydW5TZXR0aW5ncy5vbkNvbXBsZXRlID0gcnVuU2V0dGluZ3MuY29tcGxldGU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKHJ1blNldHRpbmdzID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm5vUmV0dXJuZWRWYWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihydW5TZXR0aW5ncyA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHJ1blNldHRpbmdzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIChydW5TZXR0aW5ncyAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICA/ICQuZXh0ZW5kKHRydWUsIHt9LCBydW5TZXR0aW5ncylcbiAgICAgICAgICAgICAgOiAkLmV4dGVuZCh0cnVlLCB7fSwgc2V0dGluZ3MpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB1cmxFbmNvZGVkVmFsdWU6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZGVjb2RlZFZhbHVlICAgPSB3aW5kb3cuZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKSxcbiAgICAgICAgICAgICAgZW5jb2RlZFZhbHVlICAgPSB3aW5kb3cuZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSxcbiAgICAgICAgICAgICAgYWxyZWFkeUVuY29kZWQgPSAoZGVjb2RlZFZhbHVlICE9PSB2YWx1ZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKGFscmVhZHlFbmNvZGVkKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVVJMIHZhbHVlIGlzIGFscmVhZHkgZW5jb2RlZCwgYXZvaWRpbmcgZG91YmxlIGVuY29kaW5nJywgdmFsdWUpO1xuICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnRW5jb2RpbmcgdmFsdWUgdXNpbmcgZW5jb2RlVVJJQ29tcG9uZW50JywgdmFsdWUsIGVuY29kZWRWYWx1ZSk7XG4gICAgICAgICAgICByZXR1cm4gZW5jb2RlZFZhbHVlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGVmYXVsdERhdGE6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIGRhdGEgPSB7fVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoICEkLmlzV2luZG93KGVsZW1lbnQpICkge1xuICAgICAgICAgICAgICBpZiggbW9kdWxlLmlzLmlucHV0KCkgKSB7XG4gICAgICAgICAgICAgICAgZGF0YS52YWx1ZSA9ICRtb2R1bGUudmFsKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggbW9kdWxlLmlzLmZvcm0oKSApIHtcblxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRhdGEudGV4dCA9ICRtb2R1bGUudGV4dCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCAkLmlzV2luZG93KGVsZW1lbnQpIHx8IHNldHRpbmdzLm9uID09ICdub3cnICkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0FQSSBjYWxsZWQgd2l0aG91dCBlbGVtZW50LCBubyBldmVudHMgYXR0YWNoZWQnKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihzZXR0aW5ncy5vbiA9PSAnYXV0bycpIHtcbiAgICAgICAgICAgICAgaWYoICRtb2R1bGUuaXMoJ2lucHV0JykgKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChlbGVtZW50Lm9uaW5wdXQgIT09IHVuZGVmaW5lZClcbiAgICAgICAgICAgICAgICAgID8gJ2lucHV0J1xuICAgICAgICAgICAgICAgICAgOiAoZWxlbWVudC5vbnByb3BlcnR5Y2hhbmdlICE9PSB1bmRlZmluZWQpXG4gICAgICAgICAgICAgICAgICAgID8gJ3Byb3BlcnR5Y2hhbmdlJ1xuICAgICAgICAgICAgICAgICAgICA6ICdrZXl1cCdcbiAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggJG1vZHVsZS5pcygnZm9ybScpICkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnc3VibWl0JztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJ2NsaWNrJztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5vbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRlbXBsYXRlZFVSTDogZnVuY3Rpb24oYWN0aW9uKSB7XG4gICAgICAgICAgICBhY3Rpb24gPSBhY3Rpb24gfHwgJG1vZHVsZS5kYXRhKG1ldGFkYXRhLmFjdGlvbikgfHwgc2V0dGluZ3MuYWN0aW9uIHx8IGZhbHNlO1xuICAgICAgICAgICAgdXJsICAgID0gJG1vZHVsZS5kYXRhKG1ldGFkYXRhLnVybCkgfHwgc2V0dGluZ3MudXJsIHx8IGZhbHNlO1xuICAgICAgICAgICAgaWYodXJsKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnVXNpbmcgc3BlY2lmaWVkIHVybCcsIHVybCk7XG4gICAgICAgICAgICAgIHJldHVybiB1cmw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihhY3Rpb24pIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdMb29raW5nIHVwIHVybCBmb3IgYWN0aW9uJywgYWN0aW9uLCBzZXR0aW5ncy5hcGkpO1xuICAgICAgICAgICAgICBpZihzZXR0aW5ncy5hcGlbYWN0aW9uXSA9PT0gdW5kZWZpbmVkICYmICFtb2R1bGUuaXMubW9ja2VkKCkpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZXJyb3IoZXJyb3IubWlzc2luZ0FjdGlvbiwgc2V0dGluZ3MuYWN0aW9uLCBzZXR0aW5ncy5hcGkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB1cmwgPSBzZXR0aW5ncy5hcGlbYWN0aW9uXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoIG1vZHVsZS5pcy5mb3JtKCkgKSB7XG4gICAgICAgICAgICAgIHVybCA9ICRtb2R1bGUuYXR0cignYWN0aW9uJykgfHwgJGNvbnRleHQuYXR0cignYWN0aW9uJykgfHwgZmFsc2U7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnTm8gdXJsIG9yIGFjdGlvbiBzcGVjaWZpZWQsIGRlZmF1bHRpbmcgdG8gZm9ybSBhY3Rpb24nLCB1cmwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVybDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgYWJvcnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgeGhyID0gbW9kdWxlLmdldC54aHIoKVxuICAgICAgICAgIDtcbiAgICAgICAgICBpZiggeGhyICYmIHhoci5zdGF0ZSgpICE9PSAncmVzb2x2ZWQnKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NhbmNlbGxpbmcgQVBJIHJlcXVlc3QnKTtcbiAgICAgICAgICAgIHhoci5hYm9ydCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICAvLyByZXNldCBzdGF0ZVxuICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnJlbW92ZS5lcnJvcigpO1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUubG9hZGluZygpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldHRpbmc6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdDaGFuZ2luZyBzZXR0aW5nJywgbmFtZSwgdmFsdWUpO1xuICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBzZXR0aW5ncywgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYoJC5pc1BsYWluT2JqZWN0KHNldHRpbmdzW25hbWVdKSkge1xuICAgICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBzZXR0aW5nc1tuYW1lXSwgdmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW50ZXJuYWw6IGZ1bmN0aW9uKG5hbWUsIHZhbHVlKSB7XG4gICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdChuYW1lKSApIHtcbiAgICAgICAgICAgICQuZXh0ZW5kKHRydWUsIG1vZHVsZSwgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbW9kdWxlW25hbWVdID0gdmFsdWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZVtuYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGRlYnVnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZighc2V0dGluZ3Muc2lsZW50ICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHZlcmJvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MudmVyYm9zZSAmJiBzZXR0aW5ncy5kZWJ1Zykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnBlcmZvcm1hbmNlLmxvZyhhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmluZm8sIGNvbnNvbGUsIHNldHRpbmdzLm5hbWUgKyAnOicpO1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZS5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQpIHtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvciA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZS5lcnJvciwgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICBtb2R1bGUuZXJyb3IuYXBwbHkoY29uc29sZSwgYXJndW1lbnRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBlcmZvcm1hbmNlOiB7XG4gICAgICAgICAgbG9nOiBmdW5jdGlvbihtZXNzYWdlKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUsXG4gICAgICAgICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucGVyZm9ybWFuY2UpIHtcbiAgICAgICAgICAgICAgY3VycmVudFRpbWUgICA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgICBwcmV2aW91c1RpbWUgID0gdGltZSB8fCBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSA9IGN1cnJlbnRUaW1lIC0gcHJldmlvdXNUaW1lO1xuICAgICAgICAgICAgICB0aW1lICAgICAgICAgID0gY3VycmVudFRpbWU7XG4gICAgICAgICAgICAgIHBlcmZvcm1hbmNlLnB1c2goe1xuICAgICAgICAgICAgICAgICdOYW1lJyAgICAgICAgICAgOiBtZXNzYWdlWzBdLFxuICAgICAgICAgICAgICAgICdBcmd1bWVudHMnICAgICAgOiBbXS5zbGljZS5jYWxsKG1lc3NhZ2UsIDEpIHx8ICcnLFxuICAgICAgICAgICAgICAgIC8vJ0VsZW1lbnQnICAgICAgICA6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgJ0V4ZWN1dGlvbiBUaW1lJyA6IGV4ZWN1dGlvblRpbWVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lciA9IHNldFRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLmRpc3BsYXksIDUwMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNwbGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB0aXRsZSA9IHNldHRpbmdzLm5hbWUgKyAnOicsXG4gICAgICAgICAgICAgIHRvdGFsVGltZSA9IDBcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHRpbWUgPSBmYWxzZTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICB0b3RhbFRpbWUgKz0gZGF0YVsnRXhlY3V0aW9uIFRpbWUnXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGl0bGUgKz0gJyAnICsgdG90YWxUaW1lICsgJ21zJztcbiAgICAgICAgICAgIGlmKG1vZHVsZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgIHRpdGxlICs9ICcgXFwnJyArIG1vZHVsZVNlbGVjdG9yICsgJ1xcJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggKGNvbnNvbGUuZ3JvdXAgIT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLnRhYmxlICE9PSB1bmRlZmluZWQpICYmIHBlcmZvcm1hbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgICAgIGlmKGNvbnNvbGUudGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKHBlcmZvcm1hbmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZXJmb3JtYW5jZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm1ldGhvZCwgcXVlcnkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCBmb3VuZCApICkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZC5hcHBseShjb250ZXh0LCBwYXNzZWRBcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGZvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCQuaXNBcnJheShyZXR1cm5lZFZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZS5wdXNoKHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSBbcmV0dXJuZWRWYWx1ZSwgcmVzcG9uc2VdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSByZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgICAgIGlmKGluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgICB9XG4gICAgICAgIG1vZHVsZS5pbnZva2UocXVlcnkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmKGluc3RhbmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpbnN0YW5jZS5pbnZva2UoJ2Rlc3Ryb3knKTtcbiAgICAgICAgfVxuICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgfVxuICAgIH0pXG4gIDtcblxuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xufTtcblxuJC5hcGkuc2V0dGluZ3MgPSB7XG5cbiAgbmFtZSAgICAgICAgICAgICAgOiAnQVBJJyxcbiAgbmFtZXNwYWNlICAgICAgICAgOiAnYXBpJyxcblxuICBkZWJ1ZyAgICAgICAgICAgICA6IGZhbHNlLFxuICB2ZXJib3NlICAgICAgICAgICA6IGZhbHNlLFxuICBwZXJmb3JtYW5jZSAgICAgICA6IHRydWUsXG5cbiAgLy8gb2JqZWN0IGNvbnRhaW5pbmcgYWxsIHRlbXBsYXRlcyBlbmRwb2ludHNcbiAgYXBpICAgICAgICAgICAgICAgOiB7fSxcblxuICAvLyB3aGV0aGVyIHRvIGNhY2hlIHJlc3BvbnNlc1xuICBjYWNoZSAgICAgICAgICAgICA6IHRydWUsXG5cbiAgLy8gd2hldGhlciBuZXcgcmVxdWVzdHMgc2hvdWxkIGFib3J0IHByZXZpb3VzIHJlcXVlc3RzXG4gIGludGVycnVwdFJlcXVlc3RzIDogdHJ1ZSxcblxuICAvLyBldmVudCBiaW5kaW5nXG4gIG9uICAgICAgICAgICAgICAgIDogJ2F1dG8nLFxuXG4gIC8vIGNvbnRleHQgZm9yIGFwcGx5aW5nIHN0YXRlIGNsYXNzZXNcbiAgc3RhdGVDb250ZXh0ICAgICAgOiBmYWxzZSxcblxuICAvLyBkdXJhdGlvbiBmb3IgbG9hZGluZyBzdGF0ZVxuICBsb2FkaW5nRHVyYXRpb24gICA6IDAsXG5cbiAgLy8gd2hldGhlciB0byBoaWRlIGVycm9ycyBhZnRlciBhIHBlcmlvZCBvZiB0aW1lXG4gIGhpZGVFcnJvciAgICAgICAgIDogJ2F1dG8nLFxuXG4gIC8vIGR1cmF0aW9uIGZvciBlcnJvciBzdGF0ZVxuICBlcnJvckR1cmF0aW9uICAgICA6IDIwMDAsXG5cbiAgLy8gd2hldGhlciBwYXJhbWV0ZXJzIHNob3VsZCBiZSBlbmNvZGVkIHdpdGggZW5jb2RlVVJJQ29tcG9uZW50XG4gIGVuY29kZVBhcmFtZXRlcnMgIDogdHJ1ZSxcblxuICAvLyBBUEkgYWN0aW9uIHRvIHVzZVxuICBhY3Rpb24gICAgICAgICAgICA6IGZhbHNlLFxuXG4gIC8vIHRlbXBsYXRlZCBVUkwgdG8gdXNlXG4gIHVybCAgICAgICAgICAgICAgIDogZmFsc2UsXG5cbiAgLy8gYmFzZSBVUkwgdG8gYXBwbHkgdG8gYWxsIGVuZHBvaW50c1xuICBiYXNlICAgICAgICAgICAgICA6ICcnLFxuXG4gIC8vIGRhdGEgdGhhdCB3aWxsXG4gIHVybERhdGEgICAgICAgICAgIDoge30sXG5cbiAgLy8gd2hldGhlciB0byBhZGQgZGVmYXVsdCBkYXRhIHRvIHVybCBkYXRhXG4gIGRlZmF1bHREYXRhICAgICAgICAgIDogdHJ1ZSxcblxuICAvLyB3aGV0aGVyIHRvIHNlcmlhbGl6ZSBjbG9zZXN0IGZvcm1cbiAgc2VyaWFsaXplRm9ybSAgICAgICAgOiBmYWxzZSxcblxuICAvLyBob3cgbG9uZyB0byB3YWl0IGJlZm9yZSByZXF1ZXN0IHNob3VsZCBvY2N1clxuICB0aHJvdHRsZSAgICAgICAgICAgICA6IDAsXG5cbiAgLy8gd2hldGhlciB0byB0aHJvdHRsZSBmaXJzdCByZXF1ZXN0IG9yIG9ubHkgcmVwZWF0ZWRcbiAgdGhyb3R0bGVGaXJzdFJlcXVlc3QgOiB0cnVlLFxuXG4gIC8vIHN0YW5kYXJkIGFqYXggc2V0dGluZ3NcbiAgbWV0aG9kICAgICAgICAgICAgOiAnZ2V0JyxcbiAgZGF0YSAgICAgICAgICAgICAgOiB7fSxcbiAgZGF0YVR5cGUgICAgICAgICAgOiAnanNvbicsXG5cbiAgLy8gbW9jayByZXNwb25zZVxuICBtb2NrUmVzcG9uc2UgICAgICA6IGZhbHNlLFxuICBtb2NrUmVzcG9uc2VBc3luYyA6IGZhbHNlLFxuXG4gIC8vIGFsaWFzZXMgZm9yIG1vY2tcbiAgcmVzcG9uc2UgICAgICAgICAgOiBmYWxzZSxcbiAgcmVzcG9uc2VBc3luYyAgICAgOiBmYWxzZSxcblxuICAvLyBjYWxsYmFja3MgYmVmb3JlIHJlcXVlc3RcbiAgYmVmb3JlU2VuZCAgOiBmdW5jdGlvbihzZXR0aW5ncykgeyByZXR1cm4gc2V0dGluZ3M7IH0sXG4gIGJlZm9yZVhIUiAgIDogZnVuY3Rpb24oeGhyKSB7fSxcbiAgb25SZXF1ZXN0ICAgOiBmdW5jdGlvbihwcm9taXNlLCB4aHIpIHt9LFxuXG4gIC8vIGFmdGVyIHJlcXVlc3RcbiAgb25SZXNwb25zZSAgOiBmYWxzZSwgLy8gZnVuY3Rpb24ocmVzcG9uc2UpIHsgfSxcblxuICAvLyByZXNwb25zZSB3YXMgc3VjY2Vzc2Z1bCwgaWYgSlNPTiBwYXNzZWQgdmFsaWRhdGlvblxuICBvblN1Y2Nlc3MgICA6IGZ1bmN0aW9uKHJlc3BvbnNlLCAkbW9kdWxlKSB7fSxcblxuICAvLyByZXF1ZXN0IGZpbmlzaGVkIHdpdGhvdXQgYWJvcnRpbmdcbiAgb25Db21wbGV0ZSAgOiBmdW5jdGlvbihyZXNwb25zZSwgJG1vZHVsZSkge30sXG5cbiAgLy8gZmFpbGVkIEpTT04gc3VjY2VzcyB0ZXN0XG4gIG9uRmFpbHVyZSAgIDogZnVuY3Rpb24ocmVzcG9uc2UsICRtb2R1bGUpIHt9LFxuXG4gIC8vIHNlcnZlciBlcnJvclxuICBvbkVycm9yICAgICA6IGZ1bmN0aW9uKGVycm9yTWVzc2FnZSwgJG1vZHVsZSkge30sXG5cbiAgLy8gcmVxdWVzdCBhYm9ydGVkXG4gIG9uQWJvcnQgICAgIDogZnVuY3Rpb24oZXJyb3JNZXNzYWdlLCAkbW9kdWxlKSB7fSxcblxuICBzdWNjZXNzVGVzdCA6IGZhbHNlLFxuXG4gIC8vIGVycm9yc1xuICBlcnJvciA6IHtcbiAgICBiZWZvcmVTZW5kICAgICAgICA6ICdUaGUgYmVmb3JlIHNlbmQgZnVuY3Rpb24gaGFzIGFib3J0ZWQgdGhlIHJlcXVlc3QnLFxuICAgIGVycm9yICAgICAgICAgICAgIDogJ1RoZXJlIHdhcyBhbiBlcnJvciB3aXRoIHlvdXIgcmVxdWVzdCcsXG4gICAgZXhpdENvbmRpdGlvbnMgICAgOiAnQVBJIFJlcXVlc3QgQWJvcnRlZC4gRXhpdCBjb25kaXRpb25zIG1ldCcsXG4gICAgSlNPTlBhcnNlICAgICAgICAgOiAnSlNPTiBjb3VsZCBub3QgYmUgcGFyc2VkIGR1cmluZyBlcnJvciBoYW5kbGluZycsXG4gICAgbGVnYWN5UGFyYW1ldGVycyAgOiAnWW91IGFyZSB1c2luZyBsZWdhY3kgQVBJIHN1Y2Nlc3MgY2FsbGJhY2sgbmFtZXMnLFxuICAgIG1ldGhvZCAgICAgICAgICAgIDogJ1RoZSBtZXRob2QgeW91IGNhbGxlZCBpcyBub3QgZGVmaW5lZCcsXG4gICAgbWlzc2luZ0FjdGlvbiAgICAgOiAnQVBJIGFjdGlvbiB1c2VkIGJ1dCBubyB1cmwgd2FzIGRlZmluZWQnLFxuICAgIG1pc3NpbmdTZXJpYWxpemUgIDogJ2pxdWVyeS1zZXJpYWxpemUtb2JqZWN0IGlzIHJlcXVpcmVkIHRvIGFkZCBmb3JtIGRhdGEgdG8gYW4gZXhpc3RpbmcgZGF0YSBvYmplY3QnLFxuICAgIG1pc3NpbmdVUkwgICAgICAgIDogJ05vIFVSTCBzcGVjaWZpZWQgZm9yIGFwaSBldmVudCcsXG4gICAgbm9SZXR1cm5lZFZhbHVlICAgOiAnVGhlIGJlZm9yZVNlbmQgY2FsbGJhY2sgbXVzdCByZXR1cm4gYSBzZXR0aW5ncyBvYmplY3QsIGJlZm9yZVNlbmQgaWdub3JlZC4nLFxuICAgIG5vU3RvcmFnZSAgICAgICAgIDogJ0NhY2hpbmcgcmVzcG9uc2VzIGxvY2FsbHkgcmVxdWlyZXMgc2Vzc2lvbiBzdG9yYWdlJyxcbiAgICBwYXJzZUVycm9yICAgICAgICA6ICdUaGVyZSB3YXMgYW4gZXJyb3IgcGFyc2luZyB5b3VyIHJlcXVlc3QnLFxuICAgIHJlcXVpcmVkUGFyYW1ldGVyIDogJ01pc3NpbmcgYSByZXF1aXJlZCBVUkwgcGFyYW1ldGVyOiAnLFxuICAgIHN0YXR1c01lc3NhZ2UgICAgIDogJ1NlcnZlciBnYXZlIGFuIGVycm9yOiAnLFxuICAgIHRpbWVvdXQgICAgICAgICAgIDogJ1lvdXIgcmVxdWVzdCB0aW1lZCBvdXQnXG4gIH0sXG5cbiAgcmVnRXhwICA6IHtcbiAgICByZXF1aXJlZCA6IC9cXHtcXCQqW0EtejAtOV0rXFx9L2csXG4gICAgb3B0aW9uYWwgOiAvXFx7XFwvXFwkKltBLXowLTldK1xcfS9nLFxuICB9LFxuXG4gIGNsYXNzTmFtZToge1xuICAgIGxvYWRpbmcgOiAnbG9hZGluZycsXG4gICAgZXJyb3IgICA6ICdlcnJvcidcbiAgfSxcblxuICBzZWxlY3Rvcjoge1xuICAgIGRpc2FibGVkIDogJy5kaXNhYmxlZCcsXG4gICAgZm9ybSAgICAgIDogJ2Zvcm0nXG4gIH0sXG5cbiAgbWV0YWRhdGE6IHtcbiAgICBhY3Rpb24gIDogJ2FjdGlvbicsXG4gICAgdXJsICAgICA6ICd1cmwnXG4gIH1cbn07XG5cblxuXG59KSggalF1ZXJ5LCB3aW5kb3csIGRvY3VtZW50ICk7XG5cbi8qIVxuICogIyBTZW1hbnRpYyBVSSAyLjQuMCAtIFZpc2liaWxpdHlcbiAqIGh0dHA6Ly9naXRodWIuY29tL3NlbWFudGljLW9yZy9zZW1hbnRpYy11aS9cbiAqXG4gKlxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG5cbjsoZnVuY3Rpb24gKCQsIHdpbmRvdywgZG9jdW1lbnQsIHVuZGVmaW5lZCkge1xuXG4ndXNlIHN0cmljdCc7XG5cbndpbmRvdyA9ICh0eXBlb2Ygd2luZG93ICE9ICd1bmRlZmluZWQnICYmIHdpbmRvdy5NYXRoID09IE1hdGgpXG4gID8gd2luZG93XG4gIDogKHR5cGVvZiBzZWxmICE9ICd1bmRlZmluZWQnICYmIHNlbGYuTWF0aCA9PSBNYXRoKVxuICAgID8gc2VsZlxuICAgIDogRnVuY3Rpb24oJ3JldHVybiB0aGlzJykoKVxuO1xuXG4kLmZuLnZpc2liaWxpdHkgPSBmdW5jdGlvbihwYXJhbWV0ZXJzKSB7XG4gIHZhclxuICAgICRhbGxNb2R1bGVzICAgID0gJCh0aGlzKSxcbiAgICBtb2R1bGVTZWxlY3RvciA9ICRhbGxNb2R1bGVzLnNlbGVjdG9yIHx8ICcnLFxuXG4gICAgdGltZSAgICAgICAgICAgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICBwZXJmb3JtYW5jZSAgICA9IFtdLFxuXG4gICAgcXVlcnkgICAgICAgICAgPSBhcmd1bWVudHNbMF0sXG4gICAgbWV0aG9kSW52b2tlZCAgPSAodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnKSxcbiAgICBxdWVyeUFyZ3VtZW50cyA9IFtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcbiAgICByZXR1cm5lZFZhbHVlLFxuXG4gICAgbW9kdWxlQ291bnQgICAgPSAkYWxsTW9kdWxlcy5sZW5ndGgsXG4gICAgbG9hZGVkQ291bnQgICAgPSAwXG4gIDtcblxuICAkYWxsTW9kdWxlc1xuICAgIC5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyXG4gICAgICAgIHNldHRpbmdzICAgICAgICA9ICggJC5pc1BsYWluT2JqZWN0KHBhcmFtZXRlcnMpIClcbiAgICAgICAgICA/ICQuZXh0ZW5kKHRydWUsIHt9LCAkLmZuLnZpc2liaWxpdHkuc2V0dGluZ3MsIHBhcmFtZXRlcnMpXG4gICAgICAgICAgOiAkLmV4dGVuZCh7fSwgJC5mbi52aXNpYmlsaXR5LnNldHRpbmdzKSxcblxuICAgICAgICBjbGFzc05hbWUgICAgICAgPSBzZXR0aW5ncy5jbGFzc05hbWUsXG4gICAgICAgIG5hbWVzcGFjZSAgICAgICA9IHNldHRpbmdzLm5hbWVzcGFjZSxcbiAgICAgICAgZXJyb3IgICAgICAgICAgID0gc2V0dGluZ3MuZXJyb3IsXG4gICAgICAgIG1ldGFkYXRhICAgICAgICA9IHNldHRpbmdzLm1ldGFkYXRhLFxuXG4gICAgICAgIGV2ZW50TmFtZXNwYWNlICA9ICcuJyArIG5hbWVzcGFjZSxcbiAgICAgICAgbW9kdWxlTmFtZXNwYWNlID0gJ21vZHVsZS0nICsgbmFtZXNwYWNlLFxuXG4gICAgICAgICR3aW5kb3cgICAgICAgICA9ICQod2luZG93KSxcblxuICAgICAgICAkbW9kdWxlICAgICAgICAgPSAkKHRoaXMpLFxuICAgICAgICAkY29udGV4dCAgICAgICAgPSAkKHNldHRpbmdzLmNvbnRleHQpLFxuXG4gICAgICAgICRwbGFjZWhvbGRlcixcblxuICAgICAgICBzZWxlY3RvciAgICAgICAgPSAkbW9kdWxlLnNlbGVjdG9yIHx8ICcnLFxuICAgICAgICBpbnN0YW5jZSAgICAgICAgPSAkbW9kdWxlLmRhdGEobW9kdWxlTmFtZXNwYWNlKSxcblxuICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lXG4gICAgICAgICAgfHwgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZVxuICAgICAgICAgIHx8IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgICAgICB8fCB3aW5kb3cubXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcbiAgICAgICAgICB8fCBmdW5jdGlvbihjYWxsYmFjaykgeyBzZXRUaW1lb3V0KGNhbGxiYWNrLCAwKTsgfSxcblxuICAgICAgICBlbGVtZW50ICAgICAgICAgPSB0aGlzLFxuICAgICAgICBkaXNhYmxlZCAgICAgICAgPSBmYWxzZSxcblxuICAgICAgICBjb250ZXh0T2JzZXJ2ZXIsXG4gICAgICAgIG9ic2VydmVyLFxuICAgICAgICBtb2R1bGVcbiAgICAgIDtcblxuICAgICAgbW9kdWxlID0ge1xuXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnSW5pdGlhbGl6aW5nJywgc2V0dGluZ3MpO1xuXG4gICAgICAgICAgbW9kdWxlLnNldHVwLmNhY2hlKCk7XG5cbiAgICAgICAgICBpZiggbW9kdWxlLnNob3VsZC50cmFja0NoYW5nZXMoKSApIHtcblxuICAgICAgICAgICAgaWYoc2V0dGluZ3MudHlwZSA9PSAnaW1hZ2UnKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXR1cC5pbWFnZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoc2V0dGluZ3MudHlwZSA9PSAnZml4ZWQnKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zZXR1cC5maXhlZCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihzZXR0aW5ncy5vYnNlcnZlQ2hhbmdlcykge1xuICAgICAgICAgICAgICBtb2R1bGUub2JzZXJ2ZUNoYW5nZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5iaW5kLmV2ZW50cygpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIG1vZHVsZS5zYXZlLnBvc2l0aW9uKCk7XG4gICAgICAgICAgaWYoICFtb2R1bGUuaXMudmlzaWJsZSgpICkge1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLnZpc2libGUsICRtb2R1bGUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmKHNldHRpbmdzLmluaXRpYWxDaGVjaykge1xuICAgICAgICAgICAgbW9kdWxlLmNoZWNrVmlzaWJpbGl0eSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuaW5zdGFudGlhdGUoKTtcbiAgICAgICAgfSxcblxuICAgICAgICBpbnN0YW50aWF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLmRlYnVnKCdTdG9yaW5nIGluc3RhbmNlJywgbW9kdWxlKTtcbiAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAuZGF0YShtb2R1bGVOYW1lc3BhY2UsIG1vZHVsZSlcbiAgICAgICAgICA7XG4gICAgICAgICAgaW5zdGFuY2UgPSBtb2R1bGU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZGVzdHJveTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0Rlc3Ryb3lpbmcgcHJldmlvdXMgbW9kdWxlJyk7XG4gICAgICAgICAgaWYob2JzZXJ2ZXIpIHtcbiAgICAgICAgICAgIG9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoY29udGV4dE9ic2VydmVyKSB7XG4gICAgICAgICAgICBjb250ZXh0T2JzZXJ2ZXIuZGlzY29ubmVjdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAkd2luZG93XG4gICAgICAgICAgICAub2ZmKCdsb2FkJyAgICsgZXZlbnROYW1lc3BhY2UsIG1vZHVsZS5ldmVudC5sb2FkKVxuICAgICAgICAgICAgLm9mZigncmVzaXplJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQucmVzaXplKVxuICAgICAgICAgIDtcbiAgICAgICAgICAkY29udGV4dFxuICAgICAgICAgICAgLm9mZignc2Nyb2xsJyAgICAgICArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuc2Nyb2xsKVxuICAgICAgICAgICAgLm9mZignc2Nyb2xsY2hhbmdlJyArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuc2Nyb2xsY2hhbmdlKVxuICAgICAgICAgIDtcbiAgICAgICAgICBpZihzZXR0aW5ncy50eXBlID09ICdmaXhlZCcpIHtcbiAgICAgICAgICAgIG1vZHVsZS5yZXNldEZpeGVkKCk7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLnBsYWNlaG9sZGVyKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgIC5vZmYoZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgICAucmVtb3ZlRGF0YShtb2R1bGVOYW1lc3BhY2UpXG4gICAgICAgICAgO1xuICAgICAgICB9LFxuXG4gICAgICAgIG9ic2VydmVDaGFuZ2VzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZignTXV0YXRpb25PYnNlcnZlcicgaW4gd2luZG93KSB7XG4gICAgICAgICAgICBjb250ZXh0T2JzZXJ2ZXIgPSBuZXcgTXV0YXRpb25PYnNlcnZlcihtb2R1bGUuZXZlbnQuY29udGV4dENoYW5nZWQpO1xuICAgICAgICAgICAgb2JzZXJ2ZXIgICAgICAgID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIobW9kdWxlLmV2ZW50LmNoYW5nZWQpO1xuICAgICAgICAgICAgY29udGV4dE9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQsIHtcbiAgICAgICAgICAgICAgY2hpbGRMaXN0IDogdHJ1ZSxcbiAgICAgICAgICAgICAgc3VidHJlZSAgIDogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGVsZW1lbnQsIHtcbiAgICAgICAgICAgICAgY2hpbGRMaXN0IDogdHJ1ZSxcbiAgICAgICAgICAgICAgc3VidHJlZSAgIDogdHJ1ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgdXAgbXV0YXRpb24gb2JzZXJ2ZXInLCBvYnNlcnZlcik7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGJpbmQ6IHtcbiAgICAgICAgICBldmVudHM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ0JpbmRpbmcgdmlzaWJpbGl0eSBldmVudHMgdG8gc2Nyb2xsIGFuZCByZXNpemUnKTtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnJlZnJlc2hPbkxvYWQpIHtcbiAgICAgICAgICAgICAgJHdpbmRvd1xuICAgICAgICAgICAgICAgIC5vbignbG9hZCcgICArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQubG9hZClcbiAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHdpbmRvd1xuICAgICAgICAgICAgICAub24oJ3Jlc2l6ZScgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LnJlc2l6ZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIC8vIHB1Yi9zdWIgcGF0dGVyblxuICAgICAgICAgICAgJGNvbnRleHRcbiAgICAgICAgICAgICAgLm9mZignc2Nyb2xsJyAgICAgICsgZXZlbnROYW1lc3BhY2UpXG4gICAgICAgICAgICAgIC5vbignc2Nyb2xsJyAgICAgICArIGV2ZW50TmFtZXNwYWNlLCBtb2R1bGUuZXZlbnQuc2Nyb2xsKVxuICAgICAgICAgICAgICAub24oJ3Njcm9sbGNoYW5nZScgKyBldmVudE5hbWVzcGFjZSwgbW9kdWxlLmV2ZW50LnNjcm9sbGNoYW5nZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXZlbnQ6IHtcbiAgICAgICAgICBjaGFuZ2VkOiBmdW5jdGlvbihtdXRhdGlvbnMpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdET00gdHJlZSBtb2RpZmllZCwgdXBkYXRpbmcgdmlzaWJpbGl0eSBjYWxjdWxhdGlvbnMnKTtcbiAgICAgICAgICAgIG1vZHVsZS50aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdET00gdHJlZSBtb2RpZmllZCwgdXBkYXRpbmcgc3RpY2t5IG1lbnUnKTtcbiAgICAgICAgICAgICAgbW9kdWxlLnJlZnJlc2goKTtcbiAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjb250ZXh0Q2hhbmdlZDogZnVuY3Rpb24obXV0YXRpb25zKSB7XG4gICAgICAgICAgICBbXS5mb3JFYWNoLmNhbGwobXV0YXRpb25zLCBmdW5jdGlvbihtdXRhdGlvbikge1xuICAgICAgICAgICAgICBpZihtdXRhdGlvbi5yZW1vdmVkTm9kZXMpIHtcbiAgICAgICAgICAgICAgICBbXS5mb3JFYWNoLmNhbGwobXV0YXRpb24ucmVtb3ZlZE5vZGVzLCBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgICAgICAgICAgICBpZihub2RlID09IGVsZW1lbnQgfHwgJChub2RlKS5maW5kKGVsZW1lbnQpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdFbGVtZW50IHJlbW92ZWQgZnJvbSBET00sIHRlYXJpbmcgZG93biBldmVudHMnKTtcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlLmRlc3Ryb3koKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXNpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdXaW5kb3cgcmVzaXplZCcpO1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MucmVmcmVzaE9uUmVzaXplKSB7XG4gICAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShtb2R1bGUucmVmcmVzaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsb2FkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUGFnZSBmaW5pc2hlZCBsb2FkaW5nJyk7XG4gICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUobW9kdWxlLnJlZnJlc2gpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8gcHVibGlzaGVzIHNjcm9sbGNoYW5nZSBldmVudCBvbiBvbmUgc2Nyb2xsXG4gICAgICAgICAgc2Nyb2xsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnRocm90dGxlKSB7XG4gICAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUudGltZXIpO1xuICAgICAgICAgICAgICBtb2R1bGUudGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICRjb250ZXh0LnRyaWdnZXJIYW5kbGVyKCdzY3JvbGxjaGFuZ2UnICsgZXZlbnROYW1lc3BhY2UsIFsgJGNvbnRleHQuc2Nyb2xsVG9wKCkgXSk7XG4gICAgICAgICAgICAgIH0sIHNldHRpbmdzLnRocm90dGxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgJGNvbnRleHQudHJpZ2dlckhhbmRsZXIoJ3Njcm9sbGNoYW5nZScgKyBldmVudE5hbWVzcGFjZSwgWyAkY29udGV4dC5zY3JvbGxUb3AoKSBdKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICAvLyBzdWJzY3JpYmVzIHRvIHNjcm9sbGNoYW5nZVxuICAgICAgICAgIHNjcm9sbGNoYW5nZTogZnVuY3Rpb24oZXZlbnQsIHNjcm9sbFBvc2l0aW9uKSB7XG4gICAgICAgICAgICBtb2R1bGUuY2hlY2tWaXNpYmlsaXR5KHNjcm9sbFBvc2l0aW9uKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuXG4gICAgICAgIHByZWNhY2hlOiBmdW5jdGlvbihpbWFnZXMsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgaWYgKCEoaW1hZ2VzIGluc3RhbmNlb2YgQXJyYXkpKSB7XG4gICAgICAgICAgICBpbWFnZXMgPSBbaW1hZ2VzXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBpbWFnZXNMZW5ndGggID0gaW1hZ2VzLmxlbmd0aCxcbiAgICAgICAgICAgIGxvYWRlZENvdW50ZXIgPSAwLFxuICAgICAgICAgICAgY2FjaGUgICAgICAgICA9IFtdLFxuICAgICAgICAgICAgY2FjaGVJbWFnZSAgICA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpLFxuICAgICAgICAgICAgaGFuZGxlTG9hZCAgICA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBsb2FkZWRDb3VudGVyKys7XG4gICAgICAgICAgICAgIGlmIChsb2FkZWRDb3VudGVyID49IGltYWdlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBpZiAoJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkge1xuICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICA7XG4gICAgICAgICAgd2hpbGUgKGltYWdlc0xlbmd0aC0tKSB7XG4gICAgICAgICAgICBjYWNoZUltYWdlICAgICAgICAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgICAgICAgICAgIGNhY2hlSW1hZ2Uub25sb2FkICA9IGhhbmRsZUxvYWQ7XG4gICAgICAgICAgICBjYWNoZUltYWdlLm9uZXJyb3IgPSBoYW5kbGVMb2FkO1xuICAgICAgICAgICAgY2FjaGVJbWFnZS5zcmMgICAgID0gaW1hZ2VzW2ltYWdlc0xlbmd0aF07XG4gICAgICAgICAgICBjYWNoZS5wdXNoKGNhY2hlSW1hZ2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBlbmFibGVDYWxsYmFja3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWxsb3dpbmcgY2FsbGJhY2tzIHRvIG9jY3VyJyk7XG4gICAgICAgICAgZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgfSxcblxuICAgICAgICBkaXNhYmxlQ2FsbGJhY2tzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICBtb2R1bGUuZGVidWcoJ0Rpc2FibGluZyBhbGwgY2FsbGJhY2tzIHRlbXBvcmFyaWx5Jyk7XG4gICAgICAgICAgZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNob3VsZDoge1xuICAgICAgICAgIHRyYWNrQ2hhbmdlczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnT25lIHRpbWUgcXVlcnksIG5vIG5lZWQgdG8gYmluZCBldmVudHMnKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDYWxsYmFja3MgYmVpbmcgYXR0YWNoZWQnKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXR1cDoge1xuICAgICAgICAgIGNhY2hlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS5jYWNoZSA9IHtcbiAgICAgICAgICAgICAgb2NjdXJyZWQgOiB7fSxcbiAgICAgICAgICAgICAgc2NyZWVuICAgOiB7fSxcbiAgICAgICAgICAgICAgZWxlbWVudCAgOiB7fSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbWFnZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgc3JjID0gJG1vZHVsZS5kYXRhKG1ldGFkYXRhLnNyYylcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKHNyYykge1xuICAgICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnTGF6eSBsb2FkaW5nIGltYWdlJywgc3JjKTtcbiAgICAgICAgICAgICAgc2V0dGluZ3Mub25jZSAgICAgICAgICAgPSB0cnVlO1xuICAgICAgICAgICAgICBzZXR0aW5ncy5vYnNlcnZlQ2hhbmdlcyA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgIC8vIHNob3cgd2hlbiB0b3AgdmlzaWJsZVxuICAgICAgICAgICAgICBzZXR0aW5ncy5vbk9uU2NyZWVuID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdJbWFnZSBvbiBzY3JlZW4nLCBlbGVtZW50KTtcbiAgICAgICAgICAgICAgICBtb2R1bGUucHJlY2FjaGUoc3JjLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgIG1vZHVsZS5zZXQuaW1hZ2Uoc3JjLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9hZGVkQ291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgaWYobG9hZGVkQ291bnQgPT0gbW9kdWxlQ291bnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy5vbkFsbExvYWRlZC5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLm9uTG9hZC5jYWxsKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmaXhlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1NldHRpbmcgdXAgZml4ZWQnKTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uY2UgICAgICAgICAgID0gZmFsc2U7XG4gICAgICAgICAgICBzZXR0aW5ncy5vYnNlcnZlQ2hhbmdlcyA9IGZhbHNlO1xuICAgICAgICAgICAgc2V0dGluZ3MuaW5pdGlhbENoZWNrICAgPSB0cnVlO1xuICAgICAgICAgICAgc2V0dGluZ3MucmVmcmVzaE9uTG9hZCAgPSB0cnVlO1xuICAgICAgICAgICAgaWYoIXBhcmFtZXRlcnMudHJhbnNpdGlvbikge1xuICAgICAgICAgICAgICBzZXR0aW5ncy50cmFuc2l0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtb2R1bGUuY3JlYXRlLnBsYWNlaG9sZGVyKCk7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0FkZGVkIHBsYWNlaG9sZGVyJywgJHBsYWNlaG9sZGVyKTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uVG9wUGFzc2VkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnRWxlbWVudCBwYXNzZWQsIGFkZGluZyBmaXhlZCBwb3NpdGlvbicsICRtb2R1bGUpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2hvdy5wbGFjZWhvbGRlcigpO1xuICAgICAgICAgICAgICBtb2R1bGUuc2V0LmZpeGVkKCk7XG4gICAgICAgICAgICAgIGlmKHNldHRpbmdzLnRyYW5zaXRpb24pIHtcbiAgICAgICAgICAgICAgICBpZigkLmZuLnRyYW5zaXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgJG1vZHVsZS50cmFuc2l0aW9uKHNldHRpbmdzLnRyYW5zaXRpb24sIHNldHRpbmdzLmR1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBzZXR0aW5ncy5vblRvcFBhc3NlZFJldmVyc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdFbGVtZW50IHJldHVybmVkIHRvIHBvc2l0aW9uLCByZW1vdmluZyBmaXhlZCcsICRtb2R1bGUpO1xuICAgICAgICAgICAgICBtb2R1bGUuaGlkZS5wbGFjZWhvbGRlcigpO1xuICAgICAgICAgICAgICBtb2R1bGUucmVtb3ZlLmZpeGVkKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjcmVhdGU6IHtcbiAgICAgICAgICBwbGFjZWhvbGRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnQ3JlYXRpbmcgZml4ZWQgcG9zaXRpb24gcGxhY2Vob2xkZXInKTtcbiAgICAgICAgICAgICRwbGFjZWhvbGRlciA9ICRtb2R1bGVcbiAgICAgICAgICAgICAgLmNsb25lKGZhbHNlKVxuICAgICAgICAgICAgICAuY3NzKCdkaXNwbGF5JywgJ25vbmUnKVxuICAgICAgICAgICAgICAuYWRkQ2xhc3MoY2xhc3NOYW1lLnBsYWNlaG9sZGVyKVxuICAgICAgICAgICAgICAuaW5zZXJ0QWZ0ZXIoJG1vZHVsZSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2hvdzoge1xuICAgICAgICAgIHBsYWNlaG9sZGVyOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTaG93aW5nIHBsYWNlaG9sZGVyJyk7XG4gICAgICAgICAgICAkcGxhY2Vob2xkZXJcbiAgICAgICAgICAgICAgLmNzcygnZGlzcGxheScsICdibG9jaycpXG4gICAgICAgICAgICAgIC5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJylcbiAgICAgICAgICAgIDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGhpZGU6IHtcbiAgICAgICAgICBwbGFjZWhvbGRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnSGlkaW5nIHBsYWNlaG9sZGVyJyk7XG4gICAgICAgICAgICAkcGxhY2Vob2xkZXJcbiAgICAgICAgICAgICAgLmNzcygnZGlzcGxheScsICdub25lJylcbiAgICAgICAgICAgICAgLmNzcygndmlzaWJpbGl0eScsICcnKVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXQ6IHtcbiAgICAgICAgICBmaXhlZDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2V0dGluZyBlbGVtZW50IHRvIGZpeGVkIHBvc2l0aW9uJyk7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5hZGRDbGFzcyhjbGFzc05hbWUuZml4ZWQpXG4gICAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uIDogJ2ZpeGVkJyxcbiAgICAgICAgICAgICAgICB0b3AgICAgICA6IHNldHRpbmdzLm9mZnNldCArICdweCcsXG4gICAgICAgICAgICAgICAgbGVmdCAgICAgOiAnYXV0bycsXG4gICAgICAgICAgICAgICAgekluZGV4ICAgOiBzZXR0aW5ncy56SW5kZXhcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uRml4ZWQuY2FsbChlbGVtZW50KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGltYWdlOiBmdW5jdGlvbihzcmMsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAkbW9kdWxlXG4gICAgICAgICAgICAgIC5hdHRyKCdzcmMnLCBzcmMpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy50cmFuc2l0aW9uKSB7XG4gICAgICAgICAgICAgIGlmKCAkLmZuLnRyYW5zaXRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGlmKCRtb2R1bGUuaGFzQ2xhc3MoY2xhc3NOYW1lLnZpc2libGUpKSB7XG4gICAgICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1RyYW5zaXRpb24gYWxyZWFkeSBvY2N1cnJlZCBvbiB0aGlzIGltYWdlLCBza2lwcGluZyBhbmltYXRpb24nKTtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJG1vZHVsZS50cmFuc2l0aW9uKHNldHRpbmdzLnRyYW5zaXRpb24sIHNldHRpbmdzLmR1cmF0aW9uLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJG1vZHVsZS5mYWRlSW4oc2V0dGluZ3MuZHVyYXRpb24sIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICRtb2R1bGUuc2hvdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpczoge1xuICAgICAgICAgIG9uU2NyZWVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjYWxjdWxhdGlvbnMgICA9IG1vZHVsZS5nZXQuZWxlbWVudENhbGN1bGF0aW9ucygpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICByZXR1cm4gY2FsY3VsYXRpb25zLm9uU2NyZWVuO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb2ZmU2NyZWVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjYWxjdWxhdGlvbnMgICA9IG1vZHVsZS5nZXQuZWxlbWVudENhbGN1bGF0aW9ucygpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICByZXR1cm4gY2FsY3VsYXRpb25zLm9mZlNjcmVlbjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZpc2libGU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmNhY2hlICYmIG1vZHVsZS5jYWNoZS5lbGVtZW50KSB7XG4gICAgICAgICAgICAgIHJldHVybiAhKG1vZHVsZS5jYWNoZS5lbGVtZW50LndpZHRoID09PSAwICYmIG1vZHVsZS5jYWNoZS5lbGVtZW50Lm9mZnNldC50b3AgPT09IDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdmVydGljYWxseVNjcm9sbGFibGVDb250ZXh0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBvdmVyZmxvd1kgPSAoJGNvbnRleHQuZ2V0KDApICE9PSB3aW5kb3cpXG4gICAgICAgICAgICAgICAgPyAkY29udGV4dC5jc3MoJ292ZXJmbG93LXknKVxuICAgICAgICAgICAgICAgIDogZmFsc2VcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHJldHVybiAob3ZlcmZsb3dZID09ICdhdXRvJyB8fCBvdmVyZmxvd1kgPT0gJ3Njcm9sbCcpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgaG9yaXpvbnRhbGx5U2Nyb2xsYWJsZUNvbnRleHQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgIG92ZXJmbG93WCA9ICgkY29udGV4dC5nZXQoMCkgIT09IHdpbmRvdylcbiAgICAgICAgICAgICAgICA/ICRjb250ZXh0LmNzcygnb3ZlcmZsb3cteCcpXG4gICAgICAgICAgICAgICAgOiBmYWxzZVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgcmV0dXJuIChvdmVyZmxvd1ggPT0gJ2F1dG8nIHx8IG92ZXJmbG93WCA9PSAnc2Nyb2xsJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJlZnJlc2g6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUmVmcmVzaGluZyBjb25zdGFudHMgKHdpZHRoL2hlaWdodCknKTtcbiAgICAgICAgICBpZihzZXR0aW5ncy50eXBlID09ICdmaXhlZCcpIHtcbiAgICAgICAgICAgIG1vZHVsZS5yZXNldEZpeGVkKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG1vZHVsZS5yZXNldCgpO1xuICAgICAgICAgIG1vZHVsZS5zYXZlLnBvc2l0aW9uKCk7XG4gICAgICAgICAgaWYoc2V0dGluZ3MuY2hlY2tPblJlZnJlc2gpIHtcbiAgICAgICAgICAgIG1vZHVsZS5jaGVja1Zpc2liaWxpdHkoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc2V0dGluZ3Mub25SZWZyZXNoLmNhbGwoZWxlbWVudCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXRGaXhlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIG1vZHVsZS5yZW1vdmUuZml4ZWQoKTtcbiAgICAgICAgICBtb2R1bGUucmVtb3ZlLm9jY3VycmVkKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdSZXNldHRpbmcgYWxsIGNhY2hlZCB2YWx1ZXMnKTtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG1vZHVsZS5jYWNoZSkgKSB7XG4gICAgICAgICAgICBtb2R1bGUuY2FjaGUuc2NyZWVuID0ge307XG4gICAgICAgICAgICBtb2R1bGUuY2FjaGUuZWxlbWVudCA9IHt9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBjaGVja1Zpc2liaWxpdHk6IGZ1bmN0aW9uKHNjcm9sbCkge1xuICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdDaGVja2luZyB2aXNpYmlsaXR5IG9mIGVsZW1lbnQnLCBtb2R1bGUuY2FjaGUuZWxlbWVudCk7XG5cbiAgICAgICAgICBpZiggIWRpc2FibGVkICYmIG1vZHVsZS5pcy52aXNpYmxlKCkgKSB7XG5cbiAgICAgICAgICAgIC8vIHNhdmUgc2Nyb2xsIHBvc2l0aW9uXG4gICAgICAgICAgICBtb2R1bGUuc2F2ZS5zY3JvbGwoc2Nyb2xsKTtcblxuICAgICAgICAgICAgLy8gdXBkYXRlIGNhbGN1bGF0aW9ucyBkZXJpdmVkIGZyb20gc2Nyb2xsXG4gICAgICAgICAgICBtb2R1bGUuc2F2ZS5jYWxjdWxhdGlvbnMoKTtcblxuICAgICAgICAgICAgLy8gcGVyY2VudGFnZVxuICAgICAgICAgICAgbW9kdWxlLnBhc3NlZCgpO1xuXG4gICAgICAgICAgICAvLyByZXZlcnNlIChtdXN0IGJlIGZpcnN0KVxuICAgICAgICAgICAgbW9kdWxlLnBhc3NpbmdSZXZlcnNlKCk7XG4gICAgICAgICAgICBtb2R1bGUudG9wVmlzaWJsZVJldmVyc2UoKTtcbiAgICAgICAgICAgIG1vZHVsZS5ib3R0b21WaXNpYmxlUmV2ZXJzZSgpO1xuICAgICAgICAgICAgbW9kdWxlLnRvcFBhc3NlZFJldmVyc2UoKTtcbiAgICAgICAgICAgIG1vZHVsZS5ib3R0b21QYXNzZWRSZXZlcnNlKCk7XG5cbiAgICAgICAgICAgIC8vIG9uZSB0aW1lXG4gICAgICAgICAgICBtb2R1bGUub25TY3JlZW4oKTtcbiAgICAgICAgICAgIG1vZHVsZS5vZmZTY3JlZW4oKTtcbiAgICAgICAgICAgIG1vZHVsZS5wYXNzaW5nKCk7XG4gICAgICAgICAgICBtb2R1bGUudG9wVmlzaWJsZSgpO1xuICAgICAgICAgICAgbW9kdWxlLmJvdHRvbVZpc2libGUoKTtcbiAgICAgICAgICAgIG1vZHVsZS50b3BQYXNzZWQoKTtcbiAgICAgICAgICAgIG1vZHVsZS5ib3R0b21QYXNzZWQoKTtcblxuICAgICAgICAgICAgLy8gb24gdXBkYXRlIGNhbGxiYWNrXG4gICAgICAgICAgICBpZihzZXR0aW5ncy5vblVwZGF0ZSkge1xuICAgICAgICAgICAgICBzZXR0aW5ncy5vblVwZGF0ZS5jYWxsKGVsZW1lbnQsIG1vZHVsZS5nZXQuZWxlbWVudENhbGN1bGF0aW9ucygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcGFzc2VkOiBmdW5jdGlvbihhbW91bnQsIG5ld0NhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBjYWxjdWxhdGlvbnMgICA9IG1vZHVsZS5nZXQuZWxlbWVudENhbGN1bGF0aW9ucygpLFxuICAgICAgICAgICAgYW1vdW50SW5QaXhlbHNcbiAgICAgICAgICA7XG4gICAgICAgICAgLy8gYXNzaWduIGNhbGxiYWNrXG4gICAgICAgICAgaWYoYW1vdW50ICYmIG5ld0NhbGxiYWNrKSB7XG4gICAgICAgICAgICBzZXR0aW5ncy5vblBhc3NlZFthbW91bnRdID0gbmV3Q2FsbGJhY2s7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoYW1vdW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiAobW9kdWxlLmdldC5waXhlbHNQYXNzZWQoYW1vdW50KSA+IGNhbGN1bGF0aW9ucy5waXhlbHNQYXNzZWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGNhbGN1bGF0aW9ucy5wYXNzaW5nKSB7XG4gICAgICAgICAgICAkLmVhY2goc2V0dGluZ3Mub25QYXNzZWQsIGZ1bmN0aW9uKGFtb3VudCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgaWYoY2FsY3VsYXRpb25zLmJvdHRvbVZpc2libGUgfHwgY2FsY3VsYXRpb25zLnBpeGVsc1Bhc3NlZCA+IG1vZHVsZS5nZXQucGl4ZWxzUGFzc2VkKGFtb3VudCkpIHtcbiAgICAgICAgICAgICAgICBtb2R1bGUuZXhlY3V0ZShjYWxsYmFjaywgYW1vdW50KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCFzZXR0aW5ncy5vbmNlKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5vY2N1cnJlZChjYWxsYmFjayk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBvblNjcmVlbjogZnVuY3Rpb24obmV3Q2FsbGJhY2spIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIGNhbGN1bGF0aW9ucyA9IG1vZHVsZS5nZXQuZWxlbWVudENhbGN1bGF0aW9ucygpLFxuICAgICAgICAgICAgY2FsbGJhY2sgICAgID0gbmV3Q2FsbGJhY2sgfHwgc2V0dGluZ3Mub25PblNjcmVlbixcbiAgICAgICAgICAgIGNhbGxiYWNrTmFtZSA9ICdvblNjcmVlbidcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYobmV3Q2FsbGJhY2spIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIGNhbGxiYWNrIGZvciBvblNjcmVlbicsIG5ld0NhbGxiYWNrKTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uT25TY3JlZW4gPSBuZXdDYWxsYmFjaztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoY2FsY3VsYXRpb25zLm9uU2NyZWVuKSB7XG4gICAgICAgICAgICBtb2R1bGUuZXhlY3V0ZShjYWxsYmFjaywgY2FsbGJhY2tOYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZighc2V0dGluZ3Mub25jZSkge1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5vY2N1cnJlZChjYWxsYmFja05hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihuZXdDYWxsYmFjayAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsY3VsYXRpb25zLm9uT25TY3JlZW47XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIG9mZlNjcmVlbjogZnVuY3Rpb24obmV3Q2FsbGJhY2spIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIGNhbGN1bGF0aW9ucyA9IG1vZHVsZS5nZXQuZWxlbWVudENhbGN1bGF0aW9ucygpLFxuICAgICAgICAgICAgY2FsbGJhY2sgICAgID0gbmV3Q2FsbGJhY2sgfHwgc2V0dGluZ3Mub25PZmZTY3JlZW4sXG4gICAgICAgICAgICBjYWxsYmFja05hbWUgPSAnb2ZmU2NyZWVuJ1xuICAgICAgICAgIDtcbiAgICAgICAgICBpZihuZXdDYWxsYmFjaykge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgY2FsbGJhY2sgZm9yIG9mZlNjcmVlbicsIG5ld0NhbGxiYWNrKTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uT2ZmU2NyZWVuID0gbmV3Q2FsbGJhY2s7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKGNhbGN1bGF0aW9ucy5vZmZTY3JlZW4pIHtcbiAgICAgICAgICAgIG1vZHVsZS5leGVjdXRlKGNhbGxiYWNrLCBjYWxsYmFja05hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKCFzZXR0aW5ncy5vbmNlKSB7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLm9jY3VycmVkKGNhbGxiYWNrTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKG5ld0NhbGxiYWNrICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxjdWxhdGlvbnMub25PZmZTY3JlZW47XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHBhc3Npbmc6IGZ1bmN0aW9uKG5ld0NhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBjYWxjdWxhdGlvbnMgPSBtb2R1bGUuZ2V0LmVsZW1lbnRDYWxjdWxhdGlvbnMoKSxcbiAgICAgICAgICAgIGNhbGxiYWNrICAgICA9IG5ld0NhbGxiYWNrIHx8IHNldHRpbmdzLm9uUGFzc2luZyxcbiAgICAgICAgICAgIGNhbGxiYWNrTmFtZSA9ICdwYXNzaW5nJ1xuICAgICAgICAgIDtcbiAgICAgICAgICBpZihuZXdDYWxsYmFjaykge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgY2FsbGJhY2sgZm9yIHBhc3NpbmcnLCBuZXdDYWxsYmFjayk7XG4gICAgICAgICAgICBzZXR0aW5ncy5vblBhc3NpbmcgPSBuZXdDYWxsYmFjaztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoY2FsY3VsYXRpb25zLnBhc3NpbmcpIHtcbiAgICAgICAgICAgIG1vZHVsZS5leGVjdXRlKGNhbGxiYWNrLCBjYWxsYmFja05hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKCFzZXR0aW5ncy5vbmNlKSB7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLm9jY3VycmVkKGNhbGxiYWNrTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKG5ld0NhbGxiYWNrICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBjYWxjdWxhdGlvbnMucGFzc2luZztcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cblxuICAgICAgICB0b3BWaXNpYmxlOiBmdW5jdGlvbihuZXdDYWxsYmFjaykge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgY2FsY3VsYXRpb25zID0gbW9kdWxlLmdldC5lbGVtZW50Q2FsY3VsYXRpb25zKCksXG4gICAgICAgICAgICBjYWxsYmFjayAgICAgPSBuZXdDYWxsYmFjayB8fCBzZXR0aW5ncy5vblRvcFZpc2libGUsXG4gICAgICAgICAgICBjYWxsYmFja05hbWUgPSAndG9wVmlzaWJsZSdcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYobmV3Q2FsbGJhY2spIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIGNhbGxiYWNrIGZvciB0b3AgdmlzaWJsZScsIG5ld0NhbGxiYWNrKTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uVG9wVmlzaWJsZSA9IG5ld0NhbGxiYWNrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihjYWxjdWxhdGlvbnMudG9wVmlzaWJsZSkge1xuICAgICAgICAgICAgbW9kdWxlLmV4ZWN1dGUoY2FsbGJhY2ssIGNhbGxiYWNrTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoIXNldHRpbmdzLm9uY2UpIHtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUub2NjdXJyZWQoY2FsbGJhY2tOYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYobmV3Q2FsbGJhY2sgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGN1bGF0aW9ucy50b3BWaXNpYmxlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBib3R0b21WaXNpYmxlOiBmdW5jdGlvbihuZXdDYWxsYmFjaykge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgY2FsY3VsYXRpb25zID0gbW9kdWxlLmdldC5lbGVtZW50Q2FsY3VsYXRpb25zKCksXG4gICAgICAgICAgICBjYWxsYmFjayAgICAgPSBuZXdDYWxsYmFjayB8fCBzZXR0aW5ncy5vbkJvdHRvbVZpc2libGUsXG4gICAgICAgICAgICBjYWxsYmFja05hbWUgPSAnYm90dG9tVmlzaWJsZSdcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYobmV3Q2FsbGJhY2spIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIGNhbGxiYWNrIGZvciBib3R0b20gdmlzaWJsZScsIG5ld0NhbGxiYWNrKTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uQm90dG9tVmlzaWJsZSA9IG5ld0NhbGxiYWNrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihjYWxjdWxhdGlvbnMuYm90dG9tVmlzaWJsZSkge1xuICAgICAgICAgICAgbW9kdWxlLmV4ZWN1dGUoY2FsbGJhY2ssIGNhbGxiYWNrTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoIXNldHRpbmdzLm9uY2UpIHtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUub2NjdXJyZWQoY2FsbGJhY2tOYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYobmV3Q2FsbGJhY2sgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGN1bGF0aW9ucy5ib3R0b21WaXNpYmxlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB0b3BQYXNzZWQ6IGZ1bmN0aW9uKG5ld0NhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBjYWxjdWxhdGlvbnMgPSBtb2R1bGUuZ2V0LmVsZW1lbnRDYWxjdWxhdGlvbnMoKSxcbiAgICAgICAgICAgIGNhbGxiYWNrICAgICA9IG5ld0NhbGxiYWNrIHx8IHNldHRpbmdzLm9uVG9wUGFzc2VkLFxuICAgICAgICAgICAgY2FsbGJhY2tOYW1lID0gJ3RvcFBhc3NlZCdcbiAgICAgICAgICA7XG4gICAgICAgICAgaWYobmV3Q2FsbGJhY2spIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQWRkaW5nIGNhbGxiYWNrIGZvciB0b3AgcGFzc2VkJywgbmV3Q2FsbGJhY2spO1xuICAgICAgICAgICAgc2V0dGluZ3Mub25Ub3BQYXNzZWQgPSBuZXdDYWxsYmFjaztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoY2FsY3VsYXRpb25zLnRvcFBhc3NlZCkge1xuICAgICAgICAgICAgbW9kdWxlLmV4ZWN1dGUoY2FsbGJhY2ssIGNhbGxiYWNrTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoIXNldHRpbmdzLm9uY2UpIHtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUub2NjdXJyZWQoY2FsbGJhY2tOYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYobmV3Q2FsbGJhY2sgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuIGNhbGN1bGF0aW9ucy50b3BQYXNzZWQ7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGJvdHRvbVBhc3NlZDogZnVuY3Rpb24obmV3Q2FsbGJhY2spIHtcbiAgICAgICAgICB2YXJcbiAgICAgICAgICAgIGNhbGN1bGF0aW9ucyA9IG1vZHVsZS5nZXQuZWxlbWVudENhbGN1bGF0aW9ucygpLFxuICAgICAgICAgICAgY2FsbGJhY2sgICAgID0gbmV3Q2FsbGJhY2sgfHwgc2V0dGluZ3Mub25Cb3R0b21QYXNzZWQsXG4gICAgICAgICAgICBjYWxsYmFja05hbWUgPSAnYm90dG9tUGFzc2VkJ1xuICAgICAgICAgIDtcbiAgICAgICAgICBpZihuZXdDYWxsYmFjaykge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgY2FsbGJhY2sgZm9yIGJvdHRvbSBwYXNzZWQnLCBuZXdDYWxsYmFjayk7XG4gICAgICAgICAgICBzZXR0aW5ncy5vbkJvdHRvbVBhc3NlZCA9IG5ld0NhbGxiYWNrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihjYWxjdWxhdGlvbnMuYm90dG9tUGFzc2VkKSB7XG4gICAgICAgICAgICBtb2R1bGUuZXhlY3V0ZShjYWxsYmFjaywgY2FsbGJhY2tOYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZighc2V0dGluZ3Mub25jZSkge1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5vY2N1cnJlZChjYWxsYmFja05hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihuZXdDYWxsYmFjayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gY2FsY3VsYXRpb25zLmJvdHRvbVBhc3NlZDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcGFzc2luZ1JldmVyc2U6IGZ1bmN0aW9uKG5ld0NhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBjYWxjdWxhdGlvbnMgPSBtb2R1bGUuZ2V0LmVsZW1lbnRDYWxjdWxhdGlvbnMoKSxcbiAgICAgICAgICAgIGNhbGxiYWNrICAgICA9IG5ld0NhbGxiYWNrIHx8IHNldHRpbmdzLm9uUGFzc2luZ1JldmVyc2UsXG4gICAgICAgICAgICBjYWxsYmFja05hbWUgPSAncGFzc2luZ1JldmVyc2UnXG4gICAgICAgICAgO1xuICAgICAgICAgIGlmKG5ld0NhbGxiYWNrKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0FkZGluZyBjYWxsYmFjayBmb3IgcGFzc2luZyByZXZlcnNlJywgbmV3Q2FsbGJhY2spO1xuICAgICAgICAgICAgc2V0dGluZ3Mub25QYXNzaW5nUmV2ZXJzZSA9IG5ld0NhbGxiYWNrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZighY2FsY3VsYXRpb25zLnBhc3NpbmcpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5nZXQub2NjdXJyZWQoJ3Bhc3NpbmcnKSkge1xuICAgICAgICAgICAgICBtb2R1bGUuZXhlY3V0ZShjYWxsYmFjaywgY2FsbGJhY2tOYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZighc2V0dGluZ3Mub25jZSkge1xuICAgICAgICAgICAgbW9kdWxlLnJlbW92ZS5vY2N1cnJlZChjYWxsYmFja05hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihuZXdDYWxsYmFjayAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gIWNhbGN1bGF0aW9ucy5wYXNzaW5nO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuXG4gICAgICAgIHRvcFZpc2libGVSZXZlcnNlOiBmdW5jdGlvbihuZXdDYWxsYmFjaykge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgY2FsY3VsYXRpb25zID0gbW9kdWxlLmdldC5lbGVtZW50Q2FsY3VsYXRpb25zKCksXG4gICAgICAgICAgICBjYWxsYmFjayAgICAgPSBuZXdDYWxsYmFjayB8fCBzZXR0aW5ncy5vblRvcFZpc2libGVSZXZlcnNlLFxuICAgICAgICAgICAgY2FsbGJhY2tOYW1lID0gJ3RvcFZpc2libGVSZXZlcnNlJ1xuICAgICAgICAgIDtcbiAgICAgICAgICBpZihuZXdDYWxsYmFjaykge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgY2FsbGJhY2sgZm9yIHRvcCB2aXNpYmxlIHJldmVyc2UnLCBuZXdDYWxsYmFjayk7XG4gICAgICAgICAgICBzZXR0aW5ncy5vblRvcFZpc2libGVSZXZlcnNlID0gbmV3Q2FsbGJhY2s7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCFjYWxjdWxhdGlvbnMudG9wVmlzaWJsZSkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmdldC5vY2N1cnJlZCgndG9wVmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5leGVjdXRlKGNhbGxiYWNrLCBjYWxsYmFja05hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKCFzZXR0aW5ncy5vbmNlKSB7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLm9jY3VycmVkKGNhbGxiYWNrTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKG5ld0NhbGxiYWNrID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiAhY2FsY3VsYXRpb25zLnRvcFZpc2libGU7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGJvdHRvbVZpc2libGVSZXZlcnNlOiBmdW5jdGlvbihuZXdDYWxsYmFjaykge1xuICAgICAgICAgIHZhclxuICAgICAgICAgICAgY2FsY3VsYXRpb25zID0gbW9kdWxlLmdldC5lbGVtZW50Q2FsY3VsYXRpb25zKCksXG4gICAgICAgICAgICBjYWxsYmFjayAgICAgPSBuZXdDYWxsYmFjayB8fCBzZXR0aW5ncy5vbkJvdHRvbVZpc2libGVSZXZlcnNlLFxuICAgICAgICAgICAgY2FsbGJhY2tOYW1lID0gJ2JvdHRvbVZpc2libGVSZXZlcnNlJ1xuICAgICAgICAgIDtcbiAgICAgICAgICBpZihuZXdDYWxsYmFjaykge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgY2FsbGJhY2sgZm9yIGJvdHRvbSB2aXNpYmxlIHJldmVyc2UnLCBuZXdDYWxsYmFjayk7XG4gICAgICAgICAgICBzZXR0aW5ncy5vbkJvdHRvbVZpc2libGVSZXZlcnNlID0gbmV3Q2FsbGJhY2s7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCFjYWxjdWxhdGlvbnMuYm90dG9tVmlzaWJsZSkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmdldC5vY2N1cnJlZCgnYm90dG9tVmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5leGVjdXRlKGNhbGxiYWNrLCBjYWxsYmFja05hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKCFzZXR0aW5ncy5vbmNlKSB7XG4gICAgICAgICAgICBtb2R1bGUucmVtb3ZlLm9jY3VycmVkKGNhbGxiYWNrTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKG5ld0NhbGxiYWNrID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiAhY2FsY3VsYXRpb25zLmJvdHRvbVZpc2libGU7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHRvcFBhc3NlZFJldmVyc2U6IGZ1bmN0aW9uKG5ld0NhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBjYWxjdWxhdGlvbnMgPSBtb2R1bGUuZ2V0LmVsZW1lbnRDYWxjdWxhdGlvbnMoKSxcbiAgICAgICAgICAgIGNhbGxiYWNrICAgICA9IG5ld0NhbGxiYWNrIHx8IHNldHRpbmdzLm9uVG9wUGFzc2VkUmV2ZXJzZSxcbiAgICAgICAgICAgIGNhbGxiYWNrTmFtZSA9ICd0b3BQYXNzZWRSZXZlcnNlJ1xuICAgICAgICAgIDtcbiAgICAgICAgICBpZihuZXdDYWxsYmFjaykge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgY2FsbGJhY2sgZm9yIHRvcCBwYXNzZWQgcmV2ZXJzZScsIG5ld0NhbGxiYWNrKTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uVG9wUGFzc2VkUmV2ZXJzZSA9IG5ld0NhbGxiYWNrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZighY2FsY3VsYXRpb25zLnRvcFBhc3NlZCkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmdldC5vY2N1cnJlZCgndG9wUGFzc2VkJykpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmV4ZWN1dGUoY2FsbGJhY2ssIGNhbGxiYWNrTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoIXNldHRpbmdzLm9uY2UpIHtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUub2NjdXJyZWQoY2FsbGJhY2tOYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYobmV3Q2FsbGJhY2sgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuICFjYWxjdWxhdGlvbnMub25Ub3BQYXNzZWQ7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGJvdHRvbVBhc3NlZFJldmVyc2U6IGZ1bmN0aW9uKG5ld0NhbGxiYWNrKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBjYWxjdWxhdGlvbnMgPSBtb2R1bGUuZ2V0LmVsZW1lbnRDYWxjdWxhdGlvbnMoKSxcbiAgICAgICAgICAgIGNhbGxiYWNrICAgICA9IG5ld0NhbGxiYWNrIHx8IHNldHRpbmdzLm9uQm90dG9tUGFzc2VkUmV2ZXJzZSxcbiAgICAgICAgICAgIGNhbGxiYWNrTmFtZSA9ICdib3R0b21QYXNzZWRSZXZlcnNlJ1xuICAgICAgICAgIDtcbiAgICAgICAgICBpZihuZXdDYWxsYmFjaykge1xuICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdBZGRpbmcgY2FsbGJhY2sgZm9yIGJvdHRvbSBwYXNzZWQgcmV2ZXJzZScsIG5ld0NhbGxiYWNrKTtcbiAgICAgICAgICAgIHNldHRpbmdzLm9uQm90dG9tUGFzc2VkUmV2ZXJzZSA9IG5ld0NhbGxiYWNrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZighY2FsY3VsYXRpb25zLmJvdHRvbVBhc3NlZCkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmdldC5vY2N1cnJlZCgnYm90dG9tUGFzc2VkJykpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLmV4ZWN1dGUoY2FsbGJhY2ssIGNhbGxiYWNrTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoIXNldHRpbmdzLm9uY2UpIHtcbiAgICAgICAgICAgIG1vZHVsZS5yZW1vdmUub2NjdXJyZWQoY2FsbGJhY2tOYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYobmV3Q2FsbGJhY2sgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmV0dXJuICFjYWxjdWxhdGlvbnMuYm90dG9tUGFzc2VkO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBleGVjdXRlOiBmdW5jdGlvbihjYWxsYmFjaywgY2FsbGJhY2tOYW1lKSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBjYWxjdWxhdGlvbnMgPSBtb2R1bGUuZ2V0LmVsZW1lbnRDYWxjdWxhdGlvbnMoKSxcbiAgICAgICAgICAgIHNjcmVlbiAgICAgICA9IG1vZHVsZS5nZXQuc2NyZWVuQ2FsY3VsYXRpb25zKClcbiAgICAgICAgICA7XG4gICAgICAgICAgY2FsbGJhY2sgPSBjYWxsYmFjayB8fCBmYWxzZTtcbiAgICAgICAgICBpZihjYWxsYmFjaykge1xuICAgICAgICAgICAgaWYoc2V0dGluZ3MuY29udGludW91cykge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0NhbGxiYWNrIGJlaW5nIGNhbGxlZCBjb250aW51b3VzbHknLCBjYWxsYmFja05hbWUsIGNhbGN1bGF0aW9ucyk7XG4gICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwoZWxlbWVudCwgY2FsY3VsYXRpb25zLCBzY3JlZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZighbW9kdWxlLmdldC5vY2N1cnJlZChjYWxsYmFja05hbWUpKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnQ29uZGl0aW9ucyBtZXQnLCBjYWxsYmFja05hbWUsIGNhbGN1bGF0aW9ucyk7XG4gICAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwoZWxlbWVudCwgY2FsY3VsYXRpb25zLCBzY3JlZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBtb2R1bGUuc2F2ZS5vY2N1cnJlZChjYWxsYmFja05hbWUpO1xuICAgICAgICB9LFxuXG4gICAgICAgIHJlbW92ZToge1xuICAgICAgICAgIGZpeGVkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIG1vZHVsZS5kZWJ1ZygnUmVtb3ZpbmcgZml4ZWQgcG9zaXRpb24nKTtcbiAgICAgICAgICAgICRtb2R1bGVcbiAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKGNsYXNzTmFtZS5maXhlZClcbiAgICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgICAgcG9zaXRpb24gOiAnJyxcbiAgICAgICAgICAgICAgICB0b3AgICAgICA6ICcnLFxuICAgICAgICAgICAgICAgIGxlZnQgICAgIDogJycsXG4gICAgICAgICAgICAgICAgekluZGV4ICAgOiAnJ1xuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgc2V0dGluZ3Mub25VbmZpeGVkLmNhbGwoZWxlbWVudCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwbGFjZWhvbGRlcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuZGVidWcoJ1JlbW92aW5nIHBsYWNlaG9sZGVyIGNvbnRlbnQnKTtcbiAgICAgICAgICAgIGlmKCRwbGFjZWhvbGRlcikge1xuICAgICAgICAgICAgICAkcGxhY2Vob2xkZXIucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvY2N1cnJlZDogZnVuY3Rpb24oY2FsbGJhY2spIHtcbiAgICAgICAgICAgIGlmKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgIG9jY3VycmVkID0gbW9kdWxlLmNhY2hlLm9jY3VycmVkXG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYob2NjdXJyZWRbY2FsbGJhY2tdICE9PSB1bmRlZmluZWQgJiYgb2NjdXJyZWRbY2FsbGJhY2tdID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmRlYnVnKCdDYWxsYmFjayBjYW4gbm93IGJlIGNhbGxlZCBhZ2FpbicsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICBtb2R1bGUuY2FjaGUub2NjdXJyZWRbY2FsbGJhY2tdID0gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuY2FjaGUub2NjdXJyZWQgPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2F2ZToge1xuICAgICAgICAgIGNhbGN1bGF0aW9uczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUudmVyYm9zZSgnU2F2aW5nIGFsbCBjYWxjdWxhdGlvbnMgbmVjZXNzYXJ5IHRvIGRldGVybWluZSBwb3NpdGlvbmluZycpO1xuICAgICAgICAgICAgbW9kdWxlLnNhdmUuZGlyZWN0aW9uKCk7XG4gICAgICAgICAgICBtb2R1bGUuc2F2ZS5zY3JlZW5DYWxjdWxhdGlvbnMoKTtcbiAgICAgICAgICAgIG1vZHVsZS5zYXZlLmVsZW1lbnRDYWxjdWxhdGlvbnMoKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9jY3VycmVkOiBmdW5jdGlvbihjYWxsYmFjaykge1xuICAgICAgICAgICAgaWYoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgaWYobW9kdWxlLmNhY2hlLm9jY3VycmVkW2NhbGxiYWNrXSA9PT0gdW5kZWZpbmVkIHx8IChtb2R1bGUuY2FjaGUub2NjdXJyZWRbY2FsbGJhY2tdICE9PSB0cnVlKSkge1xuICAgICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTYXZpbmcgY2FsbGJhY2sgb2NjdXJyZWQnLCBjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmNhY2hlLm9jY3VycmVkW2NhbGxiYWNrXSA9IHRydWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHNjcm9sbDogZnVuY3Rpb24oc2Nyb2xsUG9zaXRpb24pIHtcbiAgICAgICAgICAgIHNjcm9sbFBvc2l0aW9uICAgICAgPSBzY3JvbGxQb3NpdGlvbiArIHNldHRpbmdzLm9mZnNldCB8fCAkY29udGV4dC5zY3JvbGxUb3AoKSArIHNldHRpbmdzLm9mZnNldDtcbiAgICAgICAgICAgIG1vZHVsZS5jYWNoZS5zY3JvbGwgPSBzY3JvbGxQb3NpdGlvbjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRpcmVjdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgc2Nyb2xsICAgICA9IG1vZHVsZS5nZXQuc2Nyb2xsKCksXG4gICAgICAgICAgICAgIGxhc3RTY3JvbGwgPSBtb2R1bGUuZ2V0Lmxhc3RTY3JvbGwoKSxcbiAgICAgICAgICAgICAgZGlyZWN0aW9uXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzY3JvbGwgPiBsYXN0U2Nyb2xsICYmIGxhc3RTY3JvbGwpIHtcbiAgICAgICAgICAgICAgZGlyZWN0aW9uID0gJ2Rvd24nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZihzY3JvbGwgPCBsYXN0U2Nyb2xsICYmIGxhc3RTY3JvbGwpIHtcbiAgICAgICAgICAgICAgZGlyZWN0aW9uID0gJ3VwJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBkaXJlY3Rpb24gPSAnc3RhdGljJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5jYWNoZS5kaXJlY3Rpb24gPSBkaXJlY3Rpb247XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLmNhY2hlLmRpcmVjdGlvbjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVsZW1lbnRQb3NpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgZWxlbWVudCA9IG1vZHVsZS5jYWNoZS5lbGVtZW50LFxuICAgICAgICAgICAgICBzY3JlZW4gID0gbW9kdWxlLmdldC5zY3JlZW5TaXplKClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdTYXZpbmcgZWxlbWVudCBwb3NpdGlvbicpO1xuICAgICAgICAgICAgLy8gKHF1aWNrZXIgdGhhbiAkLmV4dGVuZClcbiAgICAgICAgICAgIGVsZW1lbnQuZml0cyAgICAgICAgICA9IChlbGVtZW50LmhlaWdodCA8IHNjcmVlbi5oZWlnaHQpO1xuICAgICAgICAgICAgZWxlbWVudC5vZmZzZXQgICAgICAgID0gJG1vZHVsZS5vZmZzZXQoKTtcbiAgICAgICAgICAgIGVsZW1lbnQud2lkdGggICAgICAgICA9ICRtb2R1bGUub3V0ZXJXaWR0aCgpO1xuICAgICAgICAgICAgZWxlbWVudC5oZWlnaHQgICAgICAgID0gJG1vZHVsZS5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgLy8gY29tcGVuc2F0ZSBmb3Igc2Nyb2xsIGluIGNvbnRleHRcbiAgICAgICAgICAgIGlmKG1vZHVsZS5pcy52ZXJ0aWNhbGx5U2Nyb2xsYWJsZUNvbnRleHQoKSkge1xuICAgICAgICAgICAgICBlbGVtZW50Lm9mZnNldC50b3AgKz0gJGNvbnRleHQuc2Nyb2xsVG9wKCkgLSAkY29udGV4dC5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihtb2R1bGUuaXMuaG9yaXpvbnRhbGx5U2Nyb2xsYWJsZUNvbnRleHQoKSkge1xuICAgICAgICAgICAgICBlbGVtZW50Lm9mZnNldC5sZWZ0ICs9ICRjb250ZXh0LnNjcm9sbExlZnQgLSAkY29udGV4dC5vZmZzZXQoKS5sZWZ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gc3RvcmVcbiAgICAgICAgICAgIG1vZHVsZS5jYWNoZS5lbGVtZW50ID0gZWxlbWVudDtcbiAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZWxlbWVudENhbGN1bGF0aW9uczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgc2NyZWVuICAgICA9IG1vZHVsZS5nZXQuc2NyZWVuQ2FsY3VsYXRpb25zKCksXG4gICAgICAgICAgICAgIGVsZW1lbnQgICAgPSBtb2R1bGUuZ2V0LmVsZW1lbnRQb3NpdGlvbigpXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICAvLyBvZmZzZXRcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLmluY2x1ZGVNYXJnaW4pIHtcbiAgICAgICAgICAgICAgZWxlbWVudC5tYXJnaW4gICAgICAgID0ge307XG4gICAgICAgICAgICAgIGVsZW1lbnQubWFyZ2luLnRvcCAgICA9IHBhcnNlSW50KCRtb2R1bGUuY3NzKCdtYXJnaW4tdG9wJyksIDEwKTtcbiAgICAgICAgICAgICAgZWxlbWVudC5tYXJnaW4uYm90dG9tID0gcGFyc2VJbnQoJG1vZHVsZS5jc3MoJ21hcmdpbi1ib3R0b20nKSwgMTApO1xuICAgICAgICAgICAgICBlbGVtZW50LnRvcCAgICA9IGVsZW1lbnQub2Zmc2V0LnRvcCAtIGVsZW1lbnQubWFyZ2luLnRvcDtcbiAgICAgICAgICAgICAgZWxlbWVudC5ib3R0b20gPSBlbGVtZW50Lm9mZnNldC50b3AgKyBlbGVtZW50LmhlaWdodCArIGVsZW1lbnQubWFyZ2luLmJvdHRvbTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBlbGVtZW50LnRvcCAgICA9IGVsZW1lbnQub2Zmc2V0LnRvcDtcbiAgICAgICAgICAgICAgZWxlbWVudC5ib3R0b20gPSBlbGVtZW50Lm9mZnNldC50b3AgKyBlbGVtZW50LmhlaWdodDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gdmlzaWJpbGl0eVxuICAgICAgICAgICAgZWxlbWVudC50b3BQYXNzZWQgICAgICAgID0gKHNjcmVlbi50b3AgPj0gZWxlbWVudC50b3ApO1xuICAgICAgICAgICAgZWxlbWVudC5ib3R0b21QYXNzZWQgICAgID0gKHNjcmVlbi50b3AgPj0gZWxlbWVudC5ib3R0b20pO1xuICAgICAgICAgICAgZWxlbWVudC50b3BWaXNpYmxlICAgICAgID0gKHNjcmVlbi5ib3R0b20gPj0gZWxlbWVudC50b3ApICYmICFlbGVtZW50LnRvcFBhc3NlZDtcbiAgICAgICAgICAgIGVsZW1lbnQuYm90dG9tVmlzaWJsZSAgICA9IChzY3JlZW4uYm90dG9tID49IGVsZW1lbnQuYm90dG9tKSAmJiAhZWxlbWVudC5ib3R0b21QYXNzZWQ7XG4gICAgICAgICAgICBlbGVtZW50LnBpeGVsc1Bhc3NlZCAgICAgPSAwO1xuICAgICAgICAgICAgZWxlbWVudC5wZXJjZW50YWdlUGFzc2VkID0gMDtcblxuICAgICAgICAgICAgLy8gbWV0YSBjYWxjdWxhdGlvbnNcbiAgICAgICAgICAgIGVsZW1lbnQub25TY3JlZW4gID0gKChlbGVtZW50LnRvcFZpc2libGUgfHwgZWxlbWVudC5wYXNzaW5nKSAmJiAhZWxlbWVudC5ib3R0b21QYXNzZWQpO1xuICAgICAgICAgICAgZWxlbWVudC5wYXNzaW5nICAgPSAoZWxlbWVudC50b3BQYXNzZWQgJiYgIWVsZW1lbnQuYm90dG9tUGFzc2VkKTtcbiAgICAgICAgICAgIGVsZW1lbnQub2ZmU2NyZWVuID0gKCFlbGVtZW50Lm9uU2NyZWVuKTtcblxuICAgICAgICAgICAgLy8gcGFzc2luZyBjYWxjdWxhdGlvbnNcbiAgICAgICAgICAgIGlmKGVsZW1lbnQucGFzc2luZykge1xuICAgICAgICAgICAgICBlbGVtZW50LnBpeGVsc1Bhc3NlZCAgICAgPSAoc2NyZWVuLnRvcCAtIGVsZW1lbnQudG9wKTtcbiAgICAgICAgICAgICAgZWxlbWVudC5wZXJjZW50YWdlUGFzc2VkID0gKHNjcmVlbi50b3AgLSBlbGVtZW50LnRvcCkgLyBlbGVtZW50LmhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG1vZHVsZS5jYWNoZS5lbGVtZW50ID0gZWxlbWVudDtcbiAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlKCdVcGRhdGVkIGVsZW1lbnQgY2FsY3VsYXRpb25zJywgZWxlbWVudCk7XG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNjcmVlbkNhbGN1bGF0aW9uczogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgc2Nyb2xsID0gbW9kdWxlLmdldC5zY3JvbGwoKVxuICAgICAgICAgICAgO1xuICAgICAgICAgICAgbW9kdWxlLnNhdmUuZGlyZWN0aW9uKCk7XG4gICAgICAgICAgICBtb2R1bGUuY2FjaGUuc2NyZWVuLnRvcCAgICA9IHNjcm9sbDtcbiAgICAgICAgICAgIG1vZHVsZS5jYWNoZS5zY3JlZW4uYm90dG9tID0gc2Nyb2xsICsgbW9kdWxlLmNhY2hlLnNjcmVlbi5oZWlnaHQ7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLmNhY2hlLnNjcmVlbjtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNjcmVlblNpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UoJ1NhdmluZyB3aW5kb3cgcG9zaXRpb24nKTtcbiAgICAgICAgICAgIG1vZHVsZS5jYWNoZS5zY3JlZW4gPSB7XG4gICAgICAgICAgICAgIGhlaWdodDogJGNvbnRleHQuaGVpZ2h0KClcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwb3NpdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBtb2R1bGUuc2F2ZS5zY3JlZW5TaXplKCk7XG4gICAgICAgICAgICBtb2R1bGUuc2F2ZS5lbGVtZW50UG9zaXRpb24oKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZ2V0OiB7XG4gICAgICAgICAgcGl4ZWxzUGFzc2VkOiBmdW5jdGlvbihhbW91bnQpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBlbGVtZW50ID0gbW9kdWxlLmdldC5lbGVtZW50Q2FsY3VsYXRpb25zKClcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIGlmKGFtb3VudC5zZWFyY2goJyUnKSA+IC0xKSB7XG4gICAgICAgICAgICAgIHJldHVybiAoIGVsZW1lbnQuaGVpZ2h0ICogKHBhcnNlSW50KGFtb3VudCwgMTApIC8gMTAwKSApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHBhcnNlSW50KGFtb3VudCwgMTApO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb2NjdXJyZWQ6IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICByZXR1cm4gKG1vZHVsZS5jYWNoZS5vY2N1cnJlZCAhPT0gdW5kZWZpbmVkKVxuICAgICAgICAgICAgICA/IG1vZHVsZS5jYWNoZS5vY2N1cnJlZFtjYWxsYmFja10gfHwgZmFsc2VcbiAgICAgICAgICAgICAgOiBmYWxzZVxuICAgICAgICAgICAgO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlyZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5jYWNoZS5kaXJlY3Rpb24gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBtb2R1bGUuc2F2ZS5kaXJlY3Rpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtb2R1bGUuY2FjaGUuZGlyZWN0aW9uO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZWxlbWVudFBvc2l0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5jYWNoZS5lbGVtZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnNhdmUuZWxlbWVudFBvc2l0aW9uKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlLmNhY2hlLmVsZW1lbnQ7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBlbGVtZW50Q2FsY3VsYXRpb25zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5jYWNoZS5lbGVtZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnNhdmUuZWxlbWVudENhbGN1bGF0aW9ucygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS5jYWNoZS5lbGVtZW50O1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2NyZWVuQ2FsY3VsYXRpb25zOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5jYWNoZS5zY3JlZW4gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBtb2R1bGUuc2F2ZS5zY3JlZW5DYWxjdWxhdGlvbnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBtb2R1bGUuY2FjaGUuc2NyZWVuO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgc2NyZWVuU2l6ZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZihtb2R1bGUuY2FjaGUuc2NyZWVuID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnNhdmUuc2NyZWVuU2l6ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS5jYWNoZS5zY3JlZW47XG4gICAgICAgICAgfSxcbiAgICAgICAgICBzY3JvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYobW9kdWxlLmNhY2hlLnNjcm9sbCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5zYXZlLnNjcm9sbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS5jYWNoZS5zY3JvbGw7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBsYXN0U2Nyb2xsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKG1vZHVsZS5jYWNoZS5zY3JlZW4gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcoJ0ZpcnN0IHNjcm9sbCBldmVudCwgbm8gbGFzdCBzY3JvbGwgY291bGQgYmUgZm91bmQnKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG1vZHVsZS5jYWNoZS5zY3JlZW4udG9wO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzZXR0aW5nOiBmdW5jdGlvbihuYW1lLCB2YWx1ZSkge1xuICAgICAgICAgIGlmKCAkLmlzUGxhaW5PYmplY3QobmFtZSkgKSB7XG4gICAgICAgICAgICAkLmV4dGVuZCh0cnVlLCBzZXR0aW5ncywgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgc2V0dGluZ3NbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gc2V0dGluZ3NbbmFtZV07XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnRlcm5hbDogZnVuY3Rpb24obmFtZSwgdmFsdWUpIHtcbiAgICAgICAgICBpZiggJC5pc1BsYWluT2JqZWN0KG5hbWUpICkge1xuICAgICAgICAgICAgJC5leHRlbmQodHJ1ZSwgbW9kdWxlLCBuYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBtb2R1bGVbbmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbW9kdWxlW25hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZGVidWc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCFzZXR0aW5ncy5zaWxlbnQgJiYgc2V0dGluZ3MuZGVidWcpIHtcbiAgICAgICAgICAgIGlmKHNldHRpbmdzLnBlcmZvcm1hbmNlKSB7XG4gICAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS5sb2coYXJndW1lbnRzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBtb2R1bGUuZGVidWcgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS5kZWJ1Zy5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgdmVyYm9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCAmJiBzZXR0aW5ncy52ZXJib3NlICYmIHNldHRpbmdzLmRlYnVnKSB7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBtb2R1bGUucGVyZm9ybWFuY2UubG9nKGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgbW9kdWxlLnZlcmJvc2UgPSBGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5jYWxsKGNvbnNvbGUuaW5mbywgY29uc29sZSwgc2V0dGluZ3MubmFtZSArICc6Jyk7XG4gICAgICAgICAgICAgIG1vZHVsZS52ZXJib3NlLmFwcGx5KGNvbnNvbGUsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIXNldHRpbmdzLnNpbGVudCkge1xuICAgICAgICAgICAgbW9kdWxlLmVycm9yID0gRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQuY2FsbChjb25zb2xlLmVycm9yLCBjb25zb2xlLCBzZXR0aW5ncy5uYW1lICsgJzonKTtcbiAgICAgICAgICAgIG1vZHVsZS5lcnJvci5hcHBseShjb25zb2xlLCBhcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcGVyZm9ybWFuY2U6IHtcbiAgICAgICAgICBsb2c6IGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICBjdXJyZW50VGltZSxcbiAgICAgICAgICAgICAgZXhlY3V0aW9uVGltZSxcbiAgICAgICAgICAgICAgcHJldmlvdXNUaW1lXG4gICAgICAgICAgICA7XG4gICAgICAgICAgICBpZihzZXR0aW5ncy5wZXJmb3JtYW5jZSkge1xuICAgICAgICAgICAgICBjdXJyZW50VGltZSAgID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgIHByZXZpb3VzVGltZSAgPSB0aW1lIHx8IGN1cnJlbnRUaW1lO1xuICAgICAgICAgICAgICBleGVjdXRpb25UaW1lID0gY3VycmVudFRpbWUgLSBwcmV2aW91c1RpbWU7XG4gICAgICAgICAgICAgIHRpbWUgICAgICAgICAgPSBjdXJyZW50VGltZTtcbiAgICAgICAgICAgICAgcGVyZm9ybWFuY2UucHVzaCh7XG4gICAgICAgICAgICAgICAgJ05hbWUnICAgICAgICAgICA6IG1lc3NhZ2VbMF0sXG4gICAgICAgICAgICAgICAgJ0FyZ3VtZW50cycgICAgICA6IFtdLnNsaWNlLmNhbGwobWVzc2FnZSwgMSkgfHwgJycsXG4gICAgICAgICAgICAgICAgJ0VsZW1lbnQnICAgICAgICA6IGVsZW1lbnQsXG4gICAgICAgICAgICAgICAgJ0V4ZWN1dGlvbiBUaW1lJyA6IGV4ZWN1dGlvblRpbWVcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLnRpbWVyKTtcbiAgICAgICAgICAgIG1vZHVsZS5wZXJmb3JtYW5jZS50aW1lciA9IHNldFRpbWVvdXQobW9kdWxlLnBlcmZvcm1hbmNlLmRpc3BsYXksIDUwMCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkaXNwbGF5OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICB0aXRsZSA9IHNldHRpbmdzLm5hbWUgKyAnOicsXG4gICAgICAgICAgICAgIHRvdGFsVGltZSA9IDBcbiAgICAgICAgICAgIDtcbiAgICAgICAgICAgIHRpbWUgPSBmYWxzZTtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChtb2R1bGUucGVyZm9ybWFuY2UudGltZXIpO1xuICAgICAgICAgICAgJC5lYWNoKHBlcmZvcm1hbmNlLCBmdW5jdGlvbihpbmRleCwgZGF0YSkge1xuICAgICAgICAgICAgICB0b3RhbFRpbWUgKz0gZGF0YVsnRXhlY3V0aW9uIFRpbWUnXTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGl0bGUgKz0gJyAnICsgdG90YWxUaW1lICsgJ21zJztcbiAgICAgICAgICAgIGlmKG1vZHVsZVNlbGVjdG9yKSB7XG4gICAgICAgICAgICAgIHRpdGxlICs9ICcgXFwnJyArIG1vZHVsZVNlbGVjdG9yICsgJ1xcJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiggKGNvbnNvbGUuZ3JvdXAgIT09IHVuZGVmaW5lZCB8fCBjb25zb2xlLnRhYmxlICE9PSB1bmRlZmluZWQpICYmIHBlcmZvcm1hbmNlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZCh0aXRsZSk7XG4gICAgICAgICAgICAgIGlmKGNvbnNvbGUudGFibGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKHBlcmZvcm1hbmNlKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkLmVhY2gocGVyZm9ybWFuY2UsIGZ1bmN0aW9uKGluZGV4LCBkYXRhKSB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhWydOYW1lJ10gKyAnOiAnICsgZGF0YVsnRXhlY3V0aW9uIFRpbWUnXSsnbXMnKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwZXJmb3JtYW5jZSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaW52b2tlOiBmdW5jdGlvbihxdWVyeSwgcGFzc2VkQXJndW1lbnRzLCBjb250ZXh0KSB7XG4gICAgICAgICAgdmFyXG4gICAgICAgICAgICBvYmplY3QgPSBpbnN0YW5jZSxcbiAgICAgICAgICAgIG1heERlcHRoLFxuICAgICAgICAgICAgZm91bmQsXG4gICAgICAgICAgICByZXNwb25zZVxuICAgICAgICAgIDtcbiAgICAgICAgICBwYXNzZWRBcmd1bWVudHMgPSBwYXNzZWRBcmd1bWVudHMgfHwgcXVlcnlBcmd1bWVudHM7XG4gICAgICAgICAgY29udGV4dCAgICAgICAgID0gZWxlbWVudCAgICAgICAgIHx8IGNvbnRleHQ7XG4gICAgICAgICAgaWYodHlwZW9mIHF1ZXJ5ID09ICdzdHJpbmcnICYmIG9iamVjdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBxdWVyeSAgICA9IHF1ZXJ5LnNwbGl0KC9bXFwuIF0vKTtcbiAgICAgICAgICAgIG1heERlcHRoID0gcXVlcnkubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgICQuZWFjaChxdWVyeSwgZnVuY3Rpb24oZGVwdGgsIHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBjYW1lbENhc2VWYWx1ZSA9IChkZXB0aCAhPSBtYXhEZXB0aClcbiAgICAgICAgICAgICAgICA/IHZhbHVlICsgcXVlcnlbZGVwdGggKyAxXS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHF1ZXJ5W2RlcHRoICsgMV0uc2xpY2UoMSlcbiAgICAgICAgICAgICAgICA6IHF1ZXJ5XG4gICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgaWYoICQuaXNQbGFpbk9iamVjdCggb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXSApICYmIChkZXB0aCAhPSBtYXhEZXB0aCkgKSB7XG4gICAgICAgICAgICAgICAgb2JqZWN0ID0gb2JqZWN0W2NhbWVsQ2FzZVZhbHVlXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCBvYmplY3RbY2FtZWxDYXNlVmFsdWVdICE9PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgICAgZm91bmQgPSBvYmplY3RbY2FtZWxDYXNlVmFsdWVdO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbHNlIGlmKCAkLmlzUGxhaW5PYmplY3QoIG9iamVjdFt2YWx1ZV0gKSAmJiAoZGVwdGggIT0gbWF4RGVwdGgpICkge1xuICAgICAgICAgICAgICAgIG9iamVjdCA9IG9iamVjdFt2YWx1ZV07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSBpZiggb2JqZWN0W3ZhbHVlXSAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gb2JqZWN0W3ZhbHVlXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbW9kdWxlLmVycm9yKGVycm9yLm1ldGhvZCwgcXVlcnkpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICggJC5pc0Z1bmN0aW9uKCBmb3VuZCApICkge1xuICAgICAgICAgICAgcmVzcG9uc2UgPSBmb3VuZC5hcHBseShjb250ZXh0LCBwYXNzZWRBcmd1bWVudHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGZvdW5kICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlID0gZm91bmQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCQuaXNBcnJheShyZXR1cm5lZFZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuZWRWYWx1ZS5wdXNoKHJlc3BvbnNlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihyZXR1cm5lZFZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSBbcmV0dXJuZWRWYWx1ZSwgcmVzcG9uc2VdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKHJlc3BvbnNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybmVkVmFsdWUgPSByZXNwb25zZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBpZihtZXRob2RJbnZva2VkKSB7XG4gICAgICAgIGlmKGluc3RhbmNlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGluc3RhbmNlLnNhdmUuc2Nyb2xsKCk7XG4gICAgICAgIGluc3RhbmNlLnNhdmUuY2FsY3VsYXRpb25zKCk7XG4gICAgICAgIG1vZHVsZS5pbnZva2UocXVlcnkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGlmKGluc3RhbmNlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpbnN0YW5jZS5pbnZva2UoJ2Rlc3Ryb3knKTtcbiAgICAgICAgfVxuICAgICAgICBtb2R1bGUuaW5pdGlhbGl6ZSgpO1xuICAgICAgfVxuICAgIH0pXG4gIDtcblxuICByZXR1cm4gKHJldHVybmVkVmFsdWUgIT09IHVuZGVmaW5lZClcbiAgICA/IHJldHVybmVkVmFsdWVcbiAgICA6IHRoaXNcbiAgO1xufTtcblxuJC5mbi52aXNpYmlsaXR5LnNldHRpbmdzID0ge1xuXG4gIG5hbWUgICAgICAgICAgICAgICAgICAgOiAnVmlzaWJpbGl0eScsXG4gIG5hbWVzcGFjZSAgICAgICAgICAgICAgOiAndmlzaWJpbGl0eScsXG5cbiAgZGVidWcgICAgICAgICAgICAgICAgICA6IGZhbHNlLFxuICB2ZXJib3NlICAgICAgICAgICAgICAgIDogZmFsc2UsXG4gIHBlcmZvcm1hbmNlICAgICAgICAgICAgOiB0cnVlLFxuXG4gIC8vIHdoZXRoZXIgdG8gdXNlIG11dGF0aW9uIG9ic2VydmVycyB0byBmb2xsb3cgY2hhbmdlc1xuICBvYnNlcnZlQ2hhbmdlcyAgICAgICAgIDogdHJ1ZSxcblxuICAvLyBjaGVjayBwb3NpdGlvbiBpbW1lZGlhdGVseSBvbiBpbml0XG4gIGluaXRpYWxDaGVjayAgICAgICAgICAgOiB0cnVlLFxuXG4gIC8vIHdoZXRoZXIgdG8gcmVmcmVzaCBjYWxjdWxhdGlvbnMgYWZ0ZXIgYWxsIHBhZ2UgaW1hZ2VzIGxvYWRcbiAgcmVmcmVzaE9uTG9hZCAgICAgICAgICA6IHRydWUsXG5cbiAgLy8gd2hldGhlciB0byByZWZyZXNoIGNhbGN1bGF0aW9ucyBhZnRlciBwYWdlIHJlc2l6ZSBldmVudFxuICByZWZyZXNoT25SZXNpemUgICAgICAgIDogdHJ1ZSxcblxuICAvLyBzaG91bGQgY2FsbCBjYWxsYmFja3Mgb24gcmVmcmVzaCBldmVudCAocmVzaXplLCBldGMpXG4gIGNoZWNrT25SZWZyZXNoICAgICAgICAgOiB0cnVlLFxuXG4gIC8vIGNhbGxiYWNrIHNob3VsZCBvbmx5IG9jY3VyIG9uZSB0aW1lXG4gIG9uY2UgICAgICAgICAgICAgICAgICAgOiB0cnVlLFxuXG4gIC8vIGNhbGxiYWNrIHNob3VsZCBmaXJlIGNvbnRpbnVvdXNseSB3aGUgZXZhbHVhdGVzIHRvIHRydWVcbiAgY29udGludW91cyAgICAgICAgICAgICA6IGZhbHNlLFxuXG4gIC8vIG9mZnNldCB0byB1c2Ugd2l0aCBzY3JvbGwgdG9wXG4gIG9mZnNldCAgICAgICAgICAgICAgICAgOiAwLFxuXG4gIC8vIHdoZXRoZXIgdG8gaW5jbHVkZSBtYXJnaW4gaW4gZWxlbWVudHMgcG9zaXRpb25cbiAgaW5jbHVkZU1hcmdpbiAgICAgICAgICA6IGZhbHNlLFxuXG4gIC8vIHNjcm9sbCBjb250ZXh0IGZvciB2aXNpYmlsaXR5IGNoZWNrc1xuICBjb250ZXh0ICAgICAgICAgICAgICAgIDogd2luZG93LFxuXG4gIC8vIHZpc2liaWxpdHkgY2hlY2sgZGVsYXkgaW4gbXMgKGRlZmF1bHRzIHRvIGFuaW1hdGlvbkZyYW1lKVxuICB0aHJvdHRsZSAgICAgICAgICAgICAgIDogZmFsc2UsXG5cbiAgLy8gc3BlY2lhbCB2aXNpYmlsaXR5IHR5cGUgKGltYWdlLCBmaXhlZClcbiAgdHlwZSAgICAgICAgICAgICAgICAgICA6IGZhbHNlLFxuXG4gIC8vIHotaW5kZXggdG8gdXNlIHdpdGggdmlzaWJpbGl0eSAnZml4ZWQnXG4gIHpJbmRleCAgICAgICAgICAgICAgICAgOiAnMTAnLFxuXG4gIC8vIGltYWdlIG9ubHkgYW5pbWF0aW9uIHNldHRpbmdzXG4gIHRyYW5zaXRpb24gICAgICAgICAgICAgOiAnZmFkZSBpbicsXG4gIGR1cmF0aW9uICAgICAgICAgICAgICAgOiAxMDAwLFxuXG4gIC8vIGFycmF5IG9mIGNhbGxiYWNrcyBmb3IgcGVyY2VudGFnZVxuICBvblBhc3NlZCAgICAgICAgICAgICAgIDoge30sXG5cbiAgLy8gc3RhbmRhcmQgY2FsbGJhY2tzXG4gIG9uT25TY3JlZW4gICAgICAgICAgICAgOiBmYWxzZSxcbiAgb25PZmZTY3JlZW4gICAgICAgICAgICA6IGZhbHNlLFxuICBvblBhc3NpbmcgICAgICAgICAgICAgIDogZmFsc2UsXG4gIG9uVG9wVmlzaWJsZSAgICAgICAgICAgOiBmYWxzZSxcbiAgb25Cb3R0b21WaXNpYmxlICAgICAgICA6IGZhbHNlLFxuICBvblRvcFBhc3NlZCAgICAgICAgICAgIDogZmFsc2UsXG4gIG9uQm90dG9tUGFzc2VkICAgICAgICAgOiBmYWxzZSxcblxuICAvLyByZXZlcnNlIGNhbGxiYWNrc1xuICBvblBhc3NpbmdSZXZlcnNlICAgICAgIDogZmFsc2UsXG4gIG9uVG9wVmlzaWJsZVJldmVyc2UgICAgOiBmYWxzZSxcbiAgb25Cb3R0b21WaXNpYmxlUmV2ZXJzZSA6IGZhbHNlLFxuICBvblRvcFBhc3NlZFJldmVyc2UgICAgIDogZmFsc2UsXG4gIG9uQm90dG9tUGFzc2VkUmV2ZXJzZSAgOiBmYWxzZSxcblxuICAvLyBzcGVjaWFsIGNhbGxiYWNrcyBmb3IgaW1hZ2VcbiAgb25Mb2FkICAgICAgICAgICAgICAgICA6IGZ1bmN0aW9uKCkge30sXG4gIG9uQWxsTG9hZGVkICAgICAgICAgICAgOiBmdW5jdGlvbigpIHt9LFxuXG4gIC8vIHNwZWNpYWwgY2FsbGJhY2tzIGZvciBmaXhlZCBwb3NpdGlvblxuICBvbkZpeGVkICAgICAgICAgICAgICAgIDogZnVuY3Rpb24oKSB7fSxcbiAgb25VbmZpeGVkICAgICAgICAgICAgICA6IGZ1bmN0aW9uKCkge30sXG5cbiAgLy8gdXRpbGl0eSBjYWxsYmFja3NcbiAgb25VcGRhdGUgICAgICAgICAgICAgICA6IGZhbHNlLCAvLyBkaXNhYmxlZCBieSBkZWZhdWx0IGZvciBwZXJmb3JtYW5jZVxuICBvblJlZnJlc2ggICAgICAgICAgICAgIDogZnVuY3Rpb24oKXt9LFxuXG4gIG1ldGFkYXRhIDoge1xuICAgIHNyYzogJ3NyYydcbiAgfSxcblxuICBjbGFzc05hbWU6IHtcbiAgICBmaXhlZCAgICAgICA6ICdmaXhlZCcsXG4gICAgcGxhY2Vob2xkZXIgOiAncGxhY2Vob2xkZXInLFxuICAgIHZpc2libGUgICAgIDogJ3Zpc2libGUnXG4gIH0sXG5cbiAgZXJyb3IgOiB7XG4gICAgbWV0aG9kICA6ICdUaGUgbWV0aG9kIHlvdSBjYWxsZWQgaXMgbm90IGRlZmluZWQuJyxcbiAgICB2aXNpYmxlIDogJ0VsZW1lbnQgaXMgaGlkZGVuLCB5b3UgbXVzdCBjYWxsIHJlZnJlc2ggYWZ0ZXIgZWxlbWVudCBiZWNvbWVzIHZpc2libGUnXG4gIH1cblxufTtcblxufSkoIGpRdWVyeSwgd2luZG93LCBkb2N1bWVudCApO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9ub2RlX21vZHVsZXMvc2VtYW50aWMtdWktY3NzL3NlbWFudGljLmpzXG4vLyBtb2R1bGUgaWQgPSAxMTQ5XG4vLyBtb2R1bGUgY2h1bmtzID0gNSIsImltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBDYXJkIH0gZnJvbSAnc2VtYW50aWMtdWktcmVhY3QnO1xuaW1wb3J0IGZhY3RvcnkgZnJvbSAnLi4vZXRoZXJldW0vZmFjdG9yeSc7XG5pbXBvcnQgJ3NlbWFudGljLXVpLWNzcy8nXG5cbmNsYXNzIENhbXBhaWduSW5kZXggZXh0ZW5kcyBDb21wb25lbnQge1xuICBzdGF0aWMgYXN5bmMgZ2V0SW5pdGlhbFByb3BzKCkge1xuICAgIGNvbnN0IGNhbXBhaWducyA9IGF3YWl0IGZhY3RvcnkubWV0aG9kcy5nZXREZXBsb3llZENhbXBhaWducygpLmNhbGwoKTtcblxuICAgIHJldHVybiB7IGNhbXBhaWducyB9O1xuICB9XG5cbiAgcmVuZGVyQ2FtcGFpZ25zKCkge1xuICAgIGNvbnN0IGl0ZW1zID0gdGhpcy5wcm9wcy5jYW1wYWlnbnMubWFwKGFkZHJlc3MgPT4ge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaGVhZGVyOiBhZGRyZXNzLFxuICAgICAgICBkZXNjcmlwdGlvbjogPGEgaHJlZj1cIlwiPnZpZXcgY2FtcGFpZ248L2E+LFxuICAgICAgICBmbHVpZDogdHJ1ZVxuICAgICAgfTtcbiAgICB9KTtcblxuICAgIHJldHVybiA8Q2FyZC5Hcm91cCBpdGVtcz17aXRlbXN9IC8+O1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHJldHVybiA8ZGl2Pnt0aGlzLnJlbmRlckNhbXBhaWducygpfTwvZGl2PjtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDYW1wYWlnbkluZGV4O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vcGFnZXM/ZW50cnkiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3grckJBO0FBQ0E7OztBQUFBO0FBQ0E7QUFBQTtBQUNBOzs7QUFBQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7OztBQVNBO0FBQUE7O0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFKQTtBQU1BO0FBQ0E7QUFEQTtBQUFBO0FBQ0E7QUFEQTtBQUFBOzs7O0FBSUE7QUFBQTs7QUFBQTtBQUFBO0FBQUE7QUFBQTs7Ozs7Ozs7Ozs7O0FBbEJBO0FBQ0E7QUFEQTs7QUFFQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1CQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBIiwic291cmNlUm9vdCI6IiJ9